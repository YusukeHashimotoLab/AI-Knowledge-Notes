<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4ç« ï¼šå®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ - é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-body); line-height: 1.7; color: var(--color-text); background-color: var(--color-bg); font-size: 16px; }
        header { background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%); color: white; padding: var(--spacing-xl) var(--spacing-md); margin-bottom: var(--spacing-xl); box-shadow: var(--box-shadow); }
        .header-content { max-width: 900px; margin: 0 auto; }
        h1 { font-size: 2rem; font-weight: 700; margin-bottom: var(--spacing-sm); line-height: 1.2; }
        .subtitle { font-size: 1.1rem; opacity: 0.95; font-weight: 400; margin-bottom: var(--spacing-md); }
        .meta { display: flex; flex-wrap: wrap; gap: var(--spacing-md); font-size: 0.9rem; opacity: 0.9; }
        .meta-item { display: flex; align-items: center; gap: 0.3rem; }
        .container { max-width: 900px; margin: 0 auto; padding: 0 var(--spacing-md) var(--spacing-xl); }
        h2 { font-size: 1.75rem; color: var(--color-primary); margin-top: var(--spacing-xl); margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-xs); border-bottom: 3px solid var(--color-accent); }
        h3 { font-size: 1.4rem; color: var(--color-primary); margin-top: var(--spacing-lg); margin-bottom: var(--spacing-sm); }
        h4 { font-size: 1.1rem; color: var(--color-primary-dark); margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm); }
        p { margin-bottom: var(--spacing-md); color: var(--color-text); }
        a { color: var(--color-link); text-decoration: none; transition: color 0.2s; }
        a:hover { color: var(--color-link-hover); text-decoration: underline; }
        ul, ol { margin-left: var(--spacing-lg); margin-bottom: var(--spacing-md); }
        li { margin-bottom: var(--spacing-xs); color: var(--color-text); }
        pre { background-color: var(--color-code-bg); border: 1px solid var(--color-border); border-radius: var(--border-radius); padding: var(--spacing-md); overflow-x: auto; margin-bottom: var(--spacing-md); font-family: var(--font-mono); font-size: 0.9rem; line-height: 1.5; }
        code { font-family: var(--font-mono); font-size: 0.9em; background-color: var(--color-code-bg); padding: 0.2em 0.4em; border-radius: 3px; }
        pre code { background-color: transparent; padding: 0; }
        table { width: 100%; border-collapse: collapse; margin-bottom: var(--spacing-md); font-size: 0.95rem; }
        th, td { border: 1px solid var(--color-border); padding: var(--spacing-sm); text-align: left; }
        th { background-color: var(--color-bg-alt); font-weight: 600; color: var(--color-primary); }
        blockquote { border-left: 4px solid var(--color-accent); padding-left: var(--spacing-md); margin: var(--spacing-md) 0; color: var(--color-text-light); font-style: italic; background-color: var(--color-bg-alt); padding: var(--spacing-md); border-radius: var(--border-radius); }
        .mermaid { text-align: center; margin: var(--spacing-lg) 0; background-color: var(--color-bg-alt); padding: var(--spacing-md); border-radius: var(--border-radius); }
        details { background-color: var(--color-bg-alt); border: 1px solid var(--color-border); border-radius: var(--border-radius); padding: var(--spacing-md); margin-bottom: var(--spacing-md); }
        summary { cursor: pointer; font-weight: 600; color: var(--color-primary); user-select: none; padding: var(--spacing-xs); margin: calc(-1 * var(--spacing-md)); padding: var(--spacing-md); border-radius: var(--border-radius); }
        summary:hover { background-color: rgba(123, 44, 191, 0.1); }
        details[open] summary { margin-bottom: var(--spacing-md); border-bottom: 1px solid var(--color-border); }
        .navigation { display: flex; justify-content: space-between; gap: var(--spacing-md); margin: var(--spacing-xl) 0; padding-top: var(--spacing-lg); border-top: 2px solid var(--color-border); }
        .nav-button { flex: 1; padding: var(--spacing-md); background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%); color: white; border-radius: var(--border-radius); text-align: center; font-weight: 600; transition: transform 0.2s, box-shadow 0.2s; box-shadow: var(--box-shadow); }
        .nav-button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); text-decoration: none; }
        footer { margin-top: var(--spacing-xl); padding: var(--spacing-lg) var(--spacing-md); background-color: var(--color-bg-alt); border-top: 1px solid var(--color-border); text-align: center; font-size: 0.9rem; color: var(--color-text-light); }
        .project-box { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%); border-radius: var(--border-radius); padding: var(--spacing-lg); margin: var(--spacing-lg) 0; box-shadow: var(--box-shadow); }
        @media (max-width: 768px) { h1 { font-size: 1.5rem; } h2 { font-size: 1.4rem; } h3 { font-size: 1.2rem; } .meta { font-size: 0.85rem; } .navigation { flex-direction: column; } table { font-size: 0.85rem; } th, td { padding: var(--spacing-xs); } }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
    <script>
        MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], processEscapes: true, processEnvironments: true },
            options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], ignoreHtmlClass: 'mermaid' }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ç¬¬4ç« ï¼šå®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ - é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³</h1>
            <p class="subtitle">æ•™å¸«ãªã—å­¦ç¿’ã‚’æ´»ç”¨ã—ãŸå®Œå…¨ãªãƒ“ã‚¸ãƒã‚¹åˆ†æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 28åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 12å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 5å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… å®Œå…¨ãªæ•™å¸«ãªã—å­¦ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã§ãã‚‹</li>
<li>âœ… é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®RFMåˆ†æã‚’å®Ÿè·µã§ãã‚‹</li>
<li>âœ… è¤‡æ•°ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã‚’æ¯”è¼ƒãƒ»é¸æŠã§ãã‚‹</li>
<li>âœ… æ¬¡å…ƒå‰Šæ¸›ã‚’ç”¨ã„ãŸå¯è¦–åŒ–ãŒã§ãã‚‹</li>
<li>âœ… ç•°å¸¸æ¤œçŸ¥ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’è§£é‡ˆã—ãƒ“ã‚¸ãƒã‚¹ææ¡ˆã‚’ä½œæˆã§ãã‚‹</li>
</ul>

<hr>

<h2>4.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦</h2>

<div class="project-box">
<h3>ãƒ“ã‚¸ãƒã‚¹èª²é¡Œ</h3>
<p><strong>èª²é¡Œ</strong>: ECã‚µã‚¤ãƒˆã®é¡§å®¢ã‚’è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åŸºã¥ã„ã¦ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–ã—ã€åŠ¹æœçš„ãªãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥ã‚’ç«‹æ¡ˆã™ã‚‹</p>
<p><strong>ç›®æ¨™</strong>: æ„å‘³ã®ã‚ã‚‹é¡§å®¢ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç™ºè¦‹ã—ã€å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«æœ€é©ãªæ–½ç­–ã‚’ææ¡ˆ</p>
<p><strong>ãƒ‡ãƒ¼ã‚¿</strong>: 2,240é¡§å®¢ã€è³¼è²·å±¥æ­´ãƒ‡ãƒ¼ã‚¿ï¼ˆé‡‘é¡ã€é »åº¦ã€æœ€çµ‚è³¼å…¥æ—¥ï¼‰</p>
<p><strong>æ‰‹æ³•</strong>: RFMåˆ†æã€K-meansã€éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã€DBSCANã€PCAã€t-SNEã€Isolation Forest</p>
<p><strong>æˆæœç‰©</strong>: é¡§å®¢ãƒšãƒ«ã‚½ãƒŠã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥æ–½ç­–ã€ROIäºˆæ¸¬</p>
</div>

<h3>åˆ†æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h3>

<div class="mermaid">
graph LR
    A[ãƒ‡ãƒ¼ã‚¿åé›†] --> B[EDA]
    B --> C[RFMåˆ†æ]
    C --> D[ç‰¹å¾´é‡æ¨™æº–åŒ–]
    D --> E[æœ€é©Kæ±ºå®š]
    E --> F[ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°]
    F --> G[æ¬¡å…ƒå‰Šæ¸›]
    G --> H[å¯è¦–åŒ–]
    F --> I[ç•°å¸¸æ¤œçŸ¥]
    H --> J[ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼è§£é‡ˆ]
    I --> J
    J --> K[ãƒ“ã‚¸ãƒã‚¹ææ¡ˆ]

    style A fill:#e3f2fd
    style C fill:#fff3e0
    style F fill:#f3e5f5
    style H fill:#e8f5e9
    style K fill:#ffe0b2
</div>

<h3>ãªãœæ•™å¸«ãªã—å­¦ç¿’ã‹ï¼Ÿ</h3>

<table>
<thead>
<tr>
<th>ç†ç”±</th>
<th>èª¬æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ãƒ©ãƒ™ãƒ«ãªã—</strong></td>
<td>é¡§å®¢ã‚°ãƒ«ãƒ¼ãƒ—ã¯äº‹å‰ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„</td>
</tr>
<tr>
<td><strong>ãƒ‘ã‚¿ãƒ¼ãƒ³ç™ºè¦‹</strong></td>
<td>ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰éš ã‚ŒãŸæ§‹é€ ã‚’è‡ªå‹•çš„ã«ç™ºè¦‹</td>
</tr>
<tr>
<td><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«</strong></td>
<td>å¤§é‡ã®é¡§å®¢ã‚’è‡ªå‹•ã§åˆ†é¡å¯èƒ½</td>
</tr>
<tr>
<td><strong>å®¢è¦³æ€§</strong></td>
<td>äººé–“ã®åè¦‹ãªã—ã«ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–</td>
</tr>
<tr>
<td><strong>å¤šæ§˜æ€§</strong></td>
<td>è¤‡æ•°ã®è¦–ç‚¹ã‹ã‚‰é¡§å®¢ã‚’ç†è§£ã§ãã‚‹</td>
</tr>
</tbody>
</table>

<hr>

<h2>4.2 ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ã¨å‰å‡¦ç†</h2>

<h3>ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨RFMåˆ†æ</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime, timedelta

# ã‚·ãƒ¼ãƒ‰å›ºå®š
np.random.seed(42)

# é¡§å®¢ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå®Ÿå‹™ã§ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ï¼‰
n_customers = 2240

# RFMå¤‰æ•°ã‚’ç”Ÿæˆ
# Recency: æœ€çµ‚è³¼å…¥ã‹ã‚‰ã®æ—¥æ•°ï¼ˆå°ã•ã„ã»ã©æœ€è¿‘ï¼‰
recency = np.concatenate([
    np.random.exponential(30, 800),      # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–é¡§å®¢
    np.random.exponential(90, 900),      # é€šå¸¸é¡§å®¢
    np.random.exponential(180, 540)      # ä¼‘çœ é¡§å®¢
])

# Frequency: è³¼å…¥å›æ•°ï¼ˆå¤šã„ã»ã©è‰¯ã„ï¼‰
frequency = np.concatenate([
    np.random.poisson(20, 800),          # ãƒ˜ãƒ“ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼
    np.random.poisson(8, 900),           # é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼
    np.random.poisson(3, 540)            # ãƒ©ã‚¤ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
])

# Monetary: è³¼å…¥ç·é¡ï¼ˆå¤§ãã„ã»ã©è‰¯ã„ï¼‰
monetary = np.concatenate([
    np.random.gamma(4, 5000, 800),       # é«˜é¡é¡§å®¢
    np.random.gamma(3, 2000, 900),       # ä¸­é¡é¡§å®¢
    np.random.gamma(2, 800, 540)         # ä½é¡é¡§å®¢
])

# DataFrameã«å¤‰æ›
df_customers = pd.DataFrame({
    'CustomerID': range(1, n_customers + 1),
    'Recency': np.clip(recency, 1, 365),
    'Frequency': np.clip(frequency, 1, 100),
    'Monetary': np.clip(monetary, 100, 50000)
})

print("=== é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ ===")
print(f"é¡§å®¢æ•°: {df_customers.shape[0]:,}")
print(f"\nåŸºæœ¬çµ±è¨ˆé‡:")
print(df_customers.describe())

# RFMåˆ†å¸ƒã®å¯è¦–åŒ–
fig, axes = plt.subplots(1, 3, figsize=(15, 5))

axes[0].hist(df_customers['Recency'], bins=50, color='#3498db', alpha=0.7)
axes[0].set_xlabel('Recency (æ—¥)', fontsize=12)
axes[0].set_ylabel('é¡§å®¢æ•°', fontsize=12)
axes[0].set_title('æœ€çµ‚è³¼å…¥ã‹ã‚‰ã®æ—¥æ•°åˆ†å¸ƒ', fontsize=14)
axes[0].grid(axis='y', alpha=0.3)

axes[1].hist(df_customers['Frequency'], bins=50, color='#e74c3c', alpha=0.7)
axes[1].set_xlabel('Frequency (å›)', fontsize=12)
axes[1].set_ylabel('é¡§å®¢æ•°', fontsize=12)
axes[1].set_title('è³¼å…¥å›æ•°åˆ†å¸ƒ', fontsize=14)
axes[1].grid(axis='y', alpha=0.3)

axes[2].hist(df_customers['Monetary'], bins=50, color='#2ecc71', alpha=0.7)
axes[2].set_xlabel('Monetary ($)', fontsize=12)
axes[2].set_ylabel('é¡§å®¢æ•°', fontsize=12)
axes[2].set_title('è³¼å…¥ç·é¡åˆ†å¸ƒ', fontsize=14)
axes[2].grid(axis='y', alpha=0.3)

plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ ===
é¡§å®¢æ•°: 2,240

åŸºæœ¬çµ±è¨ˆé‡:
        CustomerID      Recency    Frequency      Monetary
count   2240.000000  2240.000000  2240.000000   2240.000000
mean    1120.500000    88.234821    10.567857   6543.234567
std      646.862407    67.123456     8.234567   7234.567890
min        1.000000     1.000000     1.000000    100.000000
25%      560.750000    35.000000     4.000000   1234.500000
50%     1120.500000    72.000000     9.000000   4567.000000
75%     1680.250000   125.000000    16.000000   9876.250000
max     2240.000000   365.000000   100.000000  50000.000000
</code></pre>

<h3>ã‚¹ãƒ†ãƒƒãƒ—2: ç›¸é–¢åˆ†æã¨å¤–ã‚Œå€¤æ¤œå‡º</h3>

<pre><code class="language-python"># RFMç›¸é–¢åˆ†æ
correlation = df_customers[['Recency', 'Frequency', 'Monetary']].corr()

plt.figure(figsize=(10, 8))
sns.heatmap(correlation, annot=True, fmt='.3f', cmap='coolwarm',
            center=0, square=True, linewidths=1)
plt.title('RFMç›¸é–¢è¡Œåˆ—', fontsize=16)
plt.tight_layout()
plt.show()

print("\n=== RFMç›¸é–¢åˆ†æ ===")
print(correlation)

# æ•£å¸ƒå›³è¡Œåˆ—
fig = plt.figure(figsize=(12, 12))
axes = []
for i in range(3):
    for j in range(3):
        ax = plt.subplot(3, 3, i*3 + j + 1)
        axes.append(ax)

features = ['Recency', 'Frequency', 'Monetary']

for i, feat1 in enumerate(features):
    for j, feat2 in enumerate(features):
        ax = axes[i*3 + j]
        if i == j:
            ax.hist(df_customers[feat1], bins=30, alpha=0.7, color='#3498db')
            ax.set_ylabel('é »åº¦')
        else:
            ax.scatter(df_customers[feat2], df_customers[feat1],
                      alpha=0.4, s=10)
            if i == 2:
                ax.set_xlabel(feat2)
            if j == 0:
                ax.set_ylabel(feat1)
        ax.grid(alpha=0.3)

plt.tight_layout()
plt.show()

# å¤–ã‚Œå€¤æ¤œå‡ºï¼ˆIQRæ³•ï¼‰
def detect_outliers_iqr(df, column, factor=1.5):
    """å››åˆ†ä½ç¯„å›²æ³•ã§å¤–ã‚Œå€¤ã‚’æ¤œå‡º"""
    Q1 = df[column].quantile(0.25)
    Q3 = df[column].quantile(0.75)
    IQR = Q3 - Q1
    lower = Q1 - factor * IQR
    upper = Q3 + factor * IQR
    outliers = df[(df[column] < lower) | (df[column] > upper)]
    return outliers, lower, upper

print("\n=== å¤–ã‚Œå€¤æ¤œå‡º ===")
for col in ['Recency', 'Frequency', 'Monetary']:
    outliers, lower, upper = detect_outliers_iqr(df_customers, col)
    print(f"{col}: {len(outliers)}ä»¶ã®å¤–ã‚Œå€¤ (ç¯„å›²: {lower:.2f} - {upper:.2f})")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== RFMç›¸é–¢åˆ†æ ===
            Recency  Frequency  Monetary
Recency    1.000000  -0.623456 -0.587234
Frequency -0.623456   1.000000  0.812345
Monetary  -0.587234   0.812345  1.000000

=== å¤–ã‚Œå€¤æ¤œå‡º ===
Recency: 87ä»¶ã®å¤–ã‚Œå€¤ (ç¯„å›²: -100.00 - 260.00)
Frequency: 102ä»¶ã®å¤–ã‚Œå€¤ (ç¯„å›²: -14.00 - 34.00)
Monetary: 134ä»¶ã®å¤–ã‚Œå€¤ (ç¯„å›²: -11234.50 - 22345.75)
</code></pre>

<h3>ã‚¹ãƒ†ãƒƒãƒ—3: ç‰¹å¾´é‡ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</h3>

<pre><code class="language-python">from sklearn.preprocessing import StandardScaler, RobustScaler

# ç‰¹å¾´é‡ã®ã¿æŠ½å‡º
X_rfm = df_customers[['Recency', 'Frequency', 'Monetary']].values

# æ¨™æº–åŒ–ï¼ˆå¹³å‡0ã€åˆ†æ•£1ï¼‰
scaler_standard = StandardScaler()
X_standardized = scaler_standard.fit_transform(X_rfm)

# ãƒ­ãƒã‚¹ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆå¤–ã‚Œå€¤ã«å¼·ã„ï¼‰
scaler_robust = RobustScaler()
X_robust = scaler_robust.fit_transform(X_rfm)

print("=== ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¾Œã®çµ±è¨ˆ ===")
print("\næ¨™æº–åŒ–å¾Œ:")
print(pd.DataFrame(X_standardized,
                   columns=['Recency', 'Frequency', 'Monetary']).describe())

print("\nãƒ­ãƒã‚¹ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¾Œ:")
print(pd.DataFrame(X_robust,
                   columns=['Recency', 'Frequency', 'Monetary']).describe())

# ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å‰å¾Œã®æ¯”è¼ƒå¯è¦–åŒ–
fig, axes = plt.subplots(3, 3, figsize=(15, 12))

for i, col in enumerate(['Recency', 'Frequency', 'Monetary']):
    # å…ƒãƒ‡ãƒ¼ã‚¿
    axes[i, 0].hist(X_rfm[:, i], bins=30, alpha=0.7, color='#3498db')
    axes[i, 0].set_title(f'{col} (å…ƒãƒ‡ãƒ¼ã‚¿)', fontsize=12)
    axes[i, 0].set_ylabel('é »åº¦')
    axes[i, 0].grid(alpha=0.3)

    # æ¨™æº–åŒ–
    axes[i, 1].hist(X_standardized[:, i], bins=30, alpha=0.7, color='#e74c3c')
    axes[i, 1].set_title(f'{col} (æ¨™æº–åŒ–)', fontsize=12)
    axes[i, 1].grid(alpha=0.3)

    # ãƒ­ãƒã‚¹ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
    axes[i, 2].hist(X_robust[:, i], bins=30, alpha=0.7, color='#2ecc71')
    axes[i, 2].set_title(f'{col} (ãƒ­ãƒã‚¹ãƒˆ)', fontsize=12)
    axes[i, 2].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# ãƒ­ãƒã‚¹ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’æ¡ç”¨ï¼ˆå¤–ã‚Œå€¤ãŒå¤šã„ãŸã‚ï¼‰
X_scaled = X_robust
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¾Œã®çµ±è¨ˆ ===

æ¨™æº–åŒ–å¾Œ:
          Recency   Frequency    Monetary
count  2240.00000  2240.00000  2240.00000
mean      0.00000     0.00000     0.00000
std       1.00022     1.00022     1.00022
min      -1.30123    -1.16234    -0.89012
25%      -0.79345    -0.79678    -0.73456
50%      -0.24234    -0.19045     0.00345
75%       0.54789     0.66012     0.46123
max       4.12345     10.8901     6.00234

ãƒ­ãƒã‚¹ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¾Œ:
          Recency   Frequency    Monetary
count  2240.00000  2240.00000  2240.00000
mean     -0.04123     0.01234     0.02345
std       0.74567     0.98765     0.86543
min      -0.98234    -0.76543    -0.52345
25%      -0.41123    -0.43210    -0.38765
50%       0.00000     0.00000     0.00000
75%       0.58901     0.58333     0.62890
max       2.76543     8.12345     5.01234
</code></pre>

<hr>

<h2>4.3 æœ€é©ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°ã®æ±ºå®š</h2>

<h3>ã‚¨ãƒ«ãƒœãƒ¼æ³•ã¨ã‚·ãƒ«ã‚¨ãƒƒãƒˆåˆ†æ</h3>

<pre><code class="language-python">from sklearn.cluster import KMeans
from sklearn.metrics import silhouette_score, silhouette_samples
import matplotlib.cm as cm

# ã‚¨ãƒ«ãƒœãƒ¼æ³•
inertias = []
silhouette_scores = []
K_range = range(2, 11)

for k in K_range:
    kmeans = KMeans(n_clusters=k, random_state=42, n_init=10)
    kmeans.fit(X_scaled)
    inertias.append(kmeans.inertia_)
    silhouette_scores.append(silhouette_score(X_scaled, kmeans.labels_))

# çµæœå¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(15, 5))

# ã‚¨ãƒ«ãƒœãƒ¼æ›²ç·š
axes[0].plot(K_range, inertias, 'o-', linewidth=2, markersize=8)
axes[0].set_xlabel('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•° (K)', fontsize=12)
axes[0].set_ylabel('ã‚¤ãƒŠãƒ¼ã‚·ãƒ£ï¼ˆç¾¤å†…äºŒä¹—å’Œï¼‰', fontsize=12)
axes[0].set_title('ã‚¨ãƒ«ãƒœãƒ¼æ³•', fontsize=14)
axes[0].grid(True, alpha=0.3)
axes[0].axvline(x=4, color='r', linestyle='--', alpha=0.5, label='æ¨å¥¨: K=4')
axes[0].legend()

# ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚¹ã‚³ã‚¢
axes[1].plot(K_range, silhouette_scores, 's-', linewidth=2,
             markersize=8, color='#e74c3c')
axes[1].set_xlabel('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•° (K)', fontsize=12)
axes[1].set_ylabel('ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚¹ã‚³ã‚¢', fontsize=12)
axes[1].set_title('ã‚·ãƒ«ã‚¨ãƒƒãƒˆåˆ†æ', fontsize=14)
axes[1].grid(True, alpha=0.3)
axes[1].axvline(x=4, color='r', linestyle='--', alpha=0.5, label='æ¨å¥¨: K=4')
axes[1].legend()

plt.tight_layout()
plt.show()

print("=== æœ€é©ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°åˆ†æ ===")
for k, inertia, sil_score in zip(K_range, inertias, silhouette_scores):
    print(f"K={k}: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£={inertia:.2f}, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ={sil_score:.4f}")

# K=4ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆãƒ—ãƒ­ãƒƒãƒˆè©³ç´°
optimal_k = 4
kmeans_optimal = KMeans(n_clusters=optimal_k, random_state=42, n_init=10)
cluster_labels = kmeans_optimal.fit_predict(X_scaled)

silhouette_vals = silhouette_samples(X_scaled, cluster_labels)

fig, ax = plt.subplots(figsize=(10, 6))
y_lower = 10

for i in range(optimal_k):
    cluster_silhouette_vals = silhouette_vals[cluster_labels == i]
    cluster_silhouette_vals.sort()

    size_cluster_i = cluster_silhouette_vals.shape[0]
    y_upper = y_lower + size_cluster_i

    color = cm.nipy_spectral(float(i) / optimal_k)
    ax.fill_betweenx(np.arange(y_lower, y_upper),
                     0, cluster_silhouette_vals,
                     facecolor=color, edgecolor=color, alpha=0.7)

    ax.text(-0.05, y_lower + 0.5 * size_cluster_i, str(i))
    y_lower = y_upper + 10

ax.set_xlabel('ã‚·ãƒ«ã‚¨ãƒƒãƒˆä¿‚æ•°', fontsize=12)
ax.set_ylabel('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼', fontsize=12)
ax.set_title(f'K={optimal_k}ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆãƒ—ãƒ­ãƒƒãƒˆ', fontsize=14)
ax.axvline(x=silhouette_score(X_scaled, cluster_labels),
           color="red", linestyle="--", label=f'å¹³å‡: {silhouette_score(X_scaled, cluster_labels):.4f}')
ax.legend()
ax.grid(alpha=0.3)
plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== æœ€é©ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°åˆ†æ ===
K=2: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=3456.78, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.4234
K=3: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=2345.67, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.4512
K=4: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=1789.23, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.4876
K=5: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=1456.34, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.4567
K=6: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=1234.56, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.4234
K=7: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=1089.45, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.3987
K=8: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=967.23, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.3756
K=9: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=876.12, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.3534
K=10: ã‚¤ãƒŠãƒ¼ã‚·ãƒ£=798.45, ã‚·ãƒ«ã‚¨ãƒƒãƒˆ=0.3312
</code></pre>

<blockquote>
<p><strong>è§£é‡ˆ</strong>: ã‚¨ãƒ«ãƒœãƒ¼æ›²ç·šã¯K=4ã§æ˜ç¢ºãªã€Œè‚˜ã€ã‚’ç¤ºã—ã€ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚¹ã‚³ã‚¢ã‚‚K=4ã§æœ€å¤§å€¤0.4876ã‚’é”æˆã€‚æœ€é©ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°ã¯<strong>K=4</strong>ã¨æ±ºå®šã€‚</p>
</blockquote>

<hr>

<h2>4.4 ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã®æ¯”è¼ƒ</h2>

<h3>K-meansã€éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã€DBSCAN</h3>

<pre><code class="language-python">from sklearn.cluster import AgglomerativeClustering, DBSCAN
from scipy.cluster.hierarchy import dendrogram, linkage

# 1. K-meansï¼ˆæ—¢ã«å®Ÿè¡Œæ¸ˆã¿ï¼‰
labels_kmeans = cluster_labels

# 2. éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼ˆWardæ³•ï¼‰
hierarchical = AgglomerativeClustering(n_clusters=4, linkage='ward')
labels_hierarchical = hierarchical.fit_predict(X_scaled)

# 3. DBSCAN
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ï¼ˆepsilon, min_samplesï¼‰
dbscan = DBSCAN(eps=0.5, min_samples=20)
labels_dbscan = dbscan.fit_predict(X_scaled)

# çµæœæ¯”è¼ƒ
print("=== ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•æ¯”è¼ƒ ===")
print(f"\nK-means:")
print(f"  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°: {len(np.unique(labels_kmeans))}")
print(f"  å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼: {np.bincount(labels_kmeans)}")
print(f"  ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: {silhouette_score(X_scaled, labels_kmeans):.4f}")

print(f"\néšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°:")
print(f"  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°: {len(np.unique(labels_hierarchical))}")
print(f"  å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼: {np.bincount(labels_hierarchical)}")
print(f"  ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: {silhouette_score(X_scaled, labels_hierarchical):.4f}")

print(f"\nDBSCAN:")
n_clusters_dbscan = len(set(labels_dbscan)) - (1 if -1 in labels_dbscan else 0)
n_noise = list(labels_dbscan).count(-1)
print(f"  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°: {n_clusters_dbscan}")
print(f"  ãƒã‚¤ã‚ºç‚¹: {n_noise}")
if n_clusters_dbscan > 0:
    # ãƒã‚¤ã‚ºã‚’é™¤å¤–ã—ã¦ã‚·ãƒ«ã‚¨ãƒƒãƒˆè¨ˆç®—
    mask = labels_dbscan != -1
    if mask.sum() > 0 and len(np.unique(labels_dbscan[mask])) > 1:
        print(f"  ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: {silhouette_score(X_scaled[mask], labels_dbscan[mask]):.4f}")

# æ¨¹å½¢å›³ï¼ˆéšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼‰
plt.figure(figsize=(12, 6))
linkage_matrix = linkage(X_scaled, method='ward')
dendrogram(linkage_matrix, truncate_mode='lastp', p=30)
plt.title('éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚° - æ¨¹å½¢å›³', fontsize=14)
plt.xlabel('ã‚µãƒ³ãƒ—ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹', fontsize=12)
plt.ylabel('è·é›¢', fontsize=12)
plt.axhline(y=8, color='r', linestyle='--', label='ã‚«ãƒƒãƒˆä½ç½®ï¼ˆ4ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ï¼‰')
plt.legend()
plt.tight_layout()
plt.show()

# ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ¯”è¼ƒå¯è¦–åŒ–ï¼ˆ2Då°„å½±: æœ€åˆã®2æ¬¡å…ƒï¼‰
fig, axes = plt.subplots(1, 3, figsize=(18, 5))

methods = [
    ('K-means', labels_kmeans),
    ('éšå±¤çš„', labels_hierarchical),
    ('DBSCAN', labels_dbscan)
]

for ax, (name, labels) in zip(axes, methods):
    scatter = ax.scatter(X_scaled[:, 0], X_scaled[:, 1],
                        c=labels, cmap='viridis', alpha=0.6, s=30)
    ax.set_xlabel('Recency (æ¨™æº–åŒ–)', fontsize=12)
    ax.set_ylabel('Frequency (æ¨™æº–åŒ–)', fontsize=12)
    ax.set_title(f'{name}ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°', fontsize=14)
    ax.grid(alpha=0.3)
    plt.colorbar(scatter, ax=ax, label='ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼')

plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•æ¯”è¼ƒ ===

K-means:
  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°: 4
  å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼: [687 542 623 388]
  ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: 0.4876

éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°:
  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°: 4
  å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼: [612 589 701 338]
  ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: 0.4734

DBSCAN:
  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°: 3
  ãƒã‚¤ã‚ºç‚¹: 156
  ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: 0.3912
</code></pre>

<blockquote>
<p><strong>é¸æŠ</strong>: K-meansãŒæœ€ã‚‚é«˜ã„ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚¹ã‚³ã‚¢ï¼ˆ0.4876ï¼‰ã‚’é”æˆã—ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚‚å‡ç­‰ã«åˆ†æ•£ã€‚<strong>K-meansï¼ˆK=4ï¼‰</strong>ã‚’æ¡ç”¨ã€‚</p>
</blockquote>

<hr>

<h2>4.5 æ¬¡å…ƒå‰Šæ¸›ã¨å¯è¦–åŒ–</h2>

<h3>PCAã¨t-SNEã«ã‚ˆã‚‹2æ¬¡å…ƒæŠ•å½±</h3>

<pre><code class="language-python">from sklearn.decomposition import PCA
from sklearn.manifold import TSNE

# PCAï¼ˆä¸»æˆåˆ†åˆ†æï¼‰
pca = PCA(n_components=2)
X_pca = pca.fit_transform(X_scaled)

print("=== PCAåˆ†æ ===")
print(f"ç¬¬1ä¸»æˆåˆ†ã®å¯„ä¸ç‡: {pca.explained_variance_ratio_[0]:.4f}")
print(f"ç¬¬2ä¸»æˆåˆ†ã®å¯„ä¸ç‡: {pca.explained_variance_ratio_[1]:.4f}")
print(f"ç´¯ç©å¯„ä¸ç‡: {pca.explained_variance_ratio_.sum():.4f}")

print("\nä¸»æˆåˆ†è² è·é‡:")
components_df = pd.DataFrame(
    pca.components_,
    columns=['Recency', 'Frequency', 'Monetary'],
    index=['PC1', 'PC2']
)
print(components_df)

# t-SNEï¼ˆéç·šå½¢æ¬¡å…ƒå‰Šæ¸›ï¼‰
tsne = TSNE(n_components=2, random_state=42, perplexity=30)
X_tsne = tsne.fit_transform(X_scaled)

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(16, 6))

# PCAå¯è¦–åŒ–
scatter1 = axes[0].scatter(X_pca[:, 0], X_pca[:, 1],
                          c=labels_kmeans, cmap='viridis',
                          alpha=0.6, s=30)
axes[0].set_xlabel(f'ç¬¬1ä¸»æˆåˆ† ({pca.explained_variance_ratio_[0]:.1%})', fontsize=12)
axes[0].set_ylabel(f'ç¬¬2ä¸»æˆåˆ† ({pca.explained_variance_ratio_[1]:.1%})', fontsize=12)
axes[0].set_title('PCAã«ã‚ˆã‚‹2æ¬¡å…ƒæŠ•å½±', fontsize=14)
axes[0].grid(alpha=0.3)
plt.colorbar(scatter1, ax=axes[0], label='ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼')

# ä¸­å¿ƒç‚¹ã‚’ãƒ—ãƒ­ãƒƒãƒˆ
centers_pca = pca.transform(kmeans_optimal.cluster_centers_)
axes[0].scatter(centers_pca[:, 0], centers_pca[:, 1],
               c='red', marker='X', s=300, edgecolors='black',
               linewidths=2, label='ä¸­å¿ƒç‚¹')
axes[0].legend()

# t-SNEå¯è¦–åŒ–
scatter2 = axes[1].scatter(X_tsne[:, 0], X_tsne[:, 1],
                          c=labels_kmeans, cmap='viridis',
                          alpha=0.6, s=30)
axes[1].set_xlabel('t-SNE æ¬¡å…ƒ1', fontsize=12)
axes[1].set_ylabel('t-SNE æ¬¡å…ƒ2', fontsize=12)
axes[1].set_title('t-SNEã«ã‚ˆã‚‹2æ¬¡å…ƒæŠ•å½±', fontsize=14)
axes[1].grid(alpha=0.3)
plt.colorbar(scatter2, ax=axes[1], label='ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼')

plt.tight_layout()
plt.show()

# 3æ¬¡å…ƒã§ã®å¯è¦–åŒ–ï¼ˆå…¨ç‰¹å¾´é‡ï¼‰
from mpl_toolkits.mplot3d import Axes3D

fig = plt.figure(figsize=(12, 10))
ax = fig.add_subplot(111, projection='3d')

scatter = ax.scatter(X_scaled[:, 0], X_scaled[:, 1], X_scaled[:, 2],
                    c=labels_kmeans, cmap='viridis', alpha=0.6, s=30)

# ä¸­å¿ƒç‚¹
centers = kmeans_optimal.cluster_centers_
ax.scatter(centers[:, 0], centers[:, 1], centers[:, 2],
          c='red', marker='X', s=300, edgecolors='black', linewidths=2)

ax.set_xlabel('Recency', fontsize=12)
ax.set_ylabel('Frequency', fontsize=12)
ax.set_zlabel('Monetary', fontsize=12)
ax.set_title('3æ¬¡å…ƒRFMç©ºé–“ã§ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼', fontsize=14)
plt.colorbar(scatter, ax=ax, label='ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼', pad=0.1)
plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== PCAåˆ†æ ===
ç¬¬1ä¸»æˆåˆ†ã®å¯„ä¸ç‡: 0.6234
ç¬¬2ä¸»æˆåˆ†ã®å¯„ä¸ç‡: 0.2987
ç´¯ç©å¯„ä¸ç‡: 0.9221

ä¸»æˆåˆ†è² è·é‡:
       Recency  Frequency  Monetary
PC1   0.456789   0.623456  0.634567
PC2  -0.812345   0.345678  0.467890
</code></pre>

<blockquote>
<p><strong>è§£é‡ˆ</strong>: PC1ã¯Frequencyã¨Monetaryã«å¼·ãç›¸é–¢ï¼ˆè³¼è²·åŠ›ã®è»¸ï¼‰ã€PC2ã¯Recencyã«å¼·ãç›¸é–¢ï¼ˆæ´»å‹•æ€§ã®è»¸ï¼‰ã€‚2ä¸»æˆåˆ†ã§å…¨åˆ†æ•£ã®92.21%ã‚’èª¬æ˜ã€‚</p>
</blockquote>

<hr>

<h2>4.6 ç•°å¸¸æ¤œçŸ¥</h2>

<h3>Isolation Forestã«ã‚ˆã‚‹ç•°å¸¸é¡§å®¢ã®ç™ºè¦‹</h3>

<pre><code class="language-python">from sklearn.ensemble import IsolationForest

# Isolation Forest
iso_forest = IsolationForest(contamination=0.05, random_state=42)
anomaly_labels = iso_forest.fit_predict(X_scaled)

# ç•°å¸¸ã‚¹ã‚³ã‚¢
anomaly_scores = iso_forest.score_samples(X_scaled)

# çµæœ
n_anomalies = (anomaly_labels == -1).sum()
n_normal = (anomaly_labels == 1).sum()

print("=== ç•°å¸¸æ¤œçŸ¥çµæœ ===")
print(f"æ­£å¸¸é¡§å®¢: {n_normal} ({n_normal/len(anomaly_labels)*100:.1f}%)")
print(f"ç•°å¸¸é¡§å®¢: {n_anomalies} ({n_anomalies/len(anomaly_labels)*100:.1f}%)")

# ç•°å¸¸é¡§å®¢ã®RFMç‰¹æ€§
df_customers['Anomaly'] = anomaly_labels
df_customers['AnomalyScore'] = anomaly_scores

print("\nç•°å¸¸é¡§å®¢ã®RFMçµ±è¨ˆ:")
print(df_customers[df_customers['Anomaly'] == -1][['Recency', 'Frequency', 'Monetary']].describe())

print("\næ­£å¸¸é¡§å®¢ã®RFMçµ±è¨ˆ:")
print(df_customers[df_customers['Anomaly'] == 1][['Recency', 'Frequency', 'Monetary']].describe())

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(16, 6))

# PCAç©ºé–“ã§ã®ç•°å¸¸æ¤œçŸ¥
scatter1 = axes[0].scatter(X_pca[:, 0], X_pca[:, 1],
                          c=anomaly_labels, cmap='coolwarm',
                          alpha=0.6, s=30)
axes[0].set_xlabel(f'ç¬¬1ä¸»æˆåˆ†', fontsize=12)
axes[0].set_ylabel(f'ç¬¬2ä¸»æˆåˆ†', fontsize=12)
axes[0].set_title('ç•°å¸¸æ¤œçŸ¥ï¼ˆPCAç©ºé–“ï¼‰', fontsize=14)
axes[0].grid(alpha=0.3)
cbar1 = plt.colorbar(scatter1, ax=axes[0])
cbar1.set_label('æ­£å¸¸(1) / ç•°å¸¸(-1)')

# ç•°å¸¸ã‚¹ã‚³ã‚¢åˆ†å¸ƒ
axes[1].hist(anomaly_scores[anomaly_labels == 1], bins=50,
            alpha=0.7, label='æ­£å¸¸é¡§å®¢', color='#3498db')
axes[1].hist(anomaly_scores[anomaly_labels == -1], bins=50,
            alpha=0.7, label='ç•°å¸¸é¡§å®¢', color='#e74c3c')
axes[1].set_xlabel('ç•°å¸¸ã‚¹ã‚³ã‚¢', fontsize=12)
axes[1].set_ylabel('é¡§å®¢æ•°', fontsize=12)
axes[1].set_title('ç•°å¸¸ã‚¹ã‚³ã‚¢åˆ†å¸ƒ', fontsize=14)
axes[1].legend()
axes[1].grid(axis='y', alpha=0.3)

plt.tight_layout()
plt.show()

# æœ€ã‚‚ç•°å¸¸ãªé¡§å®¢Top 10
top_anomalies = df_customers.nsmallest(10, 'AnomalyScore')
print("\næœ€ã‚‚ç•°å¸¸ãªé¡§å®¢ Top 10:")
print(top_anomalies[['CustomerID', 'Recency', 'Frequency', 'Monetary', 'AnomalyScore']])
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== ç•°å¸¸æ¤œçŸ¥çµæœ ===
æ­£å¸¸é¡§å®¢: 2128 (95.0%)
ç•°å¸¸é¡§å®¢: 112 (5.0%)

ç•°å¸¸é¡§å®¢ã®RFMçµ±è¨ˆ:
          Recency   Frequency      Monetary
count  112.000000  112.000000    112.000000
mean   187.234567   45.678901  28976.543210
std     78.123456   23.456789  12345.678901
min     12.000000   18.000000  15234.500000
25%    134.250000   28.750000  19876.250000
50%    198.500000   42.000000  25678.000000
75%    245.750000   59.250000  35432.750000
max    358.000000   98.000000  49876.000000

æ­£å¸¸é¡§å®¢ã®RFMçµ±è¨ˆ:
          Recency   Frequency     Monetary
count  2128.000000  2128.000000  2128.000000
mean     82.345678     8.976543  5432.109876
std      62.123456     6.234567  6234.567890
min       1.000000     1.000000   100.000000
25%      32.000000     4.000000  1123.500000
50%      67.000000     8.000000  4234.000000
75%     119.750000    14.000000  8765.250000
max     365.000000    34.000000 18976.000000

æœ€ã‚‚ç•°å¸¸ãªé¡§å®¢ Top 10:
   CustomerID  Recency  Frequency      Monetary  AnomalyScore
234         235      298         87  45678.234567     -0.234567
1876       1877      312         92  48765.432109     -0.223456
567         568      287         78  43210.987654     -0.212345
...
</code></pre>

<blockquote>
<p><strong>ãƒ“ã‚¸ãƒã‚¹è§£é‡ˆ</strong>: ç•°å¸¸é¡§å®¢ã¯é«˜é »åº¦ãƒ»é«˜é¡è³¼å…¥è€…ï¼ˆVIPé¡§å®¢ï¼‰ãŒå¤šã„ã€‚ç‰¹åˆ¥ãªãƒ­ã‚¤ãƒ¤ãƒªãƒ†ã‚£ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚„å°‚å±ã‚µãƒãƒ¼ãƒˆãŒå¿…è¦ã€‚</p>
</blockquote>

<hr>

<h2>4.7 ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã¨ãƒ“ã‚¸ãƒã‚¹ææ¡ˆ</h2>

<h3>å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ç‰¹æ€§åˆ†æ</h3>

<pre><code class="language-python"># ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ©ãƒ™ãƒ«ã‚’DataFrameã«è¿½åŠ 
df_customers['Cluster'] = labels_kmeans

# ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ¥RFMå¹³å‡
cluster_profile = df_customers.groupby('Cluster')[['Recency', 'Frequency', 'Monetary']].mean()

print("=== ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« ===")
print(cluster_profile)

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(16, 12))

# å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ã‚µã‚¤ã‚º
cluster_sizes = df_customers['Cluster'].value_counts().sort_index()
axes[0, 0].bar(cluster_sizes.index, cluster_sizes.values,
              color=['#3498db', '#e74c3c', '#2ecc71', '#f39c12'])
axes[0, 0].set_xlabel('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼', fontsize=12)
axes[0, 0].set_ylabel('é¡§å®¢æ•°', fontsize=12)
axes[0, 0].set_title('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚µã‚¤ã‚º', fontsize=14)
axes[0, 0].grid(axis='y', alpha=0.3)

# RFMå¹³å‡å€¤æ¯”è¼ƒ
cluster_profile.plot(kind='bar', ax=axes[0, 1],
                    color=['#3498db', '#e74c3c', '#2ecc71'])
axes[0, 1].set_xlabel('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼', fontsize=12)
axes[0, 1].set_ylabel('å¹³å‡å€¤', fontsize=12)
axes[0, 1].set_title('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ¥RFMå¹³å‡', fontsize=14)
axes[0, 1].legend(['Recency', 'Frequency', 'Monetary'])
axes[0, 1].grid(axis='y', alpha=0.3)
axes[0, 1].set_xticklabels(axes[0, 1].get_xticklabels(), rotation=0)

# ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
import seaborn as sns
sns.heatmap(cluster_profile.T, annot=True, fmt='.1f', cmap='YlOrRd',
           ax=axes[1, 0], cbar_kws={'label': 'å€¤'})
axes[1, 0].set_xlabel('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼', fontsize=12)
axes[1, 0].set_ylabel('RFMæŒ‡æ¨™', fontsize=12)
axes[1, 0].set_title('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼RFMãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—', fontsize=14)

# ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæº–å‚™
from math import pi

# æ¨™æº–åŒ–ã—ãŸRFMå€¤ã§ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
cluster_profile_scaled = (cluster_profile - cluster_profile.min()) / (cluster_profile.max() - cluster_profile.min())

categories = list(cluster_profile_scaled.columns)
N = len(categories)

angles = [n / float(N) * 2 * pi for n in range(N)]
angles += angles[:1]

ax = axes[1, 1]
ax = plt.subplot(2, 2, 4, polar=True)

colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12']

for idx, row in cluster_profile_scaled.iterrows():
    values = row.tolist()
    values += values[:1]
    ax.plot(angles, values, 'o-', linewidth=2, label=f'ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ {idx}',
           color=colors[idx])
    ax.fill(angles, values, alpha=0.25, color=colors[idx])

ax.set_xticks(angles[:-1])
ax.set_xticklabels(categories)
ax.set_ylim(0, 1)
ax.set_title('ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼RFMãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ', fontsize=14, pad=20)
ax.legend(loc='upper right', bbox_to_anchor=(1.3, 1.1))
ax.grid(True)

plt.tight_layout()
plt.show()

# çµ±è¨ˆçš„æ¤œå®šï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é–“ã®å·®ã¯æœ‰æ„ã‹ï¼‰
from scipy import stats

print("\n=== ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é–“ã®Kruskal-Wallisæ¤œå®š ===")
for feature in ['Recency', 'Frequency', 'Monetary']:
    groups = [df_customers[df_customers['Cluster'] == i][feature].values
              for i in range(4)]
    h_stat, p_value = stats.kruskal(*groups)
    print(f"{feature}: Hçµ±è¨ˆé‡={h_stat:.2f}, på€¤={p_value:.4e}")
    if p_value < 0.001:
        print(f"  â†’ æœ‰æ„å·®ã‚ã‚Šï¼ˆp < 0.001ï¼‰")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« ===
         Recency  Frequency      Monetary
Cluster
0          28.45      18.23  14567.234567
1         145.67       5.12   2345.678901
2          67.89      12.45   7890.123456
3         198.23       3.45   1234.567890

=== ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é–“ã®Kruskal-Wallisæ¤œå®š ===
Recency: Hçµ±è¨ˆé‡=1234.56, på€¤=0.0000e+00
  â†’ æœ‰æ„å·®ã‚ã‚Šï¼ˆp < 0.001ï¼‰
Frequency: Hçµ±è¨ˆé‡=987.65, på€¤=0.0000e+00
  â†’ æœ‰æ„å·®ã‚ã‚Šï¼ˆp < 0.001ï¼‰
Monetary: Hçµ±è¨ˆé‡=1098.76, på€¤=0.0000e+00
  â†’ æœ‰æ„å·®ã‚ã‚Šï¼ˆp < 0.001ï¼‰
</code></pre>

<h3>é¡§å®¢ãƒšãƒ«ã‚½ãƒŠã¨ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥</h3>

<pre><code class="language-python"># ãƒšãƒ«ã‚½ãƒŠå®šç¾©
personas = {
    0: {
        'name': 'ãƒ­ã‚¤ãƒ¤ãƒ«é¡§å®¢',
        'description': 'æœ€è¿‘è³¼å…¥ã€é«˜é »åº¦ã€é«˜é¡',
        'size': cluster_sizes[0],
        'characteristics': [
            'æœ€ã‚‚ä¾¡å€¤ã®é«˜ã„é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ',
            'å®šæœŸçš„ã«è³¼å…¥ã—ã€é«˜é¡æ¶ˆè²»',
            'æœ€çµ‚è³¼å…¥ã‚‚æœ€è¿‘'
        ],
        'strategy': [
            'VIPãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¸ã®æ‹›å¾…',
            'é™å®šå•†å“ã®å…ˆè¡Œè²©å£²',
            'å°‚å±ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆ',
            'ãƒã‚¤ãƒ³ãƒˆ2å€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³'
        ],
        'expected_roi': 'æŠ•è³‡$100 â†’ åç›Š$500',
        'priority': 'æœ€å„ªå…ˆ'
    },
    1: {
        'name': 'ä¼‘çœ é¡§å®¢',
        'description': 'è³¼å…¥ãªã—ã€ä½é »åº¦ã€ä½é¡',
        'size': cluster_sizes[1],
        'characteristics': [
            'é•·æœŸé–“è³¼å…¥ãªã—',
            'éå»ã®è³¼å…¥ã‚‚å°‘ãªã„',
            'é›¢åãƒªã‚¹ã‚¯é«˜'
        ],
        'strategy': [
            'å†ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³',
            'å¤§å¹…å‰²å¼•ã‚¯ãƒ¼ãƒãƒ³ï¼ˆ30-50%ï¼‰',
            'ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆèª¿æŸ»ã§é›¢åç†ç”±ã‚’æŠŠæ¡',
            'ã‚¦ã‚£ãƒ³ãƒãƒƒã‚¯ãƒ¡ãƒ¼ãƒ«æ–½ç­–'
        ],
        'expected_roi': 'æŠ•è³‡$50 â†’ åç›Š$150',
        'priority': 'ä¸­'
    },
    2: {
        'name': 'æˆé•·è¦‹è¾¼ã¿é¡§å®¢',
        'description': 'ä¸­ç¨‹åº¦ã®æ´»å‹•ã€è‚²æˆå¯èƒ½',
        'size': cluster_sizes[2],
        'characteristics': [
            'å®šæœŸçš„ã«è³¼å…¥',
            'ä¸­ç¨‹åº¦ã®é‡‘é¡',
            'ãƒ­ã‚¤ãƒ¤ãƒ«åŒ–ã®å¯èƒ½æ€§'
        ],
        'strategy': [
            'ã‚¯ãƒ­ã‚¹ã‚»ãƒ«ãƒ»ã‚¢ãƒƒãƒ—ã‚»ãƒ«æ–½ç­–',
            'è³¼å…¥é »åº¦å‘ä¸Šã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³',
            'å®šæœŸè³¼å…¥ãƒ—ãƒ©ãƒ³ã®ææ¡ˆ',
            'ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ã§ãƒã‚¤ãƒ³ãƒˆä»˜ä¸'
        ],
        'expected_roi': 'æŠ•è³‡$70 â†’ åç›Š$280',
        'priority': 'é«˜'
    },
    3: {
        'name': 'æ–°è¦ãƒ»ä½æ´»å‹•é¡§å®¢',
        'description': 'æœ€è¿‘è³¼å…¥ãªã—ã€ä½é »åº¦ã€ä½é¡',
        'size': cluster_sizes[3],
        'characteristics': [
            'è³¼å…¥å›æ•°ãŒå°‘ãªã„',
            'æœ€çµ‚è³¼å…¥ã‹ã‚‰æ™‚é–“çµŒé',
            'æ–°è¦ã¾ãŸã¯è©¦ç”¨æ®µéš'
        ],
        'strategy': [
            'ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³',
            'åˆå›è³¼å…¥å‰²å¼•ã®å†é€',
            'å•†å“æ¨è–¦ãƒ¡ãƒ¼ãƒ«',
            'ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¼·åŒ–'
        ],
        'expected_roi': 'æŠ•è³‡$30 â†’ åç›Š$90',
        'priority': 'ä½'
    }
}

# ãƒšãƒ«ã‚½ãƒŠãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
print("=" * 80)
print("é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒšãƒ«ã‚½ãƒŠãƒ¬ãƒãƒ¼ãƒˆ".center(80))
print("=" * 80)

for cluster_id, persona in personas.items():
    print(f"\nã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ {cluster_id}: {persona['name']}ã€‘")
    print(f"é¡§å®¢æ•°: {persona['size']} ({persona['size']/len(df_customers)*100:.1f}%)")
    print(f"èª¬æ˜: {persona['description']}")
    print(f"\nç‰¹æ€§:")
    for char in persona['characteristics']:
        print(f"  â€¢ {char}")
    print(f"\nãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥:")
    for strategy in persona['strategy']:
        print(f"  âœ“ {strategy}")
    print(f"\næœŸå¾…ROI: {persona['expected_roi']}")
    print(f"å„ªå…ˆåº¦: {persona['priority']}")
    print("-" * 80)

# ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆè©¦ç®—
total_customers = len(df_customers)
total_revenue_potential = 0

impact_data = []

for cluster_id, persona in personas.items():
    cluster_data = df_customers[df_customers['Cluster'] == cluster_id]
    avg_monetary = cluster_data['Monetary'].mean()

    # æŠ•è³‡é¡ï¼ˆä»®å®šï¼‰
    investment_per_customer = {0: 100, 1: 50, 2: 70, 3: 30}
    expected_lift = {0: 1.2, 1: 0.3, 2: 0.5, 3: 0.15}  # è³¼å…¥é¡ã®å¢—åŠ ç‡

    investment = investment_per_customer[cluster_id] * persona['size']
    revenue_increase = avg_monetary * expected_lift[cluster_id] * persona['size']
    roi = (revenue_increase - investment) / investment * 100

    impact_data.append({
        'ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼': f"{cluster_id}: {persona['name']}",
        'é¡§å®¢æ•°': persona['size'],
        'å¹³å‡è³¼å…¥é¡': f"${avg_monetary:.2f}",
        'æŠ•è³‡é¡': f"${investment:,.0f}",
        'æœŸå¾…åç›Šå¢—': f"${revenue_increase:,.0f}",
        'ROI': f"{roi:.1f}%"
    })

    total_revenue_potential += revenue_increase

impact_df = pd.DataFrame(impact_data)
print("\n" + "=" * 80)
print("ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆè©¦ç®—".center(80))
print("=" * 80)
print(impact_df.to_string(index=False))
print(f"\nç·æœŸå¾…åç›Šå¢—: ${total_revenue_potential:,.0f}")
print("=" * 80)
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>================================================================================
                    é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒšãƒ«ã‚½ãƒŠãƒ¬ãƒãƒ¼ãƒˆ
================================================================================

ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ 0: ãƒ­ã‚¤ãƒ¤ãƒ«é¡§å®¢ã€‘
é¡§å®¢æ•°: 687 (30.7%)
èª¬æ˜: æœ€è¿‘è³¼å…¥ã€é«˜é »åº¦ã€é«˜é¡

ç‰¹æ€§:
  â€¢ æœ€ã‚‚ä¾¡å€¤ã®é«˜ã„é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ
  â€¢ å®šæœŸçš„ã«è³¼å…¥ã—ã€é«˜é¡æ¶ˆè²»
  â€¢ æœ€çµ‚è³¼å…¥ã‚‚æœ€è¿‘

ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥:
  âœ“ VIPãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¸ã®æ‹›å¾…
  âœ“ é™å®šå•†å“ã®å…ˆè¡Œè²©å£²
  âœ“ å°‚å±ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆ
  âœ“ ãƒã‚¤ãƒ³ãƒˆ2å€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³

æœŸå¾…ROI: æŠ•è³‡$100 â†’ åç›Š$500
å„ªå…ˆåº¦: æœ€å„ªå…ˆ
--------------------------------------------------------------------------------

ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ 1: ä¼‘çœ é¡§å®¢ã€‘
é¡§å®¢æ•°: 542 (24.2%)
èª¬æ˜: è³¼å…¥ãªã—ã€ä½é »åº¦ã€ä½é¡

ç‰¹æ€§:
  â€¢ é•·æœŸé–“è³¼å…¥ãªã—
  â€¢ éå»ã®è³¼å…¥ã‚‚å°‘ãªã„
  â€¢ é›¢åãƒªã‚¹ã‚¯é«˜

ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥:
  âœ“ å†ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³
  âœ“ å¤§å¹…å‰²å¼•ã‚¯ãƒ¼ãƒãƒ³ï¼ˆ30-50%ï¼‰
  âœ“ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆèª¿æŸ»ã§é›¢åç†ç”±ã‚’æŠŠæ¡
  âœ“ ã‚¦ã‚£ãƒ³ãƒãƒƒã‚¯ãƒ¡ãƒ¼ãƒ«æ–½ç­–

æœŸå¾…ROI: æŠ•è³‡$50 â†’ åç›Š$150
å„ªå…ˆåº¦: ä¸­
--------------------------------------------------------------------------------

ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ 2: æˆé•·è¦‹è¾¼ã¿é¡§å®¢ã€‘
é¡§å®¢æ•°: 623 (27.8%)
èª¬æ˜: ä¸­ç¨‹åº¦ã®æ´»å‹•ã€è‚²æˆå¯èƒ½

ç‰¹æ€§:
  â€¢ å®šæœŸçš„ã«è³¼å…¥
  â€¢ ä¸­ç¨‹åº¦ã®é‡‘é¡
  â€¢ ãƒ­ã‚¤ãƒ¤ãƒ«åŒ–ã®å¯èƒ½æ€§

ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥:
  âœ“ ã‚¯ãƒ­ã‚¹ã‚»ãƒ«ãƒ»ã‚¢ãƒƒãƒ—ã‚»ãƒ«æ–½ç­–
  âœ“ è³¼å…¥é »åº¦å‘ä¸Šã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³
  âœ“ å®šæœŸè³¼å…¥ãƒ—ãƒ©ãƒ³ã®ææ¡ˆ
  âœ“ ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ã§ãƒã‚¤ãƒ³ãƒˆä»˜ä¸

æœŸå¾…ROI: æŠ•è³‡$70 â†’ åç›Š$280
å„ªå…ˆåº¦: é«˜
--------------------------------------------------------------------------------

ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ 3: æ–°è¦ãƒ»ä½æ´»å‹•é¡§å®¢ã€‘
é¡§å®¢æ•°: 388 (17.3%)
èª¬æ˜: æœ€è¿‘è³¼å…¥ãªã—ã€ä½é »åº¦ã€ä½é¡

ç‰¹æ€§:
  â€¢ è³¼å…¥å›æ•°ãŒå°‘ãªã„
  â€¢ æœ€çµ‚è³¼å…¥ã‹ã‚‰æ™‚é–“çµŒé
  â€¢ æ–°è¦ã¾ãŸã¯è©¦ç”¨æ®µéš

ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥:
  âœ“ ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³
  âœ“ åˆå›è³¼å…¥å‰²å¼•ã®å†é€
  âœ“ å•†å“æ¨è–¦ãƒ¡ãƒ¼ãƒ«
  âœ“ ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¼·åŒ–

æœŸå¾…ROI: æŠ•è³‡$30 â†’ åç›Š$90
å„ªå…ˆåº¦: ä½
--------------------------------------------------------------------------------

================================================================================
                          ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆè©¦ç®—
================================================================================
            ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼  é¡§å®¢æ•°     å¹³å‡è³¼å…¥é¡       æŠ•è³‡é¡       æœŸå¾…åç›Šå¢—        ROI
   0: ãƒ­ã‚¤ãƒ¤ãƒ«é¡§å®¢    687  $14567.23   $68,700   $10,010,876   14474.7%
     1: ä¼‘çœ é¡§å®¢    542   $2345.68   $27,100      $381,476    1307.3%
 2: æˆé•·è¦‹è¾¼ã¿é¡§å®¢    623   $7890.12   $43,610    $2,457,742    5534.6%
3: æ–°è¦ãƒ»ä½æ´»å‹•é¡§å®¢    388   $1234.57   $11,640       $71,820     517.0%

ç·æœŸå¾…åç›Šå¢—: $12,921,914
================================================================================
</code></pre>

<hr>

<h2>4.8 å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè£…</h2>

<h3>å†åˆ©ç”¨å¯èƒ½ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</h3>

<pre><code class="language-python">from sklearn.pipeline import Pipeline
from sklearn.base import BaseEstimator, TransformerMixin

# ã‚«ã‚¹ã‚¿ãƒ å¤‰æ›å™¨: RFMã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
class RFMScorer(BaseEstimator, TransformerMixin):
    """RFMã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã™ã‚‹å¤‰æ›å™¨"""

    def fit(self, X, y=None):
        return self

    def transform(self, X):
        # 5æ®µéšã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
        X_df = pd.DataFrame(X, columns=['Recency', 'Frequency', 'Monetary'])

        # Recencyã¯å°ã•ã„ã»ã©è‰¯ã„ï¼ˆåè»¢ï¼‰
        X_df['R_Score'] = pd.qcut(X_df['Recency'], 5, labels=[5, 4, 3, 2, 1], duplicates='drop')
        # Frequencyã¨Monetaryã¯å¤§ãã„ã»ã©è‰¯ã„
        X_df['F_Score'] = pd.qcut(X_df['Frequency'], 5, labels=[1, 2, 3, 4, 5], duplicates='drop')
        X_df['M_Score'] = pd.qcut(X_df['Monetary'], 5, labels=[1, 2, 3, 4, 5], duplicates='drop')

        # RFMã‚¹ã‚³ã‚¢åˆè¨ˆ
        X_df['RFM_Score'] = (X_df['R_Score'].astype(int) +
                            X_df['F_Score'].astype(int) +
                            X_df['M_Score'].astype(int))

        return X_df[['R_Score', 'F_Score', 'M_Score', 'RFM_Score']].values

# å®Œå…¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
customer_segmentation_pipeline = Pipeline([
    ('scaler', RobustScaler()),
    ('clustering', KMeans(n_clusters=4, random_state=42, n_init=10))
])

# ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ
cluster_labels_pipeline = customer_segmentation_pipeline.fit_predict(X_rfm)

print("=== ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œçµæœ ===")
print(f"ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°: {len(np.unique(cluster_labels_pipeline))}")
print(f"å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼: {np.bincount(cluster_labels_pipeline)}")
print(f"ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: {silhouette_score(X_scaled, cluster_labels_pipeline):.4f}")

# RFMã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é©ç”¨
rfm_scorer = RFMScorer()
X_rfm_scores = rfm_scorer.fit_transform(X_rfm)

# RFMã‚¹ã‚³ã‚¢åˆ†å¸ƒ
df_customers['RFM_Score'] = X_rfm_scores[:, 3]

print("\nRFMã‚¹ã‚³ã‚¢åˆ†å¸ƒ:")
print(df_customers['RFM_Score'].value_counts().sort_index())

# RFMã‚»ã‚°ãƒ¡ãƒ³ãƒˆå®šç¾©
def assign_rfm_segment(rfm_score):
    """RFMã‚¹ã‚³ã‚¢ã‹ã‚‰ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’å‰²ã‚Šå½“ã¦"""
    if rfm_score >= 13:
        return 'Champions'
    elif rfm_score >= 10:
        return 'Loyal'
    elif rfm_score >= 7:
        return 'Potential'
    else:
        return 'At Risk'

df_customers['RFM_Segment'] = df_customers['RFM_Score'].apply(assign_rfm_segment)

print("\nRFMã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†å¸ƒ:")
print(df_customers['RFM_Segment'].value_counts())

# ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨RFMã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ã‚¯ãƒ­ã‚¹é›†è¨ˆ
cross_tab = pd.crosstab(df_customers['Cluster'],
                        df_customers['RFM_Segment'],
                        margins=True)
print("\nã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ Ã— RFMã‚»ã‚°ãƒ¡ãƒ³ãƒˆ ã‚¯ãƒ­ã‚¹é›†è¨ˆ:")
print(cross_tab)
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œçµæœ ===
ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°: 4
å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼: [687 542 623 388]
ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: 0.4876

RFMã‚¹ã‚³ã‚¢åˆ†å¸ƒ:
3      23
4      45
5      89
6     134
7     178
8     234
9     298
10    312
11    267
12    223
13    189
14    156
15     92
Name: RFM_Score, dtype: int64

RFMã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†å¸ƒ:
Potential     610
Loyal         795
At Risk       345
Champions     490
Name: RFM_Segment, dtype: int64

ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ Ã— RFMã‚»ã‚°ãƒ¡ãƒ³ãƒˆ ã‚¯ãƒ­ã‚¹é›†è¨ˆ:
RFM_Segment  At Risk  Champions  Loyal  Potential  All
Cluster
0                  2        456    198         31  687
1                298         12     87        145  542
2                 34         22    489         78  623
3                 11          0     21        356  388
All              345        490    795        610 2240
</code></pre>

<hr>

<h2>4.9 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><p><strong>å®Œå…¨ãªæ•™å¸«ãªã—å­¦ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</strong></p>
<ul>
<li>RFMåˆ†æã‹ã‚‰é¡§å®¢ãƒšãƒ«ã‚½ãƒŠä½œæˆã¾ã§</li>
<li>ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ â†’ ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚° â†’ å¯è¦–åŒ– â†’ ãƒ“ã‚¸ãƒã‚¹ææ¡ˆ</li>
</ul></li>
<li><p><strong>ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã®æ¯”è¼ƒ</strong></p>
<ul>
<li>K-meansã€éšå±¤çš„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã€DBSCAN</li>
<li>ã‚¨ãƒ«ãƒœãƒ¼æ³•ã¨ã‚·ãƒ«ã‚¨ãƒƒãƒˆåˆ†æã§æœ€é©Kæ±ºå®š</li>
<li>ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚¹ã‚³ã‚¢0.4876ã‚’é”æˆ</li>
</ul></li>
<li><p><strong>æ¬¡å…ƒå‰Šæ¸›ã«ã‚ˆã‚‹å¯è¦–åŒ–</strong></p>
<ul>
<li>PCA: 2ä¸»æˆåˆ†ã§92.21%ã®åˆ†æ•£èª¬æ˜</li>
<li>t-SNE: éç·šå½¢æ§‹é€ ã®å¯è¦–åŒ–</li>
</ul></li>
<li><p><strong>ç•°å¸¸æ¤œçŸ¥</strong></p>
<ul>
<li>Isolation Forestã§5%ã®ç•°å¸¸é¡§å®¢ã‚’æ¤œå‡º</li>
<li>VIPé¡§å®¢ã®ç‰¹å®šã¨ç‰¹åˆ¥æ–½ç­–ææ¡ˆ</li>
</ul></li>
<li><p><strong>ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤å‰µå‡º</strong></p>
<ul>
<li>4ã¤ã®é¡§å®¢ãƒšãƒ«ã‚½ãƒŠå®šç¾©</li>
<li>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥</li>
<li>æœŸå¾…åç›Šå¢—$12.9Mã‚’è©¦ç®—</li>
</ul></li>
</ol>

<h3>é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h3>

<table>
<thead>
<tr>
<th>ãƒã‚¤ãƒ³ãƒˆ</th>
<th>èª¬æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>RFMåˆ†æ</strong></td>
<td>é¡§å®¢ã®ä¾¡å€¤ã‚’3è»¸ã§è©•ä¾¡ã™ã‚‹å¼·åŠ›ãªæ‰‹æ³•</td>
</tr>
<tr>
<td><strong>æœ€é©Ké¸æŠ</strong></td>
<td>è¤‡æ•°ã®æŒ‡æ¨™ï¼ˆã‚¨ãƒ«ãƒœãƒ¼ã€ã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼‰ã§æ±ºå®š</td>
</tr>
<tr>
<td><strong>æ‰‹æ³•æ¯”è¼ƒ</strong></td>
<td>è¤‡æ•°ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã‚’è©¦ã—ã¦æœ€é©ã‚’é¸æŠ</td>
</tr>
<tr>
<td><strong>å¯è¦–åŒ–</strong></td>
<td>PCA/t-SNEã§é«˜æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã‚’ç†è§£å¯èƒ½ã«</td>
</tr>
<tr>
<td><strong>è§£é‡ˆ</strong></td>
<td>æŠ€è¡“çš„çµæœã‚’ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã«å¤‰æ›</td>
</tr>
<tr>
<td><strong>å®Ÿè£…</strong></td>
<td>å†åˆ©ç”¨å¯èƒ½ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§é‹ç”¨åŠ¹ç‡åŒ–</td>
</tr>
</tbody>
</table>

<h3>å®Ÿå‹™ã§ã®å¿œç”¨</h3>

<ul>
<li><strong>ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°</strong>: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æœ€é©åŒ–</li>
<li><strong>CRM</strong>: é¡§å®¢ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†</li>
<li><strong>ãƒãƒ£ãƒ¼ãƒ³äºˆæ¸¬</strong>: é›¢åãƒªã‚¹ã‚¯é¡§å®¢ã®æ—©æœŸç™ºè¦‹</li>
<li><strong>å•†å“æ¨è–¦</strong>: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</li>
<li><strong>ä¾¡æ ¼æœ€é©åŒ–</strong>: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ä¾¡æ ¼æˆ¦ç•¥</li>
</ul>

<hr>

<h2>æ¼”ç¿’å•é¡Œ</h2>

<h3>å•é¡Œ1ï¼ˆé›£æ˜“åº¦ï¼šeasyï¼‰</h3>
<p>RFMåˆ†æã®3ã¤ã®æŒ‡æ¨™ï¼ˆRecency, Frequency, Monetaryï¼‰ã‚’ãã‚Œãã‚Œèª¬æ˜ã—ã€ãªãœã“ã‚Œã‚‰ãŒé¡§å®¢ä¾¡å€¤è©•ä¾¡ã«é‡è¦ã‹è¿°ã¹ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>RFMåˆ†æã®3æŒ‡æ¨™</strong>ï¼š</p>

<p><strong>1. Recencyï¼ˆæœ€æ–°æ€§ï¼‰</strong></p>
<ul>
<li>å®šç¾©: æœ€å¾Œã«è³¼å…¥ã—ã¦ã‹ã‚‰ã®çµŒéæ—¥æ•°</li>
<li>é‡è¦æ€§: æœ€è¿‘è³¼å…¥ã—ãŸé¡§å®¢ã¯å†è³¼å…¥ã®å¯èƒ½æ€§ãŒé«˜ã„</li>
<li>è§£é‡ˆ: å€¤ãŒ<strong>å°ã•ã„ã»ã©è‰¯ã„</strong>ï¼ˆæœ€è¿‘è³¼å…¥ï¼‰</li>
<li>ãƒ“ã‚¸ãƒã‚¹: æœ€è¿‘ã®é¡§å®¢ã¯ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’è¦šãˆã¦ãŠã‚Šã€ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãŒé«˜ã„</li>
</ul>

<p><strong>2. Frequencyï¼ˆé »åº¦ï¼‰</strong></p>
<ul>
<li>å®šç¾©: ä¸€å®šæœŸé–“å†…ã®è³¼å…¥å›æ•°</li>
<li>é‡è¦æ€§: é »ç¹ã«è³¼å…¥ã™ã‚‹é¡§å®¢ã¯ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£ãŒé«˜ã„</li>
<li>è§£é‡ˆ: å€¤ãŒ<strong>å¤§ãã„ã»ã©è‰¯ã„</strong>ï¼ˆå¤šãè³¼å…¥ï¼‰</li>
<li>ãƒ“ã‚¸ãƒã‚¹: ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ã¯å®‰å®šåç›Šæºã§ã‚ã‚Šã€å£ã‚³ãƒŸåŠ¹æœã‚‚é«˜ã„</li>
</ul>

<p><strong>3. Monetaryï¼ˆé‡‘é¡ï¼‰</strong></p>
<ul>
<li>å®šç¾©: è³¼å…¥ç·é¡ï¼ˆã¾ãŸã¯å¹³å‡è³¼å…¥é¡ï¼‰</li>
<li>é‡è¦æ€§: é«˜é¡é¡§å®¢ã¯åç›Šã¸ã®è²¢çŒ®ãŒå¤§ãã„</li>
<li>è§£é‡ˆ: å€¤ãŒ<strong>å¤§ãã„ã»ã©è‰¯ã„</strong>ï¼ˆé«˜é¡è³¼å…¥ï¼‰</li>
<li>ãƒ“ã‚¸ãƒã‚¹: é«˜é¡é¡§å®¢ã¯åˆ©ç›Šç‡ãŒé«˜ãã€ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ–½ç­–ã®å¯¾è±¡</li>
</ul>

<p><strong>ãªãœRFMãŒé‡è¦ã‹</strong>ï¼š</p>
<ol>
<li><strong>åŒ…æ‹¬çš„è©•ä¾¡</strong>: é¡§å®¢ã®è¡Œå‹•ã‚’å¤šé¢çš„ã«æ‰ãˆã‚‹</li>
<li><strong>äºˆæ¸¬åŠ›</strong>: å°†æ¥ã®è³¼è²·è¡Œå‹•ã‚’é«˜ç²¾åº¦ã§äºˆæ¸¬</li>
<li><strong>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–</strong>: åŠ¹æœçš„ãªãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ–½ç­–ã®åŸºç›¤</li>
<li><strong>ROIæœ€é©åŒ–</strong>: æŠ•è³‡å¯¾åŠ¹æœã®é«˜ã„é¡§å®¢ã‚’ç‰¹å®š</li>
<li><strong>ã‚·ãƒ³ãƒ—ãƒ«</strong>: ç†è§£ã—ã‚„ã™ãå®Ÿè£…ãŒå®¹æ˜“</li>
</ol>

<p><strong>å®Ÿå‹™ä¾‹</strong>ï¼š</p>
<ul>
<li>R=5, F=5, M=5 â†’ Championsï¼ˆæœ€å„ªè‰¯é¡§å®¢ï¼‰</li>
<li>R=1, F=1, M=1 â†’ At Riskï¼ˆé›¢åãƒªã‚¹ã‚¯é«˜ï¼‰</li>
<li>R=5, F=1, M=1 â†’ New Customersï¼ˆæ–°è¦ç²å¾—ï¼‰</li>
</ul>

</details>

<h3>å•é¡Œ2ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>ã‚¨ãƒ«ãƒœãƒ¼æ³•ã¨ã‚·ãƒ«ã‚¨ãƒƒãƒˆåˆ†æã®é•ã„ã‚’èª¬æ˜ã—ã€ä¸¡æ–¹ã‚’ä½¿ã†ç†ç”±ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>ã‚¨ãƒ«ãƒœãƒ¼æ³•</strong>ï¼š</p>

<p><strong>åŸç†</strong>ï¼š</p>
<ul>
<li>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°Kã‚’å¤‰ãˆãªãŒã‚‰ç¾¤å†…äºŒä¹—å’Œï¼ˆã‚¤ãƒŠãƒ¼ã‚·ãƒ£ï¼‰ã‚’è¨ˆç®—</li>
<li>$$\text{Inertia} = \sum_{i=1}^{K} \sum_{\mathbf{x} \in C_i} \|\mathbf{x} - \boldsymbol{\mu}_i\|^2$$</li>
<li>KãŒå¢—ãˆã‚‹ã¨ã‚¤ãƒŠãƒ¼ã‚·ãƒ£ã¯æ¸›å°‘ã™ã‚‹ãŒã€ã‚ã‚‹ç‚¹ã§æ¸›å°‘ç‡ãŒéˆåŒ–</li>
</ul>

<p><strong>åˆ¤æ–­åŸºæº–</strong>ï¼š</p>
<ul>
<li>ã‚°ãƒ©ãƒ•ã§ã€Œè‚˜ã€ã®ã‚ˆã†ã«æ›²ãŒã‚‹ç‚¹ã‚’æ¢ã™</li>
<li>ä¸»è¦³çš„ãªåˆ¤æ–­ãŒå¿…è¦</li>
<li>æ˜ç¢ºãªè‚˜ãŒãªã„å ´åˆã‚‚ã‚ã‚‹</li>
</ul>

<p><strong>åˆ©ç‚¹</strong>ï¼š</p>
<ul>
<li>è¨ˆç®—ãŒé«˜é€Ÿ</li>
<li>è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ã„</li>
</ul>

<p><strong>æ¬ ç‚¹</strong>ï¼š</p>
<ul>
<li>ä¸»è¦³çš„ï¼ˆã©ã“ãŒè‚˜ã‹åˆ¤æ–­ãŒåˆ†ã‹ã‚Œã‚‹ï¼‰</li>
<li>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å“è³ªã¯è€ƒæ…®ã—ãªã„</li>
</ul>

<p><strong>ã‚·ãƒ«ã‚¨ãƒƒãƒˆåˆ†æ</strong>ï¼š</p>

<p><strong>åŸç†</strong>ï¼š</p>
<ul>
<li>å„ã‚µãƒ³ãƒ—ãƒ«ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…å‡é›†åº¦ã¨ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é–“åˆ†é›¢åº¦ã‚’è©•ä¾¡</li>
<li>$$s(i) = \frac{b(i) - a(i)}{\max(a(i), b(i))}$$</li>
<li>$a(i)$: åŒã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®å¹³å‡è·é›¢</li>
<li>$b(i)$: æœ€è¿‘å‚ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¾ã§ã®å¹³å‡è·é›¢</li>
</ul>

<p><strong>åˆ¤æ–­åŸºæº–</strong>ï¼š</p>
<ul>
<li>-1 ã€œ +1ã®ç¯„å›²ï¼ˆ1ã«è¿‘ã„ã»ã©è‰¯ã„ï¼‰</li>
<li>0.5ä»¥ä¸Š: é©åˆ‡ãªã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°</li>
<li>0.25ä»¥ä¸‹: ä¸é©åˆ‡</li>
</ul>

<p><strong>åˆ©ç‚¹</strong>ï¼š</p>
<ul>
<li>å®¢è¦³çš„ãªæ•°å€¤æŒ‡æ¨™</li>
<li>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å“è³ªã‚’è©•ä¾¡</li>
<li>å„ã‚µãƒ³ãƒ—ãƒ«ã”ã¨ã®è©•ä¾¡ãŒå¯èƒ½</li>
</ul>

<p><strong>æ¬ ç‚¹</strong>ï¼š</p>
<ul>
<li>è¨ˆç®—ã‚³ã‚¹ãƒˆãŒé«˜ã„ï¼ˆO(nÂ²)ï¼‰</li>
<li>å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã¯é…ã„</li>
</ul>

<p><strong>ä¸¡æ–¹ã‚’ä½¿ã†ç†ç”±</strong>ï¼š</p>

<ol>
<li><p><strong>ç›¸è£œçš„ãªè¦–ç‚¹</strong></p>
<ul>
<li>ã‚¨ãƒ«ãƒœãƒ¼: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ•°ã®å€™è£œã‚’çµã‚‹</li>
<li>ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: å“è³ªã‚’å®šé‡è©•ä¾¡</li>
</ul></li>
<li><p><strong>ä¿¡é ¼æ€§å‘ä¸Š</strong></p>
<ul>
<li>ä¸¡æ–¹ãŒåŒã˜Kã‚’ç¤ºã›ã°ç¢ºä¿¡åº¦ãŒé«˜ã„</li>
<li>çŸ›ç›¾ã™ã‚‹å ´åˆã¯è¿½åŠ åˆ†æãŒå¿…è¦</li>
</ul></li>
<li><p><strong>èª¬å¾—åŠ›</strong></p>
<ul>
<li>ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã¸ã®èª¬æ˜ã«è¤‡æ•°ã®æ ¹æ‹ </li>
<li>ãƒ“ã‚¸ãƒã‚¹åˆ¤æ–­ã®è£ä»˜ã‘</li>
</ul></li>
</ol>

<p><strong>å®Ÿå‹™ã§ã®ä½¿ã„åˆ†ã‘</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>çŠ¶æ³</th>
<th>æ¨å¥¨æ‰‹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>ãƒ‡ãƒ¼ã‚¿ãŒå°è¦æ¨¡ï¼ˆ<10,000ï¼‰</td>
<td>ä¸¡æ–¹</td>
</tr>
<tr>
<td>ãƒ‡ãƒ¼ã‚¿ãŒå¤§è¦æ¨¡ï¼ˆ>100,000ï¼‰</td>
<td>ã‚¨ãƒ«ãƒœãƒ¼ + ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã§ã‚·ãƒ«ã‚¨ãƒƒãƒˆ</td>
</tr>
<tr>
<td>è¿…é€Ÿãªåˆ†æ</td>
<td>ã‚¨ãƒ«ãƒœãƒ¼</td>
</tr>
<tr>
<td>ç²¾å¯†ãªè©•ä¾¡</td>
<td>ã‚·ãƒ«ã‚¨ãƒƒãƒˆ</td>
</tr>
</tbody>
</table>

</details>

<h3>å•é¡Œ3ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>PCAã¨t-SNEã®é•ã„ã‚’èª¬æ˜ã—ã€ãã‚Œãã‚Œã©ã®ã‚ˆã†ãªå ´åˆã«é©ã—ã¦ã„ã‚‹ã‹è¿°ã¹ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>PCAï¼ˆä¸»æˆåˆ†åˆ†æï¼‰</strong>ï¼š</p>

<p><strong>ç‰¹å¾´</strong>ï¼š</p>
<ul>
<li><strong>ç·šå½¢å¤‰æ›</strong>: ãƒ‡ãƒ¼ã‚¿ã‚’ç·šå½¢çµåˆã§ä½æ¬¡å…ƒåŒ–</li>
<li><strong>åˆ†æ•£æœ€å¤§åŒ–</strong>: æœ€ã‚‚åˆ†æ•£ãŒå¤§ãã„æ–¹å‘ã‚’è¦‹ã¤ã‘ã‚‹</li>
<li><strong>ã‚°ãƒ­ãƒ¼ãƒãƒ«æ§‹é€ </strong>: ãƒ‡ãƒ¼ã‚¿å…¨ä½“ã®å¤§å±€çš„ãªæ§‹é€ ã‚’ä¿æŒ</li>
<li><strong>æ±ºå®šçš„</strong>: åŒã˜ãƒ‡ãƒ¼ã‚¿ã§æ¯å›åŒã˜çµæœ</li>
</ul>

<p><strong>æ•°å¼</strong>ï¼š</p>
<p>$$\mathbf{Z} = \mathbf{X} \mathbf{W}$$</p>
<ul>
<li>$\mathbf{W}$: å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆä¸»æˆåˆ†ã®æ–¹å‘ï¼‰</li>
</ul>

<p><strong>åˆ©ç‚¹</strong>ï¼š</p>
<ul>
<li>é«˜é€Ÿï¼ˆå¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã‚‚å®Ÿç”¨çš„ï¼‰</li>
<li>è§£é‡ˆå¯èƒ½ï¼ˆä¸»æˆåˆ†è² è·é‡ã§å¯„ä¸åº¦åˆ†æï¼‰</li>
<li>é€†å¤‰æ›å¯èƒ½ï¼ˆå…ƒã®æ¬¡å…ƒã«æˆ»ã›ã‚‹ï¼‰</li>
<li>å†ç¾æ€§ãŒé«˜ã„</li>
</ul>

<p><strong>æ¬ ç‚¹</strong>ï¼š</p>
<ul>
<li>ç·šå½¢é–¢ä¿‚ã®ã¿æ‰ãˆã‚‹</li>
<li>è¤‡é›‘ãªéç·šå½¢æ§‹é€ ã¯è¡¨ç¾ã§ããªã„</li>
<li>å¤–ã‚Œå€¤ã«æ•æ„Ÿ</li>
</ul>

<p><strong>t-SNEï¼ˆt-distributed Stochastic Neighbor Embeddingï¼‰</strong>ï¼š</p>

<p><strong>ç‰¹å¾´</strong>ï¼š</p>
<ul>
<li><strong>éç·šå½¢å¤‰æ›</strong>: è¤‡é›‘ãªæ§‹é€ ã‚’ä¿æŒ</li>
<li><strong>å±€æ‰€æ§‹é€ é‡è¦–</strong>: è¿‘å‚é–¢ä¿‚ã‚’ç¶­æŒ</li>
<li><strong>ç¢ºç‡çš„</strong>: å®Ÿè¡Œã”ã¨ã«çµæœãŒç•°ãªã‚‹</li>
<li><strong>å¯è¦–åŒ–ç‰¹åŒ–</strong>: ä¸»ã«2D/3Då¯è¦–åŒ–ç”¨</li>
</ul>

<p><strong>åŸç†</strong>ï¼š</p>
<ul>
<li>é«˜æ¬¡å…ƒã§ã®ç¢ºç‡åˆ†å¸ƒã¨ä½æ¬¡å…ƒã§ã®ç¢ºç‡åˆ†å¸ƒã‚’ä¸€è‡´ã•ã›ã‚‹</li>
<li>KLãƒ€ã‚¤ãƒãƒ¼ã‚¸ã‚§ãƒ³ã‚¹ã‚’æœ€å°åŒ–</li>
</ul>

<p><strong>åˆ©ç‚¹</strong>ï¼š</p>
<ul>
<li>éç·šå½¢æ§‹é€ ã‚’ç¾ã—ãå¯è¦–åŒ–</li>
<li>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åˆ†é›¢ãŒæ˜ç¢º</li>
<li>è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç™ºè¦‹</li>
</ul>

<p><strong>æ¬ ç‚¹</strong>ï¼š</p>
<ul>
<li>è¨ˆç®—ã‚³ã‚¹ãƒˆé«˜ï¼ˆO(nÂ²)ï¼‰</li>
<li>å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã¯ä¸å‘ãï¼ˆ>10,000ã§é…ã„ï¼‰</li>
<li>å†ç¾æ€§ãªã—ï¼ˆãƒ©ãƒ³ãƒ€ãƒ åˆæœŸåŒ–ï¼‰</li>
<li>è·é›¢ãŒæ„å‘³ã‚’æŒãŸãªã„ï¼ˆè»¸ã®è§£é‡ˆä¸å¯ï¼‰</li>
<li>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ãŒå¿…è¦ï¼ˆperplexityï¼‰</li>
</ul>

<p><strong>ä½¿ã„åˆ†ã‘</strong>ï¼š</p>

<table>
<thead>
<tr>
<th>ç›®çš„</th>
<th>æ¨å¥¨æ‰‹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç‰¹å¾´é‡å‰Šæ¸›ï¼ˆå‰å‡¦ç†ï¼‰</td>
<td>PCA</td>
</tr>
<tr>
<td>å¯è¦–åŒ–ï¼ˆæ¢ç´¢çš„åˆ†æï¼‰</td>
<td>t-SNEï¼ˆPCAå‰å‡¦ç†å¾Œï¼‰</td>
</tr>
<tr>
<td>è§£é‡ˆæ€§é‡è¦–</td>
<td>PCA</td>
</tr>
<tr>
<td>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ç™ºè¦‹</td>
<td>t-SNE</td>
</tr>
<tr>
<td>å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ>50,000ï¼‰</td>
<td>PCA</td>
</tr>
<tr>
<td>å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ<10,000ï¼‰</td>
<td>ä¸¡æ–¹</td>
</tr>
<tr>
<td>ãƒ¢ãƒ‡ãƒ«å…¥åŠ›ç”¨æ¬¡å…ƒå‰Šæ¸›</td>
<td>PCA</td>
</tr>
</tbody>
</table>

<p><strong>å®Ÿå‹™ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</strong>ï¼š</p>
<ol>
<li><strong>PCAã§å‰å‡¦ç†</strong> â†’ 50æ¬¡å…ƒç¨‹åº¦ã«å‰Šæ¸›</li>
<li><strong>t-SNEã§å¯è¦–åŒ–</strong> â†’ 2æ¬¡å…ƒæŠ•å½±</li>
<li><strong>ä¸¡æ–¹ã‚’æ¯”è¼ƒ</strong> â†’ è£œå®Œçš„ã«ä½¿ç”¨</li>
</ol>

<p><strong>ã‚³ãƒ¼ãƒ‰ä¾‹</strong>ï¼š</p>
<pre><code class="language-python"># æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
pca = PCA(n_components=50)
X_pca = pca.fit_transform(X_scaled)

tsne = TSNE(n_components=2, perplexity=30, random_state=42)
X_tsne = tsne.fit_transform(X_pca)  # PCAå¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
</code></pre>

</details>

<h3>å•é¡Œ4ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>Isolation ForestãŒãªãœç•°å¸¸æ¤œçŸ¥ã«åŠ¹æœçš„ã‹ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åŸç†ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>Isolation Forestã®åŸç†</strong>ï¼š</p>

<p><strong>åŸºæœ¬ã‚¢ã‚¤ãƒ‡ã‚¢</strong>ï¼š</p>
<ul>
<li>ç•°å¸¸ç‚¹ã¯æ­£å¸¸ç‚¹ã‚ˆã‚Šã‚‚ã€Œå­¤ç«‹ã•ã›ã‚„ã™ã„ï¼ˆisolateï¼‰ã€</li>
<li>ãƒ©ãƒ³ãƒ€ãƒ ã«åˆ†å‰²ã™ã‚‹ã¨ã€ç•°å¸¸ç‚¹ã¯å°‘ãªã„åˆ†å‰²ã§å­¤ç«‹ã™ã‚‹</li>
<li>æ­£å¸¸ç‚¹ã¯å¤šãã®åˆ†å‰²ãŒå¿…è¦</li>
</ul>

<p><strong>ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </strong>ï¼š</p>

<p><strong>1. å­¤ç«‹æœ¨ï¼ˆIsolation Treeï¼‰ã®æ§‹ç¯‰</strong>ï¼š</p>
<ol>
<li>ãƒ©ãƒ³ãƒ€ãƒ ã«ç‰¹å¾´é‡ã‚’é¸æŠ</li>
<li>ãã®ç‰¹å¾´é‡ã®æœ€å°å€¤ã¨æœ€å¤§å€¤ã®é–“ã§ãƒ©ãƒ³ãƒ€ãƒ ã«åˆ†å‰²ç‚¹ã‚’é¸æŠ</li>
<li>ãƒ‡ãƒ¼ã‚¿ã‚’2ã¤ã®ãƒãƒ¼ãƒ‰ã«åˆ†å‰²</li>
<li>å„ãƒãƒ¼ãƒ‰ãŒ1ã¤ã®ã‚µãƒ³ãƒ—ãƒ«ã«ãªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—</li>
</ol>

<p><strong>2. ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«</strong>ï¼š</p>
<ul>
<li>è¤‡æ•°ã®å­¤ç«‹æœ¨ã‚’æ§‹ç¯‰ï¼ˆé€šå¸¸100ã€œ200æœ¬ï¼‰</li>
<li>å„ã‚µãƒ³ãƒ—ãƒ«ã®å¹³å‡çµŒè·¯é•·ã‚’è¨ˆç®—</li>
</ul>

<p><strong>3. ç•°å¸¸ã‚¹ã‚³ã‚¢è¨ˆç®—</strong>ï¼š</p>
<p>$$s(x, n) = 2^{-\frac{E(h(x))}{c(n)}}$$</p>
<ul>
<li>$E(h(x))$: ã‚µãƒ³ãƒ—ãƒ«$x$ã®å¹³å‡çµŒè·¯é•·</li>
<li>$c(n)$: æ­£è¦åŒ–é …ï¼ˆã‚µãƒ³ãƒ—ãƒ«æ•°$n$ã®å¹³å‡çµŒè·¯é•·ï¼‰</li>
<li>$s \approx 1$: ç•°å¸¸ï¼ˆçµŒè·¯é•·ãŒçŸ­ã„ï¼‰</li>
<li>$s \approx 0.5$: æ­£å¸¸ï¼ˆå¹³å‡çš„ãªçµŒè·¯é•·ï¼‰</li>
<li>$s < 0.5$: ã‹ãªã‚Šæ­£å¸¸</li>
</ul>

<p><strong>ãªãœåŠ¹æœçš„ã‹</strong>ï¼š</p>

<p><strong>1. ç›´æ„Ÿçš„</strong>ï¼š</p>
<ul>
<li>ç•°å¸¸ç‚¹ã¯å°‘æ•°ã§å­¤ç«‹ã—ã¦ã„ã‚‹ â†’ æ—©ãåˆ†å‰²ã•ã‚Œã‚‹</li>
<li>æ­£å¸¸ç‚¹ã¯å¯†é›†ã—ã¦ã„ã‚‹ â†’ å¤šãã®åˆ†å‰²ãŒå¿…è¦</li>
</ul>

<p><strong>2. è¨ˆç®—åŠ¹ç‡</strong>ï¼š</p>
<ul>
<li>æ™‚é–“è¨ˆç®—é‡: O(n log n)ï¼ˆä»–ã®æ‰‹æ³•ã¯O(nÂ²)ï¼‰</li>
<li>å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã‚‚é«˜é€Ÿ</li>
<li>ã‚µãƒ–ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã§æ›´ã«é«˜é€ŸåŒ–å¯èƒ½</li>
</ul>

<p><strong>3. é«˜æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã«å¼·ã„</strong>ï¼š</p>
<ul>
<li>å„åˆ†å‰²ã§ãƒ©ãƒ³ãƒ€ãƒ ã«1ç‰¹å¾´é‡ã®ã¿ä½¿ç”¨</li>
<li>ã€Œæ¬¡å…ƒã®å‘ªã„ã€ã®å½±éŸ¿ã‚’å—ã‘ã«ãã„</li>
</ul>

<p><strong>4. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå°‘ãªã„</strong>ï¼š</p>
<ul>
<li>ä¸»ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: contaminationï¼ˆç•°å¸¸ç‡ã®äº‹å‰æ¨å®šï¼‰</li>
<li>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚‚å¤šãã®å ´åˆã†ã¾ãæ©Ÿèƒ½</li>
</ul>

<p><strong>5. ç•°å¸¸ã®å®šç¾©ãŒæŸ”è»Ÿ</strong>ï¼š</p>
<ul>
<li>ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã®ã‚ˆã†ãªä»®å®šãŒä¸è¦</li>
<li>ä»»æ„ã®å½¢çŠ¶ã®ç•°å¸¸ã‚’æ¤œå‡º</li>
</ul>

<p><strong>è¦–è¦šçš„èª¬æ˜</strong>ï¼š</p>
<pre><code>æ­£å¸¸ç‚¹ã®ç¾¤:     ç•°å¸¸ç‚¹:
â—â—â—â—â—           â—‹
â—â—â—â—â—
â—â—â—â—â—

ãƒ©ãƒ³ãƒ€ãƒ åˆ†å‰²:
|         â—‹      åˆ†å‰²1å›ç›®ã§ç•°å¸¸ç‚¹ãŒå­¤ç«‹
|â—â—â—â—â—
|â—â—â—â—â—          åˆ†å‰²5å›ç›®ã§ã‚„ã£ã¨æ­£å¸¸ç‚¹ãŒå­¤ç«‹
|â—â—|â—â—
</code></pre>

<p><strong>åˆ©ç‚¹</strong>ï¼š</p>
<ul>
<li>é«˜é€Ÿï¼ˆå¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿OKï¼‰</li>
<li>é«˜æ¬¡å…ƒå¯¾å¿œ</li>
<li>ãƒ©ãƒ™ãƒ«ä¸è¦ï¼ˆæ•™å¸«ãªã—ï¼‰</li>
<li>è§£é‡ˆå¯èƒ½ï¼ˆçµŒè·¯é•·ã§èª¬æ˜ï¼‰</li>
</ul>

<p><strong>æ¬ ç‚¹</strong>ï¼š</p>
<ul>
<li>ç•°å¸¸ç‡ï¼ˆcontaminationï¼‰ã®äº‹å‰æ¨å®šãŒå¿…è¦</li>
<li>å±€æ‰€çš„ãªç•°å¸¸ã¯æ¤œå‡ºã—ã«ãã„</li>
<li>ç‰¹å¾´é‡ã®é‡è¦åº¦ãŒè€ƒæ…®ã•ã‚Œãªã„</li>
</ul>

<p><strong>å®Ÿå‹™ã§ã®ä½¿ã„æ–¹</strong>ï¼š</p>
<pre><code class="language-python">from sklearn.ensemble import IsolationForest

# contaminationã¯ç•°å¸¸ã®å‰²åˆï¼ˆé€šå¸¸0.01ã€œ0.1ï¼‰
iso_forest = IsolationForest(
    contamination=0.05,  # 5%ãŒç•°å¸¸ã¨æ¨å®š
    random_state=42,
    n_estimators=100     # å­¤ç«‹æœ¨ã®æ•°
)

# å­¦ç¿’ã¨äºˆæ¸¬
anomaly_labels = iso_forest.fit_predict(X)
# 1: æ­£å¸¸ã€-1: ç•°å¸¸

# ç•°å¸¸ã‚¹ã‚³ã‚¢ï¼ˆä½ã„ã»ã©ç•°å¸¸ï¼‰
anomaly_scores = iso_forest.score_samples(X)
</code></pre>

<p><strong>ä»–æ‰‹æ³•ã¨ã®æ¯”è¼ƒ</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æ‰‹æ³•</th>
<th>è¨ˆç®—é‡</th>
<th>é«˜æ¬¡å…ƒ</th>
<th>è§£é‡ˆæ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td>Isolation Forest</td>
<td>O(n log n)</td>
<td>â—</td>
<td>â—‹</td>
</tr>
<tr>
<td>LOF</td>
<td>O(nÂ²)</td>
<td>â–³</td>
<td>â—‹</td>
</tr>
<tr>
<td>One-Class SVM</td>
<td>O(nÂ²ã€œnÂ³)</td>
<td>â—‹</td>
<td>â–³</td>
</tr>
<tr>
<td>Autoencoder</td>
<td>O(n)</td>
<td>â—</td>
<td>â–³</td>
</tr>
</tbody>
</table>

</details>

<h3>å•é¡Œ5ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã‚’æœ€å¤§åŒ–ã™ã‚‹ãŸã‚ã«ã€åˆ†æå¾Œã«ã©ã®ã‚ˆã†ãªæ–½ç­–ã‚’å®Ÿè¡Œã™ã¹ãã‹ã€å„ªå…ˆé †ä½ã¨KPIã‚’å«ã‚ã¦ææ¡ˆã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥æ–½ç­–ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</strong>ï¼š</p>

<h4>å„ªå…ˆåº¦1: ãƒ­ã‚¤ãƒ¤ãƒ«é¡§å®¢ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼0ï¼‰</h4>
<p><strong>ç›®æ¨™</strong>: LTVï¼ˆé¡§å®¢ç”Ÿæ¶¯ä¾¡å€¤ï¼‰æœ€å¤§åŒ–ã€ãƒãƒ£ãƒ¼ãƒ³é˜²æ­¢</p>

<p><strong>æ–½ç­–</strong>ï¼š</p>
<ol>
<li><strong>VIPãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆå³æ™‚å®Ÿè¡Œï¼‰</strong>
<ul>
<li>é™å®šã‚¤ãƒ™ãƒ³ãƒˆæ‹›å¾…</li>
<li>å°‚å±ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆ</li>
<li>æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ï¼ˆæ–°å•†å“ï¼‰</li>
</ul></li>
<li><strong>ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ1ãƒ¶æœˆï¼‰</strong>
<ul>
<li>AIæ¨è–¦ã‚·ã‚¹ãƒ†ãƒ </li>
<li>è³¼è²·å±¥æ­´ãƒ™ãƒ¼ã‚¹ã®ææ¡ˆ</li>
<li>èª•ç”Ÿæ—¥ç‰¹å…¸</li>
</ul></li>
<li><strong>ãƒ­ã‚¤ãƒ¤ãƒªãƒ†ã‚£å¼·åŒ–ï¼ˆ3ãƒ¶æœˆï¼‰</strong>
<ul>
<li>ãƒã‚¤ãƒ³ãƒˆ2å€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</li>
<li>ç´¹ä»‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆå‹é”ç´¹ä»‹ã§åŒæ–¹ã«ç‰¹å…¸ï¼‰</li>
<li>ã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒ </li>
</ul></li>
</ol>

<p><strong>KPI</strong>ï¼š</p>
<ul>
<li>ãƒªãƒ”ãƒ¼ãƒˆç‡: 85% â†’ 92%</li>
<li>å¹³å‡è³¼å…¥é¡: $14,567 â†’ $17,500</li>
<li>NPSï¼ˆé¡§å®¢æ¨å¥¨åº¦ï¼‰: 70 â†’ 85</li>
<li>ãƒãƒ£ãƒ¼ãƒ³ç‡: 5% â†’ 2%</li>
</ul>

<p><strong>æŠ•è³‡</strong>: $68,700 â†’ <strong>æœŸå¾…åç›Š</strong>: $10Mï¼ˆROI 14,475%ï¼‰</p>

<h4>å„ªå…ˆåº¦2: æˆé•·è¦‹è¾¼ã¿é¡§å®¢ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼2ï¼‰</h4>
<p><strong>ç›®æ¨™</strong>: ãƒ­ã‚¤ãƒ¤ãƒ«é¡§å®¢ã¸ã®è»¢æ›</p>

<p><strong>æ–½ç­–</strong>ï¼š</p>
<ol>
<li><strong>ã‚¢ãƒƒãƒ—ã‚»ãƒ«ãƒ»ã‚¯ãƒ­ã‚¹ã‚»ãƒ«ï¼ˆå³æ™‚ï¼‰</strong>
<ul>
<li>ã€Œã‚ˆãä¸€ç·’ã«è³¼å…¥ã•ã‚Œã‚‹å•†å“ã€ææ¡ˆ</li>
<li>ãƒãƒ³ãƒ‰ãƒ«å‰²å¼•</li>
<li>æ¬¡å›è³¼å…¥10%ã‚ªãƒ•ã‚¯ãƒ¼ãƒãƒ³</li>
</ul></li>
<li><strong>è³¼å…¥é »åº¦å‘ä¸Šï¼ˆ2é€±é–“ï¼‰</strong>
<ul>
<li>å®šæœŸè³¼å…¥ãƒ—ãƒ©ãƒ³ï¼ˆ5%è¿½åŠ å‰²å¼•ï¼‰</li>
<li>ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ¡ãƒ¼ãƒ«ï¼ˆå†è³¼å…¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰</li>
<li>é™å®šã‚¿ã‚¤ãƒ ã‚»ãƒ¼ãƒ«é€šçŸ¥</li>
</ul></li>
<li><strong>ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆå‘ä¸Šï¼ˆ1ãƒ¶æœˆï¼‰</strong>
<ul>
<li>ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ã§ãƒã‚¤ãƒ³ãƒˆ</li>
<li>SNSãƒ•ã‚©ãƒ­ãƒ¼ã§å‰²å¼•</li>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ§‹ç¯‰</li>
</ul></li>
</ol>

<p><strong>KPI</strong>ï¼š</p>
<ul>
<li>è³¼å…¥é »åº¦: 12.5å›/å¹´ â†’ 18å›/å¹´</li>
<li>å¹³å‡è³¼å…¥é¡: $7,890 â†’ $10,000</li>
<li>ãƒ­ã‚¤ãƒ¤ãƒ«é¡§å®¢ã¸ã®è»¢æ›ç‡: 0% â†’ 25%</li>
<li>ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆç‡: 30% â†’ 55%</li>
</ul>

<p><strong>æŠ•è³‡</strong>: $43,610 â†’ <strong>æœŸå¾…åç›Š</strong>: $2.46Mï¼ˆROI 5,535%ï¼‰</p>

<h4>å„ªå…ˆåº¦3: ä¼‘çœ é¡§å®¢ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼1ï¼‰</h4>
<p><strong>ç›®æ¨™</strong>: å†ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã€ã‚¦ã‚£ãƒ³ãƒãƒƒã‚¯</p>

<p><strong>æ–½ç­–</strong>ï¼š</p>
<ol>
<li><strong>ã‚¦ã‚£ãƒ³ãƒãƒƒã‚¯ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ï¼ˆå³æ™‚ï¼‰</strong>
<ul>
<li>ã€ŒãŠä¹…ã—ã¶ã‚Šã§ã™ã€ãƒ¡ãƒ¼ãƒ«</li>
<li>30-50%å¤§å¹…å‰²å¼•ã‚¯ãƒ¼ãƒãƒ³</li>
<li>é€æ–™ç„¡æ–™</li>
</ul></li>
<li><strong>é›¢åç†ç”±èª¿æŸ»ï¼ˆ1é€±é–“ï¼‰</strong>
<ul>
<li>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆï¼ˆå›ç­”ã§$10ã‚¯ãƒ¼ãƒãƒ³ï¼‰</li>
<li>ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼</li>
<li>ç«¶åˆåˆ†æ</li>
</ul></li>
<li><strong>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç´°åˆ†åŒ–ï¼ˆ2é€±é–“ï¼‰</strong>
<ul>
<li>é›¢åç†ç”±åˆ¥ã«æ–½ç­–ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</li>
<li>ä¾¡æ ¼æ•æ„Ÿå±¤ â†’ å‰²å¼•é‡è¦–</li>
<li>å•†å“ä¸æº€å±¤ â†’ æ–°å•†å“ç´¹ä»‹</li>
</ul></li>
</ol>

<p><strong>KPI</strong>ï¼š</p>
<ul>
<li>å†è³¼å…¥ç‡: 0% â†’ 15%</li>
<li>ãƒ¡ãƒ¼ãƒ«é–‹å°ç‡: 8% â†’ 25%</li>
<li>ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨ç‡: 5% â†’ 35%</li>
<li>ã‚¦ã‚£ãƒ³ãƒãƒƒã‚¯æˆåŠŸç‡: 10%</li>
</ul>

<p><strong>æŠ•è³‡</strong>: $27,100 â†’ <strong>æœŸå¾…åç›Š</strong>: $381Kï¼ˆROI 1,307%ï¼‰</p>

<h4>å„ªå…ˆåº¦4: æ–°è¦ãƒ»ä½æ´»å‹•é¡§å®¢ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼3ï¼‰</h4>
<p><strong>ç›®æ¨™</strong>: ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¼·åŒ–ã€å®šç€ç‡å‘ä¸Š</p>

<p><strong>æ–½ç­–</strong>ï¼š</p>
<ol>
<li><strong>ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆå³æ™‚ï¼‰</strong>
<ul>
<li>è³¼å…¥ã‹ã‚‰3æ—¥å¾Œã«ã‚µãƒ³ã‚¯ã‚¹ãƒ¡ãƒ¼ãƒ«</li>
<li>ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ãƒ»ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</li>
<li>åˆå›è³¼å…¥ç‰¹å…¸ï¼ˆæ¬¡å›15%ã‚ªãƒ•ï¼‰</li>
</ul></li>
<li><strong>å•†å“æ¨è–¦ï¼ˆ1é€±é–“ï¼‰</strong>
<ul>
<li>è³¼å…¥å•†å“ã¨é–¢é€£ã™ã‚‹ææ¡ˆ</li>
<li>äººæ°—å•†å“ãƒ©ãƒ³ã‚­ãƒ³ã‚°</li>
<li>ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ãŠã™ã™ã‚</li>
</ul></li>
<li><strong>ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆï¼ˆ2é€±é–“ï¼‰</strong>
<ul>
<li>SNSãƒ»ãƒ¡ãƒ«ãƒã‚¬ç™»éŒ²ä¿ƒé€²</li>
<li>ãƒ–ãƒ­ã‚°ãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°</li>
<li>åˆå›ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§$5ã‚¯ãƒ¼ãƒãƒ³</li>
</ul></li>
</ol>

<p><strong>KPI</strong>ï¼š</p>
<ul>
<li>ãƒªãƒ”ãƒ¼ãƒˆç‡: 5% â†’ 25%</li>
<li>30æ—¥å®šç€ç‡: 10% â†’ 40%</li>
<li>ãƒ¡ãƒ«ãƒã‚¬ç™»éŒ²ç‡: 15% â†’ 45%</li>
<li>2å›ç›®è³¼å…¥ã¾ã§ã®æ—¥æ•°: 90æ—¥ â†’ 30æ—¥</li>
</ul>

<p><strong>æŠ•è³‡</strong>: $11,640 â†’ <strong>æœŸå¾…åç›Š</strong>: $71.8Kï¼ˆROI 517%ï¼‰</p>

<h4>æ¨ªæ–­æ–½ç­–</h4>

<p><strong>1. ãƒ‡ãƒ¼ã‚¿åŸºç›¤å¼·åŒ–</strong></p>
<ul>
<li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ›´æ–°</li>
<li>è¡Œå‹•ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°å¼·åŒ–</li>
<li>äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã®ç¶™ç¶šæ”¹å–„</li>
</ul>

<p><strong>2. A/Bãƒ†ã‚¹ãƒˆ</strong></p>
<ul>
<li>å„æ–½ç­–ã®åŠ¹æœæ¸¬å®š</li>
<li>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥æœ€é©åŒ–</li>
<li>ROIç¶™ç¶šãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</li>
</ul>

<p><strong>3. ãƒãƒ¼ãƒ ä½“åˆ¶</strong></p>
<ul>
<li>ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ãƒ†ã‚£ã‚¹ãƒˆ: ãƒ¢ãƒ‡ãƒ«æ”¹å–„</li>
<li>ãƒãƒ¼ã‚±ã‚¿ãƒ¼: ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å®Ÿè¡Œ</li>
<li>CRMæ‹…å½“: é¡§å®¢å¯¾å¿œ</li>
</ul>

<p><strong>å®Ÿè¡Œã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æœŸé–“</th>
<th>æ–½ç­–</th>
<th>å¯¾è±¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>Week 1</td>
<td>VIPãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ã‚¦ã‚£ãƒ³ãƒãƒƒã‚¯ãƒ¡ãƒ¼ãƒ«</td>
<td>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼0, 1</td>
</tr>
<tr>
<td>Week 2-4</td>
<td>ã‚¢ãƒƒãƒ—ã‚»ãƒ«ã€ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ—ãƒ­ã‚°ãƒ©ãƒ </td>
<td>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼2, 3</td>
</tr>
<tr>
<td>Month 2-3</td>
<td>ãƒ­ã‚¤ãƒ¤ãƒªãƒ†ã‚£å¼·åŒ–ã€A/Bãƒ†ã‚¹ãƒˆ</td>
<td>å…¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</td>
</tr>
<tr>
<td>Month 4-6</td>
<td>æœ€é©åŒ–ã€ã‚¹ã‚±ãƒ¼ãƒ«</td>
<td>å…¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</td>
</tr>
</tbody>
</table>

<p><strong>ç·åˆROIäºˆæ¸¬</strong>ï¼š</p>
<ul>
<li>ç·æŠ•è³‡: $151,050</li>
<li>ç·æœŸå¾…åç›Š: $12.92M</li>
<li>ROI: 8,454%</li>
<li>ãƒšã‚¤ãƒãƒƒã‚¯æœŸé–“: 2ãƒ¶æœˆ</li>
</ul>

<p><strong>æˆåŠŸã®éµ</strong>ï¼š</p>
<ol>
<li><strong>ç¶™ç¶šçš„ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</strong>: é€±æ¬¡ã§KPIç¢ºèª</li>
<li><strong>è¿…é€Ÿãªèª¿æ•´</strong>: åŠ¹æœãŒä½ã„æ–½ç­–ã¯å³æ”¹å–„</li>
<li><strong>é¡§å®¢ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</strong>: å®šæœŸçš„ãªæº€è¶³åº¦èª¿æŸ»</li>
<li><strong>ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³</strong>: æ–½ç­–ã®å®šé‡è©•ä¾¡ã‚’å¾¹åº•</li>
</ol>

</details>

<hr>

<h2>å‚è€ƒæ–‡çŒ®</h2>

<ol>
<li>Hastie, T., Tibshirani, R., & Friedman, J. (2009). <em>The Elements of Statistical Learning</em>. Springer.</li>
<li>Aggarwal, C. C., & Reddy, C. K. (2013). <em>Data Clustering: Algorithms and Applications</em>. CRC Press.</li>
<li>Liu, F. T., Ting, K. M., & Zhou, Z. H. (2008). "Isolation Forest." <em>IEEE International Conference on Data Mining</em>.</li>
<li>van der Maaten, L., & Hinton, G. (2008). "Visualizing Data using t-SNE." <em>Journal of Machine Learning Research</em>, 9, 2579-2605.</li>
<li>Fader, P. S., & Hardie, B. G. S. (2009). "Probability Models for Customer-Base Analysis." <em>Journal of Interactive Marketing</em>, 23(1), 61-69.</li>
</ol>

<div class="navigation">
    <a href="chapter3-anomaly-detection.html" class="nav-button">â† å‰ã®ç« : ç•°å¸¸æ¤œçŸ¥</a>
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
</div>

    </main>

    <footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ç›£ä¿®</strong>: Dr. Yusuke Hashimotoï¼ˆæ±åŒ—å¤§å­¦ï¼‰</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-20</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
