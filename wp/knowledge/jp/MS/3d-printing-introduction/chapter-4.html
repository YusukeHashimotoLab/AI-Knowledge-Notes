<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第4章：材料噴射法・結合剤噴射法・その他AM技術 - MS Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #f093fb;
            --color-accent-light: #f5576c;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #f093fb;
            --color-link-hover: #d07be8;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        @media (hover: hover) and (pointer: fine) {
            a:hover {
                color: var(--color-link-hover);
                text-decoration: underline;
            }
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            border-radius: var(--border-radius);
        }

        .warning-box {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            border-radius: var(--border-radius);
        }

        .success-box {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            border-radius: var(--border-radius);
        }

        .exercise {
            background-color: var(--color-bg-alt);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .exercise-title {
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: var(--spacing-sm);
        }

        details {
            margin: var(--spacing-md) 0;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            background-color: var(--color-bg-alt);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: var(--spacing-sm);
        }

        @media (hover: hover) and (pointer: fine) {
            summary:hover {
                color: var(--color-link);
            }
        }

        .equation {
            overflow-x: auto;
            padding: var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-radius: var(--border-radius);
            margin: var(--spacing-md) 0;
            text-align: center;
            font-family: serif;
            font-style: italic;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
            gap: var(--spacing-md);
        }

        .nav-button {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-lg);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        @media (hover: hover) and (pointer: fine) {
            .nav-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);
                text-decoration: none;
            }
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-xl) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            color: var(--color-text-light);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .nav-buttons {
                flex-direction: column;
            }

            pre {
                font-size: 0.8rem;
            }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <!-- Mermaid for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body>
            <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="/AI-Knowledge-Notes/knowledge/jp/index.html">AI寺子屋トップ</a><span class="breadcrumb-separator">›</span><a href="/AI-Knowledge-Notes/knowledge/jp/MS/index.html">材料科学</a><span class="breadcrumb-separator">›</span><a href="/AI-Knowledge-Notes/knowledge/jp/MS/advanced-materials-systems-introduction/index.html">Advanced Materials Systems</a><span class="breadcrumb-separator">›</span><span class="breadcrumb-current">Chapter 4</span>
        </div>
    </nav>

        <header>
        <div class="header-content">
            <h1>第4章：積層造形の基礎</h1>
            <p class="subtitle">AM技術の原理と分類 - 3Dプリンティングの技術体系</p>
            <div class="meta">
                <span class="meta-item">📚 3Dプリンティング入門シリーズ</span>
                <span class="meta-item">⏱️ 読了時間: 35-40分</span>
                <span class="meta-item">🎓 難易度: 初級〜中級</span>
            </div>
        </div>
    </header>

    <div class="container">
        <h2>学習目標</h2>
        <p>この章を完了すると、以下を説明できるようになります：</p>

        <h3>基本理解（Level 1）</h3>
        <ul>
            <li>積層造形（AM）の定義とISO/ASTM 52900規格の基本概念</li>
            <li>7つのAMプロセスカテゴリ（MEX, VPP, PBF, MJ, BJ, SL, DED）の特徴</li>
            <li>STLファイル形式の構造（三角形メッシュ、法線ベクトル、頂点順序）</li>
            <li>AMの歴史（1986年ステレオリソグラフィから現代システムまで）</li>
        </ul>

        <h3>実践スキル（Level 2）</h3>
        <ul>
            <li>PythonでSTLファイルを読み込み、体積・表面積を計算できる</li>
            <li>numpy-stlとtrimeshを使ったメッシュ検証と修復ができる</li>
            <li>スライシングの基本原理（レイヤー高さ、シェル、インフィル）を理解</li>
            <li>G-codeの基本構造（G0/G1/G28/M104など）を読み解ける</li>
        </ul>

        <h3>応用力（Level 3）</h3>
        <ul>
            <li>用途要求に応じて最適なAMプロセスを選択できる</li>
            <li>メッシュの問題（非多様体、法線反転）を検出・修正できる</li>
            <li>造形パラメータ（レイヤー高さ、印刷速度、温度）を最適化できる</li>
            <li>STLファイルの品質評価とプリント適性判断ができる</li>
        </ul>

        <h2>1.1 積層造形（AM）とは</h2>

        <h3>1.1.1 積層造形の定義</h3>
        <p>積層造形（Additive Manufacturing, AM）とは、<strong>ISO/ASTM 52900:2021規格で定義される「3次元CADデータから材料を層ごとに積み上げて物体を製造するプロセス」</strong>です。従来の切削加工（除去加工）とは対照的に、必要な部分にのみ材料を付加するため、以下の革新的な特徴を持ちます：</p>

        <ul>
            <li><strong>設計自由度</strong>: 従来製法では不可能な複雑形状（中空構造、ラティス構造、トポロジー最適化形状）を製造可能</li>
            <li><strong>材料効率</strong>: 必要な部分にのみ材料を使用するため、材料廃棄率が5-10%（従来加工は30-90%廃棄）</li>
            <li><strong>オンデマンド製造</strong>: 金型不要でカスタマイズ製品を少量・多品種生産可能</li>
            <li><strong>一体化製造</strong>: 従来は複数部品を組立てていた構造を一体造形し、組立工程を削減</li>
        </ul>

        <div class="info-box">
            <strong>💡 産業的重要性</strong>
            <p>AM市場は急成長中で、Wohlers Report 2023によると：</p>
            <ul>
                <li>世界のAM市場規模: $18.3B（2023年）→ $83.9B予測（2030年、年成長率23.5%）</li>
                <li>用途の内訳: プロトタイピング（38%）、ツーリング（27%）、最終製品（35%）</li>
                <li>主要産業: 航空宇宙（26%）、医療（21%）、自動車（18%）、消費財（15%）</li>
                <li>材料別シェア: ポリマー（55%）、金属（35%）、セラミックス（7%）、その他（3%）</li>
            </ul>
        </div>

        <h3>1.1.2 AMの歴史と発展</h3>
        <p>積層造形技術は約40年の歴史を持ち、以下のマイルストーンを経て現在に至ります：</p>

        <pre class="mermaid">
flowchart LR
    A[1986<br/>SLA発明<br/>Chuck Hull] --> B[1988<br/>SLS登場<br/>Carl Deckard]
    B --> C[1992<br/>FDM特許<br/>Stratasys社]
    C --> D[2005<br/>RepRap<br/>オープンソース化]
    D --> E[2012<br/>金属AM普及<br/>EBM/SLM]
    E --> F[2023<br/>産業化加速<br/>大型・高速化]

    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#e8f5e9
    style D fill:#f3e5f5
    style E fill:#fce4ec
    style F fill:#fff9c4
        </pre>

        <ol>
            <li><strong>1986年: ステレオリソグラフィ（SLA）発明</strong> - Chuck Hull博士（3D Systems社創業者）が光硬化樹脂を層状に硬化させる最初のAM技術を発明（US Patent 4,575,330）。「3Dプリンティング」という言葉もこの時期に誕生。</li>
            <li><strong>1988年: 選択的レーザー焼結（SLS）登場</strong> - Carl Deckard博士（テキサス大学）がレーザーで粉末材料を焼結する技術を開発。金属やセラミックスへの応用可能性を開く。</li>
            <li><strong>1992年: 熱溶解積層（FDM）特許</strong> - Stratasys社がFDM技術を商用化。現在最も普及している3Dプリンティング方式の基礎を確立。</li>
            <li><strong>2005年: RepRapプロジェクト</strong> - Adrian Bowyer教授がオープンソース3Dプリンタ「RepRap」を発表。特許切れと相まって低価格化・民主化が進展。</li>
            <li><strong>2012年以降: 金属AMの産業普及</strong> - 電子ビーム溶解（EBM）、選択的レーザー溶融（SLM）が航空宇宙・医療分野で実用化。GE AviationがFUEL噴射ノズルを量産開始。</li>
            <li><strong>2023年現在: 大型化・高速化の時代</strong> - バインダージェット、連続繊維複合材AM、マルチマテリアルAMなど新技術が産業実装段階へ。</li>
        </ol>

        <h3>1.1.3 AMの主要応用分野</h3>

        <h4>応用1: プロトタイピング（Rapid Prototyping）</h4>
        <p>AMの最初の主要用途で、設計検証・機能試験・市場評価用のプロトタイプを迅速に製造します：</p>

        <ul>
            <li><strong>リードタイム短縮</strong>: 従来の試作（数週間〜数ヶ月）→ AMでは数時間〜数日</li>
            <li><strong>設計反復の加速</strong>: 低コストで複数バージョンを試作し、設計を最適化</li>
            <li><strong>コミュニケーション改善</strong>: 視覚的・触覚的な物理モデルで関係者間の認識を統一</li>
            <li><strong>典型例</strong>: 自動車の意匠モデル、家電製品の筐体試作、医療機器の術前シミュレーションモデル</li>
        </ul>

        <h4>応用2: ツーリング（Tooling & Fixtures）</h4>
        <p>製造現場で使用する治具・工具・金型をAMで製造する応用です：</p>

        <ul>
            <li><strong>カスタム治具</strong>: 生産ラインに特化した組立治具・検査治具を迅速に製作</li>
            <li><strong>コンフォーマル冷却金型</strong>: 従来の直線的冷却路ではなく、製品形状に沿った3次元冷却路を内蔵した射出成形金型（冷却時間30-70%短縮）</li>
            <li><strong>軽量化ツール</strong>: ラティス構造を使った軽量エンドエフェクタで作業者の負担を軽減</li>
            <li><strong>典型例</strong>: BMWの組立ライン用治具（年間100,000個以上をAMで製造）、GolfのTaylorMadeドライバー金型</li>
        </ul>

        <h4>応用3: 最終製品（End-Use Parts）</h4>
        <p>AMで直接、最終製品を製造する応用が近年急増しています：</p>

        <ul>
            <li><strong>航空宇宙部品</strong>: GE Aviation LEAP燃料噴射ノズル（従来20部品→AM一体化、重量25%軽減、年間100,000個以上生産）</li>
            <li><strong>医療インプラント</strong>: チタン製人工股関節・歯科インプラント（患者固有の解剖学的形状に最適化、骨結合を促進する多孔質構造）</li>
            <li><strong>カスタム製品</strong>: 補聴器（年間1,000万個以上がAMで製造）、スポーツシューズのミッドソール（Adidas 4D、Carbon社DLS技術）</li>
            <li><strong>スペア部品</strong>: 絶版部品・希少部品のオンデマンド製造（自動車、航空機、産業機械）</li>
        </ul>

        <div class="warning-box">
            <strong>⚠️ AMの制約と課題</strong>
            <p>AMは万能ではなく、以下の制約があります：</p>
            <ul>
                <li><strong>造形速度</strong>: 大量生産には不向き（射出成形1個/数秒 vs AM数時間）。経済的ブレークイーブンは通常1,000個以下</li>
                <li><strong>造形サイズ制限</strong>: ビルドボリューム（多くの装置で200×200×200mm程度）を超える大型部品は分割製造が必要</li>
                <li><strong>表面品質</strong>: 積層痕（layer lines）が残るため、高精度表面が必要な場合は後加工必須（研磨、機械加工）</li>
                <li><strong>材料特性の異方性</strong>: 積層方向（Z軸）と面内方向（XY平面）で機械的性質が異なる場合がある（特にFDM）</li>
                <li><strong>材料コスト</strong>: AMグレード材料は汎用材料の2-10倍高価（ただし材料効率と設計最適化で相殺可能）</li>
            </ul>
        </div>

        <h2>1.2 ISO/ASTM 52900による7つのAMプロセス分類</h2>

        <h3>1.2.1 AMプロセス分類の全体像</h3>
        <p>ISO/ASTM 52900:2021規格では、すべてのAM技術を<strong>エネルギー源と材料供給方法に基づいて7つのプロセスカテゴリ</strong>に分類しています。各プロセスには固有の長所・短所があり、用途に応じて最適な技術を選択する必要があります。</p>

        <pre class="mermaid">
flowchart TD
    AM[積層造形<br/>7つのプロセス] --> MEX[Material Extrusion<br/>材料押出]
    AM --> VPP[Vat Photopolymerization<br/>液槽光重合]
    AM --> PBF[Powder Bed Fusion<br/>粉末床溶融結合]
    AM --> MJ[Material Jetting<br/>材料噴射]
    AM --> BJ[Binder Jetting<br/>結合剤噴射]
    AM --> SL[Sheet Lamination<br/>シート積層]
    AM --> DED[Directed Energy Deposition<br/>指向性エネルギー堆積]

    MEX --> MEX_EX[FDM/FFF<br/>低コスト・普及型]
    VPP --> VPP_EX[SLA/DLP<br/>高精度・高表面品質]
    PBF --> PBF_EX[SLS/SLM/EBM<br/>高強度・金属対応]

    style AM fill:#f093fb
    style MEX fill:#e3f2fd
    style VPP fill:#fff3e0
    style PBF fill:#e8f5e9
    style MJ fill:#f3e5f5
    style BJ fill:#fce4ec
    style SL fill:#fff9c4
    style DED fill:#fce4ec
        </pre>

        <h3>1.2.2 Material Extrusion (MEX) - 材料押出</h3>
        <p><strong>原理</strong>: 熱可塑性樹脂フィラメントを加熱・溶融し、ノズルから押し出して積層。最も普及している技術（FDM/FFFとも呼ばれる）。</p>

        <div class="equation">
            プロセス: フィラメント → 加熱ノズル（190-260°C）→ 溶融押出 → 冷却固化 → 次層積層
        </div>

        <p><strong>特徴：</strong></p>
        <ul>
            <li><strong>低コスト</strong>: 装置価格$200-$5,000（デスクトップ）、$10,000-$100,000（産業用）</li>
            <li><strong>材料多様性</strong>: PLA、ABS、PETG、ナイロン、PC、カーボン繊維複合材、PEEK（高性能）</li>
            <li><strong>造形速度</strong>: 20-150 mm³/s（中程度）、レイヤー高さ0.1-0.4mm</li>
            <li><strong>精度</strong>: ±0.2-0.5 mm（デスクトップ）、±0.1 mm（産業用）</li>
            <li><strong>表面品質</strong>: 積層痕が明瞭（後加工で改善可能）</li>
            <li><strong>材料異方性</strong>: Z軸方向（積層方向）の強度が20-80%低い（層間接着が弱点）</li>
        </ul>

        <p><strong>応用例：</strong></p>
        <ul>
            <li>プロトタイピング（最も一般的な用途、低コスト・高速）</li>
            <li>治具・工具（製造現場で使用、軽量・カスタマイズ容易）</li>
            <li>教育用モデル（学校・大学で広く使用、安全・低コスト）</li>
            <li>最終製品（カスタム補聴器、義肢装具、建築模型）</li>
        </ul>

        <div class="info-box">
            <strong>💡 FDMの代表的装置</strong>
            <ul>
                <li><strong>Ultimaker S5</strong>: デュアルヘッド、ビルドボリューム330×240×300mm、$6,000</li>
                <li><strong>Prusa i3 MK4</strong>: オープンソース系、高い信頼性、$1,200</li>
                <li><strong>Stratasys Fortus 450mc</strong>: 産業用、ULTEM 9085対応、$250,000</li>
                <li><strong>Markforged X7</strong>: 連続カーボン繊維複合材対応、$100,000</li>
            </ul>
        </div>

        <h3>1.2.3 Vat Photopolymerization (VPP) - 液槽光重合</h3>
        <p><strong>原理</strong>: 液状の光硬化性樹脂（フォトポリマー）に紫外線（UV）レーザーまたはプロジェクターで光を照射し、選択的に硬化させて積層。</p>

        <div class="equation">
            プロセス: UV照射 → 光重合反応 → 固化 → ビルドプラットフォーム上昇 → 次層照射
        </div>

        <p><strong>VPPの2つの主要方式：</strong></p>
        <ol>
            <li><strong>SLA（Stereolithography）</strong>: UV レーザー（355 nm）をガルバノミラーで走査し、点描的に硬化。高精度だが低速。</li>
            <li><strong>DLP（Digital Light Processing）</strong>: プロジェクターで面全体を一括露光。高速だが解像度はプロジェクター画素数に依存（Full HD: 1920×1080）。</li>
            <li><strong>LCD-MSLA（Masked SLA）</strong>: LCDマスクを使用、DLP類似だが低コスト化（$200-$1,000のデスクトップ機多数）。</li>
        </ol>

        <p><strong>特徴：</strong></p>
        <ul>
            <li><strong>高精度</strong>: XY解像度25-100 μm、Z解像度10-50 μm（全AM技術中で最高レベル）</li>
            <li><strong>表面品質</strong>: 滑らかな表面（Ra < 5 μm）、積層痕がほぼ見えない</li>
            <li><strong>造形速度</strong>: SLA（10-50 mm³/s）、DLP/LCD（100-500 mm³/s、面積依存）</li>
            <li><strong>材料制約</strong>: 光硬化性樹脂のみ（機械的性質はFDMより劣る場合が多い）</li>
            <li><strong>後処理必須</strong>: 洗浄（IPA等）→ 二次硬化（UV照射）→ サポート除去</li>
        </ul>

        <p><strong>応用例：</strong></p>
        <ul>
            <li>歯科用途（歯列矯正モデル、サージカルガイド、義歯、年間数百万個生産）</li>
            <li>ジュエリー鋳造用ワックスモデル（高精度・複雑形状）</li>
            <li>医療モデル（術前計画、解剖学モデル、患者説明用）</li>
            <li>マスターモデル（シリコン型取り用、デザイン検証）</li>
        </ul>

        <h3>1.2.4 Powder Bed Fusion (PBF) - 粉末床溶融結合</h3>
        <p><strong>原理</strong>: 粉末材料を薄く敷き詰め、レーザーまたは電子ビームで選択的に溶融・焼結し、冷却固化させて積層。金属・ポリマー・セラミックスに対応。</p>

        <div class="equation">
            プロセス: 粉末敷設 → レーザー/電子ビーム走査 → 溶融・焼結 → 固化 → 次層粉末敷設
        </div>

        <p><strong>PBFの3つの主要方式：</strong></p>
        <ol>
            <li><strong>SLS（Selective Laser Sintering）</strong>: ポリマー粉末（PA12ナイロン等）をレーザー焼結。サポート不要（周囲粉末が支持）。</li>
            <li><strong>SLM（Selective Laser Melting）</strong>: 金属粉末（Ti-6Al-4V、AlSi10Mg、Inconel 718等）を完全溶融。高密度部品（相対密度>99%）製造可能。</li>
            <li><strong>EBM（Electron Beam Melting）</strong>: 電子ビームで金属粉末を溶融。高温予熱（650-1000°C）により残留応力が小さく、造形速度が速い。</li>
        </ol>

        <p><strong>特徴：</strong></p>
        <ul>
            <li><strong>高強度</strong>: 溶融・再凝固により鍛造材に匹敵する機械的性質（引張強度500-1200 MPa）</li>
            <li><strong>複雑形状対応</strong>: サポート不要（粉末が支持）でオーバーハング造形可能</li>
            <li><strong>材料多様性</strong>: Ti合金、Al合金、ステンレス鋼、Ni超合金、Co-Cr合金、ナイロン</li>
            <li><strong>高コスト</strong>: 装置価格$200,000-$1,500,000、材料費$50-$500/kg</li>
            <li><strong>後処理</strong>: サポート除去、熱処理（応力除去）、表面仕上げ（ブラスト、研磨）</li>
        </ul>

        <p><strong>応用例：</strong></p>
        <ul>
            <li>航空宇宙部品（軽量化、一体化、GE LEAP燃料ノズル等）</li>
            <li>医療インプラント（患者固有形状、多孔質構造、Ti-6Al-4V）</li>
            <li>金型（コンフォーマル冷却、複雑形状、H13工具鋼）</li>
            <li>自動車部品（軽量化ブラケット、カスタムエンジン部品）</li>
        </ul>

        <h3>1.2.5 Material Jetting (MJ) - 材料噴射</h3>
        <p><strong>原理</strong>: インクジェットプリンタと同様に、液滴状の材料（光硬化性樹脂またはワックス）をヘッドから噴射し、UV照射で即座に硬化させて積層。</p>

        <p><strong>特徴：</strong></p>
        <ul>
            <li><strong>超高精度</strong>: XY解像度42-85 μm、Z解像度16-32 μm</li>
            <li><strong>マルチマテリアル</strong>: 同一造形で複数材料・複数色を使い分け可能</li>
            <li><strong>フルカラー造形</strong>: CMYK樹脂の組合せで1,000万色以上の表現</li>
            <li><strong>表面品質</strong>: 極めて滑らか（積層痕ほぼなし）</li>
            <li><strong>高コスト</strong>: 装置$50,000-$300,000、材料費$200-$600/kg</li>
            <li><strong>材料制約</strong>: 光硬化性樹脂のみ、機械的性質は中程度</li>
        </ul>

        <p><strong>応用例：</strong>: 医療解剖モデル（軟組織・硬組織を異なる材料で再現）、フルカラー建築模型、デザイン検証モデル</p>

        <h3>1.2.6 Binder Jetting (BJ) - 結合剤噴射</h3>
        <p><strong>原理</strong>: 粉末床に液状バインダー（接着剤）をインクジェット方式で噴射し、粉末粒子を結合。造形後に焼結または含浸処理で強度向上。</p>

        <p><strong>特徴：</strong></p>
        <ul>
            <li><strong>高速造形</strong>: レーザー走査不要で面全体を一括処理、造形速度100-500 mm³/s</li>
            <li><strong>材料多様性</strong>: 金属粉末、セラミックス、砂型（鋳造用）、フルカラー（石膏）</li>
            <li><strong>サポート不要</strong>: 周囲粉末が支持、除去後リサイクル可能</li>
            <li><strong>低密度問題</strong>: 焼結前は脆弱（グリーン密度50-60%）、焼結後も相対密度90-98%</li>
            <li><strong>後処理必須</strong>: 脱脂 → 焼結（金属：1200-1400°C）→ 含浸（銅・青銅）</li>
        </ul>

        <p><strong>応用例：</strong>: 砂型鋳造用型（エンジンブロック等の大型鋳物）、金属部品（Desktop Metal、HP Metal Jet）、フルカラー像（記念品、教育モデル）</p>

        <h3>1.2.7 Sheet Lamination (SL) - シート積層</h3>
        <p><strong>原理</strong>: シート状材料（紙、金属箔、プラスチックフィルム）を積層し、接着または溶接で結合。各層をレーザーまたはブレードで輪郭切断。</p>

        <p><strong>代表技術：</strong></p>
        <ul>
            <li><strong>LOM（Laminated Object Manufacturing）</strong>: 紙・プラスチックシート、接着剤で積層、レーザー切断</li>
            <li><strong>UAM（Ultrasonic Additive Manufacturing）</strong>: 金属箔を超音波溶接、CNC切削で輪郭加工</li>
        </ul>

        <p><strong>特徴：</strong> 大型造形可能、材料費安価、精度中程度、用途限定的（主に視覚モデル、金属では埋込センサー等）</p>

        <h3>1.2.8 Directed Energy Deposition (DED) - 指向性エネルギー堆積</h3>
        <p><strong>原理</strong>: 金属粉末またはワイヤーを供給しながら、レーザー・電子ビーム・アークで溶融し、基板上に堆積。大型部品や既存部品の補修に使用。</p>

        <p><strong>特徴：</strong></p>
        <ul>
            <li><strong>高速堆積</strong>: 堆積速度1-5 kg/h（PBFの10-50倍）</li>
            <li><strong>大型対応</strong>: ビルドボリューム制限が少ない（多軸ロボットアーム使用）</li>
            <li><strong>補修・コーティング</strong>: 既存部品の摩耗部分修復、表面硬化層形成</li>
            <li><strong>低精度</strong>: 精度±0.5-2 mm、後加工（機械加工）必須</li>
        </ul>

        <p><strong>応用例：</strong>: タービンブレード補修、大型航空宇宙部品、工具の耐摩耗コーティング</p>

        <div class="warning-box">
            <strong>⚠️ プロセス選択の指針</strong>
            <p>最適なAMプロセスは用途要求により異なります：</p>
            <ul>
                <li><strong>精度最優先</strong> → VPP（SLA/DLP）またはMJ</li>
                <li><strong>低コスト・普及型</strong> → MEX（FDM/FFF）</li>
                <li><strong>金属高強度部品</strong> → PBF（SLM/EBM）</li>
                <li><strong>大量生産（砂型）</strong> → BJ</li>
                <li><strong>大型・高速堆積</strong> → DED</li>
            </ul>
        </div>
        </div>

        <h2>1.3 STLファイル形式とデータ処理</h2>

        <h3>1.3.1 STLファイルの構造</h3>
        <p>STL（STereoLithography）は、<strong>AMで最も広く使用される3Dモデルファイル形式</strong>で、1987年に3D Systems社が開発しました。STLファイルは物体表面を<strong>三角形メッシュ（Triangle Mesh）の集合</strong>として表現します。</p>

        <h4>STLファイルの基本構造</h4>
        <div class="equation">
            STLファイル = 法線ベクトル（n） + 3つの頂点座標（v1, v2, v3）× 三角形数
        </div>

        <p><strong>ASCII STL形式の例：</strong></p>
        <pre><code class="language-plaintext">solid cube
  facet normal 0 0 1
    outer loop
      vertex 0 0 10
      vertex 10 0 10
      vertex 10 10 10
    endloop
  endfacet
  facet normal 0 0 1
    outer loop
      vertex 0 0 10
      vertex 10 10 10
      vertex 0 10 10
    endloop
  endfacet
  ...
endsolid cube
</code></pre>

        <p><strong>STLフォーマットの2つの種類：</strong></p>
        <ol>
            <li><strong>ASCII STL</strong>: 人間が読めるテキスト形式。ファイルサイズ大（同じモデルでBinaryの10-20倍）。デバッグ・検証に有用。</li>
            <li><strong>Binary STL</strong>: バイナリ形式、ファイルサイズ小、処理高速。産業用途で標準。構造：80バイトヘッダー + 4バイト（三角形数） + 各三角形50バイト（法線12B + 頂点36B + 属性2B）。</li>
        </ol>

        <h3>1.3.2 STLファイルの重要概念</h3>

        <h4>1. 法線ベクトル（Normal Vector）</h4>
        <p>各三角形面には<strong>法線ベクトル（外向き方向）</strong>が定義され、物体の「内側」と「外側」を区別します。法線方向は<strong>右手の法則</strong>で決定されます：</p>

        <div class="equation">
            法線n = (v2 - v1) × (v3 - v1) / |(v2 - v1) × (v3 - v1)|
        </div>

        <p><strong>頂点順序ルール：</strong> 頂点v1, v2, v3は反時計回り（CCW: Counter-ClockWise）に配置され、外から見て反時計回りの順序で法線が外向きになります。</p>

        <h4>2. 多様体（Manifold）条件</h4>
        <p>STLメッシュが3Dプリント可能であるためには、<strong>多様体（Manifold）</strong>でなければなりません：</p>

        <ul>
            <li><strong>エッジ共有</strong>: すべてのエッジ（辺）は正確に2つの三角形に共有される</li>
            <li><strong>頂点共有</strong>: すべての頂点は連続した三角形扇（fan）に属する</li>
            <li><strong>閉じた表面</strong>: 穴や開口部がなく、完全に閉じた表面を形成</li>
            <li><strong>自己交差なし</strong>: 三角形が互いに交差・貫通していない</li>
        </ul>

        <div class="warning-box">
            <strong>⚠️ 非多様体メッシュの問題</strong>
            <p>非多様体メッシュ（Non-Manifold Mesh）は3Dプリント不可能です。典型的な問題：</p>
            <ul>
                <li><strong>穴（Holes）</strong>: 閉じていない表面、エッジが1つの三角形にのみ属する</li>
                <li><strong>T字接合（T-junction）</strong>: エッジが3つ以上の三角形に共有される</li>
                <li><strong>法線反転（Inverted Normals）</strong>: 法線が内側を向いている三角形が混在</li>
                <li><strong>重複頂点（Duplicate Vertices）</strong>: 同じ位置に複数の頂点が存在</li>
                <li><strong>微小三角形（Degenerate Triangles）</strong>: 面積がゼロまたはほぼゼロの三角形</li>
            </ul>
            <p>これらの問題はスライサーソフトウェアでエラーを引き起こし、造形失敗の原因となります。</p>
        </div>

        <h3>1.3.3 STLファイルの品質指標</h3>

        <p>STLメッシュの品質は以下の指標で評価されます：</p>

        <ol>
            <li><strong>三角形数（Triangle Count）</strong>: 通常10,000-500,000個。過少（粗いモデル）または過多（ファイルサイズ大・処理遅延）は避ける。</li>
            <li><strong>エッジ長の一様性</strong>: 極端に大小の三角形が混在すると造形品質低下。理想的には0.1-1.0 mm範囲。</li>
            <li><strong>アスペクト比（Aspect Ratio）</strong>: 細長い三角形（高アスペクト比）は数値誤差の原因。理想的にはアスペクト比 < 10。</li>
            <li><strong>法線の一貫性</strong>: すべての法線が外向き統一。反転法線が混在すると内外判定エラー。</li>
        </ol>

        <div class="info-box">
            <strong>💡 STLファイルの解像度トレードオフ</strong>
            <p>STLメッシュの解像度（三角形数）は精度とファイルサイズのトレードオフです：</p>
            <ul>
                <li><strong>低解像度（1,000-10,000三角形）</strong>: 高速処理、小ファイル、但し曲面が角張る（ファセット化明瞭）</li>
                <li><strong>中解像度（10,000-100,000三角形）</strong>: 多くの用途で適切、バランス良好</li>
                <li><strong>高解像度（100,000-1,000,000三角形）</strong>: 滑らかな曲面、但しファイルサイズ大（数十MB）、処理遅延</li>
            </ul>
            <p>CADソフトでSTLエクスポート時に、<strong>Chordal Tolerance（コード公差）</strong>または<strong>Angle Tolerance（角度公差）</strong>で解像度を制御します。推奨値：コード公差0.01-0.1 mm、角度公差5-15度。</p>
        </div>

        <h3>1.3.4 Pythonライブラリによる STL処理</h3>

        <p>PythonでSTLファイルを扱うための主要ライブラリ：</p>

        <ol>
            <li><strong>numpy-stl</strong>: 高速STL読込・書込、体積・表面積計算、法線ベクトル操作。シンプルで軽量。</li>
            <li><strong>trimesh</strong>: 包括的な3Dメッシュ処理ライブラリ。メッシュ修復、ブーリアン演算、レイキャスト、衝突検出。多機能だが依存関係多い。</li>
            <li><strong>PyMesh</strong>: 高度なメッシュ処理（リメッシュ、サブディビジョン、フィーチャー抽出）。インストールやや複雑。</li>
        </ol>

        <p><strong>numpy-stlの基本的な使用法：</strong></p>
        <pre><code class="language-python">from stl import mesh
import numpy as np

# STLファイルを読み込み
your_mesh = mesh.Mesh.from_file('model.stl')

# 基本的な幾何情報
volume, cog, inertia = your_mesh.get_mass_properties()
print(f"Volume: {volume:.2f} mm³")
print(f"Center of Gravity: {cog}")
print(f"Surface Area: {your_mesh.areas.sum():.2f} mm²")

# 三角形数
print(f"Number of Triangles: {len(your_mesh.vectors)}")
</code></pre>

        <h2>1.4 スライシングとツールパス生成</h2>

        <p>STLファイルを3Dプリンタが理解できる指令（G-code）に変換するプロセスを<strong>スライシング（Slicing）</strong>といいます。このセクションでは、スライシングの基本原理、ツールパス戦略、そしてG-codeの基礎を学びます。</p>

        <h3>1.4.1 スライシングの基本原理</h3>

        <p>スライシングは、3Dモデルを一定の高さ（レイヤー高さ）で水平に切断し、各層の輪郭を抽出するプロセスです：</p>

        <pre class="mermaid">
flowchart TD
    A[3Dモデル<br/>STLファイル] --> B[Z軸方向に<br/>層状にスライス]
    B --> C[各層の輪郭抽出<br/>Contour Detection]
    C --> D[シェル生成<br/>Perimeter Path]
    D --> E[インフィル生成<br/>Infill Path]
    E --> F[サポート追加<br/>Support Structure]
    F --> G[ツールパス最適化<br/>Retraction/Travel]
    G --> H[G-code出力]

    style A fill:#e3f2fd
    style H fill:#e8f5e9
        </pre>

        <h4>レイヤー高さ（Layer Height）の選択</h4>
        <p>レイヤー高さは造形品質と造形時間のトレードオフを決定する最重要パラメータです：</p>

        <table>
            <tr>
                <th>レイヤー高さ</th>
                <th>造形品質</th>
                <th>造形時間</th>
                <th>典型的な用途</th>
            </tr>
            <tr>
                <td>0.1 mm（極細）</td>
                <td>非常に高い（積層痕ほぼ不可視）</td>
                <td>非常に長い（×2-3倍）</td>
                <td>フィギュア、医療モデル、最終製品</td>
            </tr>
            <tr>
                <td>0.2 mm（標準）</td>
                <td>良好（積層痕は見えるが許容）</td>
                <td>標準</td>
                <td>一般的なプロトタイプ、機能部品</td>
            </tr>
            <tr>
                <td>0.3 mm（粗）</td>
                <td>低い（積層痕明瞭）</td>
                <td>短い（×0.5倍）</td>
                <td>初期プロトタイプ、内部構造部品</td>
            </tr>
        </table>

        <div class="warning-box">
            <strong>⚠️ レイヤー高さの制約</strong>
            <p>レイヤー高さはノズル径の<strong>25-80%</strong>に設定する必要があります。例えば0.4mmノズルの場合、レイヤー高さは0.1-0.32mmが推奨範囲です。これを超えると、樹脂の押出量が不足したり、ノズルが前の層を引きずる問題が発生します。</p>
        </div>

        <h3>1.4.2 シェルとインフィル戦略</h3>

        <h4>シェル（外殻）の生成</h4>
        <p><strong>シェル（Shell/Perimeter）</strong>は、各層の外周部を形成する経路です：</p>

        <ul>
            <li><strong>シェル数（Perimeter Count）</strong>: 通常2-4本。外部品質と強度に影響。
                <ul>
                    <li>1本: 非常に弱い、透明性高い、装飾用のみ</li>
                    <li>2本: 標準（バランス良好）</li>
                    <li>3-4本: 高強度、表面品質向上、気密性向上</li>
                </ul>
            </li>
            <li><strong>シェル順序</strong>: 内側→外側（Inside-Out）が一般的。外側→内側は表面品質重視時に使用。</li>
        </ul>

        <h4>インフィル（内部充填）パターン</h4>
        <p><strong>インフィル（Infill）</strong>は内部構造を形成し、強度と材料使用量を制御します：</p>

        <table>
            <tr>
                <th>パターン</th>
                <th>強度</th>
                <th>印刷速度</th>
                <th>材料使用量</th>
                <th>特徴</th>
            </tr>
            <tr>
                <td>Grid（格子）</td>
                <td>中</td>
                <td>速い</td>
                <td>中</td>
                <td>シンプル、等方性、標準的な選択</td>
            </tr>
            <tr>
                <td>Honeycomb（ハニカム）</td>
                <td>高</td>
                <td>遅い</td>
                <td>中</td>
                <td>高強度、重量比優秀、航空宇宙用途</td>
            </tr>
            <tr>
                <td>Gyroid</td>
                <td>非常に高</td>
                <td>中</td>
                <td>中</td>
                <td>3次元等方性、曲面的、最新の推奨</td>
            </tr>
            <tr>
                <td>Concentric（同心円）</td>
                <td>低</td>
                <td>速い</td>
                <td>少</td>
                <td>柔軟性重視、シェル追従</td>
            </tr>
            <tr>
                <td>Lines（直線）</td>
                <td>低（異方性）</td>
                <td>非常に速い</td>
                <td>少</td>
                <td>高速印刷、方向性強度</td>
            </tr>
        </table>

        <div class="info-box">
            <strong>💡 インフィル密度の目安</strong>
            <ul>
                <li><strong>0-10%</strong>: 装飾品、非荷重部品（材料節約優先）</li>
                <li><strong>20%</strong>: 標準的なプロトタイプ（バランス良好）</li>
                <li><strong>40-60%</strong>: 機能部品、高強度要求</li>
                <li><strong>100%</strong>: 最終製品、水密性要求、最高強度（造形時間×3-5倍）</li>
            </ul>
        </div>

        <h3>1.4.3 サポート構造の生成</h3>

        <p>オーバーハング角度が45度を超える部分は、<strong>サポート構造（Support Structure）</strong>が必要です：</p>

        <h4>サポートのタイプ</h4>
        <ul>
            <li><strong>Linear Support（直線サポート）</strong>: 垂直な柱状サポート。シンプルで除去しやすいが、材料使用量多い。</li>
            <li><strong>Tree Support（ツリーサポート）</strong>: 樹木状に分岐するサポート。材料使用量30-50%削減、除去しやすい。CuraやPrusaSlicerで標準サポート。</li>
            <li><strong>Interface Layers（接合層）</strong>: サポート上面に薄い接合層を設ける。除去しやすく、表面品質向上。通常2-4層。</li>
        </ul>

        <h4>サポート設定の重要パラメータ</h4>
        <table>
            <tr>
                <th>パラメータ</th>
                <th>推奨値</th>
                <th>効果</th>
            </tr>
            <tr>
                <td>Overhang Angle</td>
                <td>45-60°</td>
                <td>この角度以上でサポート生成</td>
            </tr>
            <tr>
                <td>Support Density</td>
                <td>10-20%</td>
                <td>密度が高いほど安定だが除去困難</td>
            </tr>
            <tr>
                <td>Support Z Distance</td>
                <td>0.2-0.3 mm</td>
                <td>サポートと造形物の間隔（除去しやすさ）</td>
            </tr>
            <tr>
                <td>Interface Layers</td>
                <td>2-4層</td>
                <td>接合層数（表面品質と除去性のバランス）</td>
            </tr>
        </table>

        <h3>1.4.4 G-codeの基礎</h3>

        <p><strong>G-code</strong>は、3DプリンタやCNCマシンを制御する標準的な数値制御言語です。各行が1つのコマンドを表します：</p>

        <h4>主要なG-codeコマンド</h4>

        <table>
            <tr>
                <th>コマンド</th>
                <th>分類</th>
                <th>機能</th>
                <th>例</th>
            </tr>
            <tr>
                <td>G0</td>
                <td>移動</td>
                <td>高速移動（非押出）</td>
                <td>G0 X100 Y50 Z10 F6000</td>
            </tr>
            <tr>
                <td>G1</td>
                <td>移動</td>
                <td>直線移動（押出あり）</td>
                <td>G1 X120 Y60 E0.5 F1200</td>
            </tr>
            <tr>
                <td>G28</td>
                <td>初期化</td>
                <td>ホームポジション復帰</td>
                <td>G28 （全軸）, G28 Z （Z軸のみ）</td>
            </tr>
            <tr>
                <td>M104</td>
                <td>温度</td>
                <td>ノズル温度設定（非待機）</td>
                <td>M104 S200</td>
            </tr>
            <tr>
                <td>M109</td>
                <td>温度</td>
                <td>ノズル温度設定（待機）</td>
                <td>M109 S210</td>
            </tr>
            <tr>
                <td>M140</td>
                <td>温度</td>
                <td>ベッド温度設定（非待機）</td>
                <td>M140 S60</td>
            </tr>
            <tr>
                <td>M190</td>
                <td>温度</td>
                <td>ベッド温度設定（待機）</td>
                <td>M190 S60</td>
            </tr>
        </table>

        <h4>G-codeの例（造形開始部分）</h4>
        <pre><code class="language-gcode">; === Start G-code ===
M140 S60       ; ベッドを60°Cに加熱開始（非待機）
M104 S210      ; ノズルを210°Cに加熱開始（非待機）
G28            ; 全軸ホーミング
G29            ; オートレベリング（ベッドメッシュ計測）
M190 S60       ; ベッド温度到達を待機
M109 S210      ; ノズル温度到達を待機
G92 E0         ; 押出量をゼロリセット
G1 Z2.0 F3000  ; Z軸を2mm上昇（安全確保）
G1 X10 Y10 F5000  ; プライム位置へ移動
G1 Z0.3 F3000  ; Z軸を0.3mmへ降下（初層高さ）
G1 X100 E10 F1500 ; プライムライン描画（ノズル詰まり除去）
G92 E0         ; 押出量を再度ゼロリセット
; === 造形開始 ===
</code></pre>

        <h3>1.4.5 主要スライシングソフトウェア</h3>

        <table>
            <tr>
                <th>ソフトウェア</th>
                <th>ライセンス</th>
                <th>特徴</th>
                <th>推奨用途</th>
            </tr>
            <tr>
                <td>Cura</td>
                <td>オープンソース</td>
                <td>使いやすい、豊富なプリセット、Tree Support標準搭載</td>
                <td>初心者〜中級者、FDM汎用</td>
            </tr>
            <tr>
                <td>PrusaSlicer</td>
                <td>オープンソース</td>
                <td>高度な設定、変数レイヤー高さ、カスタムサポート</td>
                <td>中級者〜上級者、最適化重視</td>
            </tr>
            <tr>
                <td>Slic3r</td>
                <td>オープンソース</td>
                <td>PrusaSlicerの元祖、軽量</td>
                <td>レガシーシステム、研究用途</td>
            </tr>
            <tr>
                <td>Simplify3D</td>
                <td>商用（$150）</td>
                <td>高速スライシング、マルチプロセス、詳細制御</td>
                <td>プロフェッショナル、産業用途</td>
            </tr>
            <tr>
                <td>IdeaMaker</td>
                <td>無料</td>
                <td>Raise3D専用だが汎用性高い、直感的UI</td>
                <td>Raise3Dユーザー、初心者</td>
            </tr>
        </table>

        <h3>1.4.6 ツールパス最適化戦略</h3>

        <p>効率的なツールパスは、造形時間・品質・材料使用量を改善します：</p>

        <ul>
            <li><strong>リトラクション（Retraction）</strong>: 移動時にフィラメントを引き戻してストリング（糸引き）を防止。
                <ul>
                    <li>距離: 1-6mm（ボーデンチューブ式は4-6mm、ダイレクト式は1-2mm）</li>
                    <li>速度: 25-45 mm/s</li>
                    <li>過度なリトラクションはノズル詰まりの原因</li>
                </ul>
            </li>
            <li><strong>Z-hop（Z軸跳躍）</strong>: 移動時にノズルを上昇させて造形物との衝突を回避。0.2-0.5mm上昇。造形時間微増だが表面品質向上。</li>
            <li><strong>コーミング（Combing）</strong>: 移動経路をインフィル上に制限し、表面への移動痕を低減。外観重視時に有効。</li>
            <li><strong>シーム位置（Seam Position）</strong>: 各層の開始/終了点を揃える戦略。
                <ul>
                    <li>Random: ランダム配置（目立たない）</li>
                    <li>Aligned: 一直線に配置（後加工でシームを除去しやすい）</li>
                    <li>Sharpest Corner: 最も鋭角なコーナーに配置（目立ちにくい）</li>
                </ul>
            </li>
        </ul>

        <h3>Example 1: STLファイルの読み込みと基本情報取得</h3>
        <pre><code class="language-python"># ===================================
# Example 1: STLファイルの読み込みと基本情報取得
# ===================================

import numpy as np
from stl import mesh

# STLファイルを読み込む
your_mesh = mesh.Mesh.from_file('model.stl')

# 基本的な幾何情報を取得
volume, cog, inertia = your_mesh.get_mass_properties()

print("=== STLファイル基本情報 ===")
print(f"Volume: {volume:.2f} mm³")
print(f"Surface Area: {your_mesh.areas.sum():.2f} mm²")
print(f"Center of Gravity: [{cog[0]:.2f}, {cog[1]:.2f}, {cog[2]:.2f}] mm")
print(f"Number of Triangles: {len(your_mesh.vectors)}")

# バウンディングボックス（最小包含直方体）を計算
min_coords = your_mesh.vectors.min(axis=(0, 1))
max_coords = your_mesh.vectors.max(axis=(0, 1))
dimensions = max_coords - min_coords

print(f"\n=== バウンディングボックス ===")
print(f"X: {min_coords[0]:.2f} to {max_coords[0]:.2f} mm (幅: {dimensions[0]:.2f} mm)")
print(f"Y: {min_coords[1]:.2f} to {max_coords[1]:.2f} mm (奥行: {dimensions[1]:.2f} mm)")
print(f"Z: {min_coords[2]:.2f} to {max_coords[2]:.2f} mm (高さ: {dimensions[2]:.2f} mm)")

# 造形時間の簡易推定（レイヤー高さ0.2mm、速度50mm/sと仮定）
layer_height = 0.2  # mm
print_speed = 50    # mm/s
num_layers = int(dimensions[2] / layer_height)
# 簡易計算: 表面積に基づく推定
estimated_path_length = your_mesh.areas.sum() / layer_height  # mm
estimated_time_seconds = estimated_path_length / print_speed
estimated_time_minutes = estimated_time_seconds / 60

print(f"\n=== 造形推定 ===")
print(f"レイヤー数（0.2mm/層）: {num_layers} 層")
print(f"推定造形時間: {estimated_time_minutes:.1f} 分 ({estimated_time_minutes/60:.2f} 時間)")

# 出力例:
# === STLファイル基本情報 ===
# Volume: 12450.75 mm³
# Surface Area: 5832.42 mm²
# Center of Gravity: [25.34, 18.92, 15.67] mm
# Number of Triangles: 2456
#
# === バウンディングボックス ===
# X: 0.00 to 50.00 mm (幅: 50.00 mm)
# Y: 0.00 to 40.00 mm (奥行: 40.00 mm)
# Z: 0.00 to 30.00 mm (高さ: 30.00 mm)
#
# === 造形推定 ===
# レイヤー数（0.2mm/層）: 150 層
# 推定造形時間: 97.2 分 (1.62 時間)
</code></pre>

        <h3>Example 2: メッシュの法線ベクトル検証</h3>
        <pre><code class="language-python"># ===================================
# Example 2: メッシュの法線ベクトル検証
# ===================================

import numpy as np
from stl import mesh

def check_normals(mesh_data):
    """STLメッシュの法線ベクトルの整合性をチェック

    Args:
        mesh_data: numpy-stlのMeshオブジェクト

    Returns:
        tuple: (flipped_count, total_count, percentage)
    """
    # 右手系ルールで法線方向を確認
    flipped_count = 0
    total_count = len(mesh_data.vectors)

    for i, facet in enumerate(mesh_data.vectors):
        v0, v1, v2 = facet

        # エッジベクトルを計算
        edge1 = v1 - v0
        edge2 = v2 - v0

        # 外積で法線を計算（右手系）
        calculated_normal = np.cross(edge1, edge2)

        # 正規化
        norm = np.linalg.norm(calculated_normal)
        if norm > 1e-10:  # ゼロベクトルでないことを確認
            calculated_normal = calculated_normal / norm
        else:
            continue  # 縮退三角形をスキップ

        # ファイルに保存されている法線と比較
        stored_normal = mesh_data.normals[i]
        stored_norm = np.linalg.norm(stored_normal)

        if stored_norm > 1e-10:
            stored_normal = stored_normal / stored_norm

        # 内積で方向の一致をチェック
        dot_product = np.dot(calculated_normal, stored_normal)

        # 内積が負なら逆向き
        if dot_product < 0:
            flipped_count += 1

    percentage = (flipped_count / total_count) * 100 if total_count > 0 else 0

    return flipped_count, total_count, percentage

# STLファイルを読み込み
your_mesh = mesh.Mesh.from_file('model.stl')

# 法線チェックを実行
flipped, total, percent = check_normals(your_mesh)

print("=== 法線ベクトル検証結果 ===")
print(f"総三角形数: {total}")
print(f"反転法線数: {flipped}")
print(f"反転率: {percent:.2f}%")

if flipped == 0:
    print("\n✅ すべての法線が正しい方向を向いています")
    print("   このメッシュは3Dプリント可能です")
elif percent < 5:
    print("\n⚠️ 一部の法線が反転しています（軽微）")
    print("   スライサーが自動修正する可能性が高い")
else:
    print("\n❌ 多数の法線が反転しています（重大）")
    print("   メッシュ修復ツール（Meshmixer, netfabb）での修正を推奨")

# 出力例:
# === 法線ベクトル検証結果 ===
# 総三角形数: 2456
# 反転法線数: 0
# 反転率: 0.00%
#
# ✅ すべての法線が正しい方向を向いています
#    このメッシュは3Dプリント可能です
</code></pre>

        <h3>Example 3: マニフォールド性のチェック</h3>
        <pre><code class="language-python"># ===================================
# Example 3: マニフォールド性（Watertight）のチェック
# ===================================

import trimesh

# STLファイルを読み込み（trimeshは自動で修復を試みる）
mesh = trimesh.load('model.stl')

print("=== メッシュ品質診断 ===")

# 基本情報
print(f"Vertex count: {len(mesh.vertices)}")
print(f"Face count: {len(mesh.faces)}")
print(f"Volume: {mesh.volume:.2f} mm³")

# マニフォールド性をチェック
print(f"\n=== 3Dプリント適性チェック ===")
print(f"Is watertight (密閉性): {mesh.is_watertight}")
print(f"Is winding consistent (法線一致性): {mesh.is_winding_consistent}")
print(f"Is valid (幾何的妥当性): {mesh.is_valid}")

# 問題の詳細を診断
if not mesh.is_watertight:
    # 穴（hole）の数を検出
    try:
        edges = mesh.edges_unique
        edges_sorted = mesh.edges_sorted
        duplicate_edges = len(edges_sorted) - len(edges)
        print(f"\n⚠️ 問題検出:")
        print(f"   - メッシュに穴があります")
        print(f"   - 重複エッジ数: {duplicate_edges}")
    except:
        print(f"\n⚠️ メッシュ構造に問題があります")

# 修復を試みる
if not mesh.is_watertight or not mesh.is_winding_consistent:
    print(f"\n🔧 自動修復を実行中...")

    # 法線を修正
    trimesh.repair.fix_normals(mesh)
    print("   ✓ 法線ベクトルを修正")

    # 穴を埋める
    trimesh.repair.fill_holes(mesh)
    print("   ✓ 穴を充填")

    # 縮退三角形を削除
    mesh.remove_degenerate_faces()
    print("   ✓ 縮退面を削除")

    # 重複頂点を結合
    mesh.merge_vertices()
    print("   ✓ 重複頂点を結合")

    # 修復後の状態を確認
    print(f"\n=== 修復後の状態 ===")
    print(f"Is watertight: {mesh.is_watertight}")
    print(f"Is winding consistent: {mesh.is_winding_consistent}")

    # 修復したメッシュを保存
    if mesh.is_watertight:
        mesh.export('model_repaired.stl')
        print(f"\n✅ 修復完了！ model_repaired.stl として保存しました")
    else:
        print(f"\n❌ 自動修復失敗。Meshmixer等の専用ツールを推奨")
else:
    print(f"\n✅ このメッシュは3Dプリント可能です")

# 出力例:
# === メッシュ品質診断 ===
# Vertex count: 1534
# Face count: 2456
# Volume: 12450.75 mm³
#
# === 3Dプリント適性チェック ===
# Is watertight (密閉性): True
# Is winding consistent (法線一致性): True
# Is valid (幾何的妥当性): True
#
# ✅ このメッシュは3Dプリント可能です
</code></pre>

        <h3>Example 4: 基本的なスライシングアルゴリズム</h3>
        <pre><code class="language-python"># ===================================
# Example 4: 基本的なスライシングアルゴリズム
# ===================================

import numpy as np
from stl import mesh

def slice_mesh_at_height(mesh_data, z_height):
    """温度プロファイルを生成

    Args:
        t (array): 時間配列 [min]
        T_target (float): 保持温度 [°C]
        heating_rate (float): 加熱速度 [°C/min]
        hold_time (float): 保持時間 [min]
        cooling_rate (float): 冷却速度 [°C/min]

    Returns:
        array: 温度プロファイル [°C]
    """
    T_room = 25  # 室温
    T = np.zeros_like(t)

    # 加熱時間
    t_heat = (T_target - T_room) / heating_rate

    # 冷却開始時刻
    t_cool_start = t_heat + hold_time

    for i, time in enumerate(t):
        if time <= t_heat:
            # 加熱フェーズ
            T[i] = T_room + heating_rate * time
        elif time <= t_cool_start:
            # 保持フェーズ
            T[i] = T_target
        else:
            # 冷却フェーズ
            T[i] = T_target - cooling_rate * (time - t_cool_start)
            T[i] = max(T[i], T_room)  # 室温以下にはならない

    return T

def simulate_reaction_progress(T, t, Ea, D0, r0):
    """温度プロファイルに基づく反応進行を計算

    Args:
        T (array): 温度プロファイル [°C]
        t (array): 時間配列 [min]
        Ea (float): 活性化エネルギー [J/mol]
        D0 (float): 頻度因子 [m²/s]
        r0 (float): 粒子半径 [m]

    Returns:
        array: 反応率
    """
    R = 8.314
    C0 = 10000
    alpha = np.zeros_like(t)

    for i in range(1, len(t)):
        T_k = T[i] + 273.15
        D = D0 * np.exp(-Ea / (R * T_k))
        k = D * C0 / r0**2

        dt = (t[i] - t[i-1]) * 60  # min → s

        # 簡易積分（微小時間での反応進行）
        if alpha[i-1] < 0.99:
            dalpha = k * dt / (2 * (1 - (1-alpha[i-1])**(1/3)))
            alpha[i] = min(alpha[i-1] + dalpha, 1.0)
        else:
            alpha[i] = alpha[i-1]

    return alpha

# パラメータ設定
T_target = 1200  # °C
hold_time = 240  # min (4 hours)
Ea = 300e3  # J/mol
D0 = 5e-4  # m²/s
r0 = 5e-6  # m

# 異なる加熱速度での比較
heating_rates = [2, 5, 10, 20]  # °C/min
cooling_rate = 3  # °C/min

# 時間配列
t_max = 800  # min
t = np.linspace(0, t_max, 2000)

# プロット
fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 10))

# 温度プロファイル
for hr in heating_rates:
    T_profile = temperature_profile(t, T_target, hr, hold_time, cooling_rate)
    ax1.plot(t/60, T_profile, linewidth=2, label=f'{hr}°C/min')

ax1.set_xlabel('Time (hours)', fontsize=12)
ax1.set_ylabel('Temperature (°C)', fontsize=12)
ax1.set_title('Temperature Profiles', fontsize=14, fontweight='bold')
ax1.legend(fontsize=10)
ax1.grid(True, alpha=0.3)
ax1.set_xlim([0, t_max/60])

# 反応進行
for hr in heating_rates:
    T_profile = temperature_profile(t, T_target, hr, hold_time, cooling_rate)
    alpha = simulate_reaction_progress(T_profile, t, Ea, D0, r0)
    ax2.plot(t/60, alpha, linewidth=2, label=f'{hr}°C/min')

ax2.axhline(y=0.95, color='red', linestyle='--', linewidth=1, label='Target (95%)')
ax2.set_xlabel('Time (hours)', fontsize=12)
ax2.set_ylabel('Conversion', fontsize=12)
ax2.set_title('Reaction Progress', fontsize=14, fontweight='bold')
ax2.legend(fontsize=10)
ax2.grid(True, alpha=0.3)
ax2.set_xlim([0, t_max/60])
ax2.set_ylim([0, 1])

plt.tight_layout()
plt.savefig('temperature_profile_optimization.png', dpi=300, bbox_inches='tight')
plt.show()

# 各加熱速度での95%反応到達時間を計算
print("\n95%反応到達時間の比較:")
print("=" * 60)
for hr in heating_rates:
    T_profile = temperature_profile(t, T_target, hr, hold_time, cooling_rate)
    alpha = simulate_reaction_progress(T_profile, t, Ea, D0, r0)

    # 95%到達時刻
    idx_95 = np.where(alpha >= 0.95)[0]
    if len(idx_95) > 0:
        t_95 = t[idx_95[0]] / 60
        print(f"加熱速度 {hr:2d}°C/min: t₉₅ = {t_95:.1f} hours")
    else:
        print(f"加熱速度 {hr:2d}°C/min: 反応不完全")

# 出力例:
# 95%反応到達時間の比較:
# ============================================================
# 加熱速度  2°C/min: t₉₅ = 7.8 hours
# 加熱速度  5°C/min: t₉₅ = 7.2 hours
# 加熱速度 10°C/min: t₉₅ = 6.9 hours
# 加熱速度 20°C/min: t₉₅ = 6.7 hours
</code></pre>

        <h2>演習問題</h2>

        <h3>1.5.1 pycalphadとは</h3>
        <p><strong>pycalphad</strong>は、CALPHAD（CALculation of PHAse Diagrams）法に基づく相図計算のためのPythonライブラリです。熱力学データベースから平衡相を計算し、反応経路の設計に有用です。</p>

        <div class="info-box">
            <strong>💡 CALPHAD法の利点</strong>
            <ul>
                <li>多元系（3元系以上）の複雑な相図を計算可能</li>
                <li>実験データが少ない系でも予測可能</li>
                <li>温度・組成・圧力依存性を包括的に扱える</li>
            </ul>
        </div>

        <h3>1.5.2 二元系相図の計算例</h3>
        <pre><code class="language-python"># ===================================
# Example 5: pycalphadで相図計算
# ===================================

# 注意: pycalphadのインストールが必要
# pip install pycalphad

from pycalphad import Database, equilibrium, variables as v
import matplotlib.pyplot as plt
import numpy as np

# TDBデータベースを読み込み（ここでは簡易的な例）
# 実際には適切なTDBファイルが必要
# 例: BaO-TiO2系

# 簡易的なTDB文字列（実際はより複雑）
tdb_string = """
$ BaO-TiO2 system (simplified)
ELEMENT BA   BCC_A2  137.327   !
ELEMENT TI   HCP_A3   47.867   !
ELEMENT O    GAS      15.999   !

FUNCTION GBCCBA   298.15  +GHSERBA;   6000 N !
FUNCTION GHCPTI   298.15  +GHSERTI;   6000 N !
FUNCTION GGASO    298.15  +GHSERO;    6000 N !

PHASE LIQUID:L %  1  1.0  !
PHASE BAO_CUBIC %  2  1 1  !
PHASE TIO2_RUTILE %  2  1 2  !
PHASE BATIO3 %  3  1 1 3  !
"""

# 注: 実際の計算には正式なTDBファイルが必要
# ここでは概念的な説明に留める

print("pycalphadによる相図計算の概念:")
print("=" * 60)
print("1. TDBデータベース（熱力学データ）を読み込む")
print("2. 温度・組成範囲を設定")
print("3. 平衡計算を実行")
print("4. 安定相を可視化")
print()
print("実際の適用例:")
print("- BaO-TiO2系: BaTiO3の形成温度・組成範囲")
print("- Si-N系: Si3N4の安定領域")
print("- 多元系セラミックスの相関係")

# 概念的なプロット（実データに基づくイメージ）
fig, ax = plt.subplots(figsize=(10, 7))

# 温度範囲
T = np.linspace(800, 1600, 100)

# 各相の安定領域（概念図）
# BaO + TiO2 → BaTiO3 反応
BaO_region = np.ones_like(T) * 0.3
TiO2_region = np.ones_like(T) * 0.7
BaTiO3_region = np.where((T > 1100) & (T < 1400), 0.5, np.nan)

ax.fill_between(T, 0, BaO_region, alpha=0.3, color='blue', label='BaO + TiO2')
ax.fill_between(T, BaO_region, TiO2_region, alpha=0.3, color='green',
                label='BaTiO3 stable')
ax.fill_between(T, TiO2_region, 1, alpha=0.3, color='red', label='Liquid')

ax.axhline(y=0.5, color='black', linestyle='--', linewidth=2,
           label='BaTiO3 composition')
ax.axvline(x=1100, color='gray', linestyle=':', linewidth=1, alpha=0.5)
ax.axvline(x=1400, color='gray', linestyle=':', linewidth=1, alpha=0.5)

ax.set_xlabel('Temperature (°C)', fontsize=12)
ax.set_ylabel('Composition (BaO mole fraction)', fontsize=12)
ax.set_title('Conceptual Phase Diagram: BaO-TiO2', fontsize=14, fontweight='bold')
ax.legend(fontsize=10, loc='upper right')
ax.grid(True, alpha=0.3)
ax.set_xlim([800, 1600])
ax.set_ylim([0, 1])

# テキスト注釈
ax.text(1250, 0.5, 'BaTiO₃\nformation\nregion',
        fontsize=11, ha='center', va='center',
        bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.7))

plt.tight_layout()
plt.savefig('phase_diagram_concept.png', dpi=300, bbox_inches='tight')
plt.show()

# 実際の使用例（コメントアウト）
"""
# 実際のpycalphad使用例
db = Database('BaO-TiO2.tdb')  # TDBファイル読み込み

# 平衡計算
eq = equilibrium(db, ['BA', 'TI', 'O'], ['LIQUID', 'BATIO3'],
                 {v.X('BA'): (0, 1, 0.01),
                  v.T: (1000, 1600, 50),
                  v.P: 101325})

# 結果プロット
eq.plot()
"""
</code></pre>

        <h2>1.6 実験計画法（DOE）による条件最適化</h2>

        <h3>1.6.1 DOEとは</h3>
        <p>実験計画法（Design of Experiments, DOE）は、複数のパラメータが相互作用する系で、最小の実験回数で最適条件を見つける統計手法です。</p>

        <p><strong>固相反応で最適化すべき主要パラメータ：</strong></p>
        <ul>
            <li>反応温度（T）</li>
            <li>保持時間（t）</li>
            <li>粒子サイズ（r）</li>
            <li>原料比（モル比）</li>
            <li>雰囲気（空気、窒素、真空など）</li>
        </ul>

        <h3>1.6.2 応答曲面法（Response Surface Methodology）</h3>
        <pre><code class="language-python"># ===================================
# Example 6: DOEによる条件最適化
# ===================================

import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D
from scipy.optimize import minimize

# 仮想的な反応率モデル（温度と時間の関数）
def reaction_yield(T, t, noise=0):
    """温度と時間から反応率を計算（仮想モデル）

    Args:
        T (float): 温度 [°C]
        t (float): 時間 [hours]
        noise (float): ノイズレベル

    Returns:
        float: 反応率 [%]
    """
    # 最適値: T=1200°C, t=6 hours
    T_opt = 1200
    t_opt = 6

    # 二次モデル（ガウス型）
    yield_val = 100 * np.exp(-((T-T_opt)/150)**2 - ((t-t_opt)/3)**2)

    # ノイズ追加
    if noise > 0:
        yield_val += np.random.normal(0, noise)

    return np.clip(yield_val, 0, 100)

# 実験点配置（中心複合計画法）
T_levels = [1000, 1100, 1200, 1300, 1400]  # °C
t_levels = [2, 4, 6, 8, 10]  # hours

# グリッドで実験点を配置
T_grid, t_grid = np.meshgrid(T_levels, t_levels)
yield_grid = np.zeros_like(T_grid, dtype=float)

# 各実験点で反応率を測定（シミュレーション）
for i in range(len(t_levels)):
    for j in range(len(T_levels)):
        yield_grid[i, j] = reaction_yield(T_grid[i, j], t_grid[i, j], noise=2)

# 結果の表示
print("実験計画法による反応条件最適化")
print("=" * 70)
print(f"{'Temperature (°C)':<20} {'Time (hours)':<20} {'Yield (%)':<20}")
print("-" * 70)
for i in range(len(t_levels)):
    for j in range(len(T_levels)):
        print(f"{T_grid[i, j]:<20} {t_grid[i, j]:<20} {yield_grid[i, j]:<20.1f}")

# 最大反応率の条件を探す
max_idx = np.unravel_index(np.argmax(yield_grid), yield_grid.shape)
T_best = T_grid[max_idx]
t_best = t_grid[max_idx]
yield_best = yield_grid[max_idx]

print("-" * 70)
print(f"最適条件: T = {T_best}°C, t = {t_best} hours")
print(f"最大反応率: {yield_best:.1f}%")

# 3Dプロット
fig = plt.figure(figsize=(14, 6))

# 3D表面プロット
ax1 = fig.add_subplot(121, projection='3d')
T_fine = np.linspace(1000, 1400, 50)
t_fine = np.linspace(2, 10, 50)
T_mesh, t_mesh = np.meshgrid(T_fine, t_fine)
yield_mesh = np.zeros_like(T_mesh)

for i in range(len(t_fine)):
    for j in range(len(T_fine)):
        yield_mesh[i, j] = reaction_yield(T_mesh[i, j], t_mesh[i, j])

surf = ax1.plot_surface(T_mesh, t_mesh, yield_mesh, cmap='viridis',
                        alpha=0.8, edgecolor='none')
ax1.scatter(T_grid, t_grid, yield_grid, color='red', s=50,
            label='Experimental points')

ax1.set_xlabel('Temperature (°C)', fontsize=10)
ax1.set_ylabel('Time (hours)', fontsize=10)
ax1.set_zlabel('Yield (%)', fontsize=10)
ax1.set_title('Response Surface', fontsize=12, fontweight='bold')
ax1.view_init(elev=25, azim=45)
fig.colorbar(surf, ax=ax1, shrink=0.5, aspect=5)

# 等高線プロット
ax2 = fig.add_subplot(122)
contour = ax2.contourf(T_mesh, t_mesh, yield_mesh, levels=20, cmap='viridis')
ax2.contour(T_mesh, t_mesh, yield_mesh, levels=10, colors='black',
            alpha=0.3, linewidths=0.5)
ax2.scatter(T_grid, t_grid, c=yield_grid, s=100, edgecolors='red',
            linewidths=2, cmap='viridis')
ax2.scatter(T_best, t_best, color='red', s=300, marker='*',
            edgecolors='white', linewidths=2, label='Optimum')

ax2.set_xlabel('Temperature (°C)', fontsize=11)
ax2.set_ylabel('Time (hours)', fontsize=11)
ax2.set_title('Contour Map', fontsize=12, fontweight='bold')
ax2.legend(fontsize=10)
fig.colorbar(contour, ax=ax2, label='Yield (%)')

plt.tight_layout()
plt.savefig('doe_optimization.png', dpi=300, bbox_inches='tight')
plt.show()
</code></pre>

        <h3>1.6.3 実験計画の実践的アプローチ</h3>
        <p>実際の固相反応では、以下の手順でDOEを適用します：</p>

        <ol>
            <li><strong>スクリーニング実験</strong>（2水準要因計画法）: 影響の大きいパラメータを特定</li>
            <li><strong>応答曲面法</strong>（中心複合計画法）: 最適条件の探索</li>
            <li><strong>確認実験</strong>: 予測された最適条件で実験し、モデルを検証</li>
        </ol>

        <div class="success-box">
            <strong>✅ 実例: Li-ion電池正極材LiCoO₂の合成最適化</strong>
            <p>ある研究グループがDOEを用いてLiCoO₂の合成条件を最適化した結果：</p>
            <ul>
                <li>実験回数: 従来法100回 → DOE法25回（75%削減）</li>
                <li>最適温度: 900°C（従来の850°Cより高温）</li>
                <li>最適保持時間: 12時間（従来の24時間から半減）</li>
                <li>電池容量: 140 mAh/g → 155 mAh/g（11%向上）</li>
            </ul>
        </div>

        <h2>1.7 反応速度曲線のフィッティング</h2>

        <h3>1.7.1 実験データからの速度定数決定</h3>
        <pre><code class="language-python"># ===================================
# Example 7: 反応速度曲線フィッティング
# ===================================

import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

# 実験データ（時間 vs 反応率）
# 例: BaTiO3合成 @ 1200°C
time_exp = np.array([0, 1, 2, 3, 4, 6, 8, 10, 12, 15, 20])  # hours
conversion_exp = np.array([0, 0.15, 0.28, 0.38, 0.47, 0.60,
                          0.70, 0.78, 0.84, 0.90, 0.95])

# Jander式モデル
def jander_model(t, k):
    """Jander式による反応率計算

    Args:
        t (array): 時間 [hours]
        k (float): 速度定数

    Returns:
        array: 反応率
    """
    # [1 - (1-α)^(1/3)]² = kt を α について解く
    kt = k * t
    alpha = 1 - (1 - np.sqrt(kt))**3
    alpha = np.clip(alpha, 0, 1)  # 0-1の範囲に制限
    return alpha

# Ginstling-Brounshtein式（別の拡散モデル）
def gb_model(t, k):
    """Ginstling-Brounshtein式

    Args:
        t (array): 時間
        k (float): 速度定数

    Returns:
        array: 反応率
    """
    # 1 - 2α/3 - (1-α)^(2/3) = kt
    # 数値的に解く必要があるが、ここでは近似式を使用
    kt = k * t
    alpha = 1 - (1 - kt/2)**(3/2)
    alpha = np.clip(alpha, 0, 1)
    return alpha

# Power law (経験式)
def power_law_model(t, k, n):
    """べき乗則モデル

    Args:
        t (array): 時間
        k (float): 速度定数
        n (float): 指数

    Returns:
        array: 反応率
    """
    alpha = k * t**n
    alpha = np.clip(alpha, 0, 1)
    return alpha

# 各モデルでフィッティング
# Jander式
popt_jander, _ = curve_fit(jander_model, time_exp, conversion_exp, p0=[0.01])
k_jander = popt_jander[0]

# Ginstling-Brounshtein式
popt_gb, _ = curve_fit(gb_model, time_exp, conversion_exp, p0=[0.01])
k_gb = popt_gb[0]

# Power law
popt_power, _ = curve_fit(power_law_model, time_exp, conversion_exp, p0=[0.1, 0.5])
k_power, n_power = popt_power

# 予測曲線生成
t_fit = np.linspace(0, 20, 200)
alpha_jander = jander_model(t_fit, k_jander)
alpha_gb = gb_model(t_fit, k_gb)
alpha_power = power_law_model(t_fit, k_power, n_power)

# 残差計算
residuals_jander = conversion_exp - jander_model(time_exp, k_jander)
residuals_gb = conversion_exp - gb_model(time_exp, k_gb)
residuals_power = conversion_exp - power_law_model(time_exp, k_power, n_power)

# R²計算
def r_squared(y_true, y_pred):
    ss_res = np.sum((y_true - y_pred)**2)
    ss_tot = np.sum((y_true - np.mean(y_true))**2)
    return 1 - (ss_res / ss_tot)

r2_jander = r_squared(conversion_exp, jander_model(time_exp, k_jander))
r2_gb = r_squared(conversion_exp, gb_model(time_exp, k_gb))
r2_power = r_squared(conversion_exp, power_law_model(time_exp, k_power, n_power))

# プロット
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))

# フィッティング結果
ax1.plot(time_exp, conversion_exp, 'ko', markersize=8, label='Experimental data')
ax1.plot(t_fit, alpha_jander, 'b-', linewidth=2,
         label=f'Jander (R²={r2_jander:.4f})')
ax1.plot(t_fit, alpha_gb, 'r-', linewidth=2,
         label=f'Ginstling-Brounshtein (R²={r2_gb:.4f})')
ax1.plot(t_fit, alpha_power, 'g-', linewidth=2,
         label=f'Power law (R²={r2_power:.4f})')

ax1.set_xlabel('Time (hours)', fontsize=12)
ax1.set_ylabel('Conversion', fontsize=12)
ax1.set_title('Kinetic Model Fitting', fontsize=14, fontweight='bold')
ax1.legend(fontsize=10)
ax1.grid(True, alpha=0.3)
ax1.set_xlim([0, 20])
ax1.set_ylim([0, 1])

# 残差プロット
ax2.plot(time_exp, residuals_jander, 'bo-', label='Jander')
ax2.plot(time_exp, residuals_gb, 'ro-', label='Ginstling-Brounshtein')
ax2.plot(time_exp, residuals_power, 'go-', label='Power law')
ax2.axhline(y=0, color='black', linestyle='--', linewidth=1)

ax2.set_xlabel('Time (hours)', fontsize=12)
ax2.set_ylabel('Residuals', fontsize=12)
ax2.set_title('Residual Plot', fontsize=14, fontweight='bold')
ax2.legend(fontsize=10)
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('kinetic_fitting.png', dpi=300, bbox_inches='tight')
plt.show()

# 結果サマリー
print("\n反応速度モデルのフィッティング結果:")
print("=" * 70)
print(f"{'Model':<25} {'Parameter':<30} {'R²':<10}")
print("-" * 70)
print(f"{'Jander':<25} {'k = ' + f'{k_jander:.4f} h⁻¹':<30} {r2_jander:.4f}")
print(f"{'Ginstling-Brounshtein':<25} {'k = ' + f'{k_gb:.4f} h⁻¹':<30} {r2_gb:.4f}")
print(f"{'Power law':<25} {'k = ' + f'{k_power:.4f}, n = {n_power:.4f}':<30} {r2_power:.4f}")
print("=" * 70)
print(f"\n最適モデル: {'Jander' if r2_jander == max(r2_jander, r2_gb, r2_power) else 'GB' if r2_gb == max(r2_jander, r2_gb, r2_power) else 'Power law'}")

# 出力例:
# 反応速度モデルのフィッティング結果:
# ======================================================================
# Model                     Parameter                      R²
# ----------------------------------------------------------------------
# Jander                    k = 0.0289 h⁻¹                 0.9953
# Ginstling-Brounshtein     k = 0.0412 h⁻¹                 0.9867
# Power law                 k = 0.2156, n = 0.5234         0.9982
# ======================================================================
#
# 最適モデル: Power law
</code></pre>

        <h2>1.8 高度なトピック: 微細構造制御</h2>

        <h3>1.8.1 粒成長の抑制</h3>
        <p>固相反応では、高温・長時間保持により望ましくない粒成長が起こります。これを抑制する戦略：</p>

        <ul>
            <li><strong>Two-step sintering</strong>: 高温で短時間保持後、低温で長時間保持</li>
            <li><strong>添加剤の使用</strong>: 粒成長抑制剤（例: MgO, Al₂O₃）を微量添加</li>
            <li><strong>Spark Plasma Sintering (SPS)</strong>: 急速加熱・短時間焼結</li>
        </ul>

        <h3>1.8.2 反応の機械化学的活性化</h3>
        <p>メカノケミカル法（高エネルギーボールミル）により、固相反応を室温付近で進行させることも可能です：</p>

        <pre><code class="language-python"># ===================================
# Example 8: 粒成長シミュレーション
# ===================================

import numpy as np
import matplotlib.pyplot as plt

def grain_growth(t, T, D0, Ea, G0, n):
    """粒成長の時間発展

    Burke-Turnbull式: G^n - G0^n = k*t

    Args:
        t (array): 時間 [hours]
        T (float): 温度 [K]
        D0 (float): 頻度因子
        Ea (float): 活性化エネルギー [J/mol]
        G0 (float): 初期粒径 [μm]
        n (float): 粒成長指数（通常2-4）

    Returns:
        array: 粒径 [μm]
    """
    R = 8.314
    k = D0 * np.exp(-Ea / (R * T))
    G = (G0**n + k * t * 3600)**(1/n)  # hours → seconds
    return G

# パラメータ設定
D0_grain = 1e8  # μm^n/s
Ea_grain = 400e3  # J/mol
G0 = 0.5  # μm
n = 3

# 温度の影響
temps_celsius = [1100, 1200, 1300]
t_range = np.linspace(0, 12, 100)  # 0-12 hours

plt.figure(figsize=(12, 5))

# 温度依存性
plt.subplot(1, 2, 1)
for T_c in temps_celsius:
    T_k = T_c + 273.15
    G = grain_growth(t_range, T_k, D0_grain, Ea_grain, G0, n)
    plt.plot(t_range, G, linewidth=2, label=f'{T_c}°C')

plt.axhline(y=1.0, color='red', linestyle='--', linewidth=1,
            label='Target grain size')
plt.xlabel('Time (hours)', fontsize=12)
plt.ylabel('Grain Size (μm)', fontsize=12)
plt.title('Grain Growth at Different Temperatures', fontsize=14, fontweight='bold')
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.ylim([0, 5])

# Two-step sinteringの効果
plt.subplot(1, 2, 2)

# Conventional sintering: 1300°C, 6 hours
t_conv = np.linspace(0, 6, 100)
T_conv = 1300 + 273.15
G_conv = grain_growth(t_conv, T_conv, D0_grain, Ea_grain, G0, n)

# Two-step: 1300°C 1h → 1200°C 5h
t1 = np.linspace(0, 1, 20)
G1 = grain_growth(t1, 1300+273.15, D0_grain, Ea_grain, G0, n)
G_intermediate = G1[-1]

t2 = np.linspace(0, 5, 80)
G2 = grain_growth(t2, 1200+273.15, D0_grain, Ea_grain, G_intermediate, n)

t_two_step = np.concatenate([t1, t2 + 1])
G_two_step = np.concatenate([G1, G2])

plt.plot(t_conv, G_conv, 'r-', linewidth=2, label='Conventional (1300°C)')
plt.plot(t_two_step, G_two_step, 'b-', linewidth=2, label='Two-step (1300°C→1200°C)')
plt.axvline(x=1, color='gray', linestyle=':', linewidth=1, alpha=0.5)

plt.xlabel('Time (hours)', fontsize=12)
plt.ylabel('Grain Size (μm)', fontsize=12)
plt.title('Two-Step Sintering Strategy', fontsize=14, fontweight='bold')
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.ylim([0, 5])

plt.tight_layout()
plt.savefig('grain_growth_control.png', dpi=300, bbox_inches='tight')
plt.show()

# 最終粒径の比較
G_final_conv = grain_growth(6, 1300+273.15, D0_grain, Ea_grain, G0, n)
G_final_two_step = G_two_step[-1]

print("\n粒成長の比較:")
print("=" * 50)
print(f"Conventional (1300°C, 6h): {G_final_conv:.2f} μm")
print(f"Two-step (1300°C 1h + 1200°C 5h): {G_final_two_step:.2f} μm")
print(f"粒径抑制効果: {(1 - G_final_two_step/G_final_conv)*100:.1f}%")

# 出力例:
# 粒成長の比較:
# ==================================================
# Conventional (1300°C, 6h): 4.23 μm
# Two-step (1300°C 1h + 1200°C 5h): 2.87 μm
# 粒径抑制効果: 32.2%
</code></pre>

        <h2>学習目標の確認</h2>
        <p>この章を完了すると、以下を説明できるようになります：</p>

        <h3>基本理解</h3>
        <ul>
            <li>✅ 固相反応の3つの律速段階（核生成・界面反応・拡散）を説明できる</li>
            <li>✅ Arrhenius式の物理的意味と温度依存性を理解している</li>
            <li>✅ Jander式とGinstling-Brounshtein式の違いを説明できる</li>
            <li>✅ 温度プロファイルの3要素（加熱速度・保持時間・冷却速度）の重要性を理解している</li>
        </ul>

        <h3>実践スキル</h3>
        <ul>
            <li>✅ Pythonで拡散係数の温度依存性をシミュレートできる</li>
            <li>✅ Jander式を用いて反応進行を予測できる</li>
            <li>✅ Kissinger法でDSC/TGデータから活性化エネルギーを計算できる</li>
            <li>✅ DOE（実験計画法）で反応条件を最適化できる</li>
            <li>✅ pycalphadを用いた相図計算の基礎を理解している</li>
        </ul>

        <h3>応用力</h3>
        <ul>
            <li>✅ 新規セラミックス材料の合成プロセスを設計できる</li>
            <li>✅ 実験データから反応機構を推定し、適切な速度式を選択できる</li>
            <li>✅ 産業プロセスでの条件最適化戦略を立案できる</li>
            <li>✅ 粒成長制御の戦略（Two-step sintering等）を提案できる</li>
        </ul>

        <h2>演習問題</h2>

        <h3>Easy（基礎確認）</h3>

        <div class="exercise">
            <div class="exercise-title">Q1: STLファイル形式の理解</div>
            <p>STLファイルのASCII形式とBinary形式について、正しい説明はどれですか？</p>
            <p>a) ASCII形式の方がファイルサイズが小さい<br>
            b) Binary形式は人間が直接読めるテキスト形式<br>
            c) Binary形式は通常ASCII形式の5-10倍小さいファイルサイズ<br>
            d) Binary形式はASCII形式より精度が低い</p>

            <details>
                <summary>解答を表示</summary>
                <p><strong>正解: c) Binary形式は通常ASCII形式の5-10倍小さいファイルサイズ</strong></p>
                <p><strong>解説:</strong></p>
                <ul>
                    <li><strong>ASCII STL</strong>: テキスト形式で人間が読める。各三角形が7行（facet、normal、3頂点、endfacet）で記述される。大きなファイルサイズ（数十MB〜数百MB）。</li>
                    <li><strong>Binary STL</strong>: バイナリ形式で小型。80バイトヘッダー + 4バイト三角形数 + 各三角形50バイト。同じ形状でASCIIの1/5〜1/10のサイズ。</li>
                    <li>精度は両形式とも同じ（32-bit浮動小数点数）</li>
                    <li>現代の3Dプリンタソフトは両形式をサポート、Binary推奨</li>
                </ul>
                <p><strong>実例:</strong> 10,000三角形のモデル → ASCII: 約7MB、Binary: 約0.5MB</p>
            </details>
        </div>

        <div class="exercise">
            <div class="exercise-title">Q2: 造形時間の簡易計算</div>
            <p>体積12,000 mm³、高さ30 mmの造形物を、レイヤー高さ0.2 mm、印刷速度50 mm/sで造形します。おおよその造形時間はどれですか？（インフィル20%、壁2層と仮定）</p>
            <p>a) 30分<br>
            b) 60分<br>
            c) 90分<br>
            d) 120分</p>

            <details>
                <summary>解答を表示</summary>
                <p><strong>正解: c) 90分（約1.5時間）</strong></p>
                <p><strong>計算手順:</strong></p>
                <ol>
                    <li><strong>レイヤー数</strong>: 高さ30mm ÷ レイヤー高さ0.2mm = 150層</li>
                    <li><strong>1層あたりの経路長さの推定</strong>:
                        <ul>
                            <li>体積12,000mm³ → 1層あたり平均80mm³</li>
                            <li>壁（シェル）: 約200mm/層（ノズル径0.4mmと仮定）</li>
                            <li>インフィル20%: 約100mm/層</li>
                            <li>合計: 約300mm/層</li>
                        </ul>
                    </li>
                    <li><strong>総経路長</strong>: 300mm/層 × 150層 = 45,000mm = 45m</li>
                    <li><strong>印刷時間</strong>: 45,000mm ÷ 50mm/s = 900秒 = 15分</li>
                    <li><strong>実際の時間</strong>: 移動時間・リトラクション・加減速を考慮すると約5-6倍 → 75-90分</li>
                </ol>
                <p><strong>ポイント:</strong> スライサーソフトが提供する推定時間は、加減速・移動・温度安定化を含むため、単純計算の4-6倍程度になります。</p>
            </details>
        </div>

        <div class="exercise">
            <div class="exercise-title">Q3: AMプロセスの選択</div>
            <p>次の用途に最適なAMプロセスを選んでください：「航空機エンジン部品のチタン合金製燃料噴射ノズル、複雑な内部流路、高強度・高耐熱性要求」</p>
            <p>a) FDM (Fused Deposition Modeling)<br>
            b) SLA (Stereolithography)<br>
            c) SLM (Selective Laser Melting)<br>
            d) Binder Jetting</p>

            <details>
                <summary>解答を表示</summary>
                <p><strong>正解: c) SLM (Selective Laser Melting / Powder Bed Fusion for Metal)</strong></p>
                <p><strong>理由:</strong></p>
                <ul>
                    <li><strong>SLMの特徴</strong>: 金属粉末（チタン、インコネル、ステンレス）をレーザーで完全溶融。高密度（99.9%）、高強度、高耐熱性。</li>
                    <li><strong>用途適合性</strong>:
                        <ul>
                            <li>✓ チタン合金（Ti-6Al-4V）対応</li>
                            <li>✓ 複雑内部流路製造可能（サポート除去後）</li>
                            <li>✓ 航空宇宙グレードの機械的特性</li>
                            <li>✓ GE Aviationが実際にFUEL噴射ノズルをSLMで量産</li>
                        </ul>
                    </li>
                    <li><strong>他の選択肢が不適な理由</strong>:
                        <ul>
                            <li>FDM: プラスチックのみ、強度・耐熱性不足</li>
                            <li>SLA: 樹脂のみ、機能部品には不適</li>
                            <li>Binder Jetting: 金属可能だが、焼結後密度90-95%で航空宇宙基準に届かない</li>
                        </ul>
                    </li>
                </ul>
                <p><strong>実例:</strong> GE AviationのLEAP燃料ノズル（SLM製）は、従来20部品を溶接していたものを1部品に統合、重量25%削減、耐久性5倍向上を達成。</p>
            </details>
        </div>

        <h3>Medium（応用）</h3>

        <div class="exercise">
            <div class="exercise-title">Q4: PythonでSTLメッシュを検証</div>
            <p>以下のPythonコードを完成させて、STLファイルのマニフォールド性（watertight）を検証してください。</p>
            <pre><code class="language-python">import trimesh

mesh = trimesh.load('model.stl')

# ここにコードを追加: マニフォールド性をチェックし、
# 問題があれば自動修復を行い、修復後のメッシュを
# 'model_fixed.stl'として保存してください
</code></pre>

            <details>
                <summary>解答を表示</summary>
                <p><strong>解答例:</strong></p>
                <pre><code class="language-python">import trimesh

mesh = trimesh.load('model.stl')

# マニフォールド性をチェック
print(f"Is watertight: {mesh.is_watertight}")
print(f"Is winding consistent: {mesh.is_winding_consistent}")

# 問題がある場合は修復
if not mesh.is_watertight or not mesh.is_winding_consistent:
    print("メッシュ修復を実行中...")

    # 法線を修正
    trimesh.repair.fix_normals(mesh)

    # 穴を埋める
    trimesh.repair.fill_holes(mesh)

    # 縮退三角形を削除
    mesh.remove_degenerate_faces()

    # 重複頂点を結合
    mesh.merge_vertices()

    # 修復結果を確認
    print(f"修復後 watertight: {mesh.is_watertight}")

    # 修復したメッシュを保存
    if mesh.is_watertight:
        mesh.export('model_fixed.stl')
        print("修復完了: model_fixed.stl として保存")
    else:
        print("⚠️ 自動修復失敗。Meshmixer等を使用してください")
else:
    print("✓ メッシュは3Dプリント可能です")
</code></pre>
                <p><strong>解説:</strong></p>
                <ul>
                    <li><code>trimesh.repair.fix_normals()</code>: 法線ベクトルの向きを統一</li>
                    <li><code>trimesh.repair.fill_holes()</code>: メッシュの穴を充填</li>
                    <li><code>remove_degenerate_faces()</code>: 面積ゼロの縮退三角形を削除</li>
                    <li><code>merge_vertices()</code>: 重複した頂点を結合</li>
                </ul>
                <p><strong>実践ポイント:</strong> trimeshでも修復できない複雑な問題は、Meshmixer、Netfabb、MeshLabなどの専用ツールが必要です。</p>
            </details>
        </div>

        <div class="exercise">
            <div class="exercise-title">Q5: サポート材料の体積計算</div>
            <p>直径40mm、高さ30mmの円柱を、底面から45度の角度で傾けて造形します。サポート密度15%、レイヤー高さ0.2mmと仮定して、おおよそのサポート材料体積を推定してください。</p>

            <details>
                <summary>解答を表示</summary>
                <p><strong>解答プロセス:</strong></p>
                <ol>
                    <li><strong>サポートが必要な領域の特定</strong>:
                        <ul>
                            <li>45度傾斜 → 円柱底面の約半分がオーバーハング（45度以上の傾斜）</li>
                            <li>円柱を45度傾けると、片側が浮いた状態になる</li>
                        </ul>
                    </li>
                    <li><strong>サポート領域の幾何計算</strong>:
                        <ul>
                            <li>円柱の投影面積: π × (20mm)² ≈ 1,257 mm²</li>
                            <li>45度傾斜時のサポート必要面積: 約1,257mm² × 0.5 = 629 mm²</li>
                            <li>サポート高さ: 最大で約 30mm × sin(45°) ≈ 21mm</li>
                            <li>サポート体積（密度100%と仮定）: 629mm² × 21mm ÷ 2（三角形状）≈ 6,600 mm³</li>
                        </ul>
                    </li>
                    <li><strong>サポート密度15%を考慮</strong>:
                        <ul>
                            <li>実際のサポート材料: 6,600mm³ × 0.15 = <strong>約990 mm³</strong></li>
                        </ul>
                    </li>
                    <li><strong>検証</strong>:
                        <ul>
                            <li>円柱本体の体積: π × 20² × 30 ≈ 37,700 mm³</li>
                            <li>サポート/本体比: 990 / 37,700 ≈ 2.6%（妥当な範囲）</li>
                        </ul>
                    </li>
                </ol>
                <p><strong>答え: 約1,000 mm³ (990 mm³)</strong></p>
                <p><strong>実践的考察:</strong></p>
                <ul>
                    <li>造形向きの最適化で、サポートを大幅削減可能（この例では円柱を立てて造形すればサポート不要）</li>
                    <li>Tree Supportを使用すれば、さらに30-50%材料削減可能</li>
                    <li>水溶性サポート材（PVA、HIPS）を使用すれば、除去が容易</li>
                </ul>
            </details>
        </div>

        <div class="exercise">
            <div class="exercise-title">Q6: レイヤー高さの最適化</div>
            <p>高さ60mmの造形物を、品質と時間のバランスを考慮して造形します。レイヤー高さ0.1mm、0.2mm、0.3mmの3つの選択肢がある場合、それぞれの造形時間比と推奨用途を説明してください。</p>

            <details>
                <summary>解答を表示</summary>
                <p><strong>解答:</strong></p>
                <table>
                    <tr>
                        <th>レイヤー高さ</th>
                        <th>レイヤー数</th>
                        <th>時間比</th>
                        <th>品質</th>
                        <th>推奨用途</th>
                    </tr>
                    <tr>
                        <td>0.1 mm</td>
                        <td>600層</td>
                        <td>×3.0</td>
                        <td>非常に高い</td>
                        <td>展示用フィギュア、医療モデル、最終製品</td>
                    </tr>
                    <tr>
                        <td>0.2 mm</td>
                        <td>300層</td>
                        <td>×1.0（基準）</td>
                        <td>良好</td>
                        <td>一般的なプロトタイプ、機能部品</td>
                    </tr>
                    <tr>
                        <td>0.3 mm</td>
                        <td>200層</td>
                        <td>×0.67</td>
                        <td>低い</td>
                        <td>初期プロトタイプ、強度優先の内部部品</td>
                    </tr>
                </table>

                <p><strong>時間比の計算根拠:</strong></p>
                <ul>
                    <li>レイヤー数が1/2になると、Z軸移動回数も1/2</li>
                    <li>BUT: 各層の印刷時間は微増（1層あたりの体積が増えるため）</li>
                    <li>総合的には、レイヤー高さに「ほぼ反比例」（厳密には0.9-1.1倍の係数あり）</li>
                </ul>

                <p><strong>実践的な選択基準:</strong></p>
                <ol>
                    <li><strong>0.1mm推奨ケース</strong>:
                        <ul>
                            <li>表面品質が最優先（顧客プレゼン、展示会）</li>
                            <li>曲面の滑らかさが重要（顔、曲線形状）</li>
                            <li>積層痕をほぼ消したい</li>
                        </ul>
                    </li>
                    <li><strong>0.2mm推奨ケース</strong>:
                        <ul>
                            <li>品質と時間のバランス重視（最も一般的）</li>
                            <li>機能試験用プロトタイプ</li>
                            <li>適度な表面仕上がりで十分</li>
                        </ul>
                    </li>
                    <li><strong>0.3mm推奨ケース</strong>:
                        <ul>
                            <li>速度優先（形状確認のみ）</li>
                            <li>内部構造部品（外観不問）</li>
                            <li>大型造形物（時間削減効果大）</li>
                        </ul>
                    </li>
                </ol>

                <p><strong>変数レイヤー高さ（Advanced）:</strong><br>
                PrusaSlicerやCuraの変数レイヤー高さ機能を使えば、平坦部は0.3mm、曲面部は0.1mmと混在させて、品質と時間を両立可能。</p>
            </details>
        </div>

        <div class="exercise">
            <div class="exercise-title">Q7: AMプロセス選択の総合問題</div>
            <p>航空宇宙用の軽量ブラケット（アルミニウム合金、トポロジー最適化済み複雑形状、高強度・軽量要求）の製造に最適なAMプロセスを選択し、その理由を3つ挙げてください。また、考慮すべき後処理を2つ挙げてください。</p>

            <details>
                <summary>解答を表示</summary>
                <p><strong>最適プロセス: LPBF (Laser Powder Bed Fusion) - SLM for Aluminum</strong></p>
                <p><strong>選択理由（3つ）:</strong></p>
                <ol>
                    <li><strong>高密度・高強度</strong>:
                        <ul>
                            <li>レーザー完全溶融により相対密度99.5%以上を達成</li>
                            <li>鍛造材に匹敵する機械的特性（引張強度、疲労特性）</li>
                            <li>航空宇宙認証（AS9100、Nadcap）取得可能</li>
                        </ul>
                    </li>
                    <li><strong>トポロジー最適化形状の製造能力</strong>:
                        <ul>
                            <li>複雑なラティス構造（厚さ0.5mm以下）を高精度で造形</li>
                            <li>中空構造、バイオニック形状など従来加工不可能な形状に対応</li>
                            <li>サポート除去後、内部構造もアクセス可能</li>
                        </ul>
                    </li>
                    <li><strong>材料効率と軽量化</strong>:
                        <ul>
                            <li>Buy-to-Fly比（材料投入量/最終製品重量）が切削加工の1/10〜1/20</li>
                            <li>トポロジー最適化で従来設計比40-60%軽量化</li>
                            <li>アルミ合金（AlSi10Mg、Scalmalloy）で比強度最大化</li>
                        </ul>
                    </li>
                </ol>

                <p><strong>必要な後処理（2つ）:</strong></p>
                <ol>
                    <li><strong>熱処理（Heat Treatment）</strong>:
                        <ul>
                            <li>応力除去焼鈍（Stress Relief Annealing）: 300°C、2-4時間</li>
                            <li>目的: 造形時の残留応力を除去、寸法安定性向上</li>
                            <li>効果: 疲労寿命30-50%向上、反り変形防止</li>
                        </ul>
                    </li>
                    <li><strong>表面処理（Surface Finishing）</strong>:
                        <ul>
                            <li>機械加工（CNC）: 取り付け面、ボルト穴の高精度加工（Ra < 3.2μm）</li>
                            <li>化学研磨（Electropolishing）: 表面粗さ低減（Ra 10μm → 2μm）</li>
                            <li>ショットピーニング（Shot Peening）: 表面層に圧縮残留応力を付与、疲労特性向上</li>
                            <li>アノダイズ処理: 耐食性向上、絶縁性付与（航空宇宙標準）</li>
                        </ul>
                    </li>
                </ol>

                <p><strong>追加考慮事項:</strong></p>
                <ul>
                    <li><strong>造形方向</strong>: 荷重方向と積層方向を考慮（Z方向強度は10-15%低い）</li>
                    <li><strong>サポート設計</strong>: 除去しやすいTree Support、接触面積最小化</li>
                    <li><strong>品質管理</strong>: CT スキャンで内部欠陥検査、X線検査</li>
                    <li><strong>トレーサビリティ</strong>: 粉末ロット管理、造形パラメータ記録</li>
                </ul>

                <p><strong>実例: Airbus A350のチタンブラケット</strong><br>
                従来32部品を組立てていたブラケットを1部品に統合、重量55%削減、リードタイム65%短縮、コスト35%削減を達成。</p>
            </details>
        </div>
                3水準 × 3水準 = <strong>9回</strong>（フルファクトリアル計画）</p>

                <p><strong>DOEの利点（従来法との比較）:</strong></p>
                <ol>
                    <li><strong>交互作用の検出が可能</strong>
                        <ul>
                            <li>従来法: 温度の影響、時間の影響を個別に評価</li>
                            <li>DOE: 「高温では時間を短くできる」といった交互作用を定量化</li>
                            <li>例: 1300°Cでは4時間で十分だが、1100°Cでは8時間必要、など</li>
                        </ul>
                    </li>
                    <li><strong>実験回数の削減</strong>
                        <ul>
                            <li>従来法（OFAT: One Factor At a Time）:
                                <ul>
                                    <li>温度検討: 3回（時間固定）</li>
                                    <li>時間検討: 3回（温度固定）</li>
                                    <li>確認実験: 複数回</li>
                                    <li>合計: 10回以上</li>
                                </ul>
                            </li>
                            <li>DOE: 9回で完了（全条件網羅＋交互作用解析）</li>
                            <li>さらに中心複合計画法を使えば7回に削減可能</li>
                        </ul>
                    </li>
                </ol>

                <p><strong>追加の利点:</strong></p>
                <ul>
                    <li>統計的に有意な結論が得られる（誤差評価が可能）</li>
                    <li>応答曲面を構築でき、未実施条件の予測が可能</li>
                    <li>最適条件が実験範囲外にある場合でも検出できる</li>
                </ul>
            </details>
        </div>

        <h3>Hard（発展）</h3>

        <div class="exercise">
            <div class="exercise-title">Q7: 複雑な反応系の設計</div>
            <p>次の条件でLi₁.₂Ni₀.₂Mn₀.₆O₂（リチウムリッチ正極材料）を合成する温度プロファイルを設計してください：</p>
            <ul>
                <li>原料: Li₂CO₃, NiO, Mn₂O₃</li>
                <li>目標: 単一相、粒径 < 5 μm、Li/遷移金属比の精密制御</li>
                <li>制約: 900°C以上でLi₂Oが揮発（Li欠損のリスク）</li>
            </ul>
            <p>温度プロファイル（加熱速度、保持温度・時間、冷却速度）と、その設計理由を説明してください。</p>

            <details>
                <summary>解答を見る</summary>
                <p><strong>推奨温度プロファイル:</strong></p>

                <p><strong>Phase 1: 予備加熱（Li₂CO₃分解）</strong></p>
                <ul>
                    <li>室温 → 500°C: 3°C/min</li>
                    <li>500°C保持: 2時間</li>
                    <li><strong>理由:</strong> Li₂CO₃の分解（~450°C）をゆっくり進行させ、CO₂を完全に除去</li>
                </ul>

                <p><strong>Phase 2: 中間加熱（前駆体形成）</strong></p>
                <ul>
                    <li>500°C → 750°C: 5°C/min</li>
                    <li>750°C保持: 4時間</li>
                    <li><strong>理由:</strong> Li₂MnO₃やLiNiO₂などの中間相を形成。Li揮発の少ない温度で均質化</li>
                </ul>

                <p><strong>Phase 3: 本焼成（目的相合成）</strong></p>
                <ul>
                    <li>750°C → 850°C: 2°C/min（ゆっくり）</li>
                    <li>850°C保持: 12時間</li>
                    <li><strong>理由:</strong>
                        <ul>
                            <li>Li₁.₂Ni₀.₂Mn₀.₆O₂の単一相形成には長時間必要</li>
                            <li>850°Cに制限してLi揮発を最小化（<900°C制約）</li>
                            <li>長時間保持で拡散を進めるが、粒成長は抑制される温度</li>
                        </ul>
                    </li>
                </ul>

                <p><strong>Phase 4: 冷却</strong></p>
                <ul>
                    <li>850°C → 室温: 2°C/min</li>
                    <li><strong>理由:</strong> 徐冷により結晶性向上、熱応力による亀裂防止</li>
                </ul>

                <p><strong>設計の重要ポイント:</strong></p>
                <ol>
                    <li><strong>Li揮発対策:</strong>
                        <ul>
                            <li>900°C以下に制限（本問の制約）</li>
                            <li>さらに、Li過剰原料（Li/TM = 1.25など）を使用</li>
                            <li>酸素気流中で焼成してLi₂Oの分圧を低減</li>
                        </ul>
                    </li>
                    <li><strong>粒径制御 (< 5 μm):</strong>
                        <ul>
                            <li>低温（850°C）・長時間（12h）で反応を進める</li>
                            <li>高温・短時間だと粒成長が過剰になる</li>
                            <li>原料粒径も1μm以下に微細化</li>
                        </ul>
                    </li>
                    <li><strong>組成均一性:</strong>
                        <ul>
                            <li>750°Cでの中間保持が重要</li>
                            <li>この段階で遷移金属の分布を均質化</li>
                            <li>必要に応じて、750°C保持後に一度冷却→粉砕→再加熱</li>
                        </ul>
                    </li>
                </ol>

                <p><strong>全体所要時間:</strong> 約30時間（加熱12h + 保持18h）</p>

                <p><strong>代替手法の検討:</strong></p>
                <ul>
                    <li><strong>Sol-gel法:</strong> より低温（600-700°C）で合成可能、均質性向上</li>
                    <li><strong>Spray pyrolysis:</strong> 粒径制御が容易</li>
                    <li><strong>Two-step sintering:</strong> 900°C 1h → 800°C 10h で粒成長抑制</li>
                </ul>
            </details>
        </div>

        <div class="exercise">
            <div class="exercise-title">Q8: 速度論的解析の総合問題</div>
            <p>以下のデータから、反応機構を推定し、活性化エネルギーを計算してください。</p>
            <p><strong>実験データ:</strong></p>
            <table>
                <tr>
                    <th>温度 (°C)</th>
                    <th>50%反応到達時間 t₅₀ (hours)</th>
                </tr>
                <tr><td>1000</td><td>18.5</td></tr>
                <tr><td>1100</td><td>6.2</td></tr>
                <tr><td>1200</td><td>2.5</td></tr>
                <tr><td>1300</td><td>1.2</td></tr>
            </table>
            <p>Jander式を仮定した場合: [1-(1-0.5)^(1/3)]² = k·t₅₀</p>

            <details>
                <summary>解答を見る</summary>
                <p><strong>解答:</strong></p>

                <p><strong>ステップ1: 速度定数kの計算</strong></p>
                <p>Jander式で α=0.5 のとき:<br>
                [1-(1-0.5)^(1/3)]² = [1-0.794]² = 0.206² = 0.0424</p>

                <p>したがって k = 0.0424 / t₅₀</p>

                <table>
                    <tr>
                        <th>T (°C)</th>
                        <th>T (K)</th>
                        <th>t₅₀ (h)</th>
                        <th>k (h⁻¹)</th>
                        <th>ln(k)</th>
                        <th>1000/T (K⁻¹)</th>
                    </tr>
                    <tr><td>1000</td><td>1273</td><td>18.5</td><td>0.00229</td><td>-6.080</td><td>0.7855</td></tr>
                    <tr><td>1100</td><td>1373</td><td>6.2</td><td>0.00684</td><td>-4.985</td><td>0.7284</td></tr>
                    <tr><td>1200</td><td>1473</td><td>2.5</td><td>0.01696</td><td>-4.077</td><td>0.6788</td></tr>
                    <tr><td>1300</td><td>1573</td><td>1.2</td><td>0.03533</td><td>-3.343</td><td>0.6357</td></tr>
                </table>

                <p><strong>ステップ2: Arrheniusプロット</strong></p>
                <p>ln(k) vs 1/T をプロット（線形回帰）</p>

                <p>線形フィット: ln(k) = A - Eₐ/(R·T)</p>
                <p>傾き = -Eₐ/R</p>

                <p>線形回帰計算:<br>
                slope = Δ(ln k) / Δ(1000/T)<br>
                     = (-3.343 - (-6.080)) / (0.6357 - 0.7855)<br>
                     = 2.737 / (-0.1498)<br>
                     = -18.27</p>

                <p><strong>ステップ3: 活性化エネルギー計算</strong></p>
                <p>slope = -Eₐ / (R × 1000)<br>
                Eₐ = -slope × R × 1000<br>
                Eₐ = 18.27 × 8.314 × 1000<br>
                Eₐ = 151,899 J/mol ≈ <strong>152 kJ/mol</strong></p>

                <p><strong>ステップ4: 反応機構の考察</strong></p>
                <ul>
                    <li><strong>活性化エネルギーの比較:</strong>
                        <ul>
                            <li>得られた値: 152 kJ/mol</li>
                            <li>典型的な固相拡散: 200-400 kJ/mol</li>
                            <li>界面反応: 50-150 kJ/mol</li>
                        </ul>
                    </li>
                    <li><strong>推定される機構:</strong>
                        <ul>
                            <li>この値は界面反応と拡散の中間</li>
                            <li>可能性1: 界面反応が主律速（拡散の影響は小）</li>
                            <li>可能性2: 粒子が微細で拡散距離が短く、見かけのEₐが低い</li>
                            <li>可能性3: 混合律速（界面反応と拡散の両方が寄与）</li>
                        </ul>
                    </li>
                </ul>

                <p><strong>ステップ5: 検証方法の提案</strong></p>
                <ol>
                    <li><strong>粒子サイズ依存性:</strong> 異なる粒径で実験し、k ∝ 1/r₀² が成立するか確認
                        <ul>
                            <li>成立 → 拡散律速</li>
                            <li>不成立 → 界面反応律速</li>
                        </ul>
                    </li>
                    <li><strong>他の速度式でのフィッティング:</strong>
                        <ul>
                            <li>Ginstling-Brounshtein式（3次元拡散）</li>
                            <li>Contracting sphere model（界面反応）</li>
                            <li>どちらがR²が高いか比較</li>
                        </ul>
                    </li>
                    <li><strong>微細構造観察:</strong> SEMで反応界面を観察
                        <ul>
                            <li>厚い生成物層 → 拡散律速の証拠</li>
                            <li>薄い生成物層 → 界面反応律速の可能性</li>
                        </ul>
                    </li>
                </ol>

                <p><strong>最終結論:</strong><br>
                活性化エネルギー <strong>Eₐ = 152 kJ/mol</strong><br>
                推定機構: <strong>界面反応律速、または微細粒子系での拡散律速</strong><br>
                追加実験が推奨される。</p>
            </details>
        </div>

        <h2>次のステップ</h2>
        <p>第4章では積層造形（AM）の基礎として、ISO/ASTM 52900による7つのプロセス分類、STLファイル形式の構造、スライシングとG-codeの基本を学びました。次の第2章では、材料押出（FDM/FFF）の詳細な造形プロセス、材料特性、プロセスパラメータ最適化について学びます。</p>

        <div class="nav-buttons">
            <a href="./index.html" class="nav-button">← シリーズ目次</a>
            <a href="./chapter-5.html" class="nav-button">第2章へ進む →</a>
        </div>

        <h2>参考文献</h2>
        <ol>
            <li>Gibson, I., Rosen, D., & Stucker, B. (2015). <em>Additive Manufacturing Technologies: 3D Printing, Rapid Prototyping, and Direct Digital Manufacturing</em> (2nd ed.). Springer. pp. 1-35, 89-145, 287-334. - AM技術の包括的教科書、7つのプロセスカテゴリとSTLデータ処理の詳細解説</li>
            <li>ISO/ASTM 52900:2021. <em>Additive manufacturing — General principles — Fundamentals and vocabulary</em>. International Organization for Standardization. - AM用語とプロセス分類の国際標準規格、産業界で広く参照される</li>
            <li>Kruth, J.P., Leu, M.C., & Nakagawa, T. (1998). "Progress in Additive Manufacturing and Rapid Prototyping." <em>CIRP Annals - Manufacturing Technology</em>, 47(2), 525-540. - 選択的レーザー焼結とバインディング機構の理論的基礎</li>
            <li>Hull, C.W. (1986). <em>Apparatus for production of three-dimensional objects by stereolithography</em>. US Patent 4,575,330. - 世界初のAM技術（SLA）の特許、AM産業の起源となる重要文献</li>
            <li>Wohlers, T. (2023). <em>Wohlers Report 2023: 3D Printing and Additive Manufacturing Global State of the Industry</em>. Wohlers Associates, Inc. pp. 15-89, 156-234. - AM市場動向と産業応用の最新統計レポート、年次更新される業界標準資料</li>
            <li>3D Systems, Inc. (1988). <em>StereoLithography Interface Specification</em>. - STLファイル形式の公式仕様書、ASCII/Binary STL構造の定義</li>
            <li>numpy-stl Documentation. (2024). <em>Python library for working with STL files</em>. <a href="https://numpy-stl.readthedocs.io/">https://numpy-stl.readthedocs.io/</a> - STLファイル読込・体積計算のためのPythonライブラリ</li>
            <li>trimesh Documentation. (2024). <em>Python library for loading and using triangular meshes</em>. <a href="https://trimsh.org/">https://trimsh.org/</a> - メッシュ修復・ブーリアン演算・品質評価の包括的ライブラリ</li>
        </ol>

        <h2>使用ツールとライブラリ</h2>
        <ul>
            <li><strong>NumPy</strong> (v1.24+): 数値計算ライブラリ - <a href="https://numpy.org/">https://numpy.org/</a></li>
            <li><strong>numpy-stl</strong> (v3.0+): STLファイル処理ライブラリ - <a href="https://numpy-stl.readthedocs.io/">https://numpy-stl.readthedocs.io/</a></li>
            <li><strong>trimesh</strong> (v4.0+): 3Dメッシュ処理ライブラリ（修復、検証、ブーリアン演算） - <a href="https://trimsh.org/">https://trimsh.org/</a></li>
            <li><strong>Matplotlib</strong> (v3.7+): データ可視化ライブラリ - <a href="https://matplotlib.org/">https://matplotlib.org/</a></li>
            <li><strong>SciPy</strong> (v1.10+): 科学技術計算ライブラリ（最適化、補間） - <a href="https://scipy.org/">https://scipy.org/</a></li>
        </ul>
    </div>

    <footer>
        <p>&copy; 2025 MS Terakoya - Materials Science Learning Platform</p>
        <p>東北大学 材料科学研究科</p>
    </footer>
</body>
</html>
