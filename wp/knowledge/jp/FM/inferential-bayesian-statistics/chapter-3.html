<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬3ç« : ä»®èª¬æ¤œå®šã¨æ¤œå®šåŠ›åˆ†æ | æ¨æ¸¬çµ±è¨ˆå­¦ã¨ãƒ™ã‚¤ã‚ºçµ±è¨ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
            <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.8; color: #333; background: #f5f5f5; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; text-align: center; }
        h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; }
        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
        .breadcrumb { margin-bottom: 1.5rem; font-size: 0.9rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .content { background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        h2 { color: #667eea; margin: 2rem 0 1rem 0; padding-bottom: 0.5rem; border-bottom: 2px solid #e0e0e0; }
        h3 { color: #764ba2; margin: 1.5rem 0 0.8rem 0; }
        .definition { background: #e7f3ff; border-left: 4px solid #667eea; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .theorem { background: #f3e5f5; border-left: 4px solid #764ba2; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .example { background: #fff3e0; border-left: 4px solid #ff9800; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .code-title {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            margin-top: 1.5rem;
        }
        .code-example {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 0 0 8px 8px;
            overflow-x: auto;
            margin: 0 0 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .output { background: #f8f9fa; border: 1px solid #dee2e6; padding: 1rem; border-radius: 6px; margin: 1rem 0; font-family: monospace; font-size: 0.9rem; }
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
        th, td { padding: 0.8rem; text-align: left; border: 1px solid #ddd; }
        th { background: #667eea; color: white; }
        .note { background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .exercise { background: #d4edda; border-left: 4px solid #28a745; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .nav-buttons { display: flex; justify-content: space-between; margin: 2rem 0; }
        .nav-button { padding: 0.8rem 1.5rem; background: #667eea; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; }
        .nav-button:hover { background: #764ba2; }
        footer { background: #2c3e50; color: white; text-align: center; padding: 2rem 1rem; margin-top: 3rem; }
        @media (max-width: 768px) { .content { padding: 1.5rem; } h1 { font-size: 1.5rem; } }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header>
        <h1>ç¬¬3ç« : ä»®èª¬æ¤œå®šã¨æ¤œå®šåŠ›åˆ†æ</h1>
        <p class="subtitle">Hypothesis Testing and Power Analysis</p>
    </header>

    <div class="container">
        <div class="breadcrumb">
            <a href="../index.html">åŸºç¤æ•°ç†é“å ´</a> &gt;
            <a href="index.html">æ¨æ¸¬çµ±è¨ˆå­¦ã¨ãƒ™ã‚¤ã‚ºçµ±è¨ˆ</a> &gt;
            ç¬¬3ç« 
        </div>


        <div class="content">
            <h2>3.1 ä»®èª¬æ¤œå®šã®æ çµ„ã¿</h2>
            
            <div class="theory-box">
                <h4>ğŸ“˜ ä»®èª¬æ¤œå®šã®åŸºæœ¬æ§‹é€ </h4>
                <p><strong>å¸°ç„¡ä»®èª¬ (Null Hypothesis) \( H_0 \)</strong>: ã€Œå·®ãŒãªã„ã€ã€ŒåŠ¹æœãŒãªã„ã€ã¨ã„ã†ä¸»å¼µ</p>
                <p><strong>å¯¾ç«‹ä»®èª¬ (Alternative Hypothesis) \( H_1 \)</strong>: ã€Œå·®ãŒã‚ã‚‹ã€ã€ŒåŠ¹æœãŒã‚ã‚‹ã€ã¨ã„ã†ä¸»å¼µ</p>
                
                <p><strong>ç¬¬1ç¨®éèª¤ (Type I Error)</strong>: \( H_0 \) ãŒçœŸãªã®ã«æ£„å´ã™ã‚‹èª¤ã‚Šï¼ˆå½é™½æ€§ï¼‰</p>
                <div class="formula">$$ \alpha = P(\text{Type I Error}) = P(\text{reject } H_0 | H_0 \text{ is true}) $$</div>
                
                <p><strong>ç¬¬2ç¨®éèª¤ (Type II Error)</strong>: \( H_0 \) ãŒå½ãªã®ã«æ£„å´ã—ãªã„èª¤ã‚Šï¼ˆå½é™°æ€§ï¼‰</p>
                <div class="formula">$$ \beta = P(\text{Type II Error}) = P(\text{fail to reject } H_0 | H_1 \text{ is true}) $$</div>
                
                <p><strong>æ¤œå®šåŠ› (Power)</strong>: çœŸã®åŠ¹æœã‚’æ­£ã—ãæ¤œå‡ºã™ã‚‹ç¢ºç‡</p>
                <div class="formula">$$ \text{Power} = 1 - \beta $$</div>
            </div>

            <div class="example">
                <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹1: zæ¤œå®šï¼ˆæ¯å¹³å‡ã®æ¤œå®šï¼‰</h4>
                <pre><code>import numpy as np
import matplotlib.pyplot as plt
from scipy import stats

# ã‚·ãƒŠãƒªã‚ª: æ–°ã—ã„è£½é€ ãƒ—ãƒ­ã‚»ã‚¹ãŒå¾“æ¥ã‚ˆã‚Šå¹³å‡å¼·åº¦ã‚’å‘ä¸Šã•ã›ãŸã‹ï¼Ÿ
# H0: Î¼ = 450 (å¾“æ¥ãƒ—ãƒ­ã‚»ã‚¹ã®å¹³å‡)
# H1: Î¼ > 450 (ç‰‡å´æ¤œå®š)

mu_0 = 450  # å¸°ç„¡ä»®èª¬ã®æ¯å¹³å‡
sigma = 30  # æ¯æ¨™æº–åå·®ï¼ˆæ—¢çŸ¥ï¼‰
alpha = 0.05  # æœ‰æ„æ°´æº–

# æ–°ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ‡ãƒ¼ã‚¿
np.random.seed(42)
n = 25
mu_true = 465  # å®Ÿéš›ã®æ¯å¹³å‡ï¼ˆæœªçŸ¥ã¨ä»®å®šï¼‰
data = np.random.normal(mu_true, sigma, n)

# æ¤œå®šçµ±è¨ˆé‡ã®è¨ˆç®—
x_bar = np.mean(data)
se = sigma / np.sqrt(n)
z_stat = (x_bar - mu_0) / se

# på€¤ã®è¨ˆç®—ï¼ˆç‰‡å´æ¤œå®šï¼‰
p_value = 1 - stats.norm.cdf(z_stat)

# æ£„å´åŸŸ
z_critical = stats.norm.ppf(1 - alpha)

print("=== zæ¤œå®š: æ¯å¹³å‡ã®ç‰‡å´æ¤œå®š ===")
print(f"å¸°ç„¡ä»®èª¬ H0: Î¼ = {mu_0}")
print(f"å¯¾ç«‹ä»®èª¬ H1: Î¼ > {mu_0}")
print(f"æœ‰æ„æ°´æº–: Î± = {alpha}")
print(f"\næ¨™æœ¬ã‚µã‚¤ã‚º: {n}")
print(f"æ¨™æœ¬å¹³å‡: {x_bar:.2f}")
print(f"zçµ±è¨ˆé‡: {z_stat:.4f}")
print(f"è‡¨ç•Œå€¤: z_{{{1-alpha}}} = {z_critical:.4f}")
print(f"på€¤: {p_value:.6f}")
print(f"\nåˆ¤å®š: {'H0ã‚’æ£„å´' if p_value < alpha else 'H0ã‚’æ£„å´ã§ããªã„'}")
print(f"è§£é‡ˆ: {'æ–°ãƒ—ãƒ­ã‚»ã‚¹ã¯æœ‰æ„ã«å¼·åº¦ã‚’å‘ä¸Šã•ã›ãŸ' if p_value < alpha else 'æœ‰æ„ãªå‘ä¸Šã¯ç¢ºèªã§ããªã„'}")

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

# å¸°ç„¡ä»®èª¬ä¸‹ã®åˆ†å¸ƒã¨æ£„å´åŸŸ
x = np.linspace(-4, 4, 300)
axes[0].plot(x, stats.norm.pdf(x), 'b-', linewidth=2, label='H0ä¸‹ã®åˆ†å¸ƒ')
axes[0].fill_between(x, 0, stats.norm.pdf(x), where=(x >= z_critical),
                      alpha=0.3, color='red', label=f'æ£„å´åŸŸ (Î±={alpha})')
axes[0].axvline(z_stat, color='green', linestyle='--', linewidth=2,
                label=f'è¦³æ¸¬ã•ã‚ŒãŸzçµ±è¨ˆé‡: {z_stat:.2f}')
axes[0].axvline(z_critical, color='red', linestyle=':', linewidth=2,
                label=f'è‡¨ç•Œå€¤: {z_critical:.2f}')
axes[0].set_xlabel('zå€¤')
axes[0].set_ylabel('ç¢ºç‡å¯†åº¦')
axes[0].set_title('ä»®èª¬æ¤œå®šã®å¯è¦–åŒ–ï¼ˆç‰‡å´æ¤œå®šï¼‰')
axes[0].legend()
axes[0].grid(True, alpha=0.3)

# å…ƒãƒ‡ãƒ¼ã‚¿ã¨å¸°ç„¡ä»®èª¬ä¸‹ã®åˆ†å¸ƒ
x_data = np.linspace(mu_0 - 4*sigma, mu_0 + 4*sigma, 300)
axes[1].hist(data, bins=12, density=True, alpha=0.7,
             color='skyblue', edgecolor='black', label='è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿')
axes[1].plot(x_data, stats.norm.pdf(x_data, mu_0, se),
             'r-', linewidth=2, label=f'H0: Î¼={mu_0} ã®åˆ†å¸ƒ')
axes[1].axvline(x_bar, color='blue', linestyle='--', linewidth=2,
                label=f'æ¨™æœ¬å¹³å‡: {x_bar:.1f}')
axes[1].axvline(mu_0, color='red', linestyle=':', linewidth=2,
                label=f'H0ã®å¹³å‡: {mu_0}')
axes[1].set_xlabel('å¼·åº¦ [MPa]')
axes[1].set_ylabel('å¯†åº¦')
axes[1].set_title('ãƒ‡ãƒ¼ã‚¿ã¨å¸°ç„¡ä»®èª¬ã®æ¯”è¼ƒ')
axes[1].legend()
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()</code></pre>
            </div>

            <div class="note">
                <strong>ğŸ“Œ på€¤ã®æ­£ã—ã„è§£é‡ˆ</strong><br>
                på€¤ã¯ã€Œå¸°ç„¡ä»®èª¬ãŒçœŸã§ã‚ã‚‹å ´åˆã«ã€è¦³æ¸¬ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¾ãŸã¯ãã‚Œã‚ˆã‚Šæ¥µç«¯ãªãƒ‡ãƒ¼ã‚¿ãŒå¾—ã‚‰ã‚Œã‚‹ç¢ºç‡ã€ã§ã™ã€‚
                ã€Œå¸°ç„¡ä»®èª¬ãŒæ­£ã—ã„ç¢ºç‡ã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚p < 0.05ã¯ã€Œ5%æœªæº€ã®ç¢ºç‡ã§ã—ã‹èµ·ã“ã‚‰ãªã„å¸Œãªç¾è±¡ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚
            </div>

            <h2>3.2 tæ¤œå®šï¼ˆ1æ¨™æœ¬ãƒ»2æ¨™æœ¬ãƒ»å¯¾å¿œã‚ã‚Šï¼‰</h2>

            <div class="example">
                <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹2: tæ¤œå®šã®3ãƒ‘ã‚¿ãƒ¼ãƒ³</h4>
                <pre><code>import numpy as np
import matplotlib.pyplot as plt
from scipy import stats

np.random.seed(42)

# ===== 1æ¨™æœ¬tæ¤œå®š =====
print("=== 1æ¨™æœ¬tæ¤œå®š ===")
# ææ–™ã®ç›®æ¨™å¼·åº¦500 MPaã‚’é”æˆã—ã¦ã„ã‚‹ã‹ï¼Ÿ
mu_target = 500
n1 = 15
data_1sample = np.random.normal(510, 25, n1)

t_stat_1, p_value_1 = stats.ttest_1samp(data_1sample, mu_target)
print(f"H0: Î¼ = {mu_target}")
print(f"æ¨™æœ¬å¹³å‡: {np.mean(data_1sample):.2f}")
print(f"tçµ±è¨ˆé‡: {t_stat_1:.4f}, på€¤: {p_value_1:.6f}")
print(f"åˆ¤å®š: {'H0ã‚’æ£„å´ï¼ˆç›®æ¨™ã¨æœ‰æ„ã«ç•°ãªã‚‹ï¼‰' if p_value_1 < 0.05 else 'H0ã‚’æ£„å´ã§ããªã„'}\n")

# ===== 2æ¨™æœ¬tæ¤œå®šï¼ˆç‹¬ç«‹ï¼‰ =====
print("=== 2æ¨™æœ¬tæ¤œå®šï¼ˆç‹¬ç«‹ï¼‰===")
# 2ã¤ã®ä¾›çµ¦æ¥­è€…ã®ææ–™å¼·åº¦ã«å·®ãŒã‚ã‚‹ã‹ï¼Ÿ
n2a, n2b = 20, 22
data_2sample_A = np.random.normal(480, 20, n2a)
data_2sample_B = np.random.normal(495, 25, n2b)

# Welchã®tæ¤œå®šï¼ˆä¸ç­‰åˆ†æ•£ï¼‰
t_stat_2, p_value_2 = stats.ttest_ind(data_2sample_A, data_2sample_B, equal_var=False)
print(f"H0: Î¼A = Î¼B")
print(f"å¹³å‡A: {np.mean(data_2sample_A):.2f}, å¹³å‡B: {np.mean(data_2sample_B):.2f}")
print(f"tçµ±è¨ˆé‡: {t_stat_2:.4f}, på€¤: {p_value_2:.6f}")
print(f"åˆ¤å®š: {'H0ã‚’æ£„å´ï¼ˆæœ‰æ„å·®ã‚ã‚Šï¼‰' if p_value_2 < 0.05 else 'H0ã‚’æ£„å´ã§ããªã„'}\n")

# ===== å¯¾å¿œã®ã‚ã‚‹tæ¤œå®š =====
print("=== å¯¾å¿œã®ã‚ã‚‹tæ¤œå®š ===")
# ç†±å‡¦ç†å‰å¾Œã§ææ–™ã®ç¡¬åº¦ãŒå¤‰åŒ–ã—ãŸã‹ï¼Ÿ
n3 = 12
before = np.random.normal(65, 5, n3)
after = before + np.random.normal(3, 2, n3)  # å¹³å‡3ã®å¢—åŠ 

t_stat_3, p_value_3 = stats.ttest_rel(after, before)
diff = after - before
print(f"H0: Î¼diff = 0 (å‡¦ç†å‰å¾Œã§å¤‰åŒ–ãªã—)")
print(f"å¹³å‡å·®: {np.mean(diff):.2f}")
print(f"tçµ±è¨ˆé‡: {t_stat_3:.4f}, på€¤: {p_value_3:.6f}")
print(f"åˆ¤å®š: {'H0ã‚’æ£„å´ï¼ˆæœ‰æ„ãªå¤‰åŒ–ã‚ã‚Šï¼‰' if p_value_3 < 0.05 else 'H0ã‚’æ£„å´ã§ããªã„'}\n")

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 3, figsize=(16, 5))

# 1æ¨™æœ¬tæ¤œå®š
axes[0].hist(data_1sample, bins=8, density=True, alpha=0.7,
             color='skyblue', edgecolor='black')
axes[0].axvline(np.mean(data_1sample), color='blue', linestyle='--',
                linewidth=2, label=f'æ¨™æœ¬å¹³å‡: {np.mean(data_1sample):.1f}')
axes[0].axvline(mu_target, color='red', linestyle='--',
                linewidth=2, label=f'ç›®æ¨™å€¤: {mu_target}')
axes[0].set_xlabel('å¼·åº¦ [MPa]')
axes[0].set_ylabel('å¯†åº¦')
axes[0].set_title(f'1æ¨™æœ¬tæ¤œå®š\np={p_value_1:.4f}')
axes[0].legend()
axes[0].grid(True, alpha=0.3)

# 2æ¨™æœ¬tæ¤œå®š
bp = axes[1].boxplot([data_2sample_A, data_2sample_B], labels=['æ¥­è€…A', 'æ¥­è€…B'],
                      patch_artist=True)
bp['boxes'][0].set_facecolor('lightblue')
bp['boxes'][1].set_facecolor('lightgreen')
axes[1].set_ylabel('å¼·åº¦ [MPa]')
axes[1].set_title(f'2æ¨™æœ¬tæ¤œå®š\np={p_value_2:.4f}')
axes[1].grid(True, alpha=0.3, axis='y')

# å¯¾å¿œã®ã‚ã‚‹tæ¤œå®š
x_pos = np.arange(n3)
axes[2].plot(x_pos, before, 'bo-', label='å‡¦ç†å‰', alpha=0.6)
axes[2].plot(x_pos, after, 'rs-', label='å‡¦ç†å¾Œ', alpha=0.6)
for i in range(n3):
    axes[2].plot([i, i], [before[i], after[i]], 'k-', alpha=0.3)
axes[2].set_xlabel('ã‚µãƒ³ãƒ—ãƒ«ç•ªå·')
axes[2].set_ylabel('ç¡¬åº¦ [HV]')
axes[2].set_title(f'å¯¾å¿œã®ã‚ã‚‹tæ¤œå®š\np={p_value_3:.4f}')
axes[2].legend()
axes[2].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()</code></pre>
            </div>

            <h2>3.3 ã‚«ã‚¤äºŒä¹—æ¤œå®šï¼ˆé©åˆåº¦ãƒ»ç‹¬ç«‹æ€§ï¼‰</h2>

            <div class="example">
                <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹3: ã‚«ã‚¤äºŒä¹—æ¤œå®š</h4>
                <pre><code>import numpy as np
import matplotlib.pyplot as plt
from scipy import stats

# ===== é©åˆåº¦æ¤œå®š =====
print("=== ã‚«ã‚¤äºŒä¹—é©åˆåº¦æ¤œå®š ===")
# ã‚µã‚¤ã‚³ãƒ­ã®å…¬æ­£æ€§ã®æ¤œå®š
observed = np.array([48, 52, 45, 50, 55, 50])  # è¦³æ¸¬åº¦æ•°
expected = np.array([50, 50, 50, 50, 50, 50])  # æœŸå¾…åº¦æ•°ï¼ˆå…¬æ­£ãªã‚‰å„é¢1/6ï¼‰

chi2_stat, p_value_gof = stats.chisquare(observed, expected)
print(f"H0: ã‚µã‚¤ã‚³ãƒ­ã¯å…¬æ­£ã§ã‚ã‚‹")
print(f"è¦³æ¸¬åº¦æ•°: {observed}")
print(f"æœŸå¾…åº¦æ•°: {expected}")
print(f"Ï‡Â²çµ±è¨ˆé‡: {chi2_stat:.4f}")
print(f"på€¤: {p_value_gof:.6f}")
print(f"åˆ¤å®š: {'H0ã‚’æ£„å´ï¼ˆä¸å…¬æ­£ï¼‰' if p_value_gof < 0.05 else 'H0ã‚’æ£„å´ã§ããªã„'}\n")

# ===== ç‹¬ç«‹æ€§ã®æ¤œå®š =====
print("=== ã‚«ã‚¤äºŒä¹—ç‹¬ç«‹æ€§æ¤œå®š ===")
# ææ–™ã®ç¨®é¡ã¨ä¸è‰¯å“ç™ºç”Ÿã«é–¢é€£ãŒã‚ã‚‹ã‹ï¼Ÿ
# 2Ã—3åˆ†å‰²è¡¨
contingency_table = np.array([
    [15, 25, 10],  # ææ–™A: è‰¯å“, è»½å¾®ä¸è‰¯, é‡å¤§ä¸è‰¯
    [20, 18, 12]   # ææ–™B
])

chi2_stat_ind, p_value_ind, dof, expected_ind = stats.chi2_contingency(contingency_table)

print(f"H0: ææ–™ã®ç¨®é¡ã¨ä¸è‰¯ã®ç¨‹åº¦ã¯ç‹¬ç«‹")
print(f"è¦³æ¸¬åº¦æ•°:\n{contingency_table}")
print(f"æœŸå¾…åº¦æ•°:\n{expected_ind}")
print(f"Ï‡Â²çµ±è¨ˆé‡: {chi2_stat_ind:.4f}")
print(f"è‡ªç”±åº¦: {dof}")
print(f"på€¤: {p_value_ind:.6f}")
print(f"åˆ¤å®š: {'H0ã‚’æ£„å´ï¼ˆé–¢é€£ã‚ã‚Šï¼‰' if p_value_ind < 0.05 else 'H0ã‚’æ£„å´ã§ããªã„'}\n")

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

# é©åˆåº¦æ¤œå®š
x = np.arange(1, 7)
width = 0.35
axes[0].bar(x - width/2, observed, width, label='è¦³æ¸¬', color='skyblue', edgecolor='black')
axes[0].bar(x + width/2, expected, width, label='æœŸå¾…', color='orange', edgecolor='black', alpha=0.7)
axes[0].set_xlabel('ã‚µã‚¤ã‚³ãƒ­ã®ç›®')
axes[0].set_ylabel('åº¦æ•°')
axes[0].set_title(f'é©åˆåº¦æ¤œå®š\nÏ‡Â²={chi2_stat:.2f}, p={p_value_gof:.4f}')
axes[0].set_xticks(x)
axes[0].legend()
axes[0].grid(True, alpha=0.3, axis='y')

# ç‹¬ç«‹æ€§æ¤œå®š
categories = ['è‰¯å“', 'è»½å¾®ä¸è‰¯', 'é‡å¤§ä¸è‰¯']
materials = ['ææ–™A', 'ææ–™B']
x = np.arange(len(categories))
width = 0.35

axes[1].bar(x - width/2, contingency_table[0], width, label='ææ–™A',
            color='lightblue', edgecolor='black')
axes[1].bar(x + width/2, contingency_table[1], width, label='ææ–™B',
            color='lightgreen', edgecolor='black')
axes[1].set_xlabel('å“è³ªã‚«ãƒ†ã‚´ãƒª')
axes[1].set_ylabel('åº¦æ•°')
axes[1].set_title(f'ç‹¬ç«‹æ€§æ¤œå®š\nÏ‡Â²={chi2_stat_ind:.2f}, p={p_value_ind:.4f}')
axes[1].set_xticks(x)
axes[1].set_xticklabels(categories)
axes[1].legend()
axes[1].grid(True, alpha=0.3, axis='y')

plt.tight_layout()
plt.show()</code></pre>
            </div>

            <h2>3.4 Fæ¤œå®šï¼ˆç­‰åˆ†æ•£æ€§ã®æ¤œå®šï¼‰</h2>

            <div class="example">
                <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹4: Fæ¤œå®š</h4>
                <pre><code>import numpy as np
import matplotlib.pyplot as plt
from scipy import stats

np.random.seed(42)

# 2ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã®åˆ†æ•£ãŒç­‰ã—ã„ã‹ï¼Ÿ
n1, n2 = 20, 25
sigma1, sigma2 = 15, 22  # çœŸã®æ¨™æº–åå·®

data1 = np.random.normal(100, sigma1, n1)
data2 = np.random.normal(100, sigma2, n2)

var1 = np.var(data1, ddof=1)
var2 = np.var(data2, ddof=1)

# Fçµ±è¨ˆé‡ï¼ˆå¤§ãã„åˆ†æ•£/å°ã•ã„åˆ†æ•£ï¼‰
F_stat = max(var1, var2) / min(var1, var2)
df1 = n1 - 1 if var1 > var2 else n2 - 1
df2 = n2 - 1 if var1 > var2 else n1 - 1

# ä¸¡å´æ¤œå®šã®på€¤
p_value = 2 * min(stats.f.cdf(F_stat, df1, df2),
                  1 - stats.f.cdf(F_stat, df1, df2))

print("=== Fæ¤œå®š: ç­‰åˆ†æ•£æ€§ã®æ¤œå®š ===")
print(f"H0: Ïƒâ‚Â² = Ïƒâ‚‚Â² (åˆ†æ•£ãŒç­‰ã—ã„)")
print(f"H1: Ïƒâ‚Â² â‰  Ïƒâ‚‚Â²")
print(f"\nãƒ‡ãƒ¼ã‚¿1: n={n1}, sÂ²={var1:.2f}")
print(f"ãƒ‡ãƒ¼ã‚¿2: n={n2}, sÂ²={var2:.2f}")
print(f"\nFçµ±è¨ˆé‡: {F_stat:.4f}")
print(f"è‡ªç”±åº¦: ({df1}, {df2})")
print(f"på€¤: {p_value:.6f}")
print(f"\nåˆ¤å®š: {'H0ã‚’æ£„å´ï¼ˆåˆ†æ•£ãŒç•°ãªã‚‹ï¼‰' if p_value < 0.05 else 'H0ã‚’æ£„å´ã§ããªã„ï¼ˆç­‰åˆ†æ•£æ€§ãŒä»®å®šã§ãã‚‹ï¼‰'}")

# Leveneã®æ¤œå®šï¼ˆã‚ˆã‚Šé ‘å¥ï¼‰
levene_stat, levene_p = stats.levene(data1, data2)
print(f"\nã€Leveneã®æ¤œå®šã€‘ï¼ˆé ‘å¥æ€§ãŒé«˜ã„ï¼‰")
print(f"çµ±è¨ˆé‡: {levene_stat:.4f}, på€¤: {levene_p:.6f}")

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

# ãƒ‡ãƒ¼ã‚¿ã®åˆ†å¸ƒ
axes[0].hist(data1, bins=12, density=True, alpha=0.6,
             color='skyblue', edgecolor='black', label=f'ãƒ‡ãƒ¼ã‚¿1 (sÂ²={var1:.1f})')
axes[0].hist(data2, bins=12, density=True, alpha=0.6,
             color='lightgreen', edgecolor='black', label=f'ãƒ‡ãƒ¼ã‚¿2 (sÂ²={var2:.1f})')
axes[0].set_xlabel('å€¤')
axes[0].set_ylabel('å¯†åº¦')
axes[0].set_title('2ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®åˆ†å¸ƒ')
axes[0].legend()
axes[0].grid(True, alpha=0.3)

# Fåˆ†å¸ƒã¨è¦³æ¸¬ã•ã‚ŒãŸFçµ±è¨ˆé‡
x = np.linspace(0, 5, 300)
axes[1].plot(x, stats.f.pdf(x, df1, df2), 'b-', linewidth=2,
             label=f'Fåˆ†å¸ƒ ({df1}, {df2})')
axes[1].axvline(F_stat, color='red', linestyle='--', linewidth=2,
                label=f'è¦³æ¸¬Fçµ±è¨ˆé‡: {F_stat:.2f}')

# è‡¨ç•Œå€¤ï¼ˆä¸¡å´5%ï¼‰
f_crit_upper = stats.f.ppf(0.975, df1, df2)
axes[1].axvline(f_crit_upper, color='orange', linestyle=':', linewidth=2,
                label=f'è‡¨ç•Œå€¤(ä¸Šå´2.5%): {f_crit_upper:.2f}')
axes[1].fill_between(x, 0, stats.f.pdf(x, df1, df2),
                      where=(x >= f_crit_upper), alpha=0.3, color='red',
                      label='æ£„å´åŸŸ')
axes[1].set_xlabel('Få€¤')
axes[1].set_ylabel('ç¢ºç‡å¯†åº¦')
axes[1].set_title(f'Fæ¤œå®šã®å¯è¦–åŒ–\np={p_value:.4f}')
axes[1].legend()
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()</code></pre>
            </div>

            <h2>3.5 æ¤œå®šåŠ›åˆ†æã¨ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºè¨ˆç®—</h2>

            <div class="theory-box">
                <h4>ğŸ“˜ æ¤œå®šåŠ›ï¼ˆPowerï¼‰</h4>
                <p>æ¤œå®šåŠ›ã¯çœŸã®åŠ¹æœã‚’æ­£ã—ãæ¤œå‡ºã™ã‚‹ç¢ºç‡ã§ã™ï¼š</p>
                <div class="formula">$$ \text{Power} = 1 - \beta = P(\text{reject } H_0 | H_1 \text{ is true}) $$</div>
                
                <p>æ¤œå®šåŠ›ã«å½±éŸ¿ã™ã‚‹è¦å› ï¼š</p>
                <ul>
                    <li><strong>åŠ¹æœé‡ï¼ˆEffect Sizeï¼‰</strong>: çœŸã®å·®ã®å¤§ãã•</li>
                    <li><strong>æ¨™æœ¬ã‚µã‚¤ã‚ºï¼ˆnï¼‰</strong>: å¤§ãã„ã»ã©æ¤œå®šåŠ›ãŒé«˜ã„</li>
                    <li><strong>æœ‰æ„æ°´æº–ï¼ˆÎ±ï¼‰</strong>: å¤§ãã„ã»ã©æ¤œå®šåŠ›ãŒé«˜ã„ï¼ˆç¬¬1ç¨®éèª¤ã¯å¢—åŠ ï¼‰</li>
                    <li><strong>ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ•£</strong>: å°ã•ã„ã»ã©æ¤œå®šåŠ›ãŒé«˜ã„</li>
                </ul>
            </div>

            <div class="example">
                <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹5: æ¤œå®šåŠ›åˆ†æã¨ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºè¨ˆç®—</h4>
                <pre><code>import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from statsmodels.stats.power import TTestIndPower

# æ¤œå®šåŠ›åˆ†æã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
mu0 = 100  # å¸°ç„¡ä»®èª¬ã®å¹³å‡
mu1 = 105  # å¯¾ç«‹ä»®èª¬ã®å¹³å‡
sigma = 10  # æ¨™æº–åå·®
alpha = 0.05

# Cohen's d (åŠ¹æœé‡)
effect_size = (mu1 - mu0) / sigma
print("=== æ¤œå®šåŠ›åˆ†æ ===")
print(f"åŠ¹æœé‡ Cohen's d: {effect_size:.3f}")
print(f"è§£é‡ˆ: {'small' if effect_size < 0.5 else 'medium' if effect_size < 0.8 else 'large'}")

# ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã¨æ¤œå®šåŠ›ã®é–¢ä¿‚
sample_sizes = np.arange(10, 201, 5)
powers = []

power_analysis = TTestIndPower()
for n in sample_sizes:
    power = power_analysis.power(effect_size, n, alpha, alternative='two-sided')
    powers.append(power)

# ç›®æ¨™æ¤œå®šåŠ›0.8ã‚’é”æˆã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º
target_power = 0.8
required_n = power_analysis.solve_power(effect_size, power=target_power,
                                        alpha=alpha, alternative='two-sided')

print(f"\nç›®æ¨™æ¤œå®šåŠ› {target_power} ã‚’é”æˆã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º: {int(np.ceil(required_n))}")

# åŠ¹æœé‡ã¨æ¤œå®šåŠ›ã®é–¢ä¿‚
effect_sizes = np.linspace(0.1, 1.5, 50)
powers_by_effect = []
n_fixed = 50

for es in effect_sizes:
    power = power_analysis.power(es, n_fixed, alpha, alternative='two-sided')
    powers_by_effect.append(power)

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# å¸°ç„¡ä»®èª¬ã¨å¯¾ç«‹ä»®èª¬ã®åˆ†å¸ƒ
x = np.linspace(80, 120, 300)
se_example = sigma / np.sqrt(50)
axes[0, 0].plot(x, stats.norm.pdf(x, mu0, se_example), 'b-',
                linewidth=2, label=f'H0: Î¼={mu0}')
axes[0, 0].plot(x, stats.norm.pdf(x, mu1, se_example), 'r-',
                linewidth=2, label=f'H1: Î¼={mu1}')

# è‡¨ç•Œå€¤
z_crit = stats.norm.ppf(1 - alpha/2)
x_crit_upper = mu0 + z_crit * se_example
x_crit_lower = mu0 - z_crit * se_example

axes[0, 0].axvline(x_crit_upper, color='green', linestyle='--',
                   linewidth=2, label='è‡¨ç•Œå€¤')
axes[0, 0].axvline(x_crit_lower, color='green', linestyle='--', linewidth=2)

# Î²é ˜åŸŸï¼ˆç¬¬2ç¨®éèª¤ï¼‰
x_beta = np.linspace(x_crit_lower, x_crit_upper, 100)
axes[0, 0].fill_between(x_beta, 0, stats.norm.pdf(x_beta, mu1, se_example),
                         alpha=0.3, color='orange', label='Î² (ç¬¬2ç¨®éèª¤)')

# æ¤œå®šåŠ›é ˜åŸŸ
x_power_lower = np.linspace(80, x_crit_lower, 100)
x_power_upper = np.linspace(x_crit_upper, 120, 100)
axes[0, 0].fill_between(x_power_lower, 0, stats.norm.pdf(x_power_lower, mu1, se_example),
                         alpha=0.3, color='green', label='æ¤œå®šåŠ›')
axes[0, 0].fill_between(x_power_upper, 0, stats.norm.pdf(x_power_upper, mu1, se_example),
                         alpha=0.3, color='green')

axes[0, 0].set_xlabel('å€¤')
axes[0, 0].set_ylabel('ç¢ºç‡å¯†åº¦')
axes[0, 0].set_title(f'æ¤œå®šåŠ›ã®æ¦‚å¿µå›³ (n=50, Power={powers[8]:.3f})')
axes[0, 0].legend()
axes[0, 0].grid(True, alpha=0.3)

# ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã¨æ¤œå®šåŠ›
axes[0, 1].plot(sample_sizes, powers, 'b-', linewidth=2)
axes[0, 1].axhline(target_power, color='red', linestyle='--',
                   linewidth=2, label=f'ç›®æ¨™æ¤œå®šåŠ›: {target_power}')
axes[0, 1].axvline(required_n, color='green', linestyle='--',
                   linewidth=2, label=f'å¿…è¦n: {int(np.ceil(required_n))}')
axes[0, 1].set_xlabel('ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º (å„ç¾¤)')
axes[0, 1].set_ylabel('æ¤œå®šåŠ› (1-Î²)')
axes[0, 1].set_title(f'ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã¨æ¤œå®šåŠ› (d={effect_size:.2f})')
axes[0, 1].legend()
axes[0, 1].grid(True, alpha=0.3)

# åŠ¹æœé‡ã¨æ¤œå®šåŠ›
axes[1, 0].plot(effect_sizes, powers_by_effect, 'b-', linewidth=2)
axes[1, 0].axhline(target_power, color='red', linestyle='--',
                   linewidth=2, label=f'ç›®æ¨™æ¤œå®šåŠ›: {target_power}')
axes[1, 0].axvline(effect_size, color='orange', linestyle='--',
                   linewidth=2, label=f'ç¾åœ¨ã®åŠ¹æœé‡: {effect_size:.2f}')
axes[1, 0].set_xlabel("åŠ¹æœé‡ (Cohen's d)")
axes[1, 0].set_ylabel('æ¤œå®šåŠ› (1-Î²)')
axes[1, 0].set_title(f'åŠ¹æœé‡ã¨æ¤œå®šåŠ› (n={n_fixed})')
axes[1, 0].legend()
axes[1, 0].grid(True, alpha=0.3)

# Î±ã¨Î²ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•
alphas = np.linspace(0.01, 0.2, 50)
betas_at_alphas = []

for a in alphas:
    power = power_analysis.power(effect_size, n_fixed, a, alternative='two-sided')
    betas_at_alphas.append(1 - power)

axes[1, 1].plot(alphas, betas_at_alphas, 'b-', linewidth=2, label='Î²')
axes[1, 1].plot(alphas, alphas, 'r--', linewidth=2, label='Î±')
axes[1, 1].axvline(0.05, color='green', linestyle=':', linewidth=2,
                   label='Î±=0.05 (æ…£ä¾‹)')
axes[1, 1].set_xlabel('Î± (ç¬¬1ç¨®éèª¤ç‡)')
axes[1, 1].set_ylabel('èª¤ã‚Šç‡')
axes[1, 1].set_title(f'Î±ã¨Î²ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ• (n={n_fixed}, d={effect_size:.2f})')
axes[1, 1].legend()
axes[1, 1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

# å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹
print("\n=== ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºè¨­è¨ˆã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ ===")
print(f"å°åŠ¹æœ (d=0.2): n â‰ˆ {int(np.ceil(power_analysis.solve_power(0.2, power=0.8, alpha=0.05)))}")
print(f"ä¸­åŠ¹æœ (d=0.5): n â‰ˆ {int(np.ceil(power_analysis.solve_power(0.5, power=0.8, alpha=0.05)))}")
print(f"å¤§åŠ¹æœ (d=0.8): n â‰ˆ {int(np.ceil(power_analysis.solve_power(0.8, power=0.8, alpha=0.05)))}")</code></pre>
            </div>

            <h2>3.6 å¤šé‡æ¯”è¼ƒå•é¡Œã¨è£œæ­£æ³•</h2>

            <div class="theory-box">
                <h4>ğŸ“˜ å¤šé‡æ¯”è¼ƒå•é¡Œ</h4>
                <p>è¤‡æ•°ã®ä»®èª¬æ¤œå®šã‚’åŒæ™‚ã«è¡Œã†ã¨ã€å°‘ãªãã¨ã‚‚1ã¤ã®ç¬¬1ç¨®éèª¤ãŒèµ·ãã‚‹ç¢ºç‡ï¼ˆFamily-Wise Error Rate, FWERï¼‰ãŒå¢—åŠ ã—ã¾ã™ï¼š</p>
                <div class="formula">$$ \text{FWER} = 1 - (1-\alpha)^m $$</div>
                <p>ã“ã“ã§ \( m \) ã¯æ¤œå®šå›æ•°ã§ã™ã€‚</p>
                
                <p><strong>Bonferroniè£œæ­£</strong>: å„æ¤œå®šã®æœ‰æ„æ°´æº–ã‚’ \( \alpha/m \) ã«è¨­å®š</p>
                <p><strong>Holmæ³•</strong>: ã‚¹ãƒ†ãƒƒãƒ—ãƒ€ã‚¦ãƒ³æ³•ï¼ˆã‚ˆã‚Šæ¤œå®šåŠ›ãŒé«˜ã„ï¼‰</p>
                <p><strong>FDRåˆ¶å¾¡</strong>: Benjamini-Hochbergæ³•ï¼ˆFalse Discovery Rateã‚’åˆ¶å¾¡ï¼‰</p>
            </div>

            <div class="example">
                <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹6: å¤šé‡æ¯”è¼ƒè£œæ­£</h4>
                <pre><code>import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from statsmodels.stats.multitest import multipletests

np.random.seed(42)

# 10å€‹ã®ææ–™ç‰¹æ€§ã‚’åŒæ™‚ã«æ¤œå®š
n_tests = 10
n_samples = 30
alpha = 0.05

# 9å€‹ã¯å·®ãªã—ã€1å€‹ã ã‘çœŸã®å·®ã‚ã‚Š
p_values = []
for i in range(n_tests):
    if i == 5:  # 6ç•ªç›®ã ã‘çœŸã®å·®
        data1 = np.random.normal(100, 15, n_samples)
        data2 = np.random.normal(110, 15, n_samples)
    else:  # ä»–ã¯å·®ãªã—
        data1 = np.random.normal(100, 15, n_samples)
        data2 = np.random.normal(100, 15, n_samples)
    
    _, p = stats.ttest_ind(data1, data2)
    p_values.append(p)

p_values = np.array(p_values)

print("=== å¤šé‡æ¯”è¼ƒå•é¡Œ ===")
print(f"æ¤œå®šå›æ•°: {n_tests}")
print(f"å„æ¤œå®šã®æœ‰æ„æ°´æº–: Î± = {alpha}")
print(f"ç†è«–çš„FWER: {1 - (1-alpha)**n_tests:.4f}")
print(f"\nå…ƒã®på€¤:\n{p_values}")
print(f"\nè£œæ­£ãªã—ï¼ˆÎ±={alpha}ï¼‰ã§æœ‰æ„: {np.sum(p_values < alpha)}å€‹")

# å„ç¨®è£œæ­£æ³•ã®é©ç”¨
methods = ['bonferroni', 'holm', 'fdr_bh']
method_names = ['Bonferroni', 'Holm', 'Benjamini-Hochberg']

results = {}
for method, name in zip(methods, method_names):
    reject, p_corrected, _, _ = multipletests(p_values, alpha=alpha, method=method)
    results[name] = {'reject': reject, 'p_corrected': p_corrected}
    print(f"\nã€{name}æ³•ã€‘")
    print(f"  è£œæ­£å¾Œpå€¤: {p_corrected}")
    print(f"  æœ‰æ„ã¨åˆ¤å®š: {np.sum(reject)}å€‹ (ä½ç½®: {np.where(reject)[0]})")

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# å…ƒã®på€¤
axes[0, 0].bar(range(n_tests), p_values, color='skyblue', edgecolor='black')
axes[0, 0].axhline(alpha, color='red', linestyle='--', linewidth=2,
                   label=f'Î± = {alpha}')
axes[0, 0].set_xlabel('æ¤œå®šç•ªå·')
axes[0, 0].set_ylabel('på€¤')
axes[0, 0].set_title('å…ƒã®på€¤ï¼ˆè£œæ­£ãªã—ï¼‰')
axes[0, 0].legend()
axes[0, 0].grid(True, alpha=0.3, axis='y')

# Bonferroniè£œæ­£
reject_bonf = results['Bonferroni']['reject']
colors = ['red' if r else 'skyblue' for r in reject_bonf]
axes[0, 1].bar(range(n_tests), p_values, color=colors, edgecolor='black')
axes[0, 1].axhline(alpha/n_tests, color='orange', linestyle='--',
                   linewidth=2, label=f'Bonferroni Î± = {alpha/n_tests:.4f}')
axes[0, 1].set_xlabel('æ¤œå®šç•ªå·')
axes[0, 1].set_ylabel('på€¤')
axes[0, 1].set_title('Bonferroniè£œæ­£')
axes[0, 1].legend()
axes[0, 1].grid(True, alpha=0.3, axis='y')

# Holmè£œæ­£
reject_holm = results['Holm']['reject']
colors = ['red' if r else 'skyblue' for r in reject_holm]
axes[1, 0].bar(range(n_tests), p_values, color=colors, edgecolor='black')
# Holmæ³•ã®æ®µéšçš„ãªé–¾å€¤ã‚’è¡¨ç¤º
sorted_idx = np.argsort(p_values)
for rank, idx in enumerate(sorted_idx):
    holm_alpha = alpha / (n_tests - rank)
    axes[1, 0].plot(idx, holm_alpha, 'o', color='orange', markersize=8)

axes[1, 0].set_xlabel('æ¤œå®šç•ªå·')
axes[1, 0].set_ylabel('på€¤')
axes[1, 0].set_title('Holmè£œæ­£ï¼ˆæ®µéšçš„é–¾å€¤ï¼‰')
axes[1, 0].grid(True, alpha=0.3, axis='y')

# FDR (Benjamini-Hochberg)
reject_fdr = results['Benjamini-Hochberg']['reject']
colors = ['red' if r else 'skyblue' for r in reject_fdr]
sorted_p = np.sort(p_values)
bh_thresholds = [(i+1)/n_tests * alpha for i in range(n_tests)]

axes[1, 1].bar(range(n_tests), sorted_p, color=['red' if sorted_p[i] < bh_thresholds[i] else 'skyblue' for i in range(n_tests)],
               edgecolor='black', alpha=0.7, label='på€¤')
axes[1, 1].plot(range(n_tests), bh_thresholds, 'o-', color='orange',
                linewidth=2, markersize=6, label='BHé–¾å€¤')
axes[1, 1].set_xlabel('æ¤œå®šç•ªå·ï¼ˆpå€¤ã§ã‚½ãƒ¼ãƒˆæ¸ˆã¿ï¼‰')
axes[1, 1].set_ylabel('på€¤')
axes[1, 1].set_title('Benjamini-Hochberg (FDRåˆ¶å¾¡)')
axes[1, 1].legend()
axes[1, 1].grid(True, alpha=0.3, axis='y')

plt.tight_layout()
plt.show()

# ã¾ã¨ã‚
print("\n=== è£œæ­£æ³•ã®æ¯”è¼ƒ ===")
print(f"è£œæ­£ãªã—: {np.sum(p_values < alpha)}å€‹æœ‰æ„")
print(f"Bonferroni: {np.sum(results['Bonferroni']['reject'])}å€‹æœ‰æ„ï¼ˆæœ€ã‚‚ä¿å®ˆçš„ï¼‰")
print(f"Holm: {np.sum(results['Holm']['reject'])}å€‹æœ‰æ„")
print(f"Benjamini-Hochberg: {np.sum(results['Benjamini-Hochberg']['reject'])}å€‹æœ‰æ„ï¼ˆæ¤œå®šåŠ›ãŒé«˜ã„ï¼‰")</code></pre>
            </div>

            <h2>3.7 å“è³ªç®¡ç†ã«ãŠã‘ã‚‹ä»®èª¬æ¤œå®š</h2>

            <div class="example">
                <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹7: å“è³ªç®¡ç†ãƒ‡ãƒ¼ã‚¿ã®åŒ…æ‹¬çš„æ¤œå®š</h4>
                <pre><code>import numpy as np
import matplotlib.pyplot as plt
from scipy import stats

# å“è³ªç®¡ç†ã‚·ãƒŠãƒªã‚ª: è£½é€ ãƒ©ã‚¤ãƒ³ã®å“è³ªãƒ‡ãƒ¼ã‚¿
np.random.seed(42)

# å¾“æ¥ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆåŸºæº–ï¼‰
baseline_mean = 500
baseline_std = 15
n_baseline = 50
baseline_data = np.random.normal(baseline_mean, baseline_std, n_baseline)

# æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆæ¤œè¨¼å¯¾è±¡ï¼‰
improved_mean = 505  # å¹³å‡ãŒå‘ä¸Š
improved_std = 12    # ã°ã‚‰ã¤ããŒæ¸›å°‘
n_improved = 60
improved_data = np.random.normal(improved_mean, improved_std, n_improved)

print("=== å“è³ªç®¡ç†ã«ãŠã‘ã‚‹çµ±è¨ˆçš„æ¤œå®š ===")

# 1. å¹³å‡ã®æ¤œå®šï¼ˆtæ¤œå®šï¼‰
print("\nã€1. å¹³å‡å¼·åº¦ã®æ”¹å–„æ¤œå®šã€‘")
t_stat, p_value_mean = stats.ttest_ind(improved_data, baseline_data, equal_var=False)
print(f"å¾“æ¥ãƒ—ãƒ­ã‚»ã‚¹å¹³å‡: {np.mean(baseline_data):.2f} MPa")
print(f"æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹å¹³å‡: {np.mean(improved_data):.2f} MPa")
print(f"tçµ±è¨ˆé‡: {t_stat:.4f}, på€¤: {p_value_mean:.6f}")
print(f"åˆ¤å®š: {'æœ‰æ„ã«æ”¹å–„' if p_value_mean < 0.05 and t_stat > 0 else 'æœ‰æ„ãªæ”¹å–„ãªã—'}")

# 2. åˆ†æ•£ã®æ¤œå®šï¼ˆFæ¤œå®šï¼‰
print("\nã€2. ã°ã‚‰ã¤ãã®æ”¹å–„æ¤œå®šã€‘")
var_baseline = np.var(baseline_data, ddof=1)
var_improved = np.var(improved_data, ddof=1)
F_stat = var_baseline / var_improved
df1, df2 = n_baseline - 1, n_improved - 1
p_value_var = stats.f.sf(F_stat, df1, df2)  # ç‰‡å´æ¤œå®šï¼ˆã°ã‚‰ã¤ãæ¸›å°‘ï¼‰

print(f"å¾“æ¥ãƒ—ãƒ­ã‚»ã‚¹åˆ†æ•£: {var_baseline:.2f}")
print(f"æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹åˆ†æ•£: {var_improved:.2f}")
print(f"Fçµ±è¨ˆé‡: {F_stat:.4f}, på€¤: {p_value_var:.6f}")
print(f"åˆ¤å®š: {'ã°ã‚‰ã¤ããŒæœ‰æ„ã«æ¸›å°‘' if p_value_var < 0.05 else 'ã°ã‚‰ã¤ãã®æœ‰æ„ãªæ¸›å°‘ãªã—'}")

# 3. è¦æ ¼å¤–ã‚Œç‡ã®æ¤œå®šï¼ˆæ¯”ç‡ã®æ¤œå®šï¼‰
print("\nã€3. è¦æ ¼å¤–ã‚Œç‡ã®æ¤œå®šã€‘")
spec_lower = 470  # ä¸‹é™è¦æ ¼
spec_upper = 530  # ä¸Šé™è¦æ ¼

defect_baseline = np.sum((baseline_data < spec_lower) | (baseline_data > spec_upper))
defect_improved = np.sum((improved_data < spec_lower) | (improved_data > spec_upper))

p_baseline = defect_baseline / n_baseline
p_improved = defect_improved / n_improved

# 2æ¨™æœ¬ã®æ¯”ç‡ã®æ¤œå®š
pooled_p = (defect_baseline + defect_improved) / (n_baseline + n_improved)
se_pool = np.sqrt(pooled_p * (1 - pooled_p) * (1/n_baseline + 1/n_improved))
z_prop = (p_baseline - p_improved) / se_pool if se_pool > 0 else 0
p_value_prop = stats.norm.sf(z_prop)  # ç‰‡å´æ¤œå®š

print(f"å¾“æ¥ãƒ—ãƒ­ã‚»ã‚¹è¦æ ¼å¤–ã‚Œç‡: {p_baseline:.4f} ({defect_baseline}/{n_baseline})")
print(f"æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹è¦æ ¼å¤–ã‚Œç‡: {p_improved:.4f} ({defect_improved}/{n_improved})")
print(f"zçµ±è¨ˆé‡: {z_prop:.4f}, på€¤: {p_value_prop:.6f}")
print(f"åˆ¤å®š: {'è¦æ ¼å¤–ã‚Œç‡ãŒæœ‰æ„ã«æ”¹å–„' if p_value_prop < 0.05 else 'æœ‰æ„ãªæ”¹å–„ãªã—'}")

# 4. å·¥ç¨‹èƒ½åŠ›æŒ‡æ•°ã®æ¯”è¼ƒ
print("\nã€4. å·¥ç¨‹èƒ½åŠ›æŒ‡æ•° Cp, Cpkã€‘")
spec_range = spec_upper - spec_lower

Cp_baseline = spec_range / (6 * np.std(baseline_data, ddof=1))
Cpk_baseline_lower = (np.mean(baseline_data) - spec_lower) / (3 * np.std(baseline_data, ddof=1))
Cpk_baseline_upper = (spec_upper - np.mean(baseline_data)) / (3 * np.std(baseline_data, ddof=1))
Cpk_baseline = min(Cpk_baseline_lower, Cpk_baseline_upper)

Cp_improved = spec_range / (6 * np.std(improved_data, ddof=1))
Cpk_improved_lower = (np.mean(improved_data) - spec_lower) / (3 * np.std(improved_data, ddof=1))
Cpk_improved_upper = (spec_upper - np.mean(improved_data)) / (3 * np.std(improved_data, ddof=1))
Cpk_improved = min(Cpk_improved_lower, Cpk_improved_upper)

print(f"å¾“æ¥ãƒ—ãƒ­ã‚»ã‚¹: Cp={Cp_baseline:.3f}, Cpk={Cpk_baseline:.3f}")
print(f"æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹: Cp={Cp_improved:.3f}, Cpk={Cpk_improved:.3f}")
print(f"è©•ä¾¡: Cpk â‰¥ 1.33 ã§å„ªç§€ã€â‰¥ 1.00 ã§è¨±å®¹å¯èƒ½")

# å¯è¦–åŒ–
fig = plt.figure(figsize=(16, 10))
gs = fig.add_gridspec(3, 2, hspace=0.3, wspace=0.3)

# 1. ãƒ‡ãƒ¼ã‚¿ã®åˆ†å¸ƒæ¯”è¼ƒ
ax1 = fig.add_subplot(gs[0, :])
ax1.hist(baseline_data, bins=20, density=True, alpha=0.6,
         color='skyblue', edgecolor='black', label='å¾“æ¥ãƒ—ãƒ­ã‚»ã‚¹')
ax1.hist(improved_data, bins=20, density=True, alpha=0.6,
         color='lightgreen', edgecolor='black', label='æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹')
ax1.axvline(spec_lower, color='red', linestyle='--', linewidth=2, label='è¦æ ¼ä¸‹é™')
ax1.axvline(spec_upper, color='red', linestyle='--', linewidth=2, label='è¦æ ¼ä¸Šé™')
ax1.axvline(np.mean(baseline_data), color='blue', linestyle=':', linewidth=2)
ax1.axvline(np.mean(improved_data), color='green', linestyle=':', linewidth=2)
ax1.set_xlabel('å¼·åº¦ [MPa]')
ax1.set_ylabel('å¯†åº¦')
ax1.set_title(f'ãƒ—ãƒ­ã‚»ã‚¹æ”¹å–„ã®åŠ¹æœ\nå¹³å‡: {np.mean(baseline_data):.1f} â†’ {np.mean(improved_data):.1f} (p={p_value_mean:.4f}), '
              f'SD: {np.std(baseline_data, ddof=1):.1f} â†’ {np.std(improved_data, ddof=1):.1f}')
ax1.legend()
ax1.grid(True, alpha=0.3)

# 2. ç®±ã²ã’å›³
ax2 = fig.add_subplot(gs[1, 0])
bp = ax2.boxplot([baseline_data, improved_data], labels=['å¾“æ¥', 'æ”¹å–„'],
                  patch_artist=True)
bp['boxes'][0].set_facecolor('lightblue')
bp['boxes'][1].set_facecolor('lightgreen')
ax2.axhline(spec_lower, color='red', linestyle='--', linewidth=1.5, alpha=0.7)
ax2.axhline(spec_upper, color='red', linestyle='--', linewidth=1.5, alpha=0.7)
ax2.set_ylabel('å¼·åº¦ [MPa]')
ax2.set_title('ã°ã‚‰ã¤ãã®æ¯”è¼ƒ')
ax2.grid(True, alpha=0.3, axis='y')

# 3. Q-Qãƒ—ãƒ­ãƒƒãƒˆï¼ˆæ­£è¦æ€§ç¢ºèªï¼‰
ax3 = fig.add_subplot(gs[1, 1])
stats.probplot(improved_data, dist="norm", plot=ax3)
ax3.set_title('æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹ã®æ­£è¦Q-Qãƒ—ãƒ­ãƒƒãƒˆ')
ax3.grid(True, alpha=0.3)

# 4. å·¥ç¨‹èƒ½åŠ›æŒ‡æ•°ã®æ¯”è¼ƒ
ax4 = fig.add_subplot(gs[2, 0])
metrics = ['Cp', 'Cpk']
baseline_metrics = [Cp_baseline, Cpk_baseline]
improved_metrics = [Cp_improved, Cpk_improved]
x = np.arange(len(metrics))
width = 0.35

ax4.bar(x - width/2, baseline_metrics, width, label='å¾“æ¥',
        color='lightblue', edgecolor='black')
ax4.bar(x + width/2, improved_metrics, width, label='æ”¹å–„',
        color='lightgreen', edgecolor='black')
ax4.axhline(1.33, color='green', linestyle='--', linewidth=2, label='å„ªç§€ãƒ©ã‚¤ãƒ³')
ax4.axhline(1.00, color='orange', linestyle='--', linewidth=2, label='è¨±å®¹ãƒ©ã‚¤ãƒ³')
ax4.set_xticks(x)
ax4.set_xticklabels(metrics)
ax4.set_ylabel('å·¥ç¨‹èƒ½åŠ›æŒ‡æ•°')
ax4.set_title('å·¥ç¨‹èƒ½åŠ›ã®æ”¹å–„')
ax4.legend()
ax4.grid(True, alpha=0.3, axis='y')

# 5. è¦æ ¼å¤–ã‚Œç‡ã®æ¯”è¼ƒ
ax5 = fig.add_subplot(gs[2, 1])
categories = ['å¾“æ¥ãƒ—ãƒ­ã‚»ã‚¹', 'æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹']
defect_rates = [p_baseline * 100, p_improved * 100]
bars = ax5.bar(categories, defect_rates, color=['lightblue', 'lightgreen'],
               edgecolor='black')
for bar, rate in zip(bars, defect_rates):
    height = bar.get_height()
    ax5.text(bar.get_x() + bar.get_width()/2., height,
             f'{rate:.2f}%', ha='center', va='bottom', fontsize=12)
ax5.set_ylabel('è¦æ ¼å¤–ã‚Œç‡ [%]')
ax5.set_title(f'è¦æ ¼å¤–ã‚Œç‡ã®æ”¹å–„ (p={p_value_prop:.4f})')
ax5.grid(True, alpha=0.3, axis='y')

plt.tight_layout()
plt.show()

print("\n=== ç·åˆè©•ä¾¡ ===")
improvements = []
if p_value_mean < 0.05 and t_stat > 0:
    improvements.append("âœ“ å¹³å‡å¼·åº¦ãŒæœ‰æ„ã«å‘ä¸Š")
if p_value_var < 0.05:
    improvements.append("âœ“ ã°ã‚‰ã¤ããŒæœ‰æ„ã«æ¸›å°‘")
if p_value_prop < 0.05:
    improvements.append("âœ“ è¦æ ¼å¤–ã‚Œç‡ãŒæœ‰æ„ã«æ”¹å–„")
if Cpk_improved > Cpk_baseline:
    improvements.append(f"âœ“ å·¥ç¨‹èƒ½åŠ›æŒ‡æ•°ãŒæ”¹å–„ ({Cpk_baseline:.2f} â†’ {Cpk_improved:.2f})")

if improvements:
    print("ãƒ—ãƒ­ã‚»ã‚¹æ”¹å–„ã¯çµ±è¨ˆçš„ã«æœ‰æ„:")
    for imp in improvements:
        print(f"  {imp}")
else:
    print("çµ±è¨ˆçš„ã«æœ‰æ„ãªæ”¹å–„ã¯ç¢ºèªã§ãã¾ã›ã‚“ã§ã—ãŸ")</code></pre>
            </div>

            <div class="exercise">
                <h4>ğŸ“ ç·´ç¿’å•é¡Œ</h4>
                <ol>
                    <li>ç‰‡å´æ¤œå®šã¨ä¸¡å´æ¤œå®šã®ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦ã€å…·ä½“ä¾‹ã‚’æŒ™ã’ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</li>
                    <li>på€¤ãŒ0.06ã®å ´åˆã€ã©ã®ã‚ˆã†ã«è§£é‡ˆã™ã¹ãã‹è­°è«–ã—ã¦ãã ã•ã„ã€‚</li>
                    <li>æ¤œå®šåŠ›0.8ã‚’é”æˆã™ã‚‹ãŸã‚ã«å¿…è¦ãªã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã‚’ã€åŠ¹æœé‡d=0.3, 0.5, 0.8ã§è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</li>
                    <li>5ã¤ã®ä»®èª¬æ¤œå®šã‚’è¡Œã†å ´åˆã€Bonferroniè£œæ­£å¾Œã®å„æ¤œå®šã®æœ‰æ„æ°´æº–ã¯ã„ãã¤ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</li>
                </ol>
            </div>

            <h2>ã¾ã¨ã‚</h2>
            <ul>
                <li>ä»®èª¬æ¤œå®šã¯å¸°ç„¡ä»®èª¬ã‚’çµ±è¨ˆçš„ã«è©•ä¾¡ã™ã‚‹æ çµ„ã¿ã§ã‚ã‚‹</li>
                <li>ç¬¬1ç¨®éèª¤ï¼ˆÎ±ï¼‰ã¨ç¬¬2ç¨®éèª¤ï¼ˆÎ²ï¼‰ã®ãƒãƒ©ãƒ³ã‚¹ãŒé‡è¦</li>
                <li>på€¤ã¯å¸°ç„¡ä»®èª¬ãŒçœŸã®ã¨ãã®æ¥µç«¯ã•ã®ç¢ºç‡ã§ã‚ã‚Šã€å¸°ç„¡ä»®èª¬ã®çœŸå½ã®ç¢ºç‡ã§ã¯ãªã„</li>
                <li>tæ¤œå®šã¯æ¯å¹³å‡ã®æ¯”è¼ƒã«ã€Fæ¤œå®šã¯åˆ†æ•£ã®æ¯”è¼ƒã«ç”¨ã„ã‚‹</li>
                <li>ã‚«ã‚¤äºŒä¹—æ¤œå®šã¯åº¦æ•°ãƒ‡ãƒ¼ã‚¿ã‚„ç‹¬ç«‹æ€§ã®æ¤œå®šã«æœ‰åŠ¹</li>
                <li>æ¤œå®šåŠ›åˆ†æã¯å®Ÿé¨“è¨ˆç”»ã§å¿…é ˆã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚ã‚‹</li>
                <li>å¤šé‡æ¯”è¼ƒã§ã¯é©åˆ‡ãªè£œæ­£æ³•ï¼ˆBonferroni, Holm, FDRï¼‰ã‚’é¸æŠã™ã‚‹</li>
                <li>å“è³ªç®¡ç†ã§ã¯è¤‡æ•°ã®çµ±è¨ˆçš„æŒ‡æ¨™ã‚’çµ„ã¿åˆã‚ã›ã¦è©•ä¾¡ã™ã‚‹</li>
            </ul>
        </div>

        <div class="nav-buttons">
            <a href="chapter-2.html" class="nav-button">â† ç¬¬2ç« : åŒºé–“æ¨å®šã¨ä¿¡é ¼åŒºé–“</a>
            <a href="chapter-4.html" class="nav-button">ç¬¬4ç« : ãƒ™ã‚¤ã‚ºæ¨è«–ã®åŸºç¤ã¨MCMC â†’</a>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 AI Terakoya - Fundamentals of Mathematics & Physics Dojo</p>
    </footer>
</body>
</html>
