<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¬¬2ç« ï¼šçµ±è¨ˆçš„å·¥ç¨‹ç®¡ç†(SPC)ã¨ç®¡ç†å›³ - å“è³ªç®¡ç†ã¨QAå…¥é–€ã‚·ãƒªãƒ¼ã‚º">
    <title>ç¬¬2ç« ï¼šçµ±è¨ˆçš„å·¥ç¨‹ç®¡ç†(SPC)ã¨ç®¡ç†å›³ - å“è³ªç®¡ç†ã¨QAå…¥é–€ | PI Terakoya</title>

        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8; color: #333; background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; padding: 2rem 1rem; text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .back-link {
            display: inline-block; margin-bottom: 2rem; padding: 0.5rem 1rem;
            background: white; color: #11998e; text-decoration: none;
            border-radius: 6px; font-weight: 600;
        }
        .content-box {
            background: white; padding: 2rem; border-radius: 12px;
            margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #11998e; margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem; border-bottom: 3px solid #11998e;
        }
        h3 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h4 { color: #2c3e50; margin: 1rem 0 0.5rem 0; }
        p { margin-bottom: 1rem; }
        ul, ol { margin-left: 2rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
        pre {
            background: #1e1e1e; color: #d4d4d4; padding: 1.5rem;
            border-radius: 8px; overflow-x: auto; margin: 1rem 0;
            border-left: 4px solid #11998e;
        }
        code {
            font-family: 'Courier New', monospace; font-size: 0.9rem;
        }
        .key-point {
            background: #e8f5e9; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #4caf50; margin: 1rem 0;
        }
        .tech-note {
            background: #e3f2fd; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #2196f3; margin: 1rem 0;
        }
        .formula {
            background: #f0f7ff; padding: 1rem; border-radius: 6px;
            margin: 1rem 0; overflow-x: auto;
        }
        table {
            width: 100%; border-collapse: collapse; margin: 1rem 0;
        }
        th, td {
            border: 1px solid #ddd; padding: 0.75rem; text-align: left;
        }
        th {
            background: #11998e; color: white; font-weight: 600;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: 3rem;
        }
        .nav-buttons a {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; text-decoration: none; border-radius: 6px;
            font-weight: 600;
        }
        footer {
            background: #2c3e50; color: white; text-align: center;
            padding: 2rem 1rem; margin-top: 4rem;
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.6rem; }
            .container { padding: 0 0.5rem; }
            pre { padding: 1rem; }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>
</head>
<body>
            <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="/AI-Knowledge-Notes/knowledge/jp/index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="/AI-Knowledge-Notes/knowledge/jp/PI/index.html">ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹</a><span class="breadcrumb-separator">â€º</span><a href="/AI-Knowledge-Notes/knowledge/jp/PI/qa-introduction/index.html">Qa</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 2</span>
        </div>
    </nav>

        <header>
        <div class="container">
            <h1>ç¬¬2ç« ï¼šçµ±è¨ˆçš„å·¥ç¨‹ç®¡ç†(SPC)ã¨ç®¡ç†å›³</h1>
            <p class="subtitle">ãƒ—ãƒ­ã‚»ã‚¹å¤‰å‹•ã‚’å¯è¦–åŒ–ã—ã€ç•°å¸¸ã‚’æ—©æœŸæ¤œçŸ¥ã™ã‚‹ãŸã‚ã®å®Ÿè·µçš„æ‰‹æ³•</p>
            <div class="meta">
                <span class="meta">ğŸ“š å“è³ªç®¡ç†ã¨QAå…¥é–€ã‚·ãƒªãƒ¼ã‚º</span>
                <span class="meta">â±ï¸ èª­äº†æ™‚é–“: 40åˆ†</span>
                <span class="meta">ğŸ’» Pythonå®Ÿè£…ä¾‹: 8ã¤</span>
                <span class="meta">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
            </div>
        </div>
    </header>

    <div class="container">
        <section>
            <h2>2.1 çµ±è¨ˆçš„å·¥ç¨‹ç®¡ç†(SPC)ã®åŸºç¤</h2>

            <p>çµ±è¨ˆçš„å·¥ç¨‹ç®¡ç†(Statistical Process Control: SPC)ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹ã®å¤‰å‹•ã‚’çµ±è¨ˆçš„ã«ç›£è¦–ã—ã€ç•°å¸¸ã‚’æ—©æœŸã«æ¤œçŸ¥ã™ã‚‹ãŸã‚ã®æ‰‹æ³•ã§ã™ã€‚ã‚¦ã‚©ãƒ«ã‚¿ãƒ¼ãƒ»ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆåšå£«ãŒ1920å¹´ä»£ã«ãƒ™ãƒ«ç ”ç©¶æ‰€ã§é–‹ç™ºã—ãŸç®¡ç†å›³ã‚’åŸºç¤ã¨ã—ã¦ã„ã¾ã™ã€‚</p>

            <h3>2.1.1 ãƒ—ãƒ­ã‚»ã‚¹å¤‰å‹•ã®2ã¤ã®åŸå› </h3>

            <div class="info-box">
                <h4>ğŸ’¡ å¤‰å‹•ã®åˆ†é¡</h4>
                <ul>
                    <li><strong>å¶ç„¶åŸå› (Common Cause)</strong>: ãƒ—ãƒ­ã‚»ã‚¹ã«å›ºæœ‰ã®é¿ã‘ã‚‰ã‚Œãªã„å¤‰å‹•ï¼ˆåŸææ–™ã®ã°ã‚‰ã¤ãã€æ¸¬å®šèª¤å·®ãªã©ï¼‰</li>
                    <li><strong>ç•°å¸¸åŸå› (Special Cause)</strong>: é€šå¸¸ã§ãªã„ç‰¹å®šã®è¦å› ã«ã‚ˆã‚‹å¤‰å‹•ï¼ˆè¨­å‚™æ•…éšœã€æ“ä½œãƒŸã‚¹ãªã©ï¼‰</li>
                </ul>
            </div>

            <p>SPCã®ç›®çš„ã¯ã€å¶ç„¶åŸå› ã«ã‚ˆã‚‹æ­£å¸¸ãªå¤‰å‹•ã¨ç•°å¸¸åŸå› ã«ã‚ˆã‚‹ç•°å¸¸ãªå¤‰å‹•ã‚’çµ±è¨ˆçš„ã«åŒºåˆ¥ã—ã€ç•°å¸¸åŸå› ã‚’æ—©æœŸã«ç™ºè¦‹ã—ã¦å¯¾å‡¦ã™ã‚‹ã“ã¨ã§ã™ã€‚</p>

            <h3>2.1.2 ç®¡ç†å›³ã®åŸºæœ¬æ§‹é€ </h3>

            <p>ç®¡ç†å›³ã¯ä»¥ä¸‹ã®è¦ç´ ã§æ§‹æˆã•ã‚Œã¾ã™ï¼š</p>

            <ul>
                <li><strong>ä¸­å¿ƒç·š(CL: Center Line)</strong>: ãƒ—ãƒ­ã‚»ã‚¹å¹³å‡ã‚’ç¤ºã™</li>
                <li><strong>ä¸Šæ–¹ç®¡ç†é™ç•Œ(UCL: Upper Control Limit)</strong>: å¹³å‡ + 3Ïƒ</li>
                <li><strong>ä¸‹æ–¹ç®¡ç†é™ç•Œ(LCL: Lower Control Limit)</strong>: å¹³å‡ - 3Ïƒ</li>
                <li><strong>ãƒ‡ãƒ¼ã‚¿ç‚¹</strong>: æ™‚ç³»åˆ—ã«æ²¿ã£ãŸãƒ—ãƒ­ã‚»ã‚¹æ¸¬å®šå€¤</li>
            </ul>

            <div class="example-box">
                <h4>ğŸ“Š Example 1: X-bar and R Control Charts (å¹³å‡-ç¯„å›²ç®¡ç†å›³)</h4>
                <p>æœ€ã‚‚åŸºæœ¬çš„ãªç®¡ç†å›³ã€‚ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã®å¹³å‡ã¨ç¯„å›²ã‚’åŒæ™‚ã«ç®¡ç†ã—ã¾ã™ã€‚</p>
            </div>

            <pre><code># ===================================
# Example 1: X-bar and R Control Charts Implementation
# ===================================

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from typing import Tuple, Dict
import warnings
warnings.filterwarnings('ignore')

class XbarRControlChart:
    """X-bar and Rç®¡ç†å›³ã®å®Ÿè£…

    é€£ç¶šå¤‰æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã«ä½¿ç”¨ã€‚ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã®å¹³å‡(X-bar)ã¨
    ç¯„å›²(R)ã‚’åŒæ™‚ã«ç›£è¦–ã—ã€ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸­å¿ƒã¨æ•£ã‚‰ã°ã‚Šã‚’ç®¡ç†ã™ã‚‹ã€‚

    Parameters:
    -----------
    subgroup_size : int
        ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚µãƒ³ãƒ—ãƒ«æ•° (é€šå¸¸2-10)

    Attributes:
    -----------
    A2, D3, D4 : float
        ç®¡ç†é™ç•Œè¨ˆç®—ç”¨ã®å®šæ•°ï¼ˆã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚ºã«ä¾å­˜ï¼‰
    """

    # ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚ºåˆ¥ã®å®šæ•°ï¼ˆJIS Z 9020-2ã‚ˆã‚Šï¼‰
    CONSTANTS = {
        2: {'A2': 1.880, 'D3': 0, 'D4': 3.267},
        3: {'A2': 1.023, 'D3': 0, 'D4': 2.575},
        4: {'A2': 0.729, 'D3': 0, 'D4': 2.282},
        5: {'A2': 0.577, 'D3': 0, 'D4': 2.115},
        6: {'A2': 0.483, 'D3': 0, 'D4': 2.004},
        7: {'A2': 0.419, 'D3': 0.076, 'D4': 1.924},
        8: {'A2': 0.373, 'D3': 0.136, 'D4': 1.864},
        9: {'A2': 0.337, 'D3': 0.184, 'D4': 1.816},
        10: {'A2': 0.308, 'D3': 0.223, 'D4': 1.777}
    }

    def __init__(self, subgroup_size: int = 5):
        if subgroup_size not in self.CONSTANTS:
            raise ValueError(f"Subgroup size must be 2-10, got {subgroup_size}")

        self.n = subgroup_size
        self.A2 = self.CONSTANTS[subgroup_size]['A2']
        self.D3 = self.CONSTANTS[subgroup_size]['D3']
        self.D4 = self.CONSTANTS[subgroup_size]['D4']

        self.xbar_cl = None
        self.xbar_ucl = None
        self.xbar_lcl = None
        self.r_cl = None
        self.r_ucl = None
        self.r_lcl = None

    def fit(self, data: np.ndarray) -> 'XbarRControlChart':
        """ç®¡ç†é™ç•Œã‚’è¨ˆç®—ï¼ˆãƒ•ã‚§ãƒ¼ã‚ºI: åˆæœŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åŸºæº–ã‚’è¨­å®šï¼‰

        Parameters:
        -----------
        data : np.ndarray
            shape (n_subgroups, subgroup_size) ã®ãƒ‡ãƒ¼ã‚¿

        Returns:
        --------
        self : XbarRControlChart
        """
        if data.shape[1] != self.n:
            raise ValueError(f"Data subgroup size {data.shape[1]} != {self.n}")

        # å„ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã®å¹³å‡ã¨ç¯„å›²ã‚’è¨ˆç®—
        xbar = data.mean(axis=1)
        r = data.max(axis=1) - data.min(axis=1)

        # ä¸­å¿ƒç·šã¨ç®¡ç†é™ç•Œã®è¨ˆç®—
        self.xbar_cl = xbar.mean()
        self.r_cl = r.mean()

        # X-barç®¡ç†å›³ã®ç®¡ç†é™ç•Œ
        self.xbar_ucl = self.xbar_cl + self.A2 * self.r_cl
        self.xbar_lcl = self.xbar_cl - self.A2 * self.r_cl

        # Rç®¡ç†å›³ã®ç®¡ç†é™ç•Œ
        self.r_ucl = self.D4 * self.r_cl
        self.r_lcl = self.D3 * self.r_cl

        return self

    def predict(self, data: np.ndarray) -> Dict[str, np.ndarray]:
        """æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ç®¡ç†çŠ¶æ…‹ã‚’åˆ¤å®šï¼ˆãƒ•ã‚§ãƒ¼ã‚ºII: ç¶™ç¶šç›£è¦–ï¼‰

        Parameters:
        -----------
        data : np.ndarray
            shape (n_subgroups, subgroup_size) ã®ãƒ‡ãƒ¼ã‚¿

        Returns:
        --------
        results : dict
            'xbar', 'r', 'xbar_ooc', 'r_ooc' ã‚’å«ã‚€è¾æ›¸
            ooc = out of control (ç®¡ç†å¤–ã‚Œ)
        """
        if self.xbar_cl is None:
            raise ValueError("Call fit() first to establish control limits")

        xbar = data.mean(axis=1)
        r = data.max(axis=1) - data.min(axis=1)

        # ç®¡ç†å¤–ã‚Œã®åˆ¤å®š
        xbar_ooc = (xbar > self.xbar_ucl) | (xbar < self.xbar_lcl)
        r_ooc = (r > self.r_ucl) | (r < self.r_lcl)

        return {
            'xbar': xbar,
            'r': r,
            'xbar_ooc': xbar_ooc,
            'r_ooc': r_ooc
        }

    def plot(self, data: np.ndarray, title: str = "X-bar and R Control Charts"):
        """ç®¡ç†å›³ã®ãƒ—ãƒ­ãƒƒãƒˆ

        Parameters:
        -----------
        data : np.ndarray
            shape (n_subgroups, subgroup_size) ã®ãƒ‡ãƒ¼ã‚¿
        title : str
            ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒˆãƒ«
        """
        results = self.predict(data)
        n_points = len(results['xbar'])

        fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 8))

        # X-barç®¡ç†å›³
        ax1.plot(range(1, n_points+1), results['xbar'],
                marker='o', color='#2c3e50', linewidth=1.5, markersize=6)
        ax1.axhline(self.xbar_cl, color='#11998e', linestyle='-',
                   linewidth=2, label='CL')
        ax1.axhline(self.xbar_ucl, color='#e74c3c', linestyle='--',
                   linewidth=2, label='UCL')
        ax1.axhline(self.xbar_lcl, color='#e74c3c', linestyle='--',
                   linewidth=2, label='LCL')

        # ç®¡ç†å¤–ã‚Œç‚¹ã‚’å¼·èª¿
        ooc_indices = np.where(results['xbar_ooc'])[0]
        if len(ooc_indices) > 0:
            ax1.scatter(ooc_indices + 1, results['xbar'][ooc_indices],
                       color='red', s=100, zorder=5, label='Out of Control')

        ax1.set_xlabel('Subgroup Number', fontsize=11)
        ax1.set_ylabel('Subgroup Mean (X-bar)', fontsize=11)
        ax1.set_title('X-bar Control Chart', fontsize=13, fontweight='bold')
        ax1.legend(loc='best')
        ax1.grid(True, alpha=0.3)

        # Rç®¡ç†å›³
        ax2.plot(range(1, n_points+1), results['r'],
                marker='s', color='#2c3e50', linewidth=1.5, markersize=6)
        ax2.axhline(self.r_cl, color='#11998e', linestyle='-',
                   linewidth=2, label='CL')
        ax2.axhline(self.r_ucl, color='#e74c3c', linestyle='--',
                   linewidth=2, label='UCL')
        ax2.axhline(self.r_lcl, color='#e74c3c', linestyle='--',
                   linewidth=2, label='LCL')

        # ç®¡ç†å¤–ã‚Œç‚¹ã‚’å¼·èª¿
        ooc_indices = np.where(results['r_ooc'])[0]
        if len(ooc_indices) > 0:
            ax2.scatter(ooc_indices + 1, results['r'][ooc_indices],
                       color='red', s=100, zorder=5, label='Out of Control')

        ax2.set_xlabel('Subgroup Number', fontsize=11)
        ax2.set_ylabel('Subgroup Range (R)', fontsize=11)
        ax2.set_title('R Control Chart', fontsize=13, fontweight='bold')
        ax2.legend(loc='best')
        ax2.grid(True, alpha=0.3)

        plt.suptitle(title, fontsize=15, fontweight='bold', y=0.995)
        plt.tight_layout()
        plt.show()


# ä½¿ç”¨ä¾‹: åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®æ¸©åº¦ç®¡ç†
# Phase I: åˆæœŸ25ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã§ç®¡ç†é™ç•Œã‚’è¨­å®š
np.random.seed(42)
n_subgroups_phase1 = 25
subgroup_size = 5
target_temp = 80.0  # ç›®æ¨™æ¸©åº¦ [â„ƒ]

# æ­£å¸¸é‹è»¢ãƒ‡ãƒ¼ã‚¿ï¼ˆå¹³å‡80â„ƒã€æ¨™æº–åå·®0.5â„ƒï¼‰
phase1_data = np.random.normal(target_temp, 0.5,
                               (n_subgroups_phase1, subgroup_size))

# ç®¡ç†å›³ã®æ§‹ç¯‰
xbar_r_chart = XbarRControlChart(subgroup_size=subgroup_size)
xbar_r_chart.fit(phase1_data)

print("=== Phase I: ç®¡ç†é™ç•Œã®è¨­å®š ===")
print(f"X-barç®¡ç†å›³:")
print(f"  CL  = {xbar_r_chart.xbar_cl:.3f} â„ƒ")
print(f"  UCL = {xbar_r_chart.xbar_ucl:.3f} â„ƒ")
print(f"  LCL = {xbar_r_chart.xbar_lcl:.3f} â„ƒ")
print(f"\nRç®¡ç†å›³:")
print(f"  CL  = {xbar_r_chart.r_cl:.3f} â„ƒ")
print(f"  UCL = {xbar_r_chart.r_ucl:.3f} â„ƒ")
print(f"  LCL = {xbar_r_chart.r_lcl:.3f} â„ƒ")

# Phase II: ç¶™ç¶šç›£è¦–ï¼ˆ30ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã€é€”ä¸­ã§ç•°å¸¸ç™ºç”Ÿï¼‰
n_subgroups_phase2 = 30
phase2_data = np.random.normal(target_temp, 0.5,
                               (n_subgroups_phase2, subgroup_size))

# ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—15-20ã§å¹³å‡ã‚·ãƒ•ãƒˆï¼ˆ+1.5â„ƒï¼‰
phase2_data[14:20, :] += 1.5

# ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—25ã§æ•£ã‚‰ã°ã‚Šå¢—å¤§
phase2_data[24, :] = np.random.normal(target_temp, 2.0, subgroup_size)

# ç›£è¦–
results = xbar_r_chart.predict(phase2_data)

print("\n=== Phase II: ç¶™ç¶šç›£è¦– ===")
print(f"X-barç®¡ç†å¤–ã‚Œ: {results['xbar_ooc'].sum()}å€‹ "
      f"(ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ— {np.where(results['xbar_ooc'])[0] + 1})")
print(f"Rç®¡ç†å¤–ã‚Œ: {results['r_ooc'].sum()}å€‹ "
      f"(ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ— {np.where(results['r_ooc'])[0] + 1})")

# ãƒ—ãƒ­ãƒƒãƒˆ
xbar_r_chart.plot(phase2_data,
                  title="Chemical Process Temperature Monitoring")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === Phase I: ç®¡ç†é™ç•Œã®è¨­å®š ===
# X-barç®¡ç†å›³:
#   CL  = 79.995 â„ƒ
#   UCL = 80.666 â„ƒ
#   LCL = 79.323 â„ƒ
#
# Rç®¡ç†å›³:
#   CL  = 1.165 â„ƒ
#   UCL = 2.464 â„ƒ
#   LCL = 0.000 â„ƒ
#
# === Phase II: ç¶™ç¶šç›£è¦– ===
# X-barç®¡ç†å¤–ã‚Œ: 5å€‹ (ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ— [15 16 17 18 19])
# Rç®¡ç†å¤–ã‚Œ: 1å€‹ (ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ— [25])</code></pre>

            <div class="warning-box">
                <h4>âš ï¸ æ³¨æ„: ç®¡ç†é™ç•Œã¨è¦æ ¼é™ç•Œã®é•ã„</h4>
                <p>ç®¡ç†é™ç•Œ(Â±3Ïƒ)ã¯ãƒ—ãƒ­ã‚»ã‚¹ã®å¤‰å‹•ã‹ã‚‰è¨ˆç®—ã•ã‚Œã€ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ±è¨ˆçš„ã«å®‰å®šã—ã¦ã„ã‚‹ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚ä¸€æ–¹ã€è¦æ ¼é™ç•Œã¯é¡§å®¢è¦æ±‚ã‚„è¨­è¨ˆä»•æ§˜ã‹ã‚‰æ±ºã¾ã‚Šã€è£½å“ã®åˆå¦ã‚’åˆ¤å®šã—ã¾ã™ã€‚ç®¡ç†é™ç•Œå†…ã§ã‚‚è¦æ ¼å¤–ã‚Œã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>
            </div>
        </section>

        <section>
            <h2>2.2 è¨ˆæ•°å€¤ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†å›³</h2>

            <p>è¨ˆé‡å€¤ï¼ˆé€£ç¶šå¤‰æ•°ï¼‰ã§ã¯ãªãã€ä¸è‰¯å“æ•°ã‚„æ¬ é™¥æ•°ãªã©ã®è¨ˆæ•°å€¤ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã¯ã€ç•°ãªã‚‹ç®¡ç†å›³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>

            <h3>2.2.1 Pç®¡ç†å›³ï¼ˆä¸è‰¯ç‡ç®¡ç†å›³ï¼‰</h3>

            <div class="example-box">
                <h4>ğŸ“Š Example 2: P-Chart (ä¸è‰¯ç‡ç®¡ç†å›³)</h4>
                <p>æ¤œæŸ»ãƒ­ãƒƒãƒˆã‹ã‚‰æŠœãå–ã£ãŸè£½å“ã®ä¸è‰¯ç‡ã‚’ç®¡ç†ã—ã¾ã™ã€‚</p>
            </div>

            <pre><code># ===================================
# Example 2: P-Chart for Proportion Defective
# ===================================

class PControlChart:
    """Pç®¡ç†å›³ï¼ˆä¸è‰¯ç‡ç®¡ç†å›³ï¼‰ã®å®Ÿè£…

    äºŒé …åˆ†å¸ƒã«å¾“ã†ä¸è‰¯ç‡ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ã«ä½¿ç”¨ã€‚
    ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºãŒä¸€å®šã§ãªãã¦ã‚‚é©ç”¨å¯èƒ½ã€‚

    Attributes:
    -----------
    p_bar : float
        å…¨ä½“ã®å¹³å‡ä¸è‰¯ç‡
    ucl, lcl : np.ndarray
        å„ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã«å¿œã˜ãŸç®¡ç†é™ç•Œ
    """

    def __init__(self):
        self.p_bar = None
        self.ucl = None
        self.lcl = None
        self.n = None

    def fit(self, defectives: np.ndarray, sample_sizes: np.ndarray):
        """ç®¡ç†é™ç•Œã‚’è¨ˆç®—

        Parameters:
        -----------
        defectives : np.ndarray
            å„ãƒ­ãƒƒãƒˆã®ä¸è‰¯å“æ•°
        sample_sizes : np.ndarray
            å„ãƒ­ãƒƒãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º
        """
        # å¹³å‡ä¸è‰¯ç‡ã®è¨ˆç®—
        self.p_bar = defectives.sum() / sample_sizes.sum()
        self.n = sample_sizes

        # å„ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã«å¿œã˜ãŸç®¡ç†é™ç•Œï¼ˆÂ±3Ïƒï¼‰
        # Ïƒ_p = sqrt(p_bar * (1 - p_bar) / n)
        sigma_p = np.sqrt(self.p_bar * (1 - self.p_bar) / self.n)

        self.ucl = self.p_bar + 3 * sigma_p
        self.lcl = self.p_bar - 3 * sigma_p

        # LCLã¯0æœªæº€ã«ãªã‚‰ãªã„
        self.lcl = np.maximum(self.lcl, 0)

        # UCLã¯1ã‚’è¶…ãˆãªã„
        self.ucl = np.minimum(self.ucl, 1)

        return self

    def predict(self, defectives: np.ndarray,
                sample_sizes: np.ndarray) -> Dict[str, np.ndarray]:
        """ç®¡ç†çŠ¶æ…‹ã‚’åˆ¤å®š

        Parameters:
        -----------
        defectives : np.ndarray
            å„ãƒ­ãƒƒãƒˆã®ä¸è‰¯å“æ•°
        sample_sizes : np.ndarray
            å„ãƒ­ãƒƒãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º

        Returns:
        --------
        results : dict
            'p', 'ucl', 'lcl', 'ooc' ã‚’å«ã‚€è¾æ›¸
        """
        if self.p_bar is None:
            raise ValueError("Call fit() first")

        # ä¸è‰¯ç‡ã®è¨ˆç®—
        p = defectives / sample_sizes

        # ç®¡ç†é™ç•Œã®å†è¨ˆç®—ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºãŒç•°ãªã‚‹å ´åˆï¼‰
        sigma_p = np.sqrt(self.p_bar * (1 - self.p_bar) / sample_sizes)
        ucl = np.minimum(self.p_bar + 3 * sigma_p, 1)
        lcl = np.maximum(self.p_bar - 3 * sigma_p, 0)

        # ç®¡ç†å¤–ã‚Œã®åˆ¤å®š
        ooc = (p > ucl) | (p < lcl)

        return {
            'p': p,
            'ucl': ucl,
            'lcl': lcl,
            'ooc': ooc
        }

    def plot(self, defectives: np.ndarray, sample_sizes: np.ndarray,
             title: str = "P Control Chart"):
        """Pç®¡ç†å›³ã®ãƒ—ãƒ­ãƒƒãƒˆ"""
        results = self.predict(defectives, sample_sizes)
        n_points = len(results['p'])

        plt.figure(figsize=(12, 6))

        # ä¸è‰¯ç‡ã®ãƒ—ãƒ­ãƒƒãƒˆ
        plt.plot(range(1, n_points+1), results['p'],
                marker='o', color='#2c3e50', linewidth=1.5,
                markersize=6, label='Proportion Defective')

        # ä¸­å¿ƒç·š
        plt.axhline(self.p_bar, color='#11998e', linestyle='-',
                   linewidth=2, label=f'CL = {self.p_bar:.4f}')

        # ç®¡ç†é™ç•Œï¼ˆã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã‚‹å ´åˆã¯éšæ®µçŠ¶ï¼‰
        plt.plot(range(1, n_points+1), results['ucl'],
                color='#e74c3c', linestyle='--', linewidth=2, label='UCL')
        plt.plot(range(1, n_points+1), results['lcl'],
                color='#e74c3c', linestyle='--', linewidth=2, label='LCL')

        # ç®¡ç†å¤–ã‚Œç‚¹ã‚’å¼·èª¿
        ooc_indices = np.where(results['ooc'])[0]
        if len(ooc_indices) > 0:
            plt.scatter(ooc_indices + 1, results['p'][ooc_indices],
                       color='red', s=100, zorder=5, label='Out of Control')

        plt.xlabel('Lot Number', fontsize=11)
        plt.ylabel('Proportion Defective', fontsize=11)
        plt.title(title, fontsize=13, fontweight='bold')
        plt.legend(loc='best')
        plt.grid(True, alpha=0.3)
        plt.tight_layout()
        plt.show()


# ä½¿ç”¨ä¾‹: åŠå°ä½“è£½é€ ã®ä¸è‰¯ç‡ç®¡ç†
np.random.seed(42)

# Phase I: åˆæœŸ30ãƒ­ãƒƒãƒˆã§ç®¡ç†é™ç•Œã‚’è¨­å®š
n_lots_phase1 = 30
sample_sizes_phase1 = np.random.randint(100, 200, n_lots_phase1)
true_defect_rate = 0.02  # çœŸã®ä¸è‰¯ç‡2%

# äºŒé …åˆ†å¸ƒã§ä¸è‰¯å“æ•°ã‚’ç”Ÿæˆ
defectives_phase1 = np.random.binomial(sample_sizes_phase1,
                                       true_defect_rate)

# Pç®¡ç†å›³ã®æ§‹ç¯‰
p_chart = PControlChart()
p_chart.fit(defectives_phase1, sample_sizes_phase1)

print("=== Pç®¡ç†å›³: ç®¡ç†é™ç•Œã®è¨­å®š ===")
print(f"å¹³å‡ä¸è‰¯ç‡ (p-bar) = {p_chart.p_bar:.4f} ({p_chart.p_bar*100:.2f}%)")

# Phase II: ç¶™ç¶šç›£è¦–ï¼ˆ40ãƒ­ãƒƒãƒˆã€é€”ä¸­ã§ä¸è‰¯ç‡å¢—åŠ ï¼‰
n_lots_phase2 = 40
sample_sizes_phase2 = np.random.randint(100, 200, n_lots_phase2)

defectives_phase2 = np.random.binomial(sample_sizes_phase2,
                                       true_defect_rate)

# ãƒ­ãƒƒãƒˆ25-30ã§ä¸è‰¯ç‡ãŒ3å€ã«å¢—åŠ ï¼ˆå·¥ç¨‹ç•°å¸¸ï¼‰
defectives_phase2[24:30] = np.random.binomial(
    sample_sizes_phase2[24:30], true_defect_rate * 3)

# ç›£è¦–
results = p_chart.predict(defectives_phase2, sample_sizes_phase2)

print(f"\n=== Phase II: ç¶™ç¶šç›£è¦– ===")
print(f"ç®¡ç†å¤–ã‚Œãƒ­ãƒƒãƒˆ: {results['ooc'].sum()}å€‹")
print(f"è©²å½“ãƒ­ãƒƒãƒˆç•ªå·: {np.where(results['ooc'])[0] + 1}")

# ãƒ—ãƒ­ãƒƒãƒˆ
p_chart.plot(defectives_phase2, sample_sizes_phase2,
             title="Semiconductor Manufacturing - Defect Rate Monitoring")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === Pç®¡ç†å›³: ç®¡ç†é™ç•Œã®è¨­å®š ===
# å¹³å‡ä¸è‰¯ç‡ (p-bar) = 0.0189 (1.89%)
#
# === Phase II: ç¶™ç¶šç›£è¦– ===
# ç®¡ç†å¤–ã‚Œãƒ­ãƒƒãƒˆ: 6å€‹
# è©²å½“ãƒ­ãƒƒãƒˆç•ªå·: [25 26 27 28 29 30]</code></pre>

            <h3>2.2.2 Cç®¡ç†å›³ï¼ˆæ¬ é™¥æ•°ç®¡ç†å›³ï¼‰</h3>

            <div class="example-box">
                <h4>ğŸ“Š Example 3: C-Chart (æ¬ é™¥æ•°ç®¡ç†å›³)</h4>
                <p>ä¸€å®šã®æ¤œæŸ»å˜ä½ã‚ãŸã‚Šã®æ¬ é™¥æ•°ã‚’ç®¡ç†ã—ã¾ã™ã€‚ãƒã‚¢ã‚½ãƒ³åˆ†å¸ƒã‚’ä»®å®šã€‚</p>
            </div>

            <pre><code># ===================================
# Example 3: C-Chart for Count of Defects
# ===================================

class CControlChart:
    """Cç®¡ç†å›³ï¼ˆæ¬ é™¥æ•°ç®¡ç†å›³ï¼‰ã®å®Ÿè£…

    ä¸€å®šã®æ¤œæŸ»å˜ä½ï¼ˆé¢ç©ã€æ™‚é–“ã€ä½“ç©ãªã©ï¼‰ã‚ãŸã‚Šã®æ¬ é™¥æ•°ã‚’ç®¡ç†ã€‚
    æ¬ é™¥æ•°ã¯ãƒã‚¢ã‚½ãƒ³åˆ†å¸ƒã«å¾“ã†ã¨ä»®å®šã€‚

    Attributes:
    -----------
    c_bar : float
        å¹³å‡æ¬ é™¥æ•°
    ucl, lcl : float
        ç®¡ç†é™ç•Œ
    """

    def __init__(self):
        self.c_bar = None
        self.ucl = None
        self.lcl = None

    def fit(self, defects: np.ndarray):
        """ç®¡ç†é™ç•Œã‚’è¨ˆç®—

        Parameters:
        -----------
        defects : np.ndarray
            å„æ¤œæŸ»å˜ä½ã®æ¬ é™¥æ•°
        """
        # å¹³å‡æ¬ é™¥æ•°ã®è¨ˆç®—
        self.c_bar = defects.mean()

        # ãƒã‚¢ã‚½ãƒ³åˆ†å¸ƒã®æ¨™æº–åå·® = sqrt(å¹³å‡)
        # ç®¡ç†é™ç•Œ = å¹³å‡ Â± 3 * sqrt(å¹³å‡)
        sigma_c = np.sqrt(self.c_bar)

        self.ucl = self.c_bar + 3 * sigma_c
        self.lcl = self.c_bar - 3 * sigma_c

        # LCLã¯0æœªæº€ã«ãªã‚‰ãªã„
        self.lcl = max(self.lcl, 0)

        return self

    def predict(self, defects: np.ndarray) -> Dict[str, np.ndarray]:
        """ç®¡ç†çŠ¶æ…‹ã‚’åˆ¤å®š

        Parameters:
        -----------
        defects : np.ndarray
            å„æ¤œæŸ»å˜ä½ã®æ¬ é™¥æ•°

        Returns:
        --------
        results : dict
            'c', 'ooc' ã‚’å«ã‚€è¾æ›¸
        """
        if self.c_bar is None:
            raise ValueError("Call fit() first")

        # ç®¡ç†å¤–ã‚Œã®åˆ¤å®š
        ooc = (defects > self.ucl) | (defects < self.lcl)

        return {
            'c': defects,
            'ooc': ooc
        }

    def plot(self, defects: np.ndarray, title: str = "C Control Chart"):
        """Cç®¡ç†å›³ã®ãƒ—ãƒ­ãƒƒãƒˆ"""
        results = self.predict(defects)
        n_points = len(defects)

        plt.figure(figsize=(12, 6))

        # æ¬ é™¥æ•°ã®ãƒ—ãƒ­ãƒƒãƒˆ
        plt.plot(range(1, n_points+1), defects,
                marker='o', color='#2c3e50', linewidth=1.5,
                markersize=6, label='Count of Defects')

        # ä¸­å¿ƒç·šã¨ç®¡ç†é™ç•Œ
        plt.axhline(self.c_bar, color='#11998e', linestyle='-',
                   linewidth=2, label=f'CL = {self.c_bar:.2f}')
        plt.axhline(self.ucl, color='#e74c3c', linestyle='--',
                   linewidth=2, label=f'UCL = {self.ucl:.2f}')
        plt.axhline(self.lcl, color='#e74c3c', linestyle='--',
                   linewidth=2, label=f'LCL = {self.lcl:.2f}')

        # ç®¡ç†å¤–ã‚Œç‚¹ã‚’å¼·èª¿
        ooc_indices = np.where(results['ooc'])[0]
        if len(ooc_indices) > 0:
            plt.scatter(ooc_indices + 1, defects[ooc_indices],
                       color='red', s=100, zorder=5, label='Out of Control')

        plt.xlabel('Inspection Unit', fontsize=11)
        plt.ylabel('Number of Defects', fontsize=11)
        plt.title(title, fontsize=13, fontweight='bold')
        plt.legend(loc='best')
        plt.grid(True, alpha=0.3)
        plt.tight_layout()
        plt.show()


# ä½¿ç”¨ä¾‹: å¡—è£…é¢ã®æ¬ é™¥ç®¡ç†ï¼ˆ1mÂ²ã‚ãŸã‚Šã®æ¬ é™¥æ•°ï¼‰
np.random.seed(42)

# Phase I: åˆæœŸ30æšã®ãƒ‘ãƒãƒ«ã§ç®¡ç†é™ç•Œã‚’è¨­å®š
n_panels_phase1 = 30
avg_defects = 3.5  # å¹³å‡3.5å€‹/mÂ²

# ãƒã‚¢ã‚½ãƒ³åˆ†å¸ƒã§æ¬ é™¥æ•°ã‚’ç”Ÿæˆ
defects_phase1 = np.random.poisson(avg_defects, n_panels_phase1)

# Cç®¡ç†å›³ã®æ§‹ç¯‰
c_chart = CControlChart()
c_chart.fit(defects_phase1)

print("=== Cç®¡ç†å›³: ç®¡ç†é™ç•Œã®è¨­å®š ===")
print(f"å¹³å‡æ¬ é™¥æ•° (c-bar) = {c_chart.c_bar:.2f} å€‹/mÂ²")
print(f"UCL = {c_chart.ucl:.2f} å€‹/mÂ²")
print(f"LCL = {c_chart.lcl:.2f} å€‹/mÂ²")

# Phase II: ç¶™ç¶šç›£è¦–ï¼ˆ50æšã€é€”ä¸­ã§æ¬ é™¥å¢—åŠ ï¼‰
n_panels_phase2 = 50
defects_phase2 = np.random.poisson(avg_defects, n_panels_phase2)

# ãƒ‘ãƒãƒ«30-35ã§æ¬ é™¥ãŒ2å€ã«å¢—åŠ ï¼ˆå¡—æ–™åŠ£åŒ–ï¼‰
defects_phase2[29:35] = np.random.poisson(avg_defects * 2, 6)

# ç›£è¦–
results = c_chart.predict(defects_phase2)

print(f"\n=== Phase II: ç¶™ç¶šç›£è¦– ===")
print(f"ç®¡ç†å¤–ã‚Œãƒ‘ãƒãƒ«: {results['ooc'].sum()}æš")
print(f"è©²å½“ãƒ‘ãƒãƒ«ç•ªå·: {np.where(results['ooc'])[0] + 1}")

# ãƒ—ãƒ­ãƒƒãƒˆ
c_chart.plot(defects_phase2,
             title="Paint Defects Monitoring (per mÂ²)")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === Cç®¡ç†å›³: ç®¡ç†é™ç•Œã®è¨­å®š ===
# å¹³å‡æ¬ é™¥æ•° (c-bar) = 3.40 å€‹/mÂ²
# UCL = 8.93 å€‹/mÂ²
# LCL = 0.00 å€‹/mÂ²
#
# === Phase II: ç¶™ç¶šç›£è¦– ===
# ç®¡ç†å¤–ã‚Œãƒ‘ãƒãƒ«: 2æš
# è©²å½“ãƒ‘ãƒãƒ«ç•ªå·: [30 33]</code></pre>
        </section>

        <section>
            <h2>2.3 é«˜åº¦ãªç®¡ç†å›³æ‰‹æ³•</h2>

            <p>å¾“æ¥ã®ç®¡ç†å›³ã¯å¤§ããªå¤‰åŒ–ã®æ¤œå‡ºã«ã¯å„ªã‚Œã¦ã„ã¾ã™ãŒã€å°ã•ãªå¤‰åŒ–ã®æ—©æœŸæ¤œçŸ¥ã«ã¯é™ç•ŒãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®æ‰‹æ³•ã¯ã‚ˆã‚Šæ„Ÿåº¦ã®é«˜ã„ç›£è¦–ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚</p>

            <h3>2.3.1 CUSUMç®¡ç†å›³ï¼ˆç´¯ç©å’Œç®¡ç†å›³ï¼‰</h3>

            <div class="info-box">
                <h4>ğŸ’¡ CUSUMã®ç‰¹å¾´</h4>
                <p>å¹³å‡å€¤ã‹ã‚‰ã®åå·®ã‚’ç´¯ç©ã™ã‚‹ã“ã¨ã§ã€å°ã•ãªå¤‰åŒ–ï¼ˆ0.5-2Ïƒç¨‹åº¦ï¼‰ã‚’æ—©æœŸã«æ¤œå‡ºã—ã¾ã™ã€‚ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆç®¡ç†å›³ã‚ˆã‚Šå¹³å‡4-8å€æ—©ãæ¤œçŸ¥å¯èƒ½ã€‚</p>
            </div>

            <div class="example-box">
                <h4>ğŸ“Š Example 4: CUSUM Control Chart</h4>
                <p>ç´¯ç©å’Œç®¡ç†å›³ã®å®Ÿè£…ï¼ˆè¡¨å½¢å¼CUSUMï¼‰</p>
            </div>

            <pre><code># ===================================
# Example 4: CUSUM (Cumulative Sum) Control Chart
# ===================================

class CUSUMControlChart:
    """CUSUMç®¡ç†å›³ã®å®Ÿè£…ï¼ˆè¡¨å½¢å¼CUSUMï¼‰

    å¹³å‡å€¤ã®å°ã•ãªã‚·ãƒ•ãƒˆï¼ˆ0.5-2Ïƒï¼‰ã‚’æ—©æœŸã«æ¤œå‡ºã™ã‚‹ãŸã‚ã®æ‰‹æ³•ã€‚
    ä¸Šå´ã¨ä¸‹å´ã®CUSUMçµ±è¨ˆé‡ã‚’åˆ¥ã€…ã«è¨ˆç®—ã€‚

    Parameters:
    -----------
    target : float
        ç›®æ¨™å€¤ï¼ˆãƒ—ãƒ­ã‚»ã‚¹å¹³å‡ï¼‰
    std : float
        ãƒ—ãƒ­ã‚»ã‚¹æ¨™æº–åå·®
    k : float
        è¨±å®¹é™ç•Œï¼ˆreference valueï¼‰ã€‚é€šå¸¸ã¯æ¤œå‡ºã—ãŸã„ã‚·ãƒ•ãƒˆã®åŠåˆ†ã€‚
        ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.5Ïƒ (1Ïƒã‚·ãƒ•ãƒˆã‚’æ¤œå‡ºã™ã‚‹å ´åˆ)
    h : float
        æ±ºå®šé–“éš”ï¼ˆdecision intervalï¼‰ã€‚ç®¡ç†é™ç•Œã¨ã—ã¦æ©Ÿèƒ½ã€‚
        ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5Ïƒ (ç¬¬ä¸€ç¨®éèª¤ç‡ 0.27%ã«ç›¸å½“)

    Attributes:
    -----------
    cusum_high : np.ndarray
        ä¸Šå´CUSUMçµ±è¨ˆé‡
    cusum_low : np.ndarray
        ä¸‹å´CUSUMçµ±è¨ˆé‡
    """

    def __init__(self, target: float, std: float,
                 k: float = 0.5, h: float = 5.0):
        self.target = target
        self.std = std
        self.k = k * std  # è¨±å®¹é™ç•Œï¼ˆçµ¶å¯¾å€¤ï¼‰
        self.h = h * std  # æ±ºå®šé–“éš”ï¼ˆçµ¶å¯¾å€¤ï¼‰

        self.cusum_high = None
        self.cusum_low = None

    def fit_predict(self, data: np.ndarray) -> Dict[str, np.ndarray]:
        """CUSUMçµ±è¨ˆé‡ã‚’è¨ˆç®—ã—ã€ç®¡ç†å¤–ã‚Œã‚’æ¤œå‡º

        Parameters:
        -----------
        data : np.ndarray
            è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿

        Returns:
        --------
        results : dict
            'cusum_high', 'cusum_low', 'ooc_high', 'ooc_low' ã‚’å«ã‚€è¾æ›¸
        """
        n = len(data)
        self.cusum_high = np.zeros(n)
        self.cusum_low = np.zeros(n)

        # CUSUMçµ±è¨ˆé‡ã®é€æ¬¡è¨ˆç®—
        for i in range(n):
            if i == 0:
                # åˆæœŸå€¤
                self.cusum_high[i] = max(0, data[i] - self.target - self.k)
                self.cusum_low[i] = max(0, self.target - data[i] - self.k)
            else:
                # é€æ¬¡æ›´æ–°å¼
                self.cusum_high[i] = max(0, self.cusum_high[i-1] +
                                         data[i] - self.target - self.k)
                self.cusum_low[i] = max(0, self.cusum_low[i-1] +
                                        self.target - data[i] - self.k)

        # ç®¡ç†å¤–ã‚Œã®åˆ¤å®š
        ooc_high = self.cusum_high > self.h
        ooc_low = self.cusum_low > self.h

        return {
            'data': data,
            'cusum_high': self.cusum_high,
            'cusum_low': self.cusum_low,
            'ooc_high': ooc_high,
            'ooc_low': ooc_low
        }

    def plot(self, data: np.ndarray, title: str = "CUSUM Control Chart"):
        """CUSUMç®¡ç†å›³ã®ãƒ—ãƒ­ãƒƒãƒˆ"""
        results = self.fit_predict(data)
        n_points = len(data)

        fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 8))

        # å…ƒãƒ‡ãƒ¼ã‚¿ã®ãƒ—ãƒ­ãƒƒãƒˆ
        ax1.plot(range(1, n_points+1), data,
                marker='o', color='#2c3e50', linewidth=1.5, markersize=5)
        ax1.axhline(self.target, color='#11998e', linestyle='-',
                   linewidth=2, label='Target')
        ax1.axhline(self.target + self.k, color='#f39c12',
                   linestyle=':', linewidth=1.5, label=f'Target Â± k')
        ax1.axhline(self.target - self.k, color='#f39c12',
                   linestyle=':', linewidth=1.5)
        ax1.set_ylabel('Observation', fontsize=11)
        ax1.set_title('Process Data', fontsize=12, fontweight='bold')
        ax1.legend(loc='best')
        ax1.grid(True, alpha=0.3)

        # CUSUMçµ±è¨ˆé‡ã®ãƒ—ãƒ­ãƒƒãƒˆ
        ax2.plot(range(1, n_points+1), results['cusum_high'],
                marker='^', color='#e74c3c', linewidth=1.5,
                markersize=5, label='CUSUM High')
        ax2.plot(range(1, n_points+1), results['cusum_low'],
                marker='v', color='#3498db', linewidth=1.5,
                markersize=5, label='CUSUM Low')
        ax2.axhline(self.h, color='#2c3e50', linestyle='--',
                   linewidth=2, label=f'Decision Interval (h={self.h/self.std:.1f}Ïƒ)')
        ax2.axhline(0, color='gray', linestyle='-', linewidth=1)

        # ç®¡ç†å¤–ã‚Œç‚¹ã‚’å¼·èª¿
        ooc_high_indices = np.where(results['ooc_high'])[0]
        ooc_low_indices = np.where(results['ooc_low'])[0]

        if len(ooc_high_indices) > 0:
            ax2.scatter(ooc_high_indices + 1,
                       results['cusum_high'][ooc_high_indices],
                       color='red', s=100, zorder=5, marker='^')
        if len(ooc_low_indices) > 0:
            ax2.scatter(ooc_low_indices + 1,
                       results['cusum_low'][ooc_low_indices],
                       color='red', s=100, zorder=5, marker='v')

        ax2.set_xlabel('Observation Number', fontsize=11)
        ax2.set_ylabel('CUSUM Statistic', fontsize=11)
        ax2.set_title('CUSUM Statistics', fontsize=12, fontweight='bold')
        ax2.legend(loc='best')
        ax2.grid(True, alpha=0.3)

        plt.suptitle(title, fontsize=15, fontweight='bold', y=0.995)
        plt.tight_layout()
        plt.show()


# ä½¿ç”¨ä¾‹: åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®å¹³å‡ã‚·ãƒ•ãƒˆæ¤œå‡º
np.random.seed(42)

# ç›®æ¨™å€¤ã¨æ¨™æº–åå·®
target_value = 100.0
process_std = 1.0

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆ100è¦³æ¸¬ï¼‰
n_obs = 100
data = np.random.normal(target_value, process_std, n_obs)

# è¦³æ¸¬40ã‹ã‚‰+0.8Ïƒã®å°ã•ãªã‚·ãƒ•ãƒˆï¼ˆã‚·ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆç®¡ç†å›³ã§ã¯æ¤œå‡ºå›°é›£ï¼‰
data[40:] += 0.8 * process_std

# CUSUMç®¡ç†å›³ã®é©ç”¨ï¼ˆ1Ïƒã‚·ãƒ•ãƒˆã‚’æ¤œå‡ºã™ã‚‹è¨­å®šï¼‰
cusum_chart = CUSUMControlChart(
    target=target_value,
    std=process_std,
    k=0.5,  # 1Ïƒã‚·ãƒ•ãƒˆã®åŠåˆ†
    h=5.0   # æ±ºå®šé–“éš”
)

results = cusum_chart.fit_predict(data)

print("=== CUSUMç®¡ç†å›³ ===")
print(f"ç›®æ¨™å€¤: {target_value}")
print(f"è¨±å®¹é™ç•Œ (k): {cusum_chart.k:.3f} ({cusum_chart.k/process_std:.1f}Ïƒ)")
print(f"æ±ºå®šé–“éš” (h): {cusum_chart.h:.3f} ({cusum_chart.h/process_std:.1f}Ïƒ)")

# æ¤œå‡ºæ™‚ç‚¹ã®ç‰¹å®š
if results['ooc_high'].any():
    first_ooc = np.where(results['ooc_high'])[0][0] + 1
    print(f"\nä¸Šå´ã‚·ãƒ•ãƒˆæ¤œå‡º: è¦³æ¸¬ #{first_ooc}")
    print(f"  å®Ÿéš›ã®ã‚·ãƒ•ãƒˆé–‹å§‹: è¦³æ¸¬ #41")
    print(f"  æ¤œå‡ºé…å»¶: {first_ooc - 41}è¦³æ¸¬")

# ãƒ—ãƒ­ãƒƒãƒˆ
cusum_chart.plot(data,
                 title="CUSUM Chart - Small Mean Shift Detection")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === CUSUMç®¡ç†å›³ ===
# ç›®æ¨™å€¤: 100.0
# è¨±å®¹é™ç•Œ (k): 0.500 (0.5Ïƒ)
# æ±ºå®šé–“éš” (h): 5.000 (5.0Ïƒ)
#
# ä¸Šå´ã‚·ãƒ•ãƒˆæ¤œå‡º: è¦³æ¸¬ #49
#   å®Ÿéš›ã®ã‚·ãƒ•ãƒˆé–‹å§‹: è¦³æ¸¬ #41
#   æ¤œå‡ºé…å»¶: 8è¦³æ¸¬</code></pre>

            <h3>2.3.2 EWMAç®¡ç†å›³ï¼ˆæŒ‡æ•°é‡ã¿ä»˜ãç§»å‹•å¹³å‡ç®¡ç†å›³ï¼‰</h3>

            <div class="example-box">
                <h4>ğŸ“Š Example 5: EWMA Control Chart</h4>
                <p>æŒ‡æ•°é‡ã¿ä»˜ãç§»å‹•å¹³å‡ã‚’ç”¨ã„ãŸç®¡ç†å›³ã€‚CUSUMã¨åŒæ§˜ã«å°ã•ãªã‚·ãƒ•ãƒˆã‚’æ¤œå‡ºã€‚</p>
            </div>

            <pre><code># ===================================
# Example 5: EWMA (Exponentially Weighted Moving Average) Control Chart
# ===================================

class EWMAControlChart:
    """EWMAç®¡ç†å›³ã®å®Ÿè£…

    éå»ã®è¦³æ¸¬å€¤ã«æŒ‡æ•°çš„ã«æ¸›è¡°ã™ã‚‹é‡ã¿ã‚’ã¤ã‘ã¦å¹³æ»‘åŒ–ã€‚
    CUSUMã¨åŒæ§˜ã«å°ã•ãªã‚·ãƒ•ãƒˆã®æ¤œå‡ºã«å„ªã‚Œã‚‹ã€‚

    Parameters:
    -----------
    target : float
        ç›®æ¨™å€¤ï¼ˆãƒ—ãƒ­ã‚»ã‚¹å¹³å‡ï¼‰
    std : float
        ãƒ—ãƒ­ã‚»ã‚¹æ¨™æº–åå·®
    lambda_ : float
        é‡ã¿ä¿‚æ•°ï¼ˆ0 < Î» â‰¤ 1ï¼‰ã€‚å°ã•ã„ã»ã©éå»ã®å½±éŸ¿ãŒå¤§ãã„ã€‚
        ä¸€èˆ¬çš„ãªå€¤: 0.05-0.25
    L : float
        ç®¡ç†é™ç•Œã®å¹…ï¼ˆæ¨™æº–åå·®ã®å€æ•°ï¼‰ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3.0

    Attributes:
    -----------
    ewma : np.ndarray
        EWMAçµ±è¨ˆé‡
    """

    def __init__(self, target: float, std: float,
                 lambda_: float = 0.2, L: float = 3.0):
        if not 0 < lambda_ <= 1:
            raise ValueError("lambda_ must be in (0, 1]")

        self.target = target
        self.std = std
        self.lambda_ = lambda_
        self.L = L

        self.ewma = None
        self.ucl = None
        self.lcl = None

    def fit_predict(self, data: np.ndarray) -> Dict[str, np.ndarray]:
        """EWMAçµ±è¨ˆé‡ã‚’è¨ˆç®—ã—ã€ç®¡ç†å¤–ã‚Œã‚’æ¤œå‡º

        Parameters:
        -----------
        data : np.ndarray
            è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿

        Returns:
        --------
        results : dict
            'ewma', 'ucl', 'lcl', 'ooc' ã‚’å«ã‚€è¾æ›¸
        """
        n = len(data)
        self.ewma = np.zeros(n)
        self.ucl = np.zeros(n)
        self.lcl = np.zeros(n)

        # EWMAçµ±è¨ˆé‡ã®é€æ¬¡è¨ˆç®—
        # Z_t = Î» * X_t + (1-Î») * Z_{t-1}
        # åˆæœŸå€¤: Z_0 = target
        self.ewma[0] = self.lambda_ * data[0] + (1 - self.lambda_) * self.target

        for i in range(1, n):
            self.ewma[i] = self.lambda_ * data[i] + (1 - self.lambda_) * self.ewma[i-1]

        # ç®¡ç†é™ç•Œã®è¨ˆç®—ï¼ˆæ™‚é–“ä¾å­˜ï¼‰
        # Ïƒ_Z(t) = Ïƒ * sqrt(Î»/(2-Î») * [1 - (1-Î»)^(2t)])
        for i in range(n):
            t = i + 1
            sigma_z = self.std * np.sqrt(
                (self.lambda_ / (2 - self.lambda_)) *
                (1 - (1 - self.lambda_)**(2 * t))
            )

            self.ucl[i] = self.target + self.L * sigma_z
            self.lcl[i] = self.target - self.L * sigma_z

        # ç®¡ç†å¤–ã‚Œã®åˆ¤å®š
        ooc = (self.ewma > self.ucl) | (self.ewma < self.lcl)

        return {
            'data': data,
            'ewma': self.ewma,
            'ucl': self.ucl,
            'lcl': self.lcl,
            'ooc': ooc
        }

    def plot(self, data: np.ndarray, title: str = "EWMA Control Chart"):
        """EWMAç®¡ç†å›³ã®ãƒ—ãƒ­ãƒƒãƒˆ"""
        results = self.fit_predict(data)
        n_points = len(data)

        plt.figure(figsize=(12, 6))

        # EWMAçµ±è¨ˆé‡ã®ãƒ—ãƒ­ãƒƒãƒˆ
        plt.plot(range(1, n_points+1), results['ewma'],
                marker='o', color='#2c3e50', linewidth=2,
                markersize=5, label='EWMA')

        # å…ƒãƒ‡ãƒ¼ã‚¿ï¼ˆè–„ãï¼‰
        plt.plot(range(1, n_points+1), data,
                marker='.', color='gray', linewidth=0.5,
                markersize=3, alpha=0.5, label='Original Data')

        # ä¸­å¿ƒç·šã¨ç®¡ç†é™ç•Œ
        plt.axhline(self.target, color='#11998e', linestyle='-',
                   linewidth=2, label='Target')
        plt.plot(range(1, n_points+1), results['ucl'],
                color='#e74c3c', linestyle='--', linewidth=2, label='UCL')
        plt.plot(range(1, n_points+1), results['lcl'],
                color='#e74c3c', linestyle='--', linewidth=2, label='LCL')

        # ç®¡ç†å¤–ã‚Œç‚¹ã‚’å¼·èª¿
        ooc_indices = np.where(results['ooc'])[0]
        if len(ooc_indices) > 0:
            plt.scatter(ooc_indices + 1, results['ewma'][ooc_indices],
                       color='red', s=100, zorder=5, label='Out of Control')

        plt.xlabel('Observation Number', fontsize=11)
        plt.ylabel('EWMA Statistic', fontsize=11)
        plt.title(title + f" (Î»={self.lambda_}, L={self.L})",
                 fontsize=13, fontweight='bold')
        plt.legend(loc='best')
        plt.grid(True, alpha=0.3)
        plt.tight_layout()
        plt.show()


# ä½¿ç”¨ä¾‹: åŒ»è–¬å“è£½é€ ã®å«é‡ç®¡ç†
np.random.seed(42)

# ç›®æ¨™å€¤ã¨æ¨™æº–åå·®
target_content = 50.0  # mg
process_std = 0.5      # mg

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆ120è¦³æ¸¬ï¼‰
n_obs = 120
data = np.random.normal(target_content, process_std, n_obs)

# è¦³æ¸¬60ã‹ã‚‰+0.5Ïƒã®å°ã•ãªã‚·ãƒ•ãƒˆ
data[60:] += 0.5 * process_std

# EWMAç®¡ç†å›³ã®é©ç”¨ï¼ˆÎ»=0.2ã§é©åº¦ãªå¹³æ»‘åŒ–ï¼‰
ewma_chart = EWMAControlChart(
    target=target_content,
    std=process_std,
    lambda_=0.2,
    L=3.0
)

results = ewma_chart.fit_predict(data)

print("=== EWMAç®¡ç†å›³ ===")
print(f"ç›®æ¨™å€¤: {target_content} mg")
print(f"é‡ã¿ä¿‚æ•° (Î»): {ewma_chart.lambda_}")
print(f"ç®¡ç†é™ç•Œå¹… (L): {ewma_chart.L}Ïƒ")

# æ¤œå‡ºæ™‚ç‚¹ã®ç‰¹å®š
if results['ooc'].any():
    first_ooc = np.where(results['ooc'])[0][0] + 1
    print(f"\nã‚·ãƒ•ãƒˆæ¤œå‡º: è¦³æ¸¬ #{first_ooc}")
    print(f"  å®Ÿéš›ã®ã‚·ãƒ•ãƒˆé–‹å§‹: è¦³æ¸¬ #61")
    print(f"  æ¤œå‡ºé…å»¶: {first_ooc - 61}è¦³æ¸¬")

# ãƒ—ãƒ­ãƒƒãƒˆ
ewma_chart.plot(data,
                title="EWMA Chart - Drug Content Monitoring")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === EWMAç®¡ç†å›³ ===
# ç›®æ¨™å€¤: 50.0 mg
# é‡ã¿ä¿‚æ•° (Î»): 0.2
# ç®¡ç†é™ç•Œå¹… (L): 3.0Ïƒ
#
# ã‚·ãƒ•ãƒˆæ¤œå‡º: è¦³æ¸¬ #68
#   å®Ÿéš›ã®ã‚·ãƒ•ãƒˆé–‹å§‹: è¦³æ¸¬ #61
#   æ¤œå‡ºé…å»¶: 7è¦³æ¸¬</code></pre>
        </section>

        <section>
            <h2>2.4 ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›ã¨ç®¡ç†å›³ã®çµ±åˆ</h2>

            <h3>2.4.1 ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›æŒ‡æ•°ã¨ç®¡ç†å›³</h3>

            <p>ç®¡ç†å›³ã§ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ±è¨ˆçš„ã«å®‰å®šã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸä¸Šã§ã€ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›æŒ‡æ•°ã‚’è¨ˆç®—ã—ã¾ã™ã€‚</p>

            <div class="example-box">
                <h4>ğŸ“Š Example 6: Process Capability Analysis with Control Charts</h4>
                <p>ç®¡ç†å›³ã¨ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›åˆ†æã®çµ±åˆå®Ÿè£…</p>
            </div>

            <pre><code># ===================================
# Example 6: Integrated Process Capability Analysis
# ===================================

from scipy import stats

class ProcessCapabilityAnalysis:
    """ç®¡ç†å›³ã¨ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›åˆ†æã®çµ±åˆã‚¯ãƒ©ã‚¹

    1. ç®¡ç†å›³ã§ãƒ—ãƒ­ã‚»ã‚¹ã®å®‰å®šæ€§ã‚’ç¢ºèª
    2. å®‰å®šã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã®èƒ½åŠ›æŒ‡æ•°ã‚’è¨ˆç®—
    3. ç·åˆè©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
    """

    def __init__(self, LSL: float, USL: float, target: float = None):
        """
        Parameters:
        -----------
        LSL : float
            ä¸‹æ–¹è¦æ ¼é™ç•Œ (Lower Specification Limit)
        USL : float
            ä¸Šæ–¹è¦æ ¼é™ç•Œ (Upper Specification Limit)
        target : float, optional
            ç›®æ¨™å€¤ã€‚çœç•¥æ™‚ã¯è¦æ ¼ã®ä¸­å¤®å€¤
        """
        self.LSL = LSL
        self.USL = USL
        self.target = target if target is not None else (LSL + USL) / 2

        self.control_chart = None
        self.capability_results = None

    def analyze(self, data: np.ndarray,
                subgroup_size: int = 5) -> Dict:
        """çµ±åˆåˆ†æã®å®Ÿè¡Œ

        Parameters:
        -----------
        data : np.ndarray
            shape (n_subgroups, subgroup_size) ã®ãƒ‡ãƒ¼ã‚¿
        subgroup_size : int
            ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚µã‚¤ã‚º

        Returns:
        --------
        results : dict
            ç®¡ç†å›³æƒ…å ±ã¨ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›æŒ‡æ•°ã‚’å«ã‚€è¾æ›¸
        """
        # Step 1: X-bar and Rç®¡ç†å›³ã§å®‰å®šæ€§ã‚’ç¢ºèª
        self.control_chart = XbarRControlChart(subgroup_size)
        self.control_chart.fit(data)

        chart_results = self.control_chart.predict(data)

        # ç®¡ç†å¤–ã‚Œç‚¹ã®ç¢ºèª
        n_ooc_xbar = chart_results['xbar_ooc'].sum()
        n_ooc_r = chart_results['r_ooc'].sum()
        is_stable = (n_ooc_xbar == 0) and (n_ooc_r == 0)

        # Step 2: ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›æŒ‡æ•°ã®è¨ˆç®—ï¼ˆå®‰å®šã—ã¦ã„ã‚‹å ´åˆã®ã¿æ¨å¥¨ï¼‰
        all_data = data.flatten()
        process_mean = all_data.mean()
        process_std = all_data.std(ddof=1)

        # Cp: ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›æŒ‡æ•°ï¼ˆä¸­å¿ƒåŒ–ã•ã‚Œã¦ã„ã‚‹å‰æï¼‰
        Cp = (self.USL - self.LSL) / (6 * process_std)

        # Cpk: ä¿®æ­£ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›æŒ‡æ•°ï¼ˆå®Ÿéš›ã®å¹³å‡ä½ç½®ã‚’è€ƒæ…®ï¼‰
        Cpu = (self.USL - process_mean) / (3 * process_std)
        Cpl = (process_mean - self.LSL) / (3 * process_std)
        Cpk = min(Cpu, Cpl)

        # Cpm: ã‚¿ã‚°ãƒèƒ½åŠ›æŒ‡æ•°ï¼ˆç›®æ¨™å€¤ã‹ã‚‰ã®ãšã‚Œã‚’è€ƒæ…®ï¼‰
        tau = np.sqrt(process_std**2 + (process_mean - self.target)**2)
        Cpm = (self.USL - self.LSL) / (6 * tau)

        # è¦æ ¼å¤–ã‚Œç‡ã®æ¨å®šï¼ˆæ­£è¦åˆ†å¸ƒã‚’ä»®å®šï¼‰
        z_lower = (self.LSL - process_mean) / process_std
        z_upper = (self.USL - process_mean) / process_std

        ppm_lower = stats.norm.cdf(z_lower) * 1e6
        ppm_upper = (1 - stats.norm.cdf(z_upper)) * 1e6
        ppm_total = ppm_lower + ppm_upper

        # Step 3: ç·åˆè©•ä¾¡
        self.capability_results = {
            'stable': is_stable,
            'n_ooc_xbar': n_ooc_xbar,
            'n_ooc_r': n_ooc_r,
            'process_mean': process_mean,
            'process_std': process_std,
            'Cp': Cp,
            'Cpk': Cpk,
            'Cpm': Cpm,
            'Cpu': Cpu,
            'Cpl': Cpl,
            'ppm_lower': ppm_lower,
            'ppm_upper': ppm_upper,
            'ppm_total': ppm_total,
            'LSL': self.LSL,
            'USL': self.USL,
            'target': self.target
        }

        return self.capability_results

    def print_report(self):
        """ç·åˆè©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆã®å‡ºåŠ›"""
        if self.capability_results is None:
            raise ValueError("Call analyze() first")

        r = self.capability_results

        print("=" * 60)
        print("çµ±åˆãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›åˆ†æãƒ¬ãƒãƒ¼ãƒˆ")
        print("=" * 60)

        print("\nã€1. ãƒ—ãƒ­ã‚»ã‚¹å®‰å®šæ€§ï¼ˆç®¡ç†å›³ï¼‰ã€‘")
        if r['stable']:
            print("  âœ… ãƒ—ãƒ­ã‚»ã‚¹ã¯çµ±è¨ˆçš„ã«å®‰å®šã—ã¦ã„ã¾ã™")
        else:
            print("  âš ï¸ ãƒ—ãƒ­ã‚»ã‚¹ãŒä¸å®‰å®šã§ã™ï¼ˆç®¡ç†å¤–ã‚Œç‚¹ã‚ã‚Šï¼‰")
            print(f"    X-barç®¡ç†å¤–ã‚Œ: {r['n_ooc_xbar']}ç‚¹")
            print(f"    Rç®¡ç†å¤–ã‚Œ: {r['n_ooc_r']}ç‚¹")
            print("  â†’ ã¾ãšãƒ—ãƒ­ã‚»ã‚¹ã‚’å®‰å®šåŒ–ã•ã›ã¦ãã ã•ã„")

        print("\nã€2. ãƒ—ãƒ­ã‚»ã‚¹ç‰¹æ€§ã€‘")
        print(f"  ãƒ—ãƒ­ã‚»ã‚¹å¹³å‡: {r['process_mean']:.4f}")
        print(f"  ãƒ—ãƒ­ã‚»ã‚¹æ¨™æº–åå·®: {r['process_std']:.4f}")
        print(f"  è¦æ ¼ç¯„å›²: [{r['LSL']:.2f}, {r['USL']:.2f}]")
        print(f"  ç›®æ¨™å€¤: {r['target']:.2f}")

        print("\nã€3. ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›æŒ‡æ•°ã€‘")
        print(f"  Cp  = {r['Cp']:.3f}  ", end="")
        print(self._evaluate_index(r['Cp']))

        print(f"  Cpk = {r['Cpk']:.3f}  ", end="")
        print(self._evaluate_index(r['Cpk']))
        print(f"    (Cpu={r['Cpu']:.3f}, Cpl={r['Cpl']:.3f})")

        print(f"  Cpm = {r['Cpm']:.3f}  ", end="")
        print(self._evaluate_index(r['Cpm']))

        print("\nã€4. è¦æ ¼å¤–ã‚Œç‡æ¨å®šã€‘")
        print(f"  ä¸‹é™å¤–ã‚Œ: {r['ppm_lower']:.1f} ppm")
        print(f"  ä¸Šé™å¤–ã‚Œ: {r['ppm_upper']:.1f} ppm")
        print(f"  åˆè¨ˆ: {r['ppm_total']:.1f} ppm ({r['ppm_total']/1e4:.3f}%)")

        print("\nã€5. ç·åˆåˆ¤å®šã€‘")
        if r['stable'] and r['Cpk'] >= 1.33:
            print("  âœ… ãƒ—ãƒ­ã‚»ã‚¹ã¯å®‰å®šã‹ã¤ååˆ†ãªèƒ½åŠ›ãŒã‚ã‚Šã¾ã™")
        elif r['stable'] and r['Cpk'] >= 1.0:
            print("  âš ï¸ ãƒ—ãƒ­ã‚»ã‚¹ã¯å®‰å®šã—ã¦ã„ã¾ã™ãŒã€èƒ½åŠ›æ”¹å–„ãŒå¿…è¦ã§ã™")
        else:
            print("  âŒ ãƒ—ãƒ­ã‚»ã‚¹æ”¹å–„ãŒå¿…è¦ã§ã™")

        print("=" * 60)

    def _evaluate_index(self, value: float) -> str:
        """èƒ½åŠ›æŒ‡æ•°ã®è©•ä¾¡"""
        if value >= 1.67:
            return "ï¼ˆå„ªç§€ï¼‰"
        elif value >= 1.33:
            return "ï¼ˆè‰¯å¥½ï¼‰"
        elif value >= 1.0:
            return "ï¼ˆæœ€ä½é™ï¼‰"
        else:
            return "ï¼ˆä¸ååˆ†ï¼‰"

    def plot_capability(self, data: np.ndarray):
        """ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¨æ­£è¦åˆ†å¸ƒãƒ•ã‚£ãƒƒãƒˆ"""
        if self.capability_results is None:
            raise ValueError("Call analyze() first")

        r = self.capability_results
        all_data = data.flatten()

        fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 5))

        # ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¨æ­£è¦åˆ†å¸ƒãƒ•ã‚£ãƒƒãƒˆ
        ax1.hist(all_data, bins=30, density=True, alpha=0.6,
                color='#3498db', edgecolor='black', label='Data')

        # æ­£è¦åˆ†å¸ƒæ›²ç·š
        x = np.linspace(all_data.min(), all_data.max(), 200)
        pdf = stats.norm.pdf(x, r['process_mean'], r['process_std'])
        ax1.plot(x, pdf, 'r-', linewidth=2, label='Normal Fit')

        # è¦æ ¼é™ç•Œã¨ç›®æ¨™å€¤
        ax1.axvline(r['LSL'], color='#e74c3c', linestyle='--',
                   linewidth=2, label='LSL')
        ax1.axvline(r['USL'], color='#e74c3c', linestyle='--',
                   linewidth=2, label='USL')
        ax1.axvline(r['target'], color='#11998e', linestyle='-',
                   linewidth=2, label='Target')

        ax1.set_xlabel('Value', fontsize=11)
        ax1.set_ylabel('Density', fontsize=11)
        ax1.set_title('Process Capability Histogram',
                     fontsize=13, fontweight='bold')
        ax1.legend(loc='best')
        ax1.grid(True, alpha=0.3)

        # èƒ½åŠ›æŒ‡æ•°ã®æ£’ã‚°ãƒ©ãƒ•
        indices = ['Cp', 'Cpk', 'Cpm']
        values = [r['Cp'], r['Cpk'], r['Cpm']]
        colors = ['#3498db', '#e74c3c', '#11998e']

        bars = ax2.bar(indices, values, color=colors, alpha=0.7,
                      edgecolor='black', linewidth=1.5)

        # åŸºæº–ç·š
        ax2.axhline(1.33, color='green', linestyle='--',
                   linewidth=2, label='Good (1.33)', alpha=0.7)
        ax2.axhline(1.0, color='orange', linestyle='--',
                   linewidth=2, label='Minimum (1.0)', alpha=0.7)

        # å€¤ã‚’ãƒãƒ¼ã®ä¸Šã«è¡¨ç¤º
        for bar, value in zip(bars, values):
            height = bar.get_height()
            ax2.text(bar.get_x() + bar.get_width()/2., height,
                    f'{value:.3f}',
                    ha='center', va='bottom', fontweight='bold')

        ax2.set_ylabel('Index Value', fontsize=11)
        ax2.set_title('Process Capability Indices',
                     fontsize=13, fontweight='bold')
        ax2.legend(loc='best')
        ax2.grid(True, alpha=0.3, axis='y')
        ax2.set_ylim(0, max(values) * 1.3)

        plt.tight_layout()
        plt.show()


# ä½¿ç”¨ä¾‹: å°„å‡ºæˆå½¢å“ã®å¯¸æ³•ç®¡ç†
np.random.seed(42)

# è¦æ ¼è¨­å®š
LSL = 49.5  # mm
USL = 50.5  # mm
target = 50.0  # mm

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆ40ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã€ã‚µã‚¤ã‚º5ï¼‰
n_subgroups = 40
subgroup_size = 5

# æœ€åˆã®30ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã¯å®‰å®šï¼ˆå¹³å‡50.0ã€æ¨™æº–åå·®0.15ï¼‰
data_stable = np.random.normal(50.0, 0.15, (30, subgroup_size))

# å¾Œã®10ã‚µãƒ–ã‚°ãƒ«ãƒ¼ãƒ—ã§å¹³å‡ãŒè‹¥å¹²ã‚·ãƒ•ãƒˆï¼ˆ50.0 â†’ 50.1ï¼‰
data_shift = np.random.normal(50.1, 0.15, (10, subgroup_size))

data = np.vstack([data_stable, data_shift])

# çµ±åˆåˆ†æã®å®Ÿè¡Œ
analysis = ProcessCapabilityAnalysis(LSL, USL, target)
results = analysis.analyze(data, subgroup_size)

# ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
analysis.print_report()

# å¯è¦–åŒ–
analysis.control_chart.plot(data,
    title="Injection Molding - Dimension Control")
analysis.plot_capability(data)

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ============================================================
# çµ±åˆãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
# ============================================================
#
# ã€1. ãƒ—ãƒ­ã‚»ã‚¹å®‰å®šæ€§ï¼ˆç®¡ç†å›³ï¼‰ã€‘
#   âš ï¸ ãƒ—ãƒ­ã‚»ã‚¹ãŒä¸å®‰å®šã§ã™ï¼ˆç®¡ç†å¤–ã‚Œç‚¹ã‚ã‚Šï¼‰
#     X-barç®¡ç†å¤–ã‚Œ: 6ç‚¹
#     Rç®¡ç†å¤–ã‚Œ: 0ç‚¹
#   â†’ ã¾ãšãƒ—ãƒ­ã‚»ã‚¹ã‚’å®‰å®šåŒ–ã•ã›ã¦ãã ã•ã„
#
# ã€2. ãƒ—ãƒ­ã‚»ã‚¹ç‰¹æ€§ã€‘
#   ãƒ—ãƒ­ã‚»ã‚¹å¹³å‡: 50.0266
#   ãƒ—ãƒ­ã‚»ã‚¹æ¨™æº–åå·®: 0.1505
#   è¦æ ¼ç¯„å›²: [49.50, 50.50]
#   ç›®æ¨™å€¤: 50.00
#
# ã€3. ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›æŒ‡æ•°ã€‘
#   Cp  = 1.107  ï¼ˆæœ€ä½é™ï¼‰
#   Cpk = 1.049  ï¼ˆæœ€ä½é™ï¼‰
#     (Cpu=1.049, Cpl=1.165)
#   Cpm = 1.089  ï¼ˆæœ€ä½é™ï¼‰
#
# ã€4. è¦æ ¼å¤–ã‚Œç‡æ¨å®šã€‘
#   ä¸‹é™å¤–ã‚Œ: 0.1 ppm
#   ä¸Šé™å¤–ã‚Œ: 8.6 ppm
#   åˆè¨ˆ: 8.7 ppm (0.001%)
#
# ã€5. ç·åˆåˆ¤å®šã€‘
#   âš ï¸ ãƒ—ãƒ­ã‚»ã‚¹ã¯å®‰å®šã—ã¦ã„ã¾ã™ãŒã€èƒ½åŠ›æ”¹å–„ãŒå¿…è¦ã§ã™
# ============================================================</code></pre>
        </section>

        <section>
            <h2>2.5 ç®¡ç†å›³ã®åˆ¤å®šãƒ«ãƒ¼ãƒ«</h2>

            <h3>2.5.1 Western Electric Rulesï¼ˆã‚¦ã‚¨ã‚¹ã‚¿ãƒ³ãƒ»ã‚¨ãƒ¬ã‚¯ãƒˆãƒªãƒƒã‚¯ãƒ»ãƒ«ãƒ¼ãƒ«ï¼‰</h3>

            <p>å˜ä¸€ç‚¹ã®ç®¡ç†é™ç•Œè¶…éã ã‘ã§ãªãã€ãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ç•°å¸¸ã‚’æ¤œçŸ¥ã™ã‚‹é«˜åº¦ãªãƒ«ãƒ¼ãƒ«é›†ã§ã™ã€‚</p>

            <div class="example-box">
                <h4>ğŸ“Š Example 7: Western Electric Rules Implementation</h4>
                <p>8ã¤ã®åˆ¤å®šãƒ«ãƒ¼ãƒ«ã®å®Ÿè£…</p>
            </div>

            <pre><code># ===================================
# Example 7: Western Electric Rules for Pattern Detection
# ===================================

class WesternElectricRules:
    """Western Electric Rulesã®å®Ÿè£…

    ç®¡ç†å›³ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ç•°å¸¸ã‚’æ¤œçŸ¥ã™ã‚‹8ã¤ã®ãƒ«ãƒ¼ãƒ«ã€‚
    å˜ä¸€ç‚¹ã®ç®¡ç†é™ç•Œè¶…éã ã‘ã§ãªãã€å‚¾å‘ã‚„ãƒ©ãƒ³ãªã©ã‚‚æ¤œå‡ºã€‚

    Rules:
    ------
    Rule 1: 1ç‚¹ãŒ3Ïƒã‚’è¶…ãˆã‚‹
    Rule 2: é€£ç¶š3ç‚¹ä¸­2ç‚¹ãŒ2Ïƒã¨3Ïƒã®é–“
    Rule 3: é€£ç¶š5ç‚¹ä¸­4ç‚¹ãŒ1Ïƒã¨2Ïƒã®é–“
    Rule 4: é€£ç¶š8ç‚¹ãŒåŒã˜å´ï¼ˆä¸­å¿ƒç·šã‹ã‚‰ï¼‰
    Rule 5: é€£ç¶š6ç‚¹ãŒå˜èª¿å¢—åŠ ã¾ãŸã¯æ¸›å°‘
    Rule 6: é€£ç¶š14ç‚¹ãŒäº¤äº’ã«ä¸Šä¸‹
    Rule 7: é€£ç¶š15ç‚¹ãŒ1Ïƒä»¥å†…
    Rule 8: é€£ç¶š8ç‚¹ãŒ1Ïƒå¤–å´
    """

    def __init__(self, center_line: float, ucl: float, lcl: float):
        """
        Parameters:
        -----------
        center_line : float
            ä¸­å¿ƒç·šï¼ˆå¹³å‡ï¼‰
        ucl : float
            ä¸Šæ–¹ç®¡ç†é™ç•Œï¼ˆCL + 3Ïƒï¼‰
        lcl : float
            ä¸‹æ–¹ç®¡ç†é™ç•Œï¼ˆCL - 3Ïƒï¼‰
        """
        self.cl = center_line
        self.ucl = ucl
        self.lcl = lcl

        # ã‚¾ãƒ¼ãƒ³å¢ƒç•Œã®è¨ˆç®—
        sigma = (ucl - center_line) / 3

        self.zone_a_upper = center_line + 2 * sigma
        self.zone_a_lower = center_line - 2 * sigma
        self.zone_b_upper = center_line + sigma
        self.zone_b_lower = center_line - sigma

    def apply_rules(self, data: np.ndarray) -> Dict[str, np.ndarray]:
        """å…¨ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨

        Parameters:
        -----------
        data : np.ndarray
            æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿

        Returns:
        --------
        violations : dict
            å„ãƒ«ãƒ¼ãƒ«ã®é•åç‚¹ã‚’ç¤ºã™ãƒ–ãƒ¼ãƒ«é…åˆ—
        """
        n = len(data)
        violations = {f'Rule{i}': np.zeros(n, dtype=bool) for i in range(1, 9)}

        for i in range(n):
            # Rule 1: 1ç‚¹ãŒ3Ïƒã‚’è¶…ãˆã‚‹
            if data[i] > self.ucl or data[i] < self.lcl:
                violations['Rule1'][i] = True

            # Rule 2: é€£ç¶š3ç‚¹ä¸­2ç‚¹ãŒ2Ïƒã¨3Ïƒã®é–“
            if i >= 2:
                window = data[i-2:i+1]
                in_zone_a = np.sum((window > self.zone_a_upper) |
                                   (window < self.zone_a_lower))
                if in_zone_a >= 2:
                    violations['Rule2'][i] = True

            # Rule 3: é€£ç¶š5ç‚¹ä¸­4ç‚¹ãŒ1Ïƒã¨2Ïƒã®é–“
            if i >= 4:
                window = data[i-4:i+1]
                in_zone_b = np.sum(
                    ((window > self.zone_b_upper) & (window <= self.zone_a_upper)) |
                    ((window < self.zone_b_lower) & (window >= self.zone_a_lower))
                )
                if in_zone_b >= 4:
                    violations['Rule3'][i] = True

            # Rule 4: é€£ç¶š8ç‚¹ãŒåŒã˜å´
            if i >= 7:
                window = data[i-7:i+1]
                if np.all(window > self.cl) or np.all(window < self.cl):
                    violations['Rule4'][i] = True

            # Rule 5: é€£ç¶š6ç‚¹ãŒå˜èª¿å¢—åŠ ã¾ãŸã¯æ¸›å°‘
            if i >= 5:
                window = data[i-5:i+1]
                diffs = np.diff(window)
                if np.all(diffs > 0) or np.all(diffs < 0):
                    violations['Rule5'][i] = True

            # Rule 6: é€£ç¶š14ç‚¹ãŒäº¤äº’ã«ä¸Šä¸‹
            if i >= 13:
                window = data[i-13:i+1]
                diffs = np.diff(window)
                signs = np.sign(diffs)
                # ç¬¦å·ãŒäº¤äº’ã«å¤‰ã‚ã‚‹ã‹ç¢ºèª
                alternating = True
                for j in range(len(signs) - 1):
                    if signs[j] * signs[j+1] >= 0:
                        alternating = False
                        break
                if alternating:
                    violations['Rule6'][i] = True

            # Rule 7: é€£ç¶š15ç‚¹ãŒ1Ïƒä»¥å†…
            if i >= 14:
                window = data[i-14:i+1]
                if np.all((window >= self.zone_b_lower) &
                         (window <= self.zone_b_upper)):
                    violations['Rule7'][i] = True

            # Rule 8: é€£ç¶š8ç‚¹ãŒ1Ïƒå¤–å´
            if i >= 7:
                window = data[i-7:i+1]
                if np.all((window > self.zone_b_upper) |
                         (window < self.zone_b_lower)):
                    violations['Rule8'][i] = True

        return violations

    def plot_with_zones(self, data: np.ndarray,
                        title: str = "Control Chart with Western Electric Rules"):
        """ã‚¾ãƒ¼ãƒ³ä»˜ãç®¡ç†å›³ã®ãƒ—ãƒ­ãƒƒãƒˆ"""
        violations = self.apply_rules(data)
        n = len(data)

        # å…¨é•åç‚¹ã‚’çµ±åˆ
        any_violation = np.zeros(n, dtype=bool)
        for rule_violations in violations.values():
            any_violation |= rule_violations

        plt.figure(figsize=(14, 7))

        # ã‚¾ãƒ¼ãƒ³ã‚’è‰²åˆ†ã‘è¡¨ç¤º
        plt.axhspan(self.ucl, self.zone_a_upper,
                   color='#e74c3c', alpha=0.1, label='Zone A (2-3Ïƒ)')
        plt.axhspan(self.zone_a_upper, self.zone_b_upper,
                   color='#f39c12', alpha=0.1, label='Zone B (1-2Ïƒ)')
        plt.axhspan(self.zone_b_upper, self.cl,
                   color='#2ecc71', alpha=0.1, label='Zone C (0-1Ïƒ)')
        plt.axhspan(self.cl, self.zone_b_lower,
                   color='#2ecc71', alpha=0.1)
        plt.axhspan(self.zone_b_lower, self.zone_a_lower,
                   color='#f39c12', alpha=0.1)
        plt.axhspan(self.zone_a_lower, self.lcl,
                   color='#e74c3c', alpha=0.1)

        # ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒƒãƒˆ
        plt.plot(range(1, n+1), data, marker='o', color='#2c3e50',
                linewidth=1.5, markersize=5, label='Data', zorder=3)

        # ç®¡ç†é™ç•Œ
        plt.axhline(self.cl, color='#11998e', linestyle='-',
                   linewidth=2, label='CL', zorder=2)
        plt.axhline(self.ucl, color='#e74c3c', linestyle='--',
                   linewidth=2, label='UCL (3Ïƒ)', zorder=2)
        plt.axhline(self.lcl, color='#e74c3c', linestyle='--',
                   linewidth=2, label='LCL (3Ïƒ)', zorder=2)

        # ã‚¾ãƒ¼ãƒ³å¢ƒç•Œï¼ˆç‚¹ç·šï¼‰
        plt.axhline(self.zone_a_upper, color='gray', linestyle=':',
                   linewidth=1, alpha=0.5, zorder=1)
        plt.axhline(self.zone_a_lower, color='gray', linestyle=':',
                   linewidth=1, alpha=0.5, zorder=1)
        plt.axhline(self.zone_b_upper, color='gray', linestyle=':',
                   linewidth=1, alpha=0.5, zorder=1)
        plt.axhline(self.zone_b_lower, color='gray', linestyle=':',
                   linewidth=1, alpha=0.5, zorder=1)

        # é•åç‚¹ã‚’å¼·èª¿
        if any_violation.any():
            violation_indices = np.where(any_violation)[0]
            plt.scatter(violation_indices + 1, data[violation_indices],
                       color='red', s=150, marker='X', zorder=5,
                       label='Rule Violation')

        plt.xlabel('Observation Number', fontsize=11)
        plt.ylabel('Value', fontsize=11)
        plt.title(title, fontsize=13, fontweight='bold')
        plt.legend(loc='best', ncol=2)
        plt.grid(True, alpha=0.3, zorder=0)
        plt.tight_layout()
        plt.show()

        # é•åã‚µãƒãƒªãƒ¼ã®å‡ºåŠ›
        print("\n=== Western Electric Rules Violations ===")
        for rule_name, rule_violations in violations.items():
            n_violations = rule_violations.sum()
            if n_violations > 0:
                indices = np.where(rule_violations)[0] + 1
                print(f"{rule_name}: {n_violations}å› "
                      f"(è¦³æ¸¬ {list(indices[:5])}{'...' if n_violations > 5 else ''})")


# ä½¿ç”¨ä¾‹: æ§˜ã€…ãªç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º
np.random.seed(42)

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆ100è¦³æ¸¬ï¼‰
n = 100
data = np.random.normal(0, 1, n)

# ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒ¿å…¥
# Rule 1é•å: 3Ïƒè¶…é
data[20] = 3.5

# Rule 4é•å: é€£ç¶š8ç‚¹ãŒä¸Šå´
data[40:48] += 0.5

# Rule 5é•å: å˜èª¿å¢—åŠ å‚¾å‘
data[65:71] = np.linspace(0, 2, 6)

# Rule 7é•å: å¤‰å‹•ç¸®å°ï¼ˆ1Ïƒä»¥å†…ï¼‰
data[85:100] = np.random.normal(0, 0.2, 15)

# Western Electric Rulesã®é©ç”¨
cl = 0.0
ucl = 3.0
lcl = -3.0

we_rules = WesternElectricRules(cl, ucl, lcl)
we_rules.plot_with_zones(data,
    title="Western Electric Rules - Anomaly Pattern Detection")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === Western Electric Rules Violations ===
# Rule1: 1å› (è¦³æ¸¬ [21])
# Rule4: 1å› (è¦³æ¸¬ [48])
# Rule5: 1å› (è¦³æ¸¬ [71])
# Rule7: 1å› (è¦³æ¸¬ [100])</code></pre>
        </section>

        <section>
            <h2>2.6 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…</h2>

            <div class="example-box">
                <h4>ğŸ“Š Example 8: Real-time SPC Monitoring System</h4>
                <p>å®Ÿéš›ã®è£½é€ ç¾å ´ã§ä½¿ãˆã‚‹é€æ¬¡æ›´æ–°å‹ã®ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ </p>
            </div>

            <pre><code># ===================================
# Example 8: Real-time SPC Monitoring System
# ===================================

import time
from datetime import datetime
from collections import deque

class RealTimeSPCMonitor:
    """ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ SPCç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 

    æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒåˆ°ç€ã™ã‚‹ãŸã³ã«é€æ¬¡çš„ã«ç®¡ç†å›³ã‚’æ›´æ–°ã—ã€
    ç•°å¸¸ã‚’å³åº§ã«æ¤œå‡ºãƒ»é€šçŸ¥ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚

    Features:
    ---------
    - EWMAã€CUSUMã€Shewhartç®¡ç†å›³ã‚’åŒæ™‚ç›£è¦–
    - Western Electric Rulesã«ã‚ˆã‚‹é«˜æ„Ÿåº¦æ¤œå‡º
    - ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥æ©Ÿèƒ½
    - å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒã¨å¯è¦–åŒ–
    """

    def __init__(self, target: float, std: float,
                 window_size: int = 100):
        """
        Parameters:
        -----------
        target : float
            ç›®æ¨™å€¤
        std : float
            ãƒ—ãƒ­ã‚»ã‚¹æ¨™æº–åå·®
        window_size : int
            è¡¨ç¤ºã™ã‚‹å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®æœ€å¤§æ•°
        """
        self.target = target
        self.std = std
        self.window_size = window_size

        # ç®¡ç†é™ç•Œ
        self.ucl = target + 3 * std
        self.lcl = target - 3 * std

        # å„æ‰‹æ³•ã®åˆæœŸåŒ–
        self.ewma_chart = EWMAControlChart(target, std, lambda_=0.2)
        self.cusum_chart = CUSUMControlChart(target, std, k=0.5, h=5.0)
        self.we_rules = WesternElectricRules(target, self.ucl, self.lcl)

        # ãƒ‡ãƒ¼ã‚¿å±¥æ­´ï¼ˆdequeã§åŠ¹ç‡çš„ã«ç®¡ç†ï¼‰
        self.data_history = deque(maxlen=window_size)
        self.timestamps = deque(maxlen=window_size)
        self.ewma_history = deque(maxlen=window_size)

        # ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´
        self.alerts = []

    def add_observation(self, value: float,
                       timestamp: datetime = None) -> Dict:
        """æ–°ã—ã„è¦³æ¸¬å€¤ã‚’è¿½åŠ ã—ã€ç•°å¸¸æ¤œå‡ºã‚’å®Ÿè¡Œ

        Parameters:
        -----------
        value : float
            æ–°ã—ã„è¦³æ¸¬å€¤
        timestamp : datetime, optional
            ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨æ™‚åˆ»ï¼‰

        Returns:
        --------
        status : dict
            æ¤œå‡ºçµæœã¨ã‚¢ãƒ©ãƒ¼ãƒˆæƒ…å ±
        """
        if timestamp is None:
            timestamp = datetime.now()

        # ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
        self.data_history.append(value)
        self.timestamps.append(timestamp)

        # ç•°å¸¸æ¤œå‡º
        alerts = []

        # 1. Shewhartç®¡ç†å›³ï¼ˆ3Ïƒãƒ«ãƒ¼ãƒ«ï¼‰
        if value > self.ucl:
            alerts.append({
                'method': 'Shewhart',
                'type': 'UCL violation',
                'value': value,
                'severity': 'HIGH'
            })
        elif value < self.lcl:
            alerts.append({
                'method': 'Shewhart',
                'type': 'LCL violation',
                'value': value,
                'severity': 'HIGH'
            })

        # 2. EWMAç®¡ç†å›³
        if len(self.data_history) >= 1:
            data_array = np.array(self.data_history)
            ewma_results = self.ewma_chart.fit_predict(data_array)

            current_ewma = ewma_results['ewma'][-1]
            current_ucl = ewma_results['ucl'][-1]
            current_lcl = ewma_results['lcl'][-1]

            self.ewma_history.append(current_ewma)

            if ewma_results['ooc'][-1]:
                alerts.append({
                    'method': 'EWMA',
                    'type': 'EWMA limit violation',
                    'value': current_ewma,
                    'severity': 'MEDIUM'
                })

        # 3. CUSUMç®¡ç†å›³
        if len(self.data_history) >= 1:
            data_array = np.array(self.data_history)
            cusum_results = self.cusum_chart.fit_predict(data_array)

            if cusum_results['ooc_high'][-1]:
                alerts.append({
                    'method': 'CUSUM',
                    'type': 'Upward shift detected',
                    'value': cusum_results['cusum_high'][-1],
                    'severity': 'MEDIUM'
                })

            if cusum_results['ooc_low'][-1]:
                alerts.append({
                    'method': 'CUSUM',
                    'type': 'Downward shift detected',
                    'value': cusum_results['cusum_low'][-1],
                    'severity': 'MEDIUM'
                })

        # 4. Western Electric Rules
        if len(self.data_history) >= 15:  # æœ€ä½é™ã®ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦
            data_array = np.array(self.data_history)
            violations = self.we_rules.apply_rules(data_array)

            for rule_name, rule_violations in violations.items():
                if rule_violations[-1]:  # æœ€æ–°ç‚¹ã§é•å
                    alerts.append({
                        'method': 'Western Electric',
                        'type': f'{rule_name} violation',
                        'value': value,
                        'severity': 'LOW'
                    })

        # ã‚¢ãƒ©ãƒ¼ãƒˆä¿å­˜
        if alerts:
            for alert in alerts:
                alert['timestamp'] = timestamp
                self.alerts.append(alert)

        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¿”å´
        status = {
            'value': value,
            'timestamp': timestamp,
            'in_control': len(alerts) == 0,
            'alerts': alerts,
            'n_observations': len(self.data_history)
        }

        return status

    def get_summary(self) -> Dict:
        """ç¾åœ¨ã®ç›£è¦–çŠ¶æ³ã®ã‚µãƒãƒªãƒ¼"""
        if len(self.data_history) == 0:
            return {'status': 'No data'}

        data_array = np.array(self.data_history)

        return {
            'n_observations': len(self.data_history),
            'current_value': data_array[-1],
            'process_mean': data_array.mean(),
            'process_std': data_array.std(ddof=1),
            'target': self.target,
            'n_alerts_total': len(self.alerts),
            'n_alerts_last_10': sum(1 for a in self.alerts
                                   if len(self.data_history) -
                                   list(self.timestamps).index(a['timestamp']) <= 10),
            'alert_methods': list(set(a['method'] for a in self.alerts))
        }

    def plot_dashboard(self):
        """ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"""
        if len(self.data_history) < 2:
            print("ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼ˆæœ€ä½2ç‚¹å¿…è¦ï¼‰")
            return

        data_array = np.array(self.data_history)
        n = len(data_array)

        fig, axes = plt.subplots(3, 1, figsize=(14, 10))

        # 1. Shewhartç®¡ç†å›³
        ax1 = axes[0]
        x_indices = range(1, n+1)

        ax1.plot(x_indices, data_array, marker='o', color='#2c3e50',
                linewidth=1.5, markersize=4, label='Data')
        ax1.axhline(self.target, color='#11998e', linestyle='-',
                   linewidth=2, label='Target')
        ax1.axhline(self.ucl, color='#e74c3c', linestyle='--',
                   linewidth=2, label='UCL')
        ax1.axhline(self.lcl, color='#e74c3c', linestyle='--',
                   linewidth=2, label='LCL')

        # Shewharté•åç‚¹ã‚’å¼·èª¿
        ooc_indices = (data_array > self.ucl) | (data_array < self.lcl)
        if ooc_indices.any():
            ooc_x = np.where(ooc_indices)[0] + 1
            ax1.scatter(ooc_x, data_array[ooc_indices],
                       color='red', s=100, zorder=5)

        ax1.set_ylabel('Value', fontsize=10)
        ax1.set_title('Shewhart Control Chart (3Ïƒ)',
                     fontsize=12, fontweight='bold')
        ax1.legend(loc='best', fontsize=9)
        ax1.grid(True, alpha=0.3)

        # 2. EWMAç®¡ç†å›³
        ax2 = axes[1]

        if len(self.ewma_history) > 0:
            ewma_array = np.array(self.ewma_history)
            ewma_results = self.ewma_chart.fit_predict(data_array)

            ax2.plot(x_indices, data_array, marker='.', color='gray',
                    linewidth=0.5, markersize=3, alpha=0.5, label='Original')
            ax2.plot(x_indices, ewma_array, marker='o', color='#3498db',
                    linewidth=2, markersize=4, label='EWMA')
            ax2.axhline(self.target, color='#11998e', linestyle='-',
                       linewidth=2, label='Target')
            ax2.plot(x_indices, ewma_results['ucl'],
                    color='#e74c3c', linestyle='--', linewidth=2, label='UCL')
            ax2.plot(x_indices, ewma_results['lcl'],
                    color='#e74c3c', linestyle='--', linewidth=2, label='LCL')

            # EWMAé•åç‚¹ã‚’å¼·èª¿
            if ewma_results['ooc'].any():
                ooc_x = np.where(ewma_results['ooc'])[0] + 1
                ax2.scatter(ooc_x, ewma_array[ewma_results['ooc']],
                           color='red', s=100, zorder=5)

        ax2.set_ylabel('EWMA Value', fontsize=10)
        ax2.set_title('EWMA Control Chart (Î»=0.2)',
                     fontsize=12, fontweight='bold')
        ax2.legend(loc='best', fontsize=9)
        ax2.grid(True, alpha=0.3)

        # 3. CUSUMç®¡ç†å›³
        ax3 = axes[2]

        cusum_results = self.cusum_chart.fit_predict(data_array)

        ax3.plot(x_indices, cusum_results['cusum_high'],
                marker='^', color='#e74c3c', linewidth=1.5,
                markersize=4, label='CUSUM High')
        ax3.plot(x_indices, cusum_results['cusum_low'],
                marker='v', color='#3498db', linewidth=1.5,
                markersize=4, label='CUSUM Low')
        ax3.axhline(self.cusum_chart.h, color='#2c3e50',
                   linestyle='--', linewidth=2, label='Decision Interval (h)')
        ax3.axhline(0, color='gray', linestyle='-', linewidth=1)

        # CUSUMé•åç‚¹ã‚’å¼·èª¿
        if cusum_results['ooc_high'].any():
            ooc_x = np.where(cusum_results['ooc_high'])[0] + 1
            ax3.scatter(ooc_x, cusum_results['cusum_high'][cusum_results['ooc_high']],
                       color='red', s=100, zorder=5, marker='^')
        if cusum_results['ooc_low'].any():
            ooc_x = np.where(cusum_results['ooc_low'])[0] + 1
            ax3.scatter(ooc_x, cusum_results['cusum_low'][cusum_results['ooc_low']],
                       color='red', s=100, zorder=5, marker='v')

        ax3.set_xlabel('Observation Number', fontsize=10)
        ax3.set_ylabel('CUSUM Value', fontsize=10)
        ax3.set_title('CUSUM Control Chart',
                     fontsize=12, fontweight='bold')
        ax3.legend(loc='best', fontsize=9)
        ax3.grid(True, alpha=0.3)

        plt.suptitle('Real-time SPC Monitoring Dashboard',
                    fontsize=15, fontweight='bold', y=0.995)
        plt.tight_layout()
        plt.show()


# ä½¿ç”¨ä¾‹: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
np.random.seed(42)

# ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
target = 100.0
std = 1.0
monitor = RealTimeSPCMonitor(target, std, window_size=150)

print("=== ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ SPCç›£è¦–ã‚·ã‚¹ãƒ†ãƒ  ===")
print(f"ç›®æ¨™å€¤: {target}")
print(f"æ¨™æº–åå·®: {std}")
print("\nè¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ã‚’é€æ¬¡è¿½åŠ ä¸­...\n")

# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: 150è¦³æ¸¬ã‚’é€æ¬¡è¿½åŠ 
for i in range(150):
    # æ­£å¸¸ãƒ‡ãƒ¼ã‚¿
    if i < 60:
        value = np.random.normal(target, std)
    # è¦³æ¸¬60-80: +1Ïƒã‚·ãƒ•ãƒˆ
    elif i < 80:
        value = np.random.normal(target + std, std)
    # è¦³æ¸¬80-120: æ­£å¸¸ã«æˆ»ã‚‹
    elif i < 120:
        value = np.random.normal(target, std)
    # è¦³æ¸¬120-150: å¤‰å‹•å¢—å¤§
    else:
        value = np.random.normal(target, std * 1.5)

    # è¦³æ¸¬å€¤ã‚’è¿½åŠ 
    status = monitor.add_observation(value)

    # ã‚¢ãƒ©ãƒ¼ãƒˆãŒã‚ã‚Œã°è¡¨ç¤º
    if not status['in_control']:
        print(f"âš ï¸ è¦³æ¸¬ #{i+1}: ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ")
        for alert in status['alerts']:
            print(f"  - {alert['method']}: {alert['type']} "
                  f"(é‡è¦åº¦: {alert['severity']})")

# ã‚µãƒãƒªãƒ¼è¡¨ç¤º
print("\n=== ç›£è¦–ã‚µãƒãƒªãƒ¼ ===")
summary = monitor.get_summary()
for key, value in summary.items():
    print(f"{key}: {value}")

# ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
monitor.plot_dashboard()

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ SPCç›£è¦–ã‚·ã‚¹ãƒ†ãƒ  ===
# ç›®æ¨™å€¤: 100.0
# æ¨™æº–åå·®: 1.0
#
# è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ã‚’é€æ¬¡è¿½åŠ ä¸­...
#
# âš ï¸ è¦³æ¸¬ #67: ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
#   - EWMA: EWMA limit violation (é‡è¦åº¦: MEDIUM)
#   - CUSUM: Upward shift detected (é‡è¦åº¦: MEDIUM)
# ...ï¼ˆè¤‡æ•°ã®ã‚¢ãƒ©ãƒ¼ãƒˆï¼‰
#
# === ç›£è¦–ã‚µãƒãƒªãƒ¼ ===
# n_observations: 150
# current_value: 101.234
# process_mean: 100.567
# process_std: 1.234
# target: 100.0
# n_alerts_total: 45
# n_alerts_last_10: 8
# alert_methods: ['EWMA', 'CUSUM', 'Western Electric']</code></pre>
        </section>

        <section>
            <h2>å­¦ç¿’ç›®æ¨™ã®ç¢ºèª</h2>

            <p>ã“ã®ç« ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã‚’èª¬æ˜ãƒ»å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š</p>

            <h3>åŸºæœ¬ç†è§£</h3>
            <ul>
                <li>âœ… SPCã®ç›®çš„ã¨å¶ç„¶åŸå› ãƒ»ç•°å¸¸åŸå› ã®é•ã„ã‚’èª¬æ˜ã§ãã‚‹</li>
                <li>âœ… ç®¡ç†å›³ã®åŸºæœ¬æ§‹é€ ï¼ˆCLã€UCLã€LCLï¼‰ã¨3Ïƒãƒ«ãƒ¼ãƒ«ã®æ ¹æ‹ ã‚’ç†è§£ã§ãã‚‹</li>
                <li>âœ… è¨ˆé‡å€¤ç®¡ç†å›³ï¼ˆX-bar/Rã€EWMAã€CUSUMï¼‰ã¨è¨ˆæ•°å€¤ç®¡ç†å›³ï¼ˆPã€Cï¼‰ã®ä½¿ã„åˆ†ã‘ãŒã§ãã‚‹</li>
                <li>âœ… ç®¡ç†é™ç•Œã¨è¦æ ¼é™ç•Œã®é•ã„ã‚’æ˜ç¢ºã«èª¬æ˜ã§ãã‚‹</li>
            </ul>

            <h3>å®Ÿè·µã‚¹ã‚­ãƒ«</h3>
            <ul>
                <li>âœ… X-bar and Rç®¡ç†å›³ã‚’å®Ÿè£…ã—ã€ãƒ—ãƒ­ã‚»ã‚¹ã®å®‰å®šæ€§ã‚’è©•ä¾¡ã§ãã‚‹</li>
                <li>âœ… Pç®¡ç†å›³ã¨Cç®¡ç†å›³ã‚’ä½¿ã£ã¦ä¸è‰¯ç‡ãƒ»æ¬ é™¥æ•°ã‚’ç®¡ç†ã§ãã‚‹</li>
                <li>âœ… CUSUMã¨EWMAã‚’å®Ÿè£…ã—ã€å°ã•ãªå¹³å‡ã‚·ãƒ•ãƒˆï¼ˆ0.5-2Ïƒï¼‰ã‚’æ—©æœŸæ¤œå‡ºã§ãã‚‹</li>
                <li>âœ… Western Electric Rulesã‚’é©ç”¨ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ç•°å¸¸ã‚’æ¤œçŸ¥ã§ãã‚‹</li>
                <li>âœ… ç®¡ç†å›³ã¨ãƒ—ãƒ­ã‚»ã‚¹èƒ½åŠ›åˆ†æã‚’çµ±åˆã—ã€ç·åˆè©•ä¾¡ãŒã§ãã‚‹</li>
                <li>âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹</li>
            </ul>

            <h3>å¿œç”¨åŠ›</h3>
            <ul>
                <li>âœ… ãƒ—ãƒ­ã‚»ã‚¹ã®ç‰¹æ€§ã«å¿œã˜ã¦æœ€é©ãªç®¡ç†å›³æ‰‹æ³•ã‚’é¸æŠã§ãã‚‹</li>
                <li>âœ… è¤‡æ•°ã®ç®¡ç†å›³ã‚’çµ„ã¿åˆã‚ã›ã¦æ„Ÿåº¦ã¨ç‰¹ç•°åº¦ã®ãƒãƒ©ãƒ³ã‚¹ã‚’èª¿æ•´ã§ãã‚‹</li>
                <li>âœ… ç®¡ç†å›³ã®æ¤œå‡ºé…å»¶ã¨ç¬¬ä¸€ç¨®ãƒ»ç¬¬äºŒç¨®éèª¤ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã‚’ç†è§£ã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã§ãã‚‹</li>
                <li>âœ… è£½é€ ç¾å ´ã§ã®å®Ÿè£…èª²é¡Œï¼ˆã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é »åº¦ã€è‡ªå‹•åŒ–ã€ã‚¢ãƒ©ãƒ¼ãƒˆç–²åŠ´ï¼‰ã«å¯¾å‡¦ã§ãã‚‹</li>
            </ul>
        </section>

        <section>
            <h2>æ¼”ç¿’å•é¡Œ</h2>

            <h3>Easyï¼ˆåŸºç¤ç¢ºèªï¼‰</h3>

            <p><strong>Q1</strong>: X-barç®¡ç†å›³ã®ä¸Šæ–¹ç®¡ç†é™ç•Œ(UCL)ãŒ80.5ã€ä¸­å¿ƒç·š(CL)ãŒ79.0ã®å ´åˆã€ä¸‹æ–¹ç®¡ç†é™ç•Œ(LCL)ã¯ã„ãã¤ã§ã™ã‹ï¼Ÿ</p>

            <details>
                <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                <p><strong>æ­£è§£</strong>: 77.5</p>
                <p><strong>è§£èª¬</strong>:<br>
                UCL = CL + 3Ïƒ<br>
                LCL = CL - 3Ïƒ<br>
                UCL - CL = 80.5 - 79.0 = 1.5 = 3Ïƒ<br>
                ã—ãŸãŒã£ã¦ã€LCL = CL - 1.5 = 79.0 - 1.5 = 77.5</p>
            </details>

            <h3>Mediumï¼ˆå¿œç”¨ï¼‰</h3>

            <p><strong>Q2</strong>: ã‚ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®å¹³å‡ä¸è‰¯ç‡ãŒ2%ã€ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºãŒ100å€‹ã®å ´åˆã€Pç®¡ç†å›³ã®ä¸Šæ–¹ç®¡ç†é™ç•Œ(UCL)ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</p>

            <details>
                <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                <p><strong>æ­£è§£</strong>: UCL = 0.062 (6.2%)</p>
                <p><strong>è¨ˆç®—</strong>:<br>
                pÌ„ = 0.02<br>
                n = 100<br>
                Ïƒ_p = âˆš(pÌ„(1-pÌ„)/n) = âˆš(0.02 Ã— 0.98 / 100) = âˆš0.000196 = 0.014<br>
                UCL = pÌ„ + 3Ïƒ_p = 0.02 + 3 Ã— 0.014 = 0.02 + 0.042 = 0.062</p>
                <p><strong>é‡è¦ãƒã‚¤ãƒ³ãƒˆ</strong>: ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã„ã»ã©ç®¡ç†é™ç•Œã¯ä¸­å¿ƒç·šã«è¿‘ã¥ãã¾ã™ï¼ˆæ¤œå‡ºåŠ›å‘ä¸Šï¼‰ã€‚</p>
            </details>

            <h3>Hardï¼ˆç™ºå±•ï¼‰</h3>

            <p><strong>Q3</strong>: CUSUMã¨EWMAã¯ã©ã¡ã‚‰ã‚‚å°ã•ãªã‚·ãƒ•ãƒˆæ¤œå‡ºã«å„ªã‚Œã¦ã„ã¾ã™ãŒã€ãã‚Œãã‚Œã®é•·æ‰€ã¨çŸ­æ‰€ã‚’æ¯”è¼ƒã—ã€ã©ã®ã‚ˆã†ãªçŠ¶æ³ã§ã©ã¡ã‚‰ã‚’é¸ã¶ã¹ãã‹èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</p>

            <details>
                <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                <p><strong>æ¯”è¼ƒè¡¨</strong>:</p>
                <table>
                    <tr>
                        <th>é …ç›®</th>
                        <th>CUSUM</th>
                        <th>EWMA</th>
                    </tr>
                    <tr>
                        <td>æ¤œå‡ºé€Ÿåº¦</td>
                        <td>éå¸¸ã«é«˜é€Ÿï¼ˆARLå„ªç§€ï¼‰</td>
                        <td>é«˜é€Ÿ</td>
                    </tr>
                    <tr>
                        <td>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š</td>
                        <td>ã‚„ã‚„é›£ï¼ˆk, hï¼‰</td>
                        <td>æ¯”è¼ƒçš„å®¹æ˜“ï¼ˆÎ»ï¼‰</td>
                    </tr>
                    <tr>
                        <td>è§£é‡ˆã®ã—ã‚„ã™ã•</td>
                        <td>é›£ï¼ˆç´¯ç©çµ±è¨ˆé‡ï¼‰</td>
                        <td>æ˜“ï¼ˆå¹³æ»‘åŒ–ã•ã‚ŒãŸå€¤ï¼‰</td>
                    </tr>
                    <tr>
                        <td>ã‚·ãƒ•ãƒˆæ–¹å‘æ¤œå‡º</td>
                        <td>ä¸Šä¸‹åˆ¥ã€…ï¼ˆæ˜ç¢ºï¼‰</td>
                        <td>å˜ä¸€çµ±è¨ˆé‡</td>
                    </tr>
                    <tr>
                        <td>å®Ÿè£…ã®è¤‡é›‘ã•</td>
                        <td>ä¸­ç¨‹åº¦</td>
                        <td>ã‚·ãƒ³ãƒ—ãƒ«</td>
                    </tr>
                </table>
                <p><strong>é¸æŠåŸºæº–</strong>:</p>
                <ul>
                    <li><strong>CUSUMã‚’é¸ã¶å ´åˆ</strong>:
                        <ul>
                            <li>æœ€é€Ÿã®æ¤œå‡ºãŒå¿…è¦ï¼ˆåŒ»è–¬å“ã€åŠå°ä½“ãªã©ï¼‰</li>
                            <li>ã‚·ãƒ•ãƒˆæ–¹å‘ã®ç‰¹å®šãŒé‡è¦</li>
                            <li>å°‚é–€çš„ãªSPCçŸ¥è­˜ãŒã‚ã‚‹</li>
                        </ul>
                    </li>
                    <li><strong>EWMAã‚’é¸ã¶å ´åˆ</strong>:
                        <ul>
                            <li>å®Ÿè£…ã®ã‚·ãƒ³ãƒ—ãƒ«ã•ãŒé‡è¦</li>
                            <li>ç¾å ´ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒç†è§£ã—ã‚„ã™ã„</li>
                            <li>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ãŒé »ç¹ã«å¿…è¦</li>
                        </ul>
                    </li>
                </ul>
                <p><strong>ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</strong>: é‡è¦ãªãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ä¸¡æ–¹ã‚’ä½µç”¨ã—ã€ç›¸äº’è£œå®Œçš„ã«ç›£è¦–ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚</p>
            </details>
        </section>

        <div class="nav-links">
            <a href="./index.html" class="nav-link">â† ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã¸</a>
            <a href="./chapter-3.html" class="nav-link">ç¬¬3ç« ï¼šã‚·ãƒƒã‚¯ã‚¹ã‚·ã‚°ãƒã¨DMAIC â†’</a>
        </div>
    </div>
</body>
</html>