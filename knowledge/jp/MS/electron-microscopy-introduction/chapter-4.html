<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4ç« ï¼šSTEMã¨åˆ†ææŠ€è¡“ - MS Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #f093fb;
            --color-accent-light: #f5576c;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #f093fb;
            --color-link-hover: #d07be8;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .breadcrumb {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        .breadcrumb a {
            color: var(--color-link);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }
        .disclaimer {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            border-radius: 4px;
        }

        .disclaimer h3 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .disclaimer ul {
            list-style: none;
            padding-left: 0;
        }

        .disclaimer li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.6;
        }

        .disclaimer li::before {
            content: "âš ï¸";
            position: absolute;
            left: 0;
        }


        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>

    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/MS/electron-microscopy-introduction/chapter-4.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<header>
        <div class="header-content">
            <h1>ç¬¬4ç« ï¼šSTEMã¨åˆ†ææŠ€è¡“</h1>
            <p class="subtitle">Z-contraståƒã€EELSã€å…ƒç´ ãƒãƒƒãƒ”ãƒ³ã‚°ã€åŸå­åˆ†è§£èƒ½åˆ†æ</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 25-35åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´šã€œä¸Šç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 7å€‹</span>
            </div>
        </div>
    </header>

    <div class="breadcrumb">
        <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a> &gt;
        <a href="../index.html">MS Dojo</a> &gt;
        <a href="index.html">é›»å­é¡•å¾®é¡å…¥é–€</a> &gt;
        ç¬¬4ç« 
    </div>

    <main class="container">
        <p class="chapter-description" style="margin: 1.5rem 0; padding: 1rem; background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); border-left: 4px solid #f093fb; border-radius: 8px; font-size: 1.05rem; line-height: 1.8; color: #2d3748;">
            èµ°æŸ»é€éå‹é›»å­é¡•å¾®é¡ï¼ˆSTEMï¼‰ã¯ã€åæŸé›»å­ãƒ“ãƒ¼ãƒ ã‚’è©¦æ–™ä¸Šã§èµ°æŸ»ã—ã€é€éé›»å­ã‚„éå¼¾æ€§æ•£ä¹±é›»å­ã‚’æ¤œå‡ºã—ã¦åƒã‚’å½¢æˆã—ã¾ã™ã€‚ã“ã®ç« ã§ã¯ã€STEMåŸç†ã€Z-contraståƒï¼ˆADF/HAADFï¼‰ã€ç’°çŠ¶æ˜è¦–é‡åƒï¼ˆABFï¼‰ã€é›»å­ã‚¨ãƒãƒ«ã‚®ãƒ¼æå¤±åˆ†å…‰ï¼ˆEELSï¼‰ã€å…ƒç´ ãƒãƒƒãƒ”ãƒ³ã‚°ã€åŸå­åˆ†è§£èƒ½åˆ†æã€ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼ã®åŸºç¤ã¨å¿œç”¨ã‚’å­¦ã³ã€Pythonã§å®šé‡è§£æã‚’å®Ÿè·µã—ã¾ã™ã€‚
        </p>

        <div class="learning-objectives">
            <h2>å­¦ç¿’ç›®æ¨™</h2>
            <p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
            <ul>
                <li>âœ… STEMçµåƒåŸç†ã¨å¾“æ¥TEMã¨ã®é•ã„ã‚’ç†è§£ã™ã‚‹</li>
                <li>âœ… Z-contraståƒï¼ˆADF/HAADF-STEMï¼‰ã®å½¢æˆæ©Ÿæ§‹ã¨åŸå­ç•ªå·ä¾å­˜æ€§ã‚’èª¬æ˜ã§ãã‚‹</li>
                <li>âœ… ç’°çŠ¶æ˜è¦–é‡ï¼ˆABFï¼‰åƒã®åŸç†ã¨è»½å…ƒç´ è¦³å¯Ÿã¸ã®å¿œç”¨ã‚’ç†è§£ã™ã‚‹</li>
                <li>âœ… é›»å­ã‚¨ãƒãƒ«ã‚®ãƒ¼æå¤±åˆ†å…‰ï¼ˆEELSï¼‰ã®åŸç†ã¨å®šé‡åˆ†ææ‰‹æ³•ã‚’ç¿’å¾—ã™ã‚‹</li>
                <li>âœ… ã‚¹ãƒšã‚¯ãƒˆãƒ«è§£æï¼ˆã‚³ã‚¢ãƒ­ã‚¹è§£æã€ãƒ—ãƒ©ã‚ºãƒ¢ãƒ³è§£æï¼‰ãŒã§ãã‚‹</li>
                <li>âœ… STEMå…ƒç´ ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆEELS/EDSï¼‰ã®å–å¾—ã¨è§£é‡ˆãŒã§ãã‚‹</li>
                <li>âœ… é›»å­ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼ã®åŸç†ã¨3Då†æ§‹æˆã®åŸºç¤ã‚’ç†è§£ã™ã‚‹</li>
            </ul>
        </div>

        <h2>4.1 STEMåŸç†ã¨æ¤œå‡ºå™¨æ§‹æˆ</h2>

        <h3>4.1.1 STEMã¨TEMã®é•ã„</h3>
        <p>STEMï¼ˆScanning Transmission Electron Microscopyï¼‰ã¯ã€åæŸé›»å­ãƒ“ãƒ¼ãƒ ã‚’è©¦æ–™ä¸Šã§èµ°æŸ»ï¼ˆã‚¹ã‚­ãƒ£ãƒ³ï¼‰ã—ã€å„ç‚¹ã§é€éãƒ»æ•£ä¹±é›»å­ã‚’æ¤œå‡ºã—ã¦åƒã‚’å½¢æˆã—ã¾ã™ã€‚</p>

        <table>
            <thead>
                <tr>
                    <th>é …ç›®</th>
                    <th>TEMï¼ˆé€éå‹ï¼‰</th>
                    <th>STEMï¼ˆèµ°æŸ»é€éå‹ï¼‰</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ç…§å°„æ–¹å¼</strong></td>
                    <td>å¹³è¡Œãƒ“ãƒ¼ãƒ ç…§å°„ï¼ˆè©¦æ–™å…¨é¢ï¼‰</td>
                    <td>åæŸãƒ“ãƒ¼ãƒ èµ°æŸ»ï¼ˆç‚¹ã”ã¨ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>åƒå½¢æˆ</strong></td>
                    <td>ãƒ¬ãƒ³ã‚ºã«ã‚ˆã‚‹çµåƒï¼ˆåƒé¢ï¼‰</td>
                    <td>æ¤œå‡ºå™¨ä¿¡å·ã®èµ°æŸ»åŒæœŸï¼ˆãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>åˆ†è§£èƒ½</strong></td>
                    <td>å¯¾ç‰©ãƒ¬ãƒ³ã‚ºã®åå·®ã§æ±ºã¾ã‚‹</td>
                    <td>ãƒ—ãƒ­ãƒ¼ãƒ–ã‚µã‚¤ã‚ºã§æ±ºã¾ã‚‹</td>
                </tr>
                <tr>
                    <td><strong>æ¤œå‡ºå™¨</strong></td>
                    <td>CCDã‚«ãƒ¡ãƒ©ã€è›å…‰ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</td>
                    <td>ç’°çŠ¶æ¤œå‡ºå™¨ï¼ˆADF, HAADF, ABFï¼‰ã€EELSã€EDS</td>
                </tr>
                <tr>
                    <td><strong>åŒæ™‚ä¿¡å·å–å¾—</strong></td>
                    <td>å›°é›£ï¼ˆåƒorå›æŠ˜ï¼‰</td>
                    <td>å®¹æ˜“ï¼ˆè¤‡æ•°æ¤œå‡ºå™¨ä¸¦åˆ—ä½¿ç”¨ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>Z-contrast</strong></td>
                    <td>ç›´æ¥çš„ã«ã¯å›°é›£</td>
                    <td>HAADFæ¤œå‡ºå™¨ã§å®¹æ˜“ã«å®Ÿç¾</td>
                </tr>
            </tbody>
        </table>

        <h3>4.1.2 STEMæ¤œå‡ºå™¨ã®ç¨®é¡</h3>
        <p>STEMã§ã¯ã€è©¦æ–™é€éå¾Œã®é›»å­ã‚’è§’åº¦åˆ¥ã«æ¤œå‡ºã™ã‚‹<strong>ç’°çŠ¶æ¤œå‡ºå™¨</strong>ãŒé‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚</p>

        <div class="mermaid">
flowchart TD
    A[åæŸé›»å­ãƒ“ãƒ¼ãƒ ] --> B[è©¦æ–™]
    B --> C{æ•£ä¹±è§’åº¦}
    C -->|0 mradä»˜è¿‘| D[BFæ¤œå‡ºå™¨<br/>Bright Field]
    C -->|10-50 mrad| E[ABFæ¤œå‡ºå™¨<br/>Annular BF]
    C -->|30-100 mrad| F[ADFæ¤œå‡ºå™¨<br/>Annular DF]
    C -->|>50 mrad| G[HAADFæ¤œå‡ºå™¨<br/>High-Angle ADF]
    C -->|å…¨è§’åº¦| H[EELSåˆ†å…‰å™¨]

    style A fill:#f093fb,stroke:#f5576c,stroke-width:2px,color:#fff
    style B fill:#ffeb99,stroke:#ffa500
    style G fill:#f5576c,stroke:#f093fb,stroke-width:2px,color:#fff
    style H fill:#99ccff,stroke:#0066cc
        </div>

        <p><strong>å„æ¤œå‡ºå™¨ã®ç‰¹å¾´</strong>ï¼š</p>
        <ul>
            <li><strong>BFï¼ˆBright Fieldï¼‰</strong>ï¼šä½è§’æ•£ä¹±é›»å­ã‚’æ¤œå‡ºã€‚å¾“æ¥TEMã®æ˜è¦–é‡åƒã«ç›¸å½“ã€‚ä½ç›¸ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãŒä¸»</li>
            <li><strong>ABFï¼ˆAnnular Bright Fieldï¼‰</strong>ï¼šä¸­å¿ƒéƒ¨ã‚’é®è”½ã—ãŸç’°çŠ¶æ˜è¦–é‡ã€‚è»½å…ƒç´ ï¼ˆLi, H, Oãªã©ï¼‰ã®åŸå­ä½ç½®ã‚’ç›´æ¥è¦³å¯Ÿå¯èƒ½</li>
            <li><strong>ADFï¼ˆAnnular Dark Fieldï¼‰</strong>ï¼šä¸­è§’æ•£ä¹±é›»å­ã‚’æ¤œå‡ºã€‚è³ªé‡åšã•ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ</li>
            <li><strong>HAADFï¼ˆHigh-Angle ADFï¼‰</strong>ï¼šé«˜è§’æ•£ä¹±é›»å­ã‚’æ¤œå‡ºã€‚<strong>Z-contrast</strong>ï¼ˆåŸå­ç•ªå·ä¾å­˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼‰ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚éå¹²æ¸‰æ€§çµåƒ</li>
            <li><strong>EELSï¼ˆElectron Energy Loss Spectroscopyï¼‰</strong>ï¼šã‚¨ãƒãƒ«ã‚®ãƒ¼æå¤±ã—ãŸé›»å­ã‚’åˆ†å…‰ã€‚å…ƒç´ åŒå®šã€åŒ–å­¦çŠ¶æ…‹ã€ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—æ¸¬å®š</li>
        </ul>

        <h3>4.1.3 ãƒ—ãƒ­ãƒ¼ãƒ–ã‚µã‚¤ã‚ºã¨é›»æµã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•</h3>
        <p>STEMã®åˆ†è§£èƒ½ã¯<strong>ãƒ—ãƒ­ãƒ¼ãƒ–ã‚µã‚¤ã‚º</strong>ã§æ±ºã¾ã‚Šã¾ã™ãŒã€ãƒ—ãƒ­ãƒ¼ãƒ–ã‚’å°ã•ãã™ã‚‹ã¨é›»æµå¯†åº¦ãŒæ¸›å°‘ã—ã€S/Næ¯”ãŒä½ä¸‹ã—ã¾ã™ã€‚</p>

        $$
        d_{\text{probe}} \approx 0.6 \frac{\lambda}{\alpha}
        $$

        <ul>
            <li>$d_{\text{probe}}$ï¼šãƒ—ãƒ­ãƒ¼ãƒ–ç›´å¾„</li>
            <li>$\lambda$ï¼šé›»å­æ³¢é•·</li>
            <li>$\alpha$ï¼šåæŸåŠè§’ï¼ˆå¯¾ç‰©çµã‚Šã§åˆ¶å¾¡ï¼‰</li>
        </ul>

        <p><strong>å®Ÿç”¨çš„ãªãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•</strong>ï¼š</p>
        <ul>
            <li>åŸå­åˆ†è§£èƒ½ï¼ˆ<1 Ã…ï¼‰ï¼šåæŸè§’ 20-30 mradã€ãƒ—ãƒ­ãƒ¼ãƒ–é›»æµ 50-200 pA</li>
            <li>é«˜S/Nåˆ†æï¼ˆ~2 Ã…ï¼‰ï¼šåæŸè§’ 10-15 mradã€ãƒ—ãƒ­ãƒ¼ãƒ–é›»æµ >500 pA</li>
        </ul>

        <h4>ã‚³ãƒ¼ãƒ‰ä¾‹4-1: STEMæ¤œå‡ºå™¨ã®æ•£ä¹±è§’åº¦ã¨ä¿¡å·å¼·åº¦ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h4>
        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

def rutherford_scattering_cross_section(Z, theta, E_keV=200):
    """
    ãƒ©ã‚¶ãƒ•ã‚©ãƒ¼ãƒ‰æ•£ä¹±æ–­é¢ç©ï¼ˆç°¡ç•¥ãƒ¢ãƒ‡ãƒ«ï¼‰

    Parameters
    ----------
    Z : int
        åŸå­ç•ªå·
    theta : array-like
        æ•£ä¹±è§’ [rad]
    E_keV : float
        é›»å­ã‚¨ãƒãƒ«ã‚®ãƒ¼ [keV]

    Returns
    -------
    sigma : ndarray
        å¾®åˆ†æ•£ä¹±æ–­é¢ç© [ä»»æ„å˜ä½]
    """
    # ç°¡ç•¥åŒ–ï¼šé«˜è§’æ•£ä¹±ã¯Z^2ã«æ¯”ä¾‹ã€ä½è§’ã¯ä½ç›¸ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ
    # Rutherfordæ•£ä¹±ï¼šdÏƒ/dÎ© âˆ Z^2 / (sin^4(Î¸/2))

    # ä½è§’é ˜åŸŸã§ã®ç™ºæ•£ã‚’é¿ã‘ã‚‹ãŸã‚æœ€å°è§’åº¦ã‚’è¨­å®š
    theta = np.maximum(theta, 0.001)

    sigma = (Z**2) / (np.sin(theta / 2 + 1e-6)**4)

    return sigma

def plot_stem_detector_signals():
    """
    STEMæ¤œå‡ºå™¨ã®æ•£ä¹±è§’åº¦ä¾å­˜æ€§ã‚’ãƒ—ãƒ­ãƒƒãƒˆ
    """
    # æ•£ä¹±è§’ï¼ˆmradï¼‰
    theta_mrad = np.linspace(0.1, 200, 1000)
    theta_rad = theta_mrad * 1e-3

    # ç•°ãªã‚‹åŸå­ç•ªå·ã§ã®æ•£ä¹±å¼·åº¦
    elements = [('C', 6), ('Al', 13), ('Fe', 26), ('Au', 79)]
    colors = ['green', 'blue', 'orange', 'red']

    fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 10))

    # ä¸Šå›³ï¼šæ•£ä¹±å¼·åº¦ã®è§’åº¦ä¾å­˜æ€§ï¼ˆå¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
    for (elem, Z), color in zip(elements, colors):
        sigma = rutherford_scattering_cross_section(Z, theta_rad)
        ax1.plot(theta_mrad, sigma, color=color, linewidth=2, label=f'{elem} (Z={Z})')

    # æ¤œå‡ºå™¨ç¯„å›²ã‚’ç¤ºã™å¸¯
    ax1.axvspan(0, 10, alpha=0.2, color='cyan', label='BF (0-10 mrad)')
    ax1.axvspan(10, 50, alpha=0.2, color='lightgreen', label='ABF (10-50 mrad)')
    ax1.axvspan(50, 100, alpha=0.2, color='yellow', label='ADF (50-100 mrad)')
    ax1.axvspan(100, 200, alpha=0.2, color='pink', label='HAADF (>100 mrad)')

    ax1.set_xlabel('Scattering Angle [mrad]', fontsize=12)
    ax1.set_ylabel('Scattering Intensity [a.u.]', fontsize=12)
    ax1.set_title('STEM Detector Ranges and Scattering Intensity\n(Z-dependence)', fontsize=14, fontweight='bold')
    ax1.set_yscale('log')
    ax1.legend(fontsize=10, loc='upper right')
    ax1.grid(alpha=0.3)
    ax1.set_xlim(0, 200)

    # ä¸‹å›³ï¼šå„æ¤œå‡ºå™¨ã§ã®ç©åˆ†å¼·åº¦ï¼ˆZä¾å­˜æ€§ï¼‰
    Z_range = np.arange(1, 80)
    detector_ranges = {
        'BF': (0, 10),
        'ABF': (10, 50),
        'ADF': (50, 100),
        'HAADF': (100, 200)
    }

    for det_name, (theta_min, theta_max) in detector_ranges.items():
        intensities = []
        for Z in Z_range:
            theta_range = np.linspace(theta_min*1e-3, theta_max*1e-3, 100)
            sigma = rutherford_scattering_cross_section(Z, theta_range)
            # ç©åˆ†ï¼ˆå°å½¢å‰‡ï¼‰
            intensity = np.trapz(sigma, theta_range)
            intensities.append(intensity)

        ax2.plot(Z_range, intensities, linewidth=2, marker='o', markersize=3, label=det_name)

    ax2.set_xlabel('Atomic Number Z', fontsize=12)
    ax2.set_ylabel('Integrated Signal Intensity [a.u.]', fontsize=12)
    ax2.set_title('Z-Dependence of STEM Detector Signals', fontsize=14, fontweight='bold')
    ax2.set_yscale('log')
    ax2.legend(fontsize=11)
    ax2.grid(alpha=0.3)
    ax2.set_xlim(1, 79)

    plt.tight_layout()
    plt.show()

    print("HAADFä¿¡å·ã¯Z^2ã«è¿‘ã„ä¾å­˜æ€§ï¼ˆZ-contrastï¼‰")
    print("ä½è§’åº¦æ¤œå‡ºå™¨ï¼ˆBF, ABFï¼‰ã¯ä½ç›¸ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæˆåˆ†ã‚‚å«ã‚€")

# å®Ÿè¡Œ
plot_stem_detector_signals()
</code></pre>

        <p><strong>è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆ</strong>ï¼š</p>
        <ul>
            <li>HAADFä¿¡å·ã¯é«˜è§’æ•£ä¹±ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã€é‡å…ƒç´ ï¼ˆé«˜Zï¼‰ã§å¼·ã„ä¿¡å·ãŒå¾—ã‚‰ã‚Œã‚‹</li>
            <li>Z-contrastã®èµ·æºã¯ã€ãƒ©ã‚¶ãƒ•ã‚©ãƒ¼ãƒ‰æ•£ä¹±æ–­é¢ç©ã® $Z^2$ ä¾å­˜æ€§</li>
            <li>ABFã¯ä¸­è§’é ˜åŸŸã§è»½å…ƒç´ ã¨é‡å…ƒç´ ã®æ•£ä¹±å¼·åº¦å·®ãŒç›¸å¯¾çš„ã«å°ã•ãã€è»½å…ƒç´ è¦³å¯Ÿã«æœ‰åˆ©</li>
        </ul>

        <h2>4.2 Z-contraståƒï¼ˆHAADF-STEMï¼‰</h2>

        <h3>4.2.1 Z-contraståƒã®åŸç†</h3>
        <p>HAADF-STEMåƒã¯ã€é«˜è§’æ•£ä¹±é›»å­ï¼ˆé€šå¸¸>50 mradï¼‰ã‚’ç’°çŠ¶æ¤œå‡ºå™¨ã§æ¤œå‡ºã—ã¾ã™ã€‚ã“ã®æ•£ä¹±ã¯ä¸»ã«<strong>ç†±æ‹¡æ•£æ•£ä¹±ï¼ˆTDS: Thermal Diffuse Scatteringï¼‰</strong>ã¨éå¼¾æ€§æ•£ä¹±ã§ã€ä»¥ä¸‹ã®ç‰¹å¾´ã‚’æŒã¡ã¾ã™ï¼š</p>

        <ul>
            <li><strong>éå¹²æ¸‰æ€§çµåƒ</strong>ï¼šä½ç›¸ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãŒãªãã€åƒã®è§£é‡ˆãŒç›´æ„Ÿçš„</li>
            <li><strong>Z^2ä¾å­˜æ€§</strong>ï¼šæ•£ä¹±å¼·åº¦ãŒåŸå­ç•ªå·ã®2ä¹—ã«è¿‘ã„ä¾å­˜æ€§ã‚’æŒã¤ï¼ˆZ-contrastï¼‰</li>
            <li><strong>åšã•ä¾å­˜æ€§</strong>ï¼šè©¦æ–™åšã•ã«æ¯”ä¾‹ã—ã¦ä¿¡å·ãŒå¢—åŠ </li>
            <li><strong>ãƒ‡ãƒ•ã‚©ãƒ¼ã‚«ã‚¹éä¾å­˜</strong>ï¼šCTFã®å½±éŸ¿ã‚’å—ã‘ãªã„ï¼ˆåå·®è£œæ­£ãªã—ã§ã‚‚è§£é‡ˆãŒå®¹æ˜“ï¼‰</li>
        </ul>

        <p>HAADFä¿¡å·å¼·åº¦ã¯æ¬¡å¼ã§è¿‘ä¼¼ã•ã‚Œã¾ã™ï¼š</p>

        $$
        I_{\text{HAADF}} \propto Z^{1.7-2.0} \cdot t
        $$

        <p>ã“ã“ã§ã€$Z$ ã¯åŸå­ç•ªå·ã€$t$ ã¯è©¦æ–™åšã•ã§ã™ã€‚</p>

        <h3>4.2.2 åŸå­åˆ†è§£èƒ½Z-contraståƒ</h3>
        <p>åå·®è£œæ­£STEMã«ã‚ˆã‚Šã€ãƒ—ãƒ­ãƒ¼ãƒ–ã‚µã‚¤ã‚ºã‚’1 Ã…ä»¥ä¸‹ã«ã™ã‚‹ã“ã¨ã§ã€<strong>åŸå­ã‚«ãƒ©ãƒ </strong>ï¼ˆåŸå­åˆ—ï¼‰ã‚’ç›´æ¥è¦³å¯Ÿã§ãã¾ã™ã€‚</p>

        <p><strong>å¿œç”¨ä¾‹</strong>ï¼š</p>
        <ul>
            <li>ç•Œé¢ã®åŸå­é…åˆ—è§£æï¼ˆåŠå°ä½“ãƒ˜ãƒ†ãƒ­æ§‹é€ ã€é‡‘å±/ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹æ¥åˆï¼‰</li>
            <li>ãƒ‰ãƒ¼ãƒ‘ãƒ³ãƒˆåŸå­ã®ä½ç½®åŒå®šï¼ˆåŠå°ä½“ãƒ‡ãƒã‚¤ã‚¹ï¼‰</li>
            <li>ãƒŠãƒç²’å­ã®è¡¨é¢åŸå­æ§‹é€ ï¼ˆè§¦åª’ï¼‰</li>
            <li>çµæ™¶ç²’ç•Œã®åŸå­ãƒ¬ãƒ™ãƒ«è§£æ</li>
        </ul>

        <h4>ã‚³ãƒ¼ãƒ‰ä¾‹4-2: Z-contraståƒã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåŸå­ã‚«ãƒ©ãƒ å¼·åº¦ï¼‰</h4>
        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.ndimage import gaussian_filter

def simulate_haadf_image(lattice_a=4.0, Z_matrix=13, Z_dopant=79, dopant_positions=None, size=256, pixel_size=0.1):
    """
    HAADF-STEMåƒã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆç°¡ç•¥ãƒ¢ãƒ‡ãƒ«ï¼‰

    Parameters
    ----------
    lattice_a : float
        æ ¼å­å®šæ•° [Ã…]
    Z_matrix : int
        æ¯ç›¸ã®åŸå­ç•ªå·
    Z_dopant : int
        ãƒ‰ãƒ¼ãƒ‘ãƒ³ãƒˆã®åŸå­ç•ªå·
    dopant_positions : list of tuples
        ãƒ‰ãƒ¼ãƒ‘ãƒ³ãƒˆä½ç½® [(x, y), ...]ï¼ˆæ ¼å­å˜ä½ï¼‰
    size : int
        ç”»åƒã‚µã‚¤ã‚º [pixels]
    pixel_size : float
        ãƒ”ã‚¯ã‚»ãƒ«ã‚µã‚¤ã‚º [Ã…/pixel]

    Returns
    -------
    image : ndarray
        HAADFåƒ
    """
    image = np.zeros((size, size))

    # æ ¼å­ç‚¹ã‚’ç”Ÿæˆï¼ˆæ­£æ–¹æ ¼å­ï¼‰
    grid_points_per_side = int(size * pixel_size / lattice_a)

    for i in range(grid_points_per_side):
        for j in range(grid_points_per_side):
            x_grid = i * lattice_a / pixel_size
            y_grid = j * lattice_a / pixel_size

            # åŸå­ã‚«ãƒ©ãƒ ã®ä½ç½®ï¼ˆãƒ”ã‚¯ã‚»ãƒ«å˜ä½ï¼‰
            x_px = int(x_grid)
            y_px = int(y_grid)

            if x_px < size and y_px < size:
                # åŸå­ç•ªå·ã®æ±ºå®šï¼ˆãƒ‰ãƒ¼ãƒ‘ãƒ³ãƒˆã‹æ¯ç›¸ã‹ï¼‰
                Z = Z_matrix
                if dopant_positions is not None:
                    for (dx, dy) in dopant_positions:
                        if abs(i - dx) < 0.5 and abs(j - dy) < 0.5:
                            Z = Z_dopant
                            break

                # HAADFä¿¡å·å¼·åº¦ âˆ Z^1.7
                intensity = Z**1.7

                # ãƒ—ãƒ­ãƒ¼ãƒ–å½¢çŠ¶ï¼ˆã‚¬ã‚¦ã‚·ã‚¢ãƒ³ï¼‰ã§åŸå­ã‚«ãƒ©ãƒ ã‚’è¡¨ç¾
                probe_sigma = 0.5  # [pixels]ï¼ˆãƒ—ãƒ­ãƒ¼ãƒ–ã‚µã‚¤ã‚ºï½1 Ã…ï¼‰

                # ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ã‚’ç”»åƒã«è¿½åŠ 
                for dx in range(-3, 4):
                    for dy in range(-3, 4):
                        px = x_px + dx
                        py = y_px + dy
                        if 0 <= px < size and 0 <= py < size:
                            r = np.sqrt(dx**2 + dy**2)
                            image[py, px] += intensity * np.exp(-r**2 / (2 * probe_sigma**2))

    # ãƒã‚¤ã‚ºè¿½åŠ 
    image += np.random.poisson(lam=10, size=image.shape)

    # æ­£è¦åŒ–
    image = (image - image.min()) / (image.max() - image.min())

    return image

# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
# Alæ¯ç›¸ï¼ˆZ=13ï¼‰ã«Auãƒ‰ãƒ¼ãƒ‘ãƒ³ãƒˆï¼ˆZ=79ï¼‰ã‚’é…ç½®
dopant_positions = [(10, 10), (15, 15), (20, 12), (12, 20)]

image = simulate_haadf_image(lattice_a=4.0, Z_matrix=13, Z_dopant=79,
                              dopant_positions=dopant_positions, size=256, pixel_size=0.2)

# å¯è¦–åŒ–
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))

# HAADFåƒï¼ˆå…¨ä½“ï¼‰
im1 = ax1.imshow(image, cmap='gray', extent=[0, 256*0.2, 0, 256*0.2])
ax1.set_title('HAADF-STEM Image\n(Al matrix + Au dopants)', fontsize=13, fontweight='bold')
ax1.set_xlabel('x [Ã…]', fontsize=11)
ax1.set_ylabel('y [Ã…]', fontsize=11)
cbar1 = plt.colorbar(im1, ax=ax1)
cbar1.set_label('Intensity [a.u.]', fontsize=10)

# æ‹¡å¤§å›³ï¼ˆãƒ‰ãƒ¼ãƒ‘ãƒ³ãƒˆå‘¨è¾ºï¼‰
zoom_center = (10, 10)
zoom_size = 30
zoomed = image[zoom_center[1]*5-zoom_size:zoom_center[1]*5+zoom_size,
               zoom_center[0]*5-zoom_size:zoom_center[0]*5+zoom_size]

im2 = ax2.imshow(zoomed, cmap='gray', extent=[0, zoom_size*2*0.2, 0, zoom_size*2*0.2])
ax2.set_title('Zoomed View\n(Bright spot = Au dopant)', fontsize=13, fontweight='bold')
ax2.set_xlabel('x [Ã…]', fontsize=11)
ax2.set_ylabel('y [Ã…]', fontsize=11)
cbar2 = plt.colorbar(im2, ax=ax2)
cbar2.set_label('Intensity [a.u.]', fontsize=10)

plt.tight_layout()
plt.show()

print("Z-contrast: Au (Z=79) ã®åŸå­ã‚«ãƒ©ãƒ ãŒAl (Z=13) ã‚ˆã‚Šæ˜ã‚‹ãè¦‹ãˆã‚‹")
print("å¼·åº¦æ¯”: I(Au)/I(Al) â‰ˆ (79/13)^1.7 â‰ˆ 18å€")
</code></pre>

        <h2>4.3 ç’°çŠ¶æ˜è¦–é‡ï¼ˆABFï¼‰åƒã¨è»½å…ƒç´ è¦³å¯Ÿ</h2>

        <h3>4.3.1 ABFåƒã®åŸç†</h3>
        <p>ç’°çŠ¶æ˜è¦–é‡ï¼ˆAnnular Bright Field, ABFï¼‰åƒã¯ã€ä¸­å¿ƒéƒ¨ã‚’é®è”½ã—ãŸç’°çŠ¶æ¤œå‡ºå™¨ã§ä½ã€œä¸­è§’æ•£ä¹±é›»å­ï¼ˆ10-50 mradï¼‰ã‚’æ¤œå‡ºã—ã¾ã™ã€‚</p>

        <p><strong>ABFã®ç‰¹å¾´</strong>ï¼š</p>
        <ul>
            <li>è»½å…ƒç´ ï¼ˆLi, H, O, Nï¼‰ã®åŸå­ã‚«ãƒ©ãƒ ãŒ<strong>æš—ã„ã‚¹ãƒãƒƒãƒˆ</strong>ã¨ã—ã¦è¦³å¯Ÿã•ã‚Œã‚‹</li>
            <li>HAA DFã§ã¯è¦‹ãˆãªã„è»½å…ƒç´ ã‚’ã€é‡å…ƒç´ ã¨åŒæ™‚ã«è¦³å¯Ÿå¯èƒ½</li>
            <li>ä½ç›¸ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã¨éå¹²æ¸‰æ€§ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã®æ··åˆ</li>
            <li>ãƒ‡ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ä¾å­˜æ€§ãŒæ¯”è¼ƒçš„å°ã•ã„</li>
        </ul>

        <p><strong>å¿œç”¨ä¾‹</strong>ï¼š</p>
        <ul>
            <li>é…¸åŒ–ç‰©ä¸­ã®é…¸ç´ åŸå­ä½ç½®ã®æ±ºå®šï¼ˆãƒšãƒ­ãƒ–ã‚¹ã‚«ã‚¤ãƒˆã€ã‚¹ãƒ”ãƒãƒ«æ§‹é€ ï¼‰</li>
            <li>ãƒªãƒã‚¦ãƒ ã‚¤ã‚ªãƒ³é›»æ± ææ–™ã®Liåˆ†å¸ƒ</li>
            <li>çª’åŒ–ç‰©åŠå°ä½“ã®NåŸå­è¦³å¯Ÿ</li>
            <li>æ°´ç´ è²¯è”µææ–™ã®HåŸå­é…ç½®</li>
        </ul>

        <h4>ã‚³ãƒ¼ãƒ‰ä¾‹4-3: ABFåƒã¨HAADFåƒã®åŒæ™‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h4>
        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

def simulate_abf_haadf_comparison():
    """
    ABFåƒã¨HAADFåƒã®åŒæ™‚è¦³å¯Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    ãƒšãƒ­ãƒ–ã‚¹ã‚«ã‚¤ãƒˆæ§‹é€ ï¼ˆé‡é‡‘å± + é…¸ç´ ï¼‰ã‚’æƒ³å®š
    """
    size = 128
    pixel_size = 0.1  # [Ã…/pixel]
    lattice_a = 4.0  # [Ã…]

    image_haadf = np.zeros((size, size))
    image_abf = np.ones((size, size)) * 0.5  # ABFã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãŒä¸­é–“å€¤

    # ãƒšãƒ­ãƒ–ã‚¹ã‚«ã‚¤ãƒˆæ§‹é€ ã®ç°¡ç•¥ãƒ¢ãƒ‡ãƒ«
    # é‡é‡‘å±ï¼ˆSr, Ba, Pb ãªã© Z~80ï¼‰ï¼šã‚³ãƒ¼ãƒŠãƒ¼ã¨ãƒœãƒ‡ã‚£ã‚»ãƒ³ã‚¿ãƒ¼
    # é…¸ç´ ï¼ˆZ=8ï¼‰ï¼šface-centered

    grid_size = int(size * pixel_size / lattice_a)

    for i in range(grid_size):
        for j in range(grid_size):
            # é‡é‡‘å±ã‚µã‚¤ãƒˆï¼ˆã‚³ãƒ¼ãƒŠãƒ¼ï¼‰
            x_heavy = i * lattice_a / pixel_size
            y_heavy = j * lattice_a / pixel_size

            # é…¸ç´ ã‚µã‚¤ãƒˆï¼ˆface-centeredï¼‰
            oxygen_sites = [
                (x_heavy + lattice_a/(2*pixel_size), y_heavy),
                (x_heavy, y_heavy + lattice_a/(2*pixel_size))
            ]

            # é‡é‡‘å±ã‚’ãƒ—ãƒ­ãƒƒãƒˆï¼ˆHAADF: æ˜ã‚‹ã„ã€ABF: æš—ã„ï¼‰
            add_atom_column(image_haadf, x_heavy, y_heavy, Z=80, detector='HAADF')
            add_atom_column(image_abf, x_heavy, y_heavy, Z=80, detector='ABF')

            # é…¸ç´ ã‚’ãƒ—ãƒ­ãƒƒãƒˆï¼ˆHAADF: ã»ã¼è¦‹ãˆãªã„ã€ABF: æš—ã„ã‚¹ãƒãƒƒãƒˆï¼‰
            for (ox, oy) in oxygen_sites:
                if ox < size and oy < size:
                    add_atom_column(image_haadf, ox, oy, Z=8, detector='HAADF')
                    add_atom_column(image_abf, ox, oy, Z=8, detector='ABF')

    # ãƒã‚¤ã‚ºè¿½åŠ 
    image_haadf += np.random.normal(0, 0.02, image_haadf.shape)
    image_abf += np.random.normal(0, 0.02, image_abf.shape)

    # æ­£è¦åŒ–
    image_haadf = np.clip(image_haadf, 0, 1)
    image_abf = np.clip(image_abf, 0, 1)

    # å¯è¦–åŒ–
    fig, axes = plt.subplots(1, 3, figsize=(17, 5))

    # HAADFåƒ
    im0 = axes[0].imshow(image_haadf, cmap='gray', extent=[0, size*pixel_size, 0, size*pixel_size])
    axes[0].set_title('HAADF-STEM Image\n(Heavy atoms bright)', fontsize=13, fontweight='bold')
    axes[0].set_xlabel('x [Ã…]', fontsize=11)
    axes[0].set_ylabel('y [Ã…]', fontsize=11)

    # ABFåƒ
    im1 = axes[1].imshow(image_abf, cmap='gray', extent=[0, size*pixel_size, 0, size*pixel_size])
    axes[1].set_title('ABF-STEM Image\n(Both heavy and light atoms dark)', fontsize=13, fontweight='bold')
    axes[1].set_xlabel('x [Ã…]', fontsize=11)
    axes[1].set_ylabel('y [Ã…]', fontsize=11)

    # ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆã‚«ãƒ©ãƒ¼åˆæˆï¼‰
    # HAADFï¼ˆèµ¤ï¼‰+ ABFåè»¢ï¼ˆç·‘ï¼‰
    overlay = np.zeros((size, size, 3))
    overlay[:, :, 0] = image_haadf  # Red: HAADF
    overlay[:, :, 1] = 1 - image_abf  # Green: ABF inverted
    overlay[:, :, 2] = 0

    im2 = axes[2].imshow(overlay, extent=[0, size*pixel_size, 0, size*pixel_size])
    axes[2].set_title('Overlay: HAADF (Red) + ABF (Green)\n(Yellow = both present)', fontsize=13, fontweight='bold')
    axes[2].set_xlabel('x [Ã…]', fontsize=11)
    axes[2].set_ylabel('y [Ã…]', fontsize=11)

    plt.tight_layout()
    plt.show()

    print("HAADF: é‡å…ƒç´ ã®ã¿æ˜ã‚‹ãè¦‹ãˆã‚‹")
    print("ABF: é‡å…ƒç´ ã‚‚è»½å…ƒç´ ï¼ˆé…¸ç´ ï¼‰ã‚‚æš—ã„ã‚¹ãƒãƒƒãƒˆã¨ã—ã¦è¦³å¯Ÿã•ã‚Œã‚‹")

def add_atom_column(image, x, y, Z, detector='HAADF'):
    """
    åŸå­ã‚«ãƒ©ãƒ ã‚’ç”»åƒã«è¿½åŠ 

    Parameters
    ----------
    image : ndarray
        ç”»åƒé…åˆ—
    x, y : float
        åŸå­ä½ç½® [pixels]
    Z : int
        åŸå­ç•ªå·
    detector : str
        'HAADF' or 'ABF'
    """
    size = image.shape[0]
    x_int = int(x)
    y_int = int(y)

    if detector == 'HAADF':
        # HAADF: Z^1.7ã«æ¯”ä¾‹
        intensity = (Z / 80.0)**1.7 * 0.8
        sign = +1
    else:  # ABF
        # ABF: åŸå­ä½ç½®ã§æš—ããªã‚‹ï¼ˆè² ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼‰
        intensity = (Z / 80.0)**0.5 * 0.3
        sign = -1

    probe_sigma = 0.5

    for dx in range(-3, 4):
        for dy in range(-3, 4):
            px = x_int + dx
            py = y_int + dy
            if 0 <= px < size and 0 <= py < size:
                r = np.sqrt((px - x)**2 + (py - y)**2)
                image[py, px] += sign * intensity * np.exp(-r**2 / (2 * probe_sigma**2))

# å®Ÿè¡Œ
simulate_abf_haadf_comparison()
</code></pre>

        <h2>4.4 é›»å­ã‚¨ãƒãƒ«ã‚®ãƒ¼æå¤±åˆ†å…‰ï¼ˆEELSï¼‰</h2>

        <h3>4.4.1 EELSåŸç†</h3>
        <p>é›»å­ã‚¨ãƒãƒ«ã‚®ãƒ¼æå¤±åˆ†å…‰ï¼ˆElectron Energy Loss Spectroscopy, EELSï¼‰ã¯ã€è©¦æ–™ã‚’é€éã—ãŸé›»å­ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼æå¤±ã‚’æ¸¬å®šã—ã€å…ƒç´ çµ„æˆã€åŒ–å­¦çµåˆçŠ¶æ…‹ã€ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã‚’è§£æã™ã‚‹æ‰‹æ³•ã§ã™ã€‚</p>

        <p><strong>EELSã‚¹ãƒšã‚¯ãƒˆãƒ«ã®æ§‹æˆ</strong>ï¼š</p>
        <ul>
            <li><strong>ã‚¼ãƒ­ãƒ­ã‚¹ãƒ”ãƒ¼ã‚¯</strong>ï¼ˆ0 eVï¼‰ï¼šå¼¾æ€§æ•£ä¹±é›»å­ï¼ˆã‚¨ãƒãƒ«ã‚®ãƒ¼æå¤±ãªã—ï¼‰</li>
            <li><strong>ä½æå¤±é ˜åŸŸ</strong>ï¼ˆ0-50 eVï¼‰ï¼šãƒ—ãƒ©ã‚ºãƒ¢ãƒ³åŠ±èµ·ã€ãƒãƒ³ãƒ‰é–“é·ç§»</li>
            <li><strong>ã‚³ã‚¢ãƒ­ã‚¹é ˜åŸŸ</strong>ï¼ˆ>50 eVï¼‰ï¼šå†…æ®»é›»å­åŠ±èµ·ã€‚å…ƒç´ å›ºæœ‰ã®ã‚¨ãƒƒã‚¸ï¼ˆK, L, Mæ®»ï¼‰</li>
        </ul>

        <h3>4.4.2 ã‚³ã‚¢ãƒ­ã‚¹è§£æã¨å…ƒç´ å®šé‡</h3>
        <p>ã‚³ã‚¢ãƒ­ã‚¹ã‚¨ãƒƒã‚¸ã®ç©åˆ†å¼·åº¦ã‹ã‚‰å…ƒç´ æ¿ƒåº¦ã‚’å®šé‡ã§ãã¾ã™ï¼š</p>

        $$
        \frac{N_A}{N_B} = \frac{I_A(\Delta, \beta)}{I_B(\Delta, \beta)} \cdot \frac{\sigma_B(\Delta, \beta)}{\sigma_A(\Delta, \beta)}
        $$

        <ul>
            <li>$N_A, N_B$ï¼šå…ƒç´ Aã¨Bã®åŸå­æ•°å¯†åº¦</li>
            <li>$I_A, I_B$ï¼šã‚¨ãƒƒã‚¸ç©åˆ†å¼·åº¦</li>
            <li>$\sigma_A, \sigma_B$ï¼šéƒ¨åˆ†ã‚¤ã‚ªãƒ³åŒ–æ–­é¢ç©ï¼ˆç†è«–å€¤ã¾ãŸã¯Hartree-Slaterè¨ˆç®—ï¼‰</li>
            <li>$\Delta$ï¼šç©åˆ†çª“å¹…ã€$\beta$ï¼šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³åŠè§’</li>
        </ul>

        <p><strong>EELSå®šé‡è§£æã®æ‰‹é †</strong>ï¼š</p>
        <ol>
            <li><strong>ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é™¤å»</strong>ï¼šã‚¨ãƒƒã‚¸å‰é ˜åŸŸã‚’ã¹ãä¹—å‰‡ã§ãƒ•ã‚£ãƒƒãƒˆï¼ˆ$AE^{-r}$ï¼‰</li>
            <li><strong>ç©åˆ†å¼·åº¦è¨ˆç®—</strong>ï¼šã‚¨ãƒƒã‚¸ã‹ã‚‰ä¸€å®šã‚¨ãƒãƒ«ã‚®ãƒ¼ç¯„å›²ï¼ˆé€šå¸¸50-100 eVï¼‰ã‚’ç©åˆ†</li>
            <li><strong>æ–­é¢ç©è£œæ­£</strong>ï¼šHyperSpyãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§è‡ªå‹•è¨ˆç®—</li>
            <li><strong>æ¿ƒåº¦ç®—å‡º</strong>ï¼šä¸Šå¼ã§å…ƒç´ æ¯”ã‚’è¨ˆç®—</li>
        </ol>

        <h4>ã‚³ãƒ¼ãƒ‰ä¾‹4-4: EELSã‚¹ãƒšã‚¯ãƒˆãƒ«ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨å®šé‡è§£æ</h4>
        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.signal import find_peaks

def simulate_eels_spectrum(elements=['C', 'O', 'Fe'], concentrations=[0.3, 0.5, 0.2],
                            energy_range=(200, 800), noise_level=0.05):
    """
    EELSã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ

    Parameters
    ----------
    elements : list
        å…ƒç´ ãƒªã‚¹ãƒˆ
    concentrations : list
        å„å…ƒç´ ã®ç›¸å¯¾æ¿ƒåº¦
    energy_range : tuple
        ã‚¨ãƒãƒ«ã‚®ãƒ¼ç¯„å›² [eV]
    noise_level : float
        ãƒã‚¤ã‚ºãƒ¬ãƒ™ãƒ«

    Returns
    -------
    energy : ndarray
        ã‚¨ãƒãƒ«ã‚®ãƒ¼è»¸ [eV]
    spectrum : ndarray
        å¼·åº¦
    """
    energy = np.linspace(energy_range[0], energy_range[1], 1000)

    # å…¸å‹çš„ãªã‚³ã‚¢ãƒ­ã‚¹ã‚¨ãƒƒã‚¸ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆç°¡ç•¥ç‰ˆï¼‰
    edge_energies = {
        'C': 284,   # C-K
        'N': 401,   # N-K
        'O': 532,   # O-K
        'Fe': 708,  # Fe-L3
        'Al': 1560, # Al-K
        'Si': 1839  # Si-K
    }

    # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ˆã¹ãä¹—å‰‡ï¼‰
    background = 1000 * (energy / energy[0])**(-3)

    spectrum = background.copy()

    # å„å…ƒç´ ã®ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ 
    for elem, conc in zip(elements, concentrations):
        if elem in edge_energies:
            edge_E = edge_energies[elem]
            if energy_range[0] < edge_E < energy_range[1]:
                # ã‚¨ãƒƒã‚¸ã‚¸ãƒ£ãƒ³ãƒ—ï¼ˆã‚¹ãƒ†ãƒƒãƒ—é–¢æ•° + æ¸›è¡°ï¼‰
                edge_mask = energy >= edge_E
                edge_intensity = conc * 300 * np.exp(-(energy[edge_mask] - edge_E) / 100)
                spectrum[edge_mask] += edge_intensity

    # ãƒã‚¤ã‚ºè¿½åŠ ï¼ˆãƒã‚¢ã‚½ãƒ³ãƒã‚¤ã‚ºï¼‰
    spectrum += np.random.poisson(lam=noise_level*spectrum.mean(), size=spectrum.shape)

    return energy, spectrum

def quantify_eels_edges(energy, spectrum, edges_dict):
    """
    EELSã‚¹ãƒšã‚¯ãƒˆãƒ«ã‹ã‚‰å…ƒç´ ã‚’å®šé‡

    Parameters
    ----------
    energy : ndarray
        ã‚¨ãƒãƒ«ã‚®ãƒ¼è»¸ [eV]
    spectrum : ndarray
        å¼·åº¦
    edges_dict : dict
        {'Element': edge_energy}

    Returns
    -------
    results : dict
        {'Element': integrated_intensity}
    """
    results = {}

    for elem, edge_E in edges_dict.items():
        # ã‚¨ãƒƒã‚¸å‰é ˜åŸŸï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ•ã‚£ãƒƒãƒˆï¼‰
        pre_edge_mask = (energy >= edge_E - 50) & (energy < edge_E)
        if np.sum(pre_edge_mask) < 10:
            continue

        # ã¹ãä¹—å‰‡ãƒ•ã‚£ãƒƒãƒˆ A * E^(-r)
        E_pre = energy[pre_edge_mask]
        I_pre = spectrum[pre_edge_mask]

        # å¯¾æ•°å¤‰æ›ã—ã¦ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆ
        log_E = np.log(E_pre)
        log_I = np.log(I_pre + 1)  # ã‚¼ãƒ­é™¤ç®—å›é¿

        coeffs = np.polyfit(log_E, log_I, 1)
        r = -coeffs[0]
        A = np.exp(coeffs[1])

        # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é™¤å»
        background = A * energy**(-r)
        spectrum_bg_removed = spectrum - background
        spectrum_bg_removed = np.maximum(spectrum_bg_removed, 0)

        # ã‚¨ãƒƒã‚¸å¾Œé ˜åŸŸã®ç©åˆ†ï¼ˆ50 eVçª“ï¼‰
        post_edge_mask = (energy >= edge_E) & (energy < edge_E + 50)
        integrated_intensity = np.trapz(spectrum_bg_removed[post_edge_mask],
                                        energy[post_edge_mask])

        results[elem] = integrated_intensity

    return results

# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
elements = ['C', 'O', 'Fe']
concentrations = [0.3, 0.5, 0.2]

energy, spectrum = simulate_eels_spectrum(elements, concentrations,
                                          energy_range=(200, 800), noise_level=0.05)

# å¯è¦–åŒ–
fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 10))

# ä¸Šå›³ï¼šç”Ÿã‚¹ãƒšã‚¯ãƒˆãƒ«
ax1.plot(energy, spectrum, 'b-', linewidth=1.5, label='Measured Spectrum')

# ã‚¨ãƒƒã‚¸ä½ç½®ã‚’ç¤ºã™
edge_energies = {'C': 284, 'O': 532, 'Fe': 708}
colors_edge = {'C': 'green', 'O': 'red', 'Fe': 'orange'}

for elem, edge_E in edge_energies.items():
    if 200 < edge_E < 800:
        ax1.axvline(edge_E, color=colors_edge[elem], linestyle='--', linewidth=2, alpha=0.7,
                   label=f'{elem}-K edge ({edge_E} eV)')

ax1.set_xlabel('Energy Loss [eV]', fontsize=12)
ax1.set_ylabel('Intensity [counts]', fontsize=12)
ax1.set_title('Simulated EELS Spectrum (C, O, Fe)', fontsize=14, fontweight='bold')
ax1.set_yscale('log')
ax1.legend(fontsize=10)
ax1.grid(alpha=0.3)

# ä¸‹å›³ï¼šå®šé‡è§£æçµæœ
quantified = quantify_eels_edges(energy, spectrum, edge_energies)

elem_list = list(quantified.keys())
intensities = list(quantified.values())

# ç›¸å¯¾æ¿ƒåº¦ã«æ­£è¦åŒ–
total = sum(intensities)
relative_conc = [I / total for I in intensities]

x_pos = np.arange(len(elem_list))
bars = ax2.bar(x_pos, relative_conc, color=['green', 'red', 'orange'], alpha=0.7, edgecolor='black')

# çœŸã®æ¿ƒåº¦ï¼ˆå…¥åŠ›å€¤ï¼‰ã‚’ãƒ—ãƒ­ãƒƒãƒˆ
true_conc = concentrations
ax2.scatter(x_pos, true_conc, color='blue', s=150, marker='D', label='True Concentration', zorder=5)

ax2.set_xlabel('Element', fontsize=12)
ax2.set_ylabel('Relative Concentration', fontsize=12)
ax2.set_title('EELS Quantification Results', fontsize=14, fontweight='bold')
ax2.set_xticks(x_pos)
ax2.set_xticklabels(elem_list, fontsize=11)
ax2.legend(fontsize=11)
ax2.grid(alpha=0.3, axis='y')

plt.tight_layout()
plt.show()

print("\nå®šé‡çµæœ:")
for elem, conc in zip(elem_list, relative_conc):
    print(f"  {elem}: {conc:.2f}")
</code></pre>

        <h3>4.4.3 ELNESï¼ˆã‚¨ãƒãƒ«ã‚®ãƒ¼æå¤±è¿‘ç«¯æ§‹é€ ï¼‰</h3>
        <p>ã‚¨ãƒƒã‚¸ç›´å¾Œã®å¾®ç´°æ§‹é€ ï¼ˆEnergy Loss Near Edge Structure, ELNESï¼‰ã¯ã€åŒ–å­¦çµåˆçŠ¶æ…‹ã‚„å±€æ‰€åŸå­é…åˆ—ã‚’åæ˜ ã—ã¾ã™ã€‚</p>

        <p><strong>ELNESè§£æã®å¿œç”¨</strong>ï¼š</p>
        <ul>
            <li>é…¸åŒ–æ•°ã®æ±ºå®šï¼ˆFe<sup>2+</sup> vs Fe<sup>3+</sup>ã®L<sub>3</sub>/L<sub>2</sub>æ¯”ï¼‰</li>
            <li>é…ä½æ•°ã®æ¨å®šï¼ˆOã®1sâ†’2pé·ç§»ã®å½¢çŠ¶ï¼‰</li>
            <li>çµæ™¶å ´åˆ†è£‚ã®è¦³å¯Ÿï¼ˆé·ç§»é‡‘å±é…¸åŒ–ç‰©ï¼‰</li>
            <li>ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã®æ¸¬å®šï¼ˆåŠå°ä½“ææ–™ï¼‰</li>
        </ul>

        <h2>4.5 STEMå…ƒç´ ãƒãƒƒãƒ”ãƒ³ã‚°</h2>

        <h3>4.5.1 EELS/EDSãƒãƒƒãƒ”ãƒ³ã‚°ã®åŸç†</h3>
        <p>STEMãƒ¢ãƒ¼ãƒ‰ã§ãƒ“ãƒ¼ãƒ ã‚’èµ°æŸ»ã—ãªãŒã‚‰ã€å„ç‚¹ã§EELSã¾ãŸã¯EDSã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ã€<strong>2Då…ƒç´ åˆ†å¸ƒãƒãƒƒãƒ—</strong>ã‚’ä½œæˆã§ãã¾ã™ã€‚</p>

        <p><strong>EELSãƒãƒƒãƒ”ãƒ³ã‚°</strong>ï¼š</p>
        <ul>
            <li><strong>åˆ©ç‚¹</strong>ï¼šç©ºé–“åˆ†è§£èƒ½ãŒé«˜ã„ï¼ˆãƒ—ãƒ­ãƒ¼ãƒ–ã‚µã‚¤ã‚ºåˆ¶é™ï¼‰ã€è»½å…ƒç´ ã«æ„Ÿåº¦ãŒé«˜ã„ã€åŒ–å­¦çŠ¶æ…‹ã‚‚åŒæ™‚å–å¾—</li>
            <li><strong>æ¬ ç‚¹</strong>ï¼šè–„ã„è©¦æ–™ãŒå¿…è¦ï¼ˆ<100 nmï¼‰ã€ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤§ãã„ã€æ¸¬å®šã«æ™‚é–“ãŒã‹ã‹ã‚‹</li>
        </ul>

        <p><strong>EDSãƒãƒƒãƒ”ãƒ³ã‚°</strong>ï¼š</p>
        <ul>
            <li><strong>åˆ©ç‚¹</strong>ï¼šåšã„è©¦æ–™ã§ã‚‚æ¸¬å®šå¯èƒ½ã€å¤šå…ƒç´ åŒæ™‚åˆ†æã€æ¸¬å®šãŒæ¯”è¼ƒçš„é€Ÿã„</li>
            <li><strong>æ¬ ç‚¹</strong>ï¼šç©ºé–“åˆ†è§£èƒ½ãŒã‚„ã‚„ä½ã„ï¼ˆXç·šç™ºç”Ÿä½“ç©ï¼‰ã€è»½å…ƒç´ ã®æ¤œå‡ºãŒå›°é›£</li>
        </ul>

        <h4>ã‚³ãƒ¼ãƒ‰ä¾‹4-5: STEMå…ƒç´ ãƒãƒƒãƒ”ãƒ³ã‚°ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h4>
        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.ndimage import gaussian_filter

def simulate_stem_mapping(size=128, num_particles=10):
    """
    STEMå…ƒç´ ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆ2å…ƒç³»ãƒŠãƒç²’å­ï¼‰

    Parameters
    ----------
    size : int
        ãƒãƒƒãƒ—ã‚µã‚¤ã‚º [pixels]
    num_particles : int
        ç²’å­æ•°

    Returns
    -------
    map_Fe : ndarray
        Feå…ƒç´ ãƒãƒƒãƒ—
    map_O : ndarray
        Oå…ƒç´ ãƒãƒƒãƒ—
    haadf : ndarray
        HAADFåƒ
    """
    # Fe3O4ãƒŠãƒç²’å­ã‚’ç‚­ç´ åŸºæ¿ä¸Šã«åˆ†æ•£
    map_Fe = np.zeros((size, size))
    map_O = np.zeros((size, size))
    map_C = np.ones((size, size)) * 0.3  # åŸºæ¿ã®C

    np.random.seed(42)

    for _ in range(num_particles):
        # ç²’å­ã®ä½ç½®ã¨ã‚µã‚¤ã‚º
        x_center = np.random.randint(10, size - 10)
        y_center = np.random.randint(10, size - 10)
        radius = np.random.randint(5, 15)

        # ç²’å­é ˜åŸŸã®ç”Ÿæˆ
        y, x = np.ogrid[:size, :size]
        mask = (x - x_center)**2 + (y - y_center)**2 <= radius**2

        # Fe3O4ã®åŒ–å­¦é‡è«–æ¯”ï¼ˆFe:O = 3:4ï¼‰
        map_Fe[mask] = 0.75 + np.random.normal(0, 0.05, np.sum(mask))
        map_O[mask] = 1.0 + np.random.normal(0, 0.05, np.sum(mask))
        map_C[mask] = 0  # ç²’å­å†…éƒ¨ã«ã¯Cç„¡ã—

    # ãƒ—ãƒ­ãƒ¼ãƒ–ã‚µã‚¤ã‚ºã«ã‚ˆã‚‹ã¼ã‹ã—
    map_Fe = gaussian_filter(map_Fe, sigma=1.0)
    map_O = gaussian_filter(map_O, sigma=1.0)
    map_C = gaussian_filter(map_C, sigma=1.0)

    # HAADFåƒï¼ˆZ-contrastã®è¿‘ä¼¼ï¼‰
    haadf = map_Fe * 26**1.7 + map_O * 8**1.7 + map_C * 6**1.7
    haadf = haadf / haadf.max()

    # ãƒã‚¤ã‚ºè¿½åŠ 
    map_Fe += np.random.normal(0, 0.02, map_Fe.shape)
    map_O += np.random.normal(0, 0.02, map_O.shape)
    map_C += np.random.normal(0, 0.02, map_C.shape)
    haadf += np.random.normal(0, 0.02, haadf.shape)

    # ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°
    map_Fe = np.clip(map_Fe, 0, 1)
    map_O = np.clip(map_O, 0, 1)
    map_C = np.clip(map_C, 0, 1)
    haadf = np.clip(haadf, 0, 1)

    return map_Fe, map_O, map_C, haadf

# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
map_Fe, map_O, map_C, haadf = simulate_stem_mapping(size=128, num_particles=8)

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 3, figsize=(16, 10))

# HAADFåƒ
im0 = axes[0, 0].imshow(haadf, cmap='gray')
axes[0, 0].set_title('HAADF-STEM Image', fontsize=13, fontweight='bold')
axes[0, 0].axis('off')
plt.colorbar(im0, ax=axes[0, 0], fraction=0.046)

# Fe ãƒãƒƒãƒ—
im1 = axes[0, 1].imshow(map_Fe, cmap='Reds')
axes[0, 1].set_title('Fe Elemental Map\n(EELS Fe-L edge)', fontsize=13, fontweight='bold')
axes[0, 1].axis('off')
plt.colorbar(im1, ax=axes[0, 1], fraction=0.046, label='Fe Intensity')

# O ãƒãƒƒãƒ—
im2 = axes[0, 2].imshow(map_O, cmap='Blues')
axes[0, 2].set_title('O Elemental Map\n(EELS O-K edge)', fontsize=13, fontweight='bold')
axes[0, 2].axis('off')
plt.colorbar(im2, ax=axes[0, 2], fraction=0.046, label='O Intensity')

# C ãƒãƒƒãƒ—
im3 = axes[1, 0].imshow(map_C, cmap='Greens')
axes[1, 0].set_title('C Elemental Map\n(Substrate)', fontsize=13, fontweight='bold')
axes[1, 0].axis('off')
plt.colorbar(im3, ax=axes[1, 0], fraction=0.046, label='C Intensity')

# RGBåˆæˆï¼ˆFe=Red, O=Blue, C=Greenï¼‰
rgb_composite = np.stack([map_Fe, map_C, map_O], axis=2)
rgb_composite = rgb_composite / rgb_composite.max()

im4 = axes[1, 1].imshow(rgb_composite)
axes[1, 1].set_title('RGB Composite\n(Fe:Red, O:Blue, C:Green)', fontsize=13, fontweight='bold')
axes[1, 1].axis('off')

# Fe/Oæ¯”ãƒãƒƒãƒ—ï¼ˆåŒ–å­¦é‡è«–ï¼‰
fe_o_ratio = np.divide(map_Fe, map_O + 1e-6)  # ã‚¼ãƒ­é™¤ç®—å›é¿
im5 = axes[1, 2].imshow(fe_o_ratio, cmap='RdYlGn', vmin=0.5, vmax=1.0)
axes[1, 2].set_title('Fe/O Ratio Map\n(Stoichiometry)', fontsize=13, fontweight='bold')
axes[1, 2].axis('off')
cbar5 = plt.colorbar(im5, ax=axes[1, 2], fraction=0.046)
cbar5.set_label('Fe/O', fontsize=10)

plt.tight_layout()
plt.show()

print("Fe3O4ãƒŠãƒç²’å­ã®ãƒãƒƒãƒ”ãƒ³ã‚°:")
print("  - Fe, O, C ã®åˆ†å¸ƒãŒåŒæ™‚ã«å–å¾—ã•ã‚Œã‚‹")
print("  - Fe/Oæ¯”ãƒãƒƒãƒ—ã§åŒ–å­¦é‡è«–çš„å‡ä¸€æ€§ã‚’è©•ä¾¡")
</code></pre>

        <h2>4.6 é›»å­ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼</h2>

        <h3>4.6.1 ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼ã®åŸç†</h3>
        <p>é›»å­ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼ï¼ˆElectron Tomographyï¼‰ã¯ã€è©¦æ–™ã‚’æ§˜ã€…ãªè§’åº¦ã‹ã‚‰æ’®å½±ã—ã€3æ¬¡å…ƒæ§‹é€ ã‚’å†æ§‹æˆã™ã‚‹æ‰‹æ³•ã§ã™ã€‚</p>

        <p><strong>åŸºæœ¬æ‰‹é †</strong>ï¼š</p>
        <ol>
            <li><strong>å‚¾æ–œã‚·ãƒªãƒ¼ã‚ºå–å¾—</strong>ï¼šè©¦æ–™ã‚’-70Â°ã€œ+70Â°ç¨‹åº¦å‚¾æ–œã•ã›ãªãŒã‚‰ã€1-2Â°åˆ»ã¿ã§åƒã‚’å–å¾—ï¼ˆ80-140æšï¼‰</li>
            <li><strong>åƒã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ</strong>ï¼šå„å‚¾æ–œè§’åº¦ã®åƒã‚’ä½ç½®åˆã‚ã›ï¼ˆé‡‘ãƒãƒ¼ã‚«ãƒ¼ãªã©ã‚’åˆ©ç”¨ï¼‰</li>
            <li><strong>3Då†æ§‹æˆ</strong>ï¼šæŠ•å½±å®šç†ã«åŸºã¥ãã€é€†ãƒ©ãƒ‰ãƒ³å¤‰æ›ã‚„åå¾©å†æ§‹æˆæ³•ã§3Dåƒã‚’è¨ˆç®—</li>
            <li><strong>ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³</strong>ï¼š3Dåƒã‹ã‚‰ç‰¹å®šã®æ§‹é€ ï¼ˆãƒŠãƒç²’å­ã€å­”ãªã©ï¼‰ã‚’æŠ½å‡º</li>
            <li><strong>å®šé‡è§£æ</strong>ï¼šä½“ç©ã€è¡¨é¢ç©ã€å½¢çŠ¶ã€ç©ºé–“åˆ†å¸ƒã‚’è¨ˆç®—</li>
        </ol>

        <p><strong>æŠ•å½±å®šç†ï¼ˆProjection Theoremï¼‰</strong>ï¼š</p>
        <p>3Dç‰©ä½“ $f(x, y, z)$ ã®ã‚ã‚‹æ–¹å‘ã‹ã‚‰ã®æŠ•å½± $P_\theta(x', y')$ ã®ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã¯ã€3Dãƒ•ãƒ¼ãƒªã‚¨ã‚¹ãƒšãƒ¼ã‚¹ã®ãã®æ–¹å‘ã®æ–­é¢ã«å¯¾å¿œã—ã¾ã™ã€‚</p>

        <h4>ã‚³ãƒ¼ãƒ‰ä¾‹4-6: é›»å­ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼ã®æŠ•å½±ã¨å†æ§‹æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2Dï¼‰</h4>
        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from skimage.transform import radon, iradon
from scipy.ndimage import rotate

def create_test_object_2d(size=128):
    """
    2Dãƒ†ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆãƒŠãƒç²’å­ï¼‰ã‚’ç”Ÿæˆ

    Parameters
    ----------
    size : int
        ç”»åƒã‚µã‚¤ã‚º [pixels]

    Returns
    -------
    obj : ndarray
        ãƒ†ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    """
    obj = np.zeros((size, size))

    # 3ã¤ã®å††å½¢ç²’å­
    particles = [
        (40, 40, 15),
        (80, 70, 20),
        (60, 90, 12)
    ]

    y, x = np.ogrid[:size, :size]

    for (cx, cy, r) in particles:
        mask = (x - cx)**2 + (y - cy)**2 <= r**2
        obj[mask] = 1.0

    return obj

def simulate_tilt_series(obj, angles):
    """
    å‚¾æ–œã‚·ãƒªãƒ¼ã‚ºã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆãƒ©ãƒ‰ãƒ³å¤‰æ›ï¼‰

    Parameters
    ----------
    obj : ndarray
        2Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    angles : array-like
        æŠ•å½±è§’åº¦ [degrees]

    Returns
    -------
    sinogram : ndarray
        ã‚µã‚¤ãƒã‚°ãƒ©ãƒ ï¼ˆå…¨æŠ•å½±ãƒ‡ãƒ¼ã‚¿ï¼‰
    """
    # ãƒ©ãƒ‰ãƒ³å¤‰æ›ï¼ˆæŠ•å½±ï¼‰
    sinogram = radon(obj, theta=angles, circle=True)

    return sinogram

# ãƒ†ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
obj_original = create_test_object_2d(size=128)

# å‚¾æ–œã‚·ãƒªãƒ¼ã‚ºå–å¾—ï¼ˆ-70Â°ã€œ+70Â°, 2Â°åˆ»ã¿ï¼‰
angles = np.arange(-70, 71, 2)
sinogram = simulate_tilt_series(obj_original, angles)

# ãƒã‚¤ã‚ºè¿½åŠ ï¼ˆç¾å®Ÿçš„ãªæ¸¬å®šï¼‰
sinogram_noisy = sinogram + np.random.normal(0, 0.05*sinogram.max(), sinogram.shape)

# 3Då†æ§‹æˆï¼ˆé€†ãƒ©ãƒ‰ãƒ³å¤‰æ›ï¼‰
reconstruction = iradon(sinogram_noisy, theta=angles, circle=True, filter_name='ramp')

# ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°
reconstruction = np.clip(reconstruction, 0, 1)

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(12, 12))

# ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
im0 = axes[0, 0].imshow(obj_original, cmap='gray')
axes[0, 0].set_title('Original Object\n(Ground Truth)', fontsize=13, fontweight='bold')
axes[0, 0].axis('off')
plt.colorbar(im0, ax=axes[0, 0], fraction=0.046)

# ã‚µã‚¤ãƒã‚°ãƒ©ãƒ 
im1 = axes[0, 1].imshow(sinogram_noisy, cmap='gray', aspect='auto',
                        extent=[angles.min(), angles.max(), 0, sinogram.shape[0]])
axes[0, 1].set_title('Sinogram (Tilt Series)\nProjections at Different Angles', fontsize=13, fontweight='bold')
axes[0, 1].set_xlabel('Tilt Angle [degrees]', fontsize=11)
axes[0, 1].set_ylabel('Projection Position', fontsize=11)
plt.colorbar(im1, ax=axes[0, 1], fraction=0.046)

# å†æ§‹æˆåƒ
im2 = axes[1, 0].imshow(reconstruction, cmap='gray')
axes[1, 0].set_title('Reconstructed Object\n(Filtered Back-Projection)', fontsize=13, fontweight='bold')
axes[1, 0].axis('off')
plt.colorbar(im2, ax=axes[1, 0], fraction=0.046)

# èª¤å·®ãƒãƒƒãƒ—
error = np.abs(obj_original - reconstruction)
im3 = axes[1, 1].imshow(error, cmap='hot')
axes[1, 1].set_title('Reconstruction Error\n(|Original - Reconstructed|)', fontsize=13, fontweight='bold')
axes[1, 1].axis('off')
cbar3 = plt.colorbar(im3, ax=axes[1, 1], fraction=0.046)
cbar3.set_label('Error', fontsize=10)

plt.tight_layout()
plt.show()

# å®šé‡è©•ä¾¡
mse = np.mean((obj_original - reconstruction)**2)
print(f"å†æ§‹æˆã®å¹³å‡äºŒä¹—èª¤å·®ï¼ˆMSEï¼‰: {mse:.4f}")
print(f"æŠ•å½±è§’åº¦ç¯„å›²: {angles.min()}Â° ã€œ {angles.max()}Â°")
print(f"æŠ•å½±æ•°: {len(angles)}")
</code></pre>

        <p><strong>ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼ã®å¿œç”¨</strong>ï¼š</p>
        <ul>
            <li>ãƒŠãƒç²’å­è§¦åª’ã®3Då½¢çŠ¶ã¨è¡¨é¢æ§‹é€ è§£æ</li>
            <li>å¤šå­”è³ªææ–™ã®å­”å¾„åˆ†å¸ƒã¨é€£çµæ€§è©•ä¾¡</li>
            <li>ãƒãƒƒãƒ†ãƒªãƒ¼é›»æ¥µææ–™ã®3Då¾®ç´°æ§‹é€ è¦³å¯Ÿ</li>
            <li>ç”Ÿç‰©ç´°èƒå°å™¨å®˜ã®3Då†æ§‹æˆ</li>
        </ul>

        <h2>4.7 æ¼”ç¿’å•é¡Œ</h2>

        <h3>æ¼”ç¿’4-1: Z-contrastå¼·åº¦æ¯”</h3>
        <p><strong>å•é¡Œ</strong>ï¼šHAADF-STEMåƒã§Siï¼ˆZ=14ï¼‰ã¨Geï¼ˆZ=32ï¼‰ã®åŸå­ã‚«ãƒ©ãƒ å¼·åº¦æ¯”ã‚’è¨ˆç®—ã›ã‚ˆï¼ˆZ^1.7ä¾å­˜æ€§ã‚’ä»®å®šï¼‰ã€‚</p>

        <details>
            <summary><strong>è§£ç­”ä¾‹ã‚’è¡¨ç¤º</strong></summary>
            <pre><code class="language-python">Z_Si = 14
Z_Ge = 32

I_ratio = (Z_Ge / Z_Si)**1.7

print(f"SiåŸå­ã‚«ãƒ©ãƒ å¼·åº¦: I_Si âˆ {Z_Si}^1.7")
print(f"GeåŸå­ã‚«ãƒ©ãƒ å¼·åº¦: I_Ge âˆ {Z_Ge}^1.7")
print(f"å¼·åº¦æ¯” I_Ge/I_Si: {I_ratio:.2f}")
print("Geã¯Siã®ç´„6å€æ˜ã‚‹ãè¦‹ãˆã‚‹")
</code></pre>
        </details>

        <h3>æ¼”ç¿’4-2: EELSå®šé‡</h3>
        <p><strong>å•é¡Œ</strong>ï¼šAl<sub>2</sub>O<sub>3</sub>ã®EELSã‚¹ãƒšã‚¯ãƒˆãƒ«ã§ã€Al-Kç©åˆ†å¼·åº¦ãŒ1200ã€O-Kç©åˆ†å¼·åº¦ãŒ3000ã ã£ãŸã€‚éƒ¨åˆ†ã‚¤ã‚ªãƒ³åŒ–æ–­é¢ç©æ¯”Ïƒ(O-K)/Ïƒ(Al-K) = 1.5ã®ã¨ãã€Al/OåŸå­æ•°æ¯”ã‚’æ±‚ã‚ã‚ˆã€‚</p>

        <details>
            <summary><strong>è§£ç­”ä¾‹ã‚’è¡¨ç¤º</strong></summary>
            <pre><code class="language-python">I_Al = 1200
I_O = 3000
sigma_ratio = 1.5  # Ïƒ(O) / Ïƒ(Al)

# N_Al / N_O = (I_Al / I_O) * (Ïƒ_O / Ïƒ_Al)
atom_ratio = (I_Al / I_O) * sigma_ratio

print(f"Alç©åˆ†å¼·åº¦: {I_Al}")
print(f"Oç©åˆ†å¼·åº¦: {I_O}")
print(f"æ–­é¢ç©æ¯” Ïƒ(O)/Ïƒ(Al): {sigma_ratio}")
print(f"åŸå­æ•°æ¯” N_Al/N_O: {atom_ratio:.3f}")
print(f"\nç†è«–å€¤ï¼ˆAl2O3ï¼‰: 2/3 = 0.667")
print(f"æ¸¬å®šå€¤: {atom_ratio:.3f} â†’ ã»ã¼ä¸€è‡´")
</code></pre>
        </details>

        <h3>æ¼”ç¿’4-3: ABFåƒã®å¿œç”¨</h3>
        <p><strong>å•é¡Œ</strong>ï¼šSrTiO<sub>3</sub>ãƒšãƒ­ãƒ–ã‚¹ã‚«ã‚¤ãƒˆæ§‹é€ ã§ã€OåŸå­ä½ç½®ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã«ABFåƒãŒæœ‰åŠ¹ãªç†ç”±ã‚’èª¬æ˜ã›ã‚ˆã€‚</p>

        <details>
            <summary><strong>è§£ç­”ä¾‹ã‚’è¡¨ç¤º</strong></summary>
            <p><strong>ç†ç”±</strong>ï¼š</p>
            <ul>
                <li>HAADFåƒã§ã¯ã€Srï¼ˆZ=38ï¼‰ã¨Tiï¼ˆZ=22ï¼‰ã¯æ˜ã‚‹ãè¦‹ãˆã‚‹ãŒã€Oï¼ˆZ=8ï¼‰ã¯æ•£ä¹±å¼·åº¦ãŒå¼±ãæ¤œå‡ºå›°é›£</li>
                <li>ABFåƒã§ã¯ã€ä¸­è§’é ˜åŸŸã®æ•£ä¹±ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã€é‡å…ƒç´ ã¨è»½å…ƒç´ ã®æ•£ä¹±å¼·åº¦å·®ãŒç›¸å¯¾çš„ã«å°ã•ã„</li>
                <li>OåŸå­ã‚«ãƒ©ãƒ ã‚‚æš—ã„ã‚¹ãƒãƒƒãƒˆã¨ã—ã¦æ˜ç­ã«è¦³å¯Ÿã•ã‚Œã‚‹</li>
                <li>Srã¨Tiã®ä½ç½®ï¼ˆHAADFï¼‰ã¨Oã®ä½ç½®ï¼ˆABFï¼‰ã‚’åŒæ™‚å–å¾—ã™ã‚‹ã“ã¨ã§ã€å®Œå…¨ãªåŸå­é…åˆ—ãŒæ±ºå®šã§ãã‚‹</li>
            </ul>
        </details>

        <h3>æ¼”ç¿’4-4: ãƒ—ãƒ©ã‚ºãƒ¢ãƒ³è§£æ</h3>
        <p><strong>å•é¡Œ</strong>ï¼šAlã®EELSã‚¹ãƒšã‚¯ãƒˆãƒ«ã§15 eVã«ãƒ—ãƒ©ã‚ºãƒ¢ãƒ³ãƒ”ãƒ¼ã‚¯ãŒè¦³æ¸¬ã•ã‚ŒãŸã€‚è‡ªç”±é›»å­å¯†åº¦ã‚’è¨ˆç®—ã›ã‚ˆï¼ˆãƒ—ãƒ©ã‚ºãƒ¢ãƒ³ã‚¨ãƒãƒ«ã‚®ãƒ¼ $E_p = \hbar\omega_p = \hbar\sqrt{ne^2/m_e\epsilon_0}$ï¼‰ã€‚</p>

        <details>
            <summary><strong>è§£ç­”ä¾‹ã‚’è¡¨ç¤º</strong></summary>
            <pre><code class="language-python">import numpy as np

E_p = 15  # [eV]
e = 1.60218e-19  # [C]
m_e = 9.10938e-31  # [kg]
epsilon_0 = 8.85419e-12  # [F/m]
hbar = 1.05457e-34  # [JÂ·s]

# E_p = hbar * omega_p
omega_p = E_p * e / hbar  # [rad/s]

# omega_p = sqrt(n * e^2 / (m_e * epsilon_0))
n = (omega_p**2) * m_e * epsilon_0 / (e**2)

print(f"ãƒ—ãƒ©ã‚ºãƒ¢ãƒ³ã‚¨ãƒãƒ«ã‚®ãƒ¼: {E_p} eV")
print(f"ãƒ—ãƒ©ã‚ºãƒ¢ãƒ³è§’å‘¨æ³¢æ•°: {omega_p:.3e} rad/s")
print(f"è‡ªç”±é›»å­å¯†åº¦: {n:.3e} m^-3")
print(f"              = {n/1e28:.2f} Ã— 10^28 m^-3")

# Alã®ç†è«–å€¤ï¼ˆ3å€‹/åŸå­ã€æ ¼å­å®šæ•°4.05 Ã…ï¼‰
a = 4.05e-10  # [m]
atoms_per_cell = 4  # FCC
n_theory = (atoms_per_cell * 3) / a**3
print(f"\nç†è«–å€¤ï¼ˆAl FCC, 3 valence e/atomï¼‰: {n_theory:.3e} m^-3")
</code></pre>
        </details>

        <h3>æ¼”ç¿’4-5: ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼æŠ•å½±æ•°</h3>
        <p><strong>å•é¡Œ</strong>ï¼šç›´å¾„50 nmã®ãƒŠãƒç²’å­ã‚’1 nmåˆ†è§£èƒ½ã§ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼å†æ§‹æˆã™ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€å°æŠ•å½±æ•°ã‚’Crowther criterionã‹ã‚‰æ¨å®šã›ã‚ˆã€‚</p>

        <details>
            <summary><strong>è§£ç­”ä¾‹ã‚’è¡¨ç¤º</strong></summary>
            <pre><code class="language-python">import numpy as np

D = 50  # [nm] ç²’å­ç›´å¾„
resolution = 1  # [nm] ç›®æ¨™åˆ†è§£èƒ½

# Crowther criterion: N >= Ï€ * D / resolution
N_min = np.pi * D / resolution

print(f"ç²’å­ç›´å¾„: {D} nm")
print(f"ç›®æ¨™åˆ†è§£èƒ½: {resolution} nm")
print(f"Crowther criterionã«ã‚ˆã‚‹æœ€å°æŠ•å½±æ•°: {N_min:.1f}")
print(f"å®Ÿç”¨çš„ã«ã¯: {int(np.ceil(N_min * 1.5))} æŠ•å½±ä»¥ä¸Šã‚’æ¨å¥¨")
print(f"\nå‚¾æ–œç¯„å›²-70Â°ã€œ+70Â°ï¼ˆ140Â°ï¼‰ã§2Â°åˆ»ã¿ãªã‚‰: 70æŠ•å½±")
print(f"1Â°åˆ»ã¿ãªã‚‰: 140æŠ•å½± â†’ ååˆ†")
</code></pre>
        </details>

        <h3>æ¼”ç¿’4-6: STEMæ¤œå‡ºå™¨æœ€é©åŒ–</h3>
        <p><strong>å•é¡Œ</strong>ï¼šè»½å…ƒç´ ï¼ˆC, N, Oï¼‰ã¨é‡å…ƒç´ ï¼ˆPtï¼‰ã‚’åŒæ™‚ã«è¦³å¯Ÿã—ãŸã„ã€‚ã©ã®æ¤œå‡ºå™¨çµ„ã¿åˆã‚ã›ãŒæœ€é©ã‹ã€ç†ç”±ã¨ã¨ã‚‚ã«ç­”ãˆã‚ˆã€‚</p>

        <details>
            <summary><strong>è§£ç­”ä¾‹ã‚’è¡¨ç¤º</strong></summary>
            <p><strong>æœ€é©ãªçµ„ã¿åˆã‚ã›</strong>ï¼š</p>
            <ul>
                <li><strong>HAADF + ABF åŒæ™‚å–å¾—</strong></li>
            </ul>
            <p><strong>ç†ç”±</strong>ï¼š</p>
            <ul>
                <li><strong>HAADF</strong>ï¼šPtï¼ˆZ=78ï¼‰ã®ä½ç½®ã‚’é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã§è¦³å¯Ÿã€‚Z^1.7ä¾å­˜æ€§ã«ã‚ˆã‚Šã€è»½å…ƒç´ ã¯ã»ã¼è¦‹ãˆãªã„</li>
                <li><strong>ABF</strong>ï¼šC, N, Oã‚’æš—ã„ã‚¹ãƒãƒƒãƒˆã¨ã—ã¦æ¤œå‡ºã€‚Ptã‚‚è¦³å¯Ÿå¯èƒ½</li>
                <li><strong>åŒæ™‚å–å¾—</strong>ï¼šSTEMã¯1å›ã®èµ°æŸ»ã§è¤‡æ•°æ¤œå‡ºå™¨ã®ä¿¡å·ã‚’ä¸¦åˆ—å–å¾—ã§ãã‚‹ãŸã‚ã€åŠ¹ç‡çš„</li>
                <li><strong>ç›¸è£œçš„æƒ…å ±</strong>ï¼šHAADFã§æ§‹é€ ã®éª¨æ ¼ï¼ˆé‡å…ƒç´ ï¼‰ã‚’æŠŠæ¡ã—ã€ABFã§è»½å…ƒç´ ä½ç½®ã‚’è£œå®Œ</li>
            </ul>
        </details>

        <h3>æ¼”ç¿’4-7: EELSåšã•æ¸¬å®š</h3>
        <p><strong>å•é¡Œ</strong>ï¼šEELSã®ã‚¼ãƒ­ãƒ­ã‚¹ãƒ”ãƒ¼ã‚¯ç©åˆ†å¼·åº¦ãŒ10000ã€å…¨ã‚¹ãƒšã‚¯ãƒˆãƒ«ç©åˆ†å¼·åº¦ãŒ15000ã ã£ãŸã€‚å¹³å‡è‡ªç”±è¡Œç¨‹Î»ã‚’100 nmã¨ã™ã‚‹ã¨ã€è©¦æ–™åšã•tã‚’æ¨å®šã›ã‚ˆï¼ˆ$I_{\text{total}}/I_0 = \exp(t/\lambda)$ï¼‰ã€‚</p>

        <details>
            <summary><strong>è§£ç­”ä¾‹ã‚’è¡¨ç¤º</strong></summary>
            <pre><code class="language-python">import numpy as np

I_zero_loss = 10000
I_total = 15000
lambda_mfp = 100  # [nm] å¹³å‡è‡ªç”±è¡Œç¨‹

# I_total / I_zero_loss = exp(t / lambda)
ratio = I_total / I_zero_loss
t = lambda_mfp * np.log(ratio)

print(f"ã‚¼ãƒ­ãƒ­ã‚¹ãƒ”ãƒ¼ã‚¯ç©åˆ†: {I_zero_loss}")
print(f"å…¨ç©åˆ†å¼·åº¦: {I_total}")
print(f"å¼·åº¦æ¯”: {ratio:.3f}")
print(f"å¹³å‡è‡ªç”±è¡Œç¨‹: {lambda_mfp} nm")
print(f"è©¦æ–™åšã•: {t:.1f} nm")

if t < 50:
    print("â†’ è–„ã„è©¦æ–™ï¼ˆEELSå®šé‡ã«é©ã—ã¦ã„ã‚‹ï¼‰")
elif t < 100:
    print("â†’ ä¸­ç¨‹åº¦ã®åšã•ï¼ˆå¤šé‡æ•£ä¹±ã®å½±éŸ¿ã‚ã‚Šï¼‰")
else:
    print("â†’ åšã„è©¦æ–™ï¼ˆEELSå®šé‡ã¯å›°é›£ã€ã‚ˆã‚Šè–„ãã™ã‚‹å¿…è¦ã‚ã‚Šï¼‰")
</code></pre>
        </details>

        <h3>æ¼”ç¿’4-8: å®Ÿè·µèª²é¡Œ</h3>
        <p><strong>å•é¡Œ</strong>ï¼šFe-Cr-Ni ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹é‹¼ã®STEM-EELSåˆ†æè¨ˆç”»ã‚’ç«‹æ¡ˆã›ã‚ˆã€‚æ¸¬å®šã™ã¹ãä¿¡å·ã€äºˆæƒ³ã•ã‚Œã‚‹èª²é¡Œã€å¯¾ç­–ã‚’å«ã‚ã‚‹ã“ã¨ã€‚</p>

        <details>
            <summary><strong>è§£ç­”ä¾‹ã‚’è¡¨ç¤º</strong></summary>
            <p><strong>æ¸¬å®šè¨ˆç”»</strong>ï¼š</p>
            <ol>
                <li><strong>è©¦æ–™ä½œè£½</strong>ï¼š
                    <ul>
                        <li>FIBï¼ˆé›†æŸã‚¤ã‚ªãƒ³ãƒ“ãƒ¼ãƒ ï¼‰ã§è–„ç‰‡ä½œè£½ï¼ˆç›®æ¨™åšã•<50 nmï¼‰</li>
                        <li>ä½åŠ é€Ÿã‚¤ã‚ªãƒ³ç ”ç£¨ã§è¡¨é¢ãƒ€ãƒ¡ãƒ¼ã‚¸é™¤å»</li>
                    </ul>
                </li>
                <li><strong>HAADF-STEMè¦³å¯Ÿ</strong>ï¼š
                    <ul>
                        <li>çµæ™¶ç²’ã€æå‡ºç‰©ã€ç•Œé¢ã®å½¢æ…‹è¦³å¯Ÿ</li>
                        <li>Z-contrastã§Cr, Feã®æ¿ƒåº¦å¤‰åŒ–ã‚’å®šæ€§è©•ä¾¡</li>
                    </ul>
                </li>
                <li><strong>EELS ãƒãƒƒãƒ”ãƒ³ã‚°</strong>ï¼š
                    <ul>
                        <li>Fe-L<sub>2,3</sub>ï¼ˆ708 eVï¼‰ã€Cr-L<sub>2,3</sub>ï¼ˆ575 eVï¼‰ã€Ni-L<sub>2,3</sub>ï¼ˆ855 eVï¼‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°</li>
                        <li>ãƒ‡ãƒ¥ã‚¢ãƒ«EELSï¼ˆä½æå¤± + ã‚³ã‚¢ãƒ­ã‚¹åŒæ™‚å–å¾—ï¼‰ã§åšã•è£œæ­£</li>
                    </ul>
                </li>
                <li><strong>å®šé‡è§£æ</strong>ï¼š
                    <ul>
                        <li>HyperSpyã§å„ã‚¨ãƒƒã‚¸ã®ç©åˆ†å¼·åº¦æŠ½å‡º</li>
                        <li>Hartree-Slateræ–­é¢ç©ã§æ¿ƒåº¦å®šé‡</li>
                    </ul>
                </li>
            </ol>
            <p><strong>äºˆæƒ³ã•ã‚Œã‚‹èª²é¡Œã¨å¯¾ç­–</strong>ï¼š</p>
            <ul>
                <li><strong>èª²é¡Œ1</strong>ï¼šFe, Crã®ã‚¨ãƒƒã‚¸ãŒè¿‘æ¥ï¼ˆ708 vs 575 eVï¼‰â†’ <strong>å¯¾ç­–</strong>ï¼šé«˜ã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†è§£èƒ½è¨­å®šï¼ˆ<1 eVï¼‰ã€ãƒ”ãƒ¼ã‚¯åˆ†é›¢</li>
                <li><strong>èª²é¡Œ2</strong>ï¼šè©¦æ–™åšã•ã®ä¸å‡ä¸€æ€§ â†’ <strong>å¯¾ç­–</strong>ï¼šä½æå¤±ã‚¹ãƒšã‚¯ãƒˆãƒ«ã‹ã‚‰å„ç‚¹ã®åšã•ã‚’æ¨å®šã—è£œæ­£</li>
                <li><strong>èª²é¡Œ3</strong>ï¼šãƒ“ãƒ¼ãƒ æå‚·ï¼ˆç‰¹ã«ä½åŠ é€Ÿé›»åœ§ã§ã¯ï¼‰ â†’ <strong>å¯¾ç­–</strong>ï¼šæ¶²ä½“çª’ç´ å†·å´ãƒ›ãƒ«ãƒ€ãƒ¼ä½¿ç”¨ã€ãƒ“ãƒ¼ãƒ é›»æµæœ€å°åŒ–</li>
            </ul>
        </details>

        <h2>4.8 å­¦ç¿’ãƒã‚§ãƒƒã‚¯</h2>
        <p>ä»¥ä¸‹ã®è³ªå•ã«ç­”ãˆã¦ã€ç†è§£åº¦ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š</p>

        <ol>
            <li>STEMã¨TEMã®åƒå½¢æˆåŸç†ã®é•ã„ã‚’èª¬æ˜ã§ãã¾ã™ã‹ï¼Ÿ</li>
            <li>HAADF-STEMåƒã®Z-contrastç‰¹æ€§ã®ç‰©ç†çš„èµ·æºã‚’ç†è§£ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</li>
            <li>ABFåƒãŒè»½å…ƒç´ è¦³å¯Ÿã«é©ã—ã¦ã„ã‚‹ç†ç”±ã‚’èª¬æ˜ã§ãã¾ã™ã‹ï¼Ÿ</li>
            <li>EELSã‚¹ãƒšã‚¯ãƒˆãƒ«ã®æ§‹æˆï¼ˆã‚¼ãƒ­ãƒ­ã‚¹ã€ä½æå¤±ã€ã‚³ã‚¢ãƒ­ã‚¹ï¼‰ã‚’ç†è§£ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</li>
            <li>EELSå®šé‡è§£æã®æ‰‹é †ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é™¤å»ã€ç©åˆ†ã€æ–­é¢ç©è£œæ­£ï¼‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã‹ï¼Ÿ</li>
            <li>STEMå…ƒç´ ãƒãƒƒãƒ”ãƒ³ã‚°ã§EELSã¨EDSã®ä½¿ã„åˆ†ã‘ã‚’åˆ¤æ–­ã§ãã¾ã™ã‹ï¼Ÿ</li>
            <li>é›»å­ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼ã®æŠ•å½±å®šç†ã¨3Då†æ§‹æˆã®åŸç†ã‚’ç†è§£ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</li>
        </ol>

        <h2>4.9 å‚è€ƒæ–‡çŒ®</h2>
        <ol>
            <li>Pennycook, S. J., & Nellist, P. D. (Eds.). (2011). <em>Scanning Transmission Electron Microscopy: Imaging and Analysis</em>. Springer. - STEMæŠ€è¡“ã®åŒ…æ‹¬çš„æ•™ç§‘æ›¸</li>
            <li>Egerton, R. F. (2011). <em>Electron Energy-Loss Spectroscopy in the Electron Microscope</em> (3rd ed.). Springer. - EELSè§£æã®ãƒã‚¤ãƒ–ãƒ«</li>
            <li>Findlay, S. D., et al. (2010). "Robust atomic resolution imaging of light elements using scanning transmission electron microscopy." <em>Applied Physics Letters</em>, 95, 191913. - ABFåƒã®åŸç†è«–æ–‡</li>
            <li>Muller, D. A. (2009). "Structure and bonding at the atomic scale by scanning transmission electron microscopy." <em>Nature Materials</em>, 8, 263-270. - åŸå­åˆ†è§£èƒ½STEMè§£æ</li>
            <li>de Jonge, N., & Ross, F. M. (2011). "Electron microscopy of specimens in liquid." <em>Nature Nanotechnology</em>, 6, 695-704. - æ¶²ä¸­STEMè¦³å¯Ÿ</li>
            <li>Midgley, P. A., & Dunin-Borkowski, R. E. (2009). "Electron tomography and holography in materials science." <em>Nature Materials</em>, 8, 271-280. - é›»å­ãƒˆãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒ¼ã®å¿œç”¨</li>
            <li>Krivanek, O. L., et al. (2010). "Atom-by-atom structural and chemical analysis by annular dark-field electron microscopy." <em>Nature</em>, 464, 571-574. - å˜åŸå­åˆ†æSTEM</li>
        </ol>

        <h2>4.10 æ¬¡ç« ã¸</h2>
        <p>æ¬¡ç« ã§ã¯ã€EDSã€EELSã€EBSDãƒ‡ãƒ¼ã‚¿ã®çµ±åˆåˆ†æã‚’Pythonã§å®Ÿè·µã—ã¾ã™ã€‚HyperSpyãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸã‚¹ãƒšã‚¯ãƒˆãƒ«å‡¦ç†ã€æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ç›¸åˆ†é¡ã€EBSDæ–¹ä½è§£æã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿéš›ã®ææ–™è§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>

        <div class="navigation">
            <a href="chapter-3.html" class="nav-button">â† ç¬¬3ç« ï¼šTEMå…¥é–€</a>
            <a href="index.html" class="nav-button">ç›®æ¬¡ã«æˆ»ã‚‹</a>
            <a href="chapter-5.html" class="nav-button">ç¬¬5ç« ï¼šçµ±åˆåˆ†æå®Ÿè·µ â†’</a>
        </div>
    </main>

    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€ï¼ˆæ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©ï¼‰ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿ï¼ˆAS ISï¼‰ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶ï¼ˆä¾‹: CC BY 4.0ï¼‰ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

    <footer>
        <p><strong>ä½œæˆè€…</strong>: MS Knowledge Hub Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-28</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>&copy; 2025 MS Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
