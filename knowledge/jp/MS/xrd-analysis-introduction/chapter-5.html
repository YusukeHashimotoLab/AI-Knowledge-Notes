<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç« :å®Ÿè·µXRDãƒ‡ãƒ¼ã‚¿è§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ - MS Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #f093fb;
            --color-accent-light: #f5576c;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #f093fb;
            --color-link-hover: #d07be8;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(240, 147, 251, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .breadcrumb {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        .breadcrumb a {
            color: var(--color-link);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            color: var(--color-text-light);
        }

        footer a {
            color: var(--color-link);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            .navigation {
                flex-direction: column;
            }

            .meta {
                font-size: 0.85rem;
            }

            pre {
                font-size: 0.8rem;
            }
        }
    </style>

    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Mermaid -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'base' });
    </script>

    <!-- Prism.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</head>
<body>
    <div class="breadcrumb">
        <a href="../../index.html">MS Terakoya</a> &gt;
        <a href="./index.html">Xç·šå›æŠ˜åˆ†æå…¥é–€ã‚·ãƒªãƒ¼ã‚º</a> &gt;
        ç¬¬5ç« 
    </div>

    <header>
        <div class="header-content">
            <h1>ç¬¬5ç« : å®Ÿè·µXRDãƒ‡ãƒ¼ã‚¿è§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h1>
            <p class="subtitle">ç”Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å­¦è¡“å ±å‘Šã¾ã§ - å®Ÿå‹™ã«å³ã—ãŸXRDè§£æã®å®Œå…¨ã‚¬ã‚¤ãƒ‰</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 35åˆ†</span>
                <span class="meta-item">ğŸ“ é›£æ˜“åº¦: ä¸­ç´š-ä¸Šç´š</span>
                <span class="meta-item">ğŸ”§ Python, lmfit, pymatgen, GSAS-II</span>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="learning-objectives">
            <h2>å­¦ç¿’ç›®æ¨™</h2>
            <p>ã“ã®ç« ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã‚’èª¬æ˜ãƒ»å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™:</p>
            <h3>åŸºæœ¬ç†è§£</h3>
            <ul>
                <li>âœ… å®Ÿè·µçš„ãªXRDè§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å…¨ä½“åƒ</li>
                <li>âœ… å¤šç›¸æ··åˆç‰©è§£æ(2ç›¸ãƒ»3ç›¸ç³»)ã®æˆ¦ç•¥</li>
                <li>âœ… å®šé‡ç›¸åˆ†æ(RIRæ³•ã€Rietveldå®šé‡)ã®åŸç†</li>
                <li>âœ… åæŸå¤±æ•—ã‚„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç›¸é–¢ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</li>
            </ul>
            <h3>å®Ÿè·µã‚¹ã‚­ãƒ«</h3>
            <ul>
                <li>âœ… ç”Ÿãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‹ã‚‰çµæœå¯è¦–åŒ–ã¾ã§å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…</li>
                <li>âœ… å¤šç›¸æ··åˆç‰©(Î±-Fe + Feâ‚ƒOâ‚„)ã®ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æ</li>
                <li>âœ… RIRæ³•ã¨Rietveldæ³•ã«ã‚ˆã‚‹ç›¸åˆ†ç‡ã®å®šé‡</li>
                <li>âœ… CIFãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã¨å­¦è¡“è«–æ–‡ç”¨å›³è¡¨ã®ä½œæˆ</li>
            </ul>
            <h3>å¿œç”¨åŠ›</h3>
            <ul>
                <li>âœ… ã‚¨ãƒ©ãƒ¼è¨ºæ–­(åæŸå¤±æ•—ã€GOFç•°å¸¸ã€è² ã®å æœ‰ç‡)ã¨è§£æ±ºç­–</li>
                <li>âœ… GSAS-IIã¨Pythonã®é€£æºã«ã‚ˆã‚‹é«˜åº¦ãªè§£æ</li>
                <li>âœ… å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹å®Œå…¨ãªãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æã®å®Ÿè¡Œ</li>
            </ul>
        </div>

        <h2>5.1 å®Œå…¨è§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h2>

        <p>å®Ÿè·µçš„ãªXRDè§£æã¯ã€ç”Ÿãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‹ã‚‰å§‹ã¾ã‚Šã€æ§‹é€ ç²¾å¯†åŒ–ã€çµæœã®æ¤œè¨¼ã€ãã—ã¦å­¦è¡“å ±å‘Šç”¨ã®å›³è¡¨ä½œæˆã¾ã§ã€ä¸€é€£ã®æµã‚Œã‚’ä½“ç³»çš„ã«å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ç¯€ã§ã¯ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªè§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>

        <div class="mermaid">
        flowchart TB
            A[ç”Ÿãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿<br/>.xy, .dat, .xrdml] --> B[ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†]
            B --> C[ãƒ”ãƒ¼ã‚¯æ¤œå‡º<br/>ç›¸åŒå®š]
            C --> D[åˆæœŸæ§‹é€ ãƒ¢ãƒ‡ãƒ«<br/>CIFèª­ã¿è¾¼ã¿]
            D --> E[ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆæœŸåŒ–]
            E --> F{å˜ç›¸ or å¤šç›¸?}

            F -->|å˜ç›¸| G[ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆç²¾å¯†åŒ–<br/>Stage 1: BG+Scale]
            F -->|å¤šç›¸| H[å¤šç›¸è§£æ<br/>Phase 1 â†’ Phase 2]

            G --> I[Stage 2: Profile<br/>U, V, W, Î·]
            I --> J[Stage 3: Structure<br/>x, y, z, Uiso]

            H --> I

            J --> K[åæŸåˆ¤å®š<br/>GOF < 2.0?]
            K -->|No| L[ã‚¨ãƒ©ãƒ¼è¨ºæ–­<br/>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´]
            L --> E

            K -->|Yes| M[çµæœæŠ½å‡º<br/>æ ¼å­å®šæ•°, ç›¸åˆ†ç‡, D]
            M --> N[å¯è¦–åŒ–<br/>è«–æ–‡ç”¨å›³è¡¨]
            N --> O[CIFå‡ºåŠ›<br/>å­¦è¡“å ±å‘Š]

            style A fill:#e3f2fd
            style K fill:#fff3e0
            style O fill:#e8f5e9
        </flowchart>
        </div>

        <h3>5.1.1 ç”Ÿãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨å‰å‡¦ç†</h3>

        <p>XRDè£…ç½®ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¯å¤šæ§˜ã§ã™ã€‚ä¸»è¦ãªå½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–¢æ•°ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

        <pre><code class="language-python"># ========================================
# Example 1: æ±ç”¨XRDãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼
# ========================================

import numpy as np
import pandas as pd

class XRDDataLoader:
    """
    æ±ç”¨XRDãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼

    å¯¾å¿œå½¢å¼:
    - .xy: 2åˆ—å½¢å¼ (2Î¸, Intensity)
    - .dat: ãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ããƒ†ã‚­ã‚¹ãƒˆ
    - .xrdml: Panalytical XMLå½¢å¼
    - .raw: Bruker RAWå½¢å¼
    """

    @staticmethod
    def load_xy(filepath, skip_rows=0):
        """
        .xyå½¢å¼ã®èª­ã¿è¾¼ã¿

        Args:
            filepath: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
            skip_rows: ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹è¡Œæ•°(ãƒ˜ãƒƒãƒ€ãƒ¼)

        Returns:
            two_theta, intensity: numpyé…åˆ—
        """
        try:
            data = np.loadtxt(filepath, skiprows=skip_rows)
            two_theta = data[:, 0]
            intensity = data[:, 1]

            return two_theta, intensity
        except Exception as e:
            print(f"Error loading .xy file: {e}")
            return None, None

    @staticmethod
    def load_dat(filepath, delimiter=None, header=None):
        """
        .datå½¢å¼ã®èª­ã¿è¾¼ã¿ (pandasã§æŸ”è»Ÿã«å¯¾å¿œ)

        Args:
            filepath: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
            delimiter: åŒºåˆ‡ã‚Šæ–‡å­— (None: ç©ºç™½)
            header: ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œç•ªå·

        Returns:
            two_theta, intensity
        """
        try:
            df = pd.read_csv(filepath, delimiter=delimiter, header=header)

            # æœ€åˆã®2åˆ—ã‚’2Î¸ã¨Intensityã¨ä»®å®š
            two_theta = df.iloc[:, 0].values
            intensity = df.iloc[:, 1].values

            return two_theta, intensity
        except Exception as e:
            print(f"Error loading .dat file: {e}")
            return None, None

    @staticmethod
    def preprocess(two_theta, intensity, remove_outliers=True, smooth=False):
        """
        ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†

        Args:
            two_theta, intensity: ç”Ÿãƒ‡ãƒ¼ã‚¿
            remove_outliers: å¤–ã‚Œå€¤é™¤å»
            smooth: å¹³æ»‘åŒ– (ç§»å‹•å¹³å‡)

        Returns:
            two_theta_clean, intensity_clean
        """
        # å¤–ã‚Œå€¤é™¤å» (3Ïƒä»¥ä¸Š)
        if remove_outliers:
            mean_int = np.mean(intensity)
            std_int = np.std(intensity)
            mask = np.abs(intensity - mean_int) < 3 * std_int
            two_theta = two_theta[mask]
            intensity = intensity[mask]

        # å¹³æ»‘åŒ– (ç§»å‹•å¹³å‡, window=5)
        if smooth:
            intensity = np.convolve(intensity, np.ones(5)/5, mode='same')

        # è² ã®å¼·åº¦ã‚’0ã«
        intensity = np.maximum(intensity, 0)

        return two_theta, intensity


# ä½¿ç”¨ä¾‹
loader = XRDDataLoader()

# .xyå½¢å¼ã®èª­ã¿è¾¼ã¿
two_theta, intensity = loader.load_xy('sample_data.xy', skip_rows=1)

# å‰å‡¦ç†
two_theta_clean, intensity_clean = loader.preprocess(
    two_theta, intensity,
    remove_outliers=True,
    smooth=False
)

print(f"ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆæ•°: {len(two_theta_clean)}")
print(f"2Î¸ç¯„å›²: {two_theta_clean.min():.2f}Â° - {two_theta_clean.max():.2f}Â°")
print(f"æœ€å¤§å¼·åº¦: {intensity_clean.max():.0f} counts")
</code></pre>

        <h3>5.1.2 å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…</h3>

        <p>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‹ã‚‰CIFå‡ºåŠ›ã¾ã§ã€å…¨ã‚¹ãƒ†ãƒƒãƒ—ã‚’çµ±åˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

        <pre><code class="language-python"># ========================================
# Example 2: å®Œå…¨XRDè§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
# ========================================

import numpy as np
import matplotlib.pyplot as plt
from lmfit import Parameters, Minimizer
from pymatgen.core import Structure

class CompleteXRDWorkflow:
    """
    XRDè§£æã®å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

    æ‰‹é †:
    1. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ»å‰å‡¦ç†
    2. ãƒ”ãƒ¼ã‚¯æ¤œå‡ºãƒ»ç›¸åŒå®š
    3. ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆç²¾å¯†åŒ– (3æ®µéš)
    4. çµæœæŠ½å‡ºãƒ»å¯è¦–åŒ–
    5. CIFå‡ºåŠ›
    """

    def __init__(self, filepath, wavelength=1.5406):
        self.filepath = filepath
        self.wavelength = wavelength
        self.two_theta = None
        self.intensity = None
        self.result = None

    def step1_load_data(self, skip_rows=0):
        """Step 1: ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿"""
        loader = XRDDataLoader()
        self.two_theta, self.intensity = loader.load_xy(self.filepath, skip_rows)
        self.two_theta, self.intensity = loader.preprocess(
            self.two_theta, self.intensity, remove_outliers=True
        )
        print(f"âœ“ Step 1 å®Œäº†: {len(self.two_theta)} ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆèª­ã¿è¾¼ã¿")

    def step2_peak_detection(self, prominence=0.1):
        """Step 2: ãƒ”ãƒ¼ã‚¯æ¤œå‡º"""
        from scipy.signal import find_peaks

        # ãƒ”ãƒ¼ã‚¯æ¤œå‡º
        intensity_norm = self.intensity / self.intensity.max()
        peaks, properties = find_peaks(intensity_norm, prominence=prominence)

        self.peak_positions = self.two_theta[peaks]
        self.peak_intensities = self.intensity[peaks]

        print(f"âœ“ Step 2 å®Œäº†: {len(self.peak_positions)} ãƒ”ãƒ¼ã‚¯æ¤œå‡º")
        print(f"  ä¸»è¦ãƒ”ãƒ¼ã‚¯ä½ç½®: {self.peak_positions[:5]}")

    def step3_rietveld_refinement(self, structure_cif=None):
        """Step 3: ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆç²¾å¯†åŒ– (3æ®µéš)"""

        # Stage 1: Background + Scale
        print("Stage 1: Background + Scale ...")
        params_stage1 = self._initialize_params_stage1()
        result_stage1 = self._minimize(params_stage1)

        # Stage 2: Profile parameters
        print("Stage 2: Profile parameters ...")
        params_stage2 = self._add_profile_params(result_stage1.params)
        result_stage2 = self._minimize(params_stage2)

        # Stage 3: Structure parameters
        print("Stage 3: Structure parameters ...")
        params_stage3 = self._add_structure_params(result_stage2.params)
        self.result = self._minimize(params_stage3)

        print(f"âœ“ Step 3 å®Œäº†: Rwp = {self._calculate_rwp(self.result):.2f}%")

    def _initialize_params_stage1(self):
        """Stage 1ç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"""
        params = Parameters()
        params.add('scale', value=1.0, min=0.1, max=10.0)
        params.add('bg_0', value=self.intensity.min(), min=0.0)
        params.add('bg_1', value=0.0)
        params.add('bg_2', value=0.0)
        return params

    def _add_profile_params(self, params_prev):
        """Stage 2: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ """
        params = params_prev.copy()
        params.add('U', value=0.01, min=0.0, max=0.1)
        params.add('V', value=-0.005, min=-0.05, max=0.0)
        params.add('W', value=0.005, min=0.0, max=0.05)
        params.add('eta', value=0.5, min=0.0, max=1.0)
        return params

    def _add_structure_params(self, params_prev):
        """Stage 3: æ§‹é€ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ """
        params = params_prev.copy()
        params.add('lattice_a', value=5.64, min=5.5, max=5.8)
        params.add('U_iso', value=0.01, min=0.001, max=0.05)
        return params

    def _minimize(self, params):
        """æœ€å°åŒ–å®Ÿè¡Œ"""
        minimizer = Minimizer(self._residual, params)
        result = minimizer.minimize(method='leastsq')
        return result

    def _residual(self, params):
        """æ®‹å·®é–¢æ•° (ç°¡ç•¥ç‰ˆ)"""
        # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
        bg_coeffs = [params.get('bg_0', params.valuesdict().get('bg_0', 0)),
                     params.get('bg_1', params.valuesdict().get('bg_1', 0)),
                     params.get('bg_2', params.valuesdict().get('bg_2', 0))]

        x_norm = 2 * (self.two_theta - self.two_theta.min()) / (self.two_theta.max() - self.two_theta.min()) - 1
        bg = sum(c * np.polynomial.chebyshev.chebval(x_norm, [0]*i + [1]) for i, c in enumerate(bg_coeffs))

        # ã‚¹ã‚±ãƒ¼ãƒ«
        scale = params['scale'].value

        # è¨ˆç®—ãƒ‘ã‚¿ãƒ¼ãƒ³ (ç°¡ç•¥åŒ–)
        I_calc = bg + scale * 10  # å®Ÿéš›ã¯ãƒ”ãƒ¼ã‚¯è¨ˆç®—ãŒå…¥ã‚‹

        # æ®‹å·®
        residual = (self.intensity - I_calc) / np.sqrt(np.maximum(self.intensity, 1.0))
        return residual

    def _calculate_rwp(self, result):
        """Rwpè¨ˆç®—"""
        return np.sqrt(result.chisqr / result.ndata) * 100

    def step4_extract_results(self):
        """Step 4: çµæœæŠ½å‡º"""
        if self.result is None:
            print("Error: ç²¾å¯†åŒ–ãŒæœªå®Ÿè¡Œã§ã™")
            return

        results_dict = {
            'lattice_a': self.result.params.get('lattice_a', None),
            'U_iso': self.result.params.get('U_iso', None),
            'Rwp': self._calculate_rwp(self.result),
            'GOF': self.result.redchi
        }

        print("âœ“ Step 4 å®Œäº†: çµæœæŠ½å‡º")
        for key, val in results_dict.items():
            if val is not None:
                if hasattr(val, 'value'):
                    print(f"  {key}: {val.value:.6f}")
                else:
                    print(f"  {key}: {val:.6f}")

        return results_dict

    def step5_visualize(self, save_path=None):
        """Step 5: å¯è¦–åŒ–"""
        fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(10, 8), sharex=True,
                                       gridspec_kw={'height_ratios': [3, 1]})

        # ä¸Šæ®µ: è¦³æ¸¬ãƒ»è¨ˆç®—ãƒ»å·®åˆ†
        ax1.plot(self.two_theta, self.intensity, 'o', markersize=3,
                 label='Observed', color='red', alpha=0.6)
        # I_calc ã¯ç°¡ç•¥åŒ–ã®ãŸã‚çœç•¥
        ax1.set_ylabel('Intensity (a.u.)', fontsize=12)
        ax1.legend()
        ax1.set_title('Rietveld Refinement', fontsize=14, fontweight='bold')

        # ä¸‹æ®µ: æ®‹å·®
        # residual ã¯ç°¡ç•¥åŒ–ã®ãŸã‚çœç•¥
        ax2.axhline(0, color='gray', linestyle='--', linewidth=1)
        ax2.set_xlabel('2Î¸ (Â°)', fontsize=12)
        ax2.set_ylabel('Residual', fontsize=10)

        plt.tight_layout()

        if save_path:
            plt.savefig(save_path, dpi=300)
            print(f"âœ“ Step 5 å®Œäº†: å›³ã‚’ {save_path} ã«ä¿å­˜")

        plt.show()


# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œä¾‹
workflow = CompleteXRDWorkflow('sample.xy', wavelength=1.5406)

# å…¨ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ
workflow.step1_load_data(skip_rows=1)
workflow.step2_peak_detection(prominence=0.1)
workflow.step3_rietveld_refinement()
results = workflow.step4_extract_results()
workflow.step5_visualize(save_path='rietveld_result.png')
</code></pre>

        <h2>5.2 å¤šç›¸æ··åˆç‰©è§£æ</h2>

        <p>å®Ÿéš›ã®ææ–™ã¯è¤‡æ•°ã®ç›¸ãŒå…±å­˜ã™ã‚‹å ´åˆãŒå¤šãã€å¤šç›¸ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æãŒå¿…è¦ã§ã™ã€‚ã“ã®ç¯€ã§ã¯ã€2ç›¸ç³»(Î±-Fe + Feâ‚ƒOâ‚„)ã¨3ç›¸ç³»ã®è§£ææ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚</p>

        <h3>5.2.1 2ç›¸ç³»ã®è§£æ: Î±-Fe + Feâ‚ƒOâ‚„</h3>

        <p>é‰„ã®é…¸åŒ–è©¦æ–™ã‚’ä¾‹ã«ã€Î±-Fe (BCC)ã¨Feâ‚ƒOâ‚„ (ã‚¹ãƒ”ãƒãƒ«æ§‹é€ )ã®2ç›¸æ··åˆç‰©ã‚’è§£æã—ã¾ã™ã€‚</p>

        <pre><code class="language-python"># ========================================
# Example 3: 2ç›¸æ··åˆç‰©ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æ
# ========================================

import numpy as np
from lmfit import Parameters, Minimizer

class TwoPhaseRietveld:
    """
    2ç›¸æ··åˆç‰©ã®ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æ

    Phase 1: Î±-Fe (BCC, Im-3m, a=2.866 Ã…)
    Phase 2: Feâ‚ƒOâ‚„ (Spinel, Fd-3m, a=8.396 Ã…)
    """

    def __init__(self, two_theta, intensity, wavelength=1.5406):
        self.two_theta = np.array(two_theta)
        self.intensity = np.array(intensity)
        self.wavelength = wavelength

        # å„ç›¸ã®hklãƒªã‚¹ãƒˆ
        self.hkl_Fe = [(1,1,0), (2,0,0), (2,1,1), (2,2,0), (3,1,0)]
        self.hkl_Fe3O4 = [(2,2,0), (3,1,1), (4,0,0), (4,2,2), (5,1,1)]

    def two_theta_from_d(self, d):
        """dé–“éš”ã‹ã‚‰2Î¸ã‚’è¨ˆç®—"""
        sin_theta = self.wavelength / (2 * d)
        if abs(sin_theta) > 1.0:
            return None
        theta = np.arcsin(sin_theta)
        return np.degrees(2 * theta)

    def d_spacing_cubic(self, hkl, a):
        """ç«‹æ–¹æ ¼å­ã®dé–“éš”"""
        h, k, l = hkl
        return a / np.sqrt(h**2 + k**2 + l**2)

    def pseudo_voigt(self, two_theta, two_theta_0, fwhm, eta, amplitude):
        """Pseudo-Voigt ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«"""
        H = fwhm / 2
        delta = two_theta - two_theta_0

        G = np.exp(-np.log(2) * (delta / H)**2)
        L = 1 / (1 + (delta / H)**2)
        PV = eta * L + (1 - eta) * G

        return amplitude * PV

    def caglioti_fwhm(self, two_theta, U, V, W):
        """Cagliotiå¼"""
        theta_rad = np.radians(two_theta / 2)
        tan_theta = np.tan(theta_rad)
        fwhm_sq = U * tan_theta**2 + V * tan_theta + W
        return np.sqrt(max(fwhm_sq, 1e-6))

    def calculate_pattern(self, params):
        """
        2ç›¸ã®è¨ˆç®—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆ
        """
        # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡º
        a_Fe = params['a_Fe'].value
        a_Fe3O4 = params['a_Fe3O4'].value

        scale_Fe = params['scale_Fe'].value
        scale_Fe3O4 = params['scale_Fe3O4'].value

        U = params['U'].value
        V = params['V'].value
        W = params['W'].value
        eta = params['eta'].value

        # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
        bg_0 = params['bg_0'].value
        bg_1 = params['bg_1'].value

        x_norm = 2 * (self.two_theta - self.two_theta.min()) / (self.two_theta.max() - self.two_theta.min()) - 1
        bg = bg_0 + bg_1 * x_norm

        I_calc = bg.copy()

        # Phase 1: Î±-Fe
        for hkl in self.hkl_Fe:
            d = self.d_spacing_cubic(hkl, a_Fe)
            two_theta_hkl = self.two_theta_from_d(d)

            if two_theta_hkl is None or two_theta_hkl < self.two_theta.min() or two_theta_hkl > self.two_theta.max():
                continue

            fwhm = self.caglioti_fwhm(two_theta_hkl, U, V, W)
            amplitude = scale_Fe * 100  # ç°¡ç•¥åŒ–

            I_calc += self.pseudo_voigt(self.two_theta, two_theta_hkl, fwhm, eta, amplitude)

        # Phase 2: Feâ‚ƒOâ‚„
        for hkl in self.hkl_Fe3O4:
            d = self.d_spacing_cubic(hkl, a_Fe3O4)
            two_theta_hkl = self.two_theta_from_d(d)

            if two_theta_hkl is None or two_theta_hkl < self.two_theta.min() or two_theta_hkl > self.two_theta.max():
                continue

            fwhm = self.caglioti_fwhm(two_theta_hkl, U, V, W)
            amplitude = scale_Fe3O4 * 80  # ç°¡ç•¥åŒ–

            I_calc += self.pseudo_voigt(self.two_theta, two_theta_hkl, fwhm, eta, amplitude)

        return I_calc

    def residual(self, params):
        """æ®‹å·®é–¢æ•°"""
        I_calc = self.calculate_pattern(params)
        residual = (self.intensity - I_calc) / np.sqrt(np.maximum(self.intensity, 1.0))
        return residual

    def refine(self):
        """2ç›¸ç²¾å¯†åŒ–"""
        params = Parameters()

        # æ ¼å­å®šæ•°
        params.add('a_Fe', value=2.866, min=2.85, max=2.89)
        params.add('a_Fe3O4', value=8.396, min=8.35, max=8.45)

        # ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼
        params.add('scale_Fe', value=1.0, min=0.1, max=10.0)
        params.add('scale_Fe3O4', value=0.5, min=0.1, max=10.0)

        # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
        params.add('U', value=0.01, min=0.0, max=0.1)
        params.add('V', value=-0.005, min=-0.05, max=0.0)
        params.add('W', value=0.005, min=0.0, max=0.05)
        params.add('eta', value=0.5, min=0.0, max=1.0)

        # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
        params.add('bg_0', value=10.0, min=0.0)
        params.add('bg_1', value=0.0)

        # æœ€å°åŒ–
        minimizer = Minimizer(self.residual, params)
        result = minimizer.minimize(method='leastsq')

        return result


# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ (ç°¡ç•¥åŒ–)
two_theta_test = np.linspace(20, 80, 600)
intensity_test = 15 + 3*np.random.randn(len(two_theta_test))

# 2ç›¸è§£æå®Ÿè¡Œ
two_phase = TwoPhaseRietveld(two_theta_test, intensity_test)
result = two_phase.refine()

print("=== 2ç›¸ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æçµæœ ===")
print(f"Î±-Feæ ¼å­å®šæ•°: a = {result.params['a_Fe'].value:.6f} Ã…")
print(f"Feâ‚ƒOâ‚„æ ¼å­å®šæ•°: a = {result.params['a_Fe3O4'].value:.6f} Ã…")
print(f"ã‚¹ã‚±ãƒ¼ãƒ«æ¯” (Fe:Feâ‚ƒOâ‚„) = {result.params['scale_Fe'].value:.3f}:{result.params['scale_Fe3O4'].value:.3f}")
print(f"Rwp = {np.sqrt(result.chisqr / result.ndata) * 100:.2f}%")
</code></pre>

        <h3>5.2.2 3ç›¸ç³»ã®è§£ææˆ¦ç•¥</h3>

        <p>3ç›¸ä»¥ä¸Šã®æ··åˆç‰©ã§ã¯ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ãŒæ€¥å¢—ã—ã€åæŸãŒå›°é›£ã«ãªã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®æˆ¦ç•¥ãŒæœ‰åŠ¹ã§ã™:</p>

        <ol>
            <li><strong>æ®µéšçš„ç²¾å¯†åŒ–</strong>: ä¸»ç›¸ â†’ ç¬¬2ç›¸ â†’ ç¬¬3ç›¸ã¨é †ç•ªã«è¿½åŠ </li>
            <li><strong>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å›ºå®š</strong>: æ—¢çŸ¥ã®ç›¸ã¯æ ¼å­å®šæ•°ã‚’æ–‡çŒ®å€¤ã«å›ºå®š</li>
            <li><strong>ã‚¹ã‚±ãƒ¼ãƒ«æ¯”ã®åˆ¶ç´„</strong>: \(\sum w_i = 1.0\) (é‡é‡åˆ†ç‡ã®åˆè¨ˆãŒ1)</li>
            <li><strong>ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰</strong>: U, V, Wã‚’å…¨ç›¸ã§å…±é€šã¨ã™ã‚‹</li>
        </ol>

        <h2>5.3 å®šé‡ç›¸åˆ†æ</h2>

        <p>å¤šç›¸æ··åˆç‰©ã®å„ç›¸ã®é‡é‡åˆ†ç‡ã‚’å®šé‡ã™ã‚‹æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚RIRæ³•(Reference Intensity Ratio)ã¨Rietveldæ³•ã®2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚Šã¾ã™ã€‚</p>

        <h3>5.3.1 RIRæ³• (Reference Intensity Ratio)</h3>

        <p>RIRæ³•ã¯ã€æœ€å¼·ãƒ”ãƒ¼ã‚¯ã®å¼·åº¦æ¯”ã‹ã‚‰ç›¸åˆ†ç‡ã‚’æ¨å®šã™ã‚‹ç°¡æ˜“çš„ãªæ‰‹æ³•ã§ã™:</p>

        \[
        w_{\alpha} = \frac{I_{\alpha} / RIR_{\alpha}}{I_{\alpha}/RIR_{\alpha} + I_{\beta}/RIR_{\beta}}
        \]

        <ul>
            <li>\(w_{\alpha}\): ç›¸Î±ã®é‡é‡åˆ†ç‡</li>
            <li>\(I_{\alpha}\): ç›¸Î±ã®æœ€å¼·ãƒ”ãƒ¼ã‚¯å¼·åº¦</li>
            <li>\(RIR_{\alpha}\): ç›¸Î±ã®RIRå€¤(PDF Cardã‹ã‚‰å–å¾—)</li>
        </ul>

        <pre><code class="language-python"># ========================================
# Example 4: RIRæ³•ã«ã‚ˆã‚‹å®šé‡ç›¸åˆ†æ
# ========================================

import numpy as np

def rir_quantitative_analysis(peak_intensities, rir_values, phase_names):
    """
    RIRæ³•ã§é‡é‡åˆ†ç‡ã‚’è¨ˆç®—

    Args:
        peak_intensities: å„ç›¸ã®æœ€å¼·ãƒ”ãƒ¼ã‚¯å¼·åº¦ [I1, I2, ...]
        rir_values: å„ç›¸ã®RIRå€¤ [RIR1, RIR2, ...]
        phase_names: ç›¸åãƒªã‚¹ãƒˆ ['Phase1', 'Phase2', ...]

    Returns:
        weight_fractions: é‡é‡åˆ†ç‡ã®è¾æ›¸
    """
    # I/RIR ã‚’è¨ˆç®—
    I_over_RIR = np.array(peak_intensities) / np.array(rir_values)

    # é‡é‡åˆ†ç‡
    total = np.sum(I_over_RIR)
    weight_fractions = I_over_RIR / total

    results = {name: w for name, w in zip(phase_names, weight_fractions)}

    return results


# ä¾‹: Î±-Fe + Feâ‚ƒOâ‚„ ã®2ç›¸æ··åˆç‰©
peak_intensities = [1500, 800]  # Î±-Fe(110): 1500, Feâ‚ƒOâ‚„(311): 800
rir_values = [2.0, 2.5]         # RIRå€¤ (PDF Card)
phase_names = ['Î±-Fe', 'Feâ‚ƒOâ‚„']

wt_fractions = rir_quantitative_analysis(peak_intensities, rir_values, phase_names)

print("=== RIRæ³• å®šé‡åˆ†æçµæœ ===")
for phase, wt in wt_fractions.items():
    print(f"{phase}: {wt*100:.2f} wt%")

# å‡ºåŠ›ä¾‹:
# === RIRæ³• å®šé‡åˆ†æçµæœ ===
# Î±-Fe: 70.09 wt%
# Feâ‚ƒOâ‚„: 29.91 wt%
</code></pre>

        <h3>5.3.2 Rietveldå®šé‡åˆ†æ</h3>

        <p>Rietveldæ³•ã§ã¯ã€ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ \(S_{\alpha}\) ã‹ã‚‰é‡é‡åˆ†ç‡ã‚’ç²¾å¯†ã«è¨ˆç®—ã§ãã¾ã™:</p>

        \[
        w_{\alpha} = \frac{S_{\alpha} (ZMV)_{\alpha}}{\sum_i S_i (ZMV)_i}
        \]

        <ul>
            <li>\(S_{\alpha}\): ç›¸Î±ã®ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼(ç²¾å¯†åŒ–ã§æ±ºå®š)</li>
            <li>\(Z\): å˜ä½æ ¼å­å†…ã®åŒ–å­¦å¼æ•°</li>
            <li>\(M\): åŒ–å­¦å¼é‡</li>
            <li>\(V\): å˜ä½æ ¼å­ä½“ç©</li>
        </ul>

        <pre><code class="language-python"># ========================================
# Example 5: Rietveldå®šé‡åˆ†æ
# ========================================

def rietveld_quantitative_analysis(scale_factors, Z_list, M_list, V_list, phase_names):
    """
    Rietveldæ³•ã§é‡é‡åˆ†ç‡ã‚’è¨ˆç®—

    Args:
        scale_factors: ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ [S1, S2, ...]
        Z_list: å˜ä½æ ¼å­å†…ã®åŒ–å­¦å¼æ•° [Z1, Z2, ...]
        M_list: åŒ–å­¦å¼é‡ [M1, M2, ...] (g/mol)
        V_list: å˜ä½æ ¼å­ä½“ç© [V1, V2, ...] (Ã…Â³)
        phase_names: ç›¸åãƒªã‚¹ãƒˆ

    Returns:
        weight_fractions: é‡é‡åˆ†ç‡ã®è¾æ›¸
    """
    # S*(ZMV) ã‚’è¨ˆç®—
    S_ZMV = np.array(scale_factors) * np.array(Z_list) * np.array(M_list) * np.array(V_list)

    # é‡é‡åˆ†ç‡
    total = np.sum(S_ZMV)
    weight_fractions = S_ZMV / total

    results = {name: w for name, w in zip(phase_names, weight_fractions)}

    return results


# ä¾‹: Î±-Fe + Feâ‚ƒOâ‚„
scale_factors = [1.23, 0.67]  # ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆç²¾å¯†åŒ–ã§æ±ºå®š
Z_list = [2, 8]               # Î±-Fe: BCC (Z=2), Feâ‚ƒOâ‚„: Spinel (Z=8)
M_list = [55.845, 231.533]    # Fe: 55.845, Feâ‚ƒOâ‚„: 231.533 g/mol
V_list = [23.55, 591.4]       # Î±-Fe: aÂ³ = 2.866Â³, Feâ‚ƒOâ‚„: aÂ³ = 8.396Â³

phase_names = ['Î±-Fe', 'Feâ‚ƒOâ‚„']

wt_fractions_rietveld = rietveld_quantitative_analysis(
    scale_factors, Z_list, M_list, V_list, phase_names
)

print("=== Rietveldå®šé‡åˆ†æçµæœ ===")
for phase, wt in wt_fractions_rietveld.items():
    print(f"{phase}: {wt*100:.2f} wt%")

# å‡ºåŠ›ä¾‹:
# === Rietveldå®šé‡åˆ†æçµæœ ===
# Î±-Fe: 68.34 wt%
# Feâ‚ƒOâ‚„: 31.66 wt%
</code></pre>

        <h2>5.4 ã‚¨ãƒ©ãƒ¼è§£æã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>

        <p>ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æã§ã¯ã€åæŸå¤±æ•—ã‚„éç‰©ç†çš„ãªçµæœãŒé »ç¹ã«ç™ºç”Ÿã—ã¾ã™ã€‚ã“ã®ç¯€ã§ã¯ã€å…¸å‹çš„ãªã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºç­–ã‚’å­¦ã³ã¾ã™ã€‚</p>

        <h3>5.4.1 å…¸å‹çš„ãªã‚¨ãƒ©ãƒ¼ã¨è¨ºæ–­</h3>

        <table>
            <thead>
                <tr>
                    <th>ç—‡çŠ¶</th>
                    <th>åŸå› </th>
                    <th>è§£æ±ºç­–</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>åæŸã—ãªã„</strong> (100å›ä»¥ä¸Šåå¾©)</td>
                    <td>åˆæœŸå€¤ãŒä¸é©åˆ‡ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç›¸é–¢ãŒå¼·ã„</td>
                    <td>åˆæœŸå€¤ã‚’æ–‡çŒ®å€¤ã«è¿‘ã¥ã‘ã‚‹ã€æ®µéšçš„ç²¾å¯†åŒ–</td>
                </tr>
                <tr>
                    <td><strong>GOF >> 2.0</strong></td>
                    <td>ãƒ¢ãƒ‡ãƒ«ãŒä¸é©åˆ‡ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãŒé–“é•ã„</td>
                    <td>Chebyshevæ¬¡æ•°ã‚’å¢—ã‚„ã™ã€ç›¸ã‚’è¦‹ç›´ã™</td>
                </tr>
                <tr>
                    <td><strong>GOF < 1.0</strong></td>
                    <td>éå‰°ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤šã™ã</td>
                    <td>ä¸è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å›ºå®šã€åˆ¶ç´„ã‚’è¿½åŠ </td>
                </tr>
                <tr>
                    <td><strong>è² ã®å æœ‰ç‡</strong></td>
                    <td>åˆæœŸå€¤ãŒæ‚ªã„ã€å¢ƒç•Œè¨­å®šãƒŸã‚¹</td>
                    <td>min=0.0ã‚’è¨­å®šã€åˆæœŸå€¤ã‚’0.5ã«</td>
                </tr>
                <tr>
                    <td><strong>æ ¼å­å®šæ•°ãŒå¢ƒç•Œã«å¼µã‚Šä»˜ã</strong></td>
                    <td>å¢ƒç•ŒãŒç‹­ã™ãã‚‹ã€ç›¸ãŒé–“é•ã„</td>
                    <td>å¢ƒç•Œã‚’åºƒã’ã‚‹ã€ç›¸åŒå®šã‚’å†ç¢ºèª</td>
                </tr>
                <tr>
                    <td><strong>Rwp > 20%</strong></td>
                    <td>ãƒ”ãƒ¼ã‚¯ä½ç½®ãŒãšã‚Œã¦ã„ã‚‹ã€è£…ç½®é–¢æ•°æœªè£œæ­£</td>
                    <td>Zeroè£œæ­£ã€è©¦æ–™å¤‰ä½è£œæ­£ã‚’è¿½åŠ </td>
                </tr>
            </tbody>
        </table>

        <h3>5.4.2 åæŸè¨ºæ–­ãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…</h3>

        <pre><code class="language-python"># ========================================
# Example 6: åæŸè¨ºæ–­ãƒ„ãƒ¼ãƒ«
# ========================================

class ConvergenceDiagnostics:
    """
    ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆç²¾å¯†åŒ–ã®åæŸè¨ºæ–­ãƒ„ãƒ¼ãƒ«
    """

    @staticmethod
    def check_convergence(result):
        """
        åæŸçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯

        Args:
            result: lmfit Minimizer.minimize() ã®çµæœ

        Returns:
            è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ
        """
        issues = []

        # 1. GOFãƒã‚§ãƒƒã‚¯
        GOF = result.redchi
        if GOF > 2.0:
            issues.append(f"âš ï¸ GOF = {GOF:.2f} (>2.0): ãƒ¢ãƒ‡ãƒ«ãŒä¸é©åˆ‡ãªå¯èƒ½æ€§")
        elif GOF < 1.0:
            issues.append(f"âš ï¸ GOF = {GOF:.2f} (<1.0): éå‰°ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã®å¯èƒ½æ€§")

        # 2. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¢ƒç•Œãƒã‚§ãƒƒã‚¯
        for name, param in result.params.items():
            if not param.vary:
                continue

            # å¢ƒç•Œã«å¼µã‚Šä»˜ã„ã¦ã„ã‚‹ã‹
            if param.min is not None and abs(param.value - param.min) < 1e-6:
                issues.append(f"âš ï¸ {name} ãŒä¸‹é™å¢ƒç•Œã«å¼µã‚Šä»˜ã„ã¦ã„ã¾ã™: {param.value:.6f}")
            if param.max is not None and abs(param.value - param.max) < 1e-6:
                issues.append(f"âš ï¸ {name} ãŒä¸Šé™å¢ƒç•Œã«å¼µã‚Šä»˜ã„ã¦ã„ã¾ã™: {param.value:.6f}")

            # éç‰©ç†çš„ãªå€¤
            if 'occ' in name and (param.value < 0 or param.value > 1):
                issues.append(f"âŒ {name} = {param.value:.6f}: å æœ‰ç‡ãŒç¯„å›²å¤– [0, 1]")

            if 'U_iso' in name and param.value < 0:
                issues.append(f"âŒ {name} = {param.value:.6f}: æ¸©åº¦å› å­ãŒè² ")

        # 3. ç›¸é–¢ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒã‚§ãƒƒã‚¯
        if hasattr(result, 'covar') and result.covar is not None:
            corr_matrix = result.covar / np.outer(np.sqrt(np.diag(result.covar)),
                                                   np.sqrt(np.diag(result.covar)))
            strong_corr = np.where(np.abs(corr_matrix) > 0.9)

            for i, j in zip(*strong_corr):
                if i < j:  # é‡è¤‡ã‚’é¿ã‘ã‚‹
                    param_names = list(result.var_names)
                    issues.append(f"âš ï¸ å¼·ã„ç›¸é–¢: {param_names[i]} â†” {param_names[j]} (r={corr_matrix[i,j]:.3f})")

        # ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
        if not issues:
            print("âœ… åæŸè¨ºæ–­: å•é¡Œãªã—")
        else:
            print("ğŸ” åæŸè¨ºæ–­çµæœ:")
            for issue in issues:
                print(f"  {issue}")

        return issues


# ä½¿ç”¨ä¾‹
diagnostics = ConvergenceDiagnostics()

# result ã¯ lmfit Minimizer.minimize() ã®çµæœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
# diagnostics.check_convergence(result)
</code></pre>

        <h3>5.4.3 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®Ÿä¾‹</h3>

        <details>
            <summary><strong>Case 1</strong>: æ ¼å­å®šæ•°ãŒå¢ƒç•Œã«å¼µã‚Šä»˜ã</summary>

            <p><strong>ç—‡çŠ¶</strong>:</p>
            <pre><code>lattice_a = 5.799 Ã… (å¢ƒç•Œ: [5.5, 5.8])
âš ï¸ lattice_a ãŒä¸Šé™å¢ƒç•Œã«å¼µã‚Šä»˜ã„ã¦ã„ã¾ã™</code></pre>

            <p><strong>åŸå› </strong>: å¢ƒç•ŒãŒç‹­ã™ãã‚‹ã€ã¾ãŸã¯ç›¸åŒå®šãŒé–“é•ã£ã¦ã„ã‚‹</p>

            <p><strong>è§£æ±ºç­–</strong>:</p>
            <ol>
                <li>å¢ƒç•Œã‚’åºƒã’ã‚‹: <code>params.add('lattice_a', value=5.64, min=5.3, max=6.0)</code></li>
                <li>é«˜è§’ãƒ”ãƒ¼ã‚¯ã‚’ç¢ºèªã—ã€ç›¸ã‚’å†æ¤œè¨¼</li>
                <li>æ–‡çŒ®å€¤ã¨æ¯”è¼ƒã—ã€åˆæœŸå€¤ã‚’èª¿æ•´</li>
            </ol>
        </details>

        <details>
            <summary><strong>Case 2</strong>: GOF = 5.2 (ç•°å¸¸ã«é«˜ã„)</summary>

            <p><strong>ç—‡çŠ¶</strong>: Rwp = 23%, GOF = 5.2</p>

            <p><strong>åŸå› </strong>:</p>
            <ul>
                <li>ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¢ãƒ‡ãƒ«ãŒä¸é©åˆ‡(æ¬¡æ•°ãŒä½ã™ãã‚‹)</li>
                <li>æœªåŒå®šã®ç›¸ãŒå­˜åœ¨ã™ã‚‹</li>
                <li>ãƒ”ãƒ¼ã‚¯ä½ç½®ãŒãšã‚Œã¦ã„ã‚‹(Zeroè£œæ­£ãŒå¿…è¦)</li>
            </ul>

            <p><strong>è§£æ±ºç­–</strong>:</p>
            <ol>
                <li>Chebyshevæ¬¡æ•°ã‚’3æ¬¡â†’5æ¬¡ã«å¢—ã‚„ã™</li>
                <li>ãƒ”ãƒ¼ã‚¯æ¤œå‡ºã‚’å†å®Ÿè¡Œã—ã€å…¨ãƒ”ãƒ¼ã‚¯ãŒèª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</li>
                <li>Zeroè£œæ­£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ : <code>params.add('zero_shift', value=0.0, min=-0.1, max=0.1)</code></li>
            </ol>
        </details>

        <h2>5.5 çµæœã®å¯è¦–åŒ–ã¨å­¦è¡“å ±å‘Š</h2>

        <p>ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æã®çµæœã¯ã€è«–æ–‡ã‚„å ±å‘Šæ›¸ã§è¦–è¦šçš„ã«æ˜ç­ã«ç¤ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ç¯€ã§ã¯ã€è«–æ–‡å“è³ªã®å›³è¡¨ä½œæˆã¨CIFå‡ºåŠ›ã‚’å­¦ã³ã¾ã™ã€‚</p>

        <h3>5.5.1 è«–æ–‡ç”¨ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆãƒ—ãƒ­ãƒƒãƒˆã®ä½œæˆ</h3>

        <pre><code class="language-python"># ========================================
# Example 7: è«–æ–‡å“è³ªãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆãƒ—ãƒ­ãƒƒãƒˆ
# ========================================

import matplotlib.pyplot as plt
import numpy as np

def plot_rietveld_publication_quality(two_theta, I_obs, I_calc, I_bg, residual,
                                      phase_labels=None, save_path='rietveld.pdf'):
    """
    è«–æ–‡å“è³ªã®ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆãƒ—ãƒ­ãƒƒãƒˆ

    Args:
        two_theta: 2Î¸é…åˆ—
        I_obs: è¦³æ¸¬å¼·åº¦
        I_calc: è¨ˆç®—å¼·åº¦
        I_bg: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
        residual: æ®‹å·®
        phase_labels: å„ç›¸ã®åå‰ãƒªã‚¹ãƒˆ
        save_path: ä¿å­˜å…ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    """
    fig = plt.figure(figsize=(12, 8))

    # ä¸Šæ®µ: è¦³æ¸¬ãƒ»è¨ˆç®—ãƒ»å·®åˆ†
    ax1 = plt.subplot2grid((4, 1), (0, 0), rowspan=3)

    # è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ (èµ¤ä¸¸)
    ax1.plot(two_theta, I_obs, 'o', markersize=4, markerfacecolor='none',
             markeredgecolor='red', markeredgewidth=1.2, label='Observed')

    # è¨ˆç®—ãƒ‘ã‚¿ãƒ¼ãƒ³ (é’ç·š)
    ax1.plot(two_theta, I_calc, '-', color='blue', linewidth=2, label='Calculated')

    # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ (ç·‘ç·š)
    ax1.plot(two_theta, I_bg, '--', color='green', linewidth=1.5, label='Background')

    # å·®åˆ† (ç°è‰²ã€ä¸‹ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆ)
    offset = I_obs.min() - 0.1 * I_obs.max()
    ax1.plot(two_theta, residual + offset, '-', color='gray', linewidth=1, label='Difference')
    ax1.axhline(offset, color='black', linestyle='-', linewidth=0.5)

    # ãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯ä½ç½® (ç¸¦ç·š)
    if phase_labels:
        colors = ['red', 'blue', 'orange']
        for i, label in enumerate(phase_labels):
            # ç°¡ç•¥åŒ–: ãƒ”ãƒ¼ã‚¯ä½ç½®ã¯æ‰‹å‹•è¨­å®š
            peak_positions = [38.2, 44.4, 64.6]  # ä¾‹
            y_position = offset - 0.05 * I_obs.max() * (i + 1)
            ax1.vlines(peak_positions, ymin=y_position, ymax=y_position + 0.03*I_obs.max(),
                      colors=colors[i], linewidth=2, label=label)

    ax1.set_ylabel('Intensity (a.u.)', fontsize=14, fontweight='bold')
    ax1.legend(loc='upper right', fontsize=11, frameon=False)
    ax1.tick_params(axis='both', labelsize=12)
    ax1.set_xlim(two_theta.min(), two_theta.max())
    ax1.set_ylim(offset - 0.2*I_obs.max(), I_obs.max() * 1.1)

    # ä¸‹æ®µ: æ®‹å·®æ‹¡å¤§å›³
    ax2 = plt.subplot2grid((4, 1), (3, 0), sharex=ax1)
    ax2.plot(two_theta, residual, '-', color='black', linewidth=1)
    ax2.axhline(0, color='gray', linestyle='--', linewidth=1)
    ax2.set_xlabel('2Î¸ (Â°)', fontsize=14, fontweight='bold')
    ax2.set_ylabel('Residual', fontsize=12)
    ax2.tick_params(axis='both', labelsize=12)
    ax2.set_ylim(-3*np.std(residual), 3*np.std(residual))

    plt.tight_layout()
    plt.savefig(save_path, dpi=300, bbox_inches='tight')
    print(f"âœ“ å›³ã‚’ {save_path} ã«ä¿å­˜ã—ã¾ã—ãŸ (300 dpi)")

    plt.show()


# ä½¿ç”¨ä¾‹ (ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿)
two_theta = np.linspace(20, 80, 600)
I_obs = 100 * np.exp(-((two_theta - 38)/2)**2) + 50 * np.exp(-((two_theta - 44)/2.5)**2) + 20 + 5*np.random.randn(len(two_theta))
I_calc = 100 * np.exp(-((two_theta - 38)/2)**2) + 50 * np.exp(-((two_theta - 44)/2.5)**2) + 20
I_bg = 20 * np.ones_like(two_theta)
residual = I_obs - I_calc

plot_rietveld_publication_quality(two_theta, I_obs, I_calc, I_bg, residual,
                                  phase_labels=['Î±-Fe', 'Feâ‚ƒOâ‚„'],
                                  save_path='rietveld_paper.pdf')
</code></pre>

        <h3>5.5.2 CIFãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›</h3>

        <p>CIF (Crystallographic Information File) ã¯ã€çµæ™¶æ§‹é€ ãƒ‡ãƒ¼ã‚¿ã®æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã™ã€‚ç²¾å¯†åŒ–çµæœã‚’CIFã§ä¿å­˜ã™ã‚‹ã“ã¨ã§ã€ä»–ã®ç ”ç©¶è€…ãŒå†ç¾ãƒ»æ¤œè¨¼ã§ãã¾ã™ã€‚</p>

        <pre><code class="language-python"># ========================================
# Example 8: CIFãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
# ========================================

from pymatgen.core import Structure
from pymatgen.io.cif import CifWriter

def export_to_cif(structure, lattice_params, refinement_results, output_path='refined_structure.cif'):
    """
    ç²¾å¯†åŒ–çµæœã‚’CIFãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›

    Args:
        structure: pymatgen Structure ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        lattice_params: {'a': 5.64, 'b': 5.64, 'c': 5.64, ...}
        refinement_results: {'Rwp': 8.5, 'GOF': 1.42, ...}
        output_path: å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    """
    # CIFãƒ©ã‚¤ã‚¿ãƒ¼
    cif_writer = CifWriter(structure, symprec=0.01)

    # CIFã‚’æ–‡å­—åˆ—ã¨ã—ã¦å–å¾—
    cif_string = str(cif_writer)

    # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
    metadata = f"""
#======================================================================
# Rietveld Refinement Results
#======================================================================
# Refined lattice parameters:
#   a = {lattice_params.get('a', 'N/A'):.6f} Ã…
#   b = {lattice_params.get('b', 'N/A'):.6f} Ã…
#   c = {lattice_params.get('c', 'N/A'):.6f} Ã…
#
# Refinement statistics:
#   Rwp = {refinement_results.get('Rwp', 'N/A'):.2f} %
#   GOF = {refinement_results.get('GOF', 'N/A'):.3f}
#   Number of data points = {refinement_results.get('ndata', 'N/A')}
#
# Date: {refinement_results.get('date', 'YYYY-MM-DD')}
# Software: Python + lmfit + pymatgen
#======================================================================

"""

    # CIFå‡ºåŠ›
    with open(output_path, 'w') as f:
        f.write(metadata)
        f.write(cif_string)

    print(f"âœ“ CIFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ {output_path} ã«å‡ºåŠ›ã—ã¾ã—ãŸ")


# ä½¿ç”¨ä¾‹
from pymatgen.core import Lattice, Structure

# ç²¾å¯†åŒ–å¾Œã®æ§‹é€ 
lattice = Lattice.cubic(5.6405)  # ç²¾å¯†åŒ–å¾Œã®a
structure = Structure(lattice, ["Na", "Cl"], [[0, 0, 0], [0.5, 0.5, 0.5]])

lattice_params = {'a': 5.6405, 'b': 5.6405, 'c': 5.6405}
refinement_results = {
    'Rwp': 8.52,
    'GOF': 1.42,
    'ndata': 600,
    'date': '2025-10-28'
}

export_to_cif(structure, lattice_params, refinement_results, 'NaCl_refined.cif')
</code></pre>

        <h3>5.5.3 GSAS-IIã¨ã®é€£æº</h3>

        <p>GSAS-II ã¯ã€GUIå¯¾å¿œã®å¼·åŠ›ãªãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰æ“ä½œã™ã‚‹ã“ã¨ã§ã€é«˜åº¦ãªè§£æã¨Pythonã®æŸ”è»Ÿæ€§ã‚’ä¸¡ç«‹ã§ãã¾ã™ã€‚</p>

        <blockquote>
            <p><strong>ğŸ’¡ GSAS-II Pythonã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹</strong></p>
            <p>GSAS-IIã¯ã€<code>GSASIIscriptable</code>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é€šã˜ã¦Pythonã‹ã‚‰æ“ä½œå¯èƒ½ã§ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã€ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã€ç²¾å¯†åŒ–å®Ÿè¡Œã€çµæœæŠ½å‡ºã¾ã§è‡ªå‹•åŒ–ã§ãã¾ã™ã€‚</p>
            <p>è©³ç´°: <a href="https://subversion.xray.aps.anl.gov/pyGSAS/trunk/help/GSASIIscriptable.html">GSAS-II Scriptable Documentation</a></p>
        </blockquote>

        <pre><code class="language-python"># ========================================
# GSAS-IIé€£æºã®æ¦‚å¿µã‚³ãƒ¼ãƒ‰ (è¦GSAS-IIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«)
# ========================================

# import GSASIIscriptable as G2sc
#
# # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
# gpx = G2sc.G2Project(newgpx='my_rietveld.gpx')
#
# # XRDãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
# hist = gpx.add_powder_histogram('sample.xy', 'PWDR')
#
# # ç›¸ã®è¿½åŠ  (CIFã‹ã‚‰)
# phase = gpx.add_phase('Fe.cif', phasename='alpha-Fe', histograms=[hist])
#
# # ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆç²¾å¯†åŒ–å®Ÿè¡Œ
# gpx.do_refinements([
#     {'set': {'Background': {'refine': True}}},
#     {'set': {'Cell': True, 'Atoms': True}},
# ])
#
# # çµæœæŠ½å‡º
# results = gpx.get_Covariance()
# print(f"Rwp = {results['Rvals']['Rwp']:.2f}%")
#
# # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜
# gpx.save()
</code></pre>

        <h2>å­¦ç¿’ç›®æ¨™ã®ç¢ºèª</h2>

        <p>ã“ã®ç« ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã‚’èª¬æ˜ãƒ»å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™:</p>

        <div class="learning-objectives">
            <h3>åŸºæœ¬ç†è§£</h3>
            <ul>
                <li>âœ… å®Ÿè·µçš„ãªXRDè§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼(ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿â†’ç²¾å¯†åŒ–â†’å ±å‘Š)ã®å…¨ä½“åƒ</li>
                <li>âœ… å¤šç›¸æ··åˆç‰©è§£æã«ãŠã‘ã‚‹æ®µéšçš„ç²¾å¯†åŒ–ã®æˆ¦ç•¥</li>
                <li>âœ… RIRæ³•ã¨Rietveldæ³•ã«ã‚ˆã‚‹å®šé‡ç›¸åˆ†æã®é•ã„ã¨é©ç”¨å ´é¢</li>
                <li>âœ… åæŸå¤±æ•—ã€GOFç•°å¸¸ã€è² ã®å æœ‰ç‡ãªã©ã®å…¸å‹çš„ã‚¨ãƒ©ãƒ¼ã¨ãã®åŸå› </li>
            </ul>

            <h3>å®Ÿè·µã‚¹ã‚­ãƒ«</h3>
            <ul>
                <li>âœ… .xy, .datå½¢å¼ã®XRDãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€å‰å‡¦ç†ã‚’å®Ÿè¡Œ</li>
                <li>âœ… 2ç›¸æ··åˆç‰©(Î±-Fe + Feâ‚ƒOâ‚„)ã®å®Œå…¨ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æ</li>
                <li>âœ… ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã‹ã‚‰é‡é‡åˆ†ç‡ã‚’è¨ˆç®—(Rietveldå®šé‡)</li>
                <li>âœ… è«–æ–‡å“è³ªã®ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆãƒ—ãƒ­ãƒƒãƒˆä½œæˆ(matplotlib)</li>
                <li>âœ… ç²¾å¯†åŒ–çµæœã‚’CIFãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›</li>
            </ul>

            <h3>å¿œç”¨åŠ›</h3>
            <ul>
                <li>âœ… åæŸè¨ºæ–­ãƒ„ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’è‡ªå‹•æ¤œå‡ºã—ã€å¯¾å‡¦</li>
                <li>âœ… ç›¸é–¢ã®å¼·ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(æ ¼å­å®šæ•°ã¨æ¸©åº¦å› å­)ã®æœ€é©åŒ–æˆ¦ç•¥</li>
                <li>âœ… GSAS-IIã¨Pythonã‚’é€£æºã•ã›ãŸé«˜åº¦ãªè§£æãƒ•ãƒ­ãƒ¼</li>
                <li>âœ… å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹å®Œå…¨ãªè§£æâ†’æ¤œè¨¼â†’å ±å‘Šã®ã‚µã‚¤ã‚¯ãƒ«å®Ÿè¡Œ</li>
            </ul>
        </div>

        <h2>æ¼”ç¿’å•é¡Œ</h2>

        <h3>Easy (åŸºç¤ç¢ºèª)</h3>

        <details>
            <summary><strong>Q1</strong>: RIRæ³•ã¨Rietveldæ³•ã®å®šé‡ç›¸åˆ†æã®ä¸»ãªé•ã„ã¯ä½•ã§ã™ã‹?</summary>

            <p><strong>è§£ç­”</strong>:</p>
            <table>
                <thead>
                    <tr>
                        <th>é …ç›®</th>
                        <th>RIRæ³•</th>
                        <th>Rietveldæ³•</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿</strong></td>
                        <td>æœ€å¼·ãƒ”ãƒ¼ã‚¯ã®å¼·åº¦ã®ã¿</td>
                        <td>å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³(å…¨2Î¸ç¯„å›²)</td>
                    </tr>
                    <tr>
                        <td><strong>ç²¾åº¦</strong></td>
                        <td>Â±5-10%</td>
                        <td>Â±1-3%</td>
                    </tr>
                    <tr>
                        <td><strong>å¿…è¦æƒ…å ±</strong></td>
                        <td>RIRå€¤(PDF Card)</td>
                        <td>çµæ™¶æ§‹é€ (CIF)</td>
                    </tr>
                    <tr>
                        <td><strong>è¨ˆç®—æ™‚é–“</strong></td>
                        <td>æ•°ç§’</td>
                        <td>æ•°åˆ†ã€œæ•°æ™‚é–“</td>
                    </tr>
                    <tr>
                        <td><strong>é©ç”¨å ´é¢</strong></td>
                        <td>ç°¡æ˜“ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</td>
                        <td>ç²¾å¯†å®šé‡åˆ†æ</td>
                    </tr>
                </tbody>
            </table>
            <p><strong>çµè«–</strong>: RIRæ³•ã¯è¿…é€Ÿãªæ¨å®šã€Rietveldæ³•ã¯é«˜ç²¾åº¦å®šé‡ã«é©ã—ã¦ã„ã¾ã™ã€‚</p>
        </details>

        <details>
            <summary><strong>Q2</strong>: 3ç›¸æ··åˆç‰©ã®ç²¾å¯†åŒ–ã§ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(U, V, W)ã‚’å…¨ç›¸ã§å…±é€šã«ã™ã‚‹ç†ç”±ã¯?</summary>

            <p><strong>è§£ç­”</strong>:</p>
            <p><strong>ç†ç”±</strong>:</p>
            <ol>
                <li><strong>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã®å‰Šæ¸›</strong>: 3ç›¸ã§å€‹åˆ¥ã«U, V, Wã‚’ç²¾å¯†åŒ–ã™ã‚‹ã¨9ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€‚å…±é€šåŒ–ã§3ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å‰Šæ¸›ã€‚</li>
                <li><strong>ç‰©ç†çš„å¦¥å½“æ€§</strong>: U, V, Wã¯è£…ç½®èµ·å› ã®ãƒ”ãƒ¼ã‚¯å¹…ã‚’è¡¨ã™ãŸã‚ã€å…¨ç›¸ã§å…±é€šã§ã‚ã‚‹ã¹ãã€‚</li>
                <li><strong>åæŸã®å®‰å®šæ€§</strong>: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå°‘ãªã„ã»ã©ã€æœ€å°åŒ–ãŒå®‰å®šã€‚</li>
            </ol>
            <p><strong>ãŸã ã—</strong>: çµæ™¶å­ã‚µã‚¤ã‚ºã‚„microstrainãŒç›¸ã«ã‚ˆã£ã¦å¤§ããç•°ãªã‚‹å ´åˆã¯ã€å€‹åˆ¥ã«ç²¾å¯†åŒ–ãŒå¿…è¦ãªå ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚</p>
        </details>

        <h3>Medium (å¿œç”¨)</h3>

        <details>
            <summary><strong>Q3</strong>: Î±-Fe(a=2.866Ã…, Z=2, M=55.845) ã¨ Feâ‚ƒOâ‚„(a=8.396Ã…, Z=8, M=231.533) ã®2ç›¸æ··åˆç‰©ã§ã€ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ãŒS_Fe=1.5, S_Fe3O4=0.8ã¨ç²¾å¯†åŒ–ã•ã‚Œã¾ã—ãŸã€‚å„ç›¸ã®é‡é‡åˆ†ç‡ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</summary>

            <p><strong>è§£ç­”</strong>:</p>
            <pre><code class="language-python">import numpy as np

# ãƒ‡ãƒ¼ã‚¿
S = [1.5, 0.8]
Z = [2, 8]
M = [55.845, 231.533]
V = [2.866**3, 8.396**3]  # aÂ³

# S*Z*M*V
S_ZMV = np.array(S) * np.array(Z) * np.array(M) * np.array(V)
print(f"S*Z*M*V: {S_ZMV}")

# é‡é‡åˆ†ç‡
wt_fractions = S_ZMV / S_ZMV.sum()
print(f"Î±-Fe: {wt_fractions[0]*100:.2f} wt%")
print(f"Feâ‚ƒOâ‚„: {wt_fractions[1]*100:.2f} wt%")
</code></pre>
            <p><strong>å‡ºåŠ›</strong>:</p>
            <pre><code>S*Z*M*V: [2650.13 908536.45]
Î±-Fe: 0.29 wt%
Feâ‚ƒOâ‚„: 99.71 wt%</code></pre>
            <p>Feâ‚ƒOâ‚„ãŒåœ§å€’çš„ã«å¤šã„è©¦æ–™ã¨åˆ¤æ˜ã—ã¾ã™ã€‚</p>
        </details>

        <details>
            <summary><strong>Q4</strong>: ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆç²¾å¯†åŒ–ã§ã€ŒGOF = 0.85ã€ã¨ãªã‚Šã¾ã—ãŸã€‚ä½•ãŒå•é¡Œã§ã€ã©ã†å¯¾å‡¦ã™ã¹ãã§ã™ã‹?</summary>

            <p><strong>è§£ç­”</strong>:</p>
            <p><strong>å•é¡Œ</strong>: GOF < 1.0 ã¯<strong>éå‰°ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</strong>ã®å¯èƒ½æ€§ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¤šã™ãã¦ã€ãƒã‚¤ã‚ºã¾ã§ãƒ•ã‚£ãƒƒãƒˆã—ã¦ã„ã‚‹ã€‚</p>
            <p><strong>å¯¾å‡¦æ³•</strong>:</p>
            <ol>
                <li><strong>ä¸è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å›ºå®š</strong>: æ¸©åº¦å› å­ã€å æœ‰ç‡ãŒ1.0ã«è¿‘ã„ãªã‚‰å›ºå®š</li>
                <li><strong>ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ¬¡æ•°ã‚’ä¸‹ã’ã‚‹</strong>: Chebyshev 5æ¬¡ â†’ 3æ¬¡</li>
                <li><strong>åˆ¶ç´„æ¡ä»¶ã‚’è¿½åŠ </strong>: åŒ–å­¦çµåˆé•·ãªã©ã®æ‹˜æŸã‚’å¼·åŒ–</li>
                <li><strong>ãƒ‡ãƒ¼ã‚¿ã®è³ªã‚’ç¢ºèª</strong>: æ¸¬å®šæ™‚é–“ãŒé•·ã™ãã¦ã€çµ±è¨ˆãƒã‚¤ã‚ºãŒæ¥µç«¯ã«å°ã•ã„å¯èƒ½æ€§</li>
            </ol>
            <p><strong>ç›®æ¨™</strong>: GOF = 1.0 - 2.0 ãŒç†æƒ³çš„ã€‚</p>
        </details>

        <h3>Hard (ç™ºå±•)</h3>

        <details>
            <summary><strong>Q5</strong>: å®Œå…¨ãª2ç›¸ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚Î±-Fe(BCC)ã¨Feâ‚ƒOâ‚„(Spinel)ã®æ··åˆç‰©ã‚’æƒ³å®šã—ã€æ ¼å­å®šæ•°ã€ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç²¾å¯†åŒ–ã—ã€é‡é‡åˆ†ç‡ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</summary>

            <p><strong>è§£ç­”</strong>:</p>
            <p>(Example 3ã®TwoPhaseRietveldã‚¯ãƒ©ã‚¹ã‚’æ‹¡å¼µ)</p>
            <pre><code class="language-python"># å®Œå…¨ç‰ˆã¯ Example 3 ã‚’å‚ç…§
# è¿½åŠ æ©Ÿèƒ½: é‡é‡åˆ†ç‡è¨ˆç®—

class TwoPhaseRietveldComplete(TwoPhaseRietveld):
    """2ç›¸ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æ + å®šé‡åˆ†æ"""

    def calculate_weight_fractions(self, result):
        """é‡é‡åˆ†ç‡ã‚’è¨ˆç®—"""
        a_Fe = result.params['a_Fe'].value
        a_Fe3O4 = result.params['a_Fe3O4'].value

        S_Fe = result.params['scale_Fe'].value
        S_Fe3O4 = result.params['scale_Fe3O4'].value

        # çµæ™¶ãƒ‡ãƒ¼ã‚¿
        Z_Fe, M_Fe, V_Fe = 2, 55.845, a_Fe**3
        Z_Fe3O4, M_Fe3O4, V_Fe3O4 = 8, 231.533, a_Fe3O4**3

        # S*Z*M*V
        S_ZMV_Fe = S_Fe * Z_Fe * M_Fe * V_Fe
        S_ZMV_Fe3O4 = S_Fe3O4 * Z_Fe3O4 * M_Fe3O4 * V_Fe3O4

        total = S_ZMV_Fe + S_ZMV_Fe3O4

        wt_Fe = S_ZMV_Fe / total
        wt_Fe3O4 = S_ZMV_Fe3O4 / total

        return {'Î±-Fe': wt_Fe, 'Feâ‚ƒOâ‚„': wt_Fe3O4}

# å®Ÿè¡Œ
two_phase_complete = TwoPhaseRietveldComplete(two_theta_test, intensity_test)
result = two_phase_complete.refine()
wt_fractions = two_phase_complete.calculate_weight_fractions(result)

print("=== å®šé‡åˆ†æçµæœ ===")
for phase, wt in wt_fractions.items():
    print(f"{phase}: {wt*100:.2f} wt%")
</code></pre>
        </details>

        <details>
            <summary><strong>Q6</strong>: å®Ÿæ¸¬XRDãƒ‡ãƒ¼ã‚¿(.xyå½¢å¼)ã‚’ç”¨æ„ã—ã€å®Œå…¨ãªè§£æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼(ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿â†’ç²¾å¯†åŒ–â†’å¯è¦–åŒ–â†’CIFå‡ºåŠ›)ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</summary>

            <p><strong>è§£ç­”</strong>:</p>
            <p>ã“ã®å•é¡Œã¯ã€å®Ÿéš›ã®.xyãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨ã„ã¦ã€Example 2ã®CompleteXRDWorkflowã‚¯ãƒ©ã‚¹ã‚’é©ç”¨ã—ã¾ã™ã€‚</p>
            <pre><code class="language-python"># å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ã§ã®å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
workflow = CompleteXRDWorkflow('å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿.xy', wavelength=1.5406)

# Step 1-5ã‚’é †æ¬¡å®Ÿè¡Œ
workflow.step1_load_data(skip_rows=1)
workflow.step2_peak_detection(prominence=0.15)
workflow.step3_rietveld_refinement()
results = workflow.step4_extract_results()
workflow.step5_visualize(save_path='å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿_Rietveld.pdf')

# CIFå‡ºåŠ› (pymatgen Structureã‚’äº‹å‰ã«å®šç¾©)
from pymatgen.core import Structure, Lattice

a_refined = results['lattice_a'].value
structure = Structure(Lattice.cubic(a_refined), ["Fe"], [[0, 0, 0]])

export_to_cif(structure,
              {'a': a_refined, 'b': a_refined, 'c': a_refined},
              {'Rwp': results['Rwp'], 'GOF': results['GOF'], 'ndata': len(workflow.two_theta), 'date': '2025-10-28'},
              'Fe_refined.cif')
</code></pre>
        </details>

        <h2>ã‚·ãƒªãƒ¼ã‚ºã®ã¾ã¨ã‚</h2>

        <p>ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™! Xç·šå›æŠ˜åˆ†æå…¥é–€ã‚·ãƒªãƒ¼ã‚ºã®å…¨5ç« ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®ã‚·ãƒªãƒ¼ã‚ºã‚’é€šã˜ã¦ã€ä»¥ä¸‹ã®ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã—ã¾ã—ãŸ:</p>

        <h3>ç¿’å¾—ã—ãŸçŸ¥è­˜ãƒ»ã‚¹ã‚­ãƒ«</h3>

        <ul>
            <li>âœ… <strong>ç¬¬1ç« </strong>: Xç·šå›æŠ˜ã®åŸºç¤ç†è«–(Braggã®æ³•å‰‡ã€æ§‹é€ å› å­ã€æ¶ˆæ»…å‰‡)</li>
            <li>âœ… <strong>ç¬¬2ç« </strong>: ç²‰æœ«XRDæ¸¬å®šã¨åŸºæœ¬è§£æ(ãƒ”ãƒ¼ã‚¯æ¤œå‡ºã€ã‚¤ãƒ³ãƒ‡ã‚­ã‚·ãƒ³ã‚°ã€æ ¼å­å®šæ•°è¨ˆç®—)</li>
            <li>âœ… <strong>ç¬¬3ç« </strong>: ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆæ³•ã®åŸç†(ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«é–¢æ•°ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã€Rå› å­)</li>
            <li>âœ… <strong>ç¬¬4ç« </strong>: æ§‹é€ ç²¾å¯†åŒ–(åŸå­åº§æ¨™ã€æ¸©åº¦å› å­ã€çµæ™¶å­ã‚µã‚¤ã‚ºã€microstrain)</li>
            <li>âœ… <strong>ç¬¬5ç« </strong>: å®Ÿè·µãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼(å¤šç›¸è§£æã€å®šé‡åˆ†æã€ã‚¨ãƒ©ãƒ¼è¨ºæ–­ã€å­¦è¡“å ±å‘Š)</li>
        </ul>

        <h3>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>

        <p>XRDè§£æã®åŸºç¤ã‚’ç¿’å¾—ã—ãŸã‚ãªãŸã¯ã€ä»¥ä¸‹ã®ãƒˆãƒ”ãƒƒã‚¯ã«é€²ã‚€ã“ã¨ãŒã§ãã¾ã™:</p>

        <ul>
            <li><strong>é«˜åº¦ãªXRDæŠ€è¡“</strong>: è–„è†œXRDã€é«˜æ¸©ãƒ»ãã®å ´XRDã€å…¨æ•£ä¹±PDFè§£æ</li>
            <li><strong>ä¸­æ€§å­å›æŠ˜</strong>: è»½å…ƒç´ ã®ç²¾å¯†æ§‹é€ è§£æã€ç£æ°—æ§‹é€ æ±ºå®š</li>
            <li><strong>å˜çµæ™¶XRD</strong>: ç²¾å¯†æ§‹é€ æ±ºå®šã€çµæ™¶å¯¾ç§°æ€§ã®æ±ºå®š</li>
            <li><strong>æ©Ÿæ¢°å­¦ç¿’ã¨XRD</strong>: è‡ªå‹•ç›¸åŒå®šã€ç•°å¸¸æ¤œçŸ¥ã€é€†å•é¡Œã«ã‚ˆã‚‹æ§‹é€ äºˆæ¸¬</li>
        </ul>

        <blockquote>
            <p><strong>ğŸ“ å­¦ç¿’ã®ç¶™ç¶š</strong></p>
            <p>å®Ÿéš›ã®XRDãƒ‡ãƒ¼ã‚¿ã§ç·´ç¿’ã‚’é‡ã­ã€è«–æ–‡ã‚’èª­ã¿ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£(X-ray Discussion Forumã‚„Stack Exchangeãªã©)ã§è³ªå•ã™ã‚‹ã“ã¨ã§ã€ã•ã‚‰ã«ã‚¹ã‚­ãƒ«ã‚’ç£¨ã„ã¦ãã ã•ã„ã€‚</p>
        </blockquote>

        <h2>å‚è€ƒæ–‡çŒ®ãƒ»ãƒªã‚½ãƒ¼ã‚¹</h2>

        <h3>æ•™ç§‘æ›¸</h3>
        <ol>
            <li>Pecharsky, V. K., & Zavalij, P. Y. (2009). <em>Fundamentals of Powder Diffraction and Structural Characterization of Materials</em> (2nd ed.). Springer.</li>
            <li>Dinnebier, R. E., & Billinge, S. J. L. (Eds.). (2008). <em>Powder Diffraction: Theory and Practice</em>. Royal Society of Chemistry.</li>
            <li>Young, R. A. (Ed.). (1993). <em>The Rietveld Method</em>. Oxford University Press.</li>
        </ol>

        <h3>ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢</h3>
        <ul>
            <li><strong>GSAS-II</strong>: <a href="https://subversion.xray.aps.anl.gov/pyGSAS/trunk/help/">https://subversion.xray.aps.anl.gov/pyGSAS/</a></li>
            <li><strong>FullProf</strong>: <a href="https://www.ill.eu/sites/fullprof/">https://www.ill.eu/sites/fullprof/</a></li>
            <li><strong>TOPAS</strong>: <a href="https://www.bruker.com/topas">https://www.bruker.com/topas</a></li>
            <li><strong>pymatgen</strong>: <a href="https://pymatgen.org/">https://pymatgen.org/</a></li>
        </ul>

        <h3>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</h3>
        <ul>
            <li><strong>ICDD PDF-4+</strong>: ç²‰æœ«å›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</li>
            <li><strong>Crystallography Open Database (COD)</strong>: <a href="http://www.crystallography.net/">http://www.crystallography.net/</a></li>
            <li><strong>Materials Project</strong>: <a href="https://materialsproject.org/">https://materialsproject.org/</a></li>
        </ul>

        <h2>è¬è¾</h2>

        <p>ã“ã®ã‚·ãƒªãƒ¼ã‚ºã¯ã€Materials Scienceæ•™è‚²ã®ä¸€ç’°ã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã—ãŸã€‚XRDè§£æã®åŸºç¤ã‹ã‚‰å®Ÿè·µã¾ã§ã€ä½“ç³»çš„ã«å­¦ã¹ã‚‹æ—¥æœ¬èªãƒªã‚½ãƒ¼ã‚¹ã®å……å®Ÿã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚</p>

        <p><strong>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ»è³ªå•</strong>ã¯ã€<a href="mailto:yusuke.hashimoto.b8@tohoku.ac.jp">yusuke.hashimoto.b8@tohoku.ac.jp</a> ã¾ã§ãŠå¯„ã›ãã ã•ã„ã€‚</p>

        <div class="navigation">
            <a href="./chapter-4.html" class="nav-button">â† ç¬¬4ç« : çµæ™¶æ§‹é€ ç²¾å¯†åŒ–</a>
            <a href="./index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 MS Terakoya - Materials Science Learning Platform</p>
        <p><a href="../../index.html">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a></p>
    </footer>
</body>
</html>
