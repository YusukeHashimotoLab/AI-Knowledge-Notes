<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4ç« ï¼šXç·šå›æŠ˜ã®åŸç†ã¨å¿œç”¨ - MS Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #f093fb;
            --color-accent-light: #f5576c;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #f093fb;
            --color-link-hover: #d07be8;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-size: 0.9rem;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .info-box h3,
        .info-box h4 {
            color: #1976d2;
            margin-top: 0;
        }

        .warning-box {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .warning-box h3,
        .warning-box h4 {
            color: #f57c00;
            margin-top: 0;
        }

        .success-box {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .success-box h3,
        .success-box h4 {
            color: #388e3c;
            margin-top: 0;
        }

        .example-box {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .example-box h4 {
            color: var(--color-primary);
            margin-top: 0;
            margin-bottom: var(--spacing-sm);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            overflow-x: auto;
            display: block;
        }

        thead {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        th, td {
            padding: var(--spacing-sm);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        tr:hover {
            background-color: var(--color-bg-alt);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f093fb15 0%, #f5576c15 100%);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            border: 2px solid var(--color-accent);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .breadcrumb {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        .breadcrumb a {
            color: var(--color-link);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
            gap: var(--spacing-md);
        }

        .nav-button {
            display: inline-flex;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 500;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
            text-decoration: none;
        }

        .nav-button.prev::before {
            content: "â† ";
            margin-right: 0.5rem;
        }

        .nav-button.next::after {
            content: " â†’";
            margin-left: 0.5rem;
        }

        .exercise {
            background-color: #fce4ec;
            border-left: 4px solid #e91e63;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .exercise h3,
        .exercise h4 {
            color: #c2185b;
            margin-top: 0;
        }

        .mermaid {
            background-color: white;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            .nav-button {
                width: 100%;
                justify-content: center;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }

        .mjx-chtml {
            font-size: 1.1em !important;
        }

        .formula-block {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            text-align: center;
            overflow-x: auto;
        }
    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/MS/crystallography-introduction/chapter-4.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<header>
        <div class="header-content">
            <h1>ç¬¬4ç« ï¼šXç·šå›æŠ˜ã®åŸç†ã¨å¿œç”¨</h1>
            <p class="subtitle">ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã‹ã‚‰å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿è§£æã¾ã§</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– æ¨å®šå­¦ç¿’æ™‚é–“: 30åˆ†</span>
                <span class="meta-item">ğŸ¯ é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 8å€‹</span>
            </div>
        </div>
    </header>

    <div class="breadcrumb">
        <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a> &gt;
        <a href="../index.html">MS Dojo</a> &gt;
        <a href="index.html">çµæ™¶å­¦å…¥é–€</a> &gt;
        ç¬¬4ç« 
    </div>

    <div class="container">
        <div class="learning-objectives">
            <h2>å­¦ç¿’ç›®æ¨™</h2>
            <p>ã“ã®ç« ã‚’å­¦ã¶ã“ã¨ã§ã€ä»¥ä¸‹ã®çŸ¥è­˜ã¨ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
            <ul>
                <li><strong>Xç·šã¨ç‰©è³ªã®ç›¸äº’ä½œç”¨</strong>ã®åŸºç¤ã‚’ç†è§£ã™ã‚‹</li>
                <li><strong>ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ nÎ» = 2d sinÎ¸</strong>ã‚’å°å‡ºã—ã€ç‰©ç†çš„æ„å‘³ã‚’èª¬æ˜ã§ãã‚‹</li>
                <li><strong>æ§‹é€ å› å­ F<sub>hkl</sub></strong>ã‚’è¨ˆç®—ã—ã€å›æŠ˜å¼·åº¦ã¸ã®å½±éŸ¿ã‚’ç†è§£ã™ã‚‹</li>
                <li><strong>æ¶ˆæ»…å‰‡ï¼ˆç³»çµ±çš„æ¶ˆæ»…ï¼‰</strong>ã‹ã‚‰çµæ™¶æ§‹é€ ã‚’æ¨å®šã§ãã‚‹</li>
                <li><strong>ç²‰æœ«Xç·šå›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³</strong>ã‚’è§£é‡ˆã—ã€ãƒ”ãƒ¼ã‚¯åŒå®šãŒã§ãã‚‹</li>
                <li><strong>ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æ</strong>ã®åŸºç¤æ¦‚å¿µã‚’ç†è§£ã™ã‚‹</li>
                <li><strong>å®Ÿæ¸¬XRDãƒ‡ãƒ¼ã‚¿</strong>ã‚’Pythonã§è§£æã§ãã‚‹</li>
            </ul>
        </div>

        <h2>1. Xç·šã¨çµæ™¶ã®ç›¸äº’ä½œç”¨</h2>

        <h3>1.1 Xç·šã¨ã¯ä½•ã‹</h3>

        <p>
            <strong>Xç·šï¼ˆX-rayï¼‰</strong>ã¯ã€æ³¢é•·ãŒç´„0.01ã€œ10 nmï¼ˆ10 Ã…ï¼‰ã®é›»ç£æ³¢ã§ã™ã€‚
            ææ–™ç§‘å­¦ã§ã¯ã€ä¸»ã«<strong>Cu KÎ±ç·šï¼ˆÎ» = 1.5406 Ã…ï¼‰</strong>ã‚„<strong>Mo KÎ±ç·šï¼ˆÎ» = 0.7107 Ã…ï¼‰</strong>ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
        </p>

        <p>Xç·šã®æ³¢é•·ãŒåŸå­é–“è·é›¢ï¼ˆæ•°Ã…ï¼‰ã¨åŒç¨‹åº¦ã§ã‚ã‚‹ãŸã‚ã€çµæ™¶æ ¼å­ã«ã‚ˆã‚‹<strong>å›æŠ˜ç¾è±¡</strong>ãŒèµ·ã“ã‚Šã¾ã™ã€‚</p>

        <div class="info-box">
            <h4>ä¸»è¦ãªXç·šæº</h4>
            <table>
                <thead>
                    <tr>
                        <th>Xç·šæº</th>
                        <th>æ³¢é•· (Ã…)</th>
                        <th>ã‚¨ãƒãƒ«ã‚®ãƒ¼ (keV)</th>
                        <th>ä¸»ãªç”¨é€”</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Cu KÎ±</td>
                        <td>1.5406</td>
                        <td>8.05</td>
                        <td>ç²‰æœ«XRDã€ä¸€èˆ¬çš„ãªæ§‹é€ è§£æ</td>
                    </tr>
                    <tr>
                        <td>Mo KÎ±</td>
                        <td>0.7107</td>
                        <td>17.48</td>
                        <td>å˜çµæ™¶XRDã€çŸ­æ³¢é•·ãŒå¿…è¦ãªå ´åˆ</td>
                    </tr>
                    <tr>
                        <td>Co KÎ±</td>
                        <td>1.7902</td>
                        <td>6.93</td>
                        <td>é‰„ã‚’å«ã‚€è©¦æ–™ï¼ˆè›å…‰Xç·šå›é¿ï¼‰</td>
                    </tr>
                    <tr>
                        <td>ã‚·ãƒ³ã‚¯ãƒ­ãƒˆãƒ­ãƒ³</td>
                        <td>å¯å¤‰</td>
                        <td>å¯å¤‰</td>
                        <td>é«˜è¼åº¦ã€é«˜åˆ†è§£èƒ½æ¸¬å®š</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h3>1.2 Xç·šå›æŠ˜ã®åŸºæœ¬åŸç†</h3>

        <p>Xç·šãŒçµæ™¶ã«å…¥å°„ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒèµ·ã“ã‚Šã¾ã™ï¼š</p>

        <div class="mermaid">
            flowchart TD
                A[Xç·šå…¥å°„] --> B[å„åŸå­ã«ã‚ˆã‚‹æ•£ä¹±]
                B --> C{æ•£ä¹±æ³¢ã®å¹²æ¸‰}
                C -->|ä½ç›¸ãŒæƒã†| D[å¼·ã‚åˆã„ï¼šå›æŠ˜ãƒ”ãƒ¼ã‚¯]
                C -->|ä½ç›¸ãŒãšã‚Œã‚‹| E[å¼±ã‚åˆã„ï¼šæ¶ˆæ»…]
                D --> F[æ¤œå‡ºå™¨ã§ãƒ”ãƒ¼ã‚¯è¦³æ¸¬]
                E --> G[ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰]

                style A fill:#e3f2fd
                style B fill:#e3f2fd
                style C fill:#fff3e0
                style D fill:#e8f5e9
                style E fill:#ffebee
                style F fill:#e8f5e9
                style G fill:#ffebee
        </div>

        <p>
            çµæ™¶å†…ã®å„åŸå­ãŒXç·šã‚’æ•£ä¹±ã—ã€æ•£ä¹±æ³¢ãŒ<strong>å¹²æ¸‰</strong>ã—ã¾ã™ã€‚
            ç‰¹å®šã®è§’åº¦ã§æ•£ä¹±æ³¢ã®ä½ç›¸ãŒæƒã†ã¨<strong>å¼·ã‚åˆã„</strong>ã€<strong>å›æŠ˜ãƒ”ãƒ¼ã‚¯</strong>ã¨ã—ã¦è¦³æ¸¬ã•ã‚Œã¾ã™ã€‚
        </p>

        <h2>2. ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡</h2>

        <h3>2.1 ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã®å°å‡º</h3>

        <p>
            1913å¹´ã€ã‚¦ã‚£ãƒªã‚¢ãƒ ãƒ»ãƒ­ãƒ¼ãƒ¬ãƒ³ã‚¹ãƒ»ãƒ–ãƒ©ãƒƒã‚°ï¼ˆW. L. Braggï¼‰ã¨ãã®çˆ¶ã‚¦ã‚£ãƒªã‚¢ãƒ ãƒ»ãƒ˜ãƒ³ãƒªãƒ¼ãƒ»ãƒ–ãƒ©ãƒƒã‚°ï¼ˆW. H. Braggï¼‰ã¯ã€
            Xç·šå›æŠ˜ã‚’<strong>çµæ™¶é¢ã«ã‚ˆã‚‹é¡é¢åå°„</strong>ã¨ã—ã¦æ‰±ã†å˜ç´”ã§å¼·åŠ›ãªãƒ¢ãƒ‡ãƒ«ã‚’ææ¡ˆã—ã¾ã—ãŸã€‚
        </p>

        <div class="info-box">
            <h4>ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ï¼ˆBragg's Lawï¼‰</h4>
            <div class="formula-block">
                $$
                n\lambda = 2d_{hkl}\sin\theta
                $$
            </div>
            <p>ã“ã“ã§ï¼š</p>
            <ul>
                <li><strong>n</strong>ï¼šåå°„ã®æ¬¡æ•°ï¼ˆé€šå¸¸ã¯1ï¼‰</li>
                <li><strong>Î»</strong>ï¼šXç·šã®æ³¢é•·</li>
                <li><strong>d<sub>hkl</sub></strong>ï¼š(hkl)é¢ã®é¢é–“éš”</li>
                <li><strong>Î¸</strong>ï¼šãƒ–ãƒ©ãƒƒã‚°è§’ï¼ˆå…¥å°„è§’ = åå°„è§’ï¼‰</li>
            </ul>
        </div>

        <h4>å°å‡ºã®è€ƒãˆæ–¹</h4>

        <p>
            é¢é–“éš”dã§å¹³è¡Œã«ä¸¦ã¶çµæ™¶é¢ã«è§’åº¦Î¸ã§Xç·šãŒå…¥å°„ã™ã‚‹å ´åˆã‚’è€ƒãˆã¾ã™ã€‚
            ä¸Šã®é¢ã§åå°„ã—ãŸæ³¢ã¨ã€ä¸‹ã®é¢ã§åå°„ã—ãŸæ³¢ã®<strong>å…‰è·¯å·®</strong>ãŒæ³¢é•·Î»ã®æ•´æ•°å€ã§ã‚ã‚Œã°ã€
            å¼·ã‚åˆã„ãŒèµ·ã“ã‚Šã¾ã™ã€‚
        </p>

        <p>å…‰è·¯å·®ã¯å¹¾ä½•å­¦çš„ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨ˆç®—ã•ã‚Œã¾ã™ï¼š</p>

        <div class="formula-block">
            $$
            \text{å…‰è·¯å·®} = 2d\sin\theta
            $$
        </div>

        <p>å¼·ã‚åˆã„ã®æ¡ä»¶ã¯ï¼š</p>

        <div class="formula-block">
            $$
            2d\sin\theta = n\lambda \quad (n = 1, 2, 3, \ldots)
            $$
        </div>

        <div class="warning-box">
            <h4>é‡è¦ãªæ³¨æ„ç‚¹</h4>
            <p>
                ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã¯<strong>å›æŠ˜ãŒèµ·ã“ã‚‹å¿…è¦æ¡ä»¶</strong>ã§ã‚ã‚Šã€<strong>ååˆ†æ¡ä»¶ã§ã¯ã‚ã‚Šã¾ã›ã‚“</strong>ã€‚
                å®Ÿéš›ã«ã¯ã€<strong>æ§‹é€ å› å­ F<sub>hkl</sub></strong>ãŒã‚¼ãƒ­ã§ãªã„ã“ã¨ã‚‚å¿…è¦ã§ã™ï¼ˆå¾Œè¿°ï¼‰ã€‚
            </p>
        </div>

        <h3>2.2 ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã‚’ä½¿ã£ãŸè¨ˆç®—</h3>

        <div class="example-box">
            <h4>ã‚³ãƒ¼ãƒ‰ä¾‹1ï¼šãƒ–ãƒ©ãƒƒã‚°è§’ã®è¨ˆç®—</h4>
            <p>ã‚·ãƒªã‚³ãƒ³ï¼ˆSiï¼‰ã®ä¸»è¦ãªçµæ™¶é¢ã‹ã‚‰ã®å›æŠ˜è§’ã‚’è¨ˆç®—ã—ã¾ã™ï¼š</p>
        </div>

        <pre class="line-numbers"><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

def cubic_d_spacing(a, h, k, l):
    """
    ç«‹æ–¹æ™¶ã®é¢é–“éš”ã‚’è¨ˆç®—

    Parameters:
    -----------
    a : float
        æ ¼å­å®šæ•° (Ã…)
    h, k, l : int
        ãƒŸãƒ©ãƒ¼æŒ‡æ•°

    Returns:
    --------
    float : é¢é–“éš” (Ã…)
    """
    return a / np.sqrt(h**2 + k**2 + l**2)

def bragg_angle(d_hkl, wavelength, n=1):
    """
    ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã‹ã‚‰å›æŠ˜è§’ 2Î¸ ã‚’è¨ˆç®—

    Parameters:
    -----------
    d_hkl : float
        é¢é–“éš” (Ã…)
    wavelength : float
        Xç·šæ³¢é•· (Ã…)
    n : int
        åå°„ã®æ¬¡æ•°

    Returns:
    --------
    float : å›æŠ˜è§’ 2Î¸ (åº¦)ã€ã¾ãŸã¯Noneï¼ˆå›æŠ˜ä¸å¯ã®å ´åˆï¼‰
    """
    sin_theta = n * wavelength / (2 * d_hkl)
    if abs(sin_theta) > 1:
        return None  # å›æŠ˜æ¡ä»¶ã‚’æº€ãŸã•ãªã„
    theta = np.arcsin(sin_theta)
    return np.degrees(2 * theta)  # 2Î¸ ã‚’è¿”ã™

# ã‚·ãƒªã‚³ãƒ³ï¼ˆSiï¼‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
a_Si = 5.4310  # Ã…
wavelength_CuKa = 1.5406  # Ã…

print("=== ã‚·ãƒªã‚³ãƒ³ï¼ˆSiï¼‰ã®Xç·šå›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³äºˆæ¸¬ ===")
print(f"æ ¼å­å®šæ•°: a = {a_Si} Ã…")
print(f"Xç·šæ³¢é•·: Î» = {wavelength_CuKa} Ã… (Cu KÎ±)\n")

# ä¸»è¦ãªçµæ™¶é¢
planes = [
    (1, 1, 1), (2, 2, 0), (3, 1, 1),
    (4, 0, 0), (3, 3, 1), (4, 2, 2)
]

print(f"{'(hkl)':<10} {'d (Ã…)':<12} {'2Î¸ (åº¦)':<12}")
print("-" * 40)

results = []
for hkl in planes:
    h, k, l = hkl
    d = cubic_d_spacing(a_Si, h, k, l)
    two_theta = bragg_angle(d, wavelength_CuKa)

    if two_theta is not None:
        print(f"({h}{k}{l}){'':<8} {d:8.4f}    {two_theta:8.3f}")
        results.append((hkl, two_theta))

# ã‚°ãƒ©ãƒ•ã§ãƒ”ãƒ¼ã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¯è¦–åŒ–
fig, ax = plt.subplots(figsize=(12, 6))

for (h, k, l), two_theta in results:
    ax.axvline(two_theta, color='red', linewidth=2, alpha=0.7)
    ax.text(two_theta, 1.05, f'({h}{k}{l})',
            rotation=90, va='bottom', ha='right', fontsize=9)

ax.set_xlim(20, 100)
ax.set_ylim(0, 1.2)
ax.set_xlabel('2Î¸ (åº¦)', fontsize=14, fontweight='bold')
ax.set_ylabel('ç›¸å¯¾å¼·åº¦ï¼ˆä»»æ„å˜ä½ï¼‰', fontsize=14, fontweight='bold')
ax.set_title('ã‚·ãƒªã‚³ãƒ³ï¼ˆSiï¼‰ã®ç†è«–XRDãƒ‘ã‚¿ãƒ¼ãƒ³', fontsize=16, fontweight='bold')
ax.grid(axis='x', alpha=0.3)

plt.tight_layout()
plt.savefig('si_xrd_pattern.png', dpi=150, bbox_inches='tight')
plt.show()
print("\nXRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¿å­˜ã—ã¾ã—ãŸ: si_xrd_pattern.png")
</code></pre>

        <h3>2.3 æ³¢é•·ã¨å›æŠ˜è§’ã®é–¢ä¿‚</h3>

        <div class="example-box">
            <h4>ã‚³ãƒ¼ãƒ‰ä¾‹2ï¼šç•°ãªã‚‹Xç·šæºã§ã®å›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒ</h4>
            <p>Cu KÎ±ç·šã¨Mo KÎ±ç·šã§åŒã˜çµæ™¶é¢ã‹ã‚‰ã®å›æŠ˜è§’ãŒã©ã†å¤‰ã‚ã‚‹ã‹ã‚’æ¯”è¼ƒã—ã¾ã™ï¼š</p>
        </div>

        <pre class="line-numbers"><code class="language-python">def compare_xray_sources():
    """ç•°ãªã‚‹Xç·šæºã§ã®å›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¯”è¼ƒ"""

    # Xç·šæºã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    sources = {
        'Cu KÎ±': 1.5406,
        'Mo KÎ±': 0.7107,
        'Co KÎ±': 1.7902
    }

    # ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ï¼ˆAlï¼‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    a_Al = 4.0495  # Ã…
    planes = [(1, 1, 1), (2, 0, 0), (2, 2, 0), (3, 1, 1)]

    print("=== ç•°ãªã‚‹Xç·šæºã§ã®å›æŠ˜è§’æ¯”è¼ƒï¼ˆAlï¼‰ ===\n")
    print(f"æ ¼å­å®šæ•°: a = {a_Al} Ã…\n")

    # å„Xç·šæºã§ã®è¨ˆç®—
    fig, ax = plt.subplots(figsize=(14, 8))
    colors = {'Cu KÎ±': 'red', 'Mo KÎ±': 'blue', 'Co KÎ±': 'green'}

    for source_name, wavelength in sources.items():
        print(f"--- {source_name} (Î» = {wavelength} Ã…) ---")
        print(f"{'(hkl)':<10} {'d (Ã…)':<12} {'2Î¸ (åº¦)':<12}")
        print("-" * 40)

        y_offset = list(sources.keys()).index(source_name) * 0.3

        for hkl in planes:
            h, k, l = hkl
            d = cubic_d_spacing(a_Al, h, k, l)
            two_theta = bragg_angle(d, wavelength)

            if two_theta is not None:
                print(f"({h}{k}{l}){'':<8} {d:8.4f}    {two_theta:8.3f}")

                # æ£’ã‚°ãƒ©ãƒ•ã¨ã—ã¦è¡¨ç¤º
                ax.plot([two_theta, two_theta], [y_offset, y_offset + 0.25],
                       color=colors[source_name], linewidth=3)
                if y_offset == 0:  # æœ€åˆã®ã‚½ãƒ¼ã‚¹ã®ã¿ãƒ©ãƒ™ãƒ«è¡¨ç¤º
                    ax.text(two_theta, y_offset + 0.28, f'({h}{k}{l})',
                           rotation=90, va='bottom', ha='center', fontsize=8)
        print()

    # ã‚°ãƒ©ãƒ•ã®è£…é£¾
    ax.set_xlim(0, 150)
    ax.set_ylim(-0.1, 1.0)
    ax.set_xlabel('2Î¸ (åº¦)', fontsize=14, fontweight='bold')
    ax.set_yticks([0.125, 0.425, 0.725])
    ax.set_yticklabels(['Cu KÎ±', 'Mo KÎ±', 'Co KÎ±'])
    ax.set_title('ç•°ãªã‚‹Xç·šæºã«ã‚ˆã‚‹ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ï¼ˆAlï¼‰ã®å›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒ',
                fontsize=16, fontweight='bold')
    ax.grid(axis='x', alpha=0.3)

    # å‡¡ä¾‹
    from matplotlib.lines import Line2D
    legend_elements = [Line2D([0], [0], color=color, lw=3, label=name)
                      for name, color in colors.items()]
    ax.legend(handles=legend_elements, loc='upper right', fontsize=12)

    plt.tight_layout()
    plt.savefig('xray_source_comparison.png', dpi=150, bbox_inches='tight')
    plt.show()
    print("æ¯”è¼ƒã‚°ãƒ©ãƒ•ã‚’ä¿å­˜ã—ã¾ã—ãŸ: xray_source_comparison.png")

# å®Ÿè¡Œ
compare_xray_sources()
</code></pre>

        <div class="info-box">
            <h4>æ³¢é•·é¸æŠã®å®Ÿè·µçš„è€ƒæ…®</h4>
            <ul>
                <li><strong>çŸ­æ³¢é•·ï¼ˆMo KÎ±ï¼‰</strong>ï¼šé«˜è§’åº¦ã¾ã§æ¸¬å®šå¯èƒ½ã€å¸åãŒå°‘ãªã„ã€å˜çµæ™¶è§£æã«æœ‰åˆ©</li>
                <li><strong>é•·æ³¢é•·ï¼ˆCu KÎ±ï¼‰</strong>ï¼šä½è§’åº¦ã§ã®åˆ†è§£èƒ½ãŒé«˜ã„ã€æœ€ã‚‚ä¸€èˆ¬çš„</li>
                <li><strong>è©¦æ–™ä¾å­˜</strong>ï¼šé‰„ã‚’å«ã‚€è©¦æ–™ã§ã¯Co KÎ±ã‚’ä½¿ç”¨ï¼ˆè›å…‰Xç·šå›é¿ï¼‰</li>
            </ul>
        </div>

        <h2>3. æ§‹é€ å› å­ã¨å›æŠ˜å¼·åº¦</h2>

        <h3>3.1 æ§‹é€ å› å­ F<sub>hkl</sub> ã¨ã¯</h3>

        <p>
            ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã‚’æº€ãŸã—ã¦ã‚‚ã€å…¨ã¦ã®åå°„ãŒè¦³æ¸¬ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
            <strong>æ§‹é€ å› å­ï¼ˆstructure factorï¼‰F<sub>hkl</sub></strong>ãŒã€
            å®Ÿéš›ã®å›æŠ˜å¼·åº¦ã‚’æ±ºå®šã—ã¾ã™ã€‚
        </p>

        <div class="formula-block">
            $$
            F_{hkl} = \sum_{j=1}^{N} f_j \exp\left[2\pi i(hx_j + ky_j + lz_j)\right]
            $$
        </div>

        <p>ã“ã“ã§ï¼š</p>
        <ul>
            <li><strong>f<sub>j</sub></strong>ï¼šjç•ªç›®ã®åŸå­ã®<strong>åŸå­æ•£ä¹±å› å­</strong>ï¼ˆåŸå­ã®é›»å­æ•°ã«æ¯”ä¾‹ï¼‰</li>
            <li><strong>(x<sub>j</sub>, y<sub>j</sub>, z<sub>j</sub>)</strong>ï¼šjç•ªç›®ã®åŸå­ã®<strong>åˆ†æ•°åº§æ¨™</strong></li>
            <li><strong>N</strong>ï¼šå˜ä½æ ¼å­å†…ã®åŸå­æ•°</li>
        </ul>

        <p>
            <strong>é‡è¦</strong>ï¼šF<sub>hkl</sub> = 0 ã®å ´åˆã€ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã‚’æº€ãŸã—ã¦ã‚‚å›æŠ˜ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚
            ã“ã‚ŒãŒ<strong>æ¶ˆæ»…å‰‡ï¼ˆsystematic absenceï¼‰</strong>ã§ã™ã€‚
        </p>

        <h3>3.2 å˜ç´”ãªæ§‹é€ ã®æ§‹é€ å› å­è¨ˆç®—</h3>

        <div class="example-box">
            <h4>ã‚³ãƒ¼ãƒ‰ä¾‹3ï¼šå˜ç´”ç«‹æ–¹ãƒ»ä½“å¿ƒç«‹æ–¹ãƒ»é¢å¿ƒç«‹æ–¹ã®æ§‹é€ å› å­</h4>
        </div>

        <pre class="line-numbers"><code class="language-python">import numpy as np
import pandas as pd

def structure_factor(positions, f_atoms, h, k, l):
    """
    æ§‹é€ å› å­ F_hkl ã‚’è¨ˆç®—

    Parameters:
    -----------
    positions : list of tuples
        å˜ä½æ ¼å­å†…ã®åŸå­ã®åˆ†æ•°åº§æ¨™ [(x1,y1,z1), (x2,y2,z2), ...]
    f_atoms : list of float
        å„åŸå­ã®åŸå­æ•£ä¹±å› å­
    h, k, l : int
        ãƒŸãƒ©ãƒ¼æŒ‡æ•°

    Returns:
    --------
    complex : æ§‹é€ å› å­ F_hkl
    """
    F = 0 + 0j
    for (x, y, z), f in zip(positions, f_atoms):
        phase = 2 * np.pi * (h*x + k*y + l*z)
        F += f * np.exp(1j * phase)
    return F

def analyze_structure_factors():
    """ç•°ãªã‚‹æ ¼å­ã‚¿ã‚¤ãƒ—ã®æ§‹é€ å› å­ã‚’è§£æ"""

    # æ ¼å­ã‚¿ã‚¤ãƒ—ã”ã¨ã®åŸå­ä½ç½®
    structures = {
        'SCï¼ˆå˜ç´”ç«‹æ–¹ï¼‰': [
            (0, 0, 0)
        ],
        'BCCï¼ˆä½“å¿ƒç«‹æ–¹ï¼‰': [
            (0, 0, 0),
            (0.5, 0.5, 0.5)
        ],
        'FCCï¼ˆé¢å¿ƒç«‹æ–¹ï¼‰': [
            (0, 0, 0),
            (0.5, 0.5, 0),
            (0.5, 0, 0.5),
            (0, 0.5, 0.5)
        ],
        'Diamondï¼ˆãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰æ§‹é€ ï¼‰': [
            (0, 0, 0),
            (0.5, 0.5, 0),
            (0.5, 0, 0.5),
            (0, 0.5, 0.5),
            (0.25, 0.25, 0.25),
            (0.75, 0.75, 0.25),
            (0.75, 0.25, 0.75),
            (0.25, 0.75, 0.75)
        ]
    }

    # ãƒŸãƒ©ãƒ¼æŒ‡æ•°ã®ãƒªã‚¹ãƒˆ
    planes = [
        (1, 0, 0), (1, 1, 0), (1, 1, 1),
        (2, 0, 0), (2, 2, 0), (3, 1, 1),
        (2, 2, 2), (4, 0, 0), (3, 3, 1)
    ]

    print("=== ç•°ãªã‚‹æ ¼å­ã‚¿ã‚¤ãƒ—ã®æ§‹é€ å› å­ã¨æ¶ˆæ»…å‰‡ ===\n")

    for structure_name, positions in structures.items():
        print(f"\nã€{structure_name}ã€‘")
        print(f"å˜ä½æ ¼å­å†…ã®åŸå­æ•°: {len(positions)}\n")
        print(f"{'(hkl)':<10} {'|F_hkl|^2':<15} {'è¦³æ¸¬':<10} {'å‚™è€ƒ'}")
        print("-" * 60)

        # ã™ã¹ã¦åŒã˜åŸå­ã¨ã—ã¦åŸå­æ•£ä¹±å› å­ f = 1 ã¨ä»®å®š
        f_atoms = [1.0] * len(positions)

        for hkl in planes:
            h, k, l = hkl
            F = structure_factor(positions, f_atoms, h, k, l)
            F_squared = abs(F)**2

            # è¦³æ¸¬å¯å¦ã®åˆ¤å®šï¼ˆ|F|^2 > 0.01ã‚’è¦³æ¸¬å¯èƒ½ã¨ã™ã‚‹ï¼‰
            observable = "â—‹" if F_squared > 0.01 else "Ã—"

            # æ¶ˆæ»…æ¡ä»¶ã®èª¬æ˜
            remarks = ""
            if structure_name == 'BCCï¼ˆä½“å¿ƒç«‹æ–¹ï¼‰':
                if (h + k + l) % 2 != 0:
                    remarks = "h+k+l ãŒå¥‡æ•° â†’ æ¶ˆæ»…"
            elif structure_name == 'FCCï¼ˆé¢å¿ƒç«‹æ–¹ï¼‰':
                if not (h % 2 == k % 2 == l % 2):
                    remarks = "h,k,l ãŒæ··åˆ â†’ æ¶ˆæ»…"

            print(f"({h}{k}{l}){'':<8} {F_squared:12.4f}   {observable:<10} {remarks}")

    print("\n" + "="*60)
    print("æ¶ˆæ»…å‰‡ã®ã¾ã¨ã‚ï¼š")
    print("  SC : ã™ã¹ã¦ã®åå°„ãŒè¦³æ¸¬ã•ã‚Œã‚‹")
    print("  BCC: h+k+l ãŒå¶æ•°ã®ã¿è¦³æ¸¬ã•ã‚Œã‚‹")
    print("  FCC: h, k, l ãŒã™ã¹ã¦å¶æ•°ã¾ãŸã¯ã™ã¹ã¦å¥‡æ•°ã®ã¿è¦³æ¸¬ã•ã‚Œã‚‹")
    print("  Diamond: FCC + ã•ã‚‰ã« h+k+l=4n (n:æ•´æ•°) ã®ã¿å¼·ã„åå°„")
    print("="*60)

# å®Ÿè¡Œ
analyze_structure_factors()
</code></pre>

        <div class="warning-box">
            <h4>æ¶ˆæ»…å‰‡ã®é‡è¦æ€§</h4>
            <p>
                æ¶ˆæ»…å‰‡ã¯çµæ™¶æ§‹é€ ã‚’æ±ºå®šã™ã‚‹ä¸Šã§æ¥µã‚ã¦é‡è¦ã§ã™ã€‚
                ä¾‹ãˆã°ã€(100)ãƒ”ãƒ¼ã‚¯ãŒè¦³æ¸¬ã•ã‚Œãªã„å ´åˆã€å˜ç´”ç«‹æ–¹ï¼ˆSCï¼‰ã§ã¯ãªãBCCã¾ãŸã¯FCCã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
            </p>
        </div>

        <h3>3.3 å›æŠ˜å¼·åº¦ã«å½±éŸ¿ã™ã‚‹å› å­</h3>

        <p>å®Ÿéš›ã®å›æŠ˜å¼·åº¦ I<sub>hkl</sub> ã¯ã€æ§‹é€ å› å­ä»¥å¤–ã«ã‚‚å¤šãã®å› å­ã«ä¾å­˜ã—ã¾ã™ï¼š</p>

        <div class="formula-block">
            $$
            I_{hkl} \propto |F_{hkl}|^2 \cdot m_{hkl} \cdot L \cdot P \cdot A \cdot \exp(-2M)
            $$
        </div>

        <table>
            <thead>
                <tr>
                    <th>å› å­</th>
                    <th>åç§°</th>
                    <th>ç‰©ç†çš„æ„å‘³</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>|F<sub>hkl</sub>|<sup>2</sup></td>
                    <td>æ§‹é€ å› å­</td>
                    <td>å˜ä½æ ¼å­å†…ã®åŸå­é…ç½®ã®åŠ¹æœ</td>
                </tr>
                <tr>
                    <td>m<sub>hkl</sub></td>
                    <td>å¤šé‡åº¦</td>
                    <td>å¯¾ç§°çš„ã«ç­‰ä¾¡ãªé¢ã®æ•°</td>
                </tr>
                <tr>
                    <td>L</td>
                    <td>ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„å› å­</td>
                    <td>çµæ™¶ã®å¹¾ä½•å­¦çš„åŠ¹æœ</td>
                </tr>
                <tr>
                    <td>P</td>
                    <td>åå…‰å› å­</td>
                    <td>Xç·šã®åå…‰çŠ¶æ…‹ã®åŠ¹æœ</td>
                </tr>
                <tr>
                    <td>A</td>
                    <td>å¸åå› å­</td>
                    <td>è©¦æ–™ã«ã‚ˆã‚‹Xç·šå¸å</td>
                </tr>
                <tr>
                    <td>exp(-2M)</td>
                    <td>æ¸©åº¦å› å­ï¼ˆãƒ‡ãƒã‚¤ãƒ»ãƒ¯ãƒ©ãƒ¼å› å­ï¼‰</td>
                    <td>åŸå­ã®ç†±æŒ¯å‹•ã«ã‚ˆã‚‹æ•£æ¼«æ•£ä¹±</td>
                </tr>
            </tbody>
        </table>

        <div class="example-box">
            <h4>ã‚³ãƒ¼ãƒ‰ä¾‹4ï¼šå¤šé‡åº¦ã¨ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„åå…‰å› å­ã‚’å«ã‚€å¼·åº¦è¨ˆç®—</h4>
        </div>

        <pre class="line-numbers"><code class="language-python">from itertools import permutations, product

def multiplicity(h, k, l, crystal_system='cubic'):
    """
    å¤šé‡åº¦ï¼ˆç­‰ä¾¡ãªé¢ã®æ•°ï¼‰ã‚’è¨ˆç®—

    Parameters:
    -----------
    h, k, l : int
        ãƒŸãƒ©ãƒ¼æŒ‡æ•°
    crystal_system : str
        çµæ™¶ç³»

    Returns:
    --------
    int : å¤šé‡åº¦
    """
    planes = set()

    if crystal_system == 'cubic':
        for perm in permutations([abs(h), abs(k), abs(l)]):
            for signs in product([1, -1], repeat=3):
                plane = tuple(s * p for s, p in zip(signs, perm))
                if plane != (0, 0, 0):
                    planes.add(plane)

    return len(planes)

def lorentz_polarization_factor(two_theta):
    """
    ç²‰æœ«Xç·šå›æŠ˜ã®ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„ãƒ»åå…‰å› å­

    Parameters:
    -----------
    two_theta : float
        å›æŠ˜è§’ 2Î¸ï¼ˆãƒ©ã‚¸ã‚¢ãƒ³ï¼‰

    Returns:
    --------
    float : LPå› å­
    """
    theta = two_theta / 2
    LP = (1 + np.cos(two_theta)**2) / (np.sin(theta)**2 * np.cos(theta))
    return LP

def calculate_intensity_with_factors():
    """å„ç¨®å› å­ã‚’è€ƒæ…®ã—ãŸå›æŠ˜å¼·åº¦ã®è¨ˆç®—"""

    # ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ï¼ˆFCCã€a = 4.0495 Ã…ï¼‰
    a_Al = 4.0495
    wavelength = 1.5406  # Cu KÎ±

    # FCCæ§‹é€ ã®åŸå­ä½ç½®
    fcc_positions = [
        (0, 0, 0),
        (0.5, 0.5, 0),
        (0.5, 0, 0.5),
        (0, 0.5, 0.5)
    ]
    f_Al = 13  # ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã®åŸå­ç•ªå·ï¼ˆç°¡æ˜“çš„ã«åŸå­æ•£ä¹±å› å­ã¨ã™ã‚‹ï¼‰

    planes = [
        (1, 1, 1), (2, 0, 0), (2, 2, 0),
        (3, 1, 1), (2, 2, 2), (4, 0, 0)
    ]

    print("=== å„ç¨®å› å­ã‚’è€ƒæ…®ã—ãŸXRDå¼·åº¦è¨ˆç®—ï¼ˆAl, FCCï¼‰ ===\n")
    print(f"{'(hkl)':<10} {'d (Ã…)':<10} {'2Î¸':<10} {'|F|^2':<12} {'m':<6} {'LP':<10} {'I_rel':<10}")
    print("-" * 80)

    intensities = []

    for hkl in planes:
        h, k, l = hkl

        # é¢é–“éš”
        d = cubic_d_spacing(a_Al, h, k, l)

        # ãƒ–ãƒ©ãƒƒã‚°è§’
        two_theta_deg = bragg_angle(d, wavelength)
        if two_theta_deg is None:
            continue
        two_theta_rad = np.radians(two_theta_deg)

        # æ§‹é€ å› å­
        F = structure_factor(fcc_positions, [f_Al]*4, h, k, l)
        F_squared = abs(F)**2

        # æ¶ˆæ»…å‰‡ãƒã‚§ãƒƒã‚¯ï¼ˆFCCã§ã¯æ··åˆã¯æ¶ˆæ»…ï¼‰
        if F_squared < 0.01:
            continue

        # å¤šé‡åº¦
        m = multiplicity(h, k, l, 'cubic')

        # ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„åå…‰å› å­
        LP = lorentz_polarization_factor(two_theta_rad)

        # ç›¸å¯¾å¼·åº¦ï¼ˆæ¸©åº¦å› å­ãƒ»å¸åã¯çœç•¥ï¼‰
        I_rel = F_squared * m * LP

        intensities.append((hkl, I_rel))

        print(f"({h}{k}{l}){'':<8} {d:8.4f}  {two_theta_deg:8.2f}  {F_squared:10.2f}  {m:<6} {LP:8.4f}  {I_rel:8.2f}")

    # æœ€å¤§å¼·åº¦ã§è¦æ ¼åŒ–
    max_intensity = max(I for _, I in intensities)

    print("\n--- è¦æ ¼åŒ–ç›¸å¯¾å¼·åº¦ï¼ˆæœ€å¤§å€¤ = 100ï¼‰ ---")
    print(f"{'(hkl)':<10} {'ç›¸å¯¾å¼·åº¦':<15}")
    print("-" * 30)

    for hkl, I in intensities:
        I_normalized = 100 * I / max_intensity
        print(f"({hkl[0]}{hkl[1]}{hkl[2]}){'':<8} {I_normalized:8.1f}")

# å®Ÿè¡Œ
calculate_intensity_with_factors()
</code></pre>

        <h2>4. ç²‰æœ«Xç·šå›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è§£é‡ˆ</h2>

        <h3>4.1 ç²‰æœ«XRDã¨ã¯</h3>

        <p>
            <strong>ç²‰æœ«Xç·šå›æŠ˜ï¼ˆPowder X-ray Diffraction, PXRDï¼‰</strong>ã¯ã€
            å¾®ç´°ãªçµæ™¶ç²’ãŒ<strong>ãƒ©ãƒ³ãƒ€ãƒ ãªå‘ã</strong>ã§é…å‘ã—ãŸè©¦æ–™ã«å¯¾ã—ã¦è¡Œã†æ¸¬å®šæ³•ã§ã™ã€‚
            ææ–™ç§‘å­¦ã§æœ€ã‚‚é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹æ§‹é€ è©•ä¾¡æ‰‹æ³•ã®ä¸€ã¤ã§ã™ã€‚
        </p>

        <div class="info-box">
            <h4>ç²‰æœ«XRDã®ç‰¹å¾´</h4>
            <ul>
                <li><strong>è©¦æ–™æº–å‚™ãŒå®¹æ˜“</strong>ï¼šå˜çµæ™¶ã‚’å¿…è¦ã¨ã—ãªã„</li>
                <li><strong>ç›¸åŒå®š</strong>ï¼šæœªçŸ¥è©¦æ–™ã®çµæ™¶ç›¸ã‚’ç‰¹å®šã§ãã‚‹</li>
                <li><strong>å®šé‡åˆ†æ</strong>ï¼šæ··åˆç‰©ä¸­ã®å„ç›¸ã®å‰²åˆã‚’æ¨å®šå¯èƒ½</li>
                <li><strong>æ ¼å­å®šæ•°æ±ºå®š</strong>ï¼šãƒ”ãƒ¼ã‚¯ä½ç½®ã‹ã‚‰ç²¾å¯†ãªæ ¼å­å®šæ•°ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹</li>
                <li><strong>çµæ™¶å­ã‚µã‚¤ã‚º</strong>ï¼šãƒ”ãƒ¼ã‚¯å¹…ã‹ã‚‰ãƒŠãƒç²’å­ã®ã‚µã‚¤ã‚ºã‚’æ¨å®š</li>
            </ul>
        </div>

        <h3>4.2 XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>

        <div class="example-box">
            <h4>ã‚³ãƒ¼ãƒ‰ä¾‹5ï¼šå®Œå…¨ãªXRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h4>
            <p>ãƒ”ãƒ¼ã‚¯å½¢çŠ¶ï¼ˆã‚¬ã‚¦ã‚¹é–¢æ•°ï¼‰ã¨ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’å«ã‚€ç¾å®Ÿçš„ãªXRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆã—ã¾ã™ï¼š</p>
        </div>

        <pre class="line-numbers"><code class="language-python">def gaussian_peak(two_theta, center, intensity, fwhm):
    """
    ã‚¬ã‚¦ã‚¹å‹ãƒ”ãƒ¼ã‚¯é–¢æ•°

    Parameters:
    -----------
    two_theta : array
        2Î¸ ã®é…åˆ—
    center : float
        ãƒ”ãƒ¼ã‚¯ä¸­å¿ƒä½ç½®
    intensity : float
        ãƒ”ãƒ¼ã‚¯å¼·åº¦
    fwhm : float
        åŠå€¤å…¨å¹…ï¼ˆFull Width at Half Maximumï¼‰

    Returns:
    --------
    array : ã‚¬ã‚¦ã‚¹ãƒ”ãƒ¼ã‚¯ã®å¼·åº¦
    """
    sigma = fwhm / (2 * np.sqrt(2 * np.log(2)))
    return intensity * np.exp(-((two_theta - center)**2) / (2 * sigma**2))

def simulate_xrd_pattern(material_name, a, c=None, crystal_system='cubic',
                        positions=None, f_atoms=None,
                        wavelength=1.5406, two_theta_range=(20, 100),
                        fwhm=0.2, background=50):
    """
    å®Œå…¨ãªXRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

    Parameters:
    -----------
    material_name : str
        ææ–™å
    a, c : float
        æ ¼å­å®šæ•°
    crystal_system : str
        çµæ™¶ç³»
    positions : list
        å˜ä½æ ¼å­å†…ã®åŸå­ã®åˆ†æ•°åº§æ¨™
    f_atoms : list
        åŸå­æ•£ä¹±å› å­
    wavelength : float
        Xç·šæ³¢é•·
    two_theta_range : tuple
        2Î¸ ã®æ¸¬å®šç¯„å›²
    fwhm : float
        ãƒ”ãƒ¼ã‚¯ã®åŠå€¤å…¨å¹…
    background : float
        ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å¼·åº¦

    Returns:
    --------
    two_theta, intensity : arrays
    """
    # 2Î¸ ã®é…åˆ—
    two_theta = np.linspace(two_theta_range[0], two_theta_range[1], 4000)
    intensity = np.ones_like(two_theta) * background  # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰

    # ãƒ”ãƒ¼ã‚¯ã‚’è¨ˆç®—
    max_hkl = 5
    peaks_info = []

    for h in range(max_hkl + 1):
        for k in range(h, max_hkl + 1):
            for l in range(k, max_hkl + 1):
                if h == 0 and k == 0 and l == 0:
                    continue

                # é¢é–“éš”
                if crystal_system == 'cubic':
                    d = cubic_d_spacing(a, h, k, l)

                # ãƒ–ãƒ©ãƒƒã‚°è§’
                two_theta_peak = bragg_angle(d, wavelength)
                if two_theta_peak is None or two_theta_peak > two_theta_range[1]:
                    continue

                # æ§‹é€ å› å­
                if positions is not None and f_atoms is not None:
                    F = structure_factor(positions, f_atoms, h, k, l)
                    F_squared = abs(F)**2
                    if F_squared < 0.01:
                        continue
                else:
                    F_squared = 1.0

                # å¤šé‡åº¦
                m = multiplicity(h, k, l, crystal_system)

                # ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„åå…‰å› å­
                LP = lorentz_polarization_factor(np.radians(two_theta_peak))

                # ãƒ”ãƒ¼ã‚¯å¼·åº¦
                I_peak = F_squared * m * LP

                # ã‚¬ã‚¦ã‚¹ãƒ”ãƒ¼ã‚¯ã‚’è¿½åŠ 
                intensity += gaussian_peak(two_theta, two_theta_peak, I_peak, fwhm)
                peaks_info.append(((h, k, l), two_theta_peak, I_peak))

    # å¼·åº¦ã‚’è¦æ ¼åŒ–
    intensity = (intensity / intensity.max()) * 1000

    return two_theta, intensity, peaks_info

# ã‚·ãƒªã‚³ãƒ³ã®XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
a_Si = 5.4310
diamond_positions = [
    (0, 0, 0), (0.5, 0.5, 0), (0.5, 0, 0.5), (0, 0.5, 0.5),
    (0.25, 0.25, 0.25), (0.75, 0.75, 0.25),
    (0.75, 0.25, 0.75), (0.25, 0.75, 0.75)
]
f_Si = [14] * 8  # ã‚·ãƒªã‚³ãƒ³ã®åŸå­ç•ªå·

two_theta, intensity, peaks = simulate_xrd_pattern(
    'Silicon (Si)',
    a=a_Si,
    crystal_system='cubic',
    positions=diamond_positions,
    f_atoms=f_Si,
    fwhm=0.15
)

# ã‚°ãƒ©ãƒ•è¡¨ç¤º
fig, ax = plt.subplots(figsize=(14, 6))

ax.plot(two_theta, intensity, 'b-', linewidth=1.5, label='ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³')
ax.fill_between(two_theta, 0, intensity, alpha=0.2, color='blue')

# ä¸»è¦ãƒ”ãƒ¼ã‚¯ã«ãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã‚‹
peaks_sorted = sorted(peaks, key=lambda x: x[2], reverse=True)[:6]
for (h, k, l), pos, I in peaks_sorted:
    ax.annotate(f'({h}{k}{l})',
               xy=(pos, I * 1000 / intensity.max()),
               xytext=(pos, I * 1000 / intensity.max() + 80),
               ha='center', fontsize=10,
               arrowprops=dict(arrowstyle='->', color='red', lw=1))

ax.set_xlim(20, 100)
ax.set_ylim(0, 1100)
ax.set_xlabel('2Î¸ (åº¦)', fontsize=14, fontweight='bold')
ax.set_ylabel('å¼·åº¦ï¼ˆä»»æ„å˜ä½ï¼‰', fontsize=14, fontweight='bold')
ax.set_title('ã‚·ãƒªã‚³ãƒ³ï¼ˆSiï¼‰ã®ç²‰æœ«XRDãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰',
            fontsize=16, fontweight='bold')
ax.grid(axis='both', alpha=0.3)
ax.legend(fontsize=12)

plt.tight_layout()
plt.savefig('si_powder_xrd_simulation.png', dpi=150, bbox_inches='tight')
plt.show()
print("ç²‰æœ«XRDã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿å­˜ã—ã¾ã—ãŸ: si_powder_xrd_simulation.png")
</code></pre>

        <h3>4.3 å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨è§£æ</h3>

        <div class="example-box">
            <h4>ã‚³ãƒ¼ãƒ‰ä¾‹6ï¼šXRDãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨ãƒ”ãƒ¼ã‚¯æ¤œå‡º</h4>
            <p>å®Ÿéš›ã®XRDæ¸¬å®šãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’èª­ã¿è¾¼ã¿ã€ãƒ”ãƒ¼ã‚¯ã‚’è‡ªå‹•æ¤œå‡ºã—ã¾ã™ï¼š</p>
        </div>

        <pre class="line-numbers"><code class="language-python">from scipy.signal import find_peaks
from scipy.optimize import curve_fit

def read_xrd_data(filename):
    """
    XRDãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€

    ä¸€èˆ¬çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼š
    2theta  Intensity
    20.0    150.2
    20.1    152.3
    ...

    Parameters:
    -----------
    filename : str
        ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

    Returns:
    --------
    two_theta, intensity : arrays
    """
    try:
        data = np.loadtxt(filename, skiprows=1)  # ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
        two_theta = data[:, 0]
        intensity = data[:, 1]
        return two_theta, intensity
    except FileNotFoundError:
        print(f"ãƒ•ã‚¡ã‚¤ãƒ« {filename} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
        print("ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã™ã€‚")
        # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
        return simulate_xrd_pattern('Sample', a=5.0, fwhm=0.3)[:2]

def detect_peaks_in_xrd(two_theta, intensity, prominence=50, distance=10):
    """
    XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ãƒ”ãƒ¼ã‚¯ã‚’æ¤œå‡º

    Parameters:
    -----------
    two_theta : array
        2Î¸ ãƒ‡ãƒ¼ã‚¿
    intensity : array
        å¼·åº¦ãƒ‡ãƒ¼ã‚¿
    prominence : float
        ãƒ”ãƒ¼ã‚¯æ¤œå‡ºã®é–¾å€¤ï¼ˆçªå‡ºåº¦ï¼‰
    distance : int
        ãƒ”ãƒ¼ã‚¯é–“ã®æœ€å°è·é›¢ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆæ•°ï¼‰

    Returns:
    --------
    peak_positions, peak_intensities : arrays
    """
    peaks_idx, properties = find_peaks(intensity,
                                       prominence=prominence,
                                       distance=distance)

    peak_positions = two_theta[peaks_idx]
    peak_intensities = intensity[peaks_idx]
    peak_prominences = properties['prominences']

    return peak_positions, peak_intensities, peak_prominences

def analyze_xrd_data():
    """å®Ÿæ¸¬XRDãƒ‡ãƒ¼ã‚¿ã®è§£æãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"""

    # ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆå®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
    two_theta, intensity = read_xrd_data('sample_xrd.txt')

    # ãƒ”ãƒ¼ã‚¯æ¤œå‡º
    peak_pos, peak_int, peak_prom = detect_peaks_in_xrd(
        two_theta, intensity,
        prominence=100,
        distance=20
    )

    print("=== æ¤œå‡ºã•ã‚ŒãŸãƒ”ãƒ¼ã‚¯ ===\n")
    print(f"{'ãƒ”ãƒ¼ã‚¯ç•ªå·':<12} {'2Î¸ (åº¦)':<12} {'å¼·åº¦':<15} {'dé–“éš” (Ã…)':<12}")
    print("-" * 60)

    wavelength = 1.5406  # Cu KÎ±

    for i, (pos, intensity_val) in enumerate(zip(peak_pos, peak_int), 1):
        # ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã‹ã‚‰ d é–“éš”ã‚’é€†ç®—
        theta = np.radians(pos / 2)
        d_spacing = wavelength / (2 * np.sin(theta))

        print(f"{i:<12} {pos:10.2f}  {intensity_val:12.1f}  {d_spacing:10.4f}")

    # ã‚°ãƒ©ãƒ•è¡¨ç¤º
    fig, ax = plt.subplots(figsize=(14, 7))

    # XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ—ãƒ­ãƒƒãƒˆ
    ax.plot(two_theta, intensity, 'b-', linewidth=1.5, label='æ¸¬å®šãƒ‡ãƒ¼ã‚¿')

    # æ¤œå‡ºã•ã‚ŒãŸãƒ”ãƒ¼ã‚¯ã‚’ãƒãƒ¼ã‚¯
    ax.plot(peak_pos, peak_int, 'ro', markersize=8, label='æ¤œå‡ºãƒ”ãƒ¼ã‚¯')

    # ãƒ”ãƒ¼ã‚¯ç•ªå·ã‚’è¡¨ç¤º
    for i, (pos, int_val) in enumerate(zip(peak_pos, peak_int), 1):
        ax.annotate(f'{i}',
                   xy=(pos, int_val),
                   xytext=(pos, int_val + 80),
                   ha='center', fontsize=10, fontweight='bold',
                   bbox=dict(boxstyle='round,pad=0.3', facecolor='yellow', alpha=0.7))

    ax.set_xlabel('2Î¸ (åº¦)', fontsize=14, fontweight='bold')
    ax.set_ylabel('å¼·åº¦ï¼ˆä»»æ„å˜ä½ï¼‰', fontsize=14, fontweight='bold')
    ax.set_title('XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ”ãƒ¼ã‚¯æ¤œå‡º', fontsize=16, fontweight='bold')
    ax.legend(fontsize=12)
    ax.grid(axis='both', alpha=0.3)

    plt.tight_layout()
    plt.savefig('xrd_peak_detection.png', dpi=150, bbox_inches='tight')
    plt.show()
    print("\nãƒ”ãƒ¼ã‚¯æ¤œå‡ºçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ: xrd_peak_detection.png")

# å®Ÿè¡Œ
analyze_xrd_data()
</code></pre>

        <h3>4.4 ãƒ”ãƒ¼ã‚¯ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</h3>

        <div class="example-box">
            <h4>ã‚³ãƒ¼ãƒ‰ä¾‹7ï¼šã‚¬ã‚¦ã‚¹ãƒ»ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„é–¢æ•°ã«ã‚ˆã‚‹ãƒ”ãƒ¼ã‚¯ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</h4>
            <p>ãƒ”ãƒ¼ã‚¯å½¢çŠ¶ã‚’æ•°å­¦çš„ã«ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã—ã¦ã€æ­£ç¢ºãªãƒ”ãƒ¼ã‚¯ä½ç½®ã¨å¹…ã‚’æ±ºå®šã—ã¾ã™ï¼š</p>
        </div>

        <pre class="line-numbers"><code class="language-python">def pseudo_voigt(x, amplitude, center, fwhm, eta):
    """
    æ“¬ãƒ•ã‚©ãƒ¼ã‚¯ãƒˆé–¢æ•°ï¼ˆã‚¬ã‚¦ã‚¹æˆåˆ†ã¨ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„æˆåˆ†ã®æ··åˆï¼‰

    Parameters:
    -----------
    x : array
        ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ
    amplitude : float
        ãƒ”ãƒ¼ã‚¯æŒ¯å¹…
    center : float
        ãƒ”ãƒ¼ã‚¯ä¸­å¿ƒ
    fwhm : float
        åŠå€¤å…¨å¹…
    eta : float
        ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„æˆåˆ†ã®å‰²åˆï¼ˆ0: ã‚¬ã‚¦ã‚¹ã€1: ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„ï¼‰

    Returns:
    --------
    array : ãƒ”ãƒ¼ã‚¯å½¢çŠ¶
    """
    # ã‚¬ã‚¦ã‚¹æˆåˆ†
    sigma = fwhm / (2 * np.sqrt(2 * np.log(2)))
    gaussian = np.exp(-((x - center)**2) / (2 * sigma**2))

    # ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„æˆåˆ†
    gamma = fwhm / 2
    lorentzian = gamma**2 / ((x - center)**2 + gamma**2)

    # æ··åˆ
    return amplitude * (eta * lorentzian + (1 - eta) * gaussian)

def fit_single_peak(two_theta, intensity, peak_center, window=2.0):
    """
    å˜ä¸€ãƒ”ãƒ¼ã‚¯ã‚’ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°

    Parameters:
    -----------
    two_theta : array
        2Î¸ ãƒ‡ãƒ¼ã‚¿
    intensity : array
        å¼·åº¦ãƒ‡ãƒ¼ã‚¿
    peak_center : float
        ãƒ”ãƒ¼ã‚¯ã®æ¦‚ç®—ä¸­å¿ƒä½ç½®
    window : float
        ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ç¯„å›²ï¼ˆÂ±window åº¦ï¼‰

    Returns:
    --------
    popt : array
        æœ€é©åŒ–ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ [amplitude, center, fwhm, eta]
    pcov : array
        å…±åˆ†æ•£è¡Œåˆ—
    """
    # ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ç¯„å›²ã‚’æŠ½å‡º
    mask = (two_theta >= peak_center - window) & (two_theta <= peak_center + window)
    x_data = two_theta[mask]
    y_data = intensity[mask]

    # åˆæœŸæ¨å®šå€¤
    amplitude_init = np.max(y_data) - np.min(y_data)
    center_init = peak_center
    fwhm_init = 0.2
    eta_init = 0.5

    p0 = [amplitude_init, center_init, fwhm_init, eta_init]

    # å¢ƒç•Œæ¡ä»¶
    bounds = ([0, peak_center - 1, 0.05, 0],
              [amplitude_init * 2, peak_center + 1, 1.0, 1])

    try:
        popt, pcov = curve_fit(pseudo_voigt, x_data, y_data, p0=p0, bounds=bounds)
        return popt, pcov, x_data, y_data
    except RuntimeError:
        print(f"ãƒ”ãƒ¼ã‚¯ {peak_center:.2f}Â° ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")
        return None, None, x_data, y_data

def demo_peak_fitting():
    """ãƒ”ãƒ¼ã‚¯ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"""

    # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
    two_theta, intensity = simulate_xrd_pattern('Sample', a=5.4, fwhm=0.2)[:2]

    # ãƒ”ãƒ¼ã‚¯æ¤œå‡º
    peak_pos, _, _ = detect_peaks_in_xrd(two_theta, intensity, prominence=100)

    # æœ€ã‚‚å¼·ã„ãƒ”ãƒ¼ã‚¯3ã¤ã‚’ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
    strongest_peaks = sorted(zip(peak_pos, intensity[np.isin(two_theta, peak_pos)]),
                            key=lambda x: x[1], reverse=True)[:3]

    fig, axes = plt.subplots(1, 3, figsize=(16, 5))

    for ax, (peak_center, _) in zip(axes, strongest_peaks):
        result = fit_single_peak(two_theta, intensity, peak_center, window=2.5)

        if result[0] is not None:
            popt, pcov, x_fit, y_fit = result
            amplitude, center, fwhm, eta = popt

            # ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°æ›²ç·š
            x_fine = np.linspace(x_fit.min(), x_fit.max(), 500)
            y_fine = pseudo_voigt(x_fine, *popt)

            # ãƒ—ãƒ­ãƒƒãƒˆ
            ax.plot(x_fit, y_fit, 'bo', markersize=4, label='æ¸¬å®šãƒ‡ãƒ¼ã‚¿')
            ax.plot(x_fine, y_fine, 'r-', linewidth=2, label='ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°')

            # çµæœè¡¨ç¤º
            textstr = f'ä¸­å¿ƒ: {center:.3f}Â°\nFWHM: {fwhm:.3f}Â°\nÎ·: {eta:.2f}'
            ax.text(0.05, 0.95, textstr, transform=ax.transAxes,
                   fontsize=10, verticalalignment='top',
                   bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.8))

            ax.set_xlabel('2Î¸ (åº¦)', fontsize=12, fontweight='bold')
            ax.set_ylabel('å¼·åº¦', fontsize=12, fontweight='bold')
            ax.set_title(f'ãƒ”ãƒ¼ã‚¯ @ {center:.1f}Â°', fontsize=13, fontweight='bold')
            ax.legend(fontsize=10)
            ax.grid(alpha=0.3)

    plt.tight_layout()
    plt.savefig('xrd_peak_fitting.png', dpi=150, bbox_inches='tight')
    plt.show()
    print("ãƒ”ãƒ¼ã‚¯ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°çµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ: xrd_peak_fitting.png")

# å®Ÿè¡Œ
demo_peak_fitting()
</code></pre>

        <h2>5. pymatgenã‚’ä½¿ã£ãŸé«˜åº¦ãªXRDè§£æ</h2>

        <h3>5.1 pymatgenã«ã‚ˆã‚‹XRDãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ</h3>

        <p>
            <strong>pymatgen</strong>ã¯ææ–™ç§‘å­¦ã®ãŸã‚ã®å¼·åŠ›ãªPythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€
            çµæ™¶æ§‹é€ ã‹ã‚‰XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆã§ãã¾ã™ã€‚
        </p>

        <div class="example-box">
            <h4>ã‚³ãƒ¼ãƒ‰ä¾‹8ï¼špymatgenã§ã®XRDãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆã¨æ¯”è¼ƒ</h4>
        </div>

        <pre class="line-numbers"><code class="language-python">try:
    from pymatgen.core import Structure, Lattice
    from pymatgen.analysis.diffraction.xrd import XRDCalculator
    PYMATGEN_AVAILABLE = True
except ImportError:
    print("pymatgenãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
    print("ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«: pip install pymatgen")
    PYMATGEN_AVAILABLE = False

def generate_xrd_with_pymatgen():
    """pymatgenã‚’ä½¿ã£ã¦XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆ"""

    if not PYMATGEN_AVAILABLE:
        print("pymatgenãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ã“ã®ä¾‹ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚")
        return

    # ã‚·ãƒªã‚³ãƒ³ã®æ§‹é€ ã‚’å®šç¾©
    lattice = Lattice.cubic(5.4310)
    species = ['Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si']
    coords = [
        [0, 0, 0], [0.5, 0.5, 0], [0.5, 0, 0.5], [0, 0.5, 0.5],
        [0.25, 0.25, 0.25], [0.75, 0.75, 0.25],
        [0.75, 0.25, 0.75], [0.25, 0.75, 0.75]
    ]

    si_structure = Structure(lattice, species, coords)

    print("=== pymatgenã«ã‚ˆã‚‹XRDãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ ===\n")
    print(f"çµæ™¶æ§‹é€ : {si_structure.composition}")
    print(f"ç©ºé–“ç¾¤: {si_structure.get_space_group_info()}\n")

    # XRDè¨ˆç®—æ©Ÿã®åˆæœŸåŒ–
    calculator = XRDCalculator(wavelength='CuKa')  # Cu KÎ±ç·š

    # XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨ˆç®—
    pattern = calculator.get_pattern(si_structure, two_theta_range=(20, 100))

    print(f"{'2Î¸ (åº¦)':<12} {'dé–“éš” (Ã…)':<15} {'(hkl)':<15} {'ç›¸å¯¾å¼·åº¦':<12}")
    print("-" * 60)

    for i in range(len(pattern.x)):
        two_theta = pattern.x[i]
        intensity = pattern.y[i]
        hkl = pattern.hkls[i][0]['hkl']  # æœ€åˆã®hklã‚’å–å¾—
        d_spacing = pattern.d_hkls[i]

        print(f"{two_theta:10.2f}  {d_spacing:12.4f}  {str(hkl):<15} {intensity:10.1f}")

    # ã‚°ãƒ©ãƒ•è¡¨ç¤º
    fig, ax = plt.subplots(figsize=(14, 7))

    # æ£’ã‚°ãƒ©ãƒ•ã¨ã—ã¦ãƒ—ãƒ­ãƒƒãƒˆ
    ax.vlines(pattern.x, 0, pattern.y, colors='blue', linewidth=2, label='pymatgen')

    # ãƒ”ãƒ¼ã‚¯ã«hklãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã‚‹
    for i, (two_theta, intensity, hkls_data) in enumerate(zip(pattern.x, pattern.y, pattern.hkls)):
        if intensity > 20:  # å¼·åº¦ãŒ20ä»¥ä¸Šã®ãƒ”ãƒ¼ã‚¯ã®ã¿ãƒ©ãƒ™ãƒ«è¡¨ç¤º
            hkl = hkls_data[0]['hkl']
            ax.text(two_theta, intensity + 5, f'({hkl[0]}{hkl[1]}{hkl[2]})',
                   rotation=90, va='bottom', ha='center', fontsize=9)

    ax.set_xlim(20, 100)
    ax.set_ylim(0, max(pattern.y) * 1.15)
    ax.set_xlabel('2Î¸ (åº¦)', fontsize=14, fontweight='bold')
    ax.set_ylabel('ç›¸å¯¾å¼·åº¦', fontsize=14, fontweight='bold')
    ax.set_title('ã‚·ãƒªã‚³ãƒ³ï¼ˆSiï¼‰ã®XRDãƒ‘ã‚¿ãƒ¼ãƒ³ - pymatgenç”Ÿæˆ',
                fontsize=16, fontweight='bold')
    ax.legend(fontsize=12)
    ax.grid(axis='both', alpha=0.3)

    plt.tight_layout()
    plt.savefig('si_xrd_pymatgen.png', dpi=150, bbox_inches='tight')
    plt.show()
    print("\npymatgen XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¿å­˜ã—ã¾ã—ãŸ: si_xrd_pymatgen.png")

    # è¤‡æ•°ã®ææ–™ã‚’æ¯”è¼ƒ
    compare_materials_xrd()

def compare_materials_xrd():
    """è¤‡æ•°ã®ææ–™ã®XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¯”è¼ƒ"""

    if not PYMATGEN_AVAILABLE:
        return

    # ææ–™ã®å®šç¾©
    materials = {
        'Si (Diamond)': Structure(
            Lattice.cubic(5.4310),
            ['Si']*8,
            [[0,0,0], [0.5,0.5,0], [0.5,0,0.5], [0,0.5,0.5],
             [0.25,0.25,0.25], [0.75,0.75,0.25], [0.75,0.25,0.75], [0.25,0.75,0.75]]
        ),
        'Al (FCC)': Structure(
            Lattice.cubic(4.0495),
            ['Al']*4,
            [[0,0,0], [0.5,0.5,0], [0.5,0,0.5], [0,0.5,0.5]]
        ),
        'Fe (BCC)': Structure(
            Lattice.cubic(2.8665),
            ['Fe']*2,
            [[0,0,0], [0.5,0.5,0.5]]
        )
    }

    calculator = XRDCalculator(wavelength='CuKa')

    fig, axes = plt.subplots(3, 1, figsize=(14, 12))

    for ax, (name, structure) in zip(axes, materials.items()):
        pattern = calculator.get_pattern(structure, two_theta_range=(20, 100))

        # æ£’ã‚°ãƒ©ãƒ•
        ax.vlines(pattern.x, 0, pattern.y, colors='darkblue', linewidth=2.5)

        # ãƒ”ãƒ¼ã‚¯ãƒ©ãƒ™ãƒ«
        for two_theta, intensity, hkls_data in zip(pattern.x, pattern.y, pattern.hkls):
            if intensity > 15:
                hkl = hkls_data[0]['hkl']
                ax.text(two_theta, intensity + 3, f'({hkl[0]}{hkl[1]}{hkl[2]})',
                       rotation=90, va='bottom', ha='center', fontsize=9)

        ax.set_xlim(20, 100)
        ax.set_ylim(0, 110)
        ax.set_ylabel('ç›¸å¯¾å¼·åº¦', fontsize=12, fontweight='bold')
        ax.set_title(name, fontsize=14, fontweight='bold', loc='left')
        ax.grid(axis='x', alpha=0.3)

    axes[-1].set_xlabel('2Î¸ (åº¦)', fontsize=14, fontweight='bold')

    plt.tight_layout()
    plt.savefig('materials_xrd_comparison.png', dpi=150, bbox_inches='tight')
    plt.show()
    print("ææ–™æ¯”è¼ƒã‚°ãƒ©ãƒ•ã‚’ä¿å­˜ã—ã¾ã—ãŸ: materials_xrd_comparison.png")

# å®Ÿè¡Œ
generate_xrd_with_pymatgen()
</code></pre>

        <div class="success-box">
            <h4>pymatgenã®åˆ©ç‚¹</h4>
            <ul>
                <li><strong>æ§‹é€ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº</strong>ï¼šMaterials Projectãªã©ã‹ã‚‰ç›´æ¥æ§‹é€ ã‚’å–å¾—å¯èƒ½</li>
                <li><strong>è‡ªå‹•çš„ãªæ§‹é€ å› å­è¨ˆç®—</strong>ï¼šåŸå­æ•£ä¹±å› å­ã‚„æ¸©åº¦å› å­ã‚’å«ã‚€æ­£ç¢ºãªè¨ˆç®—</li>
                <li><strong>ç©ºé–“ç¾¤ã®è‡ªå‹•èªè­˜</strong>ï¼šå¯¾ç§°æ€§ã‚’è€ƒæ…®ã—ãŸæ­£ç¢ºãªãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ</li>
                <li><strong>ç›¸åŒå®šæ©Ÿèƒ½</strong>ï¼šå®Ÿæ¸¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®æ¯”è¼ƒã«ã‚ˆã‚‹æœªçŸ¥è©¦æ–™ã®åŒå®š</li>
            </ul>
        </div>

        <h2>6. ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æå…¥é–€</h2>

        <h3>6.1 ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆæ³•ã¨ã¯</h3>

        <p>
            <strong>ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æï¼ˆRietveld refinementï¼‰</strong>ã¯ã€
            ç²‰æœ«XRDãƒ‘ã‚¿ãƒ¼ãƒ³å…¨ä½“ã‚’çµæ™¶æ§‹é€ ãƒ¢ãƒ‡ãƒ«ã§ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚
            1969å¹´ã«ãƒ•ãƒ¼ã‚´ãƒ¼ãƒ»ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚Œã¾ã—ãŸã€‚
        </p>

        <div class="info-box">
            <h4>ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆæ³•ã§å¾—ã‚‰ã‚Œã‚‹æƒ…å ±</h4>
            <ul>
                <li><strong>æ ¼å­å®šæ•°</strong>ï¼šé«˜ç²¾åº¦ï¼ˆÂ±0.0001 Ã…ä»¥ä¸‹ï¼‰</li>
                <li><strong>åŸå­åº§æ¨™</strong>ï¼šå˜ä½æ ¼å­å†…ã®åŸå­ä½ç½®</li>
                <li><strong>å æœ‰ç‡</strong>ï¼šåŸå­ã‚µã‚¤ãƒˆã®å æœ‰ç‡ï¼ˆåˆé‡‘ã‚„æ¬ é™¥ã®è©•ä¾¡ï¼‰</li>
                <li><strong>æ¸©åº¦å› å­</strong>ï¼šåŸå­ã®ç†±æŒ¯å‹•ã®å¤§ãã•</li>
                <li><strong>çµæ™¶å­ã‚µã‚¤ã‚º</strong>ï¼šãƒ”ãƒ¼ã‚¯å¹…ã‹ã‚‰ã®æ¨å®š</li>
                <li><strong>å¾®å°ã²ãšã¿</strong>ï¼šæ ¼å­ã®æ­ªã¿</li>
                <li><strong>ç›¸ã®å®šé‡</strong>ï¼šå¤šç›¸æ··åˆç‰©ã®å„ç›¸ã®é‡é‡åˆ†ç‡</li>
            </ul>
        </div>

        <h3>6.2 ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆæ³•ã®åŸç†</h3>

        <p>ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆæ³•ã§ã¯ã€ä»¥ä¸‹ã®é–¢æ•°ã‚’æœ€å°äºŒä¹—æ³•ã§æœ€é©åŒ–ã—ã¾ã™ï¼š</p>

        <div class="formula-block">
            $$
            S = \sum_i w_i (y_{i,\text{obs}} - y_{i,\text{calc}})^2
            $$
        </div>

        <p>ã“ã“ã§ï¼š</p>
        <ul>
            <li><strong>y<sub>i,obs</sub></strong>ï¼šiç•ªç›®ã®æ¸¬å®šç‚¹ã§ã®è¦³æ¸¬å¼·åº¦</li>
            <li><strong>y<sub>i,calc</sub></strong>ï¼šiç•ªç›®ã®æ¸¬å®šç‚¹ã§ã®è¨ˆç®—å¼·åº¦</li>
            <li><strong>w<sub>i</sub></strong>ï¼šé‡ã¿ï¼ˆé€šå¸¸ã¯ 1/y<sub>i,obs</sub>ï¼‰</li>
        </ul>

        <p>è¨ˆç®—å¼·åº¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ã•ã‚Œã¾ã™ï¼š</p>

        <div class="formula-block">
            $$
            y_{i,\text{calc}} = \text{scale} \sum_{K} L_K |F_K|^2 \Phi(2\theta_i - 2\theta_K) P_K A + y_{i,\text{bg}}
            $$
        </div>

        <div class="warning-box">
            <h4>ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æã®æ³¨æ„ç‚¹</h4>
            <p>
                ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆæ³•ã¯<strong>æ§‹é€ ãƒ¢ãƒ‡ãƒ«ã‚ã‚Šã</strong>ã®æ‰‹æ³•ã§ã™ã€‚
                åˆæœŸæ§‹é€ ãƒ¢ãƒ‡ãƒ«ãŒå¤§ããé–“é•ã£ã¦ã„ã‚‹ã¨ã€æ­£ã—ã„è§£ã«åæŸã—ã¾ã›ã‚“ã€‚
                é€šå¸¸ã¯ã€æ—¢çŸ¥ã®é¡ä¼¼æ§‹é€ ã‚„å˜çµæ™¶XRDãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åˆæœŸãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
            </p>
        </div>

        <h3>6.3 ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h3>

        <div class="mermaid">
            flowchart TD
                A[ç²‰æœ«XRDãƒ‡ãƒ¼ã‚¿æ¸¬å®š] --> B[ãƒ”ãƒ¼ã‚¯åŒå®šã¨ç›¸ã®ç‰¹å®š]
                B --> C[åˆæœŸæ§‹é€ ãƒ¢ãƒ‡ãƒ«ä½œæˆ]
                C --> D[ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰è¨­å®š]
                D --> E[æ ¼å­å®šæ•°ã®ç²¾å¯†åŒ–]
                E --> F[ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å½¢çŠ¶ã®ç²¾å¯†åŒ–]
                F --> G[æ§‹é€ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç²¾å¯†åŒ–]
                G --> H{é©åˆåº¦ãƒã‚§ãƒƒã‚¯}
                H -->|è‰¯å¥½| I[çµæœã®æ¤œè¨¼ã¨å ±å‘Š]
                H -->|ä¸è‰¯| J[ãƒ¢ãƒ‡ãƒ«ä¿®æ­£]
                J --> D

                style A fill:#e3f2fd
                style B fill:#e3f2fd
                style C fill:#fff3e0
                style I fill:#e8f5e9
                style J fill:#ffebee
        </div>

        <h2>7. æ¼”ç¿’å•é¡Œ</h2>

        <div class="exercise">
            <h3>æ¼”ç¿’1ï¼šãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã®å¿œç”¨</h3>
            <p>
                éŠ…ï¼ˆCuï¼‰ã®é¢å¿ƒç«‹æ–¹æ§‹é€ ï¼ˆFCCï¼‰ã§æ ¼å­å®šæ•° a = 3.615 Ã… ã¨ã—ã¾ã™ã€‚
                Cu KÎ±ç·šï¼ˆÎ» = 1.5406 Ã…ï¼‰ã‚’ç”¨ã„ãŸç²‰æœ«XRDæ¸¬å®šã§ã€
                ä»¥ä¸‹ã®(hkl)é¢ã‹ã‚‰ã®å›æŠ˜ãƒ”ãƒ¼ã‚¯ã¯ä½•åº¦ï¼ˆ2Î¸ï¼‰ã«è¦³æ¸¬ã•ã‚Œã¾ã™ã‹ï¼Ÿ
            </p>
            <ol>
                <li>(111)é¢</li>
                <li>(200)é¢</li>
                <li>(220)é¢</li>
            </ol>
            <p>ã¾ãŸã€FCCæ§‹é€ ã®æ¶ˆæ»…å‰‡ã«ã‚ˆã‚Šã€(100)ãƒ”ãƒ¼ã‚¯ã¯è¦³æ¸¬ã•ã‚Œã‚‹ã‹èª¬æ˜ã—ãªã•ã„ã€‚</p>
            <details>
                <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                <p><strong>é¢é–“éš”ã®è¨ˆç®—ï¼š</strong></p>
                <ol>
                    <li>d<sub>111</sub> = 3.615 / âˆš3 = 2.087 Ã…</li>
                    <li>d<sub>200</sub> = 3.615 / âˆš4 = 1.808 Ã…</li>
                    <li>d<sub>220</sub> = 3.615 / âˆš8 = 1.278 Ã…</li>
                </ol>
                <p><strong>ãƒ–ãƒ©ãƒƒã‚°è§’ã®è¨ˆç®—ï¼ˆÎ» = 2d sinÎ¸ï¼‰ï¼š</strong></p>
                <ol>
                    <li>2Î¸<sub>111</sub> = 2 Ã— arcsin(1.5406/(2Ã—2.087)) â‰ˆ <strong>43.3Â°</strong></li>
                    <li>2Î¸<sub>200</sub> = 2 Ã— arcsin(1.5406/(2Ã—1.808)) â‰ˆ <strong>50.4Â°</strong></li>
                    <li>2Î¸<sub>220</sub> = 2 Ã— arcsin(1.5406/(2Ã—1.278)) â‰ˆ <strong>74.1Â°</strong></li>
                </ol>
                <p><strong>(100)é¢ã«ã¤ã„ã¦ï¼š</strong></p>
                <p>
                    FCCæ§‹é€ ã®æ¶ˆæ»…å‰‡ã¯ã€Œh, k, l ãŒã™ã¹ã¦å¶æ•°ã¾ãŸã¯ã™ã¹ã¦å¥‡æ•°ã®ã¿è¦³æ¸¬ã€ã§ã™ã€‚
                    (100)ã¯ h=1ï¼ˆå¥‡æ•°ï¼‰ã€k=0ï¼ˆå¶æ•°ï¼‰ã€l=0ï¼ˆå¶æ•°ï¼‰ãªã®ã§æ··åˆã¨ãªã‚Šã€
                    æ§‹é€ å› å­ F<sub>100</sub> = 0 ã¨ãªã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦<strong>è¦³æ¸¬ã•ã‚Œã¾ã›ã‚“</strong>ã€‚
                </p>
            </details>
        </div>

        <div class="exercise">
            <h3>æ¼”ç¿’2ï¼šæ§‹é€ å› å­ã¨æ¶ˆæ»…å‰‡</h3>
            <p>
                ã‚ã‚‹XRDæ¸¬å®šã§ä»¥ä¸‹ã®ãƒ”ãƒ¼ã‚¯ãŒè¦³æ¸¬ã•ã‚Œã¾ã—ãŸï¼š
                (110), (200), (211), (220), (310), (222), (321), (400)
            </p>
            <p>
                ã“ã®ææ–™ã¯å˜ç´”ç«‹æ–¹ï¼ˆSCï¼‰ã€ä½“å¿ƒç«‹æ–¹ï¼ˆBCCï¼‰ã€é¢å¿ƒç«‹æ–¹ï¼ˆFCCï¼‰ã®ã©ã‚Œã§ã™ã‹ï¼Ÿ
                æ¶ˆæ»…å‰‡ã‹ã‚‰åˆ¤å®šã—ãªã•ã„ã€‚
            </p>
            <details>
                <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                <p>å„æŒ‡æ•°ã§ h+k+l ã®å’Œã‚’ç¢ºèªï¼š</p>
                <ul>
                    <li>(110): 1+1+0 = 2 (å¶æ•°)</li>
                    <li>(200): 2+0+0 = 2 (å¶æ•°)</li>
                    <li>(211): 2+1+1 = 4 (å¶æ•°)</li>
                    <li>(220): 2+2+0 = 4 (å¶æ•°)</li>
                    <li>(310): 3+1+0 = 4 (å¶æ•°)</li>
                    <li>(222): 2+2+2 = 6 (å¶æ•°)</li>
                    <li>(321): 3+2+1 = 6 (å¶æ•°)</li>
                    <li>(400): 4+0+0 = 4 (å¶æ•°)</li>
                </ul>
                <p>
                    ã™ã¹ã¦ã®ãƒ”ãƒ¼ã‚¯ã§ h+k+l ãŒå¶æ•°ã§ã™ã€‚ã“ã‚Œã¯<strong>BCCï¼ˆä½“å¿ƒç«‹æ–¹ï¼‰</strong>ã®æ¶ˆæ»…å‰‡ã¨ä¸€è‡´ã—ã¾ã™ã€‚
                </p>
                <p>
                    ã‚‚ã—FCCãªã‚‰ã€(210)ã‚„(221)ãªã©ã®æ··åˆæŒ‡æ•°ãŒæ¶ˆæ»…ã™ã‚‹ã¯ãšã§ã™ãŒã€
                    è¦³æ¸¬ã•ã‚ŒãŸãƒ”ãƒ¼ã‚¯ã«ãã®ã‚ˆã†ãªè¦å‰‡æ€§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                    SCãªã‚‰(100)ãªã©ã™ã¹ã¦ã®ãƒ”ãƒ¼ã‚¯ãŒè¦³æ¸¬ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚
                </p>
                <p><strong>ç­”ãˆï¼šBCCï¼ˆä½“å¿ƒç«‹æ–¹ï¼‰</strong></p>
            </details>
        </div>

        <div class="exercise">
            <h3>æ¼”ç¿’3ï¼šdé–“éš”ã‹ã‚‰ã®çµæ™¶åŒå®š</h3>
            <p>
                æœªçŸ¥è©¦æ–™ã®XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ã€ä»¥ä¸‹ã® d é–“éš”ï¼ˆÃ…ï¼‰ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸï¼š
                3.35, 2.46, 2.13, 1.91, 1.80
            </p>
            <p>
                ã“ã®è©¦æ–™ã¯ä»¥ä¸‹ã®ã©ã®ææ–™ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã‹ï¼Ÿæ ¼å­å®šæ•°ã‹ã‚‰åˆ¤å®šã—ãªã•ã„ã€‚
            </p>
            <ul>
                <li>A) NaClï¼ˆå²©å¡©æ§‹é€ ã€FCCã€a = 5.64 Ã…ï¼‰</li>
                <li>B) Siï¼ˆãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰æ§‹é€ ã€a = 5.43 Ã…ï¼‰</li>
                <li>C) ã‚°ãƒ©ãƒ•ã‚¡ã‚¤ãƒˆï¼ˆå…­æ–¹æ™¶ã€a = 2.46 Ã…ã€c = 6.71 Ã…ï¼‰</li>
            </ul>
            <details>
                <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                <p>å„ææ–™ã®ä»£è¡¨çš„ãª d é–“éš”ã‚’è¨ˆç®—ï¼š</p>
                <p><strong>A) NaCl (FCC, a=5.64 Ã…):</strong></p>
                <ul>
                    <li>d<sub>111</sub> = 5.64/âˆš3 = 3.26 Ã…</li>
                    <li>d<sub>200</sub> = 5.64/âˆš4 = 2.82 Ã…</li>
                    <li>d<sub>220</sub> = 5.64/âˆš8 = 2.00 Ã…</li>
                </ul>
                <p><strong>B) Si (a=5.43 Ã…):</strong></p>
                <ul>
                    <li>d<sub>111</sub> = 5.43/âˆš3 = 3.14 Ã…</li>
                    <li>d<sub>220</sub> = 5.43/âˆš8 = 1.92 Ã…</li>
                </ul>
                <p><strong>C) ã‚°ãƒ©ãƒ•ã‚¡ã‚¤ãƒˆ (å…­æ–¹æ™¶, a=2.46, c=6.71 Ã…):</strong></p>
                <ul>
                    <li>d<sub>002</sub> = c/2 = 3.35 Ã… âœ“</li>
                    <li>d<sub>100</sub> = aâˆš(3/4) = 2.13 Ã… âœ“</li>
                    <li>d<sub>004</sub> = c/4 = 1.68 Ã…</li>
                </ul>
                <p>
                    <strong>ç­”ãˆï¼šC) ã‚°ãƒ©ãƒ•ã‚¡ã‚¤ãƒˆ</strong>
                </p>
                <p>
                    æœ€å¤§ d é–“éš”ã® 3.35 Ã… ãŒã‚°ãƒ©ãƒ•ã‚¡ã‚¤ãƒˆã®ç‰¹å¾´çš„ãª (002) é¢é–“éš”ã¨ä¸€è‡´ã—ã¾ã™ã€‚
                    ã“ã‚Œã¯ã‚°ãƒ©ãƒ•ã‚¡ã‚¤ãƒˆå±¤é–“è·é›¢ã«å¯¾å¿œã™ã‚‹é‡è¦ãªãƒ”ãƒ¼ã‚¯ã§ã™ã€‚
                </p>
            </details>
        </div>

        <div class="exercise">
            <h3>æ¼”ç¿’4ï¼šãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°èª²é¡Œ</h3>
            <p>
                ä»¥ä¸‹ã®æ¡ä»¶ã§æ¶ç©ºã®ææ–™ã®XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€
                ä¸»è¦ãªãƒ”ãƒ¼ã‚¯ï¼ˆä¸Šä½5ã¤ï¼‰ã®ä½ç½®ã¨ç›¸å¯¾å¼·åº¦ã‚’è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ãªã•ã„ï¼š
            </p>
            <ul>
                <li>çµæ™¶ç³»ï¼šç«‹æ–¹æ™¶ï¼ˆFCCæ§‹é€ ï¼‰</li>
                <li>æ ¼å­å®šæ•°ï¼ša = 4.00 Ã…</li>
                <li>Xç·šæ³¢é•·ï¼šCu KÎ±ç·šï¼ˆÎ» = 1.5406 Ã…ï¼‰</li>
                <li>æ¸¬å®šç¯„å›²ï¼š2Î¸ = 20Â° ã€œ 90Â°</li>
            </ul>
            <details>
                <summary>ãƒ’ãƒ³ãƒˆ</summary>
                <p>
                    ã‚³ãƒ¼ãƒ‰ä¾‹1ã¨3ã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã—ã¾ã™ã€‚FCCæ§‹é€ ã®åŸå­ä½ç½®ã¨æ§‹é€ å› å­è¨ˆç®—ã€
                    ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã«ã‚ˆã‚‹å›æŠ˜è§’è¨ˆç®—ã€å¤šé‡åº¦ã‚’è€ƒæ…®ã—ãŸå¼·åº¦è¨ˆç®—ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
                </p>
                <p>
                    å®Œæˆã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€(111), (200), (220), (311), (222) ãªã©ã®ãƒ”ãƒ¼ã‚¯ã‚’
                    æ­£ã—ã„è§’åº¦ã¨ç›¸å¯¾å¼·åº¦ã§è¡¨ç¤ºã™ã‚‹ã¯ãšã§ã™ã€‚
                </p>
            </details>
        </div>

        <h2>ã¾ã¨ã‚</h2>

        <p>ã“ã®ç« ã§ã¯ã€Xç·šå›æŠ˜ã®åŸç†ã¨å®Ÿéš›ã®è§£ææ‰‹æ³•ã‚’å­¦ã³ã¾ã—ãŸï¼š</p>

        <div class="success-box">
            <h4>é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h4>
            <ul>
                <li><strong>ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ nÎ» = 2d sinÎ¸</strong>ã¯å›æŠ˜ãŒèµ·ã“ã‚‹å¿…è¦æ¡ä»¶</li>
                <li><strong>æ§‹é€ å› å­ F<sub>hkl</sub></strong>ãŒã‚¼ãƒ­ã®å ´åˆã€ãƒ–ãƒ©ãƒƒã‚°ã®æ³•å‰‡ã‚’æº€ãŸã—ã¦ã‚‚å›æŠ˜ã—ãªã„ï¼ˆæ¶ˆæ»…å‰‡ï¼‰</li>
                <li><strong>æ¶ˆæ»…å‰‡</strong>ã‹ã‚‰çµæ™¶æ§‹é€ ï¼ˆSC, BCC, FCCç­‰ï¼‰ã‚’æ¨å®šã§ãã‚‹</li>
                <li><strong>å›æŠ˜å¼·åº¦</strong>ã¯æ§‹é€ å› å­ã€å¤šé‡åº¦ã€ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„åå…‰å› å­ã€æ¸©åº¦å› å­ãªã©å¤šãã®å› å­ã«ä¾å­˜</li>
                <li><strong>ç²‰æœ«XRD</strong>ã¯ææ–™åŒå®šã€ç›¸åˆ†æã€æ ¼å­å®šæ•°æ±ºå®šã«åºƒãä½¿ã‚ã‚Œã‚‹</li>
                <li><strong>ãƒ”ãƒ¼ã‚¯ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</strong>ã«ã‚ˆã‚Šæ­£ç¢ºãªãƒ”ãƒ¼ã‚¯ä½ç½®ã¨å¹…ã‚’æ±ºå®šã§ãã‚‹</li>
                <li><strong>pymatgen</strong>ã‚’ä½¿ã†ã¨ã€çµæ™¶æ§‹é€ ã‹ã‚‰è‡ªå‹•çš„ã«XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆã§ãã‚‹</li>
                <li><strong>ãƒªãƒ¼ãƒˆãƒ™ãƒ«ãƒˆè§£æ</strong>ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³å…¨ä½“ã‚’ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã—ã€æ§‹é€ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç²¾å¯†åŒ–ã™ã‚‹æ‰‹æ³•</li>
            </ul>
        </div>

        <p>
            æ¬¡ç« ã§ã¯ã€<strong>çµæ™¶æ§‹é€ ã®å¯è¦–åŒ–ã¨è§£æ</strong>ã‚’å­¦ã³ã€
            å®Ÿéš›ã®ææ–™ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ§‹é€ ã‚’å–å¾—ã—ã¦è§£æã™ã‚‹å®Ÿè·µçš„ãªã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã—ã¾ã™ã€‚
        </p>

        <div class="navigation">
            <a href="chapter-3.html" class="nav-button prev">ç¬¬3ç« ï¼šãƒŸãƒ©ãƒ¼æŒ‡æ•°ã¨çµæ™¶é¢ãƒ»æ–¹å‘</a>
            <a href="chapter-5.html" class="nav-button next">ç¬¬5ç« ï¼šçµæ™¶æ§‹é€ ã®å¯è¦–åŒ–ã¨è§£æ</a>
        </div>
    </div>

    <section class="disclaimer">
<h3>å…è²¬äº‹é …</h3>
<ul>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹Code examplesã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
<li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
</ul>
</section>

<footer style="background-color: var(--color-bg-alt); padding: var(--spacing-lg); text-align: center; margin-top: var(--spacing-xl); border-top: 2px solid var(--color-border);">
        <p style="margin-bottom: var(--spacing-sm); color: var(--color-text-light);">
            &copy; 2025 AIå¯ºå­å±‹ MS Dojo - çµæ™¶å­¦å…¥é–€
        </p>
        <p style="font-size: 0.9rem; color: var(--color-text-light);">
            <a href="../../index.html" style="color: var(--color-link);">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—ã¸</a> |
            <a href="../index.html" style="color: var(--color-link);">MS Dojoã¸</a> |
            <a href="index.html" style="color: var(--color-link);">çµæ™¶å­¦å…¥é–€ãƒˆãƒƒãƒ—ã¸</a>
        </p>
    </footer>
</body>
</html>
