<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç« : Pythonå®Ÿè·µãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ - ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹ææ–™å…¥é–€ - MS Dojo</title>
    <meta name="description" content="Materials Project APIã€æ©Ÿæ¢°å­¦ç¿’ã€å¾®æ§‹é€ è§£æã€ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–ã®çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€‚">

    <!-- Prism.js for code highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

    <!-- MathJax for mathematical expressions -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Mermaid for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <style>
        :root {
            --accent-pink: #f093fb;
            --accent-coral: #f5576c;
            --primary-dark: #2c3e50;
            --secondary-dark: #34495e;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --bg-light: #ecf0f1;
            --white: #ffffff;
            --code-bg: #2d2d2d;
            --border-light: #bdc3c7;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.8;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        header {
            background: linear-gradient(135deg, var(--accent-pink) 0%, var(--accent-coral) 100%);
            color: white;
            padding: 3rem 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        nav {
            background: var(--white);
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
        }

        nav a {
            text-decoration: none;
            color: var(--text-dark);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
        }

        nav a:hover {
            background: linear-gradient(135deg, var(--accent-pink) 0%, var(--accent-coral) 100%);
            color: white;
        }

        main {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        section {
            background: var(--white);
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h2 {
            color: var(--primary-dark);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, var(--accent-pink), var(--accent-coral)) 1;
        }

        h3 {
            color: var(--secondary-dark);
            font-size: 1.4rem;
            margin: 2rem 0 1rem;
        }

        h4 {
            color: var(--secondary-dark);
            font-size: 1.2rem;
            margin: 1.5rem 0 1rem;
        }

        p {
            margin-bottom: 1rem;
            line-height: 1.8;
        }

        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: "Consolas", "Monaco", monospace;
            font-size: 0.9em;
            color: #e74c3c;
        }

        pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        pre code {
            background: none;
            color: #f8f8f2;
            padding: 0;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
            border-left: 4px solid var(--accent-coral);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        .info-box strong {
            color: var(--accent-coral);
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .warning-box {
            background: rgba(243, 156, 18, 0.1);
            border-left: 4px solid var(--warning);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        .warning-box strong {
            color: var(--warning);
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .exercise-box {
            background: rgba(39, 174, 96, 0.05);
            border: 2px solid var(--success);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .exercise-box h4 {
            color: var(--success);
            margin-top: 0;
        }

        .difficulty {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .difficulty.easy {
            background: #d4edda;
            color: #155724;
        }

        .difficulty.medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty.hard {
            background: #f8d7da;
            color: #721c24;
        }

        .mermaid {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin: 2rem 0;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        th {
            background: linear-gradient(135deg, var(--accent-pink) 0%, var(--accent-coral) 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(240, 147, 251, 0.05);
        }

        footer {
            background: var(--primary-dark);
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
        }

        footer a {
            color: var(--accent-pink);
            text-decoration: none;
        }

        footer a:hover {
            color: var(--accent-coral);
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }

            nav ul {
                flex-direction: column;
                align-items: center;
            }

            section {
                padding: 1.5rem;
            }

            pre {
                padding: 1rem;
                font-size: 0.85rem;
            }
        }
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
        <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/MS/ceramic-materials-introduction/chapter-5.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="../../MS/index.html">ææ–™ç§‘å­¦</a><span class="breadcrumb-separator">â€º</span><a href="../../MS/ceramic-materials-introduction/index.html">Ceramic Materials</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 5</span>
        </div>
    </nav>

    <header>
        <h1>ç¬¬5ç« : Pythonå®Ÿè·µãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h1>
        <p>Materials Project APIã€æ©Ÿæ¢°å­¦ç¿’ã€å¾®æ§‹é€ è§£æã€ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–ã®çµ±åˆå®Ÿè£…</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">ãƒˆãƒƒãƒ—</a></li>
            <li><a href="#intro">æ¦‚è¦</a></li>
            <li><a href="#materials-project">Materials Project</a></li>
            <li><a href="#ml">æ©Ÿæ¢°å­¦ç¿’</a></li>
            <li><a href="#image-analysis">ç”»åƒè§£æ</a></li>
            <li><a href="#optimization">ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–</a></li>
            <li><a href="#integrated">çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</a></li>
            <li><a href="#exercises">æ¼”ç¿’å•é¡Œ</a></li>
            <li><a href="#references">å‚è€ƒæ–‡çŒ®</a></li>
            <li><a href="chapter-4.html">â† å‰ã®ç« </a></li>
        </ul>
    </nav>

    <main>
        <section id="intro">
            <h2>5.1 ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹ç ”ç©¶ã®Pythonãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h2>

            <p>
                æœ¬ç« ã§ã¯ã€ã“ã‚Œã¾ã§ã®ç†è«–å­¦ç¿’ã‚’å®Ÿè·µçš„ãªç ”ç©¶ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«çµ±åˆã—ã¾ã™ã€‚Materials Project APIã«ã‚ˆã‚‹çµæ™¶æ§‹é€ ãƒ‡ãƒ¼ã‚¿å–å¾—ã€æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ç‰¹æ€§äºˆæ¸¬ã€OpenCVã‚’ç”¨ã„ãŸå¾®æ§‹é€ ç”»åƒè§£æã€scipy.optimizeã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–ã‚’çµ„ã¿åˆã‚ã›ã€å®Ÿéš›ã®ç ”ç©¶èª²é¡Œã«é©ç”¨ã§ãã‚‹ç·åˆçš„ãªã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã—ã¾ã™ã€‚
            </p>

            <div class="info-box">
                <strong>æœ¬ç« ã®å­¦ç¿’ç›®æ¨™</strong>
                <ul>
                    <li><strong>ãƒ¬ãƒ™ãƒ«1ï¼ˆåŸºæœ¬ç†è§£ï¼‰</strong>: Materials Project APIã€scikit-learnã€OpenCVã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’ç†è§£ã—ã€ç°¡å˜ãªãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»è§£æãŒã§ãã‚‹</li>
                    <li><strong>ãƒ¬ãƒ™ãƒ«2ï¼ˆå®Ÿè·µã‚¹ã‚­ãƒ«ï¼‰</strong>: å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ãŸæ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ã€ç”»åƒå‡¦ç†ã«ã‚ˆã‚‹ç²’å¾„åˆ†å¸ƒè§£æã€æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å®Ÿè£…ãŒã§ãã‚‹</li>
                    <li><strong>ãƒ¬ãƒ™ãƒ«3ï¼ˆå¿œç”¨åŠ›ï¼‰</strong>: ç‹¬è‡ªã®ç ”ç©¶èª²é¡Œã«å¯¾ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢â†’ç‰¹æ€§äºˆæ¸¬â†’ãƒ—ãƒ­ã‚»ã‚¹è¨­è¨ˆâ†’å®Ÿé¨“è¨ˆç”»ã®çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆãƒ»å®Ÿè¡Œã§ãã‚‹</li>
                </ul>
            </div>

            <h3>çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å…¨ä½“åƒ</h3>

            <div class="mermaid">
            flowchart TD
                A[ç ”ç©¶èª²é¡Œå®šç¾©<br/>ç›®æ¨™ç‰¹æ€§ã®è¨­å®š] --> B[Materials Project<br/>çµæ™¶æ§‹é€ ãƒ‡ãƒ¼ã‚¿å–å¾—]
                B --> C[XRD/æ§‹é€ è§£æ<br/>pymatgenå‡¦ç†]
                C --> D[æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«<br/>ç‰¹æ€§äºˆæ¸¬]
                D --> E[å€™è£œææ–™é¸å®š<br/>ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°]
                E --> F[ãƒ—ãƒ­ã‚»ã‚¹è¨­è¨ˆ<br/>ç„¼çµæ¡ä»¶æœ€é©åŒ–]
                F --> G[å®Ÿé¨“è¨ˆç”»<br/>DOE/Bayesianæœ€é©åŒ–]
                G --> H[å¾®æ§‹é€ è§£æ<br/>SEMç”»åƒå‡¦ç†]
                H --> I[ç‰¹æ€§è©•ä¾¡<br/>Weibullè§£æ]
                I --> J{ç›®æ¨™é”æˆ?}
                J -->|No| D
                J -->|Yes| K[æˆæœã¾ã¨ã‚<br/>è«–æ–‡ãƒ»å ±å‘Š]

                style A fill:#f093fb,color:#fff
                style D fill:#f5576c,color:#fff
                style F fill:#f5576c,color:#fff
                style K fill:#4caf50,color:#fff
            </flowchart>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ãƒ•ã‚§ãƒ¼ã‚º</th>
                        <th>ãƒ„ãƒ¼ãƒ«</th>
                        <th>å…¥åŠ›</th>
                        <th>å‡ºåŠ›</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ãƒ‡ãƒ¼ã‚¿å–å¾—</td>
                        <td>Materials Project API</td>
                        <td>åŒ–å­¦å¼ã€ç‰¹æ€§ç¯„å›²</td>
                        <td>çµæ™¶æ§‹é€ ã€ç‰©æ€§å€¤</td>
                    </tr>
                    <tr>
                        <td>ç‰¹æ€§äºˆæ¸¬</td>
                        <td>scikit-learn</td>
                        <td>çµ„æˆã€æ§‹é€ è¨˜è¿°å­</td>
                        <td>èª˜é›»ç‡ã€ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—</td>
                    </tr>
                    <tr>
                        <td>å¾®æ§‹é€ è§£æ</td>
                        <td>OpenCV</td>
                        <td>SEMç”»åƒ</td>
                        <td>ç²’å¾„åˆ†å¸ƒã€æ°—å­”ç‡</td>
                    </tr>
                    <tr>
                        <td>ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–</td>
                        <td>scipy.optimize</td>
                        <td>å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿</td>
                        <td>æœ€é©ç„¼çµæ¡ä»¶</td>
                    </tr>
                    <tr>
                        <td>çµ±åˆè§£æ</td>
                        <td>pandas, matplotlib</td>
                        <td>å…¨ãƒ‡ãƒ¼ã‚¿</td>
                        <td>ãƒ¬ãƒãƒ¼ãƒˆã€å¯è¦–åŒ–</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="materials-project">
            <h2>5.2 Materials Project APIã®æ´»ç”¨</h2>

            <h3>5.2.1 Materials Projectã¨ã¯</h3>

            <p>
                Materials Projectï¼ˆhttps://materialsproject.orgï¼‰ã¯ã€MITãƒ»LBNLãŒé‹å–¶ã™ã‚‹ææ–™ç§‘å­¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã€150,000ä»¥ä¸Šã®ç„¡æ©Ÿææ–™ã®çµæ™¶æ§‹é€ ã€é›»å­æ§‹é€ ã€ç†±åŠ›å­¦ç‰¹æ€§ã‚’æä¾›ã—ã¾ã™ã€‚Python APIã‚’é€šã˜ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã™ã€‚
            </p>

            <h3>5.2.2 APIåˆ©ç”¨ã®æº–å‚™</h3>

            <p>
                Materials Project APIã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ç„¡æ–™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ãŒå¿…è¦ã§ã™ï¼š
            </p>

            <ol>
                <li>https://materialsproject.org ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                <li>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ï¼ˆç„¡æ–™ï¼‰</li>
                <li>Dashboard â†’ API ã‹ã‚‰APIã‚­ãƒ¼ã‚’å–å¾—</li>
                <li>ç’°å¢ƒå¤‰æ•°ã«è¨­å®š: <code>export MP_API_KEY="your_api_key"</code></li>
            </ol>

            <h4>Pythonå®Ÿè£…: Materials Project APIçµæ™¶æ§‹é€ å–å¾—</h4>

            <pre><code class="language-python"># ===================================
# Example 1: Materials Project APIçµæ™¶æ§‹é€ å–å¾—
# ===================================

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«: pip install mp-api pymatgen

from mp_api.client import MPRester
import os

def get_material_data_from_mp(formula, api_key=None):
    """
    Materials Projectã‹ã‚‰BaTiO3ã®çµæ™¶æ§‹é€ ã¨ç‰©æ€§ã‚’å–å¾—

    Parameters:
    -----------
    formula : str
        åŒ–å­¦å¼ï¼ˆä¾‹: "BaTiO3", "Al2O3"ï¼‰
    api_key : str
        Materials Project APIã‚­ãƒ¼ï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰è‡ªå‹•å–å¾—ã‚‚å¯ï¼‰

    Returns:
    --------
    results : dict
        ææ–™ãƒ‡ãƒ¼ã‚¿ï¼ˆæ§‹é€ ã€ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ãªã©ï¼‰
    """
    # APIã‚­ãƒ¼ã®å–å¾—
    if api_key is None:
        api_key = os.environ.get('MP_API_KEY')
        if api_key is None:
            raise ValueError("API key not found. Set MP_API_KEY environment variable.")

    # MPResterã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—
    with MPRester(api_key) as mpr:
        # åŒ–å­¦å¼ã§æ¤œç´¢
        docs = mpr.materials.summary.search(formula=formula)

        if not docs:
            print(f"No data found for {formula}")
            return None

        # æœ€å®‰å®šç›¸ï¼ˆformation_energy_per_atomãŒæœ€å°ï¼‰ã‚’é¸æŠ
        stable_material = min(docs, key=lambda x: x.formation_energy_per_atom)

        results = {
            'material_id': stable_material.material_id,
            'formula': stable_material.formula_pretty,
            'formation_energy': stable_material.formation_energy_per_atom,
            'band_gap': stable_material.band_gap,
            'density': stable_material.density,
            'structure': stable_material.structure,
            'spacegroup': stable_material.symmetry.symbol,
            'volume': stable_material.structure.volume
        }

        return results


def analyze_mp_batio3():
    """
    BaTiO3ã®Materials Projectãƒ‡ãƒ¼ã‚¿ã‚’è§£æ
    """
    import matplotlib.pyplot as plt
    from pymatgen.analysis.diffraction.xrd import XRDCalculator

    # BaTiO3ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå®Ÿéš›ã«ã¯è‡ªåˆ†ã®APIã‚­ãƒ¼ã‚’ä½¿ç”¨ï¼‰
    print("=== Fetching BaTiO3 data from Materials Project ===")

    # æ³¨: ä»¥ä¸‹ã¯ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã«ã¯APIã‹ã‚‰å–å¾—ï¼‰
    # å®Ÿè¡Œæ™‚ã¯ä¸Šè¨˜ã®get_material_data_from_mp()ã‚’ä½¿ç”¨

    print("Material ID: mp-2998")
    print("Formula: BaTiO3")
    print("Formation Energy: -1.68 eV/atom")
    print("Band Gap: 1.79 eV")
    print("Density: 6.02 g/cmÂ³")
    print("Space Group: P4mm (99)")
    print("Volume: 64.2 Ã…Â³")

    # XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆpymatgenä½¿ç”¨ï¼‰
    print("\n=== Simulating XRD Pattern ===")

    # å®Ÿéš›ã®å®Ÿè£…ä¾‹ï¼ˆæ§‹é€ ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ï¼‰
    """
    data = get_material_data_from_mp("BaTiO3")
    structure = data['structure']

    calculator = XRDCalculator()
    pattern = calculator.get_pattern(structure, two_theta_range=(10, 90))

    # XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ—ãƒ­ãƒƒãƒˆ
    plt.figure(figsize=(10, 5))
    plt.plot(pattern.x, pattern.y, linewidth=2, color='navy')
    plt.xlabel('2Î¸ (degrees)', fontsize=12)
    plt.ylabel('Intensity (a.u.)', fontsize=12)
    plt.title('BaTiO3 XRD Pattern (Simulated)', fontsize=14, fontweight='bold')
    plt.grid(True, alpha=0.3)
    plt.savefig('batio3_xrd.png', dpi=300, bbox_inches='tight')
    plt.show()
    """

    print("XRD simulation requires pymatgen and structure data.")
    print("Main peaks expected at 2Î¸ â‰ˆ 22Â°, 31Â°, 38Â°, 45Â°, 50Â°, 56Â°")


def compare_perovskite_oxides():
    """
    ãƒšãƒ­ãƒ–ã‚¹ã‚«ã‚¤ãƒˆé…¸åŒ–ç‰©ã®ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—æ¯”è¼ƒ
    """
    import matplotlib.pyplot as plt
    import numpy as np

    # Materials Projectã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿä¾‹ï¼‰
    perovskites = {
        'BaTiOâ‚ƒ': {'band_gap': 1.79, 'formation_energy': -1.68},
        'SrTiOâ‚ƒ': {'band_gap': 1.80, 'formation_energy': -1.75},
        'CaTiOâ‚ƒ': {'band_gap': 2.10, 'formation_energy': -1.82},
        'PbTiOâ‚ƒ': {'band_gap': 1.50, 'formation_energy': -1.45},
        'KNbOâ‚ƒ': {'band_gap': 1.90, 'formation_energy': -1.55}
    }

    names = list(perovskites.keys())
    band_gaps = [data['band_gap'] for data in perovskites.values()]
    formation_energies = [data['formation_energy'] for data in perovskites.values()]

    fig, axes = plt.subplots(1, 2, figsize=(14, 5))

    # å·¦å›³: ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—æ¯”è¼ƒ
    ax1 = axes[0]
    colors = ['#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b']
    ax1.bar(names, band_gaps, color=colors, edgecolor='black', linewidth=1.5)
    ax1.axhline(y=1.5, color='red', linestyle='--', linewidth=2, label='Visible light threshold (~1.5 eV)')
    ax1.set_ylabel('Band Gap (eV)', fontsize=12)
    ax1.set_title('Perovskite Oxide Band Gaps', fontsize=14, fontweight='bold')
    ax1.legend()
    ax1.grid(True, alpha=0.3, axis='y')

    # å³å›³: å®‰å®šæ€§ï¼ˆç”Ÿæˆã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼‰
    ax2 = axes[1]
    ax2.barh(names, formation_energies, color=colors, edgecolor='black', linewidth=1.5)
    ax2.set_xlabel('Formation Energy (eV/atom)', fontsize=12)
    ax2.set_title('Thermodynamic Stability', fontsize=14, fontweight='bold')
    ax2.grid(True, alpha=0.3, axis='x')

    plt.tight_layout()
    plt.savefig('perovskite_comparison.png', dpi=300, bbox_inches='tight')
    plt.show()

    print("=== Perovskite Oxide Properties ===")
    for name, props in perovskites.items():
        print(f"{name:10s}: Band Gap = {props['band_gap']:.2f} eV, Î”H_f = {props['formation_energy']:.2f} eV/atom")

# å®Ÿè¡Œ
# analyze_mp_batio3()  # å®Ÿéš›ã«ã¯APIã‚­ãƒ¼ãŒå¿…è¦
compare_perovskite_oxides()
</code></pre>

            <div class="info-box">
                <strong>Materials Projectã®æ´»ç”¨ã‚·ãƒ¼ãƒ³</strong>
                <ul>
                    <li>æ–°ææ–™ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°: ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—1.5-2.5 eVã®å…‰è§¦åª’å€™è£œã‚’ä¸€æ‹¬æ¤œç´¢</li>
                    <li>ç›¸å®‰å®šæ€§è©•ä¾¡: åŒ–åˆç‰©ã®ç”Ÿæˆã‚¨ãƒãƒ«ã‚®ãƒ¼ã‹ã‚‰ç†±åŠ›å­¦çš„å®‰å®šæ€§ã‚’åˆ¤æ–­</li>
                    <li>XRDãƒ‘ã‚¿ãƒ¼ãƒ³äºˆæ¸¬: åˆæˆå‰ã«XRDæŒ‡ç´‹ã‚’äºˆæ¸¬ã—ã€å®Ÿé¨“çµæœã¨ç…§åˆ</li>
                    <li>å…ƒç´ ç½®æ›åŠ¹æœ: Aã‚µã‚¤ãƒˆã‚’Baâ†’Srã«ç½®æ›ã—ãŸã¨ãã®ç‰©æ€§å¤‰åŒ–ã‚’æ¯”è¼ƒ</li>
                </ul>
            </div>

            <h4>Pythonå®Ÿè£…: XRDå®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¯”è¼ƒ</h4>

            <pre><code class="language-python"># ===================================
# Example 2: XRDå®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¯”è¼ƒ
# ===================================

import numpy as np
import matplotlib.pyplot as plt

def simulate_xrd_pattern(two_theta, peaks):
    """
    XRDãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¬ã‚¦ã‚¹é–¢æ•°ã®å’Œï¼‰

    Parameters:
    -----------
    two_theta : array
        2Î¸è§’åº¦ç¯„å›²
    peaks : list of dict
        ãƒ”ãƒ¼ã‚¯æƒ…å ± [{'position': 2Î¸, 'intensity': I, 'fwhm': FWHM}, ...]

    Returns:
    --------
    intensity : array
        å¼·åº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
    """
    intensity = np.zeros_like(two_theta)

    for peak in peaks:
        pos = peak['position']
        I = peak['intensity']
        fwhm = peak['fwhm']
        sigma = fwhm / (2 * np.sqrt(2 * np.log(2)))

        intensity += I * np.exp(-((two_theta - pos)**2) / (2 * sigma**2))

    return intensity


def compare_experimental_simulated_xrd():
    """
    å®Ÿé¨“XRDã¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¯”è¼ƒ
    """
    # 2Î¸ç¯„å›²
    two_theta = np.linspace(10, 90, 1000)

    # BaTiO3ã®ç†è«–ãƒ”ãƒ¼ã‚¯ï¼ˆMaterials Projectã‹ã‚‰ï¼‰
    theoretical_peaks = [
        {'position': 22.2, 'intensity': 100, 'fwhm': 0.3, 'hkl': '(001)'},
        {'position': 31.5, 'intensity': 60, 'fwhm': 0.3, 'hkl': '(011)'},
        {'position': 38.9, 'intensity': 50, 'fwhm': 0.3, 'hkl': '(111)'},
        {'position': 45.0, 'intensity': 30, 'fwhm': 0.3, 'hkl': '(002)'},
        {'position': 50.9, 'intensity': 25, 'fwhm': 0.3, 'hkl': '(012)'},
        {'position': 56.2, 'intensity': 40, 'fwhm': 0.3, 'hkl': '(112)'}
    ]

    # å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ”ãƒ¼ã‚¯ä½ç½®ãŒã‚ãšã‹ã«ã‚·ãƒ•ãƒˆã€FWHMåºƒã„ï¼‰
    experimental_peaks = [
        {'position': 22.3, 'intensity': 95, 'fwhm': 0.5},
        {'position': 31.6, 'intensity': 58, 'fwhm': 0.5},
        {'position': 39.0, 'intensity': 48, 'fwhm': 0.5},
        {'position': 45.2, 'intensity': 28, 'fwhm': 0.5},
        {'position': 51.1, 'intensity': 23, 'fwhm': 0.5},
        {'position': 56.4, 'intensity': 38, 'fwhm': 0.5}
    ]

    # ãƒã‚¤ã‚ºè¿½åŠ 
    np.random.seed(42)
    noise = np.random.normal(0, 2, len(two_theta))

    # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
    I_theory = simulate_xrd_pattern(two_theta, theoretical_peaks)
    I_exp = simulate_xrd_pattern(two_theta, experimental_peaks) + noise

    # ãƒ—ãƒ­ãƒƒãƒˆ
    plt.figure(figsize=(12, 6))

    plt.plot(two_theta, I_theory, linewidth=2, color='blue', label='Simulated (Materials Project)', alpha=0.8)
    plt.plot(two_theta, I_exp, linewidth=1.5, color='red', label='Experimental', alpha=0.7)

    # ãƒ”ãƒ¼ã‚¯ä½ç½®ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    for peak in theoretical_peaks[:3]:  # ä¸»è¦3ãƒ”ãƒ¼ã‚¯ã®ã¿è¡¨ç¤º
        plt.axvline(x=peak['position'], color='blue', linestyle='--', alpha=0.3)
        plt.text(peak['position'], peak['intensity'] + 5, peak['hkl'],
                ha='center', fontsize=10, color='blue')

    plt.xlabel('2Î¸ (degrees)', fontsize=12)
    plt.ylabel('Intensity (a.u.)', fontsize=12)
    plt.title('BaTiOâ‚ƒ XRD Pattern: Experimental vs Simulated', fontsize=14, fontweight='bold')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.xlim(10, 90)
    plt.savefig('xrd_comparison.png', dpi=300, bbox_inches='tight')
    plt.show()

    # ãƒ”ãƒ¼ã‚¯ã‚·ãƒ•ãƒˆã®å®šé‡è©•ä¾¡
    print("=== XRD Peak Position Comparison ===")
    print("hkl     Theory   Exp.    Shift")
    for theo, exp in zip(theoretical_peaks, experimental_peaks):
        shift = exp['position'] - theo['position']
        hkl = theo.get('hkl', '---')
        print(f"{hkl:6s}  {theo['position']:5.1f}Â°  {exp['position']:5.1f}Â°  {shift:+5.2f}Â°")

    # æ ¼å­å®šæ•°ã®æ¨å®š
    print("\n=== Lattice Parameter Estimation ===")
    print("Peak shift suggests lattice expansion/contraction.")
    print("Average shift: +0.15Â° â†’ Î”a/a â‰ˆ +0.3% (tensile strain)")

# å®Ÿè¡Œ
compare_experimental_simulated_xrd()
</code></pre>

            <div class="warning-box">
                <strong>XRDãƒ‡ãƒ¼ã‚¿ã®è§£é‡ˆ</strong>
                å®Ÿé¨“XRDãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç†è«–ã¨ç•°ãªã‚‹åŸå› ï¼š
                <ul>
                    <li>æ ¼å­æ­ªã¿: æ®‹ç•™å¿œåŠ›ã«ã‚ˆã‚‹ãƒ”ãƒ¼ã‚¯ã‚·ãƒ•ãƒˆ</li>
                    <li>çµæ™¶å­ã‚µã‚¤ã‚º: ãƒŠãƒç²’å­ã§ã¯ãƒ”ãƒ¼ã‚¯å¹…ãŒåºƒãŒã‚‹ï¼ˆScherrerå¼ï¼‰</li>
                    <li>ä¸ç´”ç‰©ç›¸: ç†è«–ã«ãªã„ä½™å‰°ãƒ”ãƒ¼ã‚¯ãŒå‡ºç¾</li>
                    <li>é…å‘æ€§: è–„è†œè©¦æ–™ã§ã¯ç‰¹å®šé¢æ–¹ä½ãŒå¼·èª¿</li>
                </ul>
            </div>
        </section>

        <section id="ml">
            <h2>5.3 æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ç‰¹æ€§äºˆæ¸¬</h2>

            <h3>5.3.1 ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹ææ–™ã¸ã®æ©Ÿæ¢°å­¦ç¿’é©ç”¨</h3>

            <p>
                æ©Ÿæ¢°å­¦ç¿’ã¯ã€å¤§é‡ã®ææ–™ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰çµ„æˆ-æ§‹é€ -ç‰¹æ€§ã®é–¢ä¿‚ã‚’å­¦ç¿’ã—ã€æœªçŸ¥ææ–™ã®ç‰¹æ€§ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹ã§ã¯ã€èª˜é›»ç‡ã€ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã€ç†±ä¼å°ç‡ãªã©ã®äºˆæ¸¬ã«å¿œç”¨ã•ã‚Œã¾ã™ã€‚
            </p>

            <h3>5.3.2 è¨˜è¿°å­ï¼ˆDescriptorï¼‰ã®è¨­è¨ˆ</h3>

            <p>
                ææ–™ã‚’æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«å…¥åŠ›ã™ã‚‹ãŸã‚ã€çµ„æˆãƒ»æ§‹é€ ã‚’æ•°å€¤ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆè¨˜è¿°å­ï¼‰ã«å¤‰æ›ã—ã¾ã™ï¼š
            </p>

            <ul>
                <li><strong>çµ„æˆè¨˜è¿°å­</strong>: åŸå­åŠå¾„ã€é›»æ°—é™°æ€§åº¦ã€ã‚¤ã‚ªãƒ³ä¾¡æ•°ã®å¹³å‡/æ¨™æº–åå·®</li>
                <li><strong>æ§‹é€ è¨˜è¿°å­</strong>: çµåˆè·é›¢ã€é…ä½æ•°ã€å¯¾ç§°æ€§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
                <li><strong>é›»å­æ§‹é€ è¨˜è¿°å­</strong>: ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã€çŠ¶æ…‹å¯†åº¦ã®ç‰¹å¾´é‡</li>
            </ul>

            <h4>Pythonå®Ÿè£…: scikit-learnæ©Ÿæ¢°å­¦ç¿’ç‰¹æ€§äºˆæ¸¬</h4>

            <pre><code class="language-python"># ===================================
# Example 3: scikit-learnæ©Ÿæ¢°å­¦ç¿’ç‰¹æ€§äºˆæ¸¬
# ===================================

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error, r2_score

def generate_ceramic_dataset():
    """
    ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹ææ–™ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ç”Ÿæˆï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰
    å®Ÿéš›ã«ã¯Materials Projectã‚„å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨

    Returns:
    --------
    df : DataFrame
        ææ–™ãƒ‡ãƒ¼ã‚¿ï¼ˆçµ„æˆè¨˜è¿°å­ + èª˜é›»ç‡ï¼‰
    """
    np.random.seed(42)
    n_samples = 200

    # çµ„æˆè¨˜è¿°å­ï¼ˆç°¡ç•¥åŒ–ï¼‰
    # X1: A-siteå¹³å‡ã‚¤ã‚ªãƒ³åŠå¾„ [Ã…]
    # X2: B-siteå¹³å‡é›»æ°—é™°æ€§åº¦
    # X3: é…¸ç´ æ¬ ææ¿ƒåº¦ [%]
    # X4: ç„¼çµæ¸©åº¦ [Â°C]

    X1 = np.random.uniform(1.0, 1.5, n_samples)  # Ba(1.35), Sr(1.18), Ca(1.00)
    X2 = np.random.uniform(1.5, 2.5, n_samples)  # Ti(1.54), Zr(1.33), Nb(1.6)
    X3 = np.random.uniform(0, 5, n_samples)
    X4 = np.random.uniform(1200, 1600, n_samples)

    # èª˜é›»ç‡ï¼ˆãƒ€ãƒŸãƒ¼ãƒ¢ãƒ‡ãƒ«ï¼‰
    # Îµáµ£ âˆ f(ã‚¤ã‚ªãƒ³åŠå¾„, é›»æ°—é™°æ€§åº¦, æ¬ æ, æ¸©åº¦)
    epsilon_r = 1000 + 3000 * X1 + 500 * (2.0 - X2) - 100 * X3 + 0.5 * X4 + \
                np.random.normal(0, 200, n_samples)

    # ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ä½œæˆ
    df = pd.DataFrame({
        'ionic_radius_A': X1,
        'electronegativity_B': X2,
        'oxygen_vacancy': X3,
        'sintering_temp': X4,
        'permittivity': epsilon_r
    })

    return df


def train_ml_model_for_permittivity():
    """
    ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã«ã‚ˆã‚‹èª˜é›»ç‡äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
    """
    # ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç”Ÿæˆ
    df = generate_ceramic_dataset()

    print("=== Dataset Overview ===")
    print(df.head())
    print(f"\nDataset size: {len(df)} samples")
    print(f"Permittivity range: {df['permittivity'].min():.0f} - {df['permittivity'].max():.0f}")

    # ç‰¹å¾´é‡ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
    X = df[['ionic_radius_A', 'electronegativity_B', 'oxygen_vacancy', 'sintering_temp']]
    y = df['permittivity']

    # è¨“ç·´/ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†å‰²
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    # ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã®è¨“ç·´
    model = RandomForestRegressor(n_estimators=100, max_depth=10, random_state=42)
    model.fit(X_train, y_train)

    # äºˆæ¸¬
    y_pred_train = model.predict(X_train)
    y_pred_test = model.predict(X_test)

    # è©•ä¾¡æŒ‡æ¨™
    rmse_train = np.sqrt(mean_squared_error(y_train, y_pred_train))
    rmse_test = np.sqrt(mean_squared_error(y_test, y_pred_test))
    r2_train = r2_score(y_train, y_pred_train)
    r2_test = r2_score(y_test, y_pred_test)

    print("\n=== Model Performance ===")
    print(f"Train RMSE: {rmse_train:.1f}, RÂ² = {r2_train:.3f}")
    print(f"Test  RMSE: {rmse_test:.1f}, RÂ² = {r2_test:.3f}")

    # å¯è¦–åŒ–
    fig, axes = plt.subplots(1, 2, figsize=(14, 5))

    # å·¦å›³: äºˆæ¸¬ vs å®Ÿæ¸¬
    ax1 = axes[0]
    ax1.scatter(y_train, y_pred_train, alpha=0.5, s=50, label='Train', color='blue')
    ax1.scatter(y_test, y_pred_test, alpha=0.7, s=50, label='Test', color='red')

    # ç†æƒ³ç·š
    y_range = [df['permittivity'].min(), df['permittivity'].max()]
    ax1.plot(y_range, y_range, 'k--', linewidth=2, label='Perfect prediction')

    ax1.set_xlabel('Actual Permittivity', fontsize=12)
    ax1.set_ylabel('Predicted Permittivity', fontsize=12)
    ax1.set_title(f'Prediction Accuracy (RÂ² = {r2_test:.3f})', fontsize=14, fontweight='bold')
    ax1.legend()
    ax1.grid(True, alpha=0.3)

    # å³å›³: ç‰¹å¾´é‡é‡è¦åº¦
    ax2 = axes[1]
    importances = model.feature_importances_
    features = X.columns
    indices = np.argsort(importances)[::-1]

    ax2.barh(range(len(importances)), importances[indices], color='skyblue', edgecolor='black')
    ax2.set_yticks(range(len(importances)))
    ax2.set_yticklabels([features[i] for i in indices])
    ax2.set_xlabel('Feature Importance', fontsize=12)
    ax2.set_title('Random Forest Feature Importance', fontsize=14, fontweight='bold')
    ax2.grid(True, alpha=0.3, axis='x')

    plt.tight_layout()
    plt.savefig('ml_permittivity_prediction.png', dpi=300, bbox_inches='tight')
    plt.show()

    return model, X.columns


# å®Ÿè¡Œ
model, features = train_ml_model_for_permittivity()

# æ–°ææ–™ã®äºˆæ¸¬ä¾‹
print("\n=== Predicting New Material ===")
new_material = pd.DataFrame({
    'ionic_radius_A': [1.35],  # Ba-site
    'electronegativity_B': [1.54],  # Ti-site
    'oxygen_vacancy': [0.5],
    'sintering_temp': [1400]
})
predicted_permittivity = model.predict(new_material)
print(f"Input: {new_material.values[0]}")
print(f"Predicted permittivity: {predicted_permittivity[0]:.0f}")
</code></pre>

            <h4>Pythonå®Ÿè£…: ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆç‰¹å¾´é‡é‡è¦åº¦</h4>

            <pre><code class="language-python"># ===================================
# Example 4: ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆç‰¹å¾´é‡é‡è¦åº¦ã®è©³ç´°è§£æ
# ===================================

import numpy as np
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestRegressor
from sklearn.inspection import permutation_importance

def analyze_feature_importance():
    """
    ç‰¹å¾´é‡é‡è¦åº¦ã®è©³ç´°è§£æï¼ˆGinié‡è¦åº¦ vs Permutationé‡è¦åº¦ï¼‰
    """
    # ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç”Ÿæˆ
    df = generate_ceramic_dataset()
    X = df[['ionic_radius_A', 'electronegativity_B', 'oxygen_vacancy', 'sintering_temp']]
    y = df['permittivity']

    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    # ãƒ¢ãƒ‡ãƒ«è¨“ç·´
    model = RandomForestRegressor(n_estimators=100, max_depth=10, random_state=42)
    model.fit(X_train, y_train)

    # Ginié‡è¦åº¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
    gini_importances = model.feature_importances_

    # Permutationé‡è¦åº¦ï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼‰
    perm_importance = permutation_importance(model, X_test, y_test, n_repeats=10, random_state=42)
    perm_importances = perm_importance.importances_mean

    # å¯è¦–åŒ–
    features = X.columns
    x = np.arange(len(features))
    width = 0.35

    plt.figure(figsize=(10, 6))
    plt.barh(x - width/2, gini_importances, width, label='Gini Importance', color='skyblue', edgecolor='black')
    plt.barh(x + width/2, perm_importances, width, label='Permutation Importance', color='salmon', edgecolor='black')

    plt.yticks(x, features)
    plt.xlabel('Importance', fontsize=12)
    plt.title('Feature Importance Comparison', fontsize=14, fontweight='bold')
    plt.legend()
    plt.grid(True, alpha=0.3, axis='x')
    plt.tight_layout()
    plt.savefig('feature_importance_comparison.png', dpi=300, bbox_inches='tight')
    plt.show()

    print("=== Feature Importance Analysis ===")
    print("Feature                    Gini      Permutation")
    for feat, gini, perm in zip(features, gini_importances, perm_importances):
        print(f"{feat:25s}  {gini:.3f}     {perm:.3f}")

# å®Ÿè¡Œ
analyze_feature_importance()
</code></pre>

            <div class="info-box">
                <strong>æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®é¸æŠ</strong>
                <ul>
                    <li><strong>ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆ</strong>: éç·šå½¢é–¢ä¿‚ã®å­¦ç¿’ã€ç‰¹å¾´é‡é‡è¦åº¦ã®å¯è¦–åŒ–ã«å„ªã‚Œã‚‹</li>
                    <li><strong>å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼ˆXGBoostï¼‰</strong>: é«˜ç²¾åº¦äºˆæ¸¬ã€ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ãŒé‡è¦</li>
                    <li><strong>ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</strong>: å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã€è¤‡é›‘ãªç›¸äº’ä½œç”¨ã®å­¦ç¿’</li>
                    <li><strong>ç·šå½¢å›å¸°</strong>: è§£é‡ˆæ€§é‡è¦–ã€ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨ã®çµ±åˆ</li>
                </ul>
            </div>
        </section>

        <section id="image-analysis">
            <h2>5.4 å¾®æ§‹é€ ç”»åƒè§£æ</h2>

            <h3>5.4.1 SEMç”»åƒå‡¦ç†ã®æµã‚Œ</h3>

            <p>
                SEMï¼ˆèµ°æŸ»é›»å­é¡•å¾®é¡ï¼‰ç”»åƒã‹ã‚‰ç²’å¾„åˆ†å¸ƒã€æ°—å­”ç‡ã€ç²’ç•Œæ§‹é€ ã‚’å®šé‡çš„ã«æŠ½å‡ºã—ã¾ã™ã€‚OpenCVã‚’ç”¨ã„ãŸç”»åƒå‡¦ç†ã®å…¸å‹çš„ãªæµã‚Œï¼š
            </p>

            <ol>
                <li>å‰å‡¦ç†: ãƒã‚¤ã‚ºé™¤å»ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆèª¿æ•´</li>
                <li>äºŒå€¤åŒ–: ç²’å­/èƒŒæ™¯ã®åˆ†é›¢</li>
                <li>ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³: å€‹åˆ¥ç²’å­ã®è­˜åˆ¥ï¼ˆWatershedæ³•ï¼‰</li>
                <li>ç‰¹å¾´é‡æŠ½å‡º: é¢ç©ã€å‘¨å›²é•·ã€å††å½¢åº¦ã€ç²’å¾„</li>
                <li>çµ±è¨ˆè§£æ: ç²’å¾„åˆ†å¸ƒã€å¹³å‡ç²’å¾„ã€åˆ†æ•£</li>
            </ol>

            <h4>Pythonå®Ÿè£…: OpenCVã«ã‚ˆã‚‹ç²’å¾„åˆ†å¸ƒè§£æ</h4>

            <pre><code class="language-python"># ===================================
# Example 5: OpenCVç²’å¾„åˆ†å¸ƒè§£æ
# ===================================

import numpy as np
import matplotlib.pyplot as plt
import cv2
from scipy.stats import lognorm

def generate_synthetic_sem_image(size=512, n_particles=100):
    """
    åˆæˆSEMã‚¤ãƒ¡ãƒ¼ã‚¸ã®ç”Ÿæˆï¼ˆå®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®ä»£æ›¿ï¼‰

    Parameters:
    -----------
    size : int
        ç”»åƒã‚µã‚¤ã‚º [px]
    n_particles : int
        ç²’å­æ•°

    Returns:
    --------
    image : array
        ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«SEMã‚¤ãƒ¡ãƒ¼ã‚¸
    """
    image = np.ones((size, size), dtype=np.uint8) * 255  # ç™½èƒŒæ™¯

    np.random.seed(42)
    for _ in range(n_particles):
        # ãƒ©ãƒ³ãƒ€ãƒ ä½ç½®ã¨åŠå¾„ï¼ˆå¯¾æ•°æ­£è¦åˆ†å¸ƒï¼‰
        x = np.random.randint(20, size - 20)
        y = np.random.randint(20, size - 20)
        radius = int(lognorm.rvs(s=0.4, scale=15, size=1)[0])
        radius = np.clip(radius, 5, 30)

        # å††ã‚’æç”»ï¼ˆç²’å­ï¼‰
        cv2.circle(image, (x, y), radius, 100, -1)

        # ç²’ç•Œï¼ˆå††å‘¨ï¼‰
        cv2.circle(image, (x, y), radius, 50, 2)

    # ãƒã‚¤ã‚ºè¿½åŠ 
    noise = np.random.normal(0, 10, image.shape).astype(np.int16)
    image = np.clip(image.astype(np.int16) + noise, 0, 255).astype(np.uint8)

    return image


def analyze_grain_size_distribution(image):
    """
    ç²’å¾„åˆ†å¸ƒã®è§£æ

    Parameters:
    -----------
    image : array
        ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«SEMç”»åƒ

    Returns:
    --------
    grain_sizes : list
        æ¤œå‡ºã•ã‚ŒãŸç²’å­ã®ç­‰ä¾¡å††ç›´å¾„ [px]
    """
    # å‰å‡¦ç†: ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ãƒ–ãƒ©ãƒ¼
    blurred = cv2.GaussianBlur(image, (5, 5), 0)

    # äºŒå€¤åŒ–ï¼ˆå¤§æ´¥ã®æ–¹æ³•ï¼‰
    _, binary = cv2.threshold(blurred, 0, 255, cv2.THRESH_BINARY_INV + cv2.THRESH_OTSU)

    # ãƒ¢ãƒ«ãƒ•ã‚©ãƒ­ã‚¸ãƒ¼å‡¦ç†ï¼ˆãƒã‚¤ã‚ºé™¤å»ï¼‰
    kernel = np.ones((3, 3), np.uint8)
    binary = cv2.morphologyEx(binary, cv2.MORPH_OPEN, kernel, iterations=2)

    # è·é›¢å¤‰æ›ã¨Watershedã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    dist_transform = cv2.distanceTransform(binary, cv2.DIST_L2, 5)
    _, sure_fg = cv2.threshold(dist_transform, 0.3 * dist_transform.max(), 255, 0)
    sure_fg = np.uint8(sure_fg)

    # è¼ªéƒ­æ¤œå‡º
    contours, _ = cv2.findContours(sure_fg, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)

    # ç²’å¾„è¨ˆç®—ï¼ˆç­‰ä¾¡å††ç›´å¾„ï¼‰
    grain_sizes = []
    for contour in contours:
        area = cv2.contourArea(contour)
        if area > 50:  # æœ€å°é¢ç©ãƒ•ã‚£ãƒ«ã‚¿
            equivalent_diameter = np.sqrt(4 * area / np.pi)
            grain_sizes.append(equivalent_diameter)

    return grain_sizes, binary, contours


def plot_grain_analysis_results():
    """
    ç²’å¾„è§£æçµæœã®å¯è¦–åŒ–
    """
    # åˆæˆSEMç”»åƒç”Ÿæˆ
    sem_image = generate_synthetic_sem_image(size=512, n_particles=120)

    # ç²’å¾„è§£æ
    grain_sizes, binary, contours = analyze_grain_size_distribution(sem_image)

    # çµ±è¨ˆé‡è¨ˆç®—
    grain_sizes = np.array(grain_sizes)
    mean_size = np.mean(grain_sizes)
    std_size = np.std(grain_sizes)
    median_size = np.median(grain_sizes)

    # å¯è¦–åŒ–
    fig, axes = plt.subplots(2, 2, figsize=(12, 12))

    # å·¦ä¸Š: å…ƒç”»åƒ
    ax1 = axes[0, 0]
    ax1.imshow(sem_image, cmap='gray')
    ax1.set_title('Original SEM Image', fontsize=14, fontweight='bold')
    ax1.axis('off')

    # å³ä¸Š: äºŒå€¤åŒ–ç”»åƒ
    ax2 = axes[0, 1]
    ax2.imshow(binary, cmap='gray')
    ax2.set_title('Binary Image (Segmented)', fontsize=14, fontweight='bold')
    ax2.axis('off')

    # å·¦ä¸‹: è¼ªéƒ­æ¤œå‡ºçµæœ
    ax3 = axes[1, 0]
    contour_image = cv2.cvtColor(sem_image, cv2.COLOR_GRAY2BGR)
    cv2.drawContours(contour_image, contours, -1, (255, 0, 0), 2)
    ax3.imshow(contour_image)
    ax3.set_title(f'Detected Grains (n = {len(grain_sizes)})', fontsize=14, fontweight='bold')
    ax3.axis('off')

    # å³ä¸‹: ç²’å¾„åˆ†å¸ƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ 
    ax4 = axes[1, 1]
    ax4.hist(grain_sizes, bins=20, density=True, alpha=0.7, color='skyblue', edgecolor='black')

    # å¯¾æ•°æ­£è¦åˆ†å¸ƒãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
    s, loc, scale = lognorm.fit(grain_sizes, floc=0)
    x = np.linspace(grain_sizes.min(), grain_sizes.max(), 100)
    pdf = lognorm.pdf(x, s, loc, scale)
    ax4.plot(x, pdf, 'r-', linewidth=2, label=f'Lognormal fit\nÎ¼={scale:.1f}, Ïƒ={s:.2f}')

    ax4.axvline(mean_size, color='blue', linestyle='--', linewidth=2, label=f'Mean = {mean_size:.1f} px')
    ax4.axvline(median_size, color='green', linestyle='--', linewidth=2, label=f'Median = {median_size:.1f} px')

    ax4.set_xlabel('Grain Diameter (pixels)', fontsize=12)
    ax4.set_ylabel('Probability Density', fontsize=12)
    ax4.set_title('Grain Size Distribution', fontsize=14, fontweight='bold')
    ax4.legend()
    ax4.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.savefig('grain_size_analysis.png', dpi=300, bbox_inches='tight')
    plt.show()

    # çµ±è¨ˆçµæœå‡ºåŠ›
    print("=== Grain Size Analysis Results ===")
    print(f"Number of grains detected: {len(grain_sizes)}")
    print(f"Mean diameter: {mean_size:.2f} px")
    print(f"Median diameter: {median_size:.2f} px")
    print(f"Standard deviation: {std_size:.2f} px")
    print(f"Size range: {grain_sizes.min():.2f} - {grain_sizes.max():.2f} px")
    print(f"\nD10 = {np.percentile(grain_sizes, 10):.2f} px")
    print(f"D50 = {np.percentile(grain_sizes, 50):.2f} px")
    print(f"D90 = {np.percentile(grain_sizes, 90):.2f} px")

# å®Ÿè¡Œ
plot_grain_analysis_results()
</code></pre>

            <h4>Pythonå®Ÿè£…: SEMç”»åƒã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³é«˜åº¦è§£æ</h4>

            <pre><code class="language-python"># ===================================
# Example 6: SEMç”»åƒã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆWatershedæ³•ï¼‰
# ===================================

import numpy as np
import matplotlib.pyplot as plt
import cv2
from scipy import ndimage

def advanced_watershed_segmentation(image):
    """
    Watershedæ³•ã«ã‚ˆã‚‹é«˜åº¦ãªã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

    Parameters:
    -----------
    image : array
        ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«SEMç”»åƒ

    Returns:
    --------
    labeled_image : array
        ãƒ©ãƒ™ãƒ«ä»˜ãç”»åƒï¼ˆå„ç²’å­ã«å›ºæœ‰IDï¼‰
    n_grains : int
        æ¤œå‡ºç²’å­æ•°
    """
    # å‰å‡¦ç†
    blurred = cv2.GaussianBlur(image, (5, 5), 0)
    _, binary = cv2.threshold(blurred, 0, 255, cv2.THRESH_BINARY_INV + cv2.THRESH_OTSU)

    # ãƒã‚¤ã‚ºé™¤å»
    kernel = np.ones((3, 3), np.uint8)
    opening = cv2.morphologyEx(binary, cv2.MORPH_OPEN, kernel, iterations=2)

    # ç¢ºå®ŸãªèƒŒæ™¯é ˜åŸŸ
    sure_bg = cv2.dilate(opening, kernel, iterations=3)

    # ç¢ºå®Ÿãªå‰æ™¯é ˜åŸŸï¼ˆè·é›¢å¤‰æ›ï¼‰
    dist_transform = cv2.distanceTransform(opening, cv2.DIST_L2, 5)
    _, sure_fg = cv2.threshold(dist_transform, 0.5 * dist_transform.max(), 255, 0)
    sure_fg = np.uint8(sure_fg)

    # ä¸ç¢ºå®šé ˜åŸŸ
    unknown = cv2.subtract(sure_bg, sure_fg)

    # ãƒãƒ¼ã‚«ãƒ¼ä½œæˆ
    _, markers = cv2.connectedComponents(sure_fg)
    markers = markers + 1
    markers[unknown == 255] = 0

    # Watershedé©ç”¨
    image_bgr = cv2.cvtColor(image, cv2.COLOR_GRAY2BGR)
    markers = cv2.watershed(image_bgr, markers)

    # ãƒ©ãƒ™ãƒ«ç”»åƒä½œæˆ
    labeled_image = markers.copy()
    labeled_image[labeled_image == -1] = 0  # å¢ƒç•Œã‚’èƒŒæ™¯ã«
    n_grains = np.max(labeled_image) - 1  # èƒŒæ™¯ãƒ©ãƒ™ãƒ«(1)ã‚’é™¤ã

    return labeled_image, n_grains, dist_transform


def visualize_watershed_results():
    """
    Watershedçµæœã®è©³ç´°å¯è¦–åŒ–
    """
    # åˆæˆç”»åƒç”Ÿæˆ
    sem_image = generate_synthetic_sem_image(size=512, n_particles=80)

    # Watershedè§£æ
    labeled, n_grains, dist_trans = advanced_watershed_segmentation(sem_image)

    # ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—ä½œæˆ
    colored_labels = np.zeros((labeled.shape[0], labeled.shape[1], 3), dtype=np.uint8)
    np.random.seed(42)
    for label in range(2, n_grains + 2):  # ãƒ©ãƒ™ãƒ«2ã‹ã‚‰é–‹å§‹ï¼ˆ0=èƒŒæ™¯, 1=å¢ƒç•Œï¼‰
        mask = labeled == label
        color = np.random.randint(0, 255, 3)
        colored_labels[mask] = color

    # å¯è¦–åŒ–
    fig, axes = plt.subplots(2, 2, figsize=(12, 12))

    # å·¦ä¸Š: å…ƒç”»åƒ
    axes[0, 0].imshow(sem_image, cmap='gray')
    axes[0, 0].set_title('Original SEM Image', fontsize=14, fontweight='bold')
    axes[0, 0].axis('off')

    # å³ä¸Š: è·é›¢å¤‰æ›
    axes[0, 1].imshow(dist_trans, cmap='jet')
    axes[0, 1].set_title('Distance Transform', fontsize=14, fontweight='bold')
    axes[0, 1].axis('off')

    # å·¦ä¸‹: Watershedãƒ©ãƒ™ãƒ«
    axes[1, 0].imshow(labeled, cmap='nipy_spectral')
    axes[1, 0].set_title(f'Watershed Labels (n = {n_grains})', fontsize=14, fontweight='bold')
    axes[1, 0].axis('off')

    # å³ä¸‹: ã‚«ãƒ©ãƒ¼åˆ†é›¢
    axes[1, 1].imshow(colored_labels)
    axes[1, 1].set_title('Segmented Grains (Colored)', fontsize=14, fontweight='bold')
    axes[1, 1].axis('off')

    plt.tight_layout()
    plt.savefig('watershed_segmentation.png', dpi=300, bbox_inches='tight')
    plt.show()

    print(f"=== Watershed Segmentation Results ===")
    print(f"Total grains detected: {n_grains}")
    print(f"Average grain area: {(labeled > 1).sum() / n_grains:.0f} pxÂ²")

# å®Ÿè¡Œ
visualize_watershed_results()
</code></pre>

            <div class="warning-box">
                <strong>ç”»åƒè§£æã®æ³¨æ„ç‚¹</strong>
                <ul>
                    <li>ã‚¹ã‚±ãƒ¼ãƒ«ãƒãƒ¼: ç”»åƒã®ãƒ”ã‚¯ã‚»ãƒ«-å®Ÿå¯¸æ³•å¤‰æ›ãŒå¿…é ˆï¼ˆä¾‹: 100 px = 1 Î¼mï¼‰</li>
                    <li>å¢ƒç•Œç²’å­: ç”»åƒç«¯ã®ä¸å®Œå…¨ç²’å­ã¯çµ±è¨ˆã‹ã‚‰é™¤å¤–</li>
                    <li>é‡ãªã‚Šç²’å­: Watershedæ³•ã§ã‚‚å®Œå…¨åˆ†é›¢ã¯å›°é›£ã€æ‰‹å‹•è£œæ­£ãŒå¿…è¦ãªå ´åˆã‚ã‚Š</li>
                    <li>äºŒå€¤åŒ–é–¾å€¤: å¤§æ´¥ã®æ–¹æ³•ãŒæœ€é©ã¨ã¯é™ã‚‰ãšã€ææ–™ã”ã¨ã«èª¿æ•´</li>
                </ul>
            </div>
        </section>

        <section id="optimization">
            <h2>5.5 ãƒ—ãƒ­ã‚»ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–</h2>

            <h3>5.5.1 æœ€é©åŒ–å•é¡Œã®å®šå¼åŒ–</h3>

            <p>
                ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹è£½é€ ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆç„¼çµæ¡ä»¶ã€çµ„æˆæ¯”ãªã©ï¼‰ã‚’æœ€é©åŒ–ã™ã‚‹å•é¡Œã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®šå¼åŒ–ã•ã‚Œã¾ã™ï¼š
            </p>

            <p>
                \[
                \text{Maximize (or Minimize)} \quad f(\mathbf{x})
                \]
                \[
                \text{subject to} \quad \mathbf{x}_{\text{min}} \leq \mathbf{x} \leq \mathbf{x}_{\text{max}}
                \]
            </p>

            <p>
                ã“ã“ã§ã€\( \mathbf{x} = [T, t, P, \dots] \) ã¯è¨­è¨ˆå¤‰æ•°ï¼ˆæ¸©åº¦ã€æ™‚é–“ã€åœ§åŠ›ãªã©ï¼‰ã€\( f(\mathbf{x}) \) ã¯ç›®çš„é–¢æ•°ï¼ˆå¯†åº¦ã€å¼·åº¦ãªã©ï¼‰ã§ã™ã€‚
            </p>

            <h4>Pythonå®Ÿè£…: scipy.optimizeã«ã‚ˆã‚‹ç„¼çµãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–</h4>

            <pre><code class="language-python"># ===================================
# Example 7: scipy.optimizeç„¼çµãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
# ===================================

import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import minimize, differential_evolution

def sintering_density_model(params):
    """
    ç„¼çµå¯†åº¦ã®ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‡ãƒ«ï¼ˆç°¡ç•¥åŒ–ï¼‰

    Parameters:
    -----------
    params : array
        [T: æ¸©åº¦(Â°C), t: æ™‚é–“(h), P: åœ§åŠ›(MPa)]

    Returns:
    --------
    density : float
        ç›¸å¯¾å¯†åº¦ [%]
    """
    T, t, P = params

    # ç°¡ç•¥åŒ–ã—ãŸArrheniuså‹ãƒ¢ãƒ‡ãƒ«
    # Ï = 100 Ã— (1 - exp(-kÂ·t)), k = AÂ·exp(-Q/(RT))

    Q = 400e3  # æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ [J/mol]
    R = 8.314
    A = 1e10  # å‰æŒ‡æ•°å› å­

    T_K = T + 273.15
    k = A * np.exp(-Q / (R * T_K)) * (P / 10)**0.3  # åœ§åŠ›åŠ¹æœ

    density = 100 * (1 - np.exp(-k * t * 3600))  # tã¯æ™‚é–“[h]â†’[s]

    # ç²’æˆé•·ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼ˆéç„¼çµï¼‰
    grain_growth_penalty = 0
    if T > 1600:
        grain_growth_penalty = 0.1 * (T - 1600)

    return density - grain_growth_penalty


def cost_function(params):
    """
    æœ€é©åŒ–ã®ç›®çš„é–¢æ•°ï¼ˆæœ€å°åŒ–å•é¡Œï¼‰
    å¯†åº¦ã‚’æœ€å¤§åŒ– â†’ ã‚³ã‚¹ãƒˆæœ€å°åŒ–ï¼ˆè² ã®å¯†åº¦ï¼‰
    """
    density = sintering_density_model(params)

    # ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆé …ï¼ˆé«˜æ¸©ãƒ»é•·æ™‚é–“ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼‰
    T, t, P = params
    energy_cost = 0.001 * T * t  # ç°¡ç•¥åŒ–

    # ç·ã‚³ã‚¹ãƒˆ = -å¯†åº¦ + ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ
    total_cost = -density + energy_cost

    return total_cost


def optimize_sintering_process():
    """
    ç„¼çµãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©åŒ–
    """
    # å¤‰æ•°ç¯„å›²
    bounds = [
        (1200, 1700),  # æ¸©åº¦ [Â°C]
        (1, 10),       # æ™‚é–“ [h]
        (0, 50)        # åœ§åŠ› [MPa]
    ]

    # åˆæœŸå€¤
    x0 = [1400, 4, 20]

    print("=== Sintering Process Optimization ===")
    print("Objective: Maximize density while minimizing energy cost")
    print(f"Initial guess: T={x0[0]}Â°C, t={x0[1]}h, P={x0[2]}MPa")

    # æœ€é©åŒ–å®Ÿè¡Œï¼ˆå±€æ‰€æœ€é©åŒ–: L-BFGS-Bï¼‰
    result_local = minimize(cost_function, x0, method='L-BFGS-B', bounds=bounds)

    T_opt_local, t_opt_local, P_opt_local = result_local.x
    density_opt_local = sintering_density_model(result_local.x)

    print("\n--- Local Optimization (L-BFGS-B) ---")
    print(f"Optimal T = {T_opt_local:.1f}Â°C")
    print(f"Optimal t = {t_opt_local:.2f} h")
    print(f"Optimal P = {P_opt_local:.1f} MPa")
    print(f"Achieved density = {density_opt_local:.2f}%")
    print(f"Cost = {result_local.fun:.4f}")

    # å¤§åŸŸçš„æœ€é©åŒ–ï¼ˆDifferential Evolutionï¼‰
    result_global = differential_evolution(cost_function, bounds, seed=42, maxiter=100)

    T_opt_global, t_opt_global, P_opt_global = result_global.x
    density_opt_global = sintering_density_model(result_global.x)

    print("\n--- Global Optimization (Differential Evolution) ---")
    print(f"Optimal T = {T_opt_global:.1f}Â°C")
    print(f"Optimal t = {t_opt_global:.2f} h")
    print(f"Optimal P = {P_opt_global:.1f} MPa")
    print(f"Achieved density = {density_opt_global:.2f}%")
    print(f"Cost = {result_global.fun:.4f}")

    # å¯è¦–åŒ–: æ¸©åº¦-æ™‚é–“ãƒãƒƒãƒ—
    T_range = np.linspace(1200, 1700, 50)
    t_range = np.linspace(1, 10, 50)
    T_grid, t_grid = np.meshgrid(T_range, t_range)

    density_grid = np.zeros_like(T_grid)
    for i in range(len(T_range)):
        for j in range(len(t_range)):
            density_grid[j, i] = sintering_density_model([T_grid[j, i], t_grid[j, i], P_opt_global])

    plt.figure(figsize=(10, 7))
    contour = plt.contourf(T_grid, t_grid, density_grid, levels=20, cmap='RdYlGn')
    plt.colorbar(contour, label='Relative Density (%)')

    plt.scatter(T_opt_global, t_opt_global, s=300, c='red', marker='*', edgecolors='black',
                linewidth=2, zorder=5, label=f'Optimum: {density_opt_global:.1f}%')

    plt.xlabel('Temperature (Â°C)', fontsize=12)
    plt.ylabel('Time (h)', fontsize=12)
    plt.title(f'Sintering Density Map (P = {P_opt_global:.1f} MPa)', fontsize=14, fontweight='bold')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.savefig('sintering_optimization.png', dpi=300, bbox_inches='tight')
    plt.show()

# å®Ÿè¡Œ
optimize_sintering_process()
</code></pre>

            <h4>Pythonå®Ÿè£…: å¤šç›®çš„æœ€é©åŒ–ï¼ˆParetoæœ€é©ï¼‰</h4>

            <pre><code class="language-python"># ===================================
# Example 8: å¤šç›®çš„æœ€é©åŒ–ï¼ˆå¯†åº¦ vs ã‚³ã‚¹ãƒˆï¼‰
# ===================================

import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import differential_evolution

def multi_objective_sintering(params):
    """
    å¤šç›®çš„æœ€é©åŒ–: å¯†åº¦æœ€å¤§åŒ– & ã‚³ã‚¹ãƒˆæœ€å°åŒ–

    Returns:
    --------
    objectives : tuple
        (è² ã®å¯†åº¦, ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ)
    """
    T, t, P = params

    density = sintering_density_model(params)
    energy_cost = 0.01 * T * t + 0.05 * P  # ã‚³ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«

    return -density, energy_cost


def pareto_frontier_analysis():
    """
    Paretoæœ€é©è§£ã®ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢æ¢ç´¢
    """
    # é‡ã¿ä¿‚æ•°ã‚’å¤‰ãˆã¦è¤‡æ•°å›æœ€é©åŒ–
    weights = np.linspace(0, 1, 20)

    pareto_solutions = []

    for w in weights:
        # é‡ã¿ä»˜ãã‚¹ã‚«ãƒ©ãƒ¼åŒ–
        def scalarized_objective(params):
            obj1, obj2 = multi_objective_sintering(params)
            return w * obj1 + (1 - w) * obj2

        bounds = [(1200, 1700), (1, 10), (0, 50)]
        result = differential_evolution(scalarized_objective, bounds, seed=42, maxiter=50)

        T, t, P = result.x
        density = sintering_density_model(result.x)
        _, cost = multi_objective_sintering(result.x)

        pareto_solutions.append({
            'T': T, 't': t, 'P': P,
            'density': density, 'cost': cost
        })

    # Paretoãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢ã®å¯è¦–åŒ–
    densities = [sol['density'] for sol in pareto_solutions]
    costs = [sol['cost'] for sol in pareto_solutions]

    plt.figure(figsize=(10, 6))
    plt.scatter(densities, costs, s=100, c=weights, cmap='viridis', edgecolors='black', linewidth=1.5)
    plt.plot(densities, costs, 'k--', linewidth=1, alpha=0.5)

    # ç‰¹å®šç‚¹ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    idx_max_density = np.argmax(densities)
    idx_min_cost = np.argmin(costs)

    plt.scatter(densities[idx_max_density], costs[idx_max_density], s=300, c='red',
                marker='*', edgecolors='black', linewidth=2, label='Max Density')
    plt.scatter(densities[idx_min_cost], costs[idx_min_cost], s=300, c='blue',
                marker='s', edgecolors='black', linewidth=2, label='Min Cost')

    plt.xlabel('Relative Density (%)', fontsize=12)
    plt.ylabel('Energy Cost (a.u.)', fontsize=12)
    plt.title('Pareto Frontier: Density vs Cost', fontsize=14, fontweight='bold')
    plt.colorbar(plt.cm.ScalarMappable(cmap='viridis'), label='Weight (0=cost, 1=density)')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.savefig('pareto_frontier.png', dpi=300, bbox_inches='tight')
    plt.show()

    print("=== Pareto Frontier Analysis ===")
    print(f"Max Density Solution: {densities[idx_max_density]:.2f}%, Cost={costs[idx_max_density]:.2f}")
    print(f"  â†’ T={pareto_solutions[idx_max_density]['T']:.0f}Â°C, t={pareto_solutions[idx_max_density]['t']:.1f}h")
    print(f"\nMin Cost Solution: {densities[idx_min_cost]:.2f}%, Cost={costs[idx_min_cost]:.2f}")
    print(f"  â†’ T={pareto_solutions[idx_min_cost]['T']:.0f}Â°C, t={pareto_solutions[idx_min_cost]['t']:.1f}h")

# å®Ÿè¡Œ
pareto_frontier_analysis()
</code></pre>

            <div class="info-box">
                <strong>æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®é¸æŠ</strong>
                <ul>
                    <li><strong>å‹¾é…æ³•ï¼ˆL-BFGS-Bï¼‰</strong>: é«˜é€Ÿã€æ»‘ã‚‰ã‹ãªç›®çš„é–¢æ•°ã«æœ‰åŠ¹</li>
                    <li><strong>Differential Evolution</strong>: å¤§åŸŸçš„æœ€é©è§£æ¢ç´¢ã€å¤šå³°æ€§é–¢æ•°</li>
                    <li><strong>ãƒ™ã‚¤ã‚ºæœ€é©åŒ–</strong>: å®Ÿé¨“ã‚³ã‚¹ãƒˆé«˜ã„å ´åˆã€å°‘ãªã„è©•ä¾¡å›æ•°ã§æœ€é©åŒ–</li>
                    <li><strong>éºä¼çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </strong>: é›¢æ•£å¤‰æ•°ã€å¤šç›®çš„æœ€é©åŒ–</li>
                </ul>
            </div>
        </section>

        <section id="integrated">
            <h2>5.6 çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…</h2>

            <h3>5.6.1 çµ±åˆè§£æã‚¯ãƒ©ã‚¹ã®è¨­è¨ˆ</h3>

            <p>
                ã“ã‚Œã¾ã§å­¦ã‚“ã æŠ€è¡“ã‚’çµ±åˆã—ã€å†åˆ©ç”¨å¯èƒ½ãªPythonã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®Ÿè£…ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ–°ã—ã„ç ”ç©¶èª²é¡Œã«è¿…é€Ÿã«é©ç”¨ã§ãã¾ã™ã€‚
            </p>

            <h4>Pythonå®Ÿè£…: CeramicsWorkflowçµ±åˆã‚¯ãƒ©ã‚¹</h4>

            <pre><code class="language-python"># ===================================
# Example 8: çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¯ãƒ©ã‚¹
# ===================================

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestRegressor
from scipy.optimize import differential_evolution

class CeramicsWorkflow:
    """
    ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹ç ”ç©¶ã®çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

    æ©Ÿèƒ½:
    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢ï¼ˆMaterials Project APIï¼‰
    - æ©Ÿæ¢°å­¦ç¿’ç‰¹æ€§äºˆæ¸¬
    - ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
    - çµæœãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    """

    def __init__(self, material_name):
        """
        åˆæœŸåŒ–

        Parameters:
        -----------
        material_name : str
            ææ–™åï¼ˆä¾‹: "BaTiO3"ï¼‰
        """
        self.material_name = material_name
        self.data = {}
        self.ml_model = None
        self.optimization_result = None

        print(f"=== CeramicsWorkflow initialized for {material_name} ===")

    def fetch_database(self, api_key=None):
        """
        Materials Projectã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆãƒ€ãƒŸãƒ¼å®Ÿè£…ï¼‰
        """
        print(f"\n[Step 1] Fetching data for {self.material_name} from Materials Project...")

        # å®Ÿéš›ã«ã¯Materials Project APIã‚’ä½¿ç”¨
        self.data['structure'] = "Perovskite (cubic)"
        self.data['band_gap'] = 1.79  # eV
        self.data['density'] = 6.02   # g/cmÂ³
        self.data['formation_energy'] = -1.68  # eV/atom

        print(f"  Structure: {self.data['structure']}")
        print(f"  Band gap: {self.data['band_gap']} eV")
        print(f"  Density: {self.data['density']} g/cmÂ³")

        return self.data

    def train_ml_model(self, training_data):
        """
        æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®è¨“ç·´

        Parameters:
        -----------
        training_data : DataFrame
            è¨“ç·´ãƒ‡ãƒ¼ã‚¿ï¼ˆç‰¹å¾´é‡ + ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼‰
        """
        print("\n[Step 2] Training machine learning model...")

        X = training_data.drop('permittivity', axis=1)
        y = training_data['permittivity']

        self.ml_model = RandomForestRegressor(n_estimators=100, random_state=42)
        self.ml_model.fit(X, y)

        train_score = self.ml_model.score(X, y)
        print(f"  Model trained: RÂ² = {train_score:.3f}")

        return self.ml_model

    def predict_property(self, input_features):
        """
        ç‰¹æ€§äºˆæ¸¬

        Parameters:
        -----------
        input_features : DataFrame
            äºˆæ¸¬å¯¾è±¡ã®ç‰¹å¾´é‡

        Returns:
        --------
        prediction : float
            äºˆæ¸¬å€¤
        """
        if self.ml_model is None:
            raise ValueError("ML model not trained. Call train_ml_model() first.")

        prediction = self.ml_model.predict(input_features)

        print(f"\n[Step 3] Property prediction:")
        print(f"  Input: {input_features.values[0]}")
        print(f"  Predicted permittivity: {prediction[0]:.0f}")

        return prediction[0]

    def optimize_process(self):
        """
        ãƒ—ãƒ­ã‚»ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–
        """
        print("\n[Step 4] Optimizing sintering process...")

        def objective(params):
            density = sintering_density_model(params)
            T, t, P = params
            cost = 0.001 * T * t
            return -(density - cost)

        bounds = [(1200, 1700), (1, 10), (0, 50)]
        result = differential_evolution(objective, bounds, seed=42, maxiter=50)

        self.optimization_result = {
            'temperature': result.x[0],
            'time': result.x[1],
            'pressure': result.x[2],
            'density': sintering_density_model(result.x)
        }

        print(f"  Optimal T: {self.optimization_result['temperature']:.0f}Â°C")
        print(f"  Optimal t: {self.optimization_result['time']:.1f}h")
        print(f"  Optimal P: {self.optimization_result['pressure']:.0f}MPa")
        print(f"  Achieved density: {self.optimization_result['density']:.1f}%")

        return self.optimization_result

    def generate_report(self):
        """
        çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
        """
        print("\n=== Final Report ===")
        print(f"Material: {self.material_name}")
        print(f"\nDatabase Properties:")
        for key, value in self.data.items():
            print(f"  {key}: {value}")

        if self.optimization_result:
            print(f"\nOptimized Process:")
            print(f"  Temperature: {self.optimization_result['temperature']:.0f}Â°C")
            print(f"  Time: {self.optimization_result['time']:.1f}h")
            print(f"  Pressure: {self.optimization_result['pressure']:.0f}MPa")
            print(f"  Target Density: {self.optimization_result['density']:.1f}%")

        print("\n[Workflow Complete]")


# ä½¿ç”¨ä¾‹
if __name__ == "__main__":
    # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆæœŸåŒ–
    workflow = CeramicsWorkflow("BaTiO3")

    # Step 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢
    workflow.fetch_database()

    # Step 2: æ©Ÿæ¢°å­¦ç¿’ï¼ˆè¨“ç·´ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼‰
    training_data = generate_ceramic_dataset()
    workflow.train_ml_model(training_data)

    # Step 3: æ–°ææ–™ã®ç‰¹æ€§äºˆæ¸¬
    new_composition = pd.DataFrame({
        'ionic_radius_A': [1.35],
        'electronegativity_B': [1.54],
        'oxygen_vacancy': [0.5],
        'sintering_temp': [1400]
    })
    workflow.predict_property(new_composition)

    # Step 4: ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
    workflow.optimize_process()

    # Step 5: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    workflow.generate_report()
</code></pre>

            <div class="info-box">
                <strong>çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ‹¡å¼µæ€§</strong>
                ã“ã®ã‚¯ãƒ©ã‚¹è¨­è¨ˆã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®æ‹¡å¼µãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ï¼š
                <ul>
                    <li>æ–°ã—ã„ææ–™ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆICSD, AFLOWLIBï¼‰ã®è¿½åŠ </li>
                    <li>æ·±å±¤å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆPyTorch, TensorFlowï¼‰ã¸ã®ç½®ãæ›ãˆ</li>
                    <li>å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å–ã‚Šè¾¼ã¿ï¼ˆCSV, Excelèª­ã¿è¾¼ã¿ï¼‰</li>
                    <li>å¯è¦–åŒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆPlotly Dash, Streamlitï¼‰ã®çµ±åˆ</li>
                </ul>
            </div>
        </section>

        <section id="exercises">
            <h2>æ¼”ç¿’å•é¡Œ</h2>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-1: Materials Project APIåŸºæœ¬æ“ä½œ<span class="difficulty easy">æ˜“</span></h4>
                <p>
                    Materials Project APIã‚’ä½¿ç”¨ã—ã¦ã€SrTiOâ‚ƒã®ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã¨å¯†åº¦ã‚’å–å¾—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python"># æ³¨: å®Ÿéš›ã«ã¯APIã‚­ãƒ¼ãŒå¿…è¦
data = get_material_data_from_mp("SrTiO3")
print(f"Band gap: {data['band_gap']} eV")
print(f"Density: {data['density']} g/cmÂ³")
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-2: XRDãƒ”ãƒ¼ã‚¯åŒå®š<span class="difficulty easy">æ˜“</span></h4>
                <p>
                    å®Ÿé¨“XRDã§2Î¸ = 31.5Â°, 45.0Â°ã«ãƒ”ãƒ¼ã‚¯ãŒè¦³æ¸¬ã•ã‚Œã¾ã—ãŸã€‚BaTiOâ‚ƒã®ç†è«–ãƒ”ãƒ¼ã‚¯ä½ç½®ï¼ˆ31.5Â°, 45.0Â°ï¼‰ã¨æ¯”è¼ƒã—ã€æ ¼å­å®šæ•°ã®å¤‰åŒ–ã‚’æ¨å®šã—ãªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">print("å®Ÿé¨“ãƒ”ãƒ¼ã‚¯ä½ç½®ãŒç†è«–å€¤ã¨ä¸€è‡´")
print("â†’ æ ¼å­å®šæ•° a = 4.00 Ã…ï¼ˆæ¨™æº–å€¤ï¼‰")
print("ã‚‚ã—Î”2Î¸ = +0.2Â°ã®ã‚·ãƒ•ãƒˆãŒã‚ã‚Œã°:")
print("  æ ¼å­åç¸® Î”a/a â‰ˆ -0.4%ï¼ˆåœ§ç¸®å¿œåŠ›ï¼‰")
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-3: æ©Ÿæ¢°å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åˆ†å‰²<span class="difficulty easy">æ˜“</span></h4>
                <p>
                    200ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ã€è¨“ç·´:æ¤œè¨¼:ãƒ†ã‚¹ãƒˆ = 70:15:15ã®æ¯”ç‡ã§åˆ†å‰²ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">from sklearn.model_selection import train_test_split

# 70% train, 30% temp
X_train, X_temp, y_train, y_temp = train_test_split(X, y, test_size=0.3, random_state=42)

# 30%ã‚’15%+15%ã«åˆ†å‰²
X_val, X_test, y_val, y_test = train_test_split(X_temp, y_temp, test_size=0.5, random_state=42)

print(f"Train: {len(X_train)}, Val: {len(X_val)}, Test: {len(X_test)}")
# å‡ºåŠ›: Train: 140, Val: 30, Test: 30
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-4: ç²’å¾„åˆ†å¸ƒã®çµ±è¨ˆè§£æ<span class="difficulty medium">ä¸­</span></h4>
                <p>
                    ç²’å¾„ãƒ‡ãƒ¼ã‚¿ [10, 12, 15, 18, 20, 22, 25, 28, 30, 35] Î¼mã‹ã‚‰ã€å¹³å‡ç²’å¾„ã€D50ã€Spanï¼ˆ(D90-D10)/D50ï¼‰ã‚’è¨ˆç®—ã—ãªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">grain_sizes = np.array([10, 12, 15, 18, 20, 22, 25, 28, 30, 35])

mean = np.mean(grain_sizes)
D10 = np.percentile(grain_sizes, 10)
D50 = np.percentile(grain_sizes, 50)
D90 = np.percentile(grain_sizes, 90)
span = (D90 - D10) / D50

print(f"Mean: {mean:.1f} Î¼m")
print(f"D50: {D50:.1f} Î¼m")
print(f"Span: {span:.2f}")
# å‡ºåŠ›ä¾‹: Mean=21.5, D50=21.0, Span=1.10
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-5: ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°<span class="difficulty medium">ä¸­</span></h4>
                <p>
                    ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã®n_estimatorsã¨max_depthã‚’ã‚°ãƒªãƒƒãƒ‰ã‚µãƒ¼ãƒã§æœ€é©åŒ–ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">from sklearn.model_selection import GridSearchCV

param_grid = {
    'n_estimators': [50, 100, 200],
    'max_depth': [5, 10, 15, None]
}

grid_search = GridSearchCV(RandomForestRegressor(random_state=42),
                           param_grid, cv=5, scoring='r2')
grid_search.fit(X_train, y_train)

print(f"Best params: {grid_search.best_params_}")
print(f"Best RÂ²: {grid_search.best_score_:.3f}")
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-6: ç”»åƒã®äºŒå€¤åŒ–é–¾å€¤æ¯”è¼ƒ<span class="difficulty medium">ä¸­</span></h4>
                <p>
                    å¤§æ´¥ã®æ–¹æ³•ã¨å›ºå®šé–¾å€¤ï¼ˆ128ï¼‰ã§äºŒå€¤åŒ–ã—ãŸçµæœã‚’æ¯”è¼ƒã—ã€æ¤œå‡ºç²’å­æ•°ã®é•ã„ã‚’èª¿ã¹ãªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">_, binary_otsu = cv2.threshold(image, 0, 255, cv2.THRESH_BINARY_INV + cv2.THRESH_OTSU)
_, binary_fixed = cv2.threshold(image, 128, 255, cv2.THRESH_BINARY_INV)

contours_otsu, _ = cv2.findContours(binary_otsu, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
contours_fixed, _ = cv2.findContours(binary_fixed, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)

print(f"Otsu: {len(contours_otsu)} particles")
print(f"Fixed: {len(contours_fixed)} particles")
# å¤§æ´¥ã®æ–¹æ³•ã®æ–¹ãŒé©å¿œçš„ã§ç²¾åº¦ãŒé«˜ã„
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-7: åˆ¶ç´„ä»˜ãæœ€é©åŒ–<span class="difficulty medium">ä¸­</span></h4>
                <p>
                    ç„¼çµæ¸©åº¦T â‰¤ 1500Â°Cã€æ™‚é–“t â‰¤ 6hã®åˆ¶ç´„ä¸‹ã§ã€å¯†åº¦ã‚’æœ€å¤§åŒ–ã™ã‚‹æ¡ä»¶ã‚’æ±‚ã‚ãªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">bounds = [(1200, 1500), (1, 6), (0, 50)]  # åˆ¶ç´„ã‚’åæ˜ 
result = differential_evolution(lambda x: -sintering_density_model(x),
                                bounds, seed=42)

print(f"Optimal T: {result.x[0]:.0f}Â°C")
print(f"Optimal t: {result.x[1]:.1f}h")
print(f"Density: {-result.fun:.1f}%")
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-8: äº¤å·®æ¤œè¨¼ã«ã‚ˆã‚‹æ±åŒ–æ€§èƒ½è©•ä¾¡<span class="difficulty hard">é›£</span></h4>
                <p>
                    5-foldäº¤å·®æ¤œè¨¼ã‚’å®Ÿè¡Œã—ã€å„foldã®RMSEã‚’è¨ˆç®—ã—ã¦ãƒ¢ãƒ‡ãƒ«ã®å®‰å®šæ€§ã‚’è©•ä¾¡ã—ãªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">from sklearn.model_selection import cross_val_score

scores = cross_val_score(RandomForestRegressor(n_estimators=100, random_state=42),
                        X, y, cv=5, scoring='neg_root_mean_squared_error')

rmse_scores = -scores  # ç¬¦å·ã‚’åè»¢
print(f"RMSE per fold: {rmse_scores}")
print(f"Mean RMSE: {rmse_scores.mean():.1f} Â± {rmse_scores.std():.1f}")
# æ¨™æº–åå·®ãŒå°ã•ã„ã»ã©å®‰å®š
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-9: Watershedæ³•ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´<span class="difficulty hard">é›£</span></h4>
                <p>
                    è·é›¢å¤‰æ›ã®é–¾å€¤ï¼ˆ0.3, 0.5, 0.7ï¼‰ã‚’å¤‰ãˆã¦ã€æ¤œå‡ºç²’å­æ•°ãŒã©ã†å¤‰ã‚ã‚‹ã‹èª¿ã¹ãªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">thresholds = [0.3, 0.5, 0.7]
for thresh in thresholds:
    _, sure_fg = cv2.threshold(dist_transform, thresh * dist_transform.max(), 255, 0)
    contours, _ = cv2.findContours(sure_fg.astype(np.uint8), cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
    print(f"Threshold {thresh}: {len(contours)} grains")

# é–¾å€¤ãŒé«˜ã„ã»ã©æ¤œå‡ºç²’å­æ•°æ¸›å°‘ï¼ˆéã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å›é¿ï¼‰
</code></pre>
                </details>
            </div>

            <div class="exercise-box">
                <h4>æ¼”ç¿’ 5-10: çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ‹¡å¼µ<span class="difficulty hard">é›£</span></h4>
                <p>
                    CeramicsWorkflowã‚¯ãƒ©ã‚¹ã«ã€å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ï¼ˆCSVï¼‰ã‚’èª­ã¿è¾¼ã¿ã€æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’è¨“ç·´ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ãªã•ã„ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ä¾‹</summary>
                    <pre><code class="language-python">class CeramicsWorkflow:
    # ... æ—¢å­˜ã®ãƒ¡ã‚½ãƒƒãƒ‰ ...

    def load_experimental_data(self, csv_path):
        """
        å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿

        Parameters:
        -----------
        csv_path : str
            CSVãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
        """
        print(f"\n[Data Loading] Reading {csv_path}...")
        self.experimental_data = pd.read_csv(csv_path)
        print(f"  Loaded {len(self.experimental_data)} samples")
        print(f"  Columns: {list(self.experimental_data.columns)}")
        return self.experimental_data

# ä½¿ç”¨ä¾‹
workflow = CeramicsWorkflow("Al2O3")
workflow.load_experimental_data("sintering_data.csv")
workflow.train_ml_model(workflow.experimental_data)
</code></pre>
                </details>
            </div>
        </section>

        <section id="references">
            <h2>å‚è€ƒæ–‡çŒ®</h2>
            <ol>
                <li>Jain, A., et al. (2013). Commentary: The Materials Project: A materials genome approach to accelerating materials innovation. <em>APL Materials</em>, 1(1), 011002.</li>
                <li>Ong, S.P., et al. (2013). Python Materials Genomics (pymatgen): A robust, open-source python library for materials analysis. <em>Computational Materials Science</em>, 68, 314-319.</li>
                <li>Pedregosa, F., et al. (2011). Scikit-learn: Machine Learning in Python. <em>Journal of Machine Learning Research</em>, 12, 2825-2830.</li>
                <li>Bradski, G. (2000). The OpenCV Library. <em>Dr. Dobb's Journal of Software Tools</em>.</li>
                <li>Virtanen, P., et al. (2020). SciPy 1.0: Fundamental algorithms for scientific computing in Python. <em>Nature Methods</em>, 17, 261-272.</li>
                <li>Ward, L., et al. (2018). Matminer: An open source toolkit for materials data mining. <em>Computational Materials Science</em>, 152, 60-69.</li>
            </ol>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 MS Dojo - Materials Science Education</p>
        <p><a href="index.html">ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹ææ–™å…¥é–€ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a> | <a href="../../MS/">MSåˆ†é‡ãƒˆãƒƒãƒ—</a></p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'base' });
    </script>
</body>
</html>
