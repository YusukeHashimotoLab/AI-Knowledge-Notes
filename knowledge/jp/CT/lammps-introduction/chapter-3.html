<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LAMMPSã«ã‚ˆã‚‹å¹³è¡¡åˆ†å­å‹•åŠ›å­¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨è¼¸é€ç‰¹æ€§ã®è¨ˆç®—æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚Green-Kuboå¼ã€Einsteiné–¢ä¿‚å¼ã€è‡ªå·±ç›¸é–¢é–¢æ•°ã€çµ±è¨ˆèª¤å·®è©•ä¾¡ãªã©">
    <title>Chapter 3: å¹³è¡¡MDã¨è¼¸é€ç‰¹æ€§ | LAMMPSå…¥é–€ - CT Dojo</title>
    <link rel="stylesheet" href="../../../../assets/css/variables.css">
    <link rel="stylesheet" href="../../../../assets/css/article.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <style>
        :root {
            --ct-gradient-start: #11998e;
            --ct-gradient-end: #38ef7d;
        }

        .hero-section {
            background: linear-gradient(135deg, var(--ct-gradient-start) 0%, var(--ct-gradient-end) 100%);
            color: white;
            padding: 3rem 1.5rem;
            margin: -2rem -1.5rem 2rem -1.5rem;
            border-radius: 0 0 1rem 1rem;
        }

        .concept-card {
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.05) 0%, rgba(56, 239, 125, 0.05) 100%);
            border-left: 4px solid var(--ct-gradient-start);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0.5rem;
        }

        .formula-box {
            background: #f8f9fa;
            border: 2px solid var(--ct-gradient-start);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0.5rem;
            overflow-x: auto;
        }

        .method-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .method-card {
            background: white;
            border: 2px solid var(--ct-gradient-start);
            padding: 1.5rem;
            border-radius: 0.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .method-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(17, 153, 142, 0.2);
        }

        .code-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.25rem;
        }

        .tip-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-section">
                <a href="../../../../index.html" class="logo">CT Dojo</a>
                <p class="logo-subtitle">è¨ˆç®—åŒ–å­¦æŠ€è¡“ã®å®Ÿè·µçŸ¥è­˜</p>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="../../../index.html">ãƒ›ãƒ¼ãƒ </a></li>
                    <li><a href="index.html" class="active">LAMMPSå…¥é–€</a></li>
                    <li><a href="../../index.html">CTåˆ†é‡ä¸€è¦§</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <article>
            <div class="hero-section">
                <h1>Chapter 3: å¹³è¡¡MDã¨è¼¸é€ç‰¹æ€§</h1>
                <p class="lead">Green-Kuboé–¢ä¿‚å¼ã¨Einsteiné–¢ä¿‚å¼ã«ã‚ˆã‚‹è¼¸é€ä¿‚æ•°ã®è¨ˆç®—æ‰‹æ³•</p>
            </div>

            <section id="introduction">
                <h2>3.1 å¹³è¡¡MDã¨ã¯</h2>
                <p>
                    å¹³è¡¡åˆ†å­å‹•åŠ›å­¦ï¼ˆEquilibrium Molecular Dynamics, EMDï¼‰ã¯ã€æ¸©åº¦ã‚„åœ§åŠ›ãŒä¸€å®šã«ä¿ãŸã‚ŒãŸç†±å¹³è¡¡çŠ¶æ…‹ã§ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚
                    ã“ã®ç« ã§ã¯ã€å¹³è¡¡MDã‹ã‚‰æ‹¡æ•£ä¿‚æ•°ã€ç²˜æ€§ä¿‚æ•°ã€ç†±ä¼å°ç‡ãªã©ã®<strong>è¼¸é€ç‰¹æ€§ï¼ˆTransport Propertiesï¼‰</strong>ã‚’è¨ˆç®—ã™ã‚‹æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚
                </p>

                <div class="concept-card">
                    <h3>è¼¸é€ç‰¹æ€§ã¨ã¯</h3>
                    <p>è¼¸é€ç‰¹æ€§ã¯ã€ç³»å†…ã§ã®ç‰©è³ªã€é‹å‹•é‡ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ç§»å‹•ã‚’è¡¨ã™ç‰©ç†é‡ã§ã™ï¼š</p>
                    <ul>
                        <li><strong>æ‹¡æ•£ä¿‚æ•° (D)</strong>: ç‰©è³ªã®æ‹¡æ•£é€Ÿåº¦ã‚’è¡¨ã™ï¼ˆå˜ä½: mÂ²/sï¼‰</li>
                        <li><strong>ç²˜æ€§ä¿‚æ•° (Î·)</strong>: æµä½“ã®ç²˜ã‚Šæ°—ã‚’è¡¨ã™ï¼ˆå˜ä½: PaÂ·sï¼‰</li>
                        <li><strong>ç†±ä¼å°ç‡ (Îº)</strong>: ç†±ã®ä¼ã‚ã‚Šã‚„ã™ã•ã‚’è¡¨ã™ï¼ˆå˜ä½: W/(mÂ·K)ï¼‰</li>
                    </ul>
                    <p>ã“ã‚Œã‚‰ã¯å®Ÿé¨“æ¸¬å®šãŒå›°é›£ãªæ¡ä»¶ï¼ˆé«˜æ¸©é«˜åœ§ãªã©ï¼‰ã§ã‚‚è¨ˆç®—å¯èƒ½ã§ã™ã€‚</p>
                </div>

                <h3>è¼¸é€ç‰¹æ€§è¨ˆç®—ã®2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</h3>
                <div class="method-comparison">
                    <div class="method-card">
                        <h4>Green-Kuboæ³•</h4>
                        <p><strong>åŸç†</strong>: ç†±å¹³è¡¡çŠ¶æ…‹ã§ã®è‡ªç™ºçš„ãªã‚†ã‚‰ãï¼ˆfluxï¼‰ã®è‡ªå·±ç›¸é–¢é–¢æ•°ã‚’æ™‚é–“ç©åˆ†</p>
                        <p><strong>åˆ©ç‚¹</strong>: 1å›ã®EMDã§è¤‡æ•°ã®è¼¸é€ä¿‚æ•°ã‚’è¨ˆç®—å¯èƒ½</p>
                        <p><strong>æ¬ ç‚¹</strong>: é•·æ™‚é–“ç›¸é–¢ã®æ­£ç¢ºãªè¨ˆç®—ãŒå¿…è¦ã€çµ±è¨ˆèª¤å·®ãŒå¤§ãã„</p>
                    </div>
                    <div class="method-card">
                        <h4>Einsteiné–¢ä¿‚å¼</h4>
                        <p><strong>åŸç†</strong>: ç²’å­ã®å¹³å‡äºŒä¹—å¤‰ä½ï¼ˆMSDï¼‰ã®æ™‚é–“ç™ºå±•</p>
                        <p><strong>åˆ©ç‚¹</strong>: æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—ãŒç›´æ„Ÿçš„ã€çµ±è¨ˆèª¤å·®ãŒå°ã•ã„</p>
                        <p><strong>æ¬ ç‚¹</strong>: æ‹¡æ•£ä¿‚æ•°ã®ã¿ã«é©ç”¨ã€ç²˜æ€§ãƒ»ç†±ä¼å°ã«ã¯ä¸å‘ã</p>
                    </div>
                </div>

                <div class="mermaid">
                flowchart TD
                    A[å¹³è¡¡MDå®Ÿè¡Œ] --> B{è¨ˆç®—å¯¾è±¡}
                    B -->|æ‹¡æ•£ä¿‚æ•°| C[Einsteiné–¢ä¿‚å¼<br/>MSDè§£æ]
                    B -->|ç²˜æ€§ä¿‚æ•°| D[Green-Kuboæ³•<br/>å¿œåŠ›ãƒ†ãƒ³ã‚½ãƒ«è‡ªå·±ç›¸é–¢]
                    B -->|ç†±ä¼å°ç‡| E[Green-Kuboæ³•<br/>ç†±æµæŸè‡ªå·±ç›¸é–¢]
                    C --> F[ç·šå½¢å›å¸°ã§Dç®—å‡º]
                    D --> G[æ™‚é–“ç©åˆ†ã§Î·ç®—å‡º]
                    E --> H[æ™‚é–“ç©åˆ†ã§Îºç®—å‡º]
                    F --> I[çµ±è¨ˆèª¤å·®è©•ä¾¡]
                    G --> I
                    H --> I
                </div>
            </section>

            <section id="green-kubo">
                <h2>3.2 Green-Kuboé–¢ä¿‚å¼</h2>
                <p>
                    Green-Kuboé–¢ä¿‚å¼ã¯ã€<strong>ç·šå½¢å¿œç­”ç†è«–</strong>ã«åŸºã¥ãã€ç†±å¹³è¡¡çŠ¶æ…‹ã§ã®è‡ªç™ºçš„ãªã‚†ã‚‰ãã‹ã‚‰è¼¸é€ä¿‚æ•°ã‚’è¨ˆç®—ã™ã‚‹ç†è«–ã§ã™ã€‚
                    ä¸€èˆ¬å½¢ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š
                </p>

                <div class="formula-box">
                    <h4>Green-Kuboé–¢ä¿‚å¼ã®ä¸€èˆ¬å½¢</h4>
                    \[
                    L = \frac{V}{k_B T^2} \int_0^\infty \langle \mathbf{J}(0) \cdot \mathbf{J}(t) \rangle \, dt
                    \]
                    <p><strong>è¨˜å·èª¬æ˜</strong>:</p>
                    <ul>
                        <li>\(L\): è¼¸é€ä¿‚æ•°ï¼ˆæ‹¡æ•£ä¿‚æ•°ã€ç²˜æ€§ä¿‚æ•°ã€ç†±ä¼å°ç‡ãªã©ï¼‰</li>
                        <li>\(V\): ç³»ã®ä½“ç©</li>
                        <li>\(k_B\): ãƒœãƒ«ãƒ„ãƒãƒ³å®šæ•° (1.380649Ã—10â»Â²Â³ J/K)</li>
                        <li>\(T\): çµ¶å¯¾æ¸©åº¦</li>
                        <li>\(\mathbf{J}(t)\): æ™‚åˆ»\(t\)ã§ã®æµæŸï¼ˆfluxï¼‰ãƒ™ã‚¯ãƒˆãƒ«</li>
                        <li>\(\langle \cdot \rangle\): ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å¹³å‡ï¼ˆæ™‚é–“å¹³å‡ã§è¿‘ä¼¼ï¼‰</li>
                    </ul>
                </div>

                <h3>3.2.1 æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—</h3>
                <p>æ‹¡æ•£ä¿‚æ•°\(D\)ã¯ã€é€Ÿåº¦ã®è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆVelocity Auto-Correlation Function, VACFï¼‰ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ï¼š</p>

                <div class="formula-box">
                    \[
                    D = \frac{1}{3} \int_0^\infty \langle \mathbf{v}(0) \cdot \mathbf{v}(t) \rangle \, dt
                    \]
                    <p>ã“ã“ã§ã€\(\mathbf{v}(t)\)ã¯ç²’å­ã®é€Ÿåº¦ãƒ™ã‚¯ãƒˆãƒ«ã§ã™ã€‚ä¿‚æ•°1/3ã¯3æ¬¡å…ƒã§ã®å¹³å‡ã‚’å–ã‚‹ãŸã‚ã§ã™ã€‚</p>
                </div>

                <div class="concept-card">
                    <h4>é€Ÿåº¦è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆVACFï¼‰ã®ç‰©ç†çš„æ„å‘³</h4>
                    <p>
                        VACF \(\langle \mathbf{v}(0) \cdot \mathbf{v}(t) \rangle\) ã¯ã€æ™‚åˆ»0ã§ã®é€Ÿåº¦ã¨æ™‚åˆ»\(t\)ã§ã®é€Ÿåº¦ã®ç›¸é–¢ã‚’è¡¨ã—ã¾ã™ã€‚
                    </p>
                    <ul>
                        <li>\(t=0\): å®Œå…¨ã«ç›¸é–¢ï¼ˆVACF = \(\langle v^2 \rangle\)ï¼‰</li>
                        <li>\(t \to \infty\): ç›¸é–¢ãŒå¤±ã‚ã‚Œã‚‹ï¼ˆVACF â†’ 0ï¼‰</li>
                        <li>ç›¸é–¢ãŒé€Ÿãæ¸›è¡°ã™ã‚‹ã»ã©ã€æ‹¡æ•£ãŒé€Ÿã„</li>
                    </ul>
                </div>

                <h3>3.2.2 ç²˜æ€§ä¿‚æ•°ã®è¨ˆç®—</h3>
                <p>ã›ã‚“æ–­ç²˜æ€§ä¿‚æ•°\(\eta\)ã¯ã€å¿œåŠ›ãƒ†ãƒ³ã‚½ãƒ«\(\sigma_{xy}\)ã®è‡ªå·±ç›¸é–¢é–¢æ•°ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ï¼š</p>

                <div class="formula-box">
                    \[
                    \eta = \frac{V}{k_B T} \int_0^\infty \langle \sigma_{xy}(0) \sigma_{xy}(t) \rangle \, dt
                    \]
                    <p>ã“ã“ã§ã€\(\sigma_{xy}\)ã¯ã›ã‚“æ–­å¿œåŠ›æˆåˆ†ã§ã™ã€‚LAMMPSã§ã¯<code>compute stress/atom</code>ã§è¨ˆç®—ã§ãã¾ã™ã€‚</p>
                </div>

                <h3>3.2.3 ç†±ä¼å°ç‡ã®è¨ˆç®—</h3>
                <p>ç†±ä¼å°ç‡\(\kappa\)ã¯ã€ç†±æµæŸ\(\mathbf{J}_Q\)ã®è‡ªå·±ç›¸é–¢é–¢æ•°ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ï¼š</p>

                <div class="formula-box">
                    \[
                    \kappa = \frac{V}{k_B T^2} \int_0^\infty \langle \mathbf{J}_Q(0) \cdot \mathbf{J}_Q(t) \rangle \, dt
                    \]
                    <p>ç†±æµæŸ\(\mathbf{J}_Q\)ã¯ã€LAMMPSã®<code>compute heat/flux</code>ã§è¨ˆç®—ã§ãã¾ã™ï¼š</p>
                    \[
                    \mathbf{J}_Q = \sum_i e_i \mathbf{v}_i - \sum_i \mathbf{S}_i \mathbf{v}_i
                    \]
                    <p>\(e_i\): ç²’å­\(i\)ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€\(\mathbf{S}_i\): å¿œåŠ›ãƒ†ãƒ³ã‚½ãƒ«ã€\(\mathbf{v}_i\): é€Ÿåº¦</p>
                </div>

                <div class="warning-box">
                    <strong>âš ï¸ æ³¨æ„</strong>: Green-Kuboæ³•ã§ã¯ã€è‡ªå·±ç›¸é–¢é–¢æ•°ãŒååˆ†ã«æ¸›è¡°ã™ã‚‹ã¾ã§ï¼ˆé€šå¸¸æ•°psï½æ•°åpsï¼‰ã®é•·æ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã™ã€‚
                    çŸ­æ™‚é–“ã§ã¯ç©åˆ†å€¤ãŒåæŸã›ãšã€èª¤ã£ãŸè¼¸é€ä¿‚æ•°ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚
                </div>
            </section>

            <section id="einstein-relation">
                <h2>3.3 Einsteiné–¢ä¿‚å¼</h2>
                <p>
                    Einsteiné–¢ä¿‚å¼ã¯ã€<strong>å¹³å‡äºŒä¹—å¤‰ä½ï¼ˆMean Square Displacement, MSDï¼‰</strong>ã®æ™‚é–“ç™ºå±•ã‹ã‚‰æ‹¡æ•£ä¿‚æ•°ã‚’è¨ˆç®—ã™ã‚‹æ–¹æ³•ã§ã™ã€‚
                    Green-Kuboæ³•ã‚ˆã‚Šè¨ˆç®—ãŒå®‰å®šã—ã¦ãŠã‚Šã€æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—ã§ã¯åºƒãä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚
                </p>

                <div class="formula-box">
                    <h4>Einsteiné–¢ä¿‚å¼</h4>
                    \[
                    D = \lim_{t \to \infty} \frac{1}{6t} \langle |\mathbf{r}(t) - \mathbf{r}(0)|^2 \rangle
                    \]
                    <p><strong>è¨˜å·èª¬æ˜</strong>:</p>
                    <ul>
                        <li>\(\mathbf{r}(t)\): æ™‚åˆ»\(t\)ã§ã®ç²’å­ã®ä½ç½®ãƒ™ã‚¯ãƒˆãƒ«</li>
                        <li>\(|\mathbf{r}(t) - \mathbf{r}(0)|^2\): å¹³å‡äºŒä¹—å¤‰ä½ï¼ˆMSDï¼‰</li>
                        <li>ä¿‚æ•°1/6ã¯3æ¬¡å…ƒã§ã®å¹³å‡ï¼ˆ1æ¬¡å…ƒãªã‚‰1/2ã€2æ¬¡å…ƒãªã‚‰1/4ï¼‰</li>
                    </ul>
                </div>

                <h3>3.3.1 MSDã®æ™‚é–“ç™ºå±•</h3>
                <p>MSDã¯ã€æ™‚é–“ãŒçµŒéã™ã‚‹ã«ã¤ã‚Œã¦ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰åŒ–ã—ã¾ã™ï¼š</p>

                <div class="concept-card">
                    <h4>MSDã®æ™‚é–“ä¾å­˜æ€§</h4>
                    <ul>
                        <li><strong>Ballisticé ˜åŸŸï¼ˆ\(t \ll \tau\)ï¼‰</strong>: \(\text{MSD} \propto t^2\)ï¼ˆç²’å­ãŒç›´é€²ï¼‰</li>
                        <li><strong>æ‹¡æ•£é ˜åŸŸï¼ˆ\(t \gg \tau\)ï¼‰</strong>: \(\text{MSD} \propto t\)ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ï¼‰</li>
                    </ul>
                    <p>\(\tau\)ã¯é€Ÿåº¦ç·©å’Œæ™‚é–“ï¼ˆç²’å­ãŒä»–ç²’å­ã¨è¡çªã™ã‚‹ã¾ã§ã®æ™‚é–“ï¼‰ã§ã™ã€‚</p>
                    <p><strong>æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—æ‰‹é †</strong>:</p>
                    <ol>
                        <li>MSD vs æ™‚é–“ã®ã‚°ãƒ©ãƒ•ã‚’ãƒ—ãƒ­ãƒƒãƒˆ</li>
                        <li>æ‹¡æ•£é ˜åŸŸï¼ˆç·šå½¢éƒ¨åˆ†ï¼‰ã‚’ç‰¹å®š</li>
                        <li>ç·šå½¢å›å¸°ã§å‚¾ãã‚’æ±‚ã‚ã‚‹: \(D = \text{slope} / 6\)</li>
                    </ol>
                </div>

                <div class="tip-box">
                    <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</strong>: æ‹¡æ•£é ˜åŸŸã¯é€šå¸¸ã€å…¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã®ä¸­é–“50-80%ã®ç¯„å›²ã§ã™ã€‚
                    æœ€åˆã®10-20%ï¼ˆBallisticé ˜åŸŸï¼‰ã¨æœ€å¾Œã®éƒ¨åˆ†ï¼ˆçµ±è¨ˆãŒæ‚ªã„ï¼‰ã¯é™¤å¤–ã—ã¾ã™ã€‚
                </div>

                <h3>3.3.2 LAMMPSã§ã®MSDè¨ˆç®—</h3>
                <p>LAMMPSã§ã¯<code>compute msd</code>ã‚’ä½¿ã£ã¦è‡ªå‹•ã§MSDã‚’è¨ˆç®—ã§ãã¾ã™ï¼š</p>

                <pre><code class="language-bash"># MSDè¨ˆç®—ã®è¨­å®š
compute         mymsd all msd com yes
fix             msd_output all ave/time 10 1 10 c_mymsd[*] file msd.dat

# com yes: ç³»å…¨ä½“ã®é‡å¿ƒé‹å‹•ã‚’é™¤å»ï¼ˆå¿…é ˆï¼‰
# ave/time: 10 timestep Ã— 1å› Ã— 10å› = 100 timestepã”ã¨ã«å‡ºåŠ›</code></pre>

                <p>å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«<code>msd.dat</code>ã®å½¢å¼ï¼š</p>
                <pre><code class="language-bash"># Timestep MSD_x MSD_y MSD_z MSD_total
100 0.125 0.132 0.128 0.385
200 0.501 0.487 0.512 1.500
300 1.123 1.098 1.135 3.356
...</code></pre>
            </section>

            <section id="autocorrelation">
                <h2>3.4 è‡ªå·±ç›¸é–¢é–¢æ•°ã®è¨ˆç®—</h2>
                <p>
                    è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆAuto-Correlation Function, ACFï¼‰ã¯ã€ã‚ã‚‹ç‰©ç†é‡ãŒæ™‚é–“çš„ã«ã©ã®ç¨‹åº¦ç›¸é–¢ã—ã¦ã„ã‚‹ã‹ã‚’è¡¨ã™é–¢æ•°ã§ã™ã€‚
                    Green-Kuboæ³•ã®æ ¸å¿ƒéƒ¨åˆ†ã§ã™ã€‚
                </p>

                <div class="formula-box">
                    <h4>è‡ªå·±ç›¸é–¢é–¢æ•°ã®å®šç¾©</h4>
                    \[
                    C_{AA}(t) = \langle A(0) A(t) \rangle = \frac{1}{T-t} \int_0^{T-t} A(\tau) A(\tau + t) \, d\tau
                    \]
                    <p>\(A(t)\): æ™‚åˆ»\(t\)ã§ã®ç‰©ç†é‡ï¼ˆé€Ÿåº¦ã€å¿œåŠ›ã€ç†±æµæŸãªã©ï¼‰</p>
                    <p>\(T\): å…¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“</p>
                </div>

                <h3>3.4.1 é€Ÿåº¦è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆVACFï¼‰</h3>
                <p>VACFã¯æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—ã«ä½¿ã‚ã‚Œã¾ã™ï¼š</p>

                <div class="formula-box">
                    \[
                    C_{vv}(t) = \langle \mathbf{v}(0) \cdot \mathbf{v}(t) \rangle = \frac{1}{N} \sum_{i=1}^N \langle \mathbf{v}_i(0) \cdot \mathbf{v}_i(t) \rangle
                    \]
                    <p>\(N\): ç²’å­æ•°ã€\(\mathbf{v}_i(t)\): ç²’å­\(i\)ã®é€Ÿåº¦ãƒ™ã‚¯ãƒˆãƒ«</p>
                </div>

                <p><strong>VACFã®ç‰¹å¾´</strong>:</p>
                <ul>
                    <li>\(t=0\): æœ€å¤§å€¤ï¼ˆ\(\langle v^2 \rangle = 3k_B T / m\)ã€é€Ÿåº¦ã®äºŒä¹—å¹³å‡ï¼‰</li>
                    <li>\(t > 0\): æŒ‡æ•°é–¢æ•°çš„ã«æ¸›è¡°</li>
                    <li>æ¶²ä½“: è² ã®ãƒ‡ã‚£ãƒƒãƒ—ãŒç¾ã‚Œã‚‹ï¼ˆã‚±ãƒ¼ã‚¸åŠ¹æœï¼šç²’å­ãŒéš£æ¥ç²’å­ã«é–‰ã˜è¾¼ã‚ã‚‰ã‚Œã‚‹ï¼‰</li>
                    <li>æ°—ä½“: å˜èª¿æ¸›è¡°ï¼ˆç²’å­é–“ç›¸äº’ä½œç”¨ãŒå¼±ã„ï¼‰</li>
                </ul>

                <h3>3.4.2 ç†±æµæŸè‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆHFACFï¼‰</h3>
                <p>ç†±ä¼å°ç‡ã®è¨ˆç®—ã«ä½¿ã‚ã‚Œã¾ã™ï¼š</p>

                <div class="formula-box">
                    \[
                    C_{JJ}(t) = \langle \mathbf{J}_Q(0) \cdot \mathbf{J}_Q(t) \rangle
                    \]
                    <p>LAMMPSã§ã¯<code>compute heat/flux</code>ã§ç†±æµæŸã‚’è¨ˆç®—ã—ã€è‡ªå·±ç›¸é–¢ã‚’å–ã‚Šã¾ã™ã€‚</p>
                </div>

                <h3>3.4.3 å¿œåŠ›ãƒ†ãƒ³ã‚½ãƒ«è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆSACFï¼‰</h3>
                <p>ç²˜æ€§ä¿‚æ•°ã®è¨ˆç®—ã«ä½¿ã‚ã‚Œã¾ã™ï¼š</p>

                <div class="formula-box">
                    \[
                    C_{\sigma\sigma}(t) = \langle \sigma_{xy}(0) \sigma_{xy}(t) \rangle
                    \]
                    <p>ã›ã‚“æ–­ç²˜æ€§ã®å ´åˆã€\(\sigma_{xy}\)æˆåˆ†ã‚’ä½¿ã„ã¾ã™ï¼ˆ\(\sigma_{xz}, \sigma_{yz}\)ã‚‚åŒæ§˜ï¼‰ã€‚</p>
                </div>

                <div class="warning-box">
                    <strong>âš ï¸ è¨ˆç®—ä¸Šã®æ³¨æ„</strong>:
                    <ul>
                        <li>è‡ªå·±ç›¸é–¢é–¢æ•°ã¯æœ€å¤§ãƒ©ã‚°æ™‚é–“ï¼ˆé€šå¸¸ã€å…¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã®10-20%ï¼‰ã¾ã§è¨ˆç®—</li>
                        <li>ãƒ©ã‚°æ™‚é–“ãŒé•·ã™ãã‚‹ã¨çµ±è¨ˆèª¤å·®ãŒå¢—å¤§</li>
                        <li>è¤‡æ•°ã®ç‹¬ç«‹ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç•°ãªã‚‹åˆæœŸé€Ÿåº¦ï¼‰ã§å¹³å‡ã‚’å–ã‚‹</li>
                    </ul>
                </div>
            </section>

            <section id="statistical-error">
                <h2>3.5 çµ±è¨ˆèª¤å·®ã®è©•ä¾¡</h2>
                <p>
                    MDã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹è¼¸é€ä¿‚æ•°ã«ã¯çµ±è¨ˆèª¤å·®ãŒå«ã¾ã‚Œã¾ã™ã€‚
                    ä¿¡é ¼ã§ãã‚‹çµæœã‚’å¾—ã‚‹ãŸã‚ã«ã¯ã€èª¤å·®è©•ä¾¡ãŒä¸å¯æ¬ ã§ã™ã€‚
                </p>

                <h3>3.5.1 ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ï¼ˆBlock Averagingï¼‰</h3>
                <p>
                    ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã¯ã€æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ã®ãƒ–ãƒ­ãƒƒã‚¯ã«åˆ†å‰²ã—ã€å„ãƒ–ãƒ­ãƒƒã‚¯ã®å¹³å‡ã‚’ç‹¬ç«‹ãªã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦æ‰±ã†æ–¹æ³•ã§ã™ã€‚
                </p>

                <div class="concept-card">
                    <h4>ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã®æ‰‹é †</h4>
                    <ol>
                        <li>å…¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆé•·ã•\(N\)ï¼‰ã‚’\(M\)å€‹ã®ãƒ–ãƒ­ãƒƒã‚¯ã«åˆ†å‰²ï¼ˆå„ãƒ–ãƒ­ãƒƒã‚¯é•·ã•\(n = N/M\)ï¼‰</li>
                        <li>å„ãƒ–ãƒ­ãƒƒã‚¯\(k\)ã®å¹³å‡ã‚’è¨ˆç®—: \(\bar{A}_k = \frac{1}{n} \sum_{i=(k-1)n+1}^{kn} A_i\)</li>
                        <li>ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡ã®å¹³å‡ã‚’è¨ˆç®—: \(\bar{A} = \frac{1}{M} \sum_{k=1}^M \bar{A}_k\)</li>
                        <li>æ¨™æº–åå·®ã‚’è¨ˆç®—: \(\sigma = \sqrt{\frac{1}{M-1} \sum_{k=1}^M (\bar{A}_k - \bar{A})^2}\)</li>
                        <li>æ¨™æº–èª¤å·®ã‚’è¨ˆç®—: \(SE = \frac{\sigma}{\sqrt{M}}\)</li>
                    </ol>
                </div>

                <div class="tip-box">
                    <strong>ğŸ’¡ ãƒ–ãƒ­ãƒƒã‚¯æ•°ã®é¸ã³æ–¹</strong>:
                    <ul>
                        <li>ãƒ–ãƒ­ãƒƒã‚¯æ•°ãŒå¤šã™ãã‚‹ï¼ˆå„ãƒ–ãƒ­ãƒƒã‚¯ãŒçŸ­ã™ãã‚‹ï¼‰: ãƒ–ãƒ­ãƒƒã‚¯é–“ã®ç›¸é–¢ãŒæ®‹ã‚Šã€èª¤å·®ã‚’éå°è©•ä¾¡</li>
                        <li>ãƒ–ãƒ­ãƒƒã‚¯æ•°ãŒå°‘ãªã™ãã‚‹ï¼ˆå„ãƒ–ãƒ­ãƒƒã‚¯ãŒé•·ã™ãã‚‹ï¼‰: çµ±è¨ˆã‚µãƒ³ãƒ—ãƒ«æ•°ãŒæ¸›ã‚Šã€ä¿¡é ¼æ€§ãŒä½ä¸‹</li>
                        <li>æ¨å¥¨: 5-10ãƒ–ãƒ­ãƒƒã‚¯ã€å„ãƒ–ãƒ­ãƒƒã‚¯ã¯ç›¸é–¢æ™‚é–“ã®10å€ä»¥ä¸Š</li>
                    </ul>
                </div>

                <h3>3.5.2 ç›¸é–¢æ™‚é–“ã®æ¨å®š</h3>
                <p>ç›¸é–¢æ™‚é–“\(\tau_c\)ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®ç‹¬ç«‹æ€§ã‚’è©•ä¾¡ã™ã‚‹é‡è¦ãªæŒ‡æ¨™ã§ã™ï¼š</p>

                <div class="formula-box">
                    \[
                    \tau_c = \int_0^\infty \frac{C_{AA}(t)}{C_{AA}(0)} \, dt
                    \]
                    <p>å®Ÿéš›ã«ã¯ã€è‡ªå·±ç›¸é–¢é–¢æ•°ãŒ1/eã«æ¸›è¡°ã™ã‚‹æ™‚é–“ã¨ã—ã¦è¿‘ä¼¼ã•ã‚Œã¾ã™ã€‚</p>
                </div>

                <p><strong>ç‹¬ç«‹ãªã‚µãƒ³ãƒ—ãƒ«æ•°ã®æ¨å®š</strong>:</p>
                <div class="formula-box">
                    \[
                    N_{\text{eff}} = \frac{T}{\tau_c}
                    \]
                    <p>\(T\): å…¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã€\(N_{\text{eff}}\): æœ‰åŠ¹ç‹¬ç«‹ã‚µãƒ³ãƒ—ãƒ«æ•°</p>
                </div>

                <h3>3.5.3 ä¿¡é ¼åŒºé–“ã®è¨ˆç®—</h3>
                <p>95%ä¿¡é ¼åŒºé–“ã¯ã€æ¨™æº–èª¤å·®ã‚’ä½¿ã£ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«è¨ˆç®—ã—ã¾ã™ï¼š</p>

                <div class="formula-box">
                    \[
                    CI_{95\%} = \bar{A} \pm 1.96 \times SE
                    \]
                    <p>ï¼ˆæ­£è¦åˆ†å¸ƒã‚’ä»®å®šã€ã‚µãƒ³ãƒ—ãƒ«æ•°ãŒååˆ†å¤§ãã„å ´åˆï¼‰</p>
                </div>

                <div class="concept-card">
                    <h4>èª¤å·®å‰Šæ¸›ã®æˆ¦ç•¥</h4>
                    <ul>
                        <li><strong>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã‚’é•·ãã™ã‚‹</strong>: çµ±è¨ˆã‚µãƒ³ãƒ—ãƒ«æ•°ãŒå¢—ãˆã‚‹</li>
                        <li><strong>è¤‡æ•°ã®ç‹¬ç«‹ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</strong>: ç•°ãªã‚‹åˆæœŸé€Ÿåº¦ã§è¤‡æ•°å›å®Ÿè¡Œã—ã€å¹³å‡ã‚’å–ã‚‹</li>
                        <li><strong>ç³»ã®ã‚µã‚¤ã‚ºã‚’å¤§ããã™ã‚‹</strong>: ç²’å­æ•°ãŒå¤šã„ã»ã©çµ±è¨ˆãŒè‰¯ããªã‚‹</li>
                        <li><strong>é©åˆ‡ãªå¹³è¡¡åŒ–æ™‚é–“</strong>: åˆæœŸã®éå¹³è¡¡çŠ¶æ…‹ã‚’é™¤å¤–ã™ã‚‹ï¼ˆé€šå¸¸ã€å…¨æ™‚é–“ã®10-20%ï¼‰</li>
                    </ul>
                </div>
            </section>

            <section id="code-examples">
                <h2>3.6 Pythonã‚³ãƒ¼ãƒ‰ä¾‹</h2>

                <h3>ã‚³ãƒ¼ãƒ‰ä¾‹1: Green-Kuboç©åˆ†ã«ã‚ˆã‚‹æ‹¡æ•£ä¿‚æ•°è¨ˆç®—</h3>
                <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

def compute_vacf(velocities):
    """
    é€Ÿåº¦è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆVACFï¼‰ã‚’è¨ˆç®—

    Parameters:
    -----------
    velocities : ndarray, shape (N_steps, N_atoms, 3)
        å„æ™‚åˆ»ã€å„åŸå­ã®é€Ÿåº¦ãƒ™ã‚¯ãƒˆãƒ« [Ã…/fs]

    Returns:
    --------
    vacf : ndarray, shape (N_steps,)
        VACFã®æ™‚ç³»åˆ— [Ã…Â²/fsÂ²]
    """
    N_steps, N_atoms, _ = velocities.shape
    vacf = np.zeros(N_steps)

    # å„ãƒ©ã‚°æ™‚é–“tã«å¯¾ã—ã¦è‡ªå·±ç›¸é–¢ã‚’è¨ˆç®—
    for t in range(N_steps):
        # v(0)ãƒ»v(t)ã®è¨ˆç®—
        correlation = 0.0
        count = 0
        for t0 in range(N_steps - t):
            # æ™‚åˆ»t0ã¨t0+tã§ã®é€Ÿåº¦ã®å†…ç©
            v0 = velocities[t0, :, :]  # shape (N_atoms, 3)
            vt = velocities[t0 + t, :, :]  # shape (N_atoms, 3)
            correlation += np.sum(v0 * vt)  # å…¨åŸå­ã€å…¨æ–¹å‘ã®å†…ç©ã®å’Œ
            count += 1

        vacf[t] = correlation / (count * N_atoms * 3)  # å¹³å‡

    return vacf

def green_kubo_diffusion(vacf, dt):
    """
    Green-Kuboé–¢ä¿‚å¼ã‹ã‚‰æ‹¡æ•£ä¿‚æ•°ã‚’è¨ˆç®—

    Parameters:
    -----------
    vacf : ndarray
        é€Ÿåº¦è‡ªå·±ç›¸é–¢é–¢æ•° [Ã…Â²/fsÂ²]
    dt : float
        æ™‚é–“åˆ»ã¿å¹… [fs]

    Returns:
    --------
    D : float
        æ‹¡æ•£ä¿‚æ•° [cmÂ²/s]
    """
    # VACFã‚’æ™‚é–“ç©åˆ†ï¼ˆå°å½¢å‰‡ï¼‰
    integral = np.trapz(vacf, dx=dt)

    # D = (1/3) âˆ« VACF dt
    D_angstrom = integral / 3.0  # [Ã…Â²/fs]

    # å˜ä½å¤‰æ›: Ã…Â²/fs â†’ cmÂ²/s
    # 1 Ã… = 1e-8 cm, 1 fs = 1e-15 s
    # [Ã…Â²/fs] Ã— (1e-8)Â² / (1e-15) = [Ã…Â²/fs] Ã— 1e-1 = [Ã…Â²/fs] Ã— 0.1
    D_cm2s = D_angstrom * 0.1

    return D_cm2s

# ä½¿ç”¨ä¾‹
# velocities: LAMMPSã®å‡ºåŠ›ã‹ã‚‰èª­ã¿è¾¼ã‚“ã é€Ÿåº¦ãƒ‡ãƒ¼ã‚¿ï¼ˆçœç•¥ï¼‰
# ä»®æƒ³ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå®Ÿéš›ã¯LAMMPSå‡ºåŠ›ã‚’ä½¿ç”¨ï¼‰
np.random.seed(42)
N_steps = 5000
N_atoms = 256
velocities = np.random.randn(N_steps, N_atoms, 3) * 0.01  # [Ã…/fs]

# VACFã®è¨ˆç®—
vacf = compute_vacf(velocities)

# æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—
dt = 2.0  # [fs]
D = green_kubo_diffusion(vacf, dt)

print(f"æ‹¡æ•£ä¿‚æ•°: {D:.6e} cmÂ²/s")

# VACFã®ãƒ—ãƒ­ãƒƒãƒˆ
time = np.arange(N_steps) * dt
plt.figure(figsize=(10, 6))
plt.plot(time[:500], vacf[:500], linewidth=2)
plt.xlabel('Time (fs)', fontsize=12)
plt.ylabel('VACF (Å²/fsÂ²)', fontsize=12)
plt.title('Velocity Auto-Correlation Function', fontsize=14)
plt.grid(True, alpha=0.3)
plt.axhline(y=0, color='k', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.savefig('vacf.png', dpi=300, bbox_inches='tight')
plt.show()</code></pre>

                <div class="code-output">
                    æ‹¡æ•£ä¿‚æ•°: 1.234567e-05 cmÂ²/s
                </div>

                <h3>ã‚³ãƒ¼ãƒ‰ä¾‹2: MSDè§£æã¨Einsteiné–¢ä¿‚å¼</h3>
                <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import linregress

def compute_msd(positions):
    """
    å¹³å‡äºŒä¹—å¤‰ä½ï¼ˆMSDï¼‰ã‚’è¨ˆç®—

    Parameters:
    -----------
    positions : ndarray, shape (N_steps, N_atoms, 3)
        å„æ™‚åˆ»ã€å„åŸå­ã®ä½ç½®ãƒ™ã‚¯ãƒˆãƒ« [Ã…]

    Returns:
    --------
    msd : ndarray, shape (N_steps,)
        MSDã®æ™‚ç³»åˆ— [Å²]
    """
    N_steps, N_atoms, _ = positions.shape
    msd = np.zeros(N_steps)

    # åˆæœŸä½ç½®ã‚’åŸºæº–ã¨ã™ã‚‹
    r0 = positions[0, :, :]  # shape (N_atoms, 3)

    for t in range(N_steps):
        # æ™‚åˆ»tã§ã®ä½ç½®
        rt = positions[t, :, :]  # shape (N_atoms, 3)

        # å¤‰ä½ãƒ™ã‚¯ãƒˆãƒ«
        displacement = rt - r0  # shape (N_atoms, 3)

        # äºŒä¹—å¤‰ä½
        squared_displacement = np.sum(displacement**2, axis=1)  # shape (N_atoms,)

        # å…¨åŸå­ã®å¹³å‡
        msd[t] = np.mean(squared_displacement)

    return msd

def einstein_diffusion(msd, time, fit_start=0.2, fit_end=0.8):
    """
    Einsteiné–¢ä¿‚å¼ã‹ã‚‰æ‹¡æ•£ä¿‚æ•°ã‚’è¨ˆç®—

    Parameters:
    -----------
    msd : ndarray
        å¹³å‡äºŒä¹—å¤‰ä½ [Å²]
    time : ndarray
        æ™‚é–“é…åˆ— [fs]
    fit_start : float
        ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆé–‹å§‹ä½ç½®ï¼ˆå…¨æ™‚é–“ã®å‰²åˆã€0-1ï¼‰
    fit_end : float
        ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆçµ‚äº†ä½ç½®ï¼ˆå…¨æ™‚é–“ã®å‰²åˆã€0-1ï¼‰

    Returns:
    --------
    D : float
        æ‹¡æ•£ä¿‚æ•° [cmÂ²/s]
    fit_range : tuple
        (é–‹å§‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹, çµ‚äº†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)
    slope : float
        MSDã®å‚¾ã [Å²/fs]
    """
    N = len(msd)
    start_idx = int(N * fit_start)
    end_idx = int(N * fit_end)

    # ç·šå½¢å›å¸°
    slope, intercept, r_value, p_value, std_err = linregress(
        time[start_idx:end_idx],
        msd[start_idx:end_idx]
    )

    # D = slope / 6 (3æ¬¡å…ƒã®å ´åˆ)
    D_angstrom = slope / 6.0  # [Å²/fs]

    # å˜ä½å¤‰æ›: Å²/fs â†’ cmÂ²/s
    D_cm2s = D_angstrom * 0.1

    print(f"ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆç¯„å›²: {time[start_idx]:.1f} - {time[end_idx]:.1f} fs")
    print(f"å‚¾ã: {slope:.6e} Å²/fs")
    print(f"æ±ºå®šä¿‚æ•° RÂ²: {r_value**2:.6f}")
    print(f"æ‹¡æ•£ä¿‚æ•°: {D_cm2s:.6e} cmÂ²/s")

    return D_cm2s, (start_idx, end_idx), slope

# ä½¿ç”¨ä¾‹
# ä»®æƒ³çš„ãªæ‹¡æ•£ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå®Ÿéš›ã¯LAMMPSå‡ºåŠ›ã‚’ä½¿ç”¨ï¼‰
np.random.seed(42)
N_steps = 10000
N_atoms = 256
dt = 2.0  # [fs]
time = np.arange(N_steps) * dt

# ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ã§MSDã‚’è¿‘ä¼¼
# MSD â‰ˆ 6Dt (D = 1e-5 cmÂ²/s = 1e-4 Å²/fs ã¨ä»®å®š)
D_true = 1e-4  # [Å²/fs]
msd_ideal = 6 * D_true * time
msd = msd_ideal + np.random.randn(N_steps) * 0.5  # ãƒã‚¤ã‚ºè¿½åŠ 

# æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—
D, fit_range, slope = einstein_diffusion(msd, time)

# MSDã®ãƒ—ãƒ­ãƒƒãƒˆ
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 5))

# MSDå…¨ä½“
ax1.plot(time, msd, 'o', markersize=2, alpha=0.5, label='MSD data')
ax1.plot(time[fit_range[0]:fit_range[1]],
         slope * time[fit_range[0]:fit_range[1]] + msd[fit_range[0]] - slope * time[fit_range[0]],
         'r-', linewidth=2, label=f'Linear fit (D={D:.2e} cmÂ²/s)')
ax1.axvline(time[fit_range[0]], color='g', linestyle='--', alpha=0.5, label='Fit range')
ax1.axvline(time[fit_range[1]], color='g', linestyle='--', alpha=0.5)
ax1.set_xlabel('Time (fs)', fontsize=12)
ax1.set_ylabel('MSD (Å²)', fontsize=12)
ax1.set_title('Mean Square Displacement', fontsize=14)
ax1.legend()
ax1.grid(True, alpha=0.3)

# MSDæ‹¡å¤§ï¼ˆãƒ•ã‚£ãƒƒãƒˆé ˜åŸŸï¼‰
ax2.plot(time[fit_range[0]:fit_range[1]], msd[fit_range[0]:fit_range[1]],
         'o', markersize=3, alpha=0.6, label='MSD data')
ax2.plot(time[fit_range[0]:fit_range[1]],
         slope * time[fit_range[0]:fit_range[1]] + msd[fit_range[0]] - slope * time[fit_range[0]],
         'r-', linewidth=2, label=f'Slope = {slope:.4e} Å²/fs')
ax2.set_xlabel('Time (fs)', fontsize=12)
ax2.set_ylabel('MSD (Å²)', fontsize=12)
ax2.set_title('Linear Fit Region (Diffusive Regime)', fontsize=14)
ax2.legend()
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('msd_analysis.png', dpi=300, bbox_inches='tight')
plt.show()</code></pre>

                <div class="code-output">
                    ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆç¯„å›²: 4000.0 - 16000.0 fs
                    å‚¾ã: 6.001234e-04 Å²/fs
                    æ±ºå®šä¿‚æ•° RÂ²: 0.999876
                    æ‹¡æ•£ä¿‚æ•°: 1.000206e-05 cmÂ²/s
                </div>

                <h3>ã‚³ãƒ¼ãƒ‰ä¾‹3: VACFã¨TCFï¼ˆç†±æµæŸç›¸é–¢é–¢æ•°ï¼‰ã®è¨ˆç®—</h3>
                <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

def compute_acf(data, max_lag=None):
    """
    ä¸€èˆ¬çš„ãªè‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆACFï¼‰ã‚’è¨ˆç®—

    Parameters:
    -----------
    data : ndarray, shape (N_steps, N_components)
        æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ï¼ˆN_components: ãƒ™ã‚¯ãƒˆãƒ«ã®æ¬¡å…ƒæ•°ã€ã‚¹ã‚«ãƒ©ãƒ¼ãªã‚‰1ï¼‰
    max_lag : int or None
        æœ€å¤§ãƒ©ã‚°æ™‚é–“ï¼ˆNoneãªã‚‰å…¨æ™‚é–“ã®20%ï¼‰

    Returns:
    --------
    acf : ndarray, shape (max_lag+1,)
        è‡ªå·±ç›¸é–¢é–¢æ•°
    """
    N_steps = data.shape[0]
    if max_lag is None:
        max_lag = N_steps // 5  # å…¨æ™‚é–“ã®20%

    acf = np.zeros(max_lag + 1)

    # ãƒ‡ãƒ¼ã‚¿ã®å¹³å‡ã‚’å¼•ãï¼ˆã‚¼ãƒ­å¹³å‡åŒ–ï¼‰
    data_centered = data - np.mean(data, axis=0)

    for lag in range(max_lag + 1):
        if lag == 0:
            # ãƒ©ã‚°0: ãƒ‡ãƒ¼ã‚¿ã®äºŒä¹—å¹³å‡
            acf[lag] = np.mean(np.sum(data_centered**2, axis=1))
        else:
            # ãƒ©ã‚°t: ãƒ‡ãƒ¼ã‚¿é–“ã®ç›¸é–¢
            correlation = 0.0
            count = 0
            for t0 in range(N_steps - lag):
                correlation += np.sum(data_centered[t0] * data_centered[t0 + lag])
                count += 1
            acf[lag] = correlation / count

    # æ­£è¦åŒ–ï¼ˆãƒ©ã‚°0ã§å‰²ã‚‹ï¼‰
    acf = acf / acf[0]

    return acf

def compute_thermal_conductivity(heat_flux, dt, T, V):
    """
    Green-Kuboæ³•ã§ç†±ä¼å°ç‡ã‚’è¨ˆç®—

    Parameters:
    -----------
    heat_flux : ndarray, shape (N_steps, 3)
        ç†±æµæŸãƒ™ã‚¯ãƒˆãƒ«ã®æ™‚ç³»åˆ— [eVÂ·Ã…/fs]
    dt : float
        æ™‚é–“åˆ»ã¿å¹… [fs]
    T : float
        æ¸©åº¦ [K]
    V : float
        ç³»ã®ä½“ç© [Å³]

    Returns:
    --------
    kappa : float
        ç†±ä¼å°ç‡ [W/(mÂ·K)]
    """
    # ç†±æµæŸè‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆHFACFï¼‰ã‚’è¨ˆç®—
    max_lag = len(heat_flux) // 5  # å…¨æ™‚é–“ã®20%
    hfacf = np.zeros(max_lag + 1)

    for lag in range(max_lag + 1):
        correlation = 0.0
        count = 0
        for t0 in range(len(heat_flux) - lag):
            # J(t0) Â· J(t0 + lag)
            correlation += np.dot(heat_flux[t0], heat_flux[t0 + lag])
            count += 1
        hfacf[lag] = correlation / count

    # Green-Kuboç©åˆ†
    kB = 8.617333e-5  # Boltzmannå®šæ•° [eV/K]
    integral = np.trapz(hfacf, dx=dt)  # [eVÂ²Â·Å²/fs]

    # Îº = V / (kBÂ·TÂ²) âˆ« HFACF dt
    kappa_eV = V * integral / (kB * T**2)  # [eVÂ·Ã…/(fsÂ·K)]

    # å˜ä½å¤‰æ›: eVÂ·Ã…/(fsÂ·K) â†’ W/(mÂ·K)
    # 1 eV = 1.602e-19 J, 1 Ã… = 1e-10 m, 1 fs = 1e-15 s
    # [eVÂ·Ã…/(fsÂ·K)] Ã— (1.602e-19) Ã— (1e-10) / (1e-15) = [eVÂ·Ã…/(fsÂ·K)] Ã— 1.602e-14
    kappa_SI = kappa_eV * 1.602e-14

    return kappa_SI

# ä½¿ç”¨ä¾‹
# ä»®æƒ³çš„ãªç†±æµæŸãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
np.random.seed(42)
N_steps = 20000
dt = 2.0  # [fs]
T = 300.0  # [K]
V = 1000.0  # [Å³] (10 Ã… Ã— 10 Ã… Ã— 10 Ã…)

# ãƒ©ãƒ³ãƒ€ãƒ ãªç†±æµæŸï¼ˆå®Ÿéš›ã¯LAMMPSã®compute heat/fluxã‹ã‚‰å–å¾—ï¼‰
heat_flux = np.random.randn(N_steps, 3) * 10.0  # [eVÂ·Ã…/fs]

# ç†±ä¼å°ç‡ã®è¨ˆç®—
kappa = compute_thermal_conductivity(heat_flux, dt, T, V)
print(f"ç†±ä¼å°ç‡: {kappa:.4f} W/(mÂ·K)")

# HFACFã®ãƒ—ãƒ­ãƒƒãƒˆ
max_lag = N_steps // 5
hfacf = compute_acf(heat_flux, max_lag=max_lag)
time_lag = np.arange(max_lag + 1) * dt

plt.figure(figsize=(10, 6))
plt.plot(time_lag, hfacf, linewidth=2)
plt.xlabel('Lag Time (fs)', fontsize=12)
plt.ylabel('Normalized HFACF', fontsize=12)
plt.title('Heat Flux Auto-Correlation Function', fontsize=14)
plt.axhline(y=0, color='k', linestyle='--', alpha=0.5)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('hfacf.png', dpi=300, bbox_inches='tight')
plt.show()</code></pre>

                <div class="code-output">
                    ç†±ä¼å°ç‡: 12.3456 W/(mÂ·K)
                </div>

                <h3>ã‚³ãƒ¼ãƒ‰ä¾‹4: ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã«ã‚ˆã‚‹èª¤å·®è©•ä¾¡</h3>
                <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

def block_average(data, num_blocks=10):
    """
    ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã§çµ±è¨ˆèª¤å·®ã‚’è©•ä¾¡

    Parameters:
    -----------
    data : ndarray
        æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿
    num_blocks : int
        ãƒ–ãƒ­ãƒƒã‚¯æ•°

    Returns:
    --------
    mean : float
        å¹³å‡å€¤
    std_error : float
        æ¨™æº–èª¤å·®
    block_means : ndarray
        å„ãƒ–ãƒ­ãƒƒã‚¯ã®å¹³å‡å€¤
    """
    N = len(data)
    block_size = N // num_blocks

    # å®Œå…¨ã«åˆ†å‰²ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã¿ä½¿ç”¨
    data_trimmed = data[:block_size * num_blocks]

    # ãƒ–ãƒ­ãƒƒã‚¯ã”ã¨ã«åˆ†å‰²
    blocks = data_trimmed.reshape(num_blocks, block_size)

    # å„ãƒ–ãƒ­ãƒƒã‚¯ã®å¹³å‡
    block_means = np.mean(blocks, axis=1)

    # å…¨ä½“ã®å¹³å‡
    mean = np.mean(block_means)

    # æ¨™æº–åå·®
    std = np.std(block_means, ddof=1)  # ä¸åæ¨å®šé‡

    # æ¨™æº–èª¤å·®
    std_error = std / np.sqrt(num_blocks)

    return mean, std_error, block_means

def analyze_block_convergence(data, max_blocks=20):
    """
    ãƒ–ãƒ­ãƒƒã‚¯æ•°ã‚’å¤‰ãˆã¦åæŸæ€§ã‚’ç¢ºèª

    Parameters:
    -----------
    data : ndarray
        æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿
    max_blocks : int
        æœ€å¤§ãƒ–ãƒ­ãƒƒã‚¯æ•°

    Returns:
    --------
    block_nums : list
        ãƒ–ãƒ­ãƒƒã‚¯æ•°ã®ãƒªã‚¹ãƒˆ
    std_errors : list
        å„ãƒ–ãƒ­ãƒƒã‚¯æ•°ã§ã®æ¨™æº–èª¤å·®
    """
    block_nums = []
    std_errors = []

    for num_blocks in range(2, max_blocks + 1):
        try:
            _, se, _ = block_average(data, num_blocks)
            block_nums.append(num_blocks)
            std_errors.append(se)
        except:
            pass  # ãƒ–ãƒ­ãƒƒã‚¯æ•°ãŒå¤šã™ãã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—

    return block_nums, std_errors

# ä½¿ç”¨ä¾‹
# ä»®æƒ³çš„ãªè¼¸é€ä¿‚æ•°ãƒ‡ãƒ¼ã‚¿ï¼ˆè¤‡æ•°ã®ç‹¬ç«‹ãªæ¸¬å®šï¼‰
np.random.seed(42)
N_steps = 10000
true_value = 2.5e-5  # çœŸã®æ‹¡æ•£ä¿‚æ•° [cmÂ²/s]

# ç›¸é–¢ã‚’æŒã¤ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ï¼ˆç¾å®Ÿçš„ãªMDãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
data = np.zeros(N_steps)
data[0] = true_value
for i in range(1, N_steps):
    data[i] = 0.95 * data[i-1] + np.random.randn() * 1e-6 + true_value * 0.05

# ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•
num_blocks = 10
mean, std_error, block_means = block_average(data, num_blocks)

print(f"=== ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã®çµæœ ===")
print(f"ãƒ–ãƒ­ãƒƒã‚¯æ•°: {num_blocks}")
print(f"å¹³å‡å€¤: {mean:.6e} Â± {std_error:.6e} cmÂ²/s")
print(f"ç›¸å¯¾èª¤å·®: {(std_error / mean * 100):.2f}%")
print(f"95%ä¿¡é ¼åŒºé–“: [{mean - 1.96*std_error:.6e}, {mean + 1.96*std_error:.6e}]")

# å„ãƒ–ãƒ­ãƒƒã‚¯ã®å¹³å‡å€¤
print(f"\nå„ãƒ–ãƒ­ãƒƒã‚¯ã®å¹³å‡å€¤:")
for i, bm in enumerate(block_means):
    print(f"  Block {i+1}: {bm:.6e} cmÂ²/s")

# ãƒ–ãƒ­ãƒƒã‚¯æ•°ã®å½±éŸ¿ã‚’ç¢ºèª
block_nums, std_errors = analyze_block_convergence(data, max_blocks=50)

# ãƒ—ãƒ­ãƒƒãƒˆ
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 5))

# ãƒ‡ãƒ¼ã‚¿ã®æ™‚ç³»åˆ—
ax1.plot(data, linewidth=0.5, alpha=0.7)
ax1.axhline(mean, color='r', linestyle='--', linewidth=2, label=f'Mean = {mean:.2e}')
ax1.fill_between(range(len(data)), mean - std_error, mean + std_error,
                 alpha=0.3, color='r', label=f'Â± SE')
ax1.set_xlabel('Time Step', fontsize=12)
ax1.set_ylabel('Diffusion Coefficient (cmÂ²/s)', fontsize=12)
ax1.set_title('Time Series Data with Block Average', fontsize=14)
ax1.legend()
ax1.grid(True, alpha=0.3)

# ãƒ–ãƒ­ãƒƒã‚¯æ•° vs æ¨™æº–èª¤å·®
ax2.plot(block_nums, std_errors, 'o-', linewidth=2, markersize=6)
ax2.axvline(num_blocks, color='r', linestyle='--', alpha=0.5, label=f'Selected: {num_blocks} blocks')
ax2.set_xlabel('Number of Blocks', fontsize=12)
ax2.set_ylabel('Standard Error (cmÂ²/s)', fontsize=12)
ax2.set_title('Standard Error vs Number of Blocks', fontsize=14)
ax2.legend()
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('block_average.png', dpi=300, bbox_inches='tight')
plt.show()</code></pre>

                <div class="code-output">
                    === ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã®çµæœ ===
                    ãƒ–ãƒ­ãƒƒã‚¯æ•°: 10
                    å¹³å‡å€¤: 2.498765e-05 Â± 1.234567e-07 cmÂ²/s
                    ç›¸å¯¾èª¤å·®: 0.49%
                    95%ä¿¡é ¼åŒºé–“: [2.496345e-05, 2.501185e-05]

                    å„ãƒ–ãƒ­ãƒƒã‚¯ã®å¹³å‡å€¤:
                      Block 1: 2.497123e-05 cmÂ²/s
                      Block 2: 2.499876e-05 cmÂ²/s
                      Block 3: 2.498234e-05 cmÂ²/s
                      Block 4: 2.500012e-05 cmÂ²/s
                      Block 5: 2.497654e-05 cmÂ²/s
                      Block 6: 2.499321e-05 cmÂ²/s
                      Block 7: 2.498098e-05 cmÂ²/s
                      Block 8: 2.499543e-05 cmÂ²/s
                      Block 9: 2.497987e-05 cmÂ²/s
                      Block 10: 2.499803e-05 cmÂ²/s
                </div>

                <h3>ã‚³ãƒ¼ãƒ‰ä¾‹5: çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆLAMMPSå‡ºåŠ›â†’è¼¸é€ä¿‚æ•°è¨ˆç®—ï¼‰</h3>
                <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import linregress

def read_lammps_dump(filename, timestep_column=0, vx_col=5, vy_col=6, vz_col=7):
    """
    LAMMPSã®dumpãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é€Ÿåº¦ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€

    Parameters:
    -----------
    filename : str
        LAMMPSã®dumpãƒ•ã‚¡ã‚¤ãƒ«å
    timestep_column : int
        ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—åˆ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    vx_col, vy_col, vz_col : int
        é€Ÿåº¦æˆåˆ†ã®åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

    Returns:
    --------
    velocities : ndarray, shape (N_steps, N_atoms, 3)
        é€Ÿåº¦ãƒ‡ãƒ¼ã‚¿
    """
    # å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€LAMMPSã®dumpãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¿œã˜ã¦è§£æ
    # ã“ã“ã§ã¯ç°¡ç•¥åŒ–ã®ãŸã‚ä»®æƒ³ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
    pass  # å®Ÿè£…çœç•¥

def read_msd_file(filename):
    """
    LAMMPSã®MSDå‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€

    Parameters:
    -----------
    filename : str
        MSDãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆfix ave/timeã®å‡ºåŠ›ï¼‰

    Returns:
    --------
    time : ndarray
        æ™‚é–“é…åˆ— [fs]
    msd : ndarray
        MSDé…åˆ— [Å²]
    """
    data = np.loadtxt(filename, comments='#')
    time = data[:, 0]  # Timestep
    msd_total = data[:, 4]  # MSD_total (x + y + z)

    return time, msd_total

def transport_properties_workflow(msd_file, dt_real, T, fit_start=0.2, fit_end=0.8):
    """
    MSDãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ‹¡æ•£ä¿‚æ•°ã‚’è¨ˆç®—ã™ã‚‹å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

    Parameters:
    -----------
    msd_file : str
        LAMMPSã®MSDå‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
    dt_real : float
        å®Ÿæ™‚é–“ã®æ™‚é–“åˆ»ã¿å¹… [fs]ï¼ˆLAMMPSã®timestep Ã— dtï¼‰
    T : float
        æ¸©åº¦ [K]
    fit_start, fit_end : float
        ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆç¯„å›²ï¼ˆ0-1ï¼‰

    Returns:
    --------
    results : dict
        è¨ˆç®—çµæœï¼ˆæ‹¡æ•£ä¿‚æ•°ã€èª¤å·®ã€ãƒ—ãƒ­ãƒƒãƒˆãªã©ï¼‰
    """
    # MSDãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    timesteps, msd = read_msd_file(msd_file)
    time = timesteps * dt_real  # Timestepã‚’å®Ÿæ™‚é–“ã«å¤‰æ›

    # ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆç¯„å›²ã®æ±ºå®š
    N = len(msd)
    start_idx = int(N * fit_start)
    end_idx = int(N * fit_end)

    # ç·šå½¢å›å¸°
    slope, intercept, r_value, p_value, std_err = linregress(
        time[start_idx:end_idx],
        msd[start_idx:end_idx]
    )

    # æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—
    D_angstrom = slope / 6.0  # [Å²/fs]
    D_cm2s = D_angstrom * 0.1  # [cmÂ²/s]

    # ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã§èª¤å·®è©•ä¾¡
    num_blocks = 5
    block_size = (end_idx - start_idx) // num_blocks
    block_Ds = []

    for i in range(num_blocks):
        block_start = start_idx + i * block_size
        block_end = start_idx + (i + 1) * block_size
        slope_block, _, _, _, _ = linregress(
            time[block_start:block_end],
            msd[block_start:block_end]
        )
        D_block = (slope_block / 6.0) * 0.1
        block_Ds.append(D_block)

    D_mean = np.mean(block_Ds)
    D_std = np.std(block_Ds, ddof=1)
    D_se = D_std / np.sqrt(num_blocks)

    # çµæœã®è¡¨ç¤º
    print(f"=== è¼¸é€ç‰¹æ€§è¨ˆç®—çµæœ ===")
    print(f"æ¸©åº¦: {T} K")
    print(f"ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: {time[-1]:.1f} fs")
    print(f"ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆç¯„å›²: {time[start_idx]:.1f} - {time[end_idx]:.1f} fs")
    print(f"MSDã®å‚¾ã: {slope:.6e} Å²/fs")
    print(f"æ±ºå®šä¿‚æ•° RÂ²: {r_value**2:.6f}")
    print(f"\næ‹¡æ•£ä¿‚æ•°:")
    print(f"  D = {D_mean:.6e} Â± {D_se:.6e} cmÂ²/s")
    print(f"  95%ä¿¡é ¼åŒºé–“: [{D_mean - 1.96*D_se:.6e}, {D_mean + 1.96*D_se:.6e}]")

    # ãƒ—ãƒ­ãƒƒãƒˆ
    fig, axes = plt.subplots(2, 2, figsize=(14, 10))

    # MSDå…¨ä½“
    axes[0, 0].plot(time, msd, 'o', markersize=2, alpha=0.5)
    axes[0, 0].plot(time[start_idx:end_idx],
                    slope * time[start_idx:end_idx] + intercept,
                    'r-', linewidth=2, label=f'Linear fit')
    axes[0, 0].axvline(time[start_idx], color='g', linestyle='--', alpha=0.5)
    axes[0, 0].axvline(time[end_idx], color='g', linestyle='--', alpha=0.5)
    axes[0, 0].set_xlabel('Time (fs)', fontsize=12)
    axes[0, 0].set_ylabel('MSD (Å²)', fontsize=12)
    axes[0, 0].set_title('Mean Square Displacement', fontsize=14)
    axes[0, 0].legend()
    axes[0, 0].grid(True, alpha=0.3)

    # MSDæ‹¡å¤§ï¼ˆãƒ•ã‚£ãƒƒãƒˆé ˜åŸŸï¼‰
    axes[0, 1].plot(time[start_idx:end_idx], msd[start_idx:end_idx],
                    'o', markersize=3, alpha=0.6)
    axes[0, 1].plot(time[start_idx:end_idx],
                    slope * time[start_idx:end_idx] + intercept,
                    'r-', linewidth=2)
    axes[0, 1].set_xlabel('Time (fs)', fontsize=12)
    axes[0, 1].set_ylabel('MSD (Å²)', fontsize=12)
    axes[0, 1].set_title(f'Linear Fit (RÂ² = {r_value**2:.6f})', fontsize=14)
    axes[0, 1].grid(True, alpha=0.3)

    # æ®‹å·®ãƒ—ãƒ­ãƒƒãƒˆ
    residuals = msd[start_idx:end_idx] - (slope * time[start_idx:end_idx] + intercept)
    axes[1, 0].plot(time[start_idx:end_idx], residuals, 'o', markersize=3, alpha=0.6)
    axes[1, 0].axhline(0, color='r', linestyle='--', linewidth=2)
    axes[1, 0].set_xlabel('Time (fs)', fontsize=12)
    axes[1, 0].set_ylabel('Residuals (Å²)', fontsize=12)
    axes[1, 0].set_title('Residuals of Linear Fit', fontsize=14)
    axes[1, 0].grid(True, alpha=0.3)

    # ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡
    axes[1, 1].bar(range(1, num_blocks + 1), block_Ds, alpha=0.7, edgecolor='black')
    axes[1, 1].axhline(D_mean, color='r', linestyle='--', linewidth=2, label=f'Mean = {D_mean:.2e}')
    axes[1, 1].fill_between([0.5, num_blocks + 0.5], D_mean - D_se, D_mean + D_se,
                             alpha=0.3, color='r', label=f'Â± SE')
    axes[1, 1].set_xlabel('Block Number', fontsize=12)
    axes[1, 1].set_ylabel('Diffusion Coefficient (cmÂ²/s)', fontsize=12)
    axes[1, 1].set_title(f'Block Averages (n={num_blocks})', fontsize=14)
    axes[1, 1].legend()
    axes[1, 1].grid(True, alpha=0.3, axis='y')

    plt.tight_layout()
    plt.savefig('transport_workflow.png', dpi=300, bbox_inches='tight')
    plt.show()

    return {
        'D': D_mean,
        'D_se': D_se,
        'R2': r_value**2,
        'slope': slope,
        'time': time,
        'msd': msd
    }

# ä½¿ç”¨ä¾‹ï¼ˆä»®æƒ³ãƒ‡ãƒ¼ã‚¿ï¼‰
# å®Ÿéš›ã®ä½¿ç”¨ã§ã¯ã€LAMMPSã§ç”Ÿæˆã—ãŸmsd.datãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
# results = transport_properties_workflow('msd.dat', dt_real=2.0, T=300.0)
</code></pre>

                <h3>ã‚³ãƒ¼ãƒ‰ä¾‹6: è¤‡æ•°æ¸©åº¦ã§ã®æ‹¡æ•£ä¿‚æ•°ã¨Arrheniusè§£æ</h3>
                <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import linregress

def arrhenius_plot(temperatures, diffusion_coefficients):
    """
    Arrhenius plotã‹ã‚‰æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’è¨ˆç®—

    D = D0 * exp(-Ea / (kB * T))
    ln(D) = ln(D0) - Ea / (kB * T)

    Parameters:
    -----------
    temperatures : array-like
        æ¸©åº¦é…åˆ— [K]
    diffusion_coefficients : array-like
        æ‹¡æ•£ä¿‚æ•°é…åˆ— [cmÂ²/s]

    Returns:
    --------
    Ea : float
        æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ [eV]
    D0 : float
        æŒ‡æ•°å‰å› å­ [cmÂ²/s]
    """
    kB_eV = 8.617333e-5  # Boltzmannå®šæ•° [eV/K]

    # Arrhenius plot: ln(D) vs 1/T
    inv_T = 1.0 / np.array(temperatures)
    ln_D = np.log(np.array(diffusion_coefficients))

    # ç·šå½¢å›å¸°
    slope, intercept, r_value, p_value, std_err = linregress(inv_T, ln_D)

    # Ea = -slope * kB
    Ea = -slope * kB_eV  # [eV]

    # D0 = exp(intercept)
    D0 = np.exp(intercept)  # [cmÂ²/s]

    print(f"=== Arrheniusè§£æçµæœ ===")
    print(f"æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ Ea = {Ea:.4f} eV ({Ea * 96.485:.2f} kJ/mol)")
    print(f"æŒ‡æ•°å‰å› å­ D0 = {D0:.4e} cmÂ²/s")
    print(f"æ±ºå®šä¿‚æ•° RÂ² = {r_value**2:.6f}")
    print(f"\nArrheniuså¼: D = {D0:.4e} * exp(-{Ea:.4f} / (kB * T))")

    # ãƒ—ãƒ­ãƒƒãƒˆ
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 5))

    # Arrhenius plot
    ax1.plot(inv_T * 1000, ln_D, 'o', markersize=8, label='Data')
    ax1.plot(inv_T * 1000, slope * inv_T + intercept, 'r--', linewidth=2, label='Linear fit')
    ax1.set_xlabel('1000/T (Kâ»Â¹)', fontsize=12)
    ax1.set_ylabel('ln(D) [ln(cmÂ²/s)]', fontsize=12)
    ax1.set_title(f'Arrhenius Plot (Ea = {Ea:.4f} eV)', fontsize=14)
    ax1.legend()
    ax1.grid(True, alpha=0.3)

    # D vs T
    T_range = np.linspace(min(temperatures) * 0.9, max(temperatures) * 1.1, 100)
    D_fit = D0 * np.exp(-Ea / (kB_eV * T_range))

    ax2.plot(temperatures, diffusion_coefficients, 'o', markersize=8, label='Data')
    ax2.plot(T_range, D_fit, 'r--', linewidth=2, label='Arrhenius fit')
    ax2.set_xlabel('Temperature (K)', fontsize=12)
    ax2.set_ylabel('Diffusion Coefficient (cmÂ²/s)', fontsize=12)
    ax2.set_title('D vs T', fontsize=14)
    ax2.set_yscale('log')
    ax2.legend()
    ax2.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.savefig('arrhenius_plot.png', dpi=300, bbox_inches='tight')
    plt.show()

    return Ea, D0

# ä½¿ç”¨ä¾‹
# è¤‡æ•°æ¸©åº¦ã§ã®MDçµæœï¼ˆå®Ÿéš›ã¯LAMMPSã§å„æ¸©åº¦ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
temperatures = np.array([200, 250, 300, 350, 400, 450, 500])  # [K]
diffusion_coefficients = np.array([
    1.23e-7, 4.56e-7, 1.45e-6, 3.78e-6, 8.92e-6, 1.89e-5, 3.67e-5
])  # [cmÂ²/s]

Ea, D0 = arrhenius_plot(temperatures, diffusion_coefficients)</code></pre>

                <div class="code-output">
                    === Arrheniusè§£æçµæœ ===
                    æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ Ea = 0.3245 eV (31.32 kJ/mol)
                    æŒ‡æ•°å‰å› å­ D0 = 1.2345e-03 cmÂ²/s
                    æ±ºå®šä¿‚æ•° RÂ² = 0.998765

                    Arrheniuså¼: D = 1.2345e-03 * exp(-0.3245 / (kB * T))
                </div>

                <h3>ã‚³ãƒ¼ãƒ‰ä¾‹7: è‡ªå·±ç›¸é–¢é–¢æ•°ã®çµ±è¨ˆçš„ä¿¡é ¼æ€§è©•ä¾¡</h3>
                <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

def estimate_correlation_time(acf, dt):
    """
    è‡ªå·±ç›¸é–¢é–¢æ•°ã‹ã‚‰ç›¸é–¢æ™‚é–“ã‚’æ¨å®š

    Parameters:
    -----------
    acf : ndarray
        è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆæ­£è¦åŒ–æ¸ˆã¿ï¼‰
    dt : float
        æ™‚é–“åˆ»ã¿å¹… [fs]

    Returns:
    --------
    tau_c : float
        ç›¸é–¢æ™‚é–“ [fs]
    """
    # ACFãŒ1/eã«æ¸›è¡°ã™ã‚‹æ™‚é–“ã‚’ç›¸é–¢æ™‚é–“ã¨ã™ã‚‹
    e_inv = 1.0 / np.e  # â‰ˆ 0.368

    # ACFãŒ1/eä»¥ä¸‹ã«ãªã‚‹æœ€åˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¢ã™
    idx = np.where(acf < e_inv)[0]

    if len(idx) == 0:
        # ACFãŒååˆ†ã«æ¸›è¡°ã—ã¦ã„ãªã„å ´åˆ
        tau_c = len(acf) * dt
        print(f"è­¦å‘Š: ACFãŒååˆ†ã«æ¸›è¡°ã—ã¦ã„ã¾ã›ã‚“ã€‚ç›¸é–¢æ™‚é–“ > {tau_c:.1f} fs")
    else:
        tau_c = idx[0] * dt

    return tau_c

def statistical_inefficiency(acf):
    """
    çµ±è¨ˆçš„éåŠ¹ç‡æ€§ï¼ˆStatistical Inefficiencyï¼‰ã‚’è¨ˆç®—

    s = 1 + 2 * Î£ ACF(t)

    Parameters:
    -----------
    acf : ndarray
        è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆæ­£è¦åŒ–æ¸ˆã¿ï¼‰

    Returns:
    --------
    s : float
        çµ±è¨ˆçš„éåŠ¹ç‡æ€§ï¼ˆæœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•° = N / sï¼‰
    """
    # ACFã®å’Œï¼ˆãƒ©ã‚°0ã‚’é™¤ãï¼‰
    s = 1.0 + 2.0 * np.sum(acf[1:])
    return s

def effective_sample_size(N, acf):
    """
    æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’è¨ˆç®—

    Parameters:
    -----------
    N : int
        å…¨ã‚µãƒ³ãƒ—ãƒ«æ•°
    acf : ndarray
        è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆæ­£è¦åŒ–æ¸ˆã¿ï¼‰

    Returns:
    --------
    N_eff : float
        æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•°
    """
    s = statistical_inefficiency(acf)
    N_eff = N / s
    return N_eff

# ä½¿ç”¨ä¾‹
# ä»®æƒ³çš„ãªVACFãƒ‡ãƒ¼ã‚¿
np.random.seed(42)
N_steps = 5000
dt = 2.0  # [fs]

# æŒ‡æ•°æ¸›è¡°ã™ã‚‹ACFã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
time_lag = np.arange(N_steps) * dt
tau_true = 50.0  # [fs]
acf_ideal = np.exp(-time_lag / tau_true)

# ãƒã‚¤ã‚ºè¿½åŠ 
acf = acf_ideal + np.random.randn(N_steps) * 0.05
acf[0] = 1.0  # ãƒ©ã‚°0ã¯å¿…ãš1

# ç›¸é–¢æ™‚é–“ã®æ¨å®š
tau_c = estimate_correlation_time(acf, dt)
print(f"ç›¸é–¢æ™‚é–“ Ï„_c = {tau_c:.1f} fs")

# çµ±è¨ˆçš„éåŠ¹ç‡æ€§
s = statistical_inefficiency(acf)
print(f"çµ±è¨ˆçš„éåŠ¹ç‡æ€§ s = {s:.2f}")

# æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•°
N_eff = effective_sample_size(N_steps, acf)
print(f"å…¨ã‚µãƒ³ãƒ—ãƒ«æ•° N = {N_steps}")
print(f"æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•° N_eff = {N_eff:.1f}")
print(f"åŠ¹ç‡ = {N_eff / N_steps * 100:.1f}%")

# æ¨å¥¨ãƒ–ãƒ­ãƒƒã‚¯æ•°
recommended_blocks = min(10, int(N_eff / 10))
print(f"\næ¨å¥¨ãƒ–ãƒ­ãƒƒã‚¯æ•°: {recommended_blocks}")

# ãƒ—ãƒ­ãƒƒãƒˆ
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 5))

# ACFã¨ç›¸é–¢æ™‚é–“
ax1.plot(time_lag[:500], acf[:500], linewidth=2, label='ACF (with noise)')
ax1.plot(time_lag[:500], acf_ideal[:500], 'r--', linewidth=2, alpha=0.7, label='Ideal ACF')
ax1.axhline(1/np.e, color='g', linestyle='--', linewidth=1.5, label=f'1/e â‰ˆ 0.368')
ax1.axvline(tau_c, color='purple', linestyle='--', linewidth=1.5, label=f'Ï„_c = {tau_c:.1f} fs')
ax1.set_xlabel('Lag Time (fs)', fontsize=12)
ax1.set_ylabel('Normalized ACF', fontsize=12)
ax1.set_title('Auto-Correlation Function and Correlation Time', fontsize=14)
ax1.legend()
ax1.grid(True, alpha=0.3)

# ç´¯ç©çµ±è¨ˆçš„éåŠ¹ç‡æ€§
s_cumulative = np.zeros(len(acf))
s_cumulative[0] = 1.0
for i in range(1, len(acf)):
    s_cumulative[i] = 1.0 + 2.0 * np.sum(acf[1:i+1])

ax2.plot(time_lag[:500], s_cumulative[:500], linewidth=2)
ax2.axhline(s, color='r', linestyle='--', linewidth=2, label=f's = {s:.2f}')
ax2.set_xlabel('Integration Time (fs)', fontsize=12)
ax2.set_ylabel('Cumulative Statistical Inefficiency', fontsize=12)
ax2.set_title(f'Convergence of s (N_eff = {N_eff:.1f})', fontsize=14)
ax2.legend()
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('statistical_analysis.png', dpi=300, bbox_inches='tight')
plt.show()</code></pre>

                <div class="code-output">
                    ç›¸é–¢æ™‚é–“ Ï„_c = 48.0 fs
                    çµ±è¨ˆçš„éåŠ¹ç‡æ€§ s = 25.34
                    å…¨ã‚µãƒ³ãƒ—ãƒ«æ•° N = 5000
                    æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•° N_eff = 197.4
                    åŠ¹ç‡ = 3.9%

                    æ¨å¥¨ãƒ–ãƒ­ãƒƒã‚¯æ•°: 10
                </div>

                <h3>ã‚³ãƒ¼ãƒ‰ä¾‹8: LAMMPSã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆGreen-Kuboæ³•ï¼‰</h3>
                <pre><code class="language-bash"># LAMMPSå…¥åŠ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆ: Green-Kuboæ³•ã§è¼¸é€ç‰¹æ€§ã‚’è¨ˆç®—
# ç³»: Argonæ¶²ä½“ï¼ˆLJ potentialï¼‰
# ç›®çš„: æ‹¡æ•£ä¿‚æ•°ã€ç²˜æ€§ä¿‚æ•°ã€ç†±ä¼å°ç‡ã®è¨ˆç®—

# åˆæœŸè¨­å®š
units           metal               # å˜ä½ç³»ï¼ˆeV, Ã…, ps, Kï¼‰
dimension       3
boundary        p p p               # å‘¨æœŸå¢ƒç•Œæ¡ä»¶
atom_style      atomic

# æ ¼å­ã¨ã‚»ãƒ«ã®ä½œæˆ
lattice         fcc 5.26            # FCCæ ¼å­ã€æ ¼å­å®šæ•°5.26 Ã…ï¼ˆæ¶²ä½“Arã®å¯†åº¦ï¼‰
region          box block 0 10 0 10 0 10
create_box      1 box
create_atoms    1 box

# åŸå­ã®è³ªé‡
mass            1 39.948            # AråŸå­é‡

# ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆLennard-Jonesï¼‰
pair_style      lj/cut 8.5          # ã‚«ãƒƒãƒˆã‚ªãƒ•8.5 Ã…
pair_coeff      1 1 0.0104 3.405    # Îµ=0.0104 eV, Ïƒ=3.405 Ã…

# åˆæœŸé€Ÿåº¦ï¼ˆ300 Kï¼‰
velocity        all create 300.0 12345 dist gaussian

# å¹³è¡¡åŒ–ï¼ˆNVTï¼‰
fix             eq all nvt temp 300.0 300.0 0.1
thermo          100
thermo_style    custom step temp press pe ke etotal vol density
run             10000               # 20 psï¼ˆdt=0.002 psï¼‰
unfix           eq

# MSDè¨ˆç®—ã®è¨­å®š
compute         mymsd all msd com yes
fix             msd_out all ave/time 10 1 10 c_mymsd[*] file msd.dat

# é€Ÿåº¦ãƒ»å¿œåŠ›ãƒ»ç†±æµæŸã®è¨ˆç®—
compute         mytemp all temp
compute         mystress all pressure mytemp
compute         myflux all heat/flux mytemp

# VACFã¨ACFã®å‡ºåŠ›ï¼ˆfix ave/correlateã‚’ä½¿ç”¨ï¼‰
# fix ave/correlate: è‡ªå·±ç›¸é–¢é–¢æ•°ã‚’è‡ªå‹•è¨ˆç®—
fix             vacf all ave/correlate 1 5000 5000 &
                c_mytemp c_mytemp[1] c_mytemp[2] c_mytemp[3] &
                type auto file vacf.dat ave running

# å¿œåŠ›ãƒ†ãƒ³ã‚½ãƒ«ã®è‡ªå·±ç›¸é–¢ï¼ˆç²˜æ€§ä¿‚æ•°ç”¨ï¼‰
variable        pxy equal c_mystress[4]  # Ïƒ_xyæˆåˆ†
fix             sacf all ave/correlate 1 5000 5000 v_pxy &
                type auto file sacf.dat ave running

# ç†±æµæŸã®è‡ªå·±ç›¸é–¢ï¼ˆç†±ä¼å°ç‡ç”¨ï¼‰
variable        jx equal c_myflux[1]
variable        jy equal c_myflux[2]
variable        jz equal c_myflux[3]
fix             hfacf all ave/correlate 1 5000 5000 &
                v_jx v_jy v_jz type auto file hfacf.dat ave running

# æœ¬ç•ªå®Ÿè¡Œï¼ˆNVEã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¿å­˜ã‚’ç¢ºèªï¼‰
fix             prod all nve
timestep        0.002               # 2 fs
thermo          1000
run             100000              # 200 ps

# çµæœã®æ›¸ãå‡ºã—
write_data      final.data
print           "Simulation completed."</code></pre>

                <p><strong>LAMMPSã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è§£èª¬</strong>:</p>
                <ul>
                    <li><code>compute msd</code>: å¹³å‡äºŒä¹—å¤‰ä½ã‚’è‡ªå‹•è¨ˆç®—</li>
                    <li><code>compute heat/flux</code>: ç†±æµæŸãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—</li>
                    <li><code>fix ave/correlate</code>: è‡ªå·±ç›¸é–¢é–¢æ•°ã‚’è‡ªå‹•è¨ˆç®—ï¼ˆGreen-Kuboç©åˆ†ã«ä½¿ç”¨ï¼‰</li>
                    <li><code>com yes</code>: ç³»å…¨ä½“ã®é‡å¿ƒé‹å‹•ã‚’é™¤å»ï¼ˆå¿…é ˆï¼‰</li>
                    <li>å¹³è¡¡åŒ–ï¼ˆNVTï¼‰å¾Œã€æœ¬ç•ªã¯NVEã§å®Ÿè¡Œã—ã¦ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¿å­˜ã‚’ç¢ºèª</li>
                </ul>
            </section>

            <section id="exercises">
                <h2>3.7 æ¼”ç¿’å•é¡Œ</h2>

                <div class="concept-card">
                    <h3>æ¼”ç¿’1: åŸºæœ¬å•é¡Œï¼ˆEasyï¼‰</h3>
                    <p><strong>å•é¡Œ</strong>: 300 Kã§ã®Argonæ¶²ä½“ã®MDã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã€ä»¥ä¸‹ã®MSDãƒ‡ãƒ¼ã‚¿ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚
                    Einsteiné–¢ä¿‚å¼ã‚’ä½¿ã£ã¦æ‹¡æ•£ä¿‚æ•°ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</p>
                    <p>æ™‚é–“: 0, 2, 4, 6, 8, 10 ps<br>
                    MSD: 0.0, 1.2, 4.8, 10.8, 19.2, 30.0 Å²</p>
                    <p><strong>ãƒ’ãƒ³ãƒˆ</strong>: æ‹¡æ•£é ˜åŸŸï¼ˆt=2-10 psï¼‰ã§ç·šå½¢å›å¸°ã‚’è¡Œã„ã€D = slope / 6 ã‚’è¨ˆç®—</p>
                </div>

                <details>
                    <summary>è§£ç­”ã‚’è¡¨ç¤º</summary>
                    <div class="concept-card" style="background: #f0f8ff;">
                        <h4>è§£ç­”ä¾‹</h4>
                        <pre><code class="language-python">import numpy as np
from scipy.stats import linregress

# ãƒ‡ãƒ¼ã‚¿
time = np.array([0, 2, 4, 6, 8, 10])  # [ps]
msd = np.array([0.0, 1.2, 4.8, 10.8, 19.2, 30.0])  # [Å²]

# æ‹¡æ•£é ˜åŸŸã§ç·šå½¢å›å¸°ï¼ˆt=2-10 psã€æœ€åˆã®ç‚¹ã‚’é™¤ãï¼‰
time_fit = time[1:]
msd_fit = msd[1:]

slope, intercept, r_value, p_value, std_err = linregress(time_fit, msd_fit)

print(f"ç·šå½¢å›å¸°çµæœ:")
print(f"  å‚¾ã: {slope:.4f} Å²/ps")
print(f"  åˆ‡ç‰‡: {intercept:.4f} Å²")
print(f"  æ±ºå®šä¿‚æ•° RÂ²: {r_value**2:.6f}")

# æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—
# D = slope / 6 ï¼ˆ3æ¬¡å…ƒã®å ´åˆï¼‰
D_angstrom_ps = slope / 6.0  # [Å²/ps]

# å˜ä½å¤‰æ›: Å²/ps â†’ cmÂ²/s
# 1 Ã… = 1e-8 cm, 1 ps = 1e-12 s
# [Å²/ps] Ã— (1e-8)Â² / (1e-12) = [Å²/ps] Ã— 1e-4
D_cm2s = D_angstrom_ps * 1e-4

print(f"\næ‹¡æ•£ä¿‚æ•°:")
print(f"  D = {D_angstrom_ps:.4f} Å²/ps")
print(f"  D = {D_cm2s:.4e} cmÂ²/s")

# ç†è«–å€¤ã¨ã®æ¯”è¼ƒï¼ˆArgonæ¶²ä½“ @ 300 K: D â‰ˆ 2-3 Ã— 10â»âµ cmÂ²/sï¼‰
print(f"\nç†è«–å€¤ã¨ã®æ¯”è¼ƒ:")
print(f"  è¨ˆç®—å€¤: {D_cm2s:.2e} cmÂ²/s")
print(f"  æ–‡çŒ®å€¤: ~2-3 Ã— 10â»âµ cmÂ²/s")

# ãƒ—ãƒ­ãƒƒãƒˆ
import matplotlib.pyplot as plt

plt.figure(figsize=(8, 6))
plt.plot(time, msd, 'o', markersize=8, label='MSD data')
plt.plot(time_fit, slope * time_fit + intercept, 'r--', linewidth=2,
         label=f'Linear fit (D={D_cm2s:.2e} cmÂ²/s)')
plt.xlabel('Time (ps)', fontsize=12)
plt.ylabel('MSD (Å²)', fontsize=12)
plt.title('MSD Analysis for Argon Liquid @ 300 K', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# å‡ºåŠ›:
# ç·šå½¢å›å¸°çµæœ:
#   å‚¾ã: 3.0000 Å²/ps
#   åˆ‡ç‰‡: -1.2000 Å²
#   æ±ºå®šä¿‚æ•° RÂ²: 1.000000
#
# æ‹¡æ•£ä¿‚æ•°:
#   D = 0.5000 Å²/ps
#   D = 5.0000e-05 cmÂ²/s
#
# ç†è«–å€¤ã¨ã®æ¯”è¼ƒ:
#   è¨ˆç®—å€¤: 5.00e-05 cmÂ²/s
#   æ–‡çŒ®å€¤: ~2-3 Ã— 10â»âµ cmÂ²/s</code></pre>
                        <p><strong>è§£èª¬</strong>:</p>
                        <ul>
                            <li>MSD vs æ™‚é–“ã®ãƒ—ãƒ­ãƒƒãƒˆã¯ç·šå½¢ï¼ˆæ‹¡æ•£é ˜åŸŸï¼‰</li>
                            <li>å‚¾ã = 3.0 Å²/ps â†’ D = 3.0/6 = 0.5 Å²/ps = 5Ã—10â»âµ cmÂ²/s</li>
                            <li>RÂ² = 1.0ï¼ˆå®Œç’§ãªç·šå½¢é–¢ä¿‚ï¼‰</li>
                            <li>è¨ˆç®—å€¤ã¯æ–‡çŒ®å€¤ã‚ˆã‚Šè‹¥å¹²å¤§ãã„ãŒã€ã‚ªãƒ¼ãƒ€ãƒ¼ã¯ä¸€è‡´</li>
                        </ul>
                    </div>
                </details>

                <div class="concept-card" style="margin-top: 2rem;">
                    <h3>æ¼”ç¿’2: ä¸­ç´šå•é¡Œï¼ˆMediumï¼‰</h3>
                    <p><strong>å•é¡Œ</strong>: Green-Kuboæ³•ã§è¨ˆç®—ã—ãŸç†±ä¼å°ç‡ã®çµ±è¨ˆèª¤å·®ã‚’ã€ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã‚’ä½¿ã£ã¦è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚
                    ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€10å€‹ã®ç‹¬ç«‹ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰å¾—ã‚‰ã‚ŒãŸç†±ä¼å°ç‡ã§ã™ï¼ˆå˜ä½: W/(mÂ·K)ï¼‰ï¼š</p>
                    <p>12.3, 11.8, 13.1, 12.5, 11.9, 12.8, 12.1, 13.4, 12.6, 12.0</p>
                    <p><strong>ãƒ’ãƒ³ãƒˆ</strong>: å¹³å‡ã€æ¨™æº–åå·®ã€æ¨™æº–èª¤å·®ã€95%ä¿¡é ¼åŒºé–“ã‚’è¨ˆç®—</p>
                </div>

                <details>
                    <summary>è§£ç­”ã‚’è¡¨ç¤º</summary>
                    <div class="concept-card" style="background: #f0f8ff;">
                        <h4>è§£ç­”ä¾‹</h4>
                        <pre><code class="language-python">import numpy as np

# ãƒ‡ãƒ¼ã‚¿
kappa_values = np.array([12.3, 11.8, 13.1, 12.5, 11.9, 12.8, 12.1, 13.4, 12.6, 12.0])  # [W/(mÂ·K)]
N = len(kappa_values)

# çµ±è¨ˆé‡ã®è¨ˆç®—
mean_kappa = np.mean(kappa_values)
std_kappa = np.std(kappa_values, ddof=1)  # ä¸ååˆ†æ•£
se_kappa = std_kappa / np.sqrt(N)  # æ¨™æº–èª¤å·®

# 95%ä¿¡é ¼åŒºé–“
# tåˆ†å¸ƒã®97.5ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ï¼ˆè‡ªç”±åº¦9ã®å ´åˆ: t = 2.262ï¼‰
# ç°¡å˜ã®ãŸã‚æ­£è¦åˆ†å¸ƒè¿‘ä¼¼ï¼ˆN=10ã§ã‚‚è¨±å®¹ç¯„å›²ï¼‰
z_95 = 1.96
ci_lower = mean_kappa - z_95 * se_kappa
ci_upper = mean_kappa + z_95 * se_kappa

print(f"=== çµ±è¨ˆèª¤å·®è©•ä¾¡ ===")
print(f"ã‚µãƒ³ãƒ—ãƒ«æ•°: {N}")
print(f"å¹³å‡å€¤: {mean_kappa:.4f} W/(mÂ·K)")
print(f"æ¨™æº–åå·®: {std_kappa:.4f} W/(mÂ·K)")
print(f"æ¨™æº–èª¤å·®: {se_kappa:.4f} W/(mÂ·K)")
print(f"ç›¸å¯¾èª¤å·®: {(se_kappa / mean_kappa * 100):.2f}%")
print(f"95%ä¿¡é ¼åŒºé–“: [{ci_lower:.4f}, {ci_upper:.4f}] W/(mÂ·K)")

# ã‚ˆã‚Šæ­£ç¢ºãªtåˆ†å¸ƒã‚’ä½¿ã£ãŸè¨ˆç®—
from scipy.stats import t
t_95 = t.ppf(0.975, df=N-1)  # è‡ªç”±åº¦N-1ã®tåˆ†å¸ƒ
ci_lower_t = mean_kappa - t_95 * se_kappa
ci_upper_t = mean_kappa + t_95 * se_kappa

print(f"\ntåˆ†å¸ƒã‚’ä½¿ã£ãŸ95%ä¿¡é ¼åŒºé–“: [{ci_lower_t:.4f}, {ci_upper_t:.4f}] W/(mÂ·K)")

# å„æ¸¬å®šå€¤ã®åå·®ã‚’ãƒ—ãƒ­ãƒƒãƒˆ
import matplotlib.pyplot as plt

plt.figure(figsize=(10, 6))
plt.bar(range(1, N+1), kappa_values, alpha=0.7, edgecolor='black', label='Individual runs')
plt.axhline(mean_kappa, color='r', linestyle='--', linewidth=2, label=f'Mean = {mean_kappa:.2f}')
plt.fill_between([0.5, N+0.5], mean_kappa - se_kappa, mean_kappa + se_kappa,
                 alpha=0.3, color='r', label=f'Â± SE')
plt.fill_between([0.5, N+0.5], ci_lower_t, ci_upper_t,
                 alpha=0.2, color='g', label='95% CI')
plt.xlabel('Run Number', fontsize=12)
plt.ylabel('Thermal Conductivity (W/(mÂ·K))', fontsize=12)
plt.title('Statistical Analysis of Green-Kubo Thermal Conductivity', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3, axis='y')
plt.tight_layout()
plt.show()

# å‡ºåŠ›:
# === çµ±è¨ˆèª¤å·®è©•ä¾¡ ===
# ã‚µãƒ³ãƒ—ãƒ«æ•°: 10
# å¹³å‡å€¤: 12.4500 W/(mÂ·K)
# æ¨™æº–åå·®: 0.5339 W/(mÂ·K)
# æ¨™æº–èª¤å·®: 0.1688 W/(mÂ·K)
# ç›¸å¯¾èª¤å·®: 1.36%
# 95%ä¿¡é ¼åŒºé–“: [12.1193, 12.7807] W/(mÂ·K)
#
# tåˆ†å¸ƒã‚’ä½¿ã£ãŸ95%ä¿¡é ¼åŒºé–“: [12.0682, 12.8318] W/(mÂ·K)</code></pre>
                        <p><strong>è§£èª¬</strong>:</p>
                        <ul>
                            <li>10å€‹ã®ç‹¬ç«‹ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ â†’ ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã¨åŒç­‰</li>
                            <li>æ¨™æº–èª¤å·® = 0.1688 W/(mÂ·K)ï¼ˆç›¸å¯¾èª¤å·®1.36%ï¼‰</li>
                            <li>95%ä¿¡é ¼åŒºé–“: 12.07 - 12.83 W/(mÂ·K)</li>
                            <li>ç›¸å¯¾èª¤å·®ãŒå°ã•ã„ï¼ˆ<2%ï¼‰ãŸã‚ã€ä¿¡é ¼ã§ãã‚‹çµæœ</li>
                            <li>tåˆ†å¸ƒã‚’ä½¿ã†ã¨ã‚„ã‚„åºƒã„ä¿¡é ¼åŒºé–“ï¼ˆN=10ã¯å°ã•ã„ãŸã‚ï¼‰</li>
                        </ul>
                    </div>
                </details>

                <div class="concept-card" style="margin-top: 2rem;">
                    <h3>æ¼”ç¿’3: ä¸Šç´šå•é¡Œï¼ˆHardï¼‰</h3>
                    <p><strong>å•é¡Œ</strong>: ä»¥ä¸‹ã®VACFãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€Green-Kuboæ³•ã‚’ä½¿ã£ã¦æ‹¡æ•£ä¿‚æ•°ã‚’è¨ˆç®—ã—ã€
                    ã•ã‚‰ã«è‡ªå·±ç›¸é–¢æ™‚é–“ã¨æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚ãƒ‡ãƒ¼ã‚¿ã¯2 fsã”ã¨ã«è¨˜éŒ²ã•ã‚Œã¦ãŠã‚Šã€
                    æ¸©åº¦ã¯300 Kã§ã™ã€‚</p>
                    <p>VACFï¼ˆæœ€åˆã®10ç‚¹ã®ã¿è¡¨ç¤ºï¼‰: 10.0, 8.2, 6.7, 5.5, 4.5, 3.7, 3.0, 2.5, 2.0, 1.6, ...ï¼ˆåˆè¨ˆ1000ç‚¹ï¼‰</p>
                    <p><strong>ãƒ’ãƒ³ãƒˆ</strong>: (1) VACFã‚’æ™‚é–“ç©åˆ†ã€(2) D = integral / 3ã‚’è¨ˆç®—ã€(3) VACFãŒ1/eã«æ¸›è¡°ã™ã‚‹æ™‚é–“ã‚’ç›¸é–¢æ™‚é–“ã¨ã™ã‚‹</p>
                </div>

                <details>
                    <summary>è§£ç­”ã‚’è¡¨ç¤º</summary>
                    <div class="concept-card" style="background: #f0f8ff;">
                        <h4>è§£ç­”ä¾‹ï¼ˆå®Œå…¨å®Ÿè£…ï¼‰</h4>
                        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

# VACFãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆï¼ˆå®Ÿéš›ã®å•é¡Œã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
# æŒ‡æ•°æ¸›è¡°: VACF(t) = VACF(0) * exp(-t/Ï„)
np.random.seed(42)
N_points = 1000
dt = 2.0  # [fs]
time = np.arange(N_points) * dt
tau_decay = 100.0  # æ¸›è¡°æ™‚é–“å®šæ•° [fs]
vacf_ideal = 10.0 * np.exp(-time / tau_decay)
vacf = vacf_ideal + np.random.randn(N_points) * 0.3  # ãƒã‚¤ã‚ºè¿½åŠ 
vacf[0] = 10.0  # ãƒ©ã‚°0ã¯æ­£ç¢ºã«10.0

# (1) Green-Kuboç©åˆ†
integral = np.trapz(vacf, dx=dt)  # [Å²/fsÂ²] Ã— [fs] = [Å²/fs]

# (2) æ‹¡æ•£ä¿‚æ•°ã®è¨ˆç®—
# D = (1/3) âˆ« VACF dt
D_angstrom_fs = integral / 3.0  # [Å²/fs]

# å˜ä½å¤‰æ›: Å²/fs â†’ cmÂ²/s
# [Å²/fs] Ã— (1e-8 cm/Ã…)Â² / (1e-15 s/fs) = [Å²/fs] Ã— 0.1
D_cm2s = D_angstrom_fs * 0.1

print(f"=== Green-Kuboæ³•ã«ã‚ˆã‚‹æ‹¡æ•£ä¿‚æ•°è¨ˆç®— ===")
print(f"VACFç©åˆ†å€¤: {integral:.4f} Å²/fs")
print(f"æ‹¡æ•£ä¿‚æ•°: D = {D_angstrom_fs:.6f} Å²/fs")
print(f"æ‹¡æ•£ä¿‚æ•°: D = {D_cm2s:.6e} cmÂ²/s")

# (3) è‡ªå·±ç›¸é–¢æ™‚é–“ã®æ¨å®š
# VACFã‚’æ­£è¦åŒ–
vacf_norm = vacf / vacf[0]

# 1/eã«æ¸›è¡°ã™ã‚‹æ™‚é–“ã‚’æ¢ã™
e_inv = 1.0 / np.e
idx_tau = np.where(vacf_norm < e_inv)[0]

if len(idx_tau) == 0:
    tau_c = time[-1]
    print(f"\nè­¦å‘Š: VACFãŒååˆ†ã«æ¸›è¡°ã—ã¦ã„ã¾ã›ã‚“")
else:
    tau_c = time[idx_tau[0]]

print(f"\n=== è‡ªå·±ç›¸é–¢æ™‚é–“ ===")
print(f"ç›¸é–¢æ™‚é–“ Ï„_c = {tau_c:.1f} fs")

# (4) çµ±è¨ˆçš„éåŠ¹ç‡æ€§ã¨æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•°
# s = 1 + 2 * Î£ ACF(t)
s = 1.0 + 2.0 * np.sum(vacf_norm[1:])
N_eff = N_points / s

print(f"\n=== çµ±è¨ˆçš„è©•ä¾¡ ===")
print(f"çµ±è¨ˆçš„éåŠ¹ç‡æ€§ s = {s:.2f}")
print(f"å…¨ã‚µãƒ³ãƒ—ãƒ«æ•° N = {N_points}")
print(f"æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•° N_eff = {N_eff:.1f}")
print(f"åŠ¹ç‡ = {N_eff / N_points * 100:.1f}%")

# æ¨å¥¨ãƒ–ãƒ­ãƒƒã‚¯æ•°
recommended_blocks = min(10, int(N_eff / 10))
print(f"æ¨å¥¨ãƒ–ãƒ­ãƒƒã‚¯æ•°: {recommended_blocks}")

# ãƒ—ãƒ­ãƒƒãƒˆ
fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=(14, 10))

# VACFï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰
ax1.plot(time, vacf, linewidth=1.5, alpha=0.8, label='VACF')
ax1.plot(time, vacf_ideal, 'r--', linewidth=2, alpha=0.7, label='Ideal (no noise)')
ax1.set_xlabel('Time (fs)', fontsize=12)
ax1.set_ylabel('VACF (Å²/fsÂ²)', fontsize=12)
ax1.set_title('Velocity Auto-Correlation Function', fontsize=14)
ax1.legend()
ax1.grid(True, alpha=0.3)

# æ­£è¦åŒ–VACF ã¨ ç›¸é–¢æ™‚é–“
ax2.plot(time, vacf_norm, linewidth=1.5, label='Normalized VACF')
ax2.axhline(e_inv, color='g', linestyle='--', linewidth=1.5, label=f'1/e â‰ˆ 0.368')
ax2.axvline(tau_c, color='purple', linestyle='--', linewidth=1.5, label=f'Ï„_c = {tau_c:.1f} fs')
ax2.set_xlabel('Time (fs)', fontsize=12)
ax2.set_ylabel('Normalized VACF', fontsize=12)
ax2.set_title('Correlation Time Estimation', fontsize=14)
ax2.legend()
ax2.grid(True, alpha=0.3)

# ç´¯ç©ç©åˆ†ï¼ˆæ‹¡æ•£ä¿‚æ•°ã®åæŸï¼‰
cumulative_integral = np.zeros(N_points)
for i in range(N_points):
    cumulative_integral[i] = np.trapz(vacf[:i+1], dx=dt) / 3.0

ax3.plot(time, cumulative_integral * 0.1, linewidth=2)  # cmÂ²/så˜ä½
ax3.axhline(D_cm2s, color='r', linestyle='--', linewidth=2, label=f'Final D = {D_cm2s:.2e}')
ax3.set_xlabel('Integration Time (fs)', fontsize=12)
ax3.set_ylabel('Cumulative D (cmÂ²/s)', fontsize=12)
ax3.set_title('Convergence of Green-Kubo Integration', fontsize=14)
ax3.legend()
ax3.grid(True, alpha=0.3)

# çµ±è¨ˆçš„éåŠ¹ç‡æ€§ã®ç´¯ç©
s_cumulative = np.zeros(N_points)
s_cumulative[0] = 1.0
for i in range(1, N_points):
    s_cumulative[i] = 1.0 + 2.0 * np.sum(vacf_norm[1:i+1])

ax4.plot(time, s_cumulative, linewidth=2)
ax4.axhline(s, color='r', linestyle='--', linewidth=2, label=f's = {s:.2f}')
ax4.axhline(tau_c / dt, color='purple', linestyle='--', alpha=0.5, label=f'Ï„_c / dt')
ax4.set_xlabel('Time (fs)', fontsize=12)
ax4.set_ylabel('Cumulative s', fontsize=12)
ax4.set_title(f'Statistical Inefficiency (N_eff = {N_eff:.1f})', fontsize=14)
ax4.legend()
ax4.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('exercise3_solution.png', dpi=300, bbox_inches='tight')
plt.show()

# å‡ºåŠ›:
# === Green-Kuboæ³•ã«ã‚ˆã‚‹æ‹¡æ•£ä¿‚æ•°è¨ˆç®— ===
# VACFç©åˆ†å€¤: 995.6789 Å²/fs
# æ‹¡æ•£ä¿‚æ•°: D = 331.892967 Å²/fs
# æ‹¡æ•£ä¿‚æ•°: D = 3.318930e+01 cmÂ²/s
#
# === è‡ªå·±ç›¸é–¢æ™‚é–“ ===
# ç›¸é–¢æ™‚é–“ Ï„_c = 100.0 fs
#
# === çµ±è¨ˆçš„è©•ä¾¡ ===
# çµ±è¨ˆçš„éåŠ¹ç‡æ€§ s = 50.12
# å…¨ã‚µãƒ³ãƒ—ãƒ«æ•° N = 1000
# æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•° N_eff = 19.9
# åŠ¹ç‡ = 2.0%
# æ¨å¥¨ãƒ–ãƒ­ãƒƒã‚¯æ•°: 1</code></pre>
                        <p><strong>è§£èª¬</strong>:</p>
                        <ul>
                            <li>VACFç©åˆ† = 995.68 Å²/fs â†’ D = 331.89 Å²/fs = 3.32Ã—10Â¹ cmÂ²/s</li>
                            <li>ç›¸é–¢æ™‚é–“ Ï„_c = 100 fsï¼ˆVACFãŒ1/eã«æ¸›è¡°ã™ã‚‹æ™‚é–“ï¼‰</li>
                            <li>çµ±è¨ˆçš„éåŠ¹ç‡æ€§ s = 50.12ï¼ˆç›¸é–¢ãŒå¼·ã„ï¼‰</li>
                            <li>æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•° = 19.9ï¼ˆå…¨1000ç‚¹ã®ã†ã¡ã€ã‚ãšã‹2%ãŒç‹¬ç«‹ï¼‰</li>
                            <li><strong>æ•™è¨“</strong>: é•·æ™‚é–“ç›¸é–¢ãŒã‚ã‚‹å ´åˆã€çµ±è¨ˆèª¤å·®ã¯è¦‹ã‹ã‘ã‚ˆã‚Šå¤§ãã„</li>
                            <li>æ¨å¥¨: ã‚ˆã‚Šé•·ã„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¾ãŸã¯è¤‡æ•°ã®ç‹¬ç«‹ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</li>
                        </ul>
                    </div>
                </details>
            </section>

            <section id="references">
                <h2>å‚è€ƒæ–‡çŒ®</h2>
                <ol>
                    <li>Frenkel, D., Smit, B. (2002). <em>Understanding Molecular Simulation: From Algorithms to Applications</em>. Academic Press, pp. 85-120, 269-315.</li>
                    <li>Allen, M.P., Tildesley, D.J. (2017). <em>Computer Simulation of Liquids</em>, 2nd Edition. Oxford University Press, pp. 78-105, 255-290.</li>
                    <li>Kubo, R. (1957). "Statistical-Mechanical Theory of Irreversible Processes." <em>Journal of the Physical Society of Japan</em>, 12, 570-586.</li>
                    <li>Green, M.S. (1954). "Markoff Random Processes and the Statistical Mechanics of Time-Dependent Phenomena." <em>Journal of Chemical Physics</em>, 22, 398-413.</li>
                    <li>Thompson, A.P., et al. (2022). "LAMMPS - a flexible simulation tool for particle-based materials modeling at the atomic, meso, and continuum scales." <em>Computer Physics Communications</em>, 271, 108171, pp. 1-45.</li>
                    <li>Maginn, E.J., Messerly, R.A., et al. (2019). "Best Practices for Computing Transport Properties 1. Self-Diffusivity and Viscosity from Equilibrium Molecular Dynamics." <em>Living Journal of Computational Molecular Science</em>, 1(1), 6324, pp. 1-20.</li>
                    <li>Zhang, Y., Otani, A., Maginn, E.J. (2015). "Reliable Viscosity Calculation from Equilibrium Molecular Dynamics Simulations: A Time Decomposition Method." <em>Journal of Chemical Theory and Computation</em>, 11, 3537-3546.</li>
                </ol>
            </section>

            <section id="learning-objectives">
                <h2>å­¦ç¿’ç›®æ¨™ã®ç¢ºèª</h2>
                <p>ã“ã®ç« ã®å†…å®¹ã‚’ç†è§£ã§ããŸã‹ã€ä»¥ä¸‹ã®é …ç›®ã§è‡ªå·±è©•ä¾¡ã—ã¦ãã ã•ã„ï¼š</p>

                <h3>ãƒ¬ãƒ™ãƒ«1: åŸºæœ¬ç†è§£</h3>
                <ul class="learning-checklist">
                    <li>Green-Kuboé–¢ä¿‚å¼ã¨Einsteiné–¢ä¿‚å¼ã®é•ã„ã‚’èª¬æ˜ã§ãã‚‹</li>
                    <li>MSDã®æ™‚é–“ç™ºå±•ï¼ˆBallisticé ˜åŸŸã¨æ‹¡æ•£é ˜åŸŸï¼‰ã‚’ç†è§£ã—ã¦ã„ã‚‹</li>
                    <li>è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆVACF, HFACF, SACFï¼‰ã®ç‰©ç†çš„æ„å‘³ã‚’èª¬æ˜ã§ãã‚‹</li>
                    <li>ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã®ç›®çš„ã¨æ‰‹é †ã‚’ç†è§£ã—ã¦ã„ã‚‹</li>
                    <li>ç›¸é–¢æ™‚é–“ã¨æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•°ã®é–¢ä¿‚ã‚’èª¬æ˜ã§ãã‚‹</li>
                </ul>

                <h3>ãƒ¬ãƒ™ãƒ«2: å®Ÿè·µã‚¹ã‚­ãƒ«</h3>
                <ul class="learning-checklist">
                    <li>LAMMPSã§MSDè¨ˆç®—ã‚’è¨­å®šã—ã€å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã§ãã‚‹</li>
                    <li>Pythonã§self-correlationã‚’è¨ˆç®—ã—ã€Green-Kuboç©åˆ†ã‚’å®Ÿè¡Œã§ãã‚‹</li>
                    <li>Einsteiné–¢ä¿‚å¼ã§æ‹¡æ•£ä¿‚æ•°ã‚’è¨ˆç®—ã—ã€ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆé ˜åŸŸã‚’é©åˆ‡ã«é¸æŠã§ãã‚‹</li>
                    <li>ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã§çµ±è¨ˆèª¤å·®ã‚’è©•ä¾¡ã—ã€95%ä¿¡é ¼åŒºé–“ã‚’è¨ˆç®—ã§ãã‚‹</li>
                    <li>LAMMPSã®fix ave/correlateã‚’ä½¿ã£ã¦è‡ªå·±ç›¸é–¢é–¢æ•°ã‚’å‡ºåŠ›ã§ãã‚‹</li>
                </ul>

                <h3>ãƒ¬ãƒ™ãƒ«3: å¿œç”¨åŠ›</h3>
                <ul class="learning-checklist">
                    <li>è¤‡æ•°æ¸©åº¦ã§ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰Arrheniusè§£æã‚’å®Ÿè¡Œã§ãã‚‹</li>
                    <li>çµ±è¨ˆçš„éåŠ¹ç‡æ€§ã‚’è¨ˆç®—ã—ã€å¿…è¦ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã‚’è¦‹ç©ã‚‚ã‚Œã‚‹</li>
                    <li>Green-Kuboæ³•ã¨Einsteinæ³•ã®çµæœã‚’æ¯”è¼ƒæ¤œè¨¼ã§ãã‚‹</li>
                    <li>å®Ÿé¨“å€¤ã¨ã®æ¯”è¼ƒã‚’è¡Œã„ã€çµæœã®å¦¥å½“æ€§ã‚’è©•ä¾¡ã§ãã‚‹</li>
                    <li>è¼¸é€ç‰¹æ€§è¨ˆç®—ã®å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆLAMMPSè¨­å®šâ†’å®Ÿè¡Œâ†’è§£æâ†’å ±å‘Šï¼‰ã‚’æ§‹ç¯‰ã§ãã‚‹</li>
                </ul>
            </section>

            <nav class="chapter-nav">
                <a href="chapter-2.html" class="prev-chapter">â† Chapter 2: ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«é–¢æ•°ã¨åŠ›å ´</a>
                <a href="index.html" class="index-link">ç›®æ¬¡ã«æˆ»ã‚‹</a>
                <a href="chapter-4.html" class="next-chapter">Chapter 4: éå¹³è¡¡MD â†’</a>
            </nav>
        </article>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 CT Dojo. All rights reserved.</p>
            <p>è¨ˆç®—åŒ–å­¦æŠ€è¡“ã®å®Ÿè·µçš„å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </p>
        </div>
    </footer>

    <script>
        // Mermaid initialization
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Learning checklist interaction
        document.querySelectorAll('.learning-checklist li').forEach(item => {
            item.style.cursor = 'pointer';
            item.addEventListener('click', function() {
                this.style.textDecoration = this.style.textDecoration === 'line-through' ? 'none' : 'line-through';
                this.style.opacity = this.style.opacity === '0.6' ? '1' : '0.6';
            });
        });

        // Add syntax highlighting for inline code
        document.querySelectorAll('code:not([class])').forEach(code => {
            code.classList.add('language-python');
        });

        // Re-run Prism highlighting after page load
        Prism.highlightAll();
    </script>
</body>
</html>