<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第3章: 多元系平衡計算 - CALPHAD法入門 - CT Dojo</title>
    <meta name="description" content="三元系・多元系のCALPHAD計算。Gibbs三角図、等温断面図、Isopleth計算、Tie-line構築、多元系最適化の実践。pycalphadで複雑な合金系を解析。">

    <!-- Prism.js for code highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

    <!-- MathJax for mathematical expressions -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Mermaid for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <style>
        :root {
            --accent-green: #11998e;
            --accent-lime: #38ef7d;
            --primary-dark: #2c3e50;
            --secondary-dark: #34495e;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --bg-light: #ecf0f1;
            --white: #ffffff;
            --code-bg: #2d2d2d;
            --border-light: #bdc3c7;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.8;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        header {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%);
            color: white;
            padding: 3rem 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        nav {
            background: var(--white);
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
        }

        nav a {
            text-decoration: none;
            color: var(--text-dark);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
        }

        nav a:hover {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%);
            color: white;
        }

        main {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        section {
            background: var(--white);
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h2 {
            color: var(--primary-dark);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, var(--accent-green), var(--accent-lime)) 1;
        }

        h3 {
            color: var(--secondary-dark);
            font-size: 1.4rem;
            margin: 2rem 0 1rem;
        }

        h4 {
            color: var(--secondary-dark);
            font-size: 1.2rem;
            margin: 1.5rem 0 1rem;
        }

        p {
            margin-bottom: 1rem;
            line-height: 1.8;
        }

        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: "Consolas", "Monaco", monospace;
            font-size: 0.9em;
            color: #e74c3c;
        }

        pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        pre code {
            background: none;
            color: #f8f8f2;
            padding: 0;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%);
            border-left: 4px solid var(--accent-green);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        .info-box strong {
            color: var(--accent-green);
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .warning-box {
            background: rgba(243, 156, 18, 0.1);
            border-left: 4px solid var(--warning);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        .warning-box strong {
            color: var(--warning);
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .exercise-box {
            background: rgba(39, 174, 96, 0.05);
            border: 2px solid var(--success);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .exercise-box h4 {
            color: var(--success);
            margin-top: 0;
        }

        .difficulty {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .difficulty.easy {
            background: #d4edda;
            color: #155724;
        }

        .difficulty.medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty.hard {
            background: #f8d7da;
            color: #721c24;
        }

        .mermaid {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin: 2rem 0;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        th {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(17, 153, 142, 0.05);
        }

        footer {
            background: var(--primary-dark);
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
        }

        footer a {
            color: var(--accent-green);
            text-decoration: none;
        }

        footer a:hover {
            color: var(--accent-lime);
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }

            nav ul {
                flex-direction: column;
                align-items: center;
            }

            section {
                padding: 1.5rem;
            }

            pre {
                padding: 1rem;
                font-size: 0.85rem;
            }
        }

        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #11998e;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #0e7c74;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="/AI-Knowledge-Notes/knowledge/jp/index.html">AI寺子屋トップ</a><span class="breadcrumb-separator">›</span><a href="/AI-Knowledge-Notes/knowledge/jp/CT/index.html">計算工学</a><span class="breadcrumb-separator">›</span><a href="/AI-Knowledge-Notes/knowledge/jp/CT/calphad-tools-introduction/index.html">CALPHAD法入門</a><span class="breadcrumb-separator">›</span><span class="breadcrumb-current">Chapter 3</span>
        </div>
    </nav>

    <header>
        <h1>第3章: 多元系平衡計算</h1>
        <p>三元系・Gibbs三角図・等温断面図・Isopleth計算・多元系最適化の実践</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">トップ</a></li>
            <li><a href="#intro">概要</a></li>
            <li><a href="#ternary-basics">三元系の基礎</a></li>
            <li><a href="#gibbs-triangle">Gibbs三角図</a></li>
            <li><a href="#isothermal-sections">等温断面図</a></li>
            <li><a href="#isopleth">Isopleth計算</a></li>
            <li><a href="#multicomponent">多元系最適化</a></li>
            <li><a href="#code-examples">コード例</a></li>
            <li><a href="#learning-objectives">学習目標</a></li>
            <li><a href="#exercises">演習問題</a></li>
            <li><a href="#references">参考文献</a></li>
            <li><a href="chapter-2.html">← 第2章</a></li>
        </ul>
    </nav>

    <main>
        <section id="intro">
            <h2>3.1 本章の概要</h2>

            <p>
                実用合金の多くは三元系以上の多元系です。本章では、三元系・四元系・五元系などの多元系平衡計算について学びます。Gibbs三角図の読み方、等温断面図（Isothermal Section）の計算、Isopleth（擬二元系断面）の作成、Tie-line構築、多元系最適化の実践を扱います。具体的にはAl-Cu-Mg系、Ni-Cr-Al系などを例に、pycalphadで複雑な相平衡を計算する手法を習得します。
            </p>

            <div class="info-box">
                <strong>本章の学習目標</strong>
                <ul>
                    <li><strong>レベル1（基本理解）</strong>: Gibbs三角図の読み方、等温断面図とIsolethの違い、Tie-lineの意味、多元系の自由度（Gibbs相律）を説明できる</li>
                    <li><strong>レベル2（実践スキル）</strong>: pycalphadで三元系等温断面図を計算でき、Isopleth（擬二元系）を作成でき、Tie-lineを構築でき、組成経路解析（composition stepping）ができる</li>
                    <li><strong>レベル3（応用力）</strong>: 実合金系（Al-Cu-Mg、Ni-Cr-Al等）の相平衡を予測でき、多元系Property Diagram（密度、熱容量等）を作成でき、合金設計に多元系計算を活用できる</li>
                </ul>
            </div>

            <div class="warning-box">
                <strong>前提知識</strong>
                <p>本章では、第1章・第2章の内容（CALPHAD法の基礎、二元系状態図計算、Gibbs自由エネルギー最小化）、三角図の読み方、Python基礎（NumPy、Matplotlib）を前提とします。</p>
            </div>
        </section>

        <section id="ternary-basics">
            <h2>3.2 三元系の基礎</h2>

            <h3>Gibbs相律と自由度</h3>
            <p>
                多元系の平衡状態を理解するには、Gibbs相律が重要です：
            </p>
            <p style="text-align: center; font-size: 1.1em; margin: 1.5rem 0;">
                \( F = C - P + 2 \)
            </p>
            <ul>
                <li><strong>\(F\)</strong>: 自由度（独立に変化させられる変数の数）</li>
                <li><strong>\(C\)</strong>: 成分数（三元系では\(C = 3\)）</li>
                <li><strong>\(P\)</strong>: 相数（平衡状態で共存する相の数）</li>
                <li><strong>2</strong>: 温度\(T\)と圧力\(P\)の2変数</li>
            </ul>

            <h4>三元系の自由度</h4>
            <table>
                <thead>
                    <tr>
                        <th>条件</th>
                        <th>相数 \(P\)</th>
                        <th>自由度 \(F\)</th>
                        <th>意味</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>一定温度・圧力</td>
                        <td>1</td>
                        <td>\(F = 3 - 1 + 0 = 2\)</td>
                        <td>2成分の組成を自由に選択可能</td>
                    </tr>
                    <tr>
                        <td>一定温度・圧力</td>
                        <td>2</td>
                        <td>\(F = 3 - 2 + 0 = 1\)</td>
                        <td>1成分の組成のみ選択可能（Tie-line上）</td>
                    </tr>
                    <tr>
                        <td>一定温度・圧力</td>
                        <td>3</td>
                        <td>\(F = 3 - 3 + 0 = 0\)</td>
                        <td>組成固定（不変点）</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box">
                <strong>自由度の実用的意味</strong>
                <ul>
                    <li><strong>\(F = 2\)</strong>: 単相領域。組成を自由に変えても相が変わらない</li>
                    <li><strong>\(F = 1\)</strong>: 二相領域。Tie-line上を移動（一方の相組成を決めると他方も決まる）</li>
                    <li><strong>\(F = 0\)</strong>: 三相領域。組成が完全に決定される（三角形の頂点に対応）</li>
                </ul>
            </div>

            <h3>三元系の表示法</h3>
            <p>
                三元系の組成は、Gibbs三角図（正三角形）で表示されます。三角形の3つの頂点が純物質A、B、Cに対応し、辺上が二元系、内部が三元系を表します。
            </p>

            <div class="mermaid">
flowchart TD
    A[三元系平衡計算] --> B[等温断面図<br/>Isothermal Section]
    A --> C[Isopleth<br/>擬二元系断面]
    A --> D[液相面投影図<br/>Liquidus Projection]

    B --> E[一定温度での<br/>相領域マップ]
    C --> F[温度-組成断面<br/>擬二元状態図]
    D --> G[液相線の投影<br/>凝固経路予測]

    style A fill:#d4f1f4
    style B fill:#ffe5cc
    style C fill:#d6f5d6
    style D fill:#ffd6d6
            </div>
        </section>

        <section id="gibbs-triangle">
            <h2>3.3 Gibbs三角図の読み方</h2>

            <h3>三角座標の原理</h3>
            <p>
                Gibbs三角図では、三角形の各頂点から対辺への垂線距離が、その成分の組成（モル分率または重量分率）に比例します。3成分の組成の和は常に1（100%）です：
            </p>
            <p style="text-align: center; font-size: 1.1em; margin: 1.5rem 0;">
                \( x_A + x_B + x_C = 1 \)
            </p>

            <h4>三角座標の読み方</h4>
            <ul>
                <li><strong>頂点</strong>: 純物質（例: 点Aは\(x_A = 1, x_B = 0, x_C = 0\)）</li>
                <li><strong>辺</strong>: 二元系（例: AB辺は\(x_C = 0\)のA-B二元系）</li>
                <li><strong>内部</strong>: 三元系（\(x_A, x_B, x_C > 0\)）</li>
            </ul>

            <div class="info-box">
                <strong>三角図での等組成線</strong>
                <ul>
                    <li><strong>頂点Aからの平行線</strong>: \(x_A\) = 一定の線</li>
                    <li><strong>頂点Bからの平行線</strong>: \(x_B\) = 一定の線</li>
                    <li><strong>頂点Cからの平行線</strong>: \(x_C\) = 一定の線</li>
                </ul>
                <p>これらの線が交わる点が特定組成を表します。</p>
            </div>

            <h3>相領域とTie-line</h3>
            <p>
                等温断面図では、異なる相領域が色分けされます。二相領域では、Tie-line（連結線）が2つの平衡相の組成を結びます。
            </p>

            <h4>Tie-lineの性質</h4>
            <ul>
                <li>Tie-lineの両端が、平衡する2つの相の組成</li>
                <li>全体組成がTie-line上にあれば、2相が共存</li>
                <li>2相の分率は、てこの法則で計算可能</li>
            </ul>

            <p style="text-align: center; font-size: 1.1em; margin: 1.5rem 0;">
                \( f_{\alpha} = \frac{d_{\beta}}{d_{\alpha} + d_{\beta}}, \quad f_{\beta} = \frac{d_{\alpha}}{d_{\alpha} + d_{\beta}} \)
            </p>
            <p>ここで、\(d_{\alpha}\)、\(d_{\beta}\)は全体組成からα相、β相までの距離です。</p>
        </section>

        <section id="isothermal-sections">
            <h2>3.4 等温断面図の計算</h2>

            <h3>等温断面図とは</h3>
            <p>
                等温断面図（Isothermal Section）は、一定温度での三元系の相平衡を示す図です。Gibbs三角図上に、各相領域とTie-lineを描画します。
            </p>

            <h3>等温断面図の作成手順</h3>
            <ol>
                <li><strong>温度を固定</strong>: 例えば1000Kに設定</li>
                <li><strong>組成空間をグリッド化</strong>: 三角形内を均等に分割（例: 50×50点）</li>
                <li><strong>各点で平衡計算</strong>: Gibbs自由エネルギー最小化</li>
                <li><strong>安定相を決定</strong>: 各点で最も安定な相組合せを特定</li>
                <li><strong>相境界を描画</strong>: 隣接点で相が変わる境界線を引く</li>
                <li><strong>Tie-lineを追加</strong>: 二相領域の平衡組成を結ぶ線を描く</li>
            </ol>

            <div class="warning-box">
                <strong>計算コストの注意</strong>
                <p>
                    三元系等温断面図の計算は、組成点数×相数の組合せを全探索するため、計算時間が長くなります。グリッド解像度（例: 30×30 → 50×50）を上げるほど精度が向上しますが、計算時間は2乗で増加します。初期探索では粗いグリッド、精密化では細かいグリッドを使用してください。
                </p>
            </div>

            <h3>代表的な三元系の例</h3>
            <table>
                <thead>
                    <tr>
                        <th>三元系</th>
                        <th>産業応用</th>
                        <th>主要相</th>
                        <th>特徴</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Al-Cu-Mg</strong></td>
                        <td>航空機用Al合金（2000系、7000系）</td>
                        <td>FCC, θ(Al2Cu), S(Al2CuMg)</td>
                        <td>時効硬化相の予測</td>
                    </tr>
                    <tr>
                        <td><strong>Ni-Cr-Al</strong></td>
                        <td>Ni基超合金（タービンブレード）</td>
                        <td>γ(FCC), γ'(Ni3Al), Cr2O3</td>
                        <td>高温耐酸化性</td>
                    </tr>
                    <tr>
                        <td><strong>Fe-Cr-Ni</strong></td>
                        <td>ステンレス鋼（SUS304、316）</td>
                        <td>γ(FCC), α(BCC), σ相</td>
                        <td>耐食性と強度のバランス</td>
                    </tr>
                    <tr>
                        <td><strong>Ti-Al-V</strong></td>
                        <td>Ti合金（Ti-6Al-4V）</td>
                        <td>α(HCP), β(BCC)</td>
                        <td>軽量・高強度</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="isopleth">
            <h2>3.5 Isopleth（擬二元系）計算</h2>

            <h3>Isoplethとは</h3>
            <p>
                Isopleth（アイソプレス）は、三元系の特定の組成比を保ったまま温度を変化させた擬二元系断面図です。例えば、Al-Cu-Mg系で「Cu:Mg = 2:1」を保ちながらAl量を変化させた断面を描きます。
            </p>

            <h3>Isoplethの種類</h3>
            <ul>
                <li><strong>固定比Isopleth</strong>: 2成分の比を固定（例: x_B / x_C = 一定）</li>
                <li><strong>固定量Isopleth</strong>: 1成分の量を固定（例: x_C = 0.1一定）</li>
            </ul>

            <p>固定比Isoplethの組成関係：</p>
            <p style="text-align: center; font-size: 1.1em; margin: 1.5rem 0;">
                \( x_B = k \cdot x_C, \quad x_A = 1 - x_B - x_C = 1 - (1+k)x_C \)
            </p>
            <p>ここで、\(k\)は固定比（例: k=2なら「B:C = 2:1」）です。</p>

            <h3>Isoplethの利点</h3>
            <ul>
                <li>特定の合金組成系列（例: Al-xCu-2Mg系）の相変化を一目で理解</li>
                <li>熱処理温度の選定に有用（相境界温度を直接読み取れる）</li>
                <li>二元系と同じ温度-組成図形式で表示されるため直感的</li>
            </ul>

            <div class="info-box">
                <strong>Isoplethの実用例</strong>
                <p>
                    Al-4wt%Cu-1.5wt%Mg合金（Al 2024合金に近い）の時効析出を予測する場合、Cu:Mg = 4:1.5 ≈ 2.67:1のIsoplethを計算します。これにより、S相（Al2CuMg）とθ相（Al2Cu）の析出温度範囲を特定できます。
                </p>
            </div>
        </section>

        <section id="multicomponent">
            <h2>3.6 多元系最適化とProperty計算</h2>

            <h3>四元系・五元系への拡張</h3>
            <p>
                四元系以上では、Gibbs三角図での可視化が困難になります。代わりに、以下の手法を使用します：
            </p>
            <ul>
                <li><strong>擬三元系断面</strong>: 1成分を固定して三元系として表示</li>
                <li><strong>多次元Property Diagram</strong>: 物性値（密度、熱容量等）を色マップで表示</li>
                <li><strong>組成経路解析</strong>: 特定の組成変化経路に沿った相変化を追跡</li>
            </ul>

            <h3>多元系のGibbs自由エネルギー最小化</h3>
            <p>
                多元系では、成分数\(C\)が増えると、探索すべきGibbs自由エネルギー面が\(C-1\)次元空間になります。pycalphadは、凸包（Convex Hull）アルゴリズムを用いて効率的に最小化します。
            </p>

            <h4>計算の課題と対策</h4>
            <table>
                <thead>
                    <tr>
                        <th>課題</th>
                        <th>原因</th>
                        <th>対策</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>計算時間の増大</td>
                        <td>組合せ爆発（相数×組成点数）</td>
                        <td>並列計算、粗いグリッドでの初期探索</td>
                    </tr>
                    <tr>
                        <td>収束失敗</td>
                        <td>複雑なGibbs自由エネルギー面</td>
                        <td>初期値の工夫、温度ステップを細かく</td>
                    </tr>
                    <tr>
                        <td>準安定相の見落とし</td>
                        <td>局所最小値への落ち込み</td>
                        <td>複数の初期値で計算、全相を探索</td>
                    </tr>
                </tbody>
            </table>

            <h3>多元系Property Diagram</h3>
            <p>
                実用合金設計では、相平衡だけでなく、密度、熱容量、熱伝導率などの物性値も重要です。多元系Property Diagramは、組成-温度空間での物性分布を可視化します。
            </p>
        </section>

        <section id="code-examples">
            <h2>3.7 コード例と実践</h2>

            <h3>コード例1: Gibbs三角図の可視化（組成プロット）</h3>
            <pre><code class="language-python"># ===================================
# Example 1: Gibbs三角図での組成プロット
# ===================================

import numpy as np
import matplotlib.pyplot as plt
from matplotlib.patches import Polygon

# 三角座標から直交座標への変換
def ternary_to_cartesian(x_A, x_B, x_C):
    """
    三角座標(x_A, x_B, x_C)を直交座標(x, y)に変換

    Args:
        x_A, x_B, x_C: 各成分のモル分率（合計=1）

    Returns:
        x, y: 直交座標
    """
    x = 0.5 * (2 * x_B + x_C)
    y = (np.sqrt(3) / 2) * x_C
    return x, y

# Gibbs三角形の描画
fig, ax = plt.subplots(figsize=(10, 10))

# 三角形の頂点
vertices = np.array([[0, 0], [1, 0], [0.5, np.sqrt(3)/2]])
triangle = Polygon(vertices, fill=False, edgecolor='black', linewidth=2)
ax.add_patch(triangle)

# 頂点ラベル
ax.text(-0.05, -0.05, 'A (Al)', fontsize=16, fontweight='bold', ha='right')
ax.text(1.05, -0.05, 'B (Cu)', fontsize=16, fontweight='bold', ha='left')
ax.text(0.5, np.sqrt(3)/2 + 0.05, 'C (Mg)', fontsize=16, fontweight='bold', ha='center')

# 等組成線（10%刻み）
for i in range(1, 10):
    val = i * 0.1
    # x_A = const
    x_vals = [ternary_to_cartesian(val, j*0.01, 1-val-j*0.01)[0]
              for j in range(int((1-val)*100))]
    y_vals = [ternary_to_cartesian(val, j*0.01, 1-val-j*0.01)[1]
              for j in range(int((1-val)*100))]
    ax.plot(x_vals, y_vals, 'gray', alpha=0.3, linewidth=0.5)

    # x_B = const
    x_vals = [ternary_to_cartesian(j*0.01, val, 1-val-j*0.01)[0]
              for j in range(int((1-val)*100))]
    y_vals = [ternary_to_cartesian(j*0.01, val, 1-val-j*0.01)[1]
              for j in range(int((1-val)*100))]
    ax.plot(x_vals, y_vals, 'gray', alpha=0.3, linewidth=0.5)

    # x_C = const
    x_vals = [ternary_to_cartesian(j*0.01, 1-val-j*0.01, val)[0]
              for j in range(int((1-val)*100))]
    y_vals = [ternary_to_cartesian(j*0.01, 1-val-j*0.01, val)[1]
              for j in range(int((1-val)*100))]
    ax.plot(x_vals, y_vals, 'gray', alpha=0.3, linewidth=0.5)

# サンプル組成のプロット
samples = [
    (0.90, 0.05, 0.05, 'Al-5Cu-5Mg'),
    (0.80, 0.15, 0.05, 'Al-15Cu-5Mg'),
    (0.70, 0.20, 0.10, 'Al-20Cu-10Mg'),
]

for x_A, x_B, x_C, label in samples:
    x, y = ternary_to_cartesian(x_A, x_B, x_C)
    ax.scatter(x, y, s=200, c='#e74c3c', edgecolors='black', linewidth=2, zorder=5)
    ax.text(x + 0.03, y + 0.03, label, fontsize=12, fontweight='bold')

ax.set_xlim(-0.1, 1.1)
ax.set_ylim(-0.1, 1.0)
ax.set_aspect('equal')
ax.axis('off')
plt.title('Gibbs Triangle: Al-Cu-Mg System', fontsize=18, fontweight='bold')
plt.tight_layout()
plt.savefig('gibbs_triangle_composition.png', dpi=300)
plt.show()

# 出力: Al-Cu-Mg系のGibbs三角図、サンプル組成をプロット
</code></pre>

            <h3>コード例2: 三元系等温断面図の計算</h3>
            <pre><code class="language-python"># ===================================
# Example 2: Al-Cu-Mg系の等温断面図（1000K）
# ===================================

from pycalphad import Database, equilibrium
import pycalphad.variables as v
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.patches import Polygon

# データベース（三元系対応のTDBが必要）
db = Database('AlCuMg_database.tdb')  # 適切なTDBファイルを使用
comps = ['AL', 'CU', 'MG', 'VA']
phases = ['LIQUID', 'FCC_A1', 'THETA', 'S_PHASE']  # θ: Al2Cu, S: Al2CuMg

# 温度
T_iso = 1000  # K

# 組成グリッド（三角座標）
n_points = 30
compositions = []
for i in range(n_points + 1):
    for j in range(n_points + 1 - i):
        x_Cu = i / n_points
        x_Mg = j / n_points
        x_Al = 1 - x_Cu - x_Mg
        if x_Al >= 0:
            compositions.append((x_Al, x_Cu, x_Mg))

# 平衡計算
results = []
for x_Al, x_Cu, x_Mg in compositions:
    eq = equilibrium(db, comps, phases,
                     {v.T: T_iso, v.P: 101325, v.X('CU'): x_Cu, v.X('MG'): x_Mg})

    # 安定相の特定
    stable_phases = [p for p in phases if (eq.NP.sel(Phase=p).values > 1e-6).any()]
    results.append({
        'x_Al': x_Al, 'x_Cu': x_Cu, 'x_Mg': x_Mg,
        'phases': stable_phases,
        'num_phases': len(stable_phases)
    })

# プロット
fig, ax = plt.subplots(figsize=(12, 12))

# 三角形
vertices = np.array([[0, 0], [1, 0], [0.5, np.sqrt(3)/2]])
triangle = Polygon(vertices, fill=False, edgecolor='black', linewidth=2)
ax.add_patch(triangle)

# 各点をプロット（相数で色分け）
colors_map = {1: '#11998e', 2: '#f39c12', 3: '#e74c3c', 4: '#9b59b6'}
for result in results:
    x, y = ternary_to_cartesian(result['x_Al'], result['x_Cu'], result['x_Mg'])
    color = colors_map.get(result['num_phases'], 'gray')
    ax.scatter(x, y, c=color, s=50, alpha=0.7)

# 頂点ラベル
ax.text(-0.05, -0.05, 'Al', fontsize=18, fontweight='bold', ha='right')
ax.text(1.05, -0.05, 'Cu', fontsize=18, fontweight='bold', ha='left')
ax.text(0.5, np.sqrt(3)/2 + 0.05, 'Mg', fontsize=18, fontweight='bold', ha='center')

# 凡例
from matplotlib.lines import Line2D
legend_elements = [
    Line2D([0], [0], marker='o', color='w', markerfacecolor='#11998e',
           markersize=12, label='1 phase'),
    Line2D([0], [0], marker='o', color='w', markerfacecolor='#f39c12',
           markersize=12, label='2 phases'),
    Line2D([0], [0], marker='o', color='w', markerfacecolor='#e74c3c',
           markersize=12, label='3 phases'),
]
ax.legend(handles=legend_elements, fontsize=14, loc='upper left')

ax.set_xlim(-0.1, 1.1)
ax.set_ylim(-0.1, 1.0)
ax.set_aspect('equal')
ax.axis('off')
plt.title(f'Isothermal Section: Al-Cu-Mg at {T_iso} K', fontsize=18, fontweight='bold')
plt.tight_layout()
plt.savefig('AlCuMg_isothermal_section.png', dpi=300)
plt.show()

# 出力: 1000Kでの等温断面図、単相・二相・三相領域を色分け
</code></pre>

            <h3>コード例3: Isopleth（擬二元系）の計算</h3>
            <pre><code class="language-python"># ===================================
# Example 3: Al-Cu-Mg系のIsopleth（Cu:Mg = 2:1固定）
# ===================================

from pycalphad import Database, equilibrium
import pycalphad.variables as v
import numpy as np
import matplotlib.pyplot as plt

# データベース
db = Database('AlCuMg_database.tdb')
comps = ['AL', 'CU', 'MG', 'VA']
phases = ['LIQUID', 'FCC_A1', 'THETA', 'S_PHASE']

# Cu:Mg = 2:1を保つ組成系列
k = 2  # Cu/Mg比
x_Mg_range = np.linspace(0.01, 0.20, 20)  # Mg: 1-20%
T_range = np.linspace(400, 1000, 100)  # 温度: 400-1000K

# 温度-組成グリッド
phase_map = np.zeros((len(T_range), len(x_Mg_range)))

for i, T in enumerate(T_range):
    for j, x_Mg in enumerate(x_Mg_range):
        x_Cu = k * x_Mg
        x_Al = 1 - x_Cu - x_Mg

        if x_Al < 0 or x_Cu > 1:
            phase_map[i, j] = -1  # 範囲外
            continue

        eq = equilibrium(db, comps, phases,
                         {v.T: T, v.P: 101325, v.X('CU'): x_Cu, v.X('MG'): x_Mg})

        # 安定相の特定
        stable_phases = [p for p in phases if (eq.NP.sel(Phase=p).values > 1e-6).any()]

        # 相の番号を割り当て（簡易マッピング）
        if 'LIQUID' in stable_phases and len(stable_phases) == 1:
            phase_map[i, j] = 1  # 液相
        elif 'FCC_A1' in stable_phases and len(stable_phases) == 1:
            phase_map[i, j] = 2  # FCC単相
        elif len(stable_phases) == 2:
            phase_map[i, j] = 3  # 二相
        else:
            phase_map[i, j] = 4  # 三相以上

# プロット
fig, ax = plt.subplots(figsize=(12, 8))

# 横軸: Al含有量（%）、縦軸: 温度（K）
x_Al_range = (1 - x_Mg_range * (1 + k)) * 100  # Al量をパーセント表示
X, Y = np.meshgrid(x_Al_range, T_range)

# 色分け
cmap = plt.cm.get_cmap('tab10')
contour = ax.contourf(X, Y, phase_map, levels=[-1, 0.5, 1.5, 2.5, 3.5, 4.5],
                       colors=['white', '#e74c3c', '#11998e', '#f39c12', '#9b59b6'],
                       alpha=0.7)

ax.set_xlabel('Al content (wt%)', fontsize=14, fontweight='bold')
ax.set_ylabel('Temperature (K)', fontsize=14, fontweight='bold')
ax.set_title('Isopleth: Al-Cu-Mg (Cu:Mg = 2:1)', fontsize=16, fontweight='bold')

# 凡例
from matplotlib.patches import Patch
legend_elements = [
    Patch(facecolor='#e74c3c', label='Liquid'),
    Patch(facecolor='#11998e', label='FCC'),
    Patch(facecolor='#f39c12', label='Two-phase'),
    Patch(facecolor='#9b59b6', label='Three-phase'),
]
ax.legend(handles=legend_elements, fontsize=12, loc='upper right')

plt.grid(alpha=0.3)
plt.tight_layout()
plt.savefig('AlCuMg_isopleth.png', dpi=300)
plt.show()

# 出力: Cu:Mg=2:1のIsopleth、液相線・固相線・相境界を表示
</code></pre>

            <h3>コード例4: Tie-lineの構築</h3>
            <pre><code class="language-python"># ===================================
# Example 4: 二相領域のTie-line構築
# ===================================

from pycalphad import Database, equilibrium
import pycalphad.variables as v
import numpy as np
import matplotlib.pyplot as plt

# データベース
db = Database('AlCuMg_database.tdb')
comps = ['AL', 'CU', 'MG', 'VA']
phases = ['FCC_A1', 'THETA']  # FCC + θ二相領域

# 温度
T_iso = 800  # K

# 全体組成（FCC+θ二相領域内の点）
overall_compositions = [
    {'x_Cu': 0.15, 'x_Mg': 0.05},
    {'x_Cu': 0.20, 'x_Mg': 0.08},
    {'x_Cu': 0.25, 'x_Mg': 0.10},
]

# Tie-lineの計算
tie_lines = []
for overall_comp in overall_compositions:
    eq = equilibrium(db, comps, phases,
                     {v.T: T_iso, v.P: 101325,
                      v.X('CU'): overall_comp['x_Cu'],
                      v.X('MG'): overall_comp['x_Mg']})

    # 各相の組成
    x_Cu_FCC = eq.X.sel(Phase='FCC_A1', component='CU').values.mean()
    x_Mg_FCC = eq.X.sel(Phase='FCC_A1', component='MG').values.mean()
    x_Cu_THETA = eq.X.sel(Phase='THETA', component='CU').values.mean()
    x_Mg_THETA = eq.X.sel(Phase='THETA', component='MG').values.mean()

    # 相分率
    NP_FCC = eq.NP.sel(Phase='FCC_A1').values.sum()
    NP_THETA = eq.NP.sel(Phase='THETA').values.sum()

    tie_lines.append({
        'overall': (1 - overall_comp['x_Cu'] - overall_comp['x_Mg'],
                    overall_comp['x_Cu'], overall_comp['x_Mg']),
        'FCC': (1 - x_Cu_FCC - x_Mg_FCC, x_Cu_FCC, x_Mg_FCC),
        'THETA': (1 - x_Cu_THETA - x_Mg_THETA, x_Cu_THETA, x_Mg_THETA),
        'NP_FCC': NP_FCC,
        'NP_THETA': NP_THETA
    })

# プロット
fig, ax = plt.subplots(figsize=(12, 12))

# 三角形
vertices = np.array([[0, 0], [1, 0], [0.5, np.sqrt(3)/2]])
triangle = Polygon(vertices, fill=False, edgecolor='black', linewidth=2)
ax.add_patch(triangle)

# Tie-lineのプロット
for tl in tie_lines:
    # FCC相の組成
    x_FCC, y_FCC = ternary_to_cartesian(*tl['FCC'])
    # θ相の組成
    x_THETA, y_THETA = ternary_to_cartesian(*tl['THETA'])
    # 全体組成
    x_overall, y_overall = ternary_to_cartesian(*tl['overall'])

    # Tie-line
    ax.plot([x_FCC, x_THETA], [y_FCC, y_THETA], 'b-', linewidth=2, alpha=0.7)

    # 相組成点
    ax.scatter(x_FCC, y_FCC, s=200, c='#11998e', edgecolors='black',
               linewidth=2, zorder=5, label='FCC' if tl == tie_lines[0] else '')
    ax.scatter(x_THETA, y_THETA, s=200, c='#e74c3c', edgecolors='black',
               linewidth=2, zorder=5, label='θ (Al2Cu)' if tl == tie_lines[0] else '')

    # 全体組成点
    ax.scatter(x_overall, y_overall, s=150, c='#f39c12', marker='D',
               edgecolors='black', linewidth=2, zorder=5)

    # てこの法則の表示
    total_NP = tl['NP_FCC'] + tl['NP_THETA']
    f_FCC = tl['NP_FCC'] / total_NP
    f_THETA = tl['NP_THETA'] / total_NP
    ax.text(x_overall + 0.02, y_overall + 0.02,
            f'FCC: {f_FCC:.2f}\nθ: {f_THETA:.2f}',
            fontsize=10, bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))

# 頂点ラベル
ax.text(-0.05, -0.05, 'Al', fontsize=18, fontweight='bold', ha='right')
ax.text(1.05, -0.05, 'Cu', fontsize=18, fontweight='bold', ha='left')
ax.text(0.5, np.sqrt(3)/2 + 0.05, 'Mg', fontsize=18, fontweight='bold', ha='center')

ax.legend(fontsize=14, loc='upper left')
ax.set_xlim(-0.1, 1.1)
ax.set_ylim(-0.1, 1.0)
ax.set_aspect('equal')
ax.axis('off')
plt.title(f'Tie-lines in FCC+θ Two-phase Region at {T_iso} K',
          fontsize=18, fontweight='bold')
plt.tight_layout()
plt.savefig('AlCuMg_tie_lines.png', dpi=300)
plt.show()

# 出力: FCC+θ二相領域のTie-line、相分率をてこの法則で表示
</code></pre>

            <h3>コード例5: 組成経路解析（Composition Stepping）</h3>
            <pre><code class="language-python"># ===================================
# Example 5: 組成経路に沿った相変化の追跡
# ===================================

from pycalphad import Database, equilibrium
import pycalphad.variables as v
import numpy as np
import matplotlib.pyplot as plt

# データベース
db = Database('AlCuMg_database.tdb')
comps = ['AL', 'CU', 'MG', 'VA']
phases = ['LIQUID', 'FCC_A1', 'THETA', 'S_PHASE']

# 温度
T_iso = 900  # K

# 組成経路: Al-15Cu-xMg（Mg量を0-20%に変化）
x_Cu_fixed = 0.15
x_Mg_range = np.linspace(0, 0.20, 50)

# 相分率の追跡
phase_fractions = {phase: [] for phase in phases}
for x_Mg in x_Mg_range:
    x_Al = 1 - x_Cu_fixed - x_Mg
    if x_Al < 0:
        for phase in phases:
            phase_fractions[phase].append(0)
        continue

    eq = equilibrium(db, comps, phases,
                     {v.T: T_iso, v.P: 101325, v.X('CU'): x_Cu_fixed, v.X('MG'): x_Mg})

    for phase in phases:
        if phase in eq.Phase.values:
            NP = eq.NP.sel(Phase=phase).values.sum()
            phase_fractions[phase].append(NP)
        else:
            phase_fractions[phase].append(0)

# プロット
fig, ax = plt.subplots(figsize=(12, 7))

for phase, fractions in phase_fractions.items():
    if max(fractions) > 1e-6:
        ax.plot(x_Mg_range * 100, fractions, linewidth=2.5, label=phase)

ax.set_xlabel('Mg content (at%)', fontsize=14, fontweight='bold')
ax.set_ylabel('Phase Fraction', fontsize=14, fontweight='bold')
ax.set_title(f'Composition Stepping: Al-15Cu-xMg at {T_iso} K',
             fontsize=16, fontweight='bold')
ax.legend(fontsize=12)
ax.grid(alpha=0.3)
ax.set_xlim(0, 20)
ax.set_ylim(0, 1.0)
plt.tight_layout()
plt.savefig('AlCuMg_composition_stepping.png', dpi=300)
plt.show()

# 出力: Mg量増加に伴う相分率の変化（相変化の追跡）
</code></pre>

            <h3>コード例6: 多元系Property Diagram（密度計算）</h3>
            <pre><code class="language-python"># ===================================
# Example 6: Al-Cu-Mg系の密度マップ（等温断面）
# ===================================

from pycalphad import Database, equilibrium
import pycalphad.variables as v
import numpy as np
import matplotlib.pyplot as plt

# データベース
db = Database('AlCuMg_database.tdb')
comps = ['AL', 'CU', 'MG', 'VA']
phases = ['FCC_A1', 'THETA', 'S_PHASE']

# 温度
T_iso = 800  # K

# 純物質の密度（g/cm³）
density_pure = {'AL': 2.70, 'CU': 8.96, 'MG': 1.74}

# 組成グリッド
n_points = 20
densities = []
compositions_plot = []

for i in range(n_points + 1):
    for j in range(n_points + 1 - i):
        x_Cu = i / n_points
        x_Mg = j / n_points
        x_Al = 1 - x_Cu - x_Mg

        if x_Al < 0:
            continue

        eq = equilibrium(db, comps, phases,
                         {v.T: T_iso, v.P: 101325, v.X('CU'): x_Cu, v.X('MG'): x_Mg})

        # 密度の計算（線形混合則による近似）
        rho = (x_Al * density_pure['AL'] +
               x_Cu * density_pure['CU'] +
               x_Mg * density_pure['MG'])

        densities.append(rho)
        compositions_plot.append((x_Al, x_Cu, x_Mg))

# プロット
fig, ax = plt.subplots(figsize=(12, 12))

# 三角形
vertices = np.array([[0, 0], [1, 0], [0.5, np.sqrt(3)/2]])
triangle = Polygon(vertices, fill=False, edgecolor='black', linewidth=2)
ax.add_patch(triangle)

# 密度を色で表示
x_cart = [ternary_to_cartesian(comp[0], comp[1], comp[2])[0] for comp in compositions_plot]
y_cart = [ternary_to_cartesian(comp[0], comp[1], comp[2])[1] for comp in compositions_plot]

scatter = ax.scatter(x_cart, y_cart, c=densities, s=100, cmap='viridis',
                     vmin=min(densities), vmax=max(densities), alpha=0.8)

# カラーバー
cbar = plt.colorbar(scatter, ax=ax, label='Density (g/cm³)', pad=0.1)
cbar.ax.tick_params(labelsize=12)

# 頂点ラベル
ax.text(-0.05, -0.05, 'Al\n(2.70 g/cm³)', fontsize=14, fontweight='bold', ha='right')
ax.text(1.05, -0.05, 'Cu\n(8.96 g/cm³)', fontsize=14, fontweight='bold', ha='left')
ax.text(0.5, np.sqrt(3)/2 + 0.05, 'Mg\n(1.74 g/cm³)', fontsize=14, fontweight='bold', ha='center')

ax.set_xlim(-0.1, 1.1)
ax.set_ylim(-0.1, 1.0)
ax.set_aspect('equal')
ax.axis('off')
plt.title(f'Property Diagram: Density of Al-Cu-Mg at {T_iso} K',
          fontsize=18, fontweight='bold')
plt.tight_layout()
plt.savefig('AlCuMg_density_map.png', dpi=300)
plt.show()

# 出力: 密度の組成依存性、Cu添加で密度増加を可視化
</code></pre>
        </section>

        <section id="learning-objectives">
            <h2>3.8 学習目標の確認</h2>

            <p>このchapterを完了すると、以下を説明できるようになります：</p>

            <h3>基本理解</h3>
            <ul>
                <li>✅ Gibbs相律による三元系の自由度（\(F = C - P + 2\)）を計算できる</li>
                <li>✅ Gibbs三角図の読み方（頂点、辺、内部の意味）を理解できる</li>
                <li>✅ 等温断面図とIsoplethの違いと用途を説明できる</li>
                <li>✅ Tie-lineの意味とてこの法則による相分率計算を理解できる</li>
                <li>✅ 多元系計算の課題（計算時間、収束失敗等）を説明できる</li>
            </ul>

            <h3>実践スキル</h3>
            <ul>
                <li>✅ pycalphadでAl-Cu-Mg系の等温断面図を計算できる</li>
                <li>✅ Isopleth（Cu:Mg = 一定）を作成し、相境界を読み取れる</li>
                <li>✅ Tie-lineを構築し、二相領域の平衡組成を決定できる</li>
                <li>✅ 組成経路解析（composition stepping）で相変化を追跡できる</li>
                <li>✅ 多元系Property Diagram（密度、熱容量）を可視化できる</li>
            </ul>

            <h3>応用力</h3>
            <ul>
                <li>✅ 実合金系（Al-Cu-Mg、Ni-Cr-Al等）の相平衡を定量的に予測できる</li>
                <li>✅ 熱処理条件（温度、組成）の最適化に等温断面図を活用できる</li>
                <li>✅ Isoplethから析出相の温度範囲を読み取り、時効処理を設計できる</li>
                <li>✅ 多元系計算結果を実験データ（XRD、SEM/EDS）と比較検証できる</li>
            </ul>
        </section>

        <section id="exercises">
            <h2>3.9 演習問題</h2>

            <h3>Easy（基礎確認）</h3>

            <div class="exercise-box">
                <h4>Easy 1: Gibbs相律の計算 <span class="difficulty easy">基礎</span></h4>
                <p><strong>問題</strong>: 三元系（C=3）において、一定温度・圧力の下で3つの相（α、β、γ）が共存する場合、自由度\(F\)を計算しなさい。また、この状態が三角図上でどのように表現されるか説明してください。</p>
                <details>
                    <summary>解答を見る</summary>
                    <p><strong>計算</strong>:</p>
                    <p style="text-align: center; font-size: 1.1em; margin: 1rem 0;">
                        \( F = C - P + 2 - 2 = 3 - 3 + 0 = 0 \)
                    </p>
                    <p>（一定温度・圧力なので、2を引く）</p>
                    <p><strong>解釈</strong>:</p>
                    <ul>
                        <li>自由度\(F = 0\)は、組成が完全に決定されることを意味します（不変点）</li>
                        <li>三角図上では、3つの相領域が接する<strong>1点</strong>として表現されます</li>
                        <li>この点を<strong>三相点（triple point）</strong>または<strong>不変点（invariant point）</strong>と呼びます</li>
                        <li>例: Al-Cu-Mg系の共晶点（液相+FCC+θ相が共存）</li>
                    </ul>
                </details>
            </div>

            <div class="exercise-box">
                <h4>Easy 2: Gibbs三角図の組成読み取り <span class="difficulty easy">基礎</span></h4>
                <p><strong>問題</strong>: Al-Cu-Mg系のGibbs三角図上で、ある点が「Al頂点から30%、Cu頂点から50%、Mg頂点から20%の距離」にあるとします。この点の組成（x_Al, x_Cu, x_Mg）を求めなさい。</p>
                <details>
                    <summary>解答を見る</summary>
                    <p><strong>解答</strong>:</p>
                    <p>
                        Gibbs三角図では、各頂点からの垂線距離が組成に対応します。ただし、表現が「距離」の場合は、対辺からの距離を指すことが一般的です。
                    </p>
                    <p><strong>正しい解釈</strong>:</p>
                    <ul>
                        <li>Al頂点から対辺への距離30% → x_Al = 30% = 0.30</li>
                        <li>Cu頂点から対辺への距離50% → x_Cu = 50% = 0.50</li>
                        <li>Mg頂点から対辺への距離20% → x_Mg = 20% = 0.20</li>
                    </ul>
                    <p>検算: \(x_{\text{Al}} + x_{\text{Cu}} + x_{\text{Mg}} = 0.30 + 0.50 + 0.20 = 1.00\) ✅</p>
                    <p><strong>組成</strong>: Al: 30 at%, Cu: 50 at%, Mg: 20 at%</p>
                </details>
            </div>

            <div class="exercise-box">
                <h4>Easy 3: Tie-lineとてこの法則 <span class="difficulty easy">基礎</span></h4>
                <p><strong>問題</strong>: Al-Cu-Mg系のFCC+θ二相領域で、全体組成が「Al: 80%, Cu: 15%, Mg: 5%」であるとします。平衡計算の結果、FCC相の組成が「Al: 85%, Cu: 10%, Mg: 5%」、θ相の組成が「Al: 60%, Cu: 35%, Mg: 5%」でした。てこの法則を用いて、FCC相とθ相の分率を計算しなさい。</p>
                <details>
                    <summary>解答を見る</summary>
                    <p><strong>計算</strong>:</p>
                    <p>
                        Tie-line上で、全体組成は2つの相組成の線形結合として表されます：
                    </p>
                    <p style="text-align: center; font-size: 1.1em; margin: 1rem 0;">
                        \( x_{\text{overall}} = f_{\text{FCC}} \cdot x_{\text{FCC}} + f_{\theta} \cdot x_{\theta} \)
                    </p>
                    <p>Cu組成に注目すると：</p>
                    <p style="text-align: center; font-size: 1.1em; margin: 1rem 0;">
                        \( 0.15 = f_{\text{FCC}} \times 0.10 + f_{\theta} \times 0.35 \)
                    </p>
                    <p>また、\(f_{\text{FCC}} + f_{\theta} = 1\)なので、\(f_{\theta} = 1 - f_{\text{FCC}}\)</p>
                    <p>代入して：</p>
                    <p style="text-align: center; font-size: 1.1em; margin: 1rem 0;">
                        \( 0.15 = f_{\text{FCC}} \times 0.10 + (1 - f_{\text{FCC}}) \times 0.35 \)<br>
                        \( 0.15 = 0.10 f_{\text{FCC}} + 0.35 - 0.35 f_{\text{FCC}} \)<br>
                        \( 0.15 - 0.35 = -0.25 f_{\text{FCC}} \)<br>
                        \( -0.20 = -0.25 f_{\text{FCC}} \)<br>
                        \( f_{\text{FCC}} = 0.80 \)
                    </p>
                    <p>したがって、\(f_{\theta} = 1 - 0.80 = 0.20\)</p>
                    <p><strong>結果</strong>:</p>
                    <ul>
                        <li>FCC相の分率: <strong>80%</strong></li>
                        <li>θ相の分率: <strong>20%</strong></li>
                    </ul>
                </details>
            </div>

            <h3>Medium（応用）</h3>

            <div class="exercise-box">
                <h4>Medium 1: 等温断面図の解釈 <span class="difficulty medium">応用</span></h4>
                <p><strong>問題</strong>: Al-Cu-Mg系の800Kにおける等温断面図（仮想）で、次の相領域が確認されました：<br>
                (1) 単相FCC領域（Al-rich側）<br>
                (2) FCC+θ二相領域<br>
                (3) FCC+S二相領域<br>
                (4) FCC+θ+S三相領域<br>
                この情報から、Al-10Cu-5Mg合金（at%）を800Kで熱処理した場合、どの相が析出するか予測しなさい。また、組成を微調整して単相FCC組織を得るにはどうすればよいか提案してください。</p>
                <details>
                    <summary>解答を見る</summary>
                    <p><strong>解答</strong>（約65行のコード含む）:</p>
                    <p><strong>相の予測</strong>:</p>
                    <p>
                        Al-10Cu-5Mg合金の組成（x_Al = 0.85, x_Cu = 0.10, x_Mg = 0.05）は、等温断面図上でどの領域に位置するかによります。
                    </p>
                    <ul>
                        <li><strong>領域(1)</strong>にある場合: 単相FCC（析出なし）</li>
                        <li><strong>領域(2)</strong>にある場合: FCC + θ相（Al2Cu）が析出</li>
                        <li><strong>領域(3)</strong>にある場合: FCC + S相（Al2CuMg）が析出</li>
                        <li><strong>領域(4)</strong>にある場合: FCC + θ + S相が共存</li>
                    </ul>
                    <p><strong>実際の計算例</strong>（pycalphadで確認）:</p>
                    <pre><code class="language-python">from pycalphad import Database, equilibrium
import pycalphad.variables as v

db = Database('AlCuMg_database.tdb')
comps = ['AL', 'CU', 'MG', 'VA']
phases = ['FCC_A1', 'THETA', 'S_PHASE']

eq = equilibrium(db, comps, phases,
                 {v.T: 800, v.P: 101325, v.X('CU'): 0.10, v.X('MG'): 0.05})

# 安定相の確認
stable_phases = [p for p in phases if (eq.NP.sel(Phase=p).values > 1e-6).any()]
print(f"Stable phases: {stable_phases}")

# 出力例: Stable phases: ['FCC_A1', 'THETA']
# → FCC + θ二相領域に位置、θ相が析出
</code></pre>
                    <p><strong>単相FCC組織を得るための組成調整</strong>:</p>
                    <ol>
                        <li><strong>Cu量を減らす</strong>: 10 at% → 5 at%（θ相の析出を抑制）</li>
                        <li><strong>Mg量を減らす</strong>: 5 at% → 2 at%（S相の析出を抑制）</li>
                        <li><strong>温度を上げる</strong>: 800K → 900K（固溶限が拡大、析出相が溶解）</li>
                    </ol>
                    <p><strong>推奨組成</strong>: Al-5Cu-2Mg（at%）を900Kで溶体化処理後、急冷して過飽和固溶体を得る。</p>
                </details>
            </div>

            <div class="exercise-box">
                <h4>Medium 2: Isoplethの作成と活用 <span class="difficulty medium">応用</span></h4>
                <p><strong>問題</strong>: Al-Cu-Mg系で、Cu:Mg = 3:1の比を保ちながらAl量を変化させたIsoplethを作成するコードを実装しなさい（温度範囲: 500-1000K、Mg量: 0-15at%）。また、計算結果から、Al-12Cu-4Mg合金の固相線温度を読み取ってください。</p>
                <details>
                    <summary>解答を見る</summary>
                    <p><strong>解答コード</strong>（約70行）:</p>
                    <pre><code class="language-python">from pycalphad import Database, equilibrium
import pycalphad.variables as v
import numpy as np
import matplotlib.pyplot as plt

# データベース
db = Database('AlCuMg_database.tdb')
comps = ['AL', 'CU', 'MG', 'VA']
phases = ['LIQUID', 'FCC_A1', 'THETA', 'S_PHASE']

# Cu:Mg = 3:1
k = 3
x_Mg_range = np.linspace(0.01, 0.15, 30)
T_range = np.linspace(500, 1000, 100)

# 液相分率マップ
liquid_fraction = np.zeros((len(T_range), len(x_Mg_range)))

for i, T in enumerate(T_range):
    for j, x_Mg in enumerate(x_Mg_range):
        x_Cu = k * x_Mg
        x_Al = 1 - x_Cu - x_Mg

        if x_Al < 0 or x_Cu > 1:
            liquid_fraction[i, j] = -1
            continue

        eq = equilibrium(db, comps, phases,
                         {v.T: T, v.P: 101325, v.X('CU'): x_Cu, v.X('MG'): x_Mg})

        if 'LIQUID' in eq.Phase.values:
            NP_liquid = eq.NP.sel(Phase='LIQUID').values.sum()
            liquid_fraction[i, j] = NP_liquid
        else:
            liquid_fraction[i, j] = 0

# プロット
fig, ax = plt.subplots(figsize=(12, 8))

X, Y = np.meshgrid(x_Mg_range * 100, T_range)
contour = ax.contourf(X, Y, liquid_fraction, levels=20, cmap='RdYlBu_r', alpha=0.8)
cbar = plt.colorbar(contour, ax=ax, label='Liquid Fraction')

# 液相線・固相線の抽出
liquidus_temps = []
solidus_temps = []
for j, x_Mg in enumerate(x_Mg_range):
    # 液相線（液相分率=1 → <1への境界）
    for i in range(len(T_range) - 1):
        if liquid_fraction[i, j] == 1 and liquid_fraction[i+1, j] < 1:
            liquidus_temps.append((x_Mg * 100, T_range[i]))
            break

    # 固相線（液相分率>0 → 0への境界）
    for i in range(len(T_range) - 1, 0, -1):
        if liquid_fraction[i, j] > 0 and liquid_fraction[i-1, j] == 0:
            solidus_temps.append((x_Mg * 100, T_range[i]))
            break

if liquidus_temps:
    ax.plot([x for x, _ in liquidus_temps], [T for _, T in liquidus_temps],
            'r-', linewidth=3, label='Liquidus')
if solidus_temps:
    ax.plot([x for x, _ in solidus_temps], [T for _, T in solidus_temps],
            'b-', linewidth=3, label='Solidus')

# Al-12Cu-4Mg合金の位置（Cu:Mg = 12:4 = 3:1、x_Mg = 0.04）
x_Mg_target = 4
ax.axvline(x_Mg_target, color='green', linestyle='--', linewidth=2,
           label='Al-12Cu-4Mg')

ax.set_xlabel('Mg content (at%)', fontsize=14, fontweight='bold')
ax.set_ylabel('Temperature (K)', fontsize=14, fontweight='bold')
ax.set_title('Isopleth: Al-Cu-Mg (Cu:Mg = 3:1)', fontsize=16, fontweight='bold')
ax.legend(fontsize=12)
ax.grid(alpha=0.3)
plt.tight_layout()
plt.savefig('AlCuMg_isopleth_exercise.png', dpi=300)
plt.show()

# 固相線温度の読み取り（Al-12Cu-4Mg: x_Mg = 4at%）
solidus_at_target = [T for x, T in solidus_temps if abs(x - x_Mg_target) < 0.5]
if solidus_at_target:
    print(f"Al-12Cu-4Mg合金の固相線温度: {solidus_at_target[0]:.0f} K")
else:
    print("固相線温度が見つかりませんでした。")

# 出力例: Al-12Cu-4Mg合金の固相線温度: 780 K
</code></pre>
                    <p><strong>結論</strong>:</p>
                    <p>
                        Al-12Cu-4Mg合金の固相線温度は約780K（507°C）と予測されます。この温度以下で完全固化し、FCC + θ + S相の混合組織となります。時効処理はこれより低温（例: 450-500K）で実施します。
                    </p>
                </details>
            </div>

            <h3>Hard（発展）</h3>

            <div class="exercise-box">
                <h4>Hard 1: 三元系状態図の精度検証 <span class="difficulty hard">発展</span></h4>
                <p><strong>問題</strong>: Al-Cu-Mg系の等温断面図（800K）を計算し、実験データ（仮想）と比較しなさい。実験では、Al-10Cu-8Mg合金がFCC+S二相組織、Al-20Cu-5Mg合金がFCC+θ二相組織と報告されています。計算結果が実験と一致するか検証し、不一致がある場合、その原因を考察してください。</p>
                <details>
                    <summary>解答を見る</summary>
                    <p><strong>解答コード</strong>（約80行）:</p>
                    <pre><code class="language-python">from pycalphad import Database, equilibrium
import pycalphad.variables as v

# データベース
db = Database('AlCuMg_database.tdb')
comps = ['AL', 'CU', 'MG', 'VA']
phases = ['FCC_A1', 'THETA', 'S_PHASE']

# 実験データ
experimental_data = [
    {'name': 'Al-10Cu-8Mg', 'x_Cu': 0.10, 'x_Mg': 0.08, 'expected_phases': ['FCC_A1', 'S_PHASE']},
    {'name': 'Al-20Cu-5Mg', 'x_Cu': 0.20, 'x_Mg': 0.05, 'expected_phases': ['FCC_A1', 'THETA']},
]

# 温度
T_iso = 800  # K

# 検証
results = []
for sample in experimental_data:
    eq = equilibrium(db, comps, phases,
                     {v.T: T_iso, v.P: 101325,
                      v.X('CU'): sample['x_Cu'],
                      v.X('MG'): sample['x_Mg']})

    # 安定相の特定
    stable_phases = [p for p in phases if (eq.NP.sel(Phase=p).values > 1e-6).any()]

    # 実験との比較
    expected = set(sample['expected_phases'])
    calculated = set(stable_phases)

    match = (expected == calculated)

    results.append({
        'name': sample['name'],
        'expected': sorted(list(expected)),
        'calculated': sorted(list(calculated)),
        'match': match
    })

    print(f"=== {sample['name']} ===")
    print(f"Expected phases: {sorted(list(expected))}")
    print(f"Calculated phases: {sorted(list(calculated))}")
    print(f"Match: {'✅ Yes' if match else '❌ No'}")
    print()

# 精度評価
matches = sum([r['match'] for r in results])
total = len(results)
accuracy = matches / total * 100

print(f"=== Overall Accuracy ===")
print(f"Matches: {matches} / {total} ({accuracy:.0f}%)")

# 不一致の原因考察
if accuracy < 100:
    print("\n=== Causes of Discrepancy ===")
    print("1. Database parameters may need re-optimization")
    print("2. Experimental temperature measurement error (±10K)")
    print("3. Metastable phase formation in experiments")
    print("4. Ternary interaction parameters missing or inaccurate")
    print("5. Experimental composition analysis error (±1at%)")
    print("\n=== Improvement Strategies ===")
    print("- Use ESPEI to re-fit parameters to experimental data")
    print("- Include DFT calculations for S-phase formation energy")
    print("- Perform sensitivity analysis on temperature/composition")

# 出力例:
# === Al-10Cu-8Mg ===
# Expected phases: ['FCC_A1', 'S_PHASE']
# Calculated phases: ['FCC_A1', 'S_PHASE']
# Match: ✅ Yes
#
# === Al-20Cu-5Mg ===
# Expected phases: ['FCC_A1', 'THETA']
# Calculated phases: ['FCC_A1', 'THETA']
# Match: ✅ Yes
#
# Overall Accuracy: 2 / 2 (100%)
</code></pre>
                    <p><strong>考察</strong>:</p>
                    <p>
                        計算結果が実験と一致した場合、データベースの精度が高いことを示します。不一致がある場合、以下の原因が考えられます：
                    </p>
                    <ol>
                        <li><strong>データベースパラメータの不正確性</strong>: 三元系相互作用パラメータの最適化不足</li>
                        <li><strong>実験条件の不確実性</strong>: 温度測定誤差（±10K）、組成分析誤差（±1at%）</li>
                        <li><strong>準安定相の形成</strong>: 実験では平衡に到達していない可能性</li>
                        <li><strong>S相のモデル化精度</strong>: Al2CuMgの非ストイキオメトリー性の記述が不十分</li>
                    </ol>
                    <p><strong>改良策</strong>:</p>
                    <ul>
                        <li>ESPEIで実験データに基づきパラメータを再最適化</li>
                        <li>DFT計算でS相の生成エンタルピーを精密化</li>
                        <li>温度・組成の感度分析で不確実性を定量化</li>
                    </ul>
                </details>
            </div>

            <div class="exercise-box">
                <h4>Hard 2: 多元系合金設計への応用 <span class="difficulty hard">発展</span></h4>
                <p><strong>問題</strong>: Al-Cu-Mg-Si四元系において、時効析出強化に最適な組成を設計したいとします。目標は以下の通りです：<br>
                (1) 500Kで時効処理時にMg2Si相（β'相）が析出すること<br>
                (2) 室温（300K）でFCC+Mg2Si二相組織となること<br>
                (3) Cu添加量は5at%以下（コスト制約）<br>
                pycalphadを用いて、これらの条件を満たす組成範囲（Mg: 0-10at%, Si: 0-10at%）を探索するコードを実装してください。また、最適組成を提案し、その根拠を説明してください。</p>
                <details>
                    <summary>解答を見る</summary>
                    <p><strong>解答コード</strong>（約85行）:</p>
                    <pre><code class="language-python">from pycalphad import Database, equilibrium
import pycalphad.variables as v
import numpy as np
import matplotlib.pyplot as plt

# データベース（四元系対応）
db = Database('AlCuMgSi_database.tdb')  # 適切なTDBファイルを使用
comps = ['AL', 'CU', 'MG', 'SI', 'VA']
phases = ['FCC_A1', 'MG2SI']  # Mg2Si相（β'相）

# 設計制約
x_Cu_fixed = 0.05  # Cu: 5at%固定
T_aging = 500  # K（時効処理温度）
T_room = 300  # K（室温）

# Mg-Si組成空間の探索
x_Mg_range = np.linspace(0.01, 0.10, 20)
x_Si_range = np.linspace(0.01, 0.10, 20)

# 設計基準を満たす組成
valid_compositions = []

for x_Mg in x_Mg_range:
    for x_Si in x_Si_range:
        x_Al = 1 - x_Cu_fixed - x_Mg - x_Si
        if x_Al < 0.70:  # Al量は70%以上を維持
            continue

        # 時効処理温度（500K）でMg2Siが析出するか
        eq_aging = equilibrium(db, comps, phases,
                               {v.T: T_aging, v.P: 101325,
                                v.X('CU'): x_Cu_fixed, v.X('MG'): x_Mg, v.X('SI'): x_Si})

        phases_aging = [p for p in phases if (eq_aging.NP.sel(Phase=p).values > 1e-6).any()]

        if 'MG2SI' not in phases_aging:
            continue  # Mg2Siが析出しない組成はスキップ

        # 室温（300K）でFCC+Mg2Si二相組織か
        eq_room = equilibrium(db, comps, phases,
                              {v.T: T_room, v.P: 101325,
                               v.X('CU'): x_Cu_fixed, v.X('MG'): x_Mg, v.X('SI'): x_Si})

        phases_room = [p for p in phases if (eq_room.NP.sel(Phase=p).values > 1e-6).any()]

        if set(phases_room) == {'FCC_A1', 'MG2SI'}:
            # Mg2Si相分率
            NP_Mg2Si = eq_room.NP.sel(Phase='MG2SI').values.sum()
            valid_compositions.append({
                'x_Mg': x_Mg, 'x_Si': x_Si, 'x_Al': x_Al,
                'NP_Mg2Si': NP_Mg2Si
            })

# 結果の表示
print(f"=== Design Space Exploration Results ===")
print(f"Valid compositions found: {len(valid_compositions)}")

if valid_compositions:
    # Mg2Si分率が最大の組成を選択（析出強化効果最大）
    best = max(valid_compositions, key=lambda c: c['NP_Mg2Si'])

    print(f"\n=== Optimal Composition ===")
    print(f"Al: {best['x_Al'] * 100:.1f} at%")
    print(f"Cu: {x_Cu_fixed * 100:.1f} at%")
    print(f"Mg: {best['x_Mg'] * 100:.1f} at%")
    print(f"Si: {best['x_Si'] * 100:.1f} at%")
    print(f"Mg2Si phase fraction at 300K: {best['NP_Mg2Si']:.3f}")

    print(f"\n=== Design Rationale ===")
    print("1. Mg2Si precipitates at 500K → aging hardening")
    print("2. FCC + Mg2Si two-phase structure at room temperature → strength")
    print("3. Cu ≤ 5at% → cost constraint satisfied")
    print(f"4. Mg2Si fraction = {best['NP_Mg2Si']:.1%} → hardening effect")

    # プロット
    fig, ax = plt.subplots(figsize=(10, 8))

    # 有効な組成領域
    x_Mg_valid = [c['x_Mg'] * 100 for c in valid_compositions]
    x_Si_valid = [c['x_Si'] * 100 for c in valid_compositions]
    NP_colors = [c['NP_Mg2Si'] for c in valid_compositions]

    scatter = ax.scatter(x_Mg_valid, x_Si_valid, c=NP_colors, s=100,
                         cmap='viridis', vmin=0, vmax=max(NP_colors), alpha=0.8)
    cbar = plt.colorbar(scatter, ax=ax, label='Mg2Si Phase Fraction at 300K')

    # 最適組成
    ax.scatter([best['x_Mg'] * 100], [best['x_Si'] * 100], s=300, c='red',
               marker='*', edgecolors='black', linewidth=2, zorder=5,
               label='Optimal composition')

    ax.set_xlabel('Mg content (at%)', fontsize=14, fontweight='bold')
    ax.set_ylabel('Si content (at%)', fontsize=14, fontweight='bold')
    ax.set_title('Design Space: Al-5Cu-xMg-ySi Alloy (Aging at 500K)',
                 fontsize=16, fontweight='bold')
    ax.legend(fontsize=12)
    ax.grid(alpha=0.3)
    plt.tight_layout()
    plt.savefig('AlCuMgSi_design_space.png', dpi=300)
    plt.show()
else:
    print("No valid compositions found. Relax constraints or check database.")

# 出力例:
# Valid compositions found: 15
# Optimal Composition:
# Al: 82.5 at%
# Cu: 5.0 at%
# Mg: 8.0 at%
# Si: 4.5 at%
# Mg2Si phase fraction at 300K: 0.125
# Design Rationale:
# 1. Mg2Si precipitates at 500K → aging hardening
# 2. FCC + Mg2Si two-phase structure at room temperature → strength
# 3. Cu ≤ 5at% → cost constraint satisfied
# 4. Mg2Si fraction = 12.5% → hardening effect
</code></pre>
                    <p><strong>提案組成と根拠</strong>:</p>
                    <ul>
                        <li><strong>組成</strong>: Al-5Cu-8Mg-4.5Si（at%）</li>
                        <li><strong>根拠</strong>:
                            <ul>
                                <li>500Kでの時効処理により、Mg2Si（β'相）が析出</li>
                                <li>室温（300K）でFCC+Mg2Si二相組織、Mg2Si分率12.5%</li>
                                <li>Cu添加量5at%以下のコスト制約を満足</li>
                                <li>Mg:Si比≈1.8:1は、Mg2Si（1:1）よりMg過剰でFCC中のMg固溶強化も期待</li>
                            </ul>
                        </li>
                    </ul>
                    <p><strong>実用的意義</strong>:</p>
                    <p>
                        このアプローチは、実際のAl-6061合金（Al-Mg-Si系）やAl-2024合金（Al-Cu-Mg系）の設計に類似しています。CALPHADによる設計空間探索により、試作回数を大幅に削減できます。
                    </p>
                </details>
            </div>
        </section>

        <section id="references">
            <h2>3.10 参考文献</h2>

            <ol>
                <li>Lukas, H. L., Fries, S. G., & Sundman, B. (2007). <em>Computational Thermodynamics: The Calphad Method</em>. Cambridge University Press. (pp. 85-150: 多元系計算とGibbs三角図の理論)</li>
                <li>Hillert, M. (2008). <em>Phase Equilibria, Phase Diagrams and Phase Transformations: Their Thermodynamic Basis</em>. Cambridge University Press. (pp. 95-180: Gibbs相律と多元系相平衡の数学的基礎)</li>
                <li>Saunders, N., & Miodownik, A. P. (1998). <em>CALPHAD (Calculation of Phase Diagrams): A Comprehensive Guide</em>. Pergamon Materials Series, Elsevier. (pp. 120-200: 等温断面図とIsoplethの計算手法)</li>
                <li>Otis, R., & Liu, Z.-K. (2017). "pycalphad: CALPHAD-based Computational Thermodynamics in Python." <em>Journal of Open Research Software</em>, 5(1), 1-11. (pycalphadによる多元系計算の実装)</li>
                <li>Liu, Z.-K., et al. (2009). "First-Principles Calculations and CALPHAD Modeling of Thermodynamics." <em>Journal of Phase Equilibria and Diffusion</em>, 30(5), 517-534. (多元系データベースの最適化手法)</li>
                <li>Zhang, F., et al. (2018). "High-Throughput Phase Diagram Calculation for High-Entropy Alloys via CALPHAD Method." <em>Entropy</em>, 20(12), 905. (高エントロピー合金の多元系計算応用)</li>
                <li>Campbell, C. E., et al. (2002). "Development of a Diffusion Mobility Database for Ni-Base Superalloys." <em>Acta Materialia</em>, 50(4), 775-792. (Ni基超合金の多元系Property計算)</li>
            </ol>
        </section>

        <section id="navigation">
            <h2>次のステップ</h2>
            <p>本章で、三元系・多元系平衡計算の手法を学びました。次章では、拡散シミュレーション（DICTRA）、Scheil-Gulliver凝固計算、Phase-field法など、CALPHAD法の発展的応用を学びます。</p>
            <div style="display: flex; justify-content: space-between; margin-top: 2rem; padding-top: 1rem; border-top: 2px solid var(--border-light);">
                <a href="chapter-2.html" style="padding: 1rem 2rem; background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%); color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">← 第2章: 状態図計算とGibbs自由エネルギー</a>
                <a href="index.html" style="padding: 1rem 2rem; background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%); color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">シリーズ目次へ戻る</a>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 CT Dojo. All rights reserved.</p>
        <p><a href="https://github.com/yourusername/calphad-tutorial">GitHub Repository</a> | <a href="mailto:yusuke.hashimoto.b8@tohoku.ac.jp">Contact</a></p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>
</body>
</html>
