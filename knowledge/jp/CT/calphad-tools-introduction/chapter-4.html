<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第4章: 析出シミュレーション - CALPHAD法入門 - CT Dojo</title>
    <meta name="description" content="核生成理論、成長速度論、Scheil凝固、TTT/CCT図、CALPHAD連携析出シミュレーションを学ぶ実践ガイド。">

    <!-- Prism.js for code highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

    <!-- MathJax for mathematical expressions -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Mermaid for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <style>
        :root {
            --accent-green: #11998e;
            --accent-lime: #38ef7d;
            --primary-dark: #2c3e50;
            --secondary-dark: #34495e;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --bg-light: #ecf0f1;
            --white: #ffffff;
            --code-bg: #2d2d2d;
            --border-light: #bdc3c7;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.8;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        header {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%);
            color: white;
            padding: 3rem 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        nav {
            background: var(--white);
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
        }

        nav a {
            text-decoration: none;
            color: var(--text-dark);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
        }

        nav a:hover {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%);
            color: white;
        }

        main {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1.5rem 3rem;
        }

        section {
            background: var(--white);
            margin-bottom: 2rem;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h2 {
            color: var(--primary-dark);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 3px solid;
            border-image: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%) 1;
        }

        h3 {
            color: var(--secondary-dark);
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        h4 {
            color: var(--text-dark);
            font-size: 1.2rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        p, li {
            margin-bottom: 0.75rem;
            line-height: 1.8;
        }

        ul, ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1.5rem 0;
            border-left: 4px solid var(--accent-green);
        }

        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
        }

        .note {
            background: #e8f5e9;
            border-left: 4px solid var(--success);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        .warning {
            background: #fff3e0;
            border-left: 4px solid var(--warning);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.95rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        th {
            background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-lime) 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .mermaid {
            background: white;
            padding: 1.5rem;
            border-radius: 6px;
            margin: 1.5rem 0;
            border: 1px solid var(--border-light);
        }

        footer {
            background: var(--primary-dark);
            color: white;
            text-align: center;
            padding: 2rem 1.5rem;
            margin-top: 3rem;
        }

        footer a {
            color: var(--accent-lime);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .learning-objectives {
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.05) 0%, rgba(56, 239, 125, 0.05) 100%);
            border: 2px solid var(--accent-green);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .learning-objectives h3 {
            color: var(--accent-green);
            margin-top: 0;
        }

        .learning-level {
            margin: 1rem 0;
            padding-left: 1rem;
        }

        .learning-level strong {
            color: var(--accent-green);
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }

            nav ul {
                flex-direction: column;
            }

            main {
                padding: 0 1rem 2rem;
            }

            section {
                padding: 1.5rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>第4章: 析出シミュレーション</h1>
        <p>Precipitation Simulation with CALPHAD</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">ホーム</a></li>
            <li><a href="chapter-1.html">第1章: CALPHAD基礎</a></li>
            <li><a href="chapter-2.html">第2章: 状態図計算</a></li>
            <li><a href="chapter-3.html">第3章: 多元系平衡</a></li>
            <li><a href="chapter-4.html">第4章: 析出シミュレーション</a></li>
            <li><a href="chapter-5.html">第5章: Python実践</a></li>
        </ul>
    </nav>

    <main>
        <section id="intro">
            <h2>4.1 本章の概要</h2>
            <p>本章では、CALPHAD法を用いた析出シミュレーションの基礎と応用を学びます。核生成理論、成長速度論、Scheil凝固モデル、TTT/CCT図の作成、そして実際の材料系での析出予測手法を習得します。</p>

            <div class="learning-objectives">
                <h3>学習目標</h3>
                <div class="learning-level">
                    <strong>レベル1: 基本理解</strong>
                    <ul>
                        <li>古典核生成理論の理解（均質・不均質核生成）</li>
                        <li>拡散律速成長メカニズムの把握</li>
                        <li>Scheil-Gulliverモデルの原理理解</li>
                        <li>TTT/CCT図の読み方と意義</li>
                    </ul>
                </div>
                <div class="learning-level">
                    <strong>レベル2: 実践スキル</strong>
                    <ul>
                        <li>pycalphadによる駆動力計算の実装</li>
                        <li>核生成速度・成長速度の数値計算</li>
                        <li>Scheil凝固シミュレーションの実行</li>
                        <li>TTT図のプロット作成</li>
                    </ul>
                </div>
                <div class="learning-level">
                    <strong>レベル3: 応用力</strong>
                    <ul>
                        <li>複雑な析出過程のモデリング</li>
                        <li>実験データとの比較検証</li>
                        <li>CALPHAD-拡散計算連携</li>
                        <li>材料プロセス最適化への応用</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="nucleation">
            <h2>4.2 核生成理論</h2>

            <h3>4.2.1 古典核生成理論（Classical Nucleation Theory）</h3>
            <p>核生成の駆動力は、相変態に伴うGibbs自由エネルギー変化と新相/母相界面エネルギーのバランスで決まります。</p>

            <p><strong>臨界核半径（Critical radius）：</strong></p>
            <p>\[
            r^* = \frac{2\sigma}{\Delta G_v}
            \]</p>
            <p>ここで、\(\sigma\)は界面エネルギー [J/m²]、\(\Delta G_v\)は単位体積あたりの駆動力 [J/m³]です。</p>

            <p><strong>核生成障壁（Nucleation barrier）：</strong></p>
            <p>\[
            \Delta G^* = \frac{16\pi\sigma^3}{3(\Delta G_v)^2}
            \]</p>

            <p><strong>定常核生成速度（Steady-state nucleation rate）：</strong></p>
            <p>\[
            J = N_0 Z \beta^* \exp\left(-\frac{\Delta G^*}{k_B T}\right)
            \]</p>

            <ul>
                <li>\(N_0\): 核生成サイト密度 [m⁻³]</li>
                <li>\(Z\): Zeldovich因子（非平衡補正）</li>
                <li>\(\beta^*\): 臨界核への原子付着頻度 [s⁻¹]</li>
                <li>\(k_B\): Boltzmann定数、\(T\): 温度 [K]</li>
            </ul>

            <h3>4.2.2 不均質核生成（Heterogeneous Nucleation）</h3>
            <p>実際の材料では、粒界や析出物などの不均質サイトで核生成が優先します。接触角\(\theta\)を用いた補正係数\(f(\theta)\)により、核生成障壁が低減します：</p>

            <p>\[
            \Delta G_{\text{het}}^* = \Delta G_{\text{hom}}^* \cdot f(\theta)
            \]</p>

            <p>\[
            f(\theta) = \frac{(2 + \cos\theta)(1 - \cos\theta)^2}{4}
            \]</p>

            <p>\(\theta = 0°\)で\(f = 0\)（完全濡れ）、\(\theta = 180°\)で\(f = 1\)（均質核生成と同等）となります。</p>

            <h3>4.2.3 駆動力計算の実装</h3>
            <p>pycalphadを用いて、析出相形成の駆動力\(\Delta G_v\)を計算します：</p>

            <pre><code class="language-python">#!/usr/bin/env python3
"""
析出駆動力計算（pycalphad使用）
Al-Cu系でθ相（Al2Cu）の駆動力を計算
"""

from pycalphad import Database, equilibrium, variables as v
import numpy as np
import matplotlib.pyplot as plt

# データベース読み込み（Al-Cu系）
db = Database('alcutdb.tdb')

# 計算条件
T = 450 + 273.15  # 450°C → K
comps = ['AL', 'CU', 'VA']
phases = ['FCC_A1', 'THETA']  # α相（FCC）とθ相（Al2Cu）

# Cu組成範囲
x_cu = np.linspace(0.01, 0.10, 50)  # 1-10 at.% Cu

driving_force = []

for xcu in x_cu:
    # 母相（FCC_A1）の平衡計算
    eq_matrix = equilibrium(db, comps, 'FCC_A1', {v.X('CU'): xcu, v.T: T, v.P: 101325})

    # 母相のGibbs自由エネルギー
    G_matrix = eq_matrix.GM.values.flatten()[0]

    # 析出相（THETA）の平衡計算
    eq_precip = equilibrium(db, comps, 'THETA', {v.X('CU'): 0.33, v.T: T, v.P: 101325})  # Al2Cu → Cu=0.33

    # 析出相のGibbs自由エネルギー
    G_precip = eq_precip.GM.values.flatten()[0]

    # 駆動力 ΔG = G_matrix - G_precip（負が析出駆動力）
    dG = G_matrix - G_precip
    driving_force.append(dG)

# プロット
plt.figure(figsize=(10, 6))
plt.plot(x_cu * 100, np.array(driving_force) / 1000, 'o-', color='#11998e', linewidth=2)
plt.axhline(0, color='gray', linestyle='--', linewidth=1)
plt.xlabel('Cu組成 (at.%)', fontsize=14)
plt.ylabel('駆動力 ΔG (kJ/mol)', fontsize=14)
plt.title(f'θ相（Al2Cu）析出駆動力 @ {T-273.15:.0f}°C', fontsize=16)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('driving_force_theta.png', dpi=300)
plt.show()

print(f"最大駆動力: {min(driving_force)/1000:.2f} kJ/mol @ {x_cu[np.argmin(driving_force)]*100:.2f} at.% Cu")
</code></pre>
        </section>

        <section id="growth">
            <h2>4.3 成長速度論</h2>

            <h3>4.3.1 拡散律速成長（Diffusion-Controlled Growth）</h3>
            <p>球状析出物の拡散律速成長速度は、以下のZener式で近似されます：</p>

            <p>\[
            \frac{dr}{dt} = \frac{D}{r} \cdot \frac{C_\infty - C_\alpha}{C_\beta - C_\alpha}
            \]</p>

            <ul>
                <li>\(r\): 析出物半径 [m]</li>
                <li>\(D\): 拡散係数 [m²/s]</li>
                <li>\(C_\infty\): 母相中の遠方濃度</li>
                <li>\(C_\alpha, C_\beta\): 界面での母相・析出相濃度</li>
            </ul>

            <p><strong>Arrhenius型拡散係数：</strong></p>
            <p>\[
            D(T) = D_0 \exp\left(-\frac{Q}{RT}\right)
            \]</p>

            <h3>4.3.2 成長速度シミュレーション</h3>
            <pre><code class="language-python">#!/usr/bin/env python3
"""
析出物成長速度シミュレーション
Al-Cu系θ相の等温成長
"""

import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint

def growth_rate(r, t, T, D0, Q, C_inf, C_alpha, C_beta):
    """
    析出物成長速度（拡散律速）

    Parameters
    ----------
    r : float
        現在の析出物半径 [m]
    t : float
        時間 [s]
    T : float
        温度 [K]
    D0 : float
        拡散係数の前指数因子 [m²/s]
    Q : float
        活性化エネルギー [J/mol]
    C_inf, C_alpha, C_beta : float
        各濃度 [原子分率]

    Returns
    -------
    float
        dr/dt [m/s]
    """
    R = 8.314  # ガス定数 [J/mol/K]
    D = D0 * np.exp(-Q / (R * T))

    if r < 1e-10:  # 初期半径がゼロに近い場合の処理
        return 0.0

    return (D / r) * ((C_inf - C_alpha) / (C_beta - C_alpha))

# パラメータ設定（Al-Cu系θ相）
T = 450 + 273.15  # 450°C
D0 = 1.0e-4  # m²/s
Q = 136000  # J/mol（Cu in Al）
C_inf = 0.04  # 4 at.% Cu（母相遠方）
C_alpha = 0.01  # 1 at.% Cu（α相界面）
C_beta = 0.33  # 33 at.% Cu（θ相、Al2Cu）

# 時間範囲
t = np.linspace(0, 3600, 1000)  # 0-1時間

# 初期半径
r0 = 1e-9  # 1 nm

# ODE求解
r_t = odeint(growth_rate, r0, t, args=(T, D0, Q, C_inf, C_alpha, C_beta))

# プロット
plt.figure(figsize=(10, 6))
plt.plot(t / 60, r_t * 1e9, color='#11998e', linewidth=2)
plt.xlabel('時間 (分)', fontsize=14)
plt.ylabel('析出物半径 (nm)', fontsize=14)
plt.title(f'θ相成長シミュレーション @ {T-273.15:.0f}°C', fontsize=16)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('growth_simulation.png', dpi=300)
plt.show()

print(f"1時間後の半径: {r_t[-1][0]*1e9:.2f} nm")
</code></pre>
        </section>

        <section id="scheil">
            <h2>4.4 Scheil-Gulliver凝固モデル</h2>

            <h3>4.4.1 Scheilモデルの原理</h3>
            <p>Scheil-Gulliverモデルは、液相中で完全拡散、固相中で拡散なし（完全偏析）と仮定した凝固モデルです。</p>

            <p><strong>固相分率と液相組成の関係：</strong></p>
            <p>\[
            C_L = C_0 (1 - f_s)^{k-1}
            \]</p>

            <ul>
                <li>\(C_L\): 液相組成</li>
                <li>\(C_0\): 初期組成</li>
                <li>\(f_s\): 固相分率（0〜1）</li>
                <li>\(k\): 平衡分配係数 \(k = C_S / C_L\)</li>
            </ul>

            <p>このモデルにより、デンドライト偏析やミクロ偏析を予測できます。</p>

            <h3>4.4.2 pycalphadによるScheil計算</h3>
            <pre><code class="language-python">#!/usr/bin/env python3
"""
Scheil-Gulliver凝固シミュレーション（pycalphad使用）
Al-4wt%Cu合金のScheil凝固
"""

from pycalphad import Database, equilibrium, variables as v
import numpy as np
import matplotlib.pyplot as plt

db = Database('alcutdb.tdb')

# 初期組成（Al-4wt%Cu）
C0_Cu = 0.018  # 原子分率に変換（約4wt%）

# 温度範囲（液相線〜固相線）
T_liquidus = 920  # K（およそ）
T_solidus = 800   # K（およそ）
T_range = np.linspace(T_liquidus, T_solidus, 100)

# Scheilシミュレーション
fs_array = []  # 固相分率
CL_Cu_array = []  # 液相Cu濃度

CL_Cu = C0_Cu  # 初期液相組成
fs = 0.0  # 初期固相分率

for T in T_range:
    # 液相と固相の平衡計算
    eq = equilibrium(db, ['AL', 'CU', 'VA'], ['LIQUID', 'FCC_A1'],
                     {v.X('CU'): CL_Cu, v.T: T, v.P: 101325})

    # 固相分率の更新（簡易Scheilモデル）
    # 実際にはiterative計算が必要だが、ここでは近似
    phase_fractions = eq.NP.values

    if 'FCC_A1' in eq.Phase.values:
        fs_new = phase_fractions[eq.Phase.values == 'FCC_A1'][0]

        # 液相組成更新（Scheil式）
        if fs_new > fs and fs_new < 1.0:
            k = 0.17  # Cu in Al の分配係数（およそ）
            CL_Cu = C0_Cu * (1 - fs_new)**(k - 1)
            fs = fs_new

    fs_array.append(fs)
    CL_Cu_array.append(CL_Cu)

# プロット
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))

# 固相分率 vs 温度
ax1.plot(T_range - 273.15, fs_array, color='#11998e', linewidth=2)
ax1.set_xlabel('温度 (°C)', fontsize=14)
ax1.set_ylabel('固相分率', fontsize=14)
ax1.set_title('Scheil凝固：固相分率', fontsize=16)
ax1.grid(True, alpha=0.3)

# 液相Cu濃度 vs 固相分率
ax2.plot(fs_array, np.array(CL_Cu_array) * 100, color='#38ef7d', linewidth=2)
ax2.set_xlabel('固相分率', fontsize=14)
ax2.set_ylabel('液相Cu濃度 (at.%)', fontsize=14)
ax2.set_title('Scheil凝固：液相組成変化', fontsize=16)
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('scheil_simulation.png', dpi=300)
plt.show()

print(f"最終液相Cu濃度: {CL_Cu_array[-1]*100:.2f} at.%")
print(f"偏析比: {CL_Cu_array[-1]/C0_Cu:.2f}")
</code></pre>
        </section>

        <section id="ttt-cct">
            <h2>4.5 TTT/CCT図</h2>

            <h3>4.5.1 TTT図（Time-Temperature-Transformation）</h3>
            <p>TTT図は、等温保持時の変態開始時間と変態完了時間を温度の関数として表した図です。C曲線（nose curve）の形状を示します。</p>

            <div class="mermaid">
                graph TD
                    A[TTT図作成手順] --> B[各温度で核生成速度計算]
                    B --> C[成長速度計算]
                    C --> D[変態開始時間決定<br/>1%変態]
                    D --> E[変態完了時間決定<br/>99%変態]
                    E --> F[TTT曲線プロット]

                    style A fill:#11998e,color:#fff
                    style F fill:#38ef7d,color:#fff
            </div>

            <h3>4.5.2 TTT図の作成</h3>
            <pre><code class="language-python">#!/usr/bin/env python3
"""
TTT図作成シミュレーション
簡易モデルによるC曲線生成
"""

import numpy as np
import matplotlib.pyplot as plt

def transformation_time(T, T_nose, t_nose, n=2):
    """
    TTT曲線の近似式（Johnson-Mehl-Avrami型）

    Parameters
    ----------
    T : float
        温度 [K]
    T_nose : float
        C曲線のnose温度 [K]
    t_nose : float
        nose温度での変態時間 [s]
    n : float
        Avrami指数

    Returns
    -------
    tuple
        (変態開始時間, 変態完了時間) [s]
    """
    # Nose温度からの温度差
    dT = abs(T - T_nose)

    # 温度依存性（ガウス型）
    factor = np.exp((dT / 50)**2)

    t_start = t_nose * factor  # 1%変態
    t_finish = t_start * 10    # 99%変態

    return t_start, t_finish

# 温度範囲
T_range = np.linspace(300, 600, 50) + 273.15  # 300-600°C

# TTTパラメータ
T_nose = 450 + 273.15  # Nose温度: 450°C
t_nose = 100  # Nose時間: 100秒

t_start_arr = []
t_finish_arr = []

for T in T_range:
    t_start, t_finish = transformation_time(T, T_nose, t_nose)
    t_start_arr.append(t_start)
    t_finish_arr.append(t_finish)

# プロット
plt.figure(figsize=(10, 8))
plt.plot(t_start_arr, T_range - 273.15, 'o-', color='#11998e', linewidth=2, label='変態開始（1%）')
plt.plot(t_finish_arr, T_range - 273.15, 's-', color='#38ef7d', linewidth=2, label='変態完了（99%）')
plt.xscale('log')
plt.xlabel('時間 (秒)', fontsize=14)
plt.ylabel('温度 (°C)', fontsize=14)
plt.title('TTT図（Time-Temperature-Transformation）', fontsize=16)
plt.legend(fontsize=12)
plt.grid(True, which='both', alpha=0.3)
plt.tight_layout()
plt.savefig('ttt_diagram.png', dpi=300)
plt.show()

print(f"Nose温度: {T_nose - 273.15:.0f}°C")
print(f"Nose時間: {t_nose:.0f}秒")
</code></pre>

            <h3>4.5.3 CCT図（Continuous Cooling Transformation）</h3>
            <p>CCT図は、連続冷却時の変態挙動を示します。TTT図とは異なり、冷却速度が変態に影響します。</p>

            <p><strong>TTT→CCT変換の経験則：</strong></p>
            <p>CCT曲線はTTT曲線の約1.5〜2倍右側にシフトします（材料によって異なる）。</p>
        </section>

        <section id="precipitation-sequence">
            <h2>4.6 析出シーケンス解析</h2>

            <h3>4.6.1 時効析出の段階</h3>
            <p>Al-Cu系の時効析出は以下のシーケンスを経ます：</p>

            <p>\[
            \alpha_{\text{SSS}} \rightarrow \text{GP zones} \rightarrow \theta'' \rightarrow \theta' \rightarrow \theta \, (\text{Al}_2\text{Cu})
            \]</p>

            <table>
                <thead>
                    <tr>
                        <th>析出相</th>
                        <th>構造</th>
                        <th>サイズ</th>
                        <th>硬化寄与</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>GP zones</td>
                        <td>Cuリッチクラスター</td>
                        <td>1-3 nm</td>
                        <td>中</td>
                    </tr>
                    <tr>
                        <td>θ''</td>
                        <td>準安定（単原子層）</td>
                        <td>3-10 nm</td>
                        <td>大</td>
                    </tr>
                    <tr>
                        <td>θ'</td>
                        <td>準安定（板状）</td>
                        <td>10-100 nm</td>
                        <td>最大</td>
                    </tr>
                    <tr>
                        <td>θ（Al2Cu）</td>
                        <td>平衡相</td>
                        <td>>100 nm</td>
                        <td>小（過時効）</td>
                    </tr>
                </tbody>
            </table>

            <h3>4.6.2 析出シーケンスシミュレーション</h3>
            <pre><code class="language-python">#!/usr/bin/env python3
"""
時効析出シーケンスシミュレーション
Al-Cu系のGP zones → θ'' → θ' → θ 遷移
"""

import numpy as np
import matplotlib.pyplot as plt

def precipitation_kinetics(t, phases):
    """
    各析出相の体積分率の時間発展（Avrami式）

    Parameters
    ----------
    t : array
        時間配列 [s]
    phases : dict
        各相のパラメータ（k: 速度定数、n: Avrami指数、delay: 遅延時間）

    Returns
    -------
    dict
        各相の体積分率
    """
    results = {}

    for phase, params in phases.items():
        k = params['k']
        n = params['n']
        delay = params.get('delay', 0)

        # Avrami式: f = 1 - exp(-(kt)^n)
        t_eff = np.maximum(t - delay, 0)  # 遅延時間考慮
        f = 1 - np.exp(-(k * t_eff)**n)

        # 前の相が溶解する効果（簡易モデル）
        if phase != 'GP':
            # 後続相の成長に伴い前相は溶解
            dissolution = 0.5 * f  # 簡易的な溶解モデル
            f = f - dissolution

        results[phase] = np.maximum(f, 0)

    return results

# 時間範囲
t = np.logspace(-1, 5, 300)  # 0.1秒 〜 10万秒（約28時間）

# 各相のパラメータ
phases = {
    'GP': {'k': 0.05, 'n': 1.5, 'delay': 0},          # GP zones（早期）
    'theta_dp': {'k': 0.01, 'n': 2.0, 'delay': 10},   # θ''（中期）
    'theta_p': {'k': 0.002, 'n': 2.5, 'delay': 100},  # θ'（後期）
    'theta': {'k': 0.0005, 'n': 3.0, 'delay': 1000},  # θ（過時効）
}

# 計算実行
frac = precipitation_kinetics(t, phases)

# プロット
plt.figure(figsize=(12, 7))
colors = ['#11998e', '#38ef7d', '#f093fb', '#f5576c']
labels = ['GP zones', 'θ\'\'', 'θ\'', 'θ (Al₂Cu)']

for (phase, f), color, label in zip(frac.items(), colors, labels):
    plt.plot(t, f * 100, linewidth=2.5, color=color, label=label)

plt.xscale('log')
plt.xlabel('時効時間 (秒)', fontsize=14)
plt.ylabel('析出相体積分率 (%)', fontsize=14)
plt.title('Al-Cu系 時効析出シーケンス @ 200°C', fontsize=16)
plt.legend(fontsize=12, loc='upper left')
plt.grid(True, which='both', alpha=0.3)
plt.tight_layout()
plt.savefig('precipitation_sequence.png', dpi=300)
plt.show()

# ピーク硬化時間の推定（θ'が最大）
peak_time_idx = np.argmax(frac['theta_p'])
print(f"ピーク硬化時間: {t[peak_time_idx]/3600:.2f} 時間")
</code></pre>
        </section>

        <section id="exercises">
            <h2>4.7 演習問題</h2>

            <h3>演習1: 臨界核半径計算（Easy）</h3>
            <p>Al-Cu系で、界面エネルギー\(\sigma = 0.2\) J/m²、駆動力\(\Delta G_v = -10^8\) J/m³のとき、臨界核半径\(r^*\)と核生成障壁\(\Delta G^*\)を計算してください。</p>
            <details>
                <summary>解答例を表示</summary>
                <pre><code class="language-python">#!/usr/bin/env python3
"""
演習1: 臨界核半径と核生成障壁の計算
"""

import numpy as np

# パラメータ
sigma = 0.2  # 界面エネルギー [J/m²]
DeltaGv = -1e8  # 駆動力 [J/m³]（負：析出駆動力）

# 臨界核半径
r_critical = 2 * sigma / abs(DeltaGv)

# 核生成障壁
DeltaG_barrier = (16 * np.pi * sigma**3) / (3 * DeltaGv**2)

print(f"臨界核半径 r*: {r_critical * 1e9:.2f} nm")
print(f"核生成障壁 ΔG*: {DeltaG_barrier:.2e} J")
print(f"核生成障壁 ΔG*: {DeltaG_barrier / 1.6e-19:.2f} eV")

# 温度依存性評価
T = 450 + 273.15  # 450°C
kB = 1.38e-23  # Boltzmann定数
exp_factor = np.exp(-DeltaG_barrier / (kB * T))

print(f"\n温度 {T-273.15:.0f}°C での核生成確率: {exp_factor:.2e}")
</code></pre>
            </details>

            <h3>演習2: Scheil偏析比計算（Medium）</h3>
            <p>初期組成\(C_0 = 0.04\)（4 at.%）、分配係数\(k = 0.2\)のとき、固相分率\(f_s = 0.99\)（99%凝固）での液相組成\(C_L\)を計算してください。</p>
            <details>
                <summary>解答例を表示</summary>
                <pre><code class="language-python">#!/usr/bin/env python3
"""
演習2: Scheil偏析比計算
"""

import numpy as np
import matplotlib.pyplot as plt

# パラメータ
C0 = 0.04  # 初期組成 [原子分率]
k = 0.2    # 分配係数

# 固相分率範囲
fs = np.linspace(0.01, 0.99, 100)

# Scheil式: C_L = C0 * (1 - fs)^(k-1)
CL = C0 * (1 - fs)**(k - 1)

# 固相組成: C_S = k * C_L
CS = k * CL

# 99%凝固時の値
fs_99 = 0.99
CL_99 = C0 * (1 - fs_99)**(k - 1)
CS_99 = k * CL_99

print(f"初期組成 C0: {C0 * 100:.2f} at.%")
print(f"分配係数 k: {k}")
print(f"\n99%凝固時:")
print(f"  液相組成 CL: {CL_99 * 100:.2f} at.%")
print(f"  固相組成 CS: {CS_99 * 100:.2f} at.%")
print(f"  偏析比 CL/C0: {CL_99/C0:.2f}")

# プロット
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))

# 液相・固相組成 vs 固相分率
ax1.plot(fs, CL * 100, label='液相 CL', color='#11998e', linewidth=2)
ax1.plot(fs, CS * 100, label='固相 CS', color='#38ef7d', linewidth=2)
ax1.axvline(fs_99, color='red', linestyle='--', alpha=0.5, label=f'fs = {fs_99}')
ax1.set_xlabel('固相分率 fs', fontsize=14)
ax1.set_ylabel('組成 (at.%)', fontsize=14)
ax1.set_title('Scheil凝固：組成変化', fontsize=16)
ax1.legend(fontsize=12)
ax1.grid(True, alpha=0.3)

# 偏析比 vs 固相分率
segregation_ratio = CL / C0
ax2.plot(fs, segregation_ratio, color='#f093fb', linewidth=2)
ax2.axvline(fs_99, color='red', linestyle='--', alpha=0.5)
ax2.axhline(segregation_ratio[np.argmin(np.abs(fs - fs_99))], color='red', linestyle='--', alpha=0.5)
ax2.set_xlabel('固相分率 fs', fontsize=14)
ax2.set_ylabel('偏析比 CL/C0', fontsize=14)
ax2.set_title('Scheil凝固：偏析比', fontsize=16)
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('scheil_segregation.png', dpi=300)
plt.show()
</code></pre>
            </details>

            <h3>演習3: TTT曲線フィッティング（Hard）</h3>
            <p>実験データ（温度、変態開始時間）に対してJohnson-Mehl-Avrami（JMA）式をフィッティングし、最適なnose温度とnose時間を求めてください。</p>
            <details>
                <summary>解答例を表示</summary>
                <pre><code class="language-python">#!/usr/bin/env python3
"""
演習3: TTT曲線の実験データフィッティング
scipy.optimize使用
"""

import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

# 実験データ（例）
T_exp = np.array([350, 400, 450, 500, 550, 600]) + 273.15  # K
t_start_exp = np.array([5000, 500, 100, 300, 1200, 6000])  # 秒

def ttt_model(T, T_nose, t_nose, alpha):
    """
    TTT曲線モデル（ガウス型）

    Parameters
    ----------
    T : array
        温度 [K]
    T_nose : float
        Nose温度 [K]
    t_nose : float
        Nose時間 [s]
    alpha : float
        温度依存性パラメータ

    Returns
    -------
    array
        変態時間 [s]
    """
    dT = (T - T_nose) / 100  # 正規化温度差
    return t_nose * np.exp(alpha * dT**2)

# フィッティング
p0 = [450 + 273.15, 100, 0.5]  # 初期推定値
popt, pcov = curve_fit(ttt_model, T_exp, t_start_exp, p0=p0)

T_nose_fit, t_nose_fit, alpha_fit = popt

print("フィッティング結果:")
print(f"  Nose温度: {T_nose_fit - 273.15:.1f}°C")
print(f"  Nose時間: {t_nose_fit:.1f} 秒")
print(f"  温度依存性 α: {alpha_fit:.3f}")

# フィッティング曲線
T_range = np.linspace(300, 650, 100) + 273.15
t_fit = ttt_model(T_range, *popt)

# プロット
plt.figure(figsize=(10, 8))
plt.scatter(t_start_exp, T_exp - 273.15, s=100, color='red',
            label='実験データ', zorder=3, edgecolors='black')
plt.plot(t_fit, T_range - 273.15, color='#11998e', linewidth=2.5,
         label=f'フィッティング曲線\n(Tn={T_nose_fit-273.15:.0f}°C, tn={t_nose_fit:.0f}s)')
plt.xscale('log')
plt.xlabel('時間 (秒)', fontsize=14)
plt.ylabel('温度 (°C)', fontsize=14)
plt.title('TTT曲線フィッティング', fontsize=16)
plt.legend(fontsize=12)
plt.grid(True, which='both', alpha=0.3)
plt.tight_layout()
plt.savefig('ttt_fitting.png', dpi=300)
plt.show()

# 残差評価
residuals = t_start_exp - ttt_model(T_exp, *popt)
ss_res = np.sum(residuals**2)
ss_tot = np.sum((t_start_exp - np.mean(t_start_exp))**2)
r_squared = 1 - (ss_res / ss_tot)

print(f"\nR²値: {r_squared:.4f}")
</code></pre>
            </details>
        </section>

        <section id="references">
            <h2>4.8 参考文献</h2>
            <ol>
                <li>Porter, D. A., Easterling, K. E., Sherif, M. Y. (2009). <em>Phase Transformations in Metals and Alloys</em>, 3rd Edition. CRC Press, pp. 200-280, 350-420.</li>
                <li>Christian, J. W. (2002). <em>The Theory of Transformations in Metals and Alloys</em>, 3rd Edition. Pergamon, pp. 450-520, 600-680.</li>
                <li>Aaronson, H. I., Enomoto, M., Lee, J. K. (2010). <em>Mechanisms of Diffusional Phase Transformations in Metals and Alloys</em>. CRC Press, pp. 1-85, 200-265.</li>
                <li>Scheil, E. (1942). Bemerkungen zur Schichtkristallbildung. <em>Zeitschrift für Metallkunde</em>, 34, pp. 70-72.</li>
                <li>Gulliver, G. H. (1913). The quantitative effect of rapid cooling upon the constitution of binary alloys. <em>Journal of the Institute of Metals</em>, 9, pp. 120-157.</li>
                <li>Kurz, W., Fisher, D. J. (1998). <em>Fundamentals of Solidification</em>, 4th Edition. Trans Tech Publications, pp. 65-120, 180-240.</li>
                <li>Hillert, M. (2008). <em>Phase Equilibria, Phase Diagrams and Phase Transformations</em>, 2nd Edition. Cambridge University Press, pp. 250-310.</li>
            </ol>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 CT Dojo. All rights reserved.</p>
        <p><a href="../index.html">CTドメインホームへ戻る</a> | <a href="index.html">CALPHAD法入門トップへ</a></p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>