<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬3ç« : ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã¨ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ç†è«– | åŸºç¤æ•°ç†é“å ´ - åå¾®åˆ†æ–¹ç¨‹å¼ã¨å¢ƒç•Œå€¤å•é¡Œ</title>
    <meta name="description" content="ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã¨ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ç†è«–ï¼šèª¿å’Œé–¢æ•°ã€æ¥µåº§æ¨™ãƒ»å††ç­’åº§æ¨™ã§ã®è§£æ³•ã€ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ã€ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã€æ•°å€¤è§£æ³•ã‚’å­¦ã³ã€å®šå¸¸çŠ¶æ…‹å•é¡Œã¸ã®å¿œç”¨ã‚’å®Ÿè£…ã—ã¾ã™ã€‚">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8;
            color: #333;
            background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
        }
        .breadcrumb {
            max-width: 1200px;
            margin: 1rem auto;
            padding: 0 1rem;
            font-size: 0.9rem;
        }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        h1 { font-size: 2rem; margin-bottom: 1rem; }
        h2 {
            font-size: 1.5rem;
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #764ba2;
            color: #667eea;
        }
        h3 { font-size: 1.2rem; margin: 1.5rem 0 1rem; color: #555; }
        p { margin-bottom: 1rem; }
        ul, ol { margin: 1rem 0 1rem 2rem; }
        li { margin-bottom: 0.5rem; }
        .theory-box {
            background: linear-gradient(to right, #f0f4ff, #faf5ff);
            border-left: 4px solid #667eea;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }
        .code-example {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .code-title {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            margin-top: 1.5rem;
        }
        .exercise {
            background: #fff9e6;
            border-left: 4px solid #f59e0b;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            gap: 1rem;
        }
        .nav-button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.3s;
        }
        .nav-button:hover { transform: translateY(-2px); }
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 4rem;
        }
        @media (max-width: 768px) {
            .content { padding: 1.5rem; }
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.3rem; }
            .navigation { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ“ ç¬¬3ç« : ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã¨ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ç†è«–</h1>
        <p>Laplace Equation and Potential Theory</p>
    </header>

    <div class="breadcrumb">
        <a href="../../index.html">ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹</a> &gt;
        <a href="../index.html">åŸºç¤æ•°ç†é“å ´</a> &gt;
        <a href="index.html">åå¾®åˆ†æ–¹ç¨‹å¼ã¨å¢ƒç•Œå€¤å•é¡Œ</a> &gt;
        ç¬¬3ç« 
    </div>

    <div class="container">
        <div class="content">
            <h2>ğŸ¯ å­¦ç¿’ç›®æ¨™</h2>
            <ul>
                <li>ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã¨ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ç†è«–ã®åŸºç¤ã‚’ç†è§£ã™ã‚‹</li>
                <li>èª¿å’Œé–¢æ•°ã®æ€§è³ªã¨æœ€å¤§å€¤åŸç†ã‚’å­¦ã¶</li>
                <li>æ¥µåº§æ¨™ãƒ»å††ç­’åº§æ¨™ã§ã®ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã‚’è§£ã</li>
                <li>ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ã«ã‚ˆã‚‹å¢ƒç•Œå€¤å•é¡Œã®è§£æ³•ã‚’ç¿’å¾—ã™ã‚‹</li>
                <li>ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã¨é›»è·åˆ†å¸ƒãƒ»ç†±æºã®æ‰±ã„ã‚’ç†è§£ã™ã‚‹</li>
                <li>åå¾©æ³•ã«ã‚ˆã‚‹æ•°å€¤è§£æ³•ï¼ˆJacobiæ³•ã€Gauss-Seidelæ³•ã€SORæ³•ï¼‰ã‚’å®Ÿè£…ã™ã‚‹</li>
                <li>ææ–™ç§‘å­¦ã¸ã®å¿œç”¨ï¼ˆé™é›»å ´è§£æã€å®šå¸¸ç†±ä¼å°ï¼‰ã‚’ç†è§£ã™ã‚‹</li>
            </ul>
        </div>

        <div class="content">
            <h2>ğŸ“– ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã¨ã¯</h2>
            
            <div class="theory-box">
                <h3>ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã®å®šç¾©</h3>
                <p><strong>ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ï¼ˆLaplace equationï¼‰</strong>ã¯ã€ä»¥ä¸‹ã®å½¢å¼ã®æ¥•å††å‹åå¾®åˆ†æ–¹ç¨‹å¼ã§ã™ï¼š</p>
                <p>\[
                \nabla^2 u = \frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} + \frac{\partial^2 u}{\partial z^2} = 0
                \]</p>
                <p>ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã®è§£ã‚’<strong>èª¿å’Œé–¢æ•°ï¼ˆharmonic functionï¼‰</strong>ã¨å‘¼ã³ã¾ã™ã€‚</p>
                <p><strong>ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ï¼ˆPoisson equationï¼‰</strong>ã¯ã€å³è¾ºãŒéã‚¼ãƒ­ã®å ´åˆã§ã™ï¼š</p>
                <p>\[
                \nabla^2 u = f(x,y,z)
                \]</p>
                <p>ã“ã“ã§ \(f\) ã¯ç†±æºã‚„é›»è·å¯†åº¦ã‚’è¡¨ã—ã¾ã™ã€‚</p>
            </div>

            <h3>ç‰©ç†çš„æ„ç¾©</h3>
            <ul>
                <li><strong>é™é›»ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</strong>: é›»è·ã®ãªã„é ˜åŸŸã§ã®é›»ä½ \(V\) ã¯ \(\nabla^2 V = 0\)</li>
                <li><strong>å®šå¸¸ç†±ä¼å°</strong>: ç†±æºã®ãªã„é ˜åŸŸã§ã®æ¸©åº¦åˆ†å¸ƒ \(T\) ã¯ \(\nabla^2 T = 0\)</li>
                <li><strong>æµä½“ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</strong>: éåœ§ç¸®ãƒ»éç²˜æ€§æµä½“ã®é€Ÿåº¦ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ« \(\phi\) ã¯ \(\nabla^2 \phi = 0\)</li>
                <li><strong>é‡åŠ›ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</strong>: è³ªé‡ã®ãªã„é ˜åŸŸã§ã®é‡åŠ›ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</li>
            </ul>

            <div class="theory-box">
                <h3>èª¿å’Œé–¢æ•°ã®æ€§è³ª</h3>
                <p><strong>æœ€å¤§å€¤åŸç†ï¼ˆMaximum Principleï¼‰</strong>: èª¿å’Œé–¢æ•°ã¯å†…éƒ¨ã«æ¥µå€¤ã‚’æŒãŸãšã€æœ€å¤§å€¤ãƒ»æœ€å°å€¤ã¯å¢ƒç•Œä¸Šã§é”æˆã•ã‚Œã¾ã™ã€‚</p>
                <p><strong>å¹³å‡å€¤å®šç†ï¼ˆMean Value Theoremï¼‰</strong>: ç‚¹ \((x_0, y_0)\) ã«ãŠã‘ã‚‹èª¿å’Œé–¢æ•°ã®å€¤ã¯ã€ãã®ç‚¹ã‚’ä¸­å¿ƒã¨ã™ã‚‹å††å‘¨ä¸Šã®å¹³å‡å€¤ã«ç­‰ã—ã„ï¼š</p>
                <p>\[
                u(x_0, y_0) = \frac{1}{2\pi} \int_0^{2\pi} u(x_0 + r\cos\theta, y_0 + r\sin\theta) d\theta
                \]</p>
                <p><strong>ä¸€æ„æ€§</strong>: ãƒ‡ã‚£ãƒªã‚¯ãƒ¬å¢ƒç•Œæ¡ä»¶ã®ã‚‚ã¨ã§ã€ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã®è§£ã¯ä¸€æ„çš„ã§ã™ã€‚</p>
            </div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ3.1: èª¿å’Œé–¢æ•°ã¨æœ€å¤§å€¤åŸç†ã®æ¤œè¨¼</h2>
            
            <div class="code-title">Pythonå®Ÿè£…: èª¿å’Œé–¢æ•°ã®æ€§è³ªç¢ºèª</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

# èª¿å’Œé–¢æ•°ã®ä¾‹: u(x,y) = x^2 - y^2 (å®Ÿéƒ¨ z^2 ã®èª¿å’Œé–¢æ•°)
def harmonic_function(x, y):
    return x**2 - y**2

# 2æ¬¡å…ƒã‚°ãƒªãƒƒãƒ‰ä½œæˆ
x = np.linspace(-2, 2, 100)
y = np.linspace(-2, 2, 100)
X, Y = np.meshgrid(x, y)
U = harmonic_function(X, Y)

# ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³ã®è¨ˆç®—ï¼ˆæ•°å€¤å¾®åˆ†ï¼‰
dx = x[1] - x[0]
dy = y[1] - y[0]

# 2æ¬¡åå¾®åˆ†
d2u_dx2 = np.zeros_like(U)
d2u_dy2 = np.zeros_like(U)

for i in range(1, len(x)-1):
    for j in range(1, len(y)-1):
        d2u_dx2[j, i] = (U[j, i+1] - 2*U[j, i] + U[j, i-1]) / dx**2
        d2u_dy2[j, i] = (U[j+1, i] - 2*U[j, i] + U[j-1, i]) / dy**2

laplacian = d2u_dx2 + d2u_dy2

# å¯è¦–åŒ–
fig = plt.figure(figsize=(15, 5))

# èª¿å’Œé–¢æ•°
ax1 = fig.add_subplot(131, projection='3d')
ax1.plot_surface(X, Y, U, cmap='viridis', alpha=0.8)
ax1.set_xlabel('x')
ax1.set_ylabel('y')
ax1.set_zlabel('u(x,y)')
ax1.set_title('èª¿å’Œé–¢æ•°: u = xÂ² - yÂ²')

# ç­‰é«˜ç·šå›³
ax2 = fig.add_subplot(132)
contour = ax2.contour(X, Y, U, levels=20, cmap='viridis')
ax2.clabel(contour, inline=True, fontsize=8)
ax2.set_xlabel('x')
ax2.set_ylabel('y')
ax2.set_title('ç­‰é«˜ç·šå›³')
ax2.axis('equal')

# ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³
ax3 = fig.add_subplot(133)
laplacian_plot = ax3.imshow(laplacian[1:-1, 1:-1], extent=[-2, 2, -2, 2], 
                             origin='lower', cmap='RdBu', vmin=-0.1, vmax=0.1)
plt.colorbar(laplacian_plot, ax=ax3, label='âˆ‡Â²u')
ax3.set_xlabel('x')
ax3.set_ylabel('y')
ax3.set_title(f'ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³ (max: {np.max(np.abs(laplacian[1:-1,1:-1])):.2e})')

plt.tight_layout()
plt.savefig('laplace_harmonic_function.png', dpi=300, bbox_inches='tight')
plt.show()

# æœ€å¤§å€¤åŸç†ã®æ¤œè¨¼
print("=== æœ€å¤§å€¤åŸç†ã®æ¤œè¨¼ ===")
print(f"å†…éƒ¨ã®æœ€å¤§å€¤: {np.max(U[10:-10, 10:-10]):.4f}")
print(f"å¢ƒç•Œã®æœ€å¤§å€¤: {np.max([np.max(U[0,:]), np.max(U[-1,:]), np.max(U[:,0]), np.max(U[:,-1])]):.4f}")
print(f"å†…éƒ¨ã®æœ€å°å€¤: {np.min(U[10:-10, 10:-10]):.4f}")
print(f"å¢ƒç•Œã®æœ€å°å€¤: {np.min([np.min(U[0,:]), np.min(U[-1,:]), np.min(U[:,0]), np.min(U[:,-1])]):.4f}")
</div>
            <p><strong>å‡ºåŠ›è§£èª¬</strong>:</p>
            <ul>
                <li>\(u = x^2 - y^2\) ã¯èª¿å’Œé–¢æ•°ï¼ˆ\(\nabla^2 u = 2 - 2 = 0\)ï¼‰</li>
                <li>ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³ãŒæ•°å€¤èª¤å·®ã®ç¯„å›²å†…ã§ã‚¼ãƒ­ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª</li>
                <li>æœ€å¤§å€¤åŸç†ã«ã‚ˆã‚Šã€æ¥µå€¤ã¯å¢ƒç•Œä¸Šã«å­˜åœ¨</li>
            </ul>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ3.2: æ¥µåº§æ¨™ã§ã®ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ï¼ˆå††å½¢é ˜åŸŸï¼‰</h2>
            
            <div class="theory-box">
                <h3>æ¥µåº§æ¨™ã§ã®ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼</h3>
                <p>æ¥µåº§æ¨™ \((r, \theta)\) ã§ã¯ã€ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã¯ï¼š</p>
                <p>\[
                \nabla^2 u = \frac{1}{r}\frac{\partial}{\partial r}\left(r\frac{\partial u}{\partial r}\right) + \frac{1}{r^2}\frac{\partial^2 u}{\partial \theta^2} = 0
                \]</p>
                <p>å¤‰æ•°åˆ†é›¢ \(u(r,\theta) = R(r)\Theta(\theta)\) ã«ã‚ˆã‚Šï¼š</p>
                <p>\[
                R(r) = A r^n + B r^{-n}, \quad \Theta(\theta) = C \cos(n\theta) + D \sin(n\theta)
                \]</p>
            </div>

            <div class="code-title">Pythonå®Ÿè£…: å††å½¢é ˜åŸŸã®ãƒ‡ã‚£ãƒªã‚¯ãƒ¬å•é¡Œ</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

# å¢ƒç•Œæ¡ä»¶: u(a, Î¸) = f(Î¸) = sin(3Î¸) (åŠå¾„ a ã®å††å‘¨ä¸Š)
a = 1.0  # å††ã®åŠå¾„
n = 3    # ãƒ¢ãƒ¼ãƒ‰æ•°

def boundary_condition(theta):
    return np.sin(n * theta)

def analytical_solution(r, theta):
    """è§£æè§£: u(r,Î¸) = (r/a)^n sin(nÎ¸)"""
    return (r / a)**n * np.sin(n * theta)

# æ¥µåº§æ¨™ã‚°ãƒªãƒƒãƒ‰
r_vals = np.linspace(0, a, 50)
theta_vals = np.linspace(0, 2*np.pi, 100)
R, THETA = np.meshgrid(r_vals, theta_vals)

# è§£ã®è¨ˆç®—
U_analytical = analytical_solution(R, THETA)

# ãƒ‡ã‚«ãƒ«ãƒˆåº§æ¨™å¤‰æ›
X = R * np.cos(THETA)
Y = R * np.sin(THETA)

# å¯è¦–åŒ–
fig = plt.figure(figsize=(15, 5))

# 3Dãƒ—ãƒ­ãƒƒãƒˆ
ax1 = fig.add_subplot(131, projection='3d')
surf = ax1.plot_surface(X, Y, U_analytical, cmap='coolwarm', alpha=0.8)
ax1.set_xlabel('x')
ax1.set_ylabel('y')
ax1.set_zlabel('u(r,Î¸)')
ax1.set_title(f'è§£æè§£: u = (r/a)Â³ sin(3Î¸)')
plt.colorbar(surf, ax=ax1, shrink=0.5)

# æ¥µåº§æ¨™ã§ã®ç­‰é«˜ç·š
ax2 = fig.add_subplot(132, projection='polar')
contour = ax2.contourf(THETA, R, U_analytical, levels=20, cmap='coolwarm')
plt.colorbar(contour, ax=ax2, label='u(r,Î¸)')
ax2.set_title('æ¥µåº§æ¨™ã§ã®ç­‰é«˜ç·šå›³')

# ãƒ‡ã‚«ãƒ«ãƒˆåº§æ¨™ã§ã®ç­‰é«˜ç·š
ax3 = fig.add_subplot(133)
contour2 = ax3.contourf(X, Y, U_analytical, levels=20, cmap='coolwarm')
ax3.set_xlabel('x')
ax3.set_ylabel('y')
ax3.set_title('ãƒ‡ã‚«ãƒ«ãƒˆåº§æ¨™ã§ã®ç­‰é«˜ç·šå›³')
ax3.axis('equal')
plt.colorbar(contour2, ax=ax3, label='u(x,y)')

plt.tight_layout()
plt.savefig('laplace_polar_coordinates.png', dpi=300, bbox_inches='tight')
plt.show()

# å¢ƒç•Œæ¡ä»¶ã®æ¤œè¨¼
theta_test = np.linspace(0, 2*np.pi, 100)
u_boundary = analytical_solution(a, theta_test)
u_bc = boundary_condition(theta_test)

print("=== å¢ƒç•Œæ¡ä»¶ã®æ¤œè¨¼ ===")
print(f"å¢ƒç•Œã§ã®èª¤å·®: {np.max(np.abs(u_boundary - u_bc)):.2e}")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ3.3: çŸ©å½¢é ˜åŸŸã§ã®ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ï¼ˆå¤‰æ•°åˆ†é›¢æ³•ï¼‰</h2>
            
            <div class="code-title">Pythonå®Ÿè£…: çŸ©å½¢é ˜åŸŸã®ãƒ‡ã‚£ãƒªã‚¯ãƒ¬å•é¡Œ</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

# çŸ©å½¢é ˜åŸŸ: 0 < x < L, 0 < y < H
# å¢ƒç•Œæ¡ä»¶: u(x,0)=0, u(x,H)=sin(Ï€x/L), u(0,y)=0, u(L,y)=0
L = 1.0  # é•·ã•
H = 1.0  # é«˜ã•

def analytical_solution(x, y, n_terms=50):
    """å¤‰æ•°åˆ†é›¢æ³•ã«ã‚ˆã‚‹è§£æè§£
    u(x,y) = Î£ B_n sin(nÏ€x/L) sinh(nÏ€y/L) / sinh(nÏ€H/L)
    """
    u = np.zeros_like(x)
    for n in range(1, n_terms + 1):
        if n == 1:
            # B_1 = 1 (ãƒ•ãƒ¼ãƒªã‚¨ä¿‚æ•°)
            B_n = 1.0
        else:
            # ä»–ã®é …ã¯0ï¼ˆå¢ƒç•Œæ¡ä»¶ãŒ sin(Ï€x/L) ã®ãŸã‚ï¼‰
            B_n = 0.0
        
        u += B_n * np.sin(n * np.pi * x / L) * \
             np.sinh(n * np.pi * y / L) / np.sinh(n * np.pi * H / L)
    
    return u

# ã‚°ãƒªãƒƒãƒ‰ä½œæˆ
Nx, Ny = 100, 100
x = np.linspace(0, L, Nx)
y = np.linspace(0, H, Ny)
X, Y = np.meshgrid(x, y)

# è§£æè§£
U_analytical = analytical_solution(X, Y)

# å¯è¦–åŒ–
fig = plt.figure(figsize=(15, 5))

# 3Dãƒ—ãƒ­ãƒƒãƒˆ
ax1 = fig.add_subplot(131, projection='3d')
surf = ax1.plot_surface(X, Y, U_analytical, cmap='viridis', alpha=0.8)
ax1.set_xlabel('x')
ax1.set_ylabel('y')
ax1.set_zlabel('u(x,y)')
ax1.set_title('è§£æè§£ï¼ˆå¤‰æ•°åˆ†é›¢æ³•ï¼‰')
plt.colorbar(surf, ax=ax1, shrink=0.5)

# ç­‰é«˜ç·šå›³
ax2 = fig.add_subplot(132)
contour = ax2.contourf(X, Y, U_analytical, levels=20, cmap='viridis')
ax2.set_xlabel('x')
ax2.set_ylabel('y')
ax2.set_title('ç­‰é«˜ç·šå›³')
plt.colorbar(contour, ax=ax2, label='u(x,y)')

# yæ–¹å‘ã®æ–­é¢
ax3 = fig.add_subplot(133)
x_sections = [0.25, 0.5, 0.75]
for x_val in x_sections:
    idx = np.argmin(np.abs(x - x_val))
    ax3.plot(y, U_analytical[:, idx], label=f'x = {x_val:.2f}')
ax3.set_xlabel('y')
ax3.set_ylabel('u(x,y)')
ax3.set_title('yæ–¹å‘ã®æ–­é¢')
ax3.legend()
ax3.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('laplace_rectangular_domain.png', dpi=300, bbox_inches='tight')
plt.show()

# å¢ƒç•Œæ¡ä»¶ã®æ¤œè¨¼
print("=== å¢ƒç•Œæ¡ä»¶ã®æ¤œè¨¼ ===")
print(f"u(x,0) ã®æœ€å¤§å€¤: {np.max(np.abs(U_analytical[0, :])):.2e}")
print(f"u(0,y) ã®æœ€å¤§å€¤: {np.max(np.abs(U_analytical[:, 0])):.2e}")
print(f"u(L,y) ã®æœ€å¤§å€¤: {np.max(np.abs(U_analytical[:, -1])):.2e}")
print(f"u(x,H) vs sin(Ï€x/L) ã®èª¤å·®: {np.max(np.abs(U_analytical[-1,:] - np.sin(np.pi*x/L))):.2e}")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ3.4: ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ã«ã‚ˆã‚‹å¢ƒç•Œå€¤å•é¡Œ</h2>
            
            <div class="theory-box">
                <h3>ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°</h3>
                <p><strong>ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ï¼ˆGreen's functionï¼‰</strong> \(G(\mathbf{r}, \mathbf{r}')\) ã¯ã€ç‚¹æºã«å¯¾ã™ã‚‹å¿œç­”ã‚’è¡¨ã—ã¾ã™ï¼š</p>
                <p>\[
                \nabla^2 G(\mathbf{r}, \mathbf{r}') = \delta(\mathbf{r} - \mathbf{r}')
                \]</p>
                <p>3æ¬¡å…ƒã§ã®åŸºæœ¬è§£ï¼ˆè‡ªç”±ç©ºé–“ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ï¼‰ï¼š</p>
                <p>\[
                G(\mathbf{r}, \mathbf{r}') = -\frac{1}{4\pi|\mathbf{r} - \mathbf{r}'|}
                \]</p>
                <p>ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ \(\nabla^2 u = f\) ã®è§£ã¯ï¼š</p>
                <p>\[
                u(\mathbf{r}) = \int G(\mathbf{r}, \mathbf{r}') f(\mathbf{r}') d^3\mathbf{r}'
                \]</p>
            </div>

            <div class="code-title">Pythonå®Ÿè£…: ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ã«ã‚ˆã‚‹è§£ã®æ§‹æˆ</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

# 2æ¬¡å…ƒã‚°ãƒªãƒ¼ãƒ³é–¢æ•°: G(r,r') = -1/(2Ï€) ln|r-r'|
def green_function_2d(x, y, x_prime, y_prime):
    """2æ¬¡å…ƒã®ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°"""
    r = np.sqrt((x - x_prime)**2 + (y - y_prime)**2)
    # ç‰¹ç•°ç‚¹ã‚’é¿ã‘ã‚‹
    r = np.where(r < 1e-10, 1e-10, r)
    return -np.log(r) / (2 * np.pi)

# ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼: âˆ‡Â²u = f
# ä¾‹: f(x,y) = exp(-(xÂ²+yÂ²)) (ã‚¬ã‚¦ã‚¹å‹ç†±æº)
def source_function(x, y):
    return np.exp(-(x**2 + y**2))

# ã‚°ãƒªãƒƒãƒ‰è¨­å®š
N = 100
x = np.linspace(-2, 2, N)
y = np.linspace(-2, 2, N)
X, Y = np.meshgrid(x, y)

# æ•°å€¤ç©åˆ†ã«ã‚ˆã‚‹ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°è§£ã®æ§‹æˆ
dx = x[1] - x[0]
dy = y[1] - y[0]

U = np.zeros((N, N))
for i in range(N):
    for j in range(N):
        # å„ç‚¹ã§ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ã«ã‚ˆã‚‹ç•³ã¿è¾¼ã¿ç©åˆ†
        G = green_function_2d(X, Y, x[i], y[j])
        F = source_function(X, Y)
        U[j, i] = np.sum(G * F) * dx * dy

# ç‚¹æºã®ä¾‹ï¼ˆx'=0.5, y'=0.5ï¼‰
x_source, y_source = 0.5, 0.5
G_point = green_function_2d(X, Y, x_source, y_source)

# å¯è¦–åŒ–
fig = plt.figure(figsize=(15, 5))

# ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°
ax1 = fig.add_subplot(131, projection='3d')
surf1 = ax1.plot_surface(X, Y, G_point, cmap='coolwarm', alpha=0.8)
ax1.set_xlabel('x')
ax1.set_ylabel('y')
ax1.set_zlabel('G(r,r\')')
ax1.set_title(f'ã‚°ãƒªãƒ¼ãƒ³é–¢æ•° (ç‚¹æº: ({x_source}, {y_source}))')
plt.colorbar(surf1, ax=ax1, shrink=0.5)

# ç†±æºé–¢æ•°
ax2 = fig.add_subplot(132, projection='3d')
F = source_function(X, Y)
surf2 = ax2.plot_surface(X, Y, F, cmap='hot', alpha=0.8)
ax2.set_xlabel('x')
ax2.set_ylabel('y')
ax2.set_zlabel('f(x,y)')
ax2.set_title('ç†±æºåˆ†å¸ƒ: f = exp(-(xÂ²+yÂ²))')
plt.colorbar(surf2, ax=ax2, shrink=0.5)

# ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®è§£
ax3 = fig.add_subplot(133, projection='3d')
surf3 = ax3.plot_surface(X, Y, U, cmap='viridis', alpha=0.8)
ax3.set_xlabel('x')
ax3.set_ylabel('y')
ax3.set_zlabel('u(x,y)')
ax3.set_title('ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®è§£')
plt.colorbar(surf3, ax=ax3, shrink=0.5)

plt.tight_layout()
plt.savefig('laplace_green_function.png', dpi=300, bbox_inches='tight')
plt.show()

print("=== ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ã«ã‚ˆã‚‹è§£ã®æ§‹æˆ ===")
print(f"è§£ã®æœ€å¤§å€¤: {np.max(U):.4f}")
print(f"è§£ã®æœ€å°å€¤: {np.min(U):.4f}")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ3.5: ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ï¼ˆé›»è·åˆ†å¸ƒã¨é›»ä½ï¼‰</h2>
            
            <div class="code-title">Pythonå®Ÿè£…: é›»è·åˆ†å¸ƒã‹ã‚‰ã®é›»ä½è¨ˆç®—</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

# ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼: âˆ‡Â²V = -Ï/Îµâ‚€ (é›»ä½ã¨é›»è·å¯†åº¦)
# ä¾‹: 2ç‚¹é›»è·ã«ã‚ˆã‚‹é›»ä½åˆ†å¸ƒ

epsilon_0 = 8.854e-12  # çœŸç©ºã®èª˜é›»ç‡ (F/m)
q1 = 1e-9  # é›»è·1 (C)
q2 = -1e-9  # é›»è·2 (C)
r1 = np.array([-0.5, 0.0])  # é›»è·1ã®ä½ç½®
r2 = np.array([0.5, 0.0])   # é›»è·2ã®ä½ç½®

def point_charge_potential(x, y, q, r_charge):
    """ç‚¹é›»è·ã«ã‚ˆã‚‹é›»ä½: V = q/(4Ï€Îµâ‚€r)"""
    r = np.sqrt((x - r_charge[0])**2 + (y - r_charge[1])**2)
    r = np.where(r < 0.01, 0.01, r)  # ç‰¹ç•°ç‚¹å›é¿
    return q / (4 * np.pi * epsilon_0 * r)

def electric_field(x, y, q, r_charge):
    """ç‚¹é›»è·ã«ã‚ˆã‚‹é›»å ´: E = -âˆ‡V"""
    r_vec = np.array([x - r_charge[0], y - r_charge[1]])
    r = np.sqrt(r_vec[0]**2 + r_vec[1]**2)
    r = np.where(r < 0.01, 0.01, r)
    E = q * r_vec / (4 * np.pi * epsilon_0 * r**3)
    return E

# ã‚°ãƒªãƒƒãƒ‰ä½œæˆ
N = 200
x = np.linspace(-2, 2, N)
y = np.linspace(-2, 2, N)
X, Y = np.meshgrid(x, y)

# é‡ã­åˆã‚ã›ã®åŸç†ã«ã‚ˆã‚‹é›»ä½
V1 = point_charge_potential(X, Y, q1, r1)
V2 = point_charge_potential(X, Y, q2, r2)
V_total = V1 + V2

# é›»å ´ã®è¨ˆç®—
E1 = electric_field(X, Y, q1, r1)
E2 = electric_field(X, Y, q2, r2)
Ex_total = E1[0] + E2[0]
Ey_total = E1[1] + E2[1]

# å¯è¦–åŒ–
fig = plt.figure(figsize=(15, 5))

# é›»ä½åˆ†å¸ƒ
ax1 = fig.add_subplot(131)
# å¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«ã§å¯è¦–åŒ–ï¼ˆåºƒç¯„å›²ã®å€¤ã«å¯¾å¿œï¼‰
V_plot = np.clip(V_total, -1e3, 1e3)
contour1 = ax1.contourf(X, Y, V_plot, levels=50, cmap='RdBu_r')
ax1.plot(r1[0], r1[1], 'ro', markersize=10, label=f'qâ‚={q1*1e9:.1f}nC')
ax1.plot(r2[0], r2[1], 'bo', markersize=10, label=f'qâ‚‚={q2*1e9:.1f}nC')
ax1.set_xlabel('x (m)')
ax1.set_ylabel('y (m)')
ax1.set_title('é›»ä½åˆ†å¸ƒ V(x,y)')
ax1.legend()
plt.colorbar(contour1, ax=ax1, label='V (V)')

# ç­‰é›»ä½ç·šã¨é›»å ´ãƒ™ã‚¯ãƒˆãƒ«
ax2 = fig.add_subplot(132)
contour2 = ax2.contour(X, Y, V_plot, levels=20, colors='gray', linewidths=0.5)
# é›»å ´ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆé–“å¼•ã„ã¦ãƒ—ãƒ­ãƒƒãƒˆï¼‰
skip = 10
ax2.quiver(X[::skip, ::skip], Y[::skip, ::skip], 
           Ex_total[::skip, ::skip], Ey_total[::skip, ::skip],
           color='blue', alpha=0.6)
ax2.plot(r1[0], r1[1], 'ro', markersize=10)
ax2.plot(r2[0], r2[1], 'bo', markersize=10)
ax2.set_xlabel('x (m)')
ax2.set_ylabel('y (m)')
ax2.set_title('é›»å ´ãƒ™ã‚¯ãƒˆãƒ« E = -âˆ‡V')
ax2.axis('equal')

# xè»¸ä¸Šã®é›»ä½ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
ax3 = fig.add_subplot(133)
y_idx = N // 2
ax3.plot(x, V_plot[y_idx, :], 'k-', linewidth=2)
ax3.axvline(r1[0], color='r', linestyle='--', alpha=0.5, label='qâ‚ä½ç½®')
ax3.axvline(r2[0], color='b', linestyle='--', alpha=0.5, label='qâ‚‚ä½ç½®')
ax3.set_xlabel('x (m)')
ax3.set_ylabel('V (V)')
ax3.set_title('xè»¸ä¸Šã®é›»ä½ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«')
ax3.grid(True, alpha=0.3)
ax3.legend()

plt.tight_layout()
plt.savefig('poisson_electric_potential.png', dpi=300, bbox_inches='tight')
plt.show()

print("=== é›»è·åˆ†å¸ƒã¨é›»ä½ ===")
print(f"ä¸­å¿ƒç‚¹(0,0)ã®é›»ä½: {point_charge_potential(0, 0, q1, r1) + point_charge_potential(0, 0, q2, r2):.2e} V")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ3.6: åå¾©æ³•ã«ã‚ˆã‚‹æ•°å€¤è§£æ³•ï¼ˆJacobiæ³•ï¼‰</h2>
            
            <div class="theory-box">
                <h3>åå¾©æ³•ã®åŸºç¤</h3>
                <p>ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã®å·®åˆ†è¿‘ä¼¼ï¼š</p>
                <p>\[
                \frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{\Delta x^2} + \frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{\Delta y^2} = 0
                \]</p>
                <p><strong>Jacobiæ³•</strong>: å„ç‚¹ã‚’å‘¨å›²4ç‚¹ã®å¹³å‡å€¤ã§æ›´æ–°</p>
                <p>\[
                u_{i,j}^{(k+1)} = \frac{1}{4}(u_{i+1,j}^{(k)} + u_{i-1,j}^{(k)} + u_{i,j+1}^{(k)} + u_{i,j-1}^{(k)})
                \]</p>
            </div>

            <div class="code-title">Pythonå®Ÿè£…: Jacobiæ³•ã«ã‚ˆã‚‹åå¾©è§£æ³•</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

def jacobi_method(u_init, boundary_mask, max_iter=10000, tol=1e-6):
    """Jacobiæ³•ã«ã‚ˆã‚‹åå¾©è§£æ³•
    
    Parameters:
    - u_init: åˆæœŸå€¤
    - boundary_mask: True=å¢ƒç•Œç‚¹, False=å†…éƒ¨ç‚¹
    - max_iter: æœ€å¤§åå¾©å›æ•°
    - tol: åæŸåˆ¤å®šã®é–¾å€¤
    """
    u = u_init.copy()
    u_new = u.copy()
    residual_history = []
    
    for iteration in range(max_iter):
        # å†…éƒ¨ç‚¹ã®æ›´æ–°ï¼ˆå‘¨å›²4ç‚¹ã®å¹³å‡ï¼‰
        u_new[1:-1, 1:-1] = 0.25 * (u[2:, 1:-1] + u[:-2, 1:-1] + 
                                      u[1:-1, 2:] + u[1:-1, :-2])
        
        # å¢ƒç•Œå€¤ã‚’ä¿æŒ
        u_new[boundary_mask] = u[boundary_mask]
        
        # åæŸåˆ¤å®šï¼ˆæ®‹å·®ã®L2ãƒãƒ«ãƒ ï¼‰
        residual = np.linalg.norm(u_new - u) / np.linalg.norm(u_new)
        residual_history.append(residual)
        
        if residual < tol:
            print(f"åæŸ: iteration = {iteration}, residual = {residual:.2e}")
            break
        
        u = u_new.copy()
    
    return u_new, residual_history

# å•é¡Œè¨­å®š: çŸ©å½¢é ˜åŸŸ [0,1]Ã—[0,1]
# å¢ƒç•Œæ¡ä»¶: u(x,0)=0, u(x,1)=sin(Ï€x), u(0,y)=0, u(1,y)=0
Nx, Ny = 50, 50
x = np.linspace(0, 1, Nx)
y = np.linspace(0, 1, Ny)
X, Y = np.meshgrid(x, y)

# åˆæœŸå€¤ã¨å¢ƒç•Œæ¡ä»¶
u_init = np.zeros((Ny, Nx))
boundary_mask = np.zeros((Ny, Nx), dtype=bool)

# å¢ƒç•Œæ¡ä»¶è¨­å®š
u_init[0, :] = 0  # y=0
u_init[-1, :] = np.sin(np.pi * x)  # y=1
u_init[:, 0] = 0  # x=0
u_init[:, -1] = 0  # x=1

boundary_mask[0, :] = True
boundary_mask[-1, :] = True
boundary_mask[:, 0] = True
boundary_mask[:, -1] = True

# Jacobiæ³•ã§è§£ã
u_jacobi, residual_history = jacobi_method(u_init, boundary_mask, max_iter=10000, tol=1e-6)

# å¯è¦–åŒ–
fig = plt.figure(figsize=(15, 5))

# æ•°å€¤è§£
ax1 = fig.add_subplot(131, projection='3d')
surf = ax1.plot_surface(X, Y, u_jacobi, cmap='viridis', alpha=0.8)
ax1.set_xlabel('x')
ax1.set_ylabel('y')
ax1.set_zlabel('u(x,y)')
ax1.set_title('Jacobiæ³•ã«ã‚ˆã‚‹æ•°å€¤è§£')
plt.colorbar(surf, ax=ax1, shrink=0.5)

# ç­‰é«˜ç·šå›³
ax2 = fig.add_subplot(132)
contour = ax2.contourf(X, Y, u_jacobi, levels=20, cmap='viridis')
ax2.set_xlabel('x')
ax2.set_ylabel('y')
ax2.set_title('ç­‰é«˜ç·šå›³')
plt.colorbar(contour, ax=ax2, label='u(x,y)')

# åæŸå±¥æ­´
ax3 = fig.add_subplot(133)
ax3.semilogy(residual_history, 'b-', linewidth=2)
ax3.set_xlabel('Iteration')
ax3.set_ylabel('Residual (L2 norm)')
ax3.set_title('åæŸå±¥æ­´')
ax3.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('laplace_jacobi_method.png', dpi=300, bbox_inches='tight')
plt.show()

print(f"=== Jacobiæ³•ã®çµæœ ===")
print(f"åå¾©å›æ•°: {len(residual_history)}")
print(f"æœ€çµ‚æ®‹å·®: {residual_history[-1]:.2e}")
print(f"è§£ã®æœ€å¤§å€¤: {np.max(u_jacobi):.4f}")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ3.7: Gauss-Seidelæ³•ã¨SORæ³•ã®æ¯”è¼ƒ</h2>
            
            <div class="theory-box">
                <h3>é«˜é€ŸåŒ–æ‰‹æ³•</h3>
                <p><strong>Gauss-Seidelæ³•</strong>: æ›´æ–°ã•ã‚ŒãŸå€¤ã‚’å³åº§ã«ä½¿ç”¨</p>
                <p>\[
                u_{i,j}^{(k+1)} = \frac{1}{4}(u_{i+1,j}^{(k)} + u_{i-1,j}^{(k+1)} + u_{i,j+1}^{(k)} + u_{i,j-1}^{(k+1)})
                \]</p>
                <p><strong>SORæ³•ï¼ˆSuccessive Over-Relaxationï¼‰</strong>: ç·©å’Œä¿‚æ•° \(\omega\) ã§åæŸåŠ é€Ÿ</p>
                <p>\[
                u_{i,j}^{(k+1)} = (1-\omega)u_{i,j}^{(k)} + \omega \cdot \frac{1}{4}(u_{i+1,j}^{(k)} + u_{i-1,j}^{(k+1)} + u_{i,j+1}^{(k)} + u_{i,j-1}^{(k+1)})
                \]</p>
                <p>æœ€é©ãª \(\omega\) ã¯ç´„ 1.7ã€œ1.9ï¼ˆå•é¡Œä¾å­˜ï¼‰</p>
            </div>

            <div class="code-title">Pythonå®Ÿè£…: 3æ‰‹æ³•ã®åæŸé€Ÿåº¦æ¯”è¼ƒ</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

def gauss_seidel_method(u_init, boundary_mask, max_iter=10000, tol=1e-6):
    """Gauss-Seidelæ³•"""
    u = u_init.copy()
    residual_history = []
    
    for iteration in range(max_iter):
        u_old = u.copy()
        
        # å†…éƒ¨ç‚¹ã‚’é †æ¬¡æ›´æ–°ï¼ˆæ›´æ–°å€¤ã‚’å³åº§ã«ä½¿ç”¨ï¼‰
        for i in range(1, u.shape[0]-1):
            for j in range(1, u.shape[1]-1):
                if not boundary_mask[i, j]:
                    u[i, j] = 0.25 * (u[i+1, j] + u[i-1, j] + u[i, j+1] + u[i, j-1])
        
        residual = np.linalg.norm(u - u_old) / np.linalg.norm(u)
        residual_history.append(residual)
        
        if residual < tol:
            break
    
    return u, residual_history

def sor_method(u_init, boundary_mask, omega=1.5, max_iter=10000, tol=1e-6):
    """SORæ³•"""
    u = u_init.copy()
    residual_history = []
    
    for iteration in range(max_iter):
        u_old = u.copy()
        
        for i in range(1, u.shape[0]-1):
            for j in range(1, u.shape[1]-1):
                if not boundary_mask[i, j]:
                    u_new = 0.25 * (u[i+1, j] + u[i-1, j] + u[i, j+1] + u[i, j-1])
                    u[i, j] = (1 - omega) * u[i, j] + omega * u_new
        
        residual = np.linalg.norm(u - u_old) / np.linalg.norm(u)
        residual_history.append(residual)
        
        if residual < tol:
            break
    
    return u, residual_history

# åŒã˜å•é¡Œè¨­å®šã§3æ‰‹æ³•ã‚’æ¯”è¼ƒ
Nx, Ny = 50, 50
x = np.linspace(0, 1, Nx)
y = np.linspace(0, 1, Ny)

u_init = np.zeros((Ny, Nx))
boundary_mask = np.zeros((Ny, Nx), dtype=bool)

u_init[-1, :] = np.sin(np.pi * x)
boundary_mask[0, :] = True
boundary_mask[-1, :] = True
boundary_mask[:, 0] = True
boundary_mask[:, -1] = True

# 3æ‰‹æ³•ã§è§£ã
print("=== 3æ‰‹æ³•ã®æ¯”è¼ƒ ===")

u_jacobi, res_jacobi = jacobi_method(u_init, boundary_mask, max_iter=10000, tol=1e-6)
u_gs, res_gs = gauss_seidel_method(u_init, boundary_mask, max_iter=10000, tol=1e-6)
u_sor, res_sor = sor_method(u_init, boundary_mask, omega=1.8, max_iter=10000, tol=1e-6)

# åæŸé€Ÿåº¦ã®å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

# åæŸå±¥æ­´
ax1 = axes[0]
ax1.semilogy(res_jacobi, 'b-', label=f'Jacobi ({len(res_jacobi)} iter)', linewidth=2)
ax1.semilogy(res_gs, 'g-', label=f'Gauss-Seidel ({len(res_gs)} iter)', linewidth=2)
ax1.semilogy(res_sor, 'r-', label=f'SOR (Ï‰=1.8, {len(res_sor)} iter)', linewidth=2)
ax1.set_xlabel('Iteration')
ax1.set_ylabel('Residual (L2 norm)')
ax1.set_title('åæŸé€Ÿåº¦ã®æ¯”è¼ƒ')
ax1.legend()
ax1.grid(True, alpha=0.3)

# åå¾©å›æ•°ã®æ£’ã‚°ãƒ©ãƒ•
ax2 = axes[1]
methods = ['Jacobi', 'Gauss-Seidel', 'SOR (Ï‰=1.8)']
iterations = [len(res_jacobi), len(res_gs), len(res_sor)]
colors = ['blue', 'green', 'red']
ax2.bar(methods, iterations, color=colors, alpha=0.7)
ax2.set_ylabel('Iterations to convergence')
ax2.set_title('åæŸã«å¿…è¦ãªåå¾©å›æ•°')
ax2.grid(True, axis='y', alpha=0.3)

for i, (method, iter_count) in enumerate(zip(methods, iterations)):
    ax2.text(i, iter_count + 50, str(iter_count), ha='center', fontweight='bold')

plt.tight_layout()
plt.savefig('laplace_iterative_comparison.png', dpi=300, bbox_inches='tight')
plt.show()

print(f"Jacobiæ³•: {len(res_jacobi)} å›")
print(f"Gauss-Seidelæ³•: {len(res_gs)} å› (é«˜é€ŸåŒ–ç‡: {len(res_jacobi)/len(res_gs):.2f}x)")
print(f"SORæ³•: {len(res_sor)} å› (é«˜é€ŸåŒ–ç‡: {len(res_jacobi)/len(res_sor):.2f}x)")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ3.8: ææ–™ç§‘å­¦å¿œç”¨ - å®šå¸¸ç†±ä¼å°å•é¡Œ</h2>
            
            <div class="code-title">Pythonå®Ÿè£…: è¤‡é›‘å½¢çŠ¶ã§ã®ç†±åˆ†å¸ƒè§£æ</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

# å•é¡Œè¨­å®š: Lå­—å‹ã®ææ–™ã§ã®å®šå¸¸ç†±ä¼å°
# ä¸€éƒ¨ã®å¢ƒç•Œã‚’é«˜æ¸©ã€ä»–ã‚’ä½æ¸©ã«è¨­å®š

def create_L_shaped_domain(Nx, Ny):
    """Lå­—å‹ã®é ˜åŸŸã‚’ä½œæˆ"""
    domain = np.ones((Ny, Nx), dtype=bool)
    # å³ä¸Šã®å››è§’å½¢ã‚’é™¤å¤–
    domain[Ny//2:, Nx//2:] = False
    return domain

def solve_laplace_L_shaped(Nx=60, Ny=60, T_hot=100, T_cold=0, max_iter=10000, tol=1e-6):
    """Lå­—å‹é ˜åŸŸã§ã®ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã‚’è§£ã"""
    
    # é ˜åŸŸä½œæˆ
    domain = create_L_shaped_domain(Nx, Ny)
    
    # åˆæœŸæ¸©åº¦åˆ†å¸ƒ
    u = np.full((Ny, Nx), T_cold, dtype=float)
    u[~domain] = np.nan  # é ˜åŸŸå¤–ã¯NaN
    
    # å¢ƒç•Œæ¡ä»¶: å†…å´ã®Lå­—ã®ä¸€éƒ¨ã‚’é«˜æ¸©ã«
    u[0, :Nx//2] = T_hot  # ä¸‹è¾ºã®å·¦åŠåˆ†
    u[:Ny//2, 0] = T_hot  # å·¦è¾ºã®ä¸‹åŠåˆ†
    
    # å¢ƒç•Œãƒã‚¹ã‚¯
    boundary_mask = np.zeros((Ny, Nx), dtype=bool)
    boundary_mask[0, :] = True
    boundary_mask[-1, :] = True
    boundary_mask[:, 0] = True
    boundary_mask[:, -1] = True
    boundary_mask[Ny//2-1, :Nx//2] = True  # Lå­—ã®å†…å´è§’
    boundary_mask[:Ny//2, Nx//2-1] = True
    
    # SORæ³•ã§è§£ã
    omega = 1.8
    for iteration in range(max_iter):
        u_old = u.copy()
        
        for i in range(1, Ny-1):
            for j in range(1, Nx-1):
                if domain[i, j] and not boundary_mask[i, j]:
                    # å‘¨å›²ãŒé ˜åŸŸå†…ã®ç‚¹ã®ã¿ä½¿ç”¨
                    neighbors = []
                    if domain[i+1, j]: neighbors.append(u[i+1, j])
                    if domain[i-1, j]: neighbors.append(u[i-1, j])
                    if domain[i, j+1]: neighbors.append(u[i, j+1])
                    if domain[i, j-1]: neighbors.append(u[i, j-1])
                    
                    if len(neighbors) > 0:
                        u_new = np.mean(neighbors)
                        u[i, j] = (1 - omega) * u[i, j] + omega * u_new
        
        # åæŸåˆ¤å®š
        valid_points = domain & ~np.isnan(u) & ~np.isnan(u_old)
        if np.any(valid_points):
            residual = np.linalg.norm(u[valid_points] - u_old[valid_points]) / \
                       np.linalg.norm(u[valid_points])
            if residual < tol:
                print(f"åæŸ: iteration = {iteration}, residual = {residual:.2e}")
                break
    
    return u, domain

# è§£ã‚’è¨ˆç®—
Nx, Ny = 60, 60
u_solution, domain = solve_laplace_L_shaped(Nx, Ny, T_hot=100, T_cold=0)

# åº§æ¨™ã‚°ãƒªãƒƒãƒ‰
x = np.linspace(0, 1, Nx)
y = np.linspace(0, 1, Ny)
X, Y = np.meshgrid(x, y)

# å¯è¦–åŒ–
fig = plt.figure(figsize=(15, 5))

# æ¸©åº¦åˆ†å¸ƒï¼ˆã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—ï¼‰
ax1 = fig.add_subplot(131)
im1 = ax1.imshow(u_solution, origin='lower', cmap='hot', extent=[0, 1, 0, 1],
                  vmin=0, vmax=100)
ax1.set_xlabel('x')
ax1.set_ylabel('y')
ax1.set_title('æ¸©åº¦åˆ†å¸ƒï¼ˆLå­—å‹ææ–™ï¼‰')
ax1.set_aspect('equal')
plt.colorbar(im1, ax=ax1, label='Temperature (Â°C)')

# ç­‰æ¸©ç·š
ax2 = fig.add_subplot(132)
u_plot = np.ma.masked_invalid(u_solution)
contour = ax2.contourf(X, Y, u_plot, levels=20, cmap='hot')
contour_lines = ax2.contour(X, Y, u_plot, levels=10, colors='black', 
                              linewidths=0.5, alpha=0.5)
ax2.clabel(contour_lines, inline=True, fontsize=8)
ax2.set_xlabel('x')
ax2.set_ylabel('y')
ax2.set_title('ç­‰æ¸©ç·š')
ax2.set_aspect('equal')
plt.colorbar(contour, ax=ax2, label='Temperature (Â°C)')

# æ¸©åº¦å‹¾é…ï¼ˆãƒ’ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚¯ã‚¹æ–¹å‘ï¼‰
ax3 = fig.add_subplot(133)
# æ¸©åº¦å‹¾é…ã‚’è¨ˆç®—
grad_y, grad_x = np.gradient(u_solution)
# NaNã‚’é™¤å¤–
valid = ~np.isnan(grad_x) & ~np.isnan(grad_y)
ax3.imshow(u_solution, origin='lower', cmap='hot', extent=[0, 1, 0, 1], alpha=0.3)
# å‹¾é…ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆé–“å¼•ã„ã¦ãƒ—ãƒ­ãƒƒãƒˆï¼‰
skip = 3
ax3.quiver(X[::skip, ::skip][valid[::skip, ::skip]], 
           Y[::skip, ::skip][valid[::skip, ::skip]],
           -grad_x[::skip, ::skip][valid[::skip, ::skip]],
           -grad_y[::skip, ::skip][valid[::skip, ::skip]],
           color='blue', alpha=0.6)
ax3.set_xlabel('x')
ax3.set_ylabel('y')
ax3.set_title('ç†±æµæŸãƒ™ã‚¯ãƒˆãƒ« (-âˆ‡T)')
ax3.set_aspect('equal')

plt.tight_layout()
plt.savefig('laplace_L_shaped_heat_conduction.png', dpi=300, bbox_inches='tight')
plt.show()

print("=== Lå­—å‹ææ–™ã®å®šå¸¸ç†±ä¼å° ===")
print(f"æœ€é«˜æ¸©åº¦: {np.nanmax(u_solution):.2f} Â°C")
print(f"æœ€ä½æ¸©åº¦: {np.nanmin(u_solution):.2f} Â°C")
print(f"å¹³å‡æ¸©åº¦: {np.nanmean(u_solution):.2f} Â°C")
</div>
        </div>

        <div class="content">
            <h2>ğŸ“š ã¾ã¨ã‚</h2>
            <ul>
                <li><strong>ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼</strong>ã¯å®šå¸¸çŠ¶æ…‹ã®ç‰©ç†ç¾è±¡ã‚’è¨˜è¿°ã—ã€èª¿å’Œé–¢æ•°ã¨ã—ã¦æœ€å¤§å€¤åŸç†ãªã©ã®é‡è¦ãªæ€§è³ªã‚’æŒã¤</li>
                <li><strong>æ¥µåº§æ¨™ãƒ»å††ç­’åº§æ¨™</strong>ã§ã®å¤‰æ•°åˆ†é›¢æ³•ã«ã‚ˆã‚Šã€å††å½¢ãƒ»çƒå½¢é ˜åŸŸã§ã®è§£æè§£ãŒå¾—ã‚‰ã‚Œã‚‹</li>
                <li><strong>ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°</strong>ã«ã‚ˆã‚Šã€ç‚¹æºã«å¯¾ã™ã‚‹å¿œç­”ã‹ã‚‰å¢ƒç•Œå€¤å•é¡Œã®è§£ã‚’æ§‹æˆã§ãã‚‹</li>
                <li><strong>ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼</strong>ã¯ç†±æºã‚„é›»è·åˆ†å¸ƒã‚’å«ã‚€å•é¡Œã‚’æ‰±ã„ã€ææ–™ç§‘å­¦ã§åºƒãå¿œç”¨ã•ã‚Œã‚‹</li>
                <li><strong>åå¾©æ³•</strong>ï¼ˆJacobi, Gauss-Seidel, SORï¼‰ã«ã‚ˆã‚Šæ•°å€¤çš„ã«è§£ã‚’æ±‚ã‚ã‚‹ã“ã¨ãŒã§ãã€SORæ³•ãŒæœ€ã‚‚é«˜é€Ÿ</li>
                <li>è¤‡é›‘å½¢çŠ¶ã§ã®å®šå¸¸ç†±ä¼å°å•é¡Œãªã©ã€å®Ÿç”¨çš„ãªææ–™ç§‘å­¦ã¸ã®å¿œç”¨ãŒå¯èƒ½</li>
            </ul>
        </div>

        <div class="exercise">
            <h3>ğŸ’¡ æ¼”ç¿’å•é¡Œ</h3>
            <ol>
                <li><strong>èª¿å’Œé–¢æ•°ã®æ¤œè¨¼</strong>: \(u(x,y) = xy\) ãŒèª¿å’Œé–¢æ•°ã§ãªã„ã“ã¨ã‚’ã€ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³ã‚’è¨ˆç®—ã—ã¦ç¢ºèªã›ã‚ˆã€‚</li>
                <li><strong>æ¥µåº§æ¨™ã§ã®è§£</strong>: åŠå¾„ \(a\) ã®å††ç›¤ä¸Šã§å¢ƒç•Œæ¡ä»¶ \(u(a,\theta) = \cos(2\theta)\) ã‚’æº€ãŸã™ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã®è§£ã‚’æ±‚ã‚ã€å¯è¦–åŒ–ã›ã‚ˆã€‚</li>
                <li><strong>ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ã®å¿œç”¨</strong>: çŸ©å½¢é ˜åŸŸã§ã®ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ã‚’ç”¨ã„ã€ç†±æº \(f(x,y) = \delta(x-0.5, y-0.5)\) ã«å¯¾ã™ã‚‹æ¸©åº¦åˆ†å¸ƒã‚’æ±‚ã‚ã‚ˆã€‚</li>
                <li><strong>åæŸã®æ¯”è¼ƒ</strong>: SORæ³•ã®ç·©å’Œä¿‚æ•° \(\omega\) ã‚’ 1.0 ã‹ã‚‰ 2.0 ã¾ã§å¤‰åŒ–ã•ã›ã€æœ€é©ãª \(\omega\) ã‚’æ±‚ã‚ã‚ˆã€‚</li>
                <li><strong>è¤‡é›‘å½¢çŠ¶</strong>: å††å½¢ã®ç©´ãŒé–‹ã„ãŸçŸ©å½¢é ˜åŸŸã§ã®ãƒ©ãƒ—ãƒ©ã‚¹æ–¹ç¨‹å¼ã‚’è§£ãã€ç©´ã®å‘¨ã‚Šã®æ¸©åº¦åˆ†å¸ƒã‚’å¯è¦–åŒ–ã›ã‚ˆã€‚</li>
            </ol>
        </div>

        <div class="navigation">
            <a href="chapter-2.html" class="nav-button">â† ç¬¬2ç« : ç†±æ–¹ç¨‹å¼ã¨æ‹¡æ•£</a>
            <a href="chapter-4.html" class="nav-button">ç¬¬4ç« : å¤‰åˆ†æ³•ã¨æœ€é©åŒ– â†’</a>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 AI Terakoya - Fundamentals of Mathematics & Physics Dojo</p>
    </footer>
</body>
</html>
