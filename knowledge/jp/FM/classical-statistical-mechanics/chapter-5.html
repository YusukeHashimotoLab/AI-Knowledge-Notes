<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
<meta content="ç¬¬5ç« : çµ±è¨ˆåŠ›å­¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | åŸºç¤æ•°ç†é“å ´ - å¤å…¸çµ±è¨ˆåŠ›å­¦å…¥é–€" name="description"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç« : çµ±è¨ˆåŠ›å­¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | åŸºç¤æ•°ç†é“å ´ - å¤å…¸çµ±è¨ˆåŠ›å­¦å…¥é–€</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.8; color: #333; background: #f5f5f5; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; text-align: center; }
        h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; }
        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
        .breadcrumb { margin-bottom: 1.5rem; font-size: 0.9rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .content { background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        h2 { color: #667eea; margin: 2rem 0 1rem 0; padding-bottom: 0.5rem; border-bottom: 2px solid #e0e0e0; }
        h3 { color: #764ba2; margin: 1.5rem 0 0.8rem 0; }
        .definition { background: #e7f3ff; border-left: 4px solid #667eea; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .theorem { background: #f3e5f5; border-left: 4px solid #764ba2; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .example { background: #fff3e0; border-left: 4px solid #ff9800; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .code-title {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            margin-top: 1.5rem;
        }
        .code-example {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 0 0 8px 8px;
            overflow-x: auto;
            margin: 0 0 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .code-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .output { background: #f8f9fa; border: 1px solid #dee2e6; padding: 1rem; border-radius: 6px; margin: 1rem 0; font-family: monospace; font-size: 0.9rem; }
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
        th, td { padding: 0.8rem; text-align: left; border: 1px solid #ddd; }
        th { background: #667eea; color: white; }
        .note { background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .exercise { background: #d4edda; border-left: 4px solid #28a745; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .exercise-box { background: #d4edda; border-left: 4px solid #28a745; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .theory-box { background: #e7f3ff; border-left: 4px solid #667eea; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .example-box { background: #fff3e0; border-left: 4px solid #ff9800; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .nav-buttons { display: flex; justify-content: space-between; margin: 2rem 0; }
        .nav-button { padding: 0.8rem 1.5rem; background: #667eea; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; }
        .nav-button:hover { background: #764ba2; }
        .navigation-buttons { display: flex; justify-content: space-between; margin: 2rem 0; }
        .btn { padding: 0.8rem 1.5rem; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; }
        .btn-primary { background: #667eea; }
        .btn-primary:hover { background: #764ba2; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        footer { background: #2c3e50; color: white; text-align: center; padding: 2rem 1rem; margin-top: 3rem; }
        @media (max-width: 768px) { .content { padding: 1.5rem; } h1 { font-size: 1.5rem; } }
    </style>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/FM/classical-statistical-mechanics/chapter-5.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<header>
        <h1>ç¬¬5ç« : çµ±è¨ˆåŠ›å­¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
    </header>

    <div class="container">
        <div class="breadcrumb">
            <a href="../index.html">åŸºç¤æ•°ç†é“å ´</a> &gt;
            <a href="index.html">å¤å…¸çµ±è¨ˆåŠ›å­¦å…¥é–€</a> &gt;
            ç¬¬5ç« 
        </div>

        <div class="content">
            <h2>ğŸ¯ å­¦ç¿’ç›®æ¨™</h2>
            <ul>
                <li>ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•ã®åŸç†ã¨é‡ç‚¹ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã‚’ç†è§£ã™ã‚‹</li>
                <li>Metropolisã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…ã§ãã‚‹</li>
                <li>2æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ«ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹</li>
                <li>ã‚¨ãƒ«ã‚´ãƒ¼ãƒ‰æ€§ã¨å¹³è¡¡åŒ–ã®æ¦‚å¿µã‚’ç†è§£ã™ã‚‹</li>
                <li>ç‰©ç†é‡ã®çµ±è¨ˆèª¤å·®ã‚’è©•ä¾¡ã™ã‚‹</li>
                <li>åˆ†å­å‹•åŠ›å­¦æ³•ï¼ˆVerletæ³•ï¼‰ã®åŸºç¤ã‚’å­¦ã¶</li>
                <li>Lennard-Jonesãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã¨å‹•å¾„åˆ†å¸ƒé–¢æ•°ã‚’ç†è§£ã™ã‚‹</li>
                <li>ææ–™ç§‘å­¦ã¸ã®å¿œç”¨ï¼ˆå¸ç€ã€ç£æ€§ï¼‰ã‚’å®Ÿè·µã™ã‚‹</li>
            </ul>
        </div>

        <div class="content">
            <h2>ğŸ“– ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•ã®åŸºç¤</h2>

            <div class="definition">
                <h3>ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•</h3>
                <p>ç¢ºç‡åˆ†å¸ƒ \(P(x)\) ã«å¾“ã†ã‚µãƒ³ãƒ—ãƒ« \(\{x_i\}\) ã‚’ç”Ÿæˆã—ã€æœŸå¾…å€¤ã‚’è¨ˆç®—:</p>
                <p>\[
                \langle f \rangle = \int f(x) P(x) dx \approx \frac{1}{N} \sum_{i=1}^N f(x_i)
                \]</p>
                <p><strong>Importance Samplingï¼ˆé‡ç‚¹ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼‰</strong>:</p>
                <p>ã‚«ãƒãƒ‹ã‚«ãƒ«åˆ†å¸ƒ \(P(E) = e^{-\beta E} / Z\) ã‹ã‚‰ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ã¦ç†±åŠ›å­¦é‡ã‚’è¨ˆç®—ã€‚</p>
                <p><strong>Markov chain Monte Carloï¼ˆMCMCï¼‰</strong>:</p>
                <ul>
                    <li>çŠ¶æ…‹ \(i\) ã‹ã‚‰çŠ¶æ…‹ \(j\) ã¸ã®é·ç§»ç¢ºç‡ \(W_{i \to j}\) ã‚’å®šç¾©</li>
                    <li>è©³ç´°é‡£ã‚Šåˆã„æ¡ä»¶: \(P_i W_{i \to j} = P_j W_{j \to i}\)</li>
                    <li>å¹³è¡¡åˆ†å¸ƒã«åæŸã™ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹</li>
                </ul>
            </div>

            <div class="definition">
                <h3>Metropolisã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </h3>
                <p>ã‚«ãƒãƒ‹ã‚«ãƒ«é›†å›£ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ‰‹æ³•:</p>
                <ol>
                    <li>ç¾åœ¨ã®çŠ¶æ…‹ \(i\) ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«æ–°çŠ¶æ…‹ \(j\) ã‚’ææ¡ˆ</li>
                    <li>ã‚¨ãƒãƒ«ã‚®ãƒ¼å·® \(\Delta E = E_j - E_i\) ã‚’è¨ˆç®—</li>
                    <li>é·ç§»ç¢ºç‡ \(W_{i \to j} = \min(1, e^{-\beta \Delta E})\)</li>
                    <li>ç¢ºç‡ \(W\) ã§çŠ¶æ…‹ \(j\) ã‚’å—ç†ã€\(1 - W\) ã§æ£„å´</li>
                </ol>
                <p><strong>ç‰¹å¾´</strong>:</p>
                <ul>
                    <li>\(\Delta E < 0\): å¿…ãšå—ç†ï¼ˆã‚¨ãƒãƒ«ã‚®ãƒ¼ä½ä¸‹ï¼‰</li>
                    <li>\(\Delta E > 0\): \(e^{-\beta \Delta E}\) ã®ç¢ºç‡ã§å—ç†</li>
                    <li>è©³ç´°é‡£ã‚Šåˆã„ã‚’æº€ãŸã™</li>
                </ul>
            </div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ5.1: 2æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ«ã®ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>

            <div class="definition">
                <h3>2æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ«</h3>
                <p>\(L \times L\) æ ¼å­ä¸Šã®ã‚¹ãƒ”ãƒ³ç³»:</p>
                <p>\[
                H = -J \sum_{\langle i,j \rangle} s_i s_j
                \]</p>
                <p>å‘¨æœŸå¢ƒç•Œæ¡ä»¶ã‚’é©ç”¨ã€‚Metropolisã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚«ãƒãƒ‹ã‚«ãƒ«åˆ†å¸ƒã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã€‚</p>
                <p><strong>æ¸¬å®šç‰©ç†é‡</strong>:</p>
                <ul>
                    <li>ç£åŒ–: \(m = \frac{1}{N}\sum_i s_i\)</li>
                    <li>ã‚¨ãƒãƒ«ã‚®ãƒ¼: \(E = -J \sum_{\langle i,j \rangle} s_i s_j\)</li>
                    <li>æ¯”ç†±: \(C = \beta^2 (\langle E^2 \rangle - \langle E \rangle^2)\)</li>
                    <li>ç£åŒ–ç‡: \(\chi = \beta N (\langle m^2 \rangle - \langle m \rangle^2)\)</li>
                </ul>
            </div>

            <div class="code-title">Pythonå®Ÿè£…: 2æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ«</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt
from matplotlib.animation import FuncAnimation
from IPython.display import HTML

class Ising2D:
    def __init__(self, L, T, J=1.0):
        """
        2æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ«
        L: æ ¼å­ã‚µã‚¤ã‚º (L x L)
        T: æ¸©åº¦
        J: ç›¸äº’ä½œç”¨å¼·åº¦
        """
        self.L = L
        self.N = L * L
        self.T = T
        self.J = J
        self.beta = 1.0 / T if T > 0 else np.inf

        # ãƒ©ãƒ³ãƒ€ãƒ åˆæœŸé…ç½®
        self.spins = np.random.choice([-1, 1], size=(L, L))

        # çµ±è¨ˆé‡
        self.energy_history = []
        self.magnetization_history = []

    def energy(self):
        """ç³»å…¨ä½“ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼"""
        E = 0
        for i in range(self.L):
            for j in range(self.L):
                # æœ€éš£æ¥ã¨ã®ç›¸äº’ä½œç”¨ï¼ˆå‘¨æœŸå¢ƒç•Œæ¡ä»¶ï¼‰
                S = self.spins[i, j]
                neighbors = (
                    self.spins[(i+1) % self.L, j] +
                    self.spins[i, (j+1) % self.L]
                )
                E += -self.J * S * neighbors
        return E

    def delta_energy(self, i, j):
        """ã‚¹ãƒ”ãƒ³ (i,j) ã‚’åè»¢ã•ã›ãŸã¨ãã®ã‚¨ãƒãƒ«ã‚®ãƒ¼å¤‰åŒ–"""
        S = self.spins[i, j]
        neighbors = (
            self.spins[(i+1) % self.L, j] +
            self.spins[(i-1) % self.L, j] +
            self.spins[i, (j+1) % self.L] +
            self.spins[i, (j-1) % self.L]
        )
        return 2 * self.J * S * neighbors

    def magnetization(self):
        """ç£åŒ–"""
        return np.abs(np.sum(self.spins)) / self.N

    def metropolis_step(self):
        """Metropolis 1ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆå…¨ã‚¹ãƒ”ãƒ³ã‚’1å›ãšã¤è©¦è¡Œï¼‰"""
        for _ in range(self.N):
            # ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚¹ãƒ”ãƒ³ã‚’é¸æŠ
            i, j = np.random.randint(0, self.L, size=2)

            # ã‚¨ãƒãƒ«ã‚®ãƒ¼å¤‰åŒ–
            dE = self.delta_energy(i, j)

            # Metropolisåˆ¤å®š
            if dE < 0 or np.random.random() < np.exp(-self.beta * dE):
                self.spins[i, j] *= -1  # ã‚¹ãƒ”ãƒ³åè»¢

    def simulate(self, steps, equilibration=1000):
        """ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ"""
        # å¹³è¡¡åŒ–
        for _ in range(equilibration):
            self.metropolis_step()

        # æ¸¬å®š
        for step in range(steps):
            self.metropolis_step()

            if step % 10 == 0:  # 10ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«è¨˜éŒ²
                self.energy_history.append(self.energy())
                self.magnetization_history.append(self.magnetization())

    def statistics(self):
        """çµ±è¨ˆé‡ã®è¨ˆç®—"""
        E_mean = np.mean(self.energy_history)
        E_std = np.std(self.energy_history)
        M_mean = np.mean(self.magnetization_history)
        M_std = np.std(self.magnetization_history)

        # æ¯”ç†±ã¨ç£åŒ–ç‡
        E_array = np.array(self.energy_history)
        M_array = np.array(self.magnetization_history)

        C = self.beta**2 * (np.mean(E_array**2) - np.mean(E_array)**2) / self.N
        chi = self.beta * self.N * (np.mean(M_array**2) - np.mean(M_array)**2)

        return {
            'E_mean': E_mean / self.N,
            'E_std': E_std / self.N,
            'M_mean': M_mean,
            'M_std': M_std,
            'C': C,
            'chi': chi
        }

# ç•°ãªã‚‹æ¸©åº¦ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
L = 20
T_range = np.linspace(1.0, 4.0, 16)
J = 1.0
T_c_onsager = 2 * J / np.log(1 + np.sqrt(2))  # Onsagerè§£æè§£

results = []

for T in T_range:
    print(f"Temperature T = {T:.2f}...")
    ising = Ising2D(L, T, J)
    ising.simulate(steps=5000, equilibration=1000)
    stats = ising.statistics()
    stats['T'] = T
    results.append(stats)

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# ã‚¨ãƒãƒ«ã‚®ãƒ¼
ax1 = axes[0, 0]
T_vals = [r['T'] for r in results]
E_vals = [r['E_mean'] for r in results]
E_err = [r['E_std'] for r in results]
ax1.errorbar(T_vals, E_vals, yerr=E_err, fmt='o-', linewidth=2, markersize=6)
ax1.axvline(T_c_onsager, color='r', linestyle='--', linewidth=2, label=f'T_c = {T_c_onsager:.2f}')
ax1.set_xlabel('Temperature T')
ax1.set_ylabel('Energy per spin âŸ¨EâŸ©/N')
ax1.set_title('ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æ¸©åº¦ä¾å­˜æ€§')
ax1.legend()
ax1.grid(True, alpha=0.3)

# ç£åŒ–
ax2 = axes[0, 1]
M_vals = [r['M_mean'] for r in results]
M_err = [r['M_std'] for r in results]
ax2.errorbar(T_vals, M_vals, yerr=M_err, fmt='o-', linewidth=2, markersize=6, color='blue')
ax2.axvline(T_c_onsager, color='r', linestyle='--', linewidth=2, label=f'T_c = {T_c_onsager:.2f}')
ax2.set_xlabel('Temperature T')
ax2.set_ylabel('Magnetization âŸ¨|m|âŸ©')
ax2.set_title('ç£åŒ–ã®æ¸©åº¦ä¾å­˜æ€§')
ax2.legend()
ax2.grid(True, alpha=0.3)

# æ¯”ç†±
ax3 = axes[1, 0]
C_vals = [r['C'] for r in results]
ax3.plot(T_vals, C_vals, 'o-', linewidth=2, markersize=6, color='green')
ax3.axvline(T_c_onsager, color='r', linestyle='--', linewidth=2, label=f'T_c = {T_c_onsager:.2f}')
ax3.set_xlabel('Temperature T')
ax3.set_ylabel('Specific heat C')
ax3.set_title('æ¯”ç†±ï¼ˆT_c ã§ãƒ”ãƒ¼ã‚¯ï¼‰')
ax3.legend()
ax3.grid(True, alpha=0.3)

# ç£åŒ–ç‡
ax4 = axes[1, 1]
chi_vals = [r['chi'] for r in results]
ax4.plot(T_vals, chi_vals, 'o-', linewidth=2, markersize=6, color='purple')
ax4.axvline(T_c_onsager, color='r', linestyle='--', linewidth=2, label=f'T_c = {T_c_onsager:.2f}')
ax4.set_xlabel('Temperature T')
ax4.set_ylabel('Susceptibility Ï‡')
ax4.set_title('ç£åŒ–ç‡ï¼ˆT_c ã§ãƒ”ãƒ¼ã‚¯ï¼‰')
ax4.legend()
ax4.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('stat_mech_ising_mc_simulation.png', dpi=300, bbox_inches='tight')
plt.show()

# æ•°å€¤çµæœ
print("\n=== 2æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ« ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===\n")
print(f"æ ¼å­ã‚µã‚¤ã‚º: {L} Ã— {L}")
print(f"Onsagerè‡¨ç•Œæ¸©åº¦: T_c = {T_c_onsager:.4f}\n")

print("æ¸©åº¦ä¾å­˜æ€§:")
for r in results:
    print(f"T = {r['T']:.2f}: E/N = {r['E_mean']:.3f}, M = {r['M_mean']:.3f}, C = {r['C']:.3f}, Ï‡ = {r['chi']:.2f}")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ5.2: è‡ªå·±ç›¸é–¢ã¨ã‚¨ãƒ«ã‚´ãƒ¼ãƒ‰æ€§</h2>

            <div class="definition">
                <h3>è‡ªå·±ç›¸é–¢é–¢æ•°</h3>
                <p>ç‰©ç†é‡ \(A(t)\) ã®è‡ªå·±ç›¸é–¢:</p>
                <p>\[
                C(t) = \langle A(t_0) A(t_0 + t) \rangle - \langle A \rangle^2
                \]</p>
                <p>ç›¸é–¢æ™‚é–“ \(\tau\): \(C(t) \sim e^{-t/\tau}\) ã®æ¸›è¡°å®šæ•°ã€‚</p>
                <p><strong>çµ±è¨ˆèª¤å·®</strong>:</p>
                <p>\[
                \sigma_{\bar{A}} = \frac{\sigma_A}{\sqrt{N_{\text{eff}}}}, \quad N_{\text{eff}} = \frac{N}{2\tau + 1}
                \]</p>
                <p>ç›¸é–¢ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã¯æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•°ãŒæ¸›å°‘ã—ã¾ã™ã€‚</p>
            </div>

            <div class="code-title">Pythonå®Ÿè£…: è‡ªå·±ç›¸é–¢ã¨çµ±è¨ˆèª¤å·®</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

def autocorrelation(data):
    """è‡ªå·±ç›¸é–¢é–¢æ•°ã®è¨ˆç®—"""
    n = len(data)
    mean = np.mean(data)
    variance = np.var(data)

    # ã‚¼ãƒ­å¹³å‡åŒ–
    data_centered = data - mean

    # è‡ªå·±ç›¸é–¢
    autocorr = np.correlate(data_centered, data_centered, mode='full')
    autocorr = autocorr[n-1:] / (variance * np.arange(n, 0, -1))

    return autocorr

def correlation_time(autocorr):
    """ç›¸é–¢æ™‚é–“ã®æ¨å®šï¼ˆæŒ‡æ•°æ¸›è¡°ãƒ•ã‚£ãƒƒãƒˆï¼‰"""
    # æœ€åˆã®ã‚¼ãƒ­äº¤å·®ã¾ãŸã¯ååˆ†å°ã•ããªã‚‹ç‚¹ã‚’æ¢ã™
    for i, val in enumerate(autocorr):
        if val < np.exp(-1) or val < 0:
            return i
    return len(autocorr) // 2

# 2æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ«ã§ã®è‡ªå·±ç›¸é–¢
L = 20
temperatures = [1.5, T_c_onsager, 3.0]
colors = ['blue', 'red', 'green']

fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# ç•°ãªã‚‹æ¸©åº¦ã§ã®è‡ªå·±ç›¸é–¢
ax1 = axes[0, 0]

for T, color in zip(temperatures, colors):
    ising = Ising2D(L, T, J=1.0)
    ising.simulate(steps=10000, equilibration=1000)

    # ç£åŒ–ã®è‡ªå·±ç›¸é–¢
    autocorr = autocorrelation(np.array(ising.magnetization_history))
    tau = correlation_time(autocorr)

    ax1.plot(autocorr[:100], color=color, linewidth=2,
             label=f'T = {T:.2f}, Ï„ â‰ˆ {tau}')

ax1.set_xlabel('Time lag (MC steps)')
ax1.set_ylabel('Autocorrelation C(t)')
ax1.set_title('ç£åŒ–ã®è‡ªå·±ç›¸é–¢')
ax1.legend()
ax1.grid(True, alpha=0.3)
ax1.set_yscale('log')

# ã‚¨ãƒ«ã‚´ãƒ¼ãƒ‰æ€§ã®æ¤œè¨¼ï¼ˆæ™‚é–“å¹³å‡ vs ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å¹³å‡ï¼‰
ax2 = axes[0, 1]
T_test = 2.5
num_runs = 20

time_averages = []
for run in range(num_runs):
    ising = Ising2D(L, T_test, J=1.0)
    ising.simulate(steps=5000, equilibration=1000)
    time_avg = np.mean(ising.magnetization_history)
    time_averages.append(time_avg)

ax2.hist(time_averages, bins=15, color='skyblue', edgecolor='black', alpha=0.7)
ax2.axvline(np.mean(time_averages), color='r', linestyle='--', linewidth=2,
            label=f'Mean = {np.mean(time_averages):.3f}')
ax2.set_xlabel('Time-averaged magnetization')
ax2.set_ylabel('Frequency')
ax2.set_title(f'ã‚¨ãƒ«ã‚´ãƒ¼ãƒ‰æ€§æ¤œè¨¼ï¼ˆT = {T_test}, {num_runs} runsï¼‰')
ax2.legend()
ax2.grid(True, alpha=0.3)

# çµ±è¨ˆèª¤å·®ã®è©•ä¾¡
ax3 = axes[1, 0]
ising_err = Ising2D(L, T_c_onsager, J=1.0)
ising_err.simulate(steps=10000, equilibration=1000)

M_data = np.array(ising_err.magnetization_history)
autocorr_err = autocorrelation(M_data)
tau_err = correlation_time(autocorr_err)

# ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•
block_sizes = np.logspace(0, 3, 20, dtype=int)
block_errors = []

for block_size in block_sizes:
    if block_size > len(M_data) // 2:
        break

    n_blocks = len(M_data) // block_size
    blocks = M_data[:n_blocks * block_size].reshape(n_blocks, block_size)
    block_means = np.mean(blocks, axis=1)
    block_error = np.std(block_means) / np.sqrt(n_blocks)
    block_errors.append(block_error)

ax3.semilogx(block_sizes[:len(block_errors)], block_errors, 'o-', linewidth=2, markersize=6)
ax3.axhline(block_errors[-1], color='r', linestyle='--', linewidth=2,
            label=f'Converged error â‰ˆ {block_errors[-1]:.4f}')
ax3.set_xlabel('Block size')
ax3.set_ylabel('Standard error')
ax3.set_title('ãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ã«ã‚ˆã‚‹çµ±è¨ˆèª¤å·®è©•ä¾¡')
ax3.legend()
ax3.grid(True, alpha=0.3)

# å¹³è¡¡åŒ–ãƒ—ãƒ­ã‚»ã‚¹
ax4 = axes[1, 1]
ising_eq = Ising2D(L, 2.0, J=1.0)

# å®Œå…¨ã«ç§©åºçŠ¶æ…‹ã‹ã‚‰é–‹å§‹
ising_eq.spins = np.ones((L, L))

equilibration_M = []
for step in range(2000):
    ising_eq.metropolis_step()
    if step % 10 == 0:
        equilibration_M.append(ising_eq.magnetization())

ax4.plot(np.arange(len(equilibration_M)) * 10, equilibration_M, 'b-', linewidth=2)
ax4.axhline(np.mean(equilibration_M[-50:]), color='r', linestyle='--', linewidth=2,
            label='Equilibrium value')
ax4.set_xlabel('MC steps')
ax4.set_ylabel('Magnetization')
ax4.set_title('å¹³è¡¡åŒ–ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆç§©åºâ†’ç„¡ç§©åºï¼‰')
ax4.legend()
ax4.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('stat_mech_mc_autocorrelation.png', dpi=300, bbox_inches='tight')
plt.show()

print("\n=== è‡ªå·±ç›¸é–¢ã¨çµ±è¨ˆèª¤å·® ===\n")
print(f"ç›¸é–¢æ™‚é–“ Ï„ â‰ˆ {tau_err} MC steps")
print(f"æœ‰åŠ¹ã‚µãƒ³ãƒ—ãƒ«æ•° N_eff = N / (2Ï„ + 1) = {len(M_data)} / {2*tau_err + 1} â‰ˆ {len(M_data) / (2*tau_err + 1):.0f}")
print(f"\nçµ±è¨ˆèª¤å·®ï¼ˆãƒ–ãƒ­ãƒƒã‚¯å¹³å‡æ³•ï¼‰: Ïƒ â‰ˆ {block_errors[-1]:.4f}")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ5.3: åˆ†å­å‹•åŠ›å­¦æ³•ã®åŸºç¤</h2>

            <div class="definition">
                <h3>åˆ†å­å‹•åŠ›å­¦æ³•ï¼ˆMolecular Dynamicsï¼‰</h3>
                <p>Newtoné‹å‹•æ–¹ç¨‹å¼ã‚’æ•°å€¤ç©åˆ†:</p>
                <p>\[
                m \frac{d^2 \mathbf{r}_i}{dt^2} = \mathbf{F}_i = -\nabla_i U(\{\mathbf{r}_j\})
                \]</p>
                <p><strong>Velocity Verletæ³•</strong>:</p>
                <ol>
                    <li>\(\mathbf{r}(t + \Delta t) = \mathbf{r}(t) + \mathbf{v}(t) \Delta t + \frac{1}{2}\mathbf{a}(t) \Delta t^2\)</li>
                    <li>\(\mathbf{a}(t + \Delta t) = \mathbf{F}(\mathbf{r}(t + \Delta t)) / m\)</li>
                    <li>\(\mathbf{v}(t + \Delta t) = \mathbf{v}(t) + \frac{1}{2}[\mathbf{a}(t) + \mathbf{a}(t + \Delta t)] \Delta t\)</li>
                </ol>
                <p><strong>Lennard-Jonesãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</strong>:</p>
                <p>\[
                U(r) = 4\varepsilon \left[\left(\frac{\sigma}{r}\right)^{12} - \left(\frac{\sigma}{r}\right)^6\right]
                \]</p>
                <ul>
                    <li>\(\varepsilon\): ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«äº•æˆ¸ã®æ·±ã•</li>
                    <li>\(\sigma\): ã‚¼ãƒ­äº¤å·®è·é›¢</li>
                </ul>
            </div>

            <div class="code-title">Pythonå®Ÿè£…: Lennard-Jonesåˆ†å­å‹•åŠ›å­¦</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

class LennardJonesMD:
    def __init__(self, N, L, T, dt=0.001, epsilon=1.0, sigma=1.0):
        """
        Lennard-Jonesåˆ†å­å‹•åŠ›å­¦
        N: ç²’å­æ•°
        L: ãƒœãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚º
        T: æ¸©åº¦
        dt: æ™‚é–“ã‚¹ãƒ†ãƒƒãƒ—
        """
        self.N = N
        self.L = L
        self.T = T
        self.dt = dt
        self.epsilon = epsilon
        self.sigma = sigma

        # åˆæœŸé…ç½®ï¼ˆFCCæ ¼å­ï¼‰
        n = int(np.ceil(N**(1/3)))
        positions = []
        for i in range(n):
            for j in range(n):
                for k in range(n):
                    if len(positions) < N:
                        positions.append([i, j, k])

        self.positions = np.array(positions, dtype=float) * (L / n)

        # åˆæœŸé€Ÿåº¦ï¼ˆMaxwellåˆ†å¸ƒï¼‰
        self.velocities = np.random.randn(N, 3) * np.sqrt(T)
        # é‡å¿ƒé‹å‹•é‡ã‚’ã‚¼ãƒ­ã«
        self.velocities -= np.mean(self.velocities, axis=0)

        # å±¥æ­´
        self.energy_history = []
        self.temperature_history = []

    def apply_pbc(self, r):
        """å‘¨æœŸå¢ƒç•Œæ¡ä»¶"""
        return r - self.L * np.floor(r / self.L)

    def lennard_jones(self, r):
        """Lennard-Jonesãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã¨åŠ›"""
        r_norm = np.linalg.norm(r)
        if r_norm < 0.1 * self.sigma:
            r_norm = 0.1 * self.sigma  # ç™ºæ•£å›é¿

        sr6 = (self.sigma / r_norm)**6
        potential = 4 * self.epsilon * (sr6**2 - sr6)
        force_magnitude = 24 * self.epsilon * (2 * sr6**2 - sr6) / r_norm
        force = force_magnitude * r / r_norm

        return potential, force

    def compute_forces(self):
        """å…¨ç²’å­é–“ã®åŠ›ã¨ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚¨ãƒãƒ«ã‚®ãƒ¼"""
        forces = np.zeros((self.N, 3))
        potential = 0

        for i in range(self.N):
            for j in range(i+1, self.N):
                r_ij = self.positions[i] - self.positions[j]
                r_ij = self.apply_pbc(r_ij)

                U_ij, F_ij = self.lennard_jones(r_ij)

                forces[i] += F_ij
                forces[j] -= F_ij
                potential += U_ij

        return forces, potential

    def velocity_verlet_step(self):
        """Velocity Verletã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ """
        # ç¾åœ¨ã®åŠ›
        forces, potential = self.compute_forces()

        # ä½ç½®æ›´æ–°
        self.positions += self.velocities * self.dt + 0.5 * forces * self.dt**2
        self.positions = self.apply_pbc(self.positions)

        # æ–°ã—ã„åŠ›
        new_forces, new_potential = self.compute_forces()

        # é€Ÿåº¦æ›´æ–°
        self.velocities += 0.5 * (forces + new_forces) * self.dt

        # ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨æ¸©åº¦
        kinetic = 0.5 * np.sum(self.velocities**2)
        total_energy = kinetic + new_potential
        temperature = 2 * kinetic / (3 * self.N)

        return total_energy, temperature

    def simulate(self, steps):
        """ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ"""
        for step in range(steps):
            energy, temp = self.velocity_verlet_step()

            if step % 10 == 0:
                self.energy_history.append(energy)
                self.temperature_history.append(temp)

    def radial_distribution(self, bins=100):
        """å‹•å¾„åˆ†å¸ƒé–¢æ•° g(r)"""
        r_max = self.L / 2
        hist, bin_edges = np.histogram([], bins=bins, range=(0, r_max))

        for i in range(self.N):
            for j in range(i+1, self.N):
                r_ij = self.positions[i] - self.positions[j]
                r_ij = self.apply_pbc(r_ij)
                r = np.linalg.norm(r_ij)

                if r < r_max:
                    bin_idx = int(r / r_max * bins)
                    if bin_idx < bins:
                        hist[bin_idx] += 1

        # è¦æ ¼åŒ–
        r_bins = (bin_edges[:-1] + bin_edges[1:]) / 2
        dr = r_bins[1] - r_bins[0]
        shell_volume = 4 * np.pi * r_bins**2 * dr
        density = self.N / self.L**3

        g_r = hist / (shell_volume * density * self.N)

        return r_bins, g_r

# Lennard-Jones MDã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
N = 64
L = 5.0
T = 1.0
dt = 0.001
steps = 5000

md = LennardJonesMD(N, L, T, dt)
md.simulate(steps)

# å‹•å¾„åˆ†å¸ƒé–¢æ•°
r_bins, g_r = md.radial_distribution(bins=50)

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¿å­˜
ax1 = axes[0, 0]
time = np.arange(len(md.energy_history)) * 10 * dt
ax1.plot(time, md.energy_history, 'b-', linewidth=1)
ax1.set_xlabel('Time')
ax1.set_ylabel('Total Energy')
ax1.set_title('ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¿å­˜ï¼ˆVerletæ³•ï¼‰')
ax1.grid(True, alpha=0.3)

# æ¸©åº¦æºã‚‰ã
ax2 = axes[0, 1]
ax2.plot(time, md.temperature_history, 'r-', linewidth=1)
ax2.axhline(T, color='k', linestyle='--', linewidth=2, label=f'T_target = {T}')
ax2.set_xlabel('Time')
ax2.set_ylabel('Temperature')
ax2.set_title('æ¸©åº¦ã®æ™‚é–“ç™ºå±•')
ax2.legend()
ax2.grid(True, alpha=0.3)

# å‹•å¾„åˆ†å¸ƒé–¢æ•°
ax3 = axes[1, 0]
ax3.plot(r_bins, g_r, 'g-', linewidth=2)
ax3.set_xlabel('r / Ïƒ')
ax3.set_ylabel('g(r)')
ax3.set_title('å‹•å¾„åˆ†å¸ƒé–¢æ•°')
ax3.grid(True, alpha=0.3)

# ç²’å­é…ç½®ï¼ˆ2Dãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
ax4 = axes[1, 1]
ax4.scatter(md.positions[:, 0], md.positions[:, 1], s=100, alpha=0.6, c='blue', edgecolors='black')
ax4.set_xlim([0, L])
ax4.set_ylim([0, L])
ax4.set_xlabel('x')
ax4.set_ylabel('y')
ax4.set_title('ç²’å­é…ç½®ï¼ˆXYå¹³é¢ï¼‰')
ax4.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('stat_mech_lennard_jones_md.png', dpi=300, bbox_inches='tight')
plt.show()

print("\n=== Lennard-Jones åˆ†å­å‹•åŠ›å­¦ ===\n")
print(f"ç²’å­æ•°: {N}")
print(f"ãƒœãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚º: {L:.2f}")
print(f"æ™‚é–“ã‚¹ãƒ†ãƒƒãƒ—: {dt}")
print(f"ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°: {steps}")
print(f"\nå¹³å‡ã‚¨ãƒãƒ«ã‚®ãƒ¼: {np.mean(md.energy_history):.4f}")
print(f"å¹³å‡æ¸©åº¦: {np.mean(md.temperature_history):.4f}")
print(f"æ¸©åº¦æ¨™æº–åå·®: {np.std(md.temperature_history):.4f}")
</div>
        </div>

        <div class="content">
            <h2>ğŸ’» ä¾‹é¡Œ5.4: ææ–™ç§‘å­¦å¿œç”¨ - å¸ç€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>

            <div class="definition">
                <h3>Grand Canonical Monte Carloï¼ˆGCMCï¼‰</h3>
                <p>ã‚°ãƒ©ãƒ³ãƒ‰ã‚«ãƒãƒ‹ã‚«ãƒ«é›†å›£ã§ã®ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•:</p>
                <ul>
                    <li>ç²’å­æŒ¿å…¥: ç¢ºç‡ \(\min(1, \frac{V}{N+1} e^{\beta\mu} e^{-\beta \Delta E})\) ã§å—ç†</li>
                    <li>ç²’å­å‰Šé™¤: ç¢ºç‡ \(\min(1, \frac{N}{V} e^{-\beta\mu} e^{-\beta \Delta E})\) ã§å—ç†</li>
                    <li>ç²’å­ç§»å‹•: Metropolisåˆ¤å®š</li>
                </ul>
                <p>ææ–™ã¸ã®æ°—ä½“å¸ç€ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆå¯èƒ½ã€‚</p>
            </div>

            <div class="code-title">Pythonå®Ÿè£…: GCMCå¸ç€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</div>
            <div class="code-example">import numpy as np
import matplotlib.pyplot as plt

class GCMCAdsorption:
    def __init__(self, L, mu, T, epsilon_wall=-1.0, sigma=1.0):
        """
        Grand Canonical Monte Carlo å¸ç€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        L: ãƒœãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚º
        mu: åŒ–å­¦ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«
        T: æ¸©åº¦
        epsilon_wall: å£ã¨ã®ç›¸äº’ä½œç”¨
        """
        self.L = L
        self.mu = mu
        self.T = T
        self.beta = 1.0 / T
        self.epsilon_wall = epsilon_wall
        self.sigma = sigma

        self.particles = []  # ç²’å­ä½ç½®ã®ãƒªã‚¹ãƒˆ
        self.N_history = []

    def wall_energy(self, z):
        """å£ã¨ã®ç›¸äº’ä½œç”¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆzæ–¹å‘ï¼‰"""
        # ç°¡æ˜“çš„ãªLennard-Joneså‹å£ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«
        if z < self.sigma:
            z = self.sigma

        E = self.epsilon_wall * ((self.sigma / z)**12 - (self.sigma / z)**6)
        return E

    def particle_energy(self, pos):
        """ç²’å­ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆå£ã¨ã®ç›¸äº’ä½œç”¨ã®ã¿ï¼‰"""
        z = pos[2]
        return self.wall_energy(z)

    def insert_particle(self):
        """ç²’å­æŒ¿å…¥è©¦è¡Œ"""
        # ãƒ©ãƒ³ãƒ€ãƒ ä½ç½®
        new_pos = np.random.rand(3) * self.L

        # ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—
        E_new = self.particle_energy(new_pos)

        # å—ç†ç¢ºç‡
        N = len(self.particles)
        acceptance = min(1, (self.L**3 / (N + 1)) * np.exp(self.beta * (self.mu - E_new)))

        if np.random.random() < acceptance:
            self.particles.append(new_pos)
            return True
        return False

    def delete_particle(self):
        """ç²’å­å‰Šé™¤è©¦è¡Œ"""
        if len(self.particles) == 0:
            return False

        # ãƒ©ãƒ³ãƒ€ãƒ ã«ç²’å­é¸æŠ
        idx = np.random.randint(len(self.particles))
        pos = self.particles[idx]

        # ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—
        E_old = self.particle_energy(pos)

        # å—ç†ç¢ºç‡
        N = len(self.particles)
        acceptance = min(1, (N / self.L**3) * np.exp(-self.beta * (self.mu - E_old)))

        if np.random.random() < acceptance:
            del self.particles[idx]
            return True
        return False

    def move_particle(self):
        """ç²’å­ç§»å‹•è©¦è¡Œ"""
        if len(self.particles) == 0:
            return False

        idx = np.random.randint(len(self.particles))
        old_pos = self.particles[idx].copy()

        # ãƒ©ãƒ³ãƒ€ãƒ ç§»å‹•
        displacement = (np.random.rand(3) - 0.5) * 0.5
        new_pos = old_pos + displacement

        # å‘¨æœŸå¢ƒç•Œæ¡ä»¶
        new_pos = new_pos % self.L

        # ã‚¨ãƒãƒ«ã‚®ãƒ¼å·®
        dE = self.particle_energy(new_pos) - self.particle_energy(old_pos)

        # Metropolisåˆ¤å®š
        if dE < 0 or np.random.random() < np.exp(-self.beta * dE):
            self.particles[idx] = new_pos
            return True
        return False

    def gcmc_step(self):
        """GCMC 1ã‚¹ãƒ†ãƒƒãƒ—"""
        # ãƒ©ãƒ³ãƒ€ãƒ ã«æ“ä½œã‚’é¸æŠ
        operation = np.random.choice(['insert', 'delete', 'move'], p=[0.33, 0.33, 0.34])

        if operation == 'insert':
            self.insert_particle()
        elif operation == 'delete':
            self.delete_particle()
        else:
            self.move_particle()

    def simulate(self, steps, record_interval=10):
        """ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ"""
        for step in range(steps):
            self.gcmc_step()

            if step % record_interval == 0:
                self.N_history.append(len(self.particles))

    def density_profile(self, bins=50):
        """å¯†åº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆzæ–¹å‘ï¼‰"""
        if len(self.particles) == 0:
            return np.linspace(0, self.L, bins), np.zeros(bins)

        z_coords = [p[2] for p in self.particles]
        hist, bin_edges = np.histogram(z_coords, bins=bins, range=(0, self.L))
        z_bins = (bin_edges[:-1] + bin_edges[1:]) / 2

        # å¯†åº¦ï¼ˆç²’å­æ•°/ä½“ç©ï¼‰
        bin_volume = self.L**2 * (self.L / bins)
        density = hist / bin_volume

        return z_bins, density

# ç•°ãªã‚‹åŒ–å­¦ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã§GCMC
L = 10.0
T = 1.0
epsilon_wall = -2.0
mu_values = [-5.0, -4.0, -3.0, -2.0]

results_gcmc = []

for mu in mu_values:
    print(f"Chemical potential Î¼ = {mu:.2f}...")
    gcmc = GCMCAdsorption(L, mu, T, epsilon_wall)
    gcmc.simulate(steps=10000, record_interval=10)

    z_bins, density = gcmc.density_profile(bins=50)

    results_gcmc.append({
        'mu': mu,
        'N_avg': np.mean(gcmc.N_history[-100:]),
        'N_history': gcmc.N_history,
        'z_bins': z_bins,
        'density': density
    })

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# ç²’å­æ•°ã®æ™‚é–“ç™ºå±•
ax1 = axes[0, 0]
colors = ['blue', 'green', 'orange', 'red']
for r, color in zip(results_gcmc, colors):
    ax1.plot(r['N_history'], color=color, linewidth=1, alpha=0.7,
             label=f"Î¼ = {r['mu']:.1f}")
ax1.set_xlabel('MC steps')
ax1.set_ylabel('Number of particles N')
ax1.set_title('ç²’å­æ•°ã®æ™‚é–“ç™ºå±•')
ax1.legend()
ax1.grid(True, alpha=0.3)

# å¸ç€ç­‰æ¸©ç·š
ax2 = axes[0, 1]
mu_vals = [r['mu'] for r in results_gcmc]
N_avg_vals = [r['N_avg'] for r in results_gcmc]
ax2.plot(mu_vals, N_avg_vals, 'o-', linewidth=2, markersize=8, color='purple')
ax2.set_xlabel('Chemical potential Î¼')
ax2.set_ylabel('Average number of particles âŸ¨NâŸ©')
ax2.set_title('å¸ç€ç­‰æ¸©ç·šï¼ˆGCMCï¼‰')
ax2.grid(True, alpha=0.3)

# å¯†åº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
ax3 = axes[1, 0]
for r, color in zip(results_gcmc, colors):
    ax3.plot(r['z_bins'], r['density'], color=color, linewidth=2,
             label=f"Î¼ = {r['mu']:.1f}")
ax3.set_xlabel('z (distance from wall)')
ax3.set_ylabel('Density Ï(z)')
ax3.set_title('å¯†åº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå£è¿‘å‚ã§å¸ç€ï¼‰')
ax3.legend()
ax3.grid(True, alpha=0.3)

# ç²’å­æ•°åˆ†å¸ƒ
ax4 = axes[1, 1]
for r, color in zip(results_gcmc, colors):
    ax4.hist(r['N_history'][-500:], bins=20, alpha=0.5, color=color,
             label=f"Î¼ = {r['mu']:.1f}, âŸ¨NâŸ© = {r['N_avg']:.1f}")
ax4.set_xlabel('Number of particles N')
ax4.set_ylabel('Frequency')
ax4.set_title('ç²’å­æ•°åˆ†å¸ƒï¼ˆæºã‚‰ãï¼‰')
ax4.legend()
ax4.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('stat_mech_gcmc_adsorption.png', dpi=300, bbox_inches='tight')
plt.show()

print("\n=== GCMC å¸ç€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===\n")
print("çµæœ:")
for r in results_gcmc:
    print(f"Î¼ = {r['mu']:.2f}: âŸ¨NâŸ© = {r['N_avg']:.2f}")
</div>
        </div>

        <div class="content">
            <h2>ğŸ“š ã¾ã¨ã‚</h2>
            <ul>
                <li><strong>ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•</strong>ã¯ç¢ºç‡åˆ†å¸ƒã‹ã‚‰ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã§å¹³è¡¡ç‰©æ€§ã‚’è¨ˆç®—ã™ã‚‹æ‰‹æ³•</li>
                <li><strong>Metropolisã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </strong>ã¯è©³ç´°é‡£ã‚Šåˆã„æ¡ä»¶ã‚’æº€ãŸã—ã€ã‚«ãƒãƒ‹ã‚«ãƒ«åˆ†å¸ƒã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</li>
                <li><strong>2æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ«</strong>ã®MCã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ç›¸è»¢ç§»ã¨è‡¨ç•Œç¾è±¡ã‚’è¦³å¯Ÿå¯èƒ½</li>
                <li><strong>è‡ªå·±ç›¸é–¢</strong>ã¨ç›¸é–¢æ™‚é–“ã¯çµ±è¨ˆèª¤å·®è©•ä¾¡ã«é‡è¦ã§ã€ç‹¬ç«‹ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’æ±ºå®š</li>
                <li><strong>ã‚¨ãƒ«ã‚´ãƒ¼ãƒ‰æ€§</strong>ã«ã‚ˆã‚Šæ™‚é–“å¹³å‡ã¨ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å¹³å‡ãŒä¸€è‡´</li>
                <li><strong>åˆ†å­å‹•åŠ›å­¦æ³•</strong>ã¯Newtonæ–¹ç¨‹å¼ã‚’æ•°å€¤ç©åˆ†ã—ã€å‹•çš„æ€§è³ªã‚’è¨ˆç®—</li>
                <li><strong>Velocity Verletæ³•</strong>ã¯ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¿å­˜æ€§ã«å„ªã‚ŒãŸæ™‚é–“ç©åˆ†æ³•</li>
                <li><strong>Lennard-Jonesãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</strong>ã¯å®Ÿåœ¨æ°—ä½“ãƒ»æ¶²ä½“ã®æ¨™æº–ãƒ¢ãƒ‡ãƒ«</li>
                <li><strong>GCMC</strong>ã¯ç²’å­æ•°ãŒå¤‰åŒ–ã™ã‚‹å¸ç€ãƒ»åŒ–å­¦åå¿œç³»ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«æœ‰åŠ¹</li>
                <li>çµ±è¨ˆåŠ›å­¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ææ–™ç§‘å­¦ã®æ§‹é€ ãƒ»ç‰©æ€§äºˆæ¸¬ã«ä¸å¯æ¬ ãªãƒ„ãƒ¼ãƒ«</li>
            </ul>
        </div>

        <div class="exercise">
            <h3>ğŸ’¡ æ¼”ç¿’å•é¡Œ</h3>
            <ol>
                <li><strong>Wolffã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </strong>: è‡¨ç•Œæ¸›é€Ÿã‚’å›é¿ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…ã—ã€è‡¨ç•Œç‚¹è¿‘å‚ã§ã®åŠ¹ç‡ã‚’æ¯”è¼ƒã›ã‚ˆã€‚</li>
                <li><strong>3æ¬¡å…ƒIsing</strong>: 3æ¬¡å…ƒIsingãƒ¢ãƒ‡ãƒ«ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€è‡¨ç•Œæ¸©åº¦ã¨è‡¨ç•ŒæŒ‡æ•°ã‚’æ±‚ã‚ã‚ˆã€‚</li>
                <li><strong>Andersenç†±æµ´</strong>: Lennard-Jones MDã«Andersenç†±æµ´ã‚’å®Ÿè£…ã—ã€æ¸©åº¦åˆ¶å¾¡ã®åŠ¹æœã‚’æ¤œè¨¼ã›ã‚ˆã€‚</li>
                <li><strong>å‹•å¾„åˆ†å¸ƒé–¢æ•°ã¨æ§‹é€ å› å­</strong>: g(r)ã‹ã‚‰é™çš„æ§‹é€ å› å­ S(q) ã‚’è¨ˆç®—ã—ã€æ¶²ä½“æ§‹é€ ã‚’è§£æã›ã‚ˆã€‚</li>
                <li><strong>å¤šæˆåˆ†å¸ç€</strong>: 2ç¨®é¡ã®æ°—ä½“ã®ç«¶äº‰å¸ç€ã‚’GCMCã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€é¸æŠå¸ç€ã‚’èª¿ã¹ã‚ˆã€‚</li>
                <li><strong>ç£æ€§ææ–™</strong>: Heisenbergã‚¹ãƒ”ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆå¤å…¸çš„3æˆåˆ†ã‚¹ãƒ”ãƒ³ï¼‰ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€ç£åŒ–æ›²ç·šã‚’è¨ˆç®—ã›ã‚ˆã€‚</li>
            </ol>
        </div>

        <div class="content">
            <h2>ğŸ“ ã‚·ãƒªãƒ¼ã‚ºå®Œäº†</h2>
            <p>
                ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼<strong>å¤å…¸çµ±è¨ˆåŠ›å­¦å…¥é–€</strong>ã‚·ãƒªãƒ¼ã‚ºã‚’å®Œäº†ã—ã¾ã—ãŸã€‚
                ã“ã“ã¾ã§ã§ã€çµ±è¨ˆåŠ›å­¦ã®3ã¤ã®çµ±è¨ˆé›†å›£ï¼ˆãƒŸã‚¯ãƒ­ã‚«ãƒãƒ‹ã‚«ãƒ«ã€ã‚«ãƒãƒ‹ã‚«ãƒ«ã€ã‚°ãƒ©ãƒ³ãƒ‰ã‚«ãƒãƒ‹ã‚«ãƒ«ï¼‰ã€
                åˆ†é…é–¢æ•°ã‹ã‚‰ã®ç†±åŠ›å­¦é‡å°å‡ºã€ç›¸è»¢ç§»ç†è«–ã€ãã—ã¦è¨ˆç®—çµ±è¨ˆåŠ›å­¦ã®åŸºç¤ã‚’å­¦ã³ã¾ã—ãŸã€‚
            </p>
            <p>
                <strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</strong>:
            </p>
            <ul>
                <li><strong>é‡å­çµ±è¨ˆåŠ›å­¦</strong>: Fermi-Diracçµ±è¨ˆã€Bose-Einsteinçµ±è¨ˆã®è©³ç´°ã€è¶…ä¼å°ç†è«–ï¼ˆBCSç†è«–ï¼‰</li>
                <li><strong>éå¹³è¡¡çµ±è¨ˆåŠ›å­¦</strong>: Boltzmannæ–¹ç¨‹å¼ã€ç·šå½¢å¿œç­”ç†è«–ã€æºå‹•æ•£é€¸å®šç†</li>
                <li><strong>è¨ˆç®—çµ±è¨ˆåŠ›å­¦ã®ç™ºå±•</strong>: çµŒè·¯ç©åˆ†ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­ã€é‡å­ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­ã€ç¬¬ä¸€åŸç†åˆ†å­å‹•åŠ›å­¦</li>
                <li><strong>ææ–™ç§‘å­¦å¿œç”¨</strong>: ç›¸å›³è¨ˆç®—ã€ç¬¬ä¸€åŸç†è¨ˆç®—ã¨ã®çµ„ã¿åˆã‚ã›ã€æ©Ÿæ¢°å­¦ç¿’ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</li>
            </ul>
            <p>
                çµ±è¨ˆåŠ›å­¦ã¯ç‰©è³ªç§‘å­¦ã®æ ¹å¹¹ã‚’ãªã™ç†è«–ä½“ç³»ã§ã™ã€‚ã“ã“ã§å­¦ã‚“ã æ¦‚å¿µã¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹æ³•ã‚’
                å®Ÿéš›ã®ç ”ç©¶ã«æ´»ã‹ã—ã¦ãã ã•ã„ï¼
            </p>
        </div>

        <div class="nav-buttons">
            <a href="chapter-4.html" class="nav-button">â† ç¬¬4ç« : ç›¸äº’ä½œç”¨ç³»ã¨ç›¸è»¢ç§»</a>
            <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹ â†’</a>
        </div>
    </div>
        </div>
    </div>

    <section class="disclaimer">
<h3>å…è²¬äº‹é …</h3>
<ul>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹Code examplesã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
<li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
</ul>
</section>

<footer>
        <p>&copy; 2025 AI Terakoya - åŸºç¤æ•°ç†é“å ´</p>
    </footer>
</body>
</html>
