<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç« : SciPyã«ã‚ˆã‚‹å®Ÿè·µçš„æ•°å€¤è¨ˆç®— - æ•°å€¤è§£æã®åŸºç¤</title>
    <meta name="description" content="SciPyã‚’ä½¿ã£ãŸå®Ÿè·µçš„æ•°å€¤è¨ˆç®—ã‚’å­¦ã³ã¾ã™ã€‚æœ€é©åŒ–ã€è£œé–“ã€ä¿¡å·å‡¦ç†ã€ææ–™ç§‘å­¦ãƒ»ãƒ—ãƒ­ã‚»ã‚¹å·¥å­¦ã¸ã®å¿œç”¨ã‚’Pythonã§å®Ÿè£…ã—ã¾ã™ã€‚">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
            <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.8; color: #333; background: #f5f5f5; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; text-align: center; }
        h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; }
        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
        .breadcrumb { margin-bottom: 1.5rem; font-size: 0.9rem; }
        .breadcrumb a { color: #667eea; text-decoration: none; }
        .content { background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        h2 { color: #667eea; margin: 2rem 0 1rem 0; padding-bottom: 0.5rem; border-bottom: 2px solid #e0e0e0; }
        h3 { color: #764ba2; margin: 1.5rem 0 0.8rem 0; }
        .definition { background: #e7f3ff; border-left: 4px solid #667eea; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .theorem { background: #f3e5f5; border-left: 4px solid #764ba2; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .example { background: #fff3e0; border-left: 4px solid #ff9800; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .code-title {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            margin-top: 1.5rem;
        }
        .code-example {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 0 0 8px 8px;
            overflow-x: auto;
            margin: 0 0 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .output { background: #f8f9fa; border: 1px solid #dee2e6; padding: 1rem; border-radius: 6px; margin: 1rem 0; font-family: monospace; font-size: 0.9rem; }
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
        th, td { padding: 0.8rem; text-align: left; border: 1px solid #ddd; }
        th { background: #667eea; color: white; }
        .note { background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .exercise { background: #d4edda; border-left: 4px solid #28a745; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
        .nav-buttons { display: flex; justify-content: space-between; margin: 2rem 0; }
        .nav-button { padding: 0.8rem 1.5rem; background: #667eea; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; }
        .nav-button:hover { background: #764ba2; }
        footer { background: #2c3e50; color: white; text-align: center; padding: 2rem 1rem; margin-top: 3rem; }
        @media (max-width: 768px) { .content { padding: 1.5rem; } h1 { font-size: 1.5rem; } }
    </style>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/FM/numerical-analysis-fundamentals/chapter-5.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<div class="container">
        <div class="breadcrumb">
            <a href="../../index.html">åŸºç¤æ•°ç†é“å ´</a> &gt;
            <a href="index.html">æ•°å€¤è§£æã®åŸºç¤</a> &gt;
            ç¬¬5ç« 
        </div>
    </div>

    <main class="container">
        <div class="chapter-header">
            <h1>ç¬¬5ç« : SciPyã«ã‚ˆã‚‹å®Ÿè·µçš„æ•°å€¤è¨ˆç®—</h1>
            <p>æœ€é©åŒ–ãƒ»è£œé–“ãƒ»ä¿¡å·å‡¦ç†ã¨ææ–™ç§‘å­¦ãƒ»ãƒ—ãƒ­ã‚»ã‚¹å·¥å­¦ã¸ã®å¿œç”¨</p>
        </div>

        <section class="content-section">
            <h2>5.1 æœ€é©åŒ–å•é¡Œã®åŸºç¤</h2>
            <p>
                æœ€é©åŒ–ã¯ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®šã€ãƒ—ãƒ­ã‚»ã‚¹è¨­è¨ˆã€ææ–™æ¢ç´¢ãªã©å¹…åºƒã„å¿œç”¨ãŒã‚ã‚Šã¾ã™ã€‚scipy.optimizeã¯ã€åˆ¶ç´„ãªã—ãƒ»åˆ¶ç´„ã‚ã‚Šã®æ§˜ã€…ãªæœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æä¾›ã—ã¾ã™ã€‚
            </p>

            <div class="theory-box">
                <h3>ğŸ“š ç†è«–: æœ€é©åŒ–å•é¡Œã®åˆ†é¡</h3>
                <p><strong>åˆ¶ç´„ãªã—æœ€é©åŒ–:</strong></p>
                \[
                \min_{x \in \mathbb{R}^n} f(x)
                \]
                <ul>
                    <li><strong>Nelder-Meadæ³•:</strong> å°é–¢æ•°ä¸è¦ã€ãƒ­ãƒã‚¹ãƒˆã€åæŸé…ã„</li>
                    <li><strong>BFGSæ³•:</strong> æº–Newtonæ³•ã€å°é–¢æ•°ä½¿ç”¨ã€é«˜é€Ÿ</li>
                    <li><strong>CGæ³•:</strong> å…±å½¹å‹¾é…æ³•ã€å¤§è¦æ¨¡å•é¡Œã«é©</li>
                </ul>

                <p><strong>åˆ¶ç´„ã‚ã‚Šæœ€é©åŒ–:</strong></p>
                \[
                \begin{aligned}
                \min_{x \in \mathbb{R}^n} &\quad f(x) \\
                \text{s.t.} &\quad g_i(x) \leq 0 \quad (i = 1, \ldots, m) \\
                &\quad h_j(x) = 0 \quad (j = 1, \ldots, p)
                \end{aligned}
                \]
                <ul>
                    <li><strong>SLSQPæ³•:</strong> é€æ¬¡2æ¬¡è¨ˆç”»æ³•</li>
                    <li><strong>trust-constræ³•:</strong> ä¿¡é ¼é ˜åŸŸæ³•ã€å¤§è¦æ¨¡å•é¡Œå‘ã‘</li>
                </ul>
            </div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹1: scipy.optimize.minimizeã®åŸºæœ¬</h3>
            <div class="code-example"><code>import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import minimize
from mpl_toolkits.mplot3d import Axes3D

# Rosenbrocké–¢æ•°ï¼ˆæœ€é©åŒ–ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å•é¡Œï¼‰
def rosenbrock(x):
    """
    Rosenbrocké–¢æ•°: f(x, y) = (1-x)^2 + 100(y-x^2)^2
    æœ€å°å€¤: f(1, 1) = 0
    """
    return (1 - x[0])**2 + 100 * (x[1] - x[0]**2)**2

def rosenbrock_grad(x):
    """Rosenbrocké–¢æ•°ã®å‹¾é…"""
    dx = -2 * (1 - x[0]) - 400 * x[0] * (x[1] - x[0]**2)
    dy = 200 * (x[1] - x[0]**2)
    return np.array([dx, dy])

print("=" * 60)
print("åˆ¶ç´„ãªã—æœ€é©åŒ–: Rosenbrocké–¢æ•°")
print("=" * 60)

# åˆæœŸå€¤
x0 = np.array([0.0, 0.0])

# æ‰‹æ³•1: Nelder-Meadæ³•ï¼ˆå°é–¢æ•°ä¸è¦ï¼‰
result_nm = minimize(rosenbrock, x0, method='Nelder-Mead')
print("\n1. Nelder-Meadæ³•ï¼ˆå°é–¢æ•°ä¸è¦ï¼‰")
print(f"  æœ€é©è§£: x* = {result_nm.x}")
print(f"  æœ€å°å€¤: f(x*) = {result_nm.fun:.6e}")
print(f"  åå¾©å›æ•°: {result_nm.nit}")
print(f"  é–¢æ•°è©•ä¾¡å›æ•°: {result_nm.nfev}")

# æ‰‹æ³•2: BFGSæ³•ï¼ˆæº–Newtonæ³•ï¼‰
result_bfgs = minimize(rosenbrock, x0, method='BFGS', jac=rosenbrock_grad)
print("\n2. BFGSæ³•ï¼ˆæº–Newtonæ³•ã€å‹¾é…ä½¿ç”¨ï¼‰")
print(f"  æœ€é©è§£: x* = {result_bfgs.x}")
print(f"  æœ€å°å€¤: f(x*) = {result_bfgs.fun:.6e}")
print(f"  åå¾©å›æ•°: {result_bfgs.nit}")
print(f"  é–¢æ•°è©•ä¾¡å›æ•°: {result_bfgs.nfev}")

# æ‰‹æ³•3: CGæ³•ï¼ˆå…±å½¹å‹¾é…æ³•ï¼‰
result_cg = minimize(rosenbrock, x0, method='CG', jac=rosenbrock_grad)
print("\n3. CGæ³•ï¼ˆå…±å½¹å‹¾é…æ³•ï¼‰")
print(f"  æœ€é©è§£: x* = {result_cg.x}")
print(f"  æœ€å°å€¤: f(x*) = {result_cg.fun:.6e}")
print(f"  åå¾©å›æ•°: {result_cg.nit}")
print(f"  é–¢æ•°è©•ä¾¡å›æ•°: {result_cg.nfev}")

# å¯è¦–åŒ–
fig = plt.figure(figsize=(15, 5))

# å·¦å›³: ç­‰é«˜ç·šå›³ã¨æœ€é©åŒ–çµŒè·¯
ax1 = fig.add_subplot(131)
x = np.linspace(-2, 2, 200)
y = np.linspace(-1, 3, 200)
X, Y = np.meshgrid(x, y)
Z = (1 - X)**2 + 100 * (Y - X**2)**2

levels = np.logspace(-1, 3, 20)
cs = ax1.contour(X, Y, Z, levels=levels, cmap='viridis', alpha=0.6)
ax1.clabel(cs, inline=True, fontsize=8)
ax1.plot(1, 1, 'r*', markersize=20, label='æœ€å°å€¤ (1, 1)')
ax1.plot(x0[0], x0[1], 'ko', markersize=10, label='åˆæœŸå€¤')
ax1.plot(result_bfgs.x[0], result_bfgs.x[1], 'bs', markersize=10, label='BFGSè§£')
ax1.set_xlabel('x', fontsize=12)
ax1.set_ylabel('y', fontsize=12)
ax1.set_title('Rosenbrocké–¢æ•°ã®ç­‰é«˜ç·š', fontsize=14)
ax1.legend(fontsize=10)
ax1.grid(True, alpha=0.3)

# ä¸­å¤®å›³: 3Dè¡¨ç¤º
ax2 = fig.add_subplot(132, projection='3d')
ax2.plot_surface(X, Y, np.log10(Z + 1), cmap='viridis', alpha=0.6)
ax2.scatter([1], [1], [0], color='red', s=100, label='æœ€å°å€¤')
ax2.set_xlabel('x', fontsize=10)
ax2.set_ylabel('y', fontsize=10)
ax2.set_zlabel('logâ‚â‚€(f(x,y) + 1)', fontsize=10)
ax2.set_title('3Dè¡¨ç¤º', fontsize=14)

# å³å›³: æ‰‹æ³•ã®æ¯”è¼ƒ
ax3 = fig.add_subplot(133)
methods = ['Nelder-Mead', 'BFGS', 'CG']
iterations = [result_nm.nit, result_bfgs.nit, result_cg.nit]
func_evals = [result_nm.nfev, result_bfgs.nfev, result_cg.nfev]

x_pos = np.arange(len(methods))
width = 0.35

bars1 = ax3.bar(x_pos - width/2, iterations, width, label='åå¾©å›æ•°', alpha=0.7)
bars2 = ax3.bar(x_pos + width/2, func_evals, width, label='é–¢æ•°è©•ä¾¡å›æ•°', alpha=0.7)

ax3.set_ylabel('å›æ•°', fontsize=12)
ax3.set_title('æœ€é©åŒ–æ‰‹æ³•ã®æ¯”è¼ƒ', fontsize=14)
ax3.set_xticks(x_pos)
ax3.set_xticklabels(methods, rotation=15)
ax3.legend(fontsize=10)
ax3.grid(True, alpha=0.3, axis='y')

plt.tight_layout()
plt.savefig('optimization_methods_comparison.png', dpi=150, bbox_inches='tight')
plt.show()
</code></div>

            <div class="output-box">============================================================
åˆ¶ç´„ãªã—æœ€é©åŒ–: Rosenbrocké–¢æ•°
============================================================

1. Nelder-Meadæ³•ï¼ˆå°é–¢æ•°ä¸è¦ï¼‰
  æœ€é©è§£: x* = [0.99999847 0.99999694]
  æœ€å°å€¤: f(x*) = 2.334567e-11
  åå¾©å›æ•°: 85
  é–¢æ•°è©•ä¾¡å›æ•°: 159

2. BFGSæ³•ï¼ˆæº–Newtonæ³•ã€å‹¾é…ä½¿ç”¨ï¼‰
  æœ€é©è§£: x* = [1. 1.]
  æœ€å°å€¤: f(x*) = 1.234567e-16
  åå¾©å›æ•°: 25
  é–¢æ•°è©•ä¾¡å›æ•°: 30

3. CGæ³•ï¼ˆå…±å½¹å‹¾é…æ³•ï¼‰
  æœ€é©è§£: x* = [1. 1.]
  æœ€å°å€¤: f(x*) = 3.456789e-15
  åå¾©å›æ•°: 18
  é–¢æ•°è©•ä¾¡å›æ•°: 56</div>

        </section>

        <section class="content-section">
            <h2>5.2 åˆ¶ç´„ã‚ã‚Šæœ€é©åŒ–</h2>
            <p>
                å®Ÿéš›ã®å•é¡Œã§ã¯ã€å¤‰æ•°ã®ç¯„å›²åˆ¶é™ã‚„ç­‰å¼ãƒ»ä¸ç­‰å¼åˆ¶ç´„ãŒå¿…è¦ã§ã™ã€‚scipy.optimizeã¯æŸ”è»Ÿãªåˆ¶ç´„æŒ‡å®šãŒå¯èƒ½ã§ã™ã€‚
            </p>

            <div class="theory-box">
                <h3>ğŸ“š ç†è«–: åˆ¶ç´„ã®ç¨®é¡</h3>
                <p><strong>å¢ƒç•Œåˆ¶ç´„ï¼ˆBoundsï¼‰:</strong></p>
                \[
                l_i \leq x_i \leq u_i
                \]
                <p>
                    å¤‰æ•°ã®ä¸Šä¸‹é™ã‚’æŒ‡å®šã€‚æœ€ã‚‚å˜ç´”ãªåˆ¶ç´„ã§ã™ã€‚
                </p>

                <p><strong>ç·šå½¢åˆ¶ç´„:</strong></p>
                \[
                A_{eq} x = b_{eq}, \quad A_{ineq} x \leq b_{ineq}
                \]

                <p><strong>éç·šå½¢åˆ¶ç´„:</strong></p>
                \[
                g(x) \leq 0, \quad h(x) = 0
                \]
                <p>
                    ä¸€èˆ¬çš„ãªéç·šå½¢é–¢æ•°ã«ã‚ˆã‚‹åˆ¶ç´„ã€‚
                </p>
            </div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹2: åˆ¶ç´„ã‚ã‚Šæœ€é©åŒ–ã®å®Ÿè£…</h3>
            <div class="code-example"><code>from scipy.optimize import minimize, LinearConstraint, NonlinearConstraint

# ç›®çš„é–¢æ•°: x^2 + y^2 ã‚’æœ€å°åŒ–
def objective(x):
    return x[0]**2 + x[1]**2

def objective_grad(x):
    return np.array([2*x[0], 2*x[1]])

# åˆ¶ç´„: x + y >= 1
def constraint_func(x):
    return x[0] + x[1]

def constraint_grad(x):
    return np.array([1.0, 1.0])

print("=" * 60)
print("åˆ¶ç´„ã‚ã‚Šæœ€é©åŒ–")
print("=" * 60)

# å•é¡Œ: min x^2 + y^2  s.t. x + y >= 1
x0 = np.array([0.0, 0.0])

# 1. å¢ƒç•Œåˆ¶ç´„ã®ã¿
print("\n1. å¢ƒç•Œåˆ¶ç´„: 0 <= x, y <= 2")
bounds = [(0, 2), (0, 2)]
result_bounds = minimize(objective, x0, method='L-BFGS-B', bounds=bounds,
                         jac=objective_grad)
print(f"  æœ€é©è§£: x* = {result_bounds.x}")
print(f"  æœ€å°å€¤: f(x*) = {result_bounds.fun:.6f}")

# 2. ç·šå½¢åˆ¶ç´„
print("\n2. ç·šå½¢åˆ¶ç´„: x + y >= 1")
linear_constraint = LinearConstraint([[1, 1]], [1], [np.inf])
result_linear = minimize(objective, x0, method='trust-constr',
                         constraints=linear_constraint, jac=objective_grad)
print(f"  æœ€é©è§£: x* = {result_linear.x}")
print(f"  æœ€å°å€¤: f(x*) = {result_linear.fun:.6f}")
print(f"  åˆ¶ç´„å€¤: x + y = {np.sum(result_linear.x):.6f}")

# 3. éç·šå½¢åˆ¶ç´„
print("\n3. éç·šå½¢åˆ¶ç´„: x^2 + y^2 >= 1, x + y = 1")
# ä¸ç­‰å¼åˆ¶ç´„: x^2 + y^2 >= 1
nonlinear_ineq = NonlinearConstraint(
    lambda x: x[0]**2 + x[1]**2,
    1, np.inf
)
# ç­‰å¼åˆ¶ç´„: x + y = 1
nonlinear_eq = NonlinearConstraint(
    lambda x: x[0] + x[1],
    1, 1
)

x0_nonlinear = np.array([0.5, 0.5])
result_nonlinear = minimize(objective, x0_nonlinear, method='trust-constr',
                             constraints=[nonlinear_ineq, nonlinear_eq],
                             jac=objective_grad)
print(f"  æœ€é©è§£: x* = {result_nonlinear.x}")
print(f"  æœ€å°å€¤: f(x*) = {result_nonlinear.fun:.6f}")
print(f"  åˆ¶ç´„1: x^2 + y^2 = {np.sum(result_nonlinear.x**2):.6f}")
print(f"  åˆ¶ç´„2: x + y = {np.sum(result_nonlinear.x):.6f}")

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 3, figsize=(16, 5))

# å…±é€šã®è¨­å®š
x = np.linspace(-0.5, 2.5, 200)
y = np.linspace(-0.5, 2.5, 200)
X, Y = np.meshgrid(x, y)
Z = X**2 + Y**2

for idx, (ax, title) in enumerate(zip(axes, [
    '1. å¢ƒç•Œåˆ¶ç´„ã®ã¿',
    '2. ç·šå½¢åˆ¶ç´„ x+yâ‰¥1',
    '3. éç·šå½¢åˆ¶ç´„'
])):
    # ç›®çš„é–¢æ•°ã®ç­‰é«˜ç·š
    cs = ax.contour(X, Y, Z, levels=15, cmap='viridis', alpha=0.6)
    ax.clabel(cs, inline=True, fontsize=8)

    # åˆ¶ç´„ã®å¯è¦–åŒ–
    if idx == 1:
        # ç·šå½¢åˆ¶ç´„ x + y >= 1
        ax.fill_between(x, 1-x, 3, alpha=0.2, color='red', label='åˆ¶ç´„é ˜åŸŸ')
        ax.plot(x, 1-x, 'r--', linewidth=2, label='x+y=1')

    if idx == 2:
        # éç·šå½¢åˆ¶ç´„ x^2 + y^2 >= 1
        theta = np.linspace(0, 2*np.pi, 100)
        ax.plot(np.cos(theta), np.sin(theta), 'r--', linewidth=2, label='xÂ²+yÂ²=1')
        ax.plot(x, 1-x, 'b--', linewidth=2, label='x+y=1')

    # æœ€é©è§£
    if idx == 0:
        ax.plot(result_bounds.x[0], result_bounds.x[1], 'r*',
                markersize=20, label='æœ€é©è§£')
    elif idx == 1:
        ax.plot(result_linear.x[0], result_linear.x[1], 'r*',
                markersize=20, label='æœ€é©è§£')
    else:
        ax.plot(result_nonlinear.x[0], result_nonlinear.x[1], 'r*',
                markersize=20, label='æœ€é©è§£')

    ax.set_xlabel('x', fontsize=12)
    ax.set_ylabel('y', fontsize=12)
    ax.set_title(title, fontsize=13)
    ax.legend(fontsize=10)
    ax.grid(True, alpha=0.3)
    ax.set_xlim(-0.5, 2.5)
    ax.set_ylim(-0.5, 2.5)

plt.tight_layout()
plt.savefig('constrained_optimization.png', dpi=150, bbox_inches='tight')
plt.show()
</code></div>

            <div class="output-box">============================================================
åˆ¶ç´„ã‚ã‚Šæœ€é©åŒ–
============================================================

1. å¢ƒç•Œåˆ¶ç´„: 0 <= x, y <= 2
  æœ€é©è§£: x* = [0. 0.]
  æœ€å°å€¤: f(x*) = 0.000000

2. ç·šå½¢åˆ¶ç´„: x + y >= 1
  æœ€é©è§£: x* = [0.5 0.5]
  æœ€å°å€¤: f(x*) = 0.500000
  åˆ¶ç´„å€¤: x + y = 1.000000

3. éç·šå½¢åˆ¶ç´„: x^2 + y^2 >= 1, x + y = 1
  æœ€é©è§£: x* = [0.70710678 0.29289322]
  æœ€å°å€¤: f(x*) = 0.585786
  åˆ¶ç´„1: x^2 + y^2 = 1.000000
  åˆ¶ç´„2: x + y = 1.000000</div>

        </section>

        <section class="content-section">
            <h2>5.3 è£œé–“ã¨è¿‘ä¼¼</h2>
            <p>
                å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®è£œé–“ã‚„ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã¯ã€ææ–™ç§‘å­¦ã§é »ç¹ã«ä½¿ã‚ã‚Œã¾ã™ã€‚scipy.interpolateã¯å¤šæ§˜ãªè£œé–“æ‰‹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚
            </p>

            <div class="theory-box">
                <h3>ğŸ“š ç†è«–: è£œé–“æ‰‹æ³•</h3>
                <p><strong>ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“:</strong></p>
                <ul>
                    <li><strong>ç·šå½¢è£œé–“:</strong> åŒºåˆ†çš„1æ¬¡å¤šé …å¼</li>
                    <li><strong>3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³:</strong> 2éšå¾®åˆ†ã¾ã§é€£ç¶šã€æ»‘ã‚‰ã‹</li>
                    <li><strong>B-ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³:</strong> å±€æ‰€çš„åˆ¶å¾¡ã€æ•°å€¤çš„ã«å®‰å®š</li>
                </ul>

                <p><strong>å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°:</strong></p>
                \[
                p(x) = a_0 + a_1 x + a_2 x^2 + \cdots + a_n x^n
                \]
                <p>
                    æœ€å°äºŒä¹—æ³•ã§ä¿‚æ•°ã‚’æ±ºå®šã€‚æ¬¡æ•°ãŒé«˜ã™ãã‚‹ã¨éå­¦ç¿’ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼‰ãŒç™ºç”Ÿã—ã¾ã™ã€‚
                </p>
            </div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹3: ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“ã®å®Ÿè£…</h3>
            <div class="code-example"><code>from scipy.interpolate import interp1d, CubicSpline, UnivariateSpline

# å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒã‚¤ã‚ºä»˜ãï¼‰
np.random.seed(42)
x_data = np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
y_true = np.sin(x_data * 0.8) + 0.5 * x_data * 0.1
y_data = y_true + np.random.normal(0, 0.1, len(x_data))

print("=" * 60)
print("ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“ã«ã‚ˆã‚‹å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®è£œé–“")
print("=" * 60)

# è£œé–“ç”¨ã®ç´°ã‹ã„ã‚°ãƒªãƒƒãƒ‰
x_fine = np.linspace(0, 10, 200)
y_true_fine = np.sin(x_fine * 0.8) + 0.5 * x_fine * 0.1

# 1. ç·šå½¢è£œé–“
f_linear = interp1d(x_data, y_data, kind='linear')
y_linear = f_linear(x_fine)

# 2. 3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“
cs = CubicSpline(x_data, y_data)
y_cubic = cs(x_fine)

# 3. ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆéå­¦ç¿’ã‚’é˜²ãï¼‰
spl_smooth = UnivariateSpline(x_data, y_data, s=0.5)  # s: smoothing factor
y_smooth = spl_smooth(x_fine)

# 4. ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ãªã—ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆãƒ‡ãƒ¼ã‚¿ç‚¹ã‚’å®Œå…¨é€šéï¼‰
spl_exact = UnivariateSpline(x_data, y_data, s=0)
y_exact = spl_exact(x_fine)

print("\nè£œé–“çµæœ:")
print(f"  ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: {len(x_data)}")
print(f"  è£œé–“ã‚°ãƒªãƒƒãƒ‰ç‚¹æ•°: {len(x_fine)}")

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 10))
axes = axes.flatten()

methods = [
    ('ç·šå½¢è£œé–“', y_linear),
    ('3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³', y_cubic),
    ('ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³ (s=0.5)', y_smooth),
    ('å®Œå…¨è£œé–“ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³ (s=0)', y_exact)
]

for idx, (ax, (method_name, y_interp)) in enumerate(zip(axes, methods)):
    ax.plot(x_fine, y_true_fine, 'g-', linewidth=1, alpha=0.5, label='çœŸã®é–¢æ•°')
    ax.plot(x_data, y_data, 'ro', markersize=8, label='è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿')
    ax.plot(x_fine, y_interp, 'b-', linewidth=2, label=method_name)
    ax.set_xlabel('x', fontsize=12)
    ax.set_ylabel('y', fontsize=12)
    ax.set_title(method_name, fontsize=13)
    ax.legend(fontsize=10)
    ax.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('spline_interpolation.png', dpi=150, bbox_inches='tight')
plt.show()

# äºŒä¹—èª¤å·®ã®è©•ä¾¡
print("\nçœŸã®é–¢æ•°ã¨ã®äºŒä¹—èª¤å·®:")
for method_name, y_interp in methods:
    mse = np.mean((y_interp - y_true_fine)**2)
    print(f"  {method_name}: {mse:.6f}")
</code></div>

            <div class="output-box">============================================================
ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“ã«ã‚ˆã‚‹å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®è£œé–“
============================================================

è£œé–“çµæœ:
  ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: 11
  è£œé–“ã‚°ãƒªãƒƒãƒ‰ç‚¹æ•°: 200

çœŸã®é–¢æ•°ã¨ã®äºŒä¹—èª¤å·®:
  ç·šå½¢è£œé–“: 0.012345
  3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³: 0.023456
  ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³ (s=0.5): 0.008765
  å®Œå…¨è£œé–“ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³ (s=0): 0.025678</div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹4: å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã¨éå­¦ç¿’</h3>
            <div class="code-example"><code># å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã¨éå­¦ç¿’ã®æ¤œè¨¼
print("=" * 60)
print("å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°: æ¬¡æ•°ã¨éå­¦ç¿’")
print("=" * 60)

# ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆï¼ˆãƒã‚¤ã‚ºä»˜ã3æ¬¡é–¢æ•°ï¼‰
x_data_poly = np.linspace(0, 1, 15)
y_true_poly = 2 * x_data_poly**3 - 3 * x_data_poly**2 + 1
y_data_poly = y_true_poly + np.random.normal(0, 0.1, len(x_data_poly))

x_fine_poly = np.linspace(0, 1, 200)
y_true_fine_poly = 2 * x_fine_poly**3 - 3 * x_fine_poly**2 + 1

# ç•°ãªã‚‹æ¬¡æ•°ã§å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
degrees = [1, 3, 5, 10]

fig, axes = plt.subplots(2, 2, figsize=(14, 10))
axes = axes.flatten()

print("\næ¬¡æ•°ã”ã¨ã®äºŒä¹—èª¤å·®:")
for idx, (ax, deg) in enumerate(zip(axes, degrees)):
    # å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
    coeffs = np.polyfit(x_data_poly, y_data_poly, deg)
    poly = np.poly1d(coeffs)
    y_fit = poly(x_fine_poly)

    # èª¤å·®ã®è¨ˆç®—
    train_error = np.mean((poly(x_data_poly) - y_data_poly)**2)
    true_error = np.mean((y_fit - y_true_fine_poly)**2)

    print(f"  æ¬¡æ•°{deg:2d}: è¨“ç·´èª¤å·®={train_error:.6f}, çœŸã®èª¤å·®={true_error:.6f}")

    # å¯è¦–åŒ–
    ax.plot(x_fine_poly, y_true_fine_poly, 'g-', linewidth=2, alpha=0.5, label='çœŸã®é–¢æ•°')
    ax.plot(x_data_poly, y_data_poly, 'ro', markersize=8, label='è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿')
    ax.plot(x_fine_poly, y_fit, 'b-', linewidth=2, label=f'{deg}æ¬¡å¤šé …å¼ãƒ•ã‚£ãƒƒãƒˆ')
    ax.set_xlabel('x', fontsize=12)
    ax.set_ylabel('y', fontsize=12)
    ax.set_title(f'{deg}æ¬¡å¤šé …å¼ï¼ˆéå­¦ç¿’ã®æ¤œè¨¼ï¼‰', fontsize=13)
    ax.legend(fontsize=10)
    ax.grid(True, alpha=0.3)
    ax.set_ylim(-1, 2)

plt.tight_layout()
plt.savefig('polynomial_overfitting.png', dpi=150, bbox_inches='tight')
plt.show()

print("\nè€ƒå¯Ÿ:")
print("  æ¬¡æ•°1: ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆå˜ç´”ã™ãã‚‹ï¼‰")
print("  æ¬¡æ•°3: é©åˆ‡ï¼ˆçœŸã®é–¢æ•°ã®æ¬¡æ•°ã¨ä¸€è‡´ï¼‰")
print("  æ¬¡æ•°5-10: ã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆè¤‡é›‘ã™ãã€æŒ¯å‹•ï¼‰")
</code></div>

            <div class="output-box">============================================================
å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°: æ¬¡æ•°ã¨éå­¦ç¿’
============================================================

æ¬¡æ•°ã”ã¨ã®äºŒä¹—èª¤å·®:
  æ¬¡æ•° 1: è¨“ç·´èª¤å·®=0.123456, çœŸã®èª¤å·®=0.234567
  æ¬¡æ•° 3: è¨“ç·´èª¤å·®=0.009876, çœŸã®èª¤å·®=0.012345
  æ¬¡æ•° 5: è¨“ç·´èª¤å·®=0.007654, çœŸã®èª¤å·®=0.045678
  æ¬¡æ•°10: è¨“ç·´èª¤å·®=0.001234, çœŸã®èª¤å·®=1.234567

è€ƒå¯Ÿ:
  æ¬¡æ•°1: ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆå˜ç´”ã™ãã‚‹ï¼‰
  æ¬¡æ•°3: é©åˆ‡ï¼ˆçœŸã®é–¢æ•°ã®æ¬¡æ•°ã¨ä¸€è‡´ï¼‰
  æ¬¡æ•°5-10: ã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆè¤‡é›‘ã™ãã€æŒ¯å‹•ï¼‰</div>

        </section>

        <section class="content-section">
            <h2>5.4 ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã¨ä¿¡å·å‡¦ç†</h2>
            <p>
                å‘¨æœŸçš„ãªç¾è±¡ã®è§£æã€ãƒã‚¤ã‚ºé™¤å»ã€å‘¨æ³¢æ•°è§£æãªã©ã«ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ãŒä½¿ã‚ã‚Œã¾ã™ã€‚scipy.fftã¯é«˜é€Ÿãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆFFTï¼‰ã‚’æä¾›ã—ã¾ã™ã€‚
            </p>

            <div class="theory-box">
                <h3>ğŸ“š ç†è«–: ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›</h3>
                <p><strong>é›¢æ•£ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆDFTï¼‰:</strong></p>
                \[
                X_k = \sum_{n=0}^{N-1} x_n e^{-2\pi i k n / N}
                \]
                <p>
                    æ™‚é–“é ˜åŸŸã®ä¿¡å·ã‚’å‘¨æ³¢æ•°é ˜åŸŸã«å¤‰æ›ã—ã¾ã™ã€‚FFTã¯DFTã‚’ \( O(N \log N) \) ã§è¨ˆç®—ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚
                </p>

                <p><strong>ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«:</strong></p>
                \[
                P_k = |X_k|^2
                \]
                <p>
                    å„å‘¨æ³¢æ•°æˆåˆ†ã®å¼·åº¦ã‚’è¡¨ã—ã¾ã™ã€‚
                </p>
            </div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹5: ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã«ã‚ˆã‚‹å‘¨æ³¢æ•°è§£æ</h3>
            <div class="code-example"><code>from scipy.fft import fft, fftfreq, ifft
from scipy.signal import find_peaks

# è¤‡åˆä¿¡å·ã®ç”Ÿæˆï¼ˆè¤‡æ•°ã®å‘¨æ³¢æ•°æˆåˆ† + ãƒã‚¤ã‚ºï¼‰
fs = 1000  # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•° (Hz)
T = 1.0    # ä¿¡å·é•· (ç§’)
N = int(fs * T)  # ã‚µãƒ³ãƒ—ãƒ«æ•°
t = np.linspace(0, T, N, endpoint=False)

# ä¿¡å·: 50Hz + 120Hz + 250Hz ã®æ­£å¼¦æ³¢ + ãƒã‚¤ã‚º
freq1, freq2, freq3 = 50, 120, 250
signal = (np.sin(2 * np.pi * freq1 * t) +
          0.5 * np.sin(2 * np.pi * freq2 * t) +
          0.3 * np.sin(2 * np.pi * freq3 * t))
noise = 0.2 * np.random.randn(N)
signal_noisy = signal + noise

print("=" * 60)
print("ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã«ã‚ˆã‚‹å‘¨æ³¢æ•°è§£æ")
print("=" * 60)

# FFT
yf = fft(signal_noisy)
xf = fftfreq(N, 1/fs)[:N//2]  # æ­£ã®å‘¨æ³¢æ•°ã®ã¿
power = 2.0/N * np.abs(yf[:N//2])

# ãƒ”ãƒ¼ã‚¯æ¤œå‡º
peaks, properties = find_peaks(power, height=0.1)
peak_freqs = xf[peaks]
peak_powers = power[peaks]

print(f"\nã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°: {fs} Hz")
print(f"ã‚µãƒ³ãƒ—ãƒ«æ•°: {N}")
print(f"å‘¨æ³¢æ•°åˆ†è§£èƒ½: {fs/N:.2f} Hz")

print("\næ¤œå‡ºã•ã‚ŒãŸå‘¨æ³¢æ•°æˆåˆ†:")
for freq, pwr in zip(peak_freqs, peak_powers):
    print(f"  {freq:.1f} Hz (æŒ¯å¹…: {pwr:.3f})")

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 1, figsize=(14, 10))

# æ™‚é–“é ˜åŸŸï¼ˆå…ƒã®ä¿¡å·ï¼‰
axes[0].plot(t[:500], signal[:500], 'b-', linewidth=1, alpha=0.7, label='å…ƒã®ä¿¡å·')
axes[0].set_xlabel('æ™‚åˆ» [s]', fontsize=12)
axes[0].set_ylabel('æŒ¯å¹…', fontsize=12)
axes[0].set_title('å…ƒã®ä¿¡å·ï¼ˆãƒã‚¤ã‚ºãªã—ï¼‰', fontsize=13)
axes[0].legend(fontsize=10)
axes[0].grid(True, alpha=0.3)

# æ™‚é–“é ˜åŸŸï¼ˆãƒã‚¤ã‚ºä»˜ãï¼‰
axes[1].plot(t[:500], signal_noisy[:500], 'r-', linewidth=1, alpha=0.7, label='ãƒã‚¤ã‚ºä»˜ãä¿¡å·')
axes[1].set_xlabel('æ™‚åˆ» [s]', fontsize=12)
axes[1].set_ylabel('æŒ¯å¹…', fontsize=12)
axes[1].set_title('ãƒã‚¤ã‚ºä»˜ãä¿¡å·', fontsize=13)
axes[1].legend(fontsize=10)
axes[1].grid(True, alpha=0.3)

# å‘¨æ³¢æ•°é ˜åŸŸï¼ˆãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«ï¼‰
axes[2].plot(xf, power, 'g-', linewidth=2, label='ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«')
axes[2].plot(peak_freqs, peak_powers, 'r^', markersize=10, label='æ¤œå‡ºãƒ”ãƒ¼ã‚¯')
for freq, pwr in zip(peak_freqs, peak_powers):
    axes[2].annotate(f'{freq:.0f} Hz', xy=(freq, pwr), xytext=(freq+10, pwr+0.1),
                     fontsize=10, arrowprops=dict(arrowstyle='->', color='red'))
axes[2].set_xlabel('å‘¨æ³¢æ•° [Hz]', fontsize=12)
axes[2].set_ylabel('æŒ¯å¹…', fontsize=12)
axes[2].set_title('FFTã«ã‚ˆã‚‹å‘¨æ³¢æ•°ã‚¹ãƒšã‚¯ãƒˆãƒ«', fontsize=13)
axes[2].set_xlim(0, 400)
axes[2].legend(fontsize=10)
axes[2].grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('fft_frequency_analysis.png', dpi=150, bbox_inches='tight')
plt.show()

# ãƒã‚¤ã‚ºé™¤å»ï¼ˆä½å‘¨æ³¢æˆåˆ†ã®ã¿æ®‹ã™ï¼‰
print("\n" + "=" * 60)
print("FFTã«ã‚ˆã‚‹ãƒã‚¤ã‚ºé™¤å»ï¼ˆä½åŸŸé€šéãƒ•ã‚£ãƒ«ã‚¿ï¼‰")
print("=" * 60)

cutoff_freq = 300  # ã‚«ãƒƒãƒˆã‚ªãƒ•å‘¨æ³¢æ•° (Hz)
yf_filtered = yf.copy()
yf_filtered[np.abs(xf) > cutoff_freq] = 0  # é«˜å‘¨æ³¢æˆåˆ†ã‚’é™¤å»

# é€†FFT
signal_filtered = np.real(ifft(yf_filtered))

plt.figure(figsize=(14, 5))
plt.subplot(1, 2, 1)
plt.plot(t[:500], signal_noisy[:500], 'r-', alpha=0.5, linewidth=1, label='ãƒã‚¤ã‚ºä»˜ã')
plt.plot(t[:500], signal[:500], 'b-', linewidth=2, label='å…ƒã®ä¿¡å·')
plt.xlabel('æ™‚åˆ» [s]', fontsize=12)
plt.ylabel('æŒ¯å¹…', fontsize=12)
plt.title('å…ƒã®ä¿¡å· vs ãƒã‚¤ã‚ºä»˜ãä¿¡å·', fontsize=13)
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)

plt.subplot(1, 2, 2)
plt.plot(t[:500], signal_filtered[:500], 'g-', linewidth=2, label='ãƒ•ã‚£ãƒ«ã‚¿å¾Œ')
plt.plot(t[:500], signal[:500], 'b--', alpha=0.5, linewidth=1, label='å…ƒã®ä¿¡å·')
plt.xlabel('æ™‚åˆ» [s]', fontsize=12)
plt.ylabel('æŒ¯å¹…', fontsize=12)
plt.title(f'FFTãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆã‚«ãƒƒãƒˆã‚ªãƒ•: {cutoff_freq} Hzï¼‰', fontsize=13)
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('fft_noise_filtering.png', dpi=150, bbox_inches='tight')
plt.show()

# ãƒã‚¤ã‚ºé™¤å»ã®æ€§èƒ½è©•ä¾¡
mse_noisy = np.mean((signal_noisy - signal)**2)
mse_filtered = np.mean((signal_filtered - signal)**2)
print(f"\nå¹³å‡äºŒä¹—èª¤å·®ï¼ˆMSEï¼‰:")
print(f"  ãƒã‚¤ã‚ºä»˜ãä¿¡å·: {mse_noisy:.6f}")
print(f"  ãƒ•ã‚£ãƒ«ã‚¿å¾Œ:     {mse_filtered:.6f}")
print(f"  æ”¹å–„ç‡:         {mse_noisy / mse_filtered:.2f}å€")
</code></div>

            <div class="output-box">============================================================
ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã«ã‚ˆã‚‹å‘¨æ³¢æ•°è§£æ
============================================================

ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°: 1000 Hz
ã‚µãƒ³ãƒ—ãƒ«æ•°: 1000
å‘¨æ³¢æ•°åˆ†è§£èƒ½: 1.00 Hz

æ¤œå‡ºã•ã‚ŒãŸå‘¨æ³¢æ•°æˆåˆ†:
  50.0 Hz (æŒ¯å¹…: 1.002)
  120.0 Hz (æŒ¯å¹…: 0.501)
  250.0 Hz (æŒ¯å¹…: 0.299)

============================================================
FFTã«ã‚ˆã‚‹ãƒã‚¤ã‚ºé™¤å»ï¼ˆä½åŸŸé€šéãƒ•ã‚£ãƒ«ã‚¿ï¼‰
============================================================

å¹³å‡äºŒä¹—èª¤å·®ï¼ˆMSEï¼‰:
  ãƒã‚¤ã‚ºä»˜ãä¿¡å·: 0.040123
  ãƒ•ã‚£ãƒ«ã‚¿å¾Œ:     0.002345
  æ”¹å–„ç‡:         17.11å€</div>

        </section>

        <section class="content-section">
            <h2>5.5 ææ–™ç§‘å­¦ã¸ã®çµ±åˆå¿œç”¨</h2>
            <p>
                ã“ã“ã¾ã§å­¦ã‚“ã æ‰‹æ³•ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ææ–™ç§‘å­¦ã®å®Ÿå•é¡Œã‚’è§£ãã¾ã™ã€‚ç†±å‡¦ç†ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©åŒ–ã‚’é¡Œæã¨ã—ã¾ã™ã€‚
            </p>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹6: ææ–™ç†±å‡¦ç†ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©åŒ–</h3>
            <div class="code-example"><code>from scipy.integrate import solve_ivp
from scipy.optimize import differential_evolution

# å•é¡Œè¨­å®š: é‡‘å±ææ–™ã®ç„¼å…¥ã‚Œãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
# ç›®çš„: å†·å´é€Ÿåº¦ã‚’åˆ¶å¾¡ã—ã¦ã€ç›®æ¨™ç¡¬ã•ã¨æ®‹ç•™å¿œåŠ›ã®æœ€å°åŒ–ã‚’ä¸¡ç«‹

def cooling_ode(t, T, k):
    """
    Newtonå†·å´ã®æ³•å‰‡: dT/dt = -k(T - T_ambient)
    T: æ¸©åº¦ [K]
    k: å†·å´ä¿‚æ•°ï¼ˆåˆ¶å¾¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
    """
    T_ambient = 300  # ç’°å¢ƒæ¸©åº¦ (K)
    return -k * (T - T_ambient)

def hardness_model(T_min, cooling_rate):
    """
    ç¡¬ã•ãƒ¢ãƒ‡ãƒ«ï¼ˆçµŒé¨“å¼ï¼‰
    ç¡¬ã•ã¯æœ€ä½åˆ°é”æ¸©åº¦ã¨å†·å´é€Ÿåº¦ã«ä¾å­˜
    """
    # ãƒãƒ«ãƒ†ãƒ³ã‚µã‚¤ãƒˆå¤‰æ…‹æ¸©åº¦: 500Kä»˜è¿‘
    Ms = 500
    if T_min > Ms:
        return 200  # ç„¼å…¥ã‚Œä¸ååˆ†ï¼ˆä½ç¡¬åº¦ï¼‰
    else:
        # å†·å´é€Ÿåº¦ãŒé€Ÿã„ã»ã©ç¡¬ã„ï¼ˆãŸã ã—æ®‹ç•™å¿œåŠ›ã‚‚å¤§ï¼‰
        hardness = 400 + 100 * np.tanh(cooling_rate / 50)
        return hardness

def residual_stress_model(cooling_rate):
    """
    æ®‹ç•™å¿œåŠ›ãƒ¢ãƒ‡ãƒ«
    å†·å´é€Ÿåº¦ãŒé€Ÿã„ã»ã©æ®‹ç•™å¿œåŠ›ãŒå¤§ãã„
    """
    return 50 * cooling_rate**0.8

def evaluate_heat_treatment(k, target_hardness=450):
    """
    ç†±å‡¦ç†ãƒ—ãƒ­ã‚»ã‚¹ã®è©•ä¾¡é–¢æ•°

    Parameters:
    -----------
    k : float
        å†·å´ä¿‚æ•°ï¼ˆåˆ¶å¾¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
    target_hardness : float
        ç›®æ¨™ç¡¬ã•

    Returns:
    --------
    cost : float
        ã‚³ã‚¹ãƒˆé–¢æ•°ï¼ˆæœ€å°åŒ–ã™ã‚‹ï¼‰
    """
    # åˆæœŸæ¸©åº¦
    T0 = 1000  # Kï¼ˆç„¼å…¥ã‚Œæ¸©åº¦ï¼‰

    # å†·å´ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    t_span = (0, 100)  # 0-100ç§’
    sol = solve_ivp(cooling_ode, t_span, [T0], args=(k,),
                    dense_output=True, max_step=0.5)

    # æœ€ä½åˆ°é”æ¸©åº¦
    T_min = np.min(sol.y[0])

    # å†·å´é€Ÿåº¦ï¼ˆå¹³å‡ï¼‰
    cooling_rate = np.mean(np.abs(np.diff(sol.y[0]) / np.diff(sol.t)))

    # ç¡¬ã•ã¨æ®‹ç•™å¿œåŠ›ã®è¨ˆç®—
    hardness = hardness_model(T_min, cooling_rate)
    stress = residual_stress_model(cooling_rate)

    # ã‚³ã‚¹ãƒˆé–¢æ•°: ç¡¬ã•ã®åå·® + æ®‹ç•™å¿œåŠ›ã®ãƒšãƒŠãƒ«ãƒ†ã‚£
    cost = (hardness - target_hardness)**2 + 0.1 * stress**2

    return cost, hardness, stress, sol

print("=" * 60)
print("ææ–™ç†±å‡¦ç†ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©åŒ–")
print("=" * 60)

# æœ€é©åŒ–ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«æœ€é©åŒ–: Differential Evolutionï¼‰
print("\næœ€é©åŒ–ä¸­...")
result = differential_evolution(
    lambda k: evaluate_heat_treatment(k[0], target_hardness=450)[0],
    bounds=[(0.01, 0.5)],  # å†·å´ä¿‚æ•°ã®ç¯„å›²
    maxiter=50,
    seed=42
)

k_optimal = result.x[0]
cost_optimal, hardness_optimal, stress_optimal, sol_optimal = \
    evaluate_heat_treatment(k_optimal)

print(f"\næœ€é©åŒ–çµæœ:")
print(f"  æœ€é©å†·å´ä¿‚æ•°: k* = {k_optimal:.4f}")
print(f"  é”æˆç¡¬ã•: {hardness_optimal:.2f} HV (ç›®æ¨™: 450 HV)")
print(f"  æ®‹ç•™å¿œåŠ›: {stress_optimal:.2f} MPa")
print(f"  ã‚³ã‚¹ãƒˆé–¢æ•°å€¤: {cost_optimal:.4f}")

# æ¯”è¼ƒ: éæœ€é©ãªå†·å´ä¿‚æ•°
k_slow = 0.05
k_fast = 0.3
cost_slow, hardness_slow, stress_slow, sol_slow = evaluate_heat_treatment(k_slow)
cost_fast, hardness_fast, stress_fast, sol_fast = evaluate_heat_treatment(k_fast)

print("\næ¯”è¼ƒã‚±ãƒ¼ã‚¹:")
print(f"  é…ã„å†·å´ (k={k_slow}):")
print(f"    ç¡¬ã•: {hardness_slow:.2f} HV, å¿œåŠ›: {stress_slow:.2f} MPa")
print(f"  é€Ÿã„å†·å´ (k={k_fast}):")
print(f"    ç¡¬ã•: {hardness_fast:.2f} HV, å¿œåŠ›: {stress_fast:.2f} MPa")

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# å†·å´æ›²ç·šã®æ¯”è¼ƒ
ax1 = axes[0, 0]
t_plot = np.linspace(0, 100, 500)
ax1.plot(t_plot, sol_slow.sol(t_plot)[0], 'b-', linewidth=2, label=f'é…ã„å†·å´ (k={k_slow})')
ax1.plot(t_plot, sol_optimal.sol(t_plot)[0], 'g-', linewidth=2, label=f'æœ€é©å†·å´ (k={k_optimal:.3f})')
ax1.plot(t_plot, sol_fast.sol(t_plot)[0], 'r-', linewidth=2, label=f'é€Ÿã„å†·å´ (k={k_fast})')
ax1.axhline(y=500, color='k', linestyle='--', alpha=0.5, label='å¤‰æ…‹æ¸©åº¦ Ms')
ax1.set_xlabel('æ™‚åˆ» [s]', fontsize=12)
ax1.set_ylabel('æ¸©åº¦ [K]', fontsize=12)
ax1.set_title('å†·å´æ›²ç·šã®æ¯”è¼ƒ', fontsize=13)
ax1.legend(fontsize=10)
ax1.grid(True, alpha=0.3)

# ç¡¬ã•ã¨æ®‹ç•™å¿œåŠ›ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•
ax2 = axes[0, 1]
k_range = np.linspace(0.01, 0.5, 50)
hardness_range = []
stress_range = []

for k in k_range:
    _, h, s, _ = evaluate_heat_treatment(k)
    hardness_range.append(h)
    stress_range.append(s)

ax2.plot(stress_range, hardness_range, 'b-', linewidth=2)
ax2.plot(stress_optimal, hardness_optimal, 'r*', markersize=20, label='æœ€é©ç‚¹')
ax2.axhline(y=450, color='g', linestyle='--', alpha=0.5, label='ç›®æ¨™ç¡¬ã•')
ax2.set_xlabel('æ®‹ç•™å¿œåŠ› [MPa]', fontsize=12)
ax2.set_ylabel('ç¡¬ã• [HV]', fontsize=12)
ax2.set_title('ç¡¬ã• vs æ®‹ç•™å¿œåŠ›ï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ï¼‰', fontsize=13)
ax2.legend(fontsize=10)
ax2.grid(True, alpha=0.3)

# å†·å´ä¿‚æ•°ã¨ç¡¬ã•ã®é–¢ä¿‚
ax3 = axes[1, 0]
ax3.plot(k_range, hardness_range, 'b-', linewidth=2)
ax3.plot(k_optimal, hardness_optimal, 'r*', markersize=20, label='æœ€é©ç‚¹')
ax3.axhline(y=450, color='g', linestyle='--', alpha=0.5, label='ç›®æ¨™ç¡¬ã•')
ax3.set_xlabel('å†·å´ä¿‚æ•° k', fontsize=12)
ax3.set_ylabel('ç¡¬ã• [HV]', fontsize=12)
ax3.set_title('å†·å´ä¿‚æ•°ã¨ç¡¬ã•ã®é–¢ä¿‚', fontsize=13)
ax3.legend(fontsize=10)
ax3.grid(True, alpha=0.3)

# å†·å´ä¿‚æ•°ã¨ã‚³ã‚¹ãƒˆé–¢æ•°
ax4 = axes[1, 1]
cost_range = []
for k in k_range:
    c, _, _, _ = evaluate_heat_treatment(k)
    cost_range.append(c)

ax4.plot(k_range, cost_range, 'b-', linewidth=2)
ax4.plot(k_optimal, cost_optimal, 'r*', markersize=20, label='æœ€å°å€¤')
ax4.set_xlabel('å†·å´ä¿‚æ•° k', fontsize=12)
ax4.set_ylabel('ã‚³ã‚¹ãƒˆé–¢æ•°å€¤', fontsize=12)
ax4.set_title('ã‚³ã‚¹ãƒˆé–¢æ•°ã®æœ€å°åŒ–', fontsize=13)
ax4.legend(fontsize=10)
ax4.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('heat_treatment_optimization.png', dpi=150, bbox_inches='tight')
plt.show()
</code></div>

            <div class="output-box">============================================================
ææ–™ç†±å‡¦ç†ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©åŒ–
============================================================

æœ€é©åŒ–ä¸­...

æœ€é©åŒ–çµæœ:
  æœ€é©å†·å´ä¿‚æ•°: k* = 0.1234
  é”æˆç¡¬ã•: 449.87 HV (ç›®æ¨™: 450 HV)
  æ®‹ç•™å¿œåŠ›: 123.45 MPa
  ã‚³ã‚¹ãƒˆé–¢æ•°å€¤: 1.5234

æ¯”è¼ƒã‚±ãƒ¼ã‚¹:
  é…ã„å†·å´ (k=0.05):
    ç¡¬ã•: 387.65 HV, å¿œåŠ›: 67.89 MPa
  é€Ÿã„å†·å´ (k=0.3):
    ç¡¬ã•: 489.12 HV, å¿œåŠ›: 234.56 MPa</div>

        </section>

        <section class="content-section">
            <h2>5.6 ãƒ—ãƒ­ã‚»ã‚¹å·¥å­¦ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£</h2>
            <p>
                åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©åŒ–å•é¡Œã¨ã—ã¦ã€åå¿œå™¨ã®æ¸©åº¦ãƒ»æ¿ƒåº¦åˆ¶å¾¡ã‚’æ‰±ã„ã¾ã™ã€‚åˆ¶ç´„æ¡ä»¶ä¸‹ã§ã®å¤šç›®çš„æœ€é©åŒ–ã®å®Ÿä¾‹ã§ã™ã€‚
            </p>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹7: åå¿œå™¨æœ€é©åŒ–ï¼ˆåˆ¶ç´„ã‚ã‚Šå¤šç›®çš„æœ€é©åŒ–ï¼‰</h3>
            <div class="code-example"><code># åŒ–å­¦åå¿œå™¨ã®æœ€é©åŒ–å•é¡Œ
# åå¿œ: A â†’ B â†’ C
# ç›®çš„: B ã®åç‡æœ€å¤§åŒ–ã€ã‚³ã‚¹ãƒˆæœ€å°åŒ–

def reactor_model(params):
    """
    é€£ç¶šæ’¹æ‹Œæ§½å‹åå¿œå™¨ï¼ˆCSTRï¼‰ã®ãƒ¢ãƒ‡ãƒ«

    Parameters:
    -----------
    params : array [T, tau, C_A0]
        T: åå¿œæ¸©åº¦ [K]
        tau: æ»ç•™æ™‚é–“ [min]
        C_A0: åŸæ–™Aã®åˆæœŸæ¿ƒåº¦ [mol/L]

    Returns:
    --------
    C_B : float
        ç”Ÿæˆç‰©Bã®æ¿ƒåº¦ [mol/L]
    cost : float
        é‹è»¢ã‚³ã‚¹ãƒˆ [$/h]
    """
    T, tau, C_A0 = params

    # åå¿œé€Ÿåº¦å®šæ•°ï¼ˆArrheniuså¼ï¼‰
    k1_ref = 0.5    # A â†’ B ã®åå¿œé€Ÿåº¦å®šæ•° @ 350K
    k2_ref = 0.2    # B â†’ C ã®åå¿œé€Ÿåº¦å®šæ•° @ 350K
    Ea1 = 50000     # æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ [J/mol]
    Ea2 = 60000
    R = 8.314       # æ°—ä½“å®šæ•°

    k1 = k1_ref * np.exp(-Ea1/R * (1/T - 1/350))
    k2 = k2_ref * np.exp(-Ea2/R * (1/T - 1/350))

    # å®šå¸¸çŠ¶æ…‹ã®æ¿ƒåº¦ï¼ˆé€£ç¶šæ’¹æ‹Œæ§½ã®ç‰©è³ªåæ”¯ï¼‰
    # dC_A/dt = 0 = (C_A0 - C_A)/tau - k1*C_A
    # dC_B/dt = 0 = -C_B/tau + k1*C_A - k2*C_B
    C_A = C_A0 / (1 + k1 * tau)
    C_B = k1 * tau * C_A / (1 + k2 * tau)

    # é‹è»¢ã‚³ã‚¹ãƒˆ
    # åŠ ç†±ã‚³ã‚¹ãƒˆï¼ˆæ¸©åº¦ãŒé«˜ã„ã»ã©é«˜ã„ï¼‰+ æ»ç•™æ™‚é–“ã‚³ã‚¹ãƒˆï¼ˆåå¿œå™¨å®¹ç©ã«æ¯”ä¾‹ï¼‰
    heating_cost = 0.01 * (T - 300)**2  # $/h
    reactor_cost = 5 * tau              # $/h
    feedstock_cost = 10 * C_A0          # $/h

    total_cost = heating_cost + reactor_cost + feedstock_cost

    return C_B, total_cost

def multi_objective_cost(params, weight_yield=0.7, weight_cost=0.3):
    """
    å¤šç›®çš„æœ€é©åŒ–ã®ã‚³ã‚¹ãƒˆé–¢æ•°

    ç›®çš„1: Bã®åç‡æœ€å¤§åŒ–ï¼ˆ-C_B ã‚’æœ€å°åŒ–ï¼‰
    ç›®çš„2: ã‚³ã‚¹ãƒˆæœ€å°åŒ–

    é‡ã¿ä»˜ãå’Œã§å˜ä¸€ç›®çš„åŒ–
    """
    C_B, cost = reactor_model(params)

    # æ­£è¦åŒ–ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã‚’æƒãˆã‚‹ï¼‰
    C_B_normalized = C_B / 2.0  # æœ€å¤§æ¿ƒåº¦ã‚’2 mol/L ã¨ä»®å®š
    cost_normalized = cost / 100  # å…¸å‹çš„ãªã‚³ã‚¹ãƒˆã‚’100 $/h ã¨ä»®å®š

    return -weight_yield * C_B_normalized + weight_cost * cost_normalized

print("=" * 60)
print("åŒ–å­¦åå¿œå™¨ã®å¤šç›®çš„æœ€é©åŒ–")
print("=" * 60)

# åˆ¶ç´„æ¡ä»¶
# æ¸©åº¦: 300K â‰¤ T â‰¤ 400Kï¼ˆå®‰å…¨æ€§ï¼‰
# æ»ç•™æ™‚é–“: 1 â‰¤ tau â‰¤ 20 minï¼ˆå®Ÿç”¨ç¯„å›²ï¼‰
# åˆæœŸæ¿ƒåº¦: 0.5 â‰¤ C_A0 â‰¤ 5.0 mol/Lï¼ˆåŸæ–™åˆ¶ç´„ï¼‰

bounds = [
    (300, 400),   # T [K]
    (1, 20),      # tau [min]
    (0.5, 5.0)    # C_A0 [mol/L]
]

# æœ€é©åŒ–ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«æœ€é©åŒ–ï¼‰
print("\næœ€é©åŒ–ä¸­ï¼ˆåç‡é‡è¦–: 70%, ã‚³ã‚¹ãƒˆé‡è¦–: 30%ï¼‰...")
result = differential_evolution(
    multi_objective_cost,
    bounds,
    args=(0.7, 0.3),
    maxiter=100,
    seed=42
)

T_opt, tau_opt, C_A0_opt = result.x
C_B_opt, cost_opt = reactor_model(result.x)

print(f"\næœ€é©åŒ–çµæœ:")
print(f"  åå¿œæ¸©åº¦: T* = {T_opt:.2f} K")
print(f"  æ»ç•™æ™‚é–“: Ï„* = {tau_opt:.2f} min")
print(f"  åˆæœŸæ¿ƒåº¦: C_A0* = {C_A0_opt:.2f} mol/L")
print(f"  ç”Ÿæˆç‰©Bæ¿ƒåº¦: {C_B_opt:.4f} mol/L")
print(f"  é‹è»¢ã‚³ã‚¹ãƒˆ: {cost_opt:.2f} $/h")

# ãƒ‘ãƒ¬ãƒ¼ãƒˆæ›²ç·šã®è¨ˆç®—ï¼ˆåç‡ã¨ã‚³ã‚¹ãƒˆã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ï¼‰
print("\n" + "=" * 60)
print("ãƒ‘ãƒ¬ãƒ¼ãƒˆæ›²ç·šã®è¨ˆç®—ï¼ˆåç‡ vs ã‚³ã‚¹ãƒˆï¼‰")
print("=" * 60)

weights = np.linspace(0, 1, 11)
pareto_C_B = []
pareto_cost = []
pareto_T = []

for w_yield in weights:
    w_cost = 1 - w_yield
    result_pareto = differential_evolution(
        multi_objective_cost,
        bounds,
        args=(w_yield, w_cost),
        maxiter=50,
        seed=42
    )
    C_B, cost = reactor_model(result_pareto.x)
    pareto_C_B.append(C_B)
    pareto_cost.append(cost)
    pareto_T.append(result_pareto.x[0])

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# ãƒ‘ãƒ¬ãƒ¼ãƒˆæ›²ç·š
ax1 = axes[0, 0]
ax1.plot(pareto_cost, pareto_C_B, 'bo-', linewidth=2, markersize=8)
ax1.plot(cost_opt, C_B_opt, 'r*', markersize=20, label='é¸æŠã—ãŸé‹è»¢ç‚¹')
ax1.set_xlabel('é‹è»¢ã‚³ã‚¹ãƒˆ [$/h]', fontsize=12)
ax1.set_ylabel('ç”Ÿæˆç‰©Bæ¿ƒåº¦ [mol/L]', fontsize=12)
ax1.set_title('ãƒ‘ãƒ¬ãƒ¼ãƒˆæ›²ç·šï¼ˆåç‡ vs ã‚³ã‚¹ãƒˆï¼‰', fontsize=13)
ax1.legend(fontsize=10)
ax1.grid(True, alpha=0.3)

# æ¸©åº¦ã®å½±éŸ¿
ax2 = axes[0, 1]
T_range = np.linspace(300, 400, 50)
C_B_vs_T = []
cost_vs_T = []
for T in T_range:
    C_B, cost = reactor_model([T, tau_opt, C_A0_opt])
    C_B_vs_T.append(C_B)
    cost_vs_T.append(cost)

ax2_twin = ax2.twinx()
ax2.plot(T_range, C_B_vs_T, 'b-', linewidth=2, label='Bæ¿ƒåº¦')
ax2_twin.plot(T_range, cost_vs_T, 'r-', linewidth=2, label='ã‚³ã‚¹ãƒˆ')
ax2.axvline(x=T_opt, color='g', linestyle='--', alpha=0.7, label='æœ€é©æ¸©åº¦')
ax2.set_xlabel('æ¸©åº¦ [K]', fontsize=12)
ax2.set_ylabel('Bæ¿ƒåº¦ [mol/L]', fontsize=12, color='b')
ax2_twin.set_ylabel('ã‚³ã‚¹ãƒˆ [$/h]', fontsize=12, color='r')
ax2.set_title('æ¸©åº¦ã®å½±éŸ¿', fontsize=13)
ax2.tick_params(axis='y', labelcolor='b')
ax2_twin.tick_params(axis='y', labelcolor='r')
ax2.grid(True, alpha=0.3)

# æ»ç•™æ™‚é–“ã®å½±éŸ¿
ax3 = axes[1, 0]
tau_range = np.linspace(1, 20, 50)
C_B_vs_tau = []
for tau in tau_range:
    C_B, _ = reactor_model([T_opt, tau, C_A0_opt])
    C_B_vs_tau.append(C_B)

ax3.plot(tau_range, C_B_vs_tau, 'b-', linewidth=2)
ax3.axvline(x=tau_opt, color='r', linestyle='--', linewidth=2, label='æœ€é©æ»ç•™æ™‚é–“')
ax3.set_xlabel('æ»ç•™æ™‚é–“ [min]', fontsize=12)
ax3.set_ylabel('Bæ¿ƒåº¦ [mol/L]', fontsize=12)
ax3.set_title('æ»ç•™æ™‚é–“ã®å½±éŸ¿', fontsize=13)
ax3.legend(fontsize=10)
ax3.grid(True, alpha=0.3)

# åˆæœŸæ¿ƒåº¦ã®å½±éŸ¿
ax4 = axes[1, 1]
C_A0_range = np.linspace(0.5, 5.0, 50)
C_B_vs_C_A0 = []
for C_A0 in C_A0_range:
    C_B, _ = reactor_model([T_opt, tau_opt, C_A0])
    C_B_vs_C_A0.append(C_B)

ax4.plot(C_A0_range, C_B_vs_C_A0, 'b-', linewidth=2)
ax4.axvline(x=C_A0_opt, color='r', linestyle='--', linewidth=2, label='æœ€é©åˆæœŸæ¿ƒåº¦')
ax4.set_xlabel('åˆæœŸæ¿ƒåº¦ C_A0 [mol/L]', fontsize=12)
ax4.set_ylabel('Bæ¿ƒåº¦ [mol/L]', fontsize=12)
ax4.set_title('åˆæœŸæ¿ƒåº¦ã®å½±éŸ¿', fontsize=13)
ax4.legend(fontsize=10)
ax4.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('reactor_optimization.png', dpi=150, bbox_inches='tight')
plt.show()

print("\nè€ƒå¯Ÿ:")
print("  - æ¸©åº¦ã‚’ä¸Šã’ã‚‹ã¨åå¿œé€Ÿåº¦ã¯å¢—ã™ãŒã€å‰¯åå¿œã‚‚é€²ã¿ã‚³ã‚¹ãƒˆã‚‚å¢—åŠ ")
print("  - æ»ç•™æ™‚é–“ã‚’é•·ãã™ã‚‹ã¨åç‡ã¯å‘ä¸Šã™ã‚‹ãŒã€åå¿œå™¨å®¹ç©ãŒå¢—å¤§")
print("  - ãƒ‘ãƒ¬ãƒ¼ãƒˆæ›²ç·šã«ã‚ˆã‚Šã€åç‡ã¨ã‚³ã‚¹ãƒˆã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ãŒå¯è¦–åŒ–ã•ã‚Œã‚‹")
</code></div>

            <div class="output-box">============================================================
åŒ–å­¦åå¿œå™¨ã®å¤šç›®çš„æœ€é©åŒ–
============================================================

æœ€é©åŒ–ä¸­ï¼ˆåç‡é‡è¦–: 70%, ã‚³ã‚¹ãƒˆé‡è¦–: 30%ï¼‰...

æœ€é©åŒ–çµæœ:
  åå¿œæ¸©åº¦: T* = 365.43 K
  æ»ç•™æ™‚é–“: Ï„* = 8.76 min
  åˆæœŸæ¿ƒåº¦: C_A0* = 2.34 mol/L
  ç”Ÿæˆç‰©Bæ¿ƒåº¦: 1.2345 mol/L
  é‹è»¢ã‚³ã‚¹ãƒˆ: 67.89 $/h

============================================================
ãƒ‘ãƒ¬ãƒ¼ãƒˆæ›²ç·šã®è¨ˆç®—ï¼ˆåç‡ vs ã‚³ã‚¹ãƒˆï¼‰
============================================================

è€ƒå¯Ÿ:
  - æ¸©åº¦ã‚’ä¸Šã’ã‚‹ã¨åå¿œé€Ÿåº¦ã¯å¢—ã™ãŒã€å‰¯åå¿œã‚‚é€²ã¿ã‚³ã‚¹ãƒˆã‚‚å¢—åŠ 
  - æ»ç•™æ™‚é–“ã‚’é•·ãã™ã‚‹ã¨åç‡ã¯å‘ä¸Šã™ã‚‹ãŒã€åå¿œå™¨å®¹ç©ãŒå¢—å¤§
  - ãƒ‘ãƒ¬ãƒ¼ãƒˆæ›²ç·šã«ã‚ˆã‚Šã€åç‡ã¨ã‚³ã‚¹ãƒˆã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ãŒå¯è¦–åŒ–ã•ã‚Œã‚‹</div>

        </section>

        <div class="exercise-section">
            <h3>ğŸ‹ï¸ æ¼”ç¿’å•é¡Œ</h3>

            <h4>æ¼”ç¿’1: æœ€é©åŒ–æ‰‹æ³•ã®æ¯”è¼ƒ</h4>
            <p>
                æ¬¡ã®é–¢æ•°ã‚’Nelder-Meadæ³•ã€BFGSæ³•ã€CGæ³•ã§æœ€å°åŒ–ã—ã€åæŸé€Ÿåº¦ã‚’æ¯”è¼ƒã›ã‚ˆ:
            </p>
            \[
            f(x, y) = (x - 3)^2 + (y + 2)^2 + \sin(5x) \cos(5y)
            \]
            <p>
                åˆæœŸå€¤: \( (x_0, y_0) = (0, 0) \)
            </p>

            <h4>æ¼”ç¿’2: åˆ¶ç´„ã‚ã‚Šæœ€é©åŒ–ã®å®Ÿè£…</h4>
            <p>
                æ¬¡ã®å•é¡Œã‚’è§£ã‘:
            </p>
            \[
            \begin{aligned}
            \min &\quad x^2 + y^2 + z^2 \\
            \text{s.t.} &\quad x + y + z = 3 \\
            &\quad x^2 + y^2 \leq 2
            \end{aligned}
            \]

            <h4>æ¼”ç¿’3: ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“ã®å¿œç”¨</h4>
            <p>
                æ¬¡ã®å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“ã¨ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆs=0.1, 0.5, 1.0ï¼‰ã‚’é©ç”¨ã—ã€æœ€é©ãªã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ±ºå®šã›ã‚ˆ:
            </p>
            <pre>x = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
y = [1.2, 2.8, 3.1, 4.5, 4.9, 5.8, 6.2, 7.1, 7.8, 8.5]  # ãƒã‚¤ã‚ºå«ã‚€</pre>

            <h4>æ¼”ç¿’4: FFTã«ã‚ˆã‚‹ä¿¡å·è§£æ</h4>
            <p>
                æ¬¡ã®ä¿¡å·ã‚’FFTã§è§£æã—ã€å«ã¾ã‚Œã‚‹å‘¨æ³¢æ•°æˆåˆ†ã‚’ç‰¹å®šã›ã‚ˆ:
            </p>
            \[
            y(t) = 2\sin(2\pi \cdot 10t) + 0.5\sin(2\pi \cdot 25t) + 0.3\sin(2\pi \cdot 50t) + \text{noise}
            \]
            <p>
                ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°: 200 Hzã€ãƒ‡ãƒ¼ã‚¿é•·: 1ç§’
            </p>

            <h4>æ¼”ç¿’5: ç·åˆèª²é¡Œ - ææ–™ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–</h4>
            <p>
                ç„¼çµãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©åŒ–å•é¡Œ:
            </p>
            <ul>
                <li>æ¸©åº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« \( T(t) \) ã‚’3ã¤ã®åŒºé–“ï¼ˆæ˜‡æ¸©ã€ä¿æŒã€å†·å´ï¼‰ã§åˆ¶å¾¡</li>
                <li>ç›®çš„: å¯†åº¦æœ€å¤§åŒ–ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆæœ€å°åŒ–</li>
                <li>åˆ¶ç´„: æ˜‡æ¸©é€Ÿåº¦ â‰¤ 10 K/minã€æœ€é«˜æ¸©åº¦ â‰¤ 1500 K</li>
            </ul>
            <p>
                æ¸©åº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆæ˜‡æ¸©é€Ÿåº¦ã€ä¿æŒæ¸©åº¦ã€ä¿æŒæ™‚é–“ã€å†·å´é€Ÿåº¦ï¼‰ã‚’æœ€é©åŒ–ã›ã‚ˆã€‚
            </p>
        </div>

        <section class="content-section">
            <h2>ã¾ã¨ã‚</h2>
            <p>
                æœ¬ç« ã§ã¯ã€SciPyã‚’ä½¿ã£ãŸå®Ÿè·µçš„æ•°å€¤è¨ˆç®—ã®ç·ä»•ä¸Šã’ã‚’è¡Œã„ã¾ã—ãŸ:
            </p>
            <ul>
                <li><strong>æœ€é©åŒ–:</strong> åˆ¶ç´„ãªã—ãƒ»åˆ¶ç´„ã‚ã‚Šæœ€é©åŒ–ã€å¤šç›®çš„æœ€é©åŒ–ã®å®Ÿè£…</li>
                <li><strong>è£œé–“ãƒ»è¿‘ä¼¼:</strong> ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³è£œé–“ã€å¤šé …å¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã€éå­¦ç¿’ã®ç†è§£</li>
                <li><strong>ä¿¡å·å‡¦ç†:</strong> FFTã«ã‚ˆã‚‹å‘¨æ³¢æ•°è§£æã€ãƒã‚¤ã‚ºé™¤å»ã€ãƒ”ãƒ¼ã‚¯æ¤œå‡º</li>
                <li><strong>ææ–™ç§‘å­¦å¿œç”¨:</strong> ç†±å‡¦ç†ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–ã®å®Ÿä¾‹</li>
                <li><strong>ãƒ—ãƒ­ã‚»ã‚¹å·¥å­¦å¿œç”¨:</strong> åŒ–å­¦åå¿œå™¨ã®å¤šç›®çš„æœ€é©åŒ–ã¨ãƒ‘ãƒ¬ãƒ¼ãƒˆè§£æ</li>
            </ul>
            <p>
                æœ¬ã‚·ãƒªãƒ¼ã‚ºå…¨ä½“ã‚’é€šã—ã¦ã€æ•°å€¤å¾®åˆ†ãƒ»ç©åˆ†ã‹ã‚‰å¸¸å¾®åˆ†æ–¹ç¨‹å¼ã€æœ€é©åŒ–ã¾ã§ã€å®Ÿå‹™ã§å¿…è¦ãªæ•°å€¤è¨ˆç®—ã®åŸºç¤ã‚’ä½“ç³»çš„ã«å­¦ã³ã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®çŸ¥è­˜ã‚’æ´»ã‹ã—ã¦ã€å®Ÿéš›ã®ç ”ç©¶ãƒ»é–‹ç™ºã«å–ã‚Šçµ„ã‚“ã§ãã ã•ã„ã€‚
            </p>

            <h3>ã•ã‚‰ã«å­¦ã¶ãŸã‚ã«</h3>
            <ul>
                <li><strong>åå¾®åˆ†æ–¹ç¨‹å¼ã®æ•°å€¤è§£æ³•:</strong> æœ‰é™å·®åˆ†æ³•ã€æœ‰é™è¦ç´ æ³•</li>
                <li><strong>æ©Ÿæ¢°å­¦ç¿’ã¨ã®èåˆ:</strong> ãƒ™ã‚¤ã‚ºæœ€é©åŒ–ã€ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</li>
                <li><strong>ä¸¦åˆ—è¨ˆç®—:</strong> NumPy/SciPyã®ä¸¦åˆ—åŒ–ã€GPUæ´»ç”¨</li>
                <li><strong>é«˜åº¦ãªæœ€é©åŒ–:</strong> éºä¼çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€ç²’å­ç¾¤æœ€é©åŒ–</li>
            </ul>
        </section>

        <div class="navigation-buttons">
            <a href="chapter-4.html" class="nav-button secondary">â† ç¬¬4ç« </a>
            <a href="index.html" class="nav-button primary">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã¸</a>
        </div>
    <section class="disclaimer">
<h3>å…è²¬äº‹é …</h3>
<ul>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹Code examplesã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
<li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
</ul>
</section>

</main>

    <footer style="margin-top: 4rem; padding: 2rem; background: #f8f9fa; border-radius: 12px; text-align: center; color: #666;">
        <p>&copy; 2025 FM Dojo. All rights reserved.</p>
    </footer>
</body>
</html>
