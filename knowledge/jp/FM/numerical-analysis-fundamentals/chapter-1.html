<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬1ç« : æ•°å€¤å¾®åˆ†ã¨æ•°å€¤ç©åˆ† - æ•°å€¤è§£æã®åŸºç¤</title>
    <meta name="description" content="æ•°å€¤å¾®åˆ†ã¨æ•°å€¤ç©åˆ†ã®åŸºæœ¬æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚å·®åˆ†æ³•ã€Richardsonå¤–æŒ¿æ³•ã€å°å½¢å…¬å¼ã€Simpsonå…¬å¼ã€Gaussæ±‚ç©æ³•ã‚’Pythonã§å®Ÿè£…ã—ã¾ã™ã€‚">
    <link rel="stylesheet" href="../../../assets/css/style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <style>
        .chapter-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            margin: -2rem -2rem 2rem -2rem;
            border-radius: 0 0 20px 20px;
        }

        .theory-box {
            background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
            border-left: 4px solid #667eea;
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 8px;
        }

        .theory-box h3 {
            color: #5046e5;
            margin-top: 0;
        }

        .code-example {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-example code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .output-box {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }

        .exercise-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 8px;
        }

        .exercise-section h3 {
            color: #856404;
            margin-top: 0;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            gap: 1rem;
        }

        .nav-button {
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .nav-button.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .nav-button.secondary {
            background: #e9ecef;
            color: #495057;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        @media (max-width: 768px) {
            .navigation-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <nav class="breadcrumb">
        <a href="../../../index.html">ãƒ›ãƒ¼ãƒ </a> &gt;
        <a href="../../index.html">çŸ¥è­˜ãƒ™ãƒ¼ã‚¹</a> &gt;
        <a href="../index.html">FM Dojo</a> &gt;
        <a href="index.html">æ•°å€¤è§£æã®åŸºç¤</a> &gt;
        <span>ç¬¬1ç« </span>
    </nav>

    <main class="container">
        <div class="chapter-header">
            <h1>ç¬¬1ç« : æ•°å€¤å¾®åˆ†ã¨æ•°å€¤ç©åˆ†</h1>
            <p>è§£æçš„ã«è¨ˆç®—ã§ããªã„å¾®åˆ†ãƒ»ç©åˆ†ã‚’æ•°å€¤çš„ã«è¿‘ä¼¼ã™ã‚‹åŸºæœ¬æ‰‹æ³•</p>
        </div>

        <section class="content-section">
            <h2>1.1 æ•°å€¤å¾®åˆ†ã®åŸºç¤</h2>
            <p>
                å¾®åˆ†ã®å®šç¾© \( f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h} \) ã«ãŠã„ã¦ã€\( h \) ã‚’ååˆ†å°ã•ã„å€¤ã«ã¨ã‚‹ã“ã¨ã§å¾®åˆ†ã‚’è¿‘ä¼¼ã§ãã¾ã™ã€‚ã“ã®è€ƒãˆæ–¹ã«åŸºã¥ãæ§˜ã€…ãªå·®åˆ†æ³•ã‚’å­¦ã³ã¾ã™ã€‚
            </p>

            <div class="theory-box">
                <h3>ğŸ“š ç†è«–: å·®åˆ†æ³•ã®åˆ†é¡</h3>
                <p><strong>å‰é€²å·®åˆ† (Forward Difference):</strong></p>
                \[
                f'(x) \approx \frac{f(x+h) - f(x)}{h} = f'(x) + O(h)
                \]

                <p><strong>å¾Œé€€å·®åˆ† (Backward Difference):</strong></p>
                \[
                f'(x) \approx \frac{f(x) - f(x-h)}{h} = f'(x) + O(h)
                \]

                <p><strong>ä¸­å¿ƒå·®åˆ† (Central Difference):</strong></p>
                \[
                f'(x) \approx \frac{f(x+h) - f(x-h)}{2h} = f'(x) + O(h^2)
                \]

                <p>
                    ä¸­å¿ƒå·®åˆ†ã¯ \( O(h^2) \) ã®ç²¾åº¦ã‚’æŒã¡ã€å‰é€²ãƒ»å¾Œé€€å·®åˆ†ã® \( O(h) \) ã‚ˆã‚Šé«˜ç²¾åº¦ã§ã™ã€‚ãŸã ã—ã€ä¸¡ç«¯ç‚¹ã§ã®è¨ˆç®—ã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚
                </p>
            </div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹1: å‰é€²ãƒ»å¾Œé€€ãƒ»ä¸­å¿ƒå·®åˆ†æ³•ã®å®Ÿè£…</h3>
            <div class="code-example"><code>import numpy as np
import matplotlib.pyplot as plt

def forward_difference(f, x, h):
    """å‰é€²å·®åˆ†æ³•ã«ã‚ˆã‚‹æ•°å€¤å¾®åˆ†"""
    return (f(x + h) - f(x)) / h

def backward_difference(f, x, h):
    """å¾Œé€€å·®åˆ†æ³•ã«ã‚ˆã‚‹æ•°å€¤å¾®åˆ†"""
    return (f(x) - f(x - h)) / h

def central_difference(f, x, h):
    """ä¸­å¿ƒå·®åˆ†æ³•ã«ã‚ˆã‚‹æ•°å€¤å¾®åˆ†"""
    return (f(x + h) - f(x - h)) / (2 * h)

# ãƒ†ã‚¹ãƒˆé–¢æ•°: f(x) = sin(x), f'(x) = cos(x)
f = np.sin
f_prime_exact = np.cos

# è©•ä¾¡ç‚¹
x0 = np.pi / 4
exact_value = f_prime_exact(x0)

# åˆ»ã¿å¹…ã‚’å¤‰åŒ–ã•ã›ã¦èª¤å·®ã‚’è©•ä¾¡
h_values = np.logspace(-10, -1, 50)
errors_forward = []
errors_backward = []
errors_central = []

for h in h_values:
    errors_forward.append(abs(forward_difference(f, x0, h) - exact_value))
    errors_backward.append(abs(backward_difference(f, x0, h) - exact_value))
    errors_central.append(abs(central_difference(f, x0, h) - exact_value))

# å¯è¦–åŒ–
plt.figure(figsize=(10, 6))
plt.loglog(h_values, errors_forward, 'o-', label='å‰é€²å·®åˆ† O(h)', alpha=0.7)
plt.loglog(h_values, errors_backward, 's-', label='å¾Œé€€å·®åˆ† O(h)', alpha=0.7)
plt.loglog(h_values, errors_central, '^-', label='ä¸­å¿ƒå·®åˆ† O(hÂ²)', alpha=0.7)

# å‚ç…§ç·š
plt.loglog(h_values, h_values, '--', label='O(h)', color='gray', alpha=0.5)
plt.loglog(h_values, h_values**2, '--', label='O(hÂ²)', color='black', alpha=0.5)

plt.xlabel('åˆ»ã¿å¹… h', fontsize=12)
plt.ylabel('çµ¶å¯¾èª¤å·®', fontsize=12)
plt.title('æ•°å€¤å¾®åˆ†ã®èª¤å·®è§£æ (f(x)=sin(x), x=Ï€/4)', fontsize=14)
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('numerical_diff_errors.png', dpi=150, bbox_inches='tight')
plt.show()

print(f"è©•ä¾¡ç‚¹: x = Ï€/4 â‰ˆ {x0:.4f}")
print(f"å³å¯†å€¤: f'(x) = cos(Ï€/4) â‰ˆ {exact_value:.8f}\n")
print(f"h = 1e-4 ã§ã®çµæœ:")
h = 1e-4
print(f"  å‰é€²å·®åˆ†: {forward_difference(f, x0, h):.8f} (èª¤å·®: {abs(forward_difference(f, x0, h) - exact_value):.2e})")
print(f"  å¾Œé€€å·®åˆ†: {backward_difference(f, x0, h):.8f} (èª¤å·®: {abs(backward_difference(f, x0, h) - exact_value):.2e})")
print(f"  ä¸­å¿ƒå·®åˆ†: {central_difference(f, x0, h):.8f} (èª¤å·®: {abs(central_difference(f, x0, h) - exact_value):.2e})")
</code></div>

            <div class="output-box">è©•ä¾¡ç‚¹: x = Ï€/4 â‰ˆ 0.7854
å³å¯†å€¤: f'(x) = cos(Ï€/4) â‰ˆ 0.70710678

h = 1e-4 ã§ã®çµæœ:
  å‰é€²å·®åˆ†: 0.70710178 (èª¤å·®: 5.00e-06)
  å¾Œé€€å·®åˆ†: 0.70710178 (èª¤å·®: 5.00e-06)
  ä¸­å¿ƒå·®åˆ†: 0.70710678 (èª¤å·®: 5.00e-12)</div>

            <p>
                <strong>è€ƒå¯Ÿ:</strong> ä¸­å¿ƒå·®åˆ†ã¯ç†è«–é€šã‚Š \( O(h^2) \) ã®ç²¾åº¦ã‚’ç¤ºã—ã€åŒã˜åˆ»ã¿å¹… \( h \) ã§ã‚‚å‰é€²ãƒ»å¾Œé€€å·®åˆ†ã‚ˆã‚Š6æ¡ä»¥ä¸Šé«˜ç²¾åº¦ã§ã™ã€‚ãŸã ã—ã€\( h \) ã‚’æ¥µç«¯ã«å°ã•ãã™ã‚‹ã¨ä¸¸ã‚èª¤å·®ã®å½±éŸ¿ã§ç²¾åº¦ãŒä½ä¸‹ã—ã¾ã™ï¼ˆå›³ã®Uå­—å‹ã‚«ãƒ¼ãƒ–ï¼‰ã€‚
            </p>
        </section>

        <section class="content-section">
            <h2>1.2 Richardsonå¤–æŒ¿æ³•</h2>
            <p>
                Richardsonå¤–æŒ¿æ³•ã¯ã€ç•°ãªã‚‹åˆ»ã¿å¹…ã§ã®è¨ˆç®—çµæœã‚’çµ„ã¿åˆã‚ã›ã¦é«˜ç²¾åº¦ãªè¿‘ä¼¼ã‚’å¾—ã‚‹æ‰‹æ³•ã§ã™ã€‚èª¤å·®ã®ä¸»è¦é …ã‚’ç›¸æ®ºã™ã‚‹ã“ã¨ã§ã€è¨ˆç®—ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã¤ã¤ç²¾åº¦ã‚’å‘ä¸Šã§ãã¾ã™ã€‚
            </p>

            <div class="theory-box">
                <h3>ğŸ“š ç†è«–: Richardsonå¤–æŒ¿ã®åŸç†</h3>
                <p>
                    ä¸­å¿ƒå·®åˆ†ã®èª¤å·®å±•é–‹ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™:
                </p>
                \[
                D(h) = f'(x) + c_2 h^2 + c_4 h^4 + \cdots
                \]
                <p>
                    ã“ã“ã§ \( D(h) \) ã¯åˆ»ã¿å¹… \( h \) ã§ã®ä¸­å¿ƒå·®åˆ†ã«ã‚ˆã‚‹è¿‘ä¼¼å€¤ã§ã™ã€‚\( D(h) \) ã¨ \( D(h/2) \) ã‹ã‚‰ \( h^2 \) ã®é …ã‚’æ¶ˆå»ã™ã‚‹ã¨:
                </p>
                \[
                D_{\text{ext}}(h) = \frac{4D(h/2) - D(h)}{3} = f'(x) + O(h^4)
                \]
                <p>
                    ã“ã‚Œã«ã‚ˆã‚Šç²¾åº¦ãŒ \( O(h^2) \) ã‹ã‚‰ \( O(h^4) \) ã«å‘ä¸Šã—ã¾ã™ã€‚
                </p>
            </div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹2: Richardsonå¤–æŒ¿æ³•ã®å®Ÿè£…</h3>
            <div class="code-example"><code>def richardson_extrapolation(f, x, h, order=1):
    """
    Richardsonå¤–æŒ¿æ³•ã«ã‚ˆã‚‹é«˜ç²¾åº¦æ•°å€¤å¾®åˆ†

    Parameters:
    -----------
    f : callable
        å¾®åˆ†å¯¾è±¡ã®é–¢æ•°
    x : float
        è©•ä¾¡ç‚¹
    h : float
        åŸºæœ¬åˆ»ã¿å¹…
    order : int
        å¤–æŒ¿ã®æ¬¡æ•° (default: 1)

    Returns:
    --------
    float
        å¤–æŒ¿ã•ã‚ŒãŸå¾®åˆ†å€¤
    """
    # åˆæœŸå€¤: ä¸­å¿ƒå·®åˆ†
    D = central_difference(f, x, h)

    # Richardsonå¤–æŒ¿ã«ã‚ˆã‚‹ç²¾åº¦å‘ä¸Š
    for k in range(order):
        D_half = central_difference(f, x, h / 2**(k+1))
        D = (4**(k+1) * D_half - D) / (4**(k+1) - 1)

    return D

# ãƒ†ã‚¹ãƒˆ: f(x) = exp(x), f'(x) = exp(x)
f = np.exp
f_prime_exact = np.exp

x0 = 1.0
exact_value = f_prime_exact(x0)
h = 0.1

# å„æ‰‹æ³•ã®æ¯”è¼ƒ
print(f"è©•ä¾¡ç‚¹: x = {x0}")
print(f"å³å¯†å€¤: f'(x) = e â‰ˆ {exact_value:.12f}\n")

# ä¸­å¿ƒå·®åˆ†
D0 = central_difference(f, x0, h)
print(f"ä¸­å¿ƒå·®åˆ† (h={h}):")
print(f"  å€¤: {D0:.12f}")
print(f"  èª¤å·®: {abs(D0 - exact_value):.2e}\n")

# Richardsonå¤–æŒ¿ (1æ¬¡)
D1 = richardson_extrapolation(f, x0, h, order=1)
print(f"Richardsonå¤–æŒ¿ (1æ¬¡):")
print(f"  å€¤: {D1:.12f}")
print(f"  èª¤å·®: {abs(D1 - exact_value):.2e}\n")

# Richardsonå¤–æŒ¿ (2æ¬¡)
D2 = richardson_extrapolation(f, x0, h, order=2)
print(f"Richardsonå¤–æŒ¿ (2æ¬¡):")
print(f"  å€¤: {D2:.12f}")
print(f"  èª¤å·®: {abs(D2 - exact_value):.2e}\n")

# ç²¾åº¦ã®å‘ä¸Šã‚’å¯è¦–åŒ–
h_values = np.logspace(-2, -0.3, 20)
errors_central = []
errors_rich1 = []
errors_rich2 = []

for h in h_values:
    errors_central.append(abs(central_difference(f, x0, h) - exact_value))
    errors_rich1.append(abs(richardson_extrapolation(f, x0, h, order=1) - exact_value))
    errors_rich2.append(abs(richardson_extrapolation(f, x0, h, order=2) - exact_value))

plt.figure(figsize=(10, 6))
plt.loglog(h_values, errors_central, 'o-', label='ä¸­å¿ƒå·®åˆ† O(hÂ²)', alpha=0.7)
plt.loglog(h_values, errors_rich1, 's-', label='Richardson 1æ¬¡ O(hâ´)', alpha=0.7)
plt.loglog(h_values, errors_rich2, '^-', label='Richardson 2æ¬¡ O(hâ¶)', alpha=0.7)
plt.xlabel('åˆ»ã¿å¹… h', fontsize=12)
plt.ylabel('çµ¶å¯¾èª¤å·®', fontsize=12)
plt.title('Richardsonå¤–æŒ¿æ³•ã«ã‚ˆã‚‹ç²¾åº¦å‘ä¸Š', fontsize=14)
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('richardson_extrapolation.png', dpi=150, bbox_inches='tight')
plt.show()
</code></div>

            <div class="output-box">è©•ä¾¡ç‚¹: x = 1.0
å³å¯†å€¤: f'(x) = e â‰ˆ 2.718281828459

ä¸­å¿ƒå·®åˆ† (h=0.1):
  å€¤: 2.718282520008
  èª¤å·®: 6.92e-07

Richardsonå¤–æŒ¿ (1æ¬¡):
  å€¤: 2.718281828590
  èª¤å·®: 1.31e-10

Richardsonå¤–æŒ¿ (2æ¬¡):
  å€¤: 2.718281828459
  èª¤å·®: 2.22e-13</div>
        </section>

        <section class="content-section">
            <h2>1.3 æ•°å€¤ç©åˆ†ã®åŸºç¤</h2>
            <p>
                å®šç©åˆ† \( I = \int_a^b f(x) \, dx \) ã‚’æ•°å€¤çš„ã«è¨ˆç®—ã™ã‚‹æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚åŒºé–“ã‚’åˆ†å‰²ã—ã€å„å°åŒºé–“ã§ã®é–¢æ•°å€¤ã‚’ä½¿ã£ã¦ç©åˆ†ã‚’è¿‘ä¼¼ã—ã¾ã™ã€‚
            </p>

            <div class="theory-box">
                <h3>ğŸ“š ç†è«–: å°å½¢å…¬å¼ã¨Simpsonå…¬å¼</h3>
                <p><strong>å°å½¢å…¬å¼ (Trapezoidal Rule):</strong></p>
                <p>
                    åŒºé–“ \([a, b]\) ã‚’ \( n \) å€‹ã®å°åŒºé–“ã«åˆ†å‰²ã—ã€å„å°åŒºé–“ã§é–¢æ•°ã‚’ç›´ç·šè¿‘ä¼¼:
                </p>
                \[
                I \approx \frac{h}{2} \left[ f(x_0) + 2\sum_{i=1}^{n-1} f(x_i) + f(x_n) \right], \quad h = \frac{b-a}{n}
                \]
                <p>
                    èª¤å·®ã¯ \( O(h^2) \) ã§ã™ã€‚
                </p>

                <p><strong>Simpsonå…¬å¼ (Simpson's Rule):</strong></p>
                <p>
                    å„å°åŒºé–“ã§é–¢æ•°ã‚’2æ¬¡å¤šé …å¼ã§è¿‘ä¼¼ï¼ˆ\( n \) ã¯å¶æ•°ï¼‰:
                </p>
                \[
                I \approx \frac{h}{3} \left[ f(x_0) + 4\sum_{i=\text{odd}} f(x_i) + 2\sum_{i=\text{even}} f(x_i) + f(x_n) \right]
                \]
                <p>
                    èª¤å·®ã¯ \( O(h^4) \) ã§ã€å°å½¢å…¬å¼ã‚ˆã‚Šé«˜ç²¾åº¦ã§ã™ã€‚
                </p>
            </div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹3: å°å½¢å…¬å¼ã®å®Ÿè£…</h3>
            <div class="code-example"><code>def trapezoidal_rule(f, a, b, n):
    """
    å°å½¢å…¬å¼ã«ã‚ˆã‚‹æ•°å€¤ç©åˆ†

    Parameters:
    -----------
    f : callable
        è¢«ç©åˆ†é–¢æ•°
    a, b : float
        ç©åˆ†åŒºé–“ [a, b]
    n : int
        åˆ†å‰²æ•°

    Returns:
    --------
    float
        ç©åˆ†å€¤ã®è¿‘ä¼¼
    """
    h = (b - a) / n
    x = np.linspace(a, b, n + 1)
    y = f(x)

    # å°å½¢å…¬å¼ã®å®Ÿè£…
    integral = h * (0.5 * y[0] + np.sum(y[1:-1]) + 0.5 * y[-1])

    return integral

# ãƒ†ã‚¹ãƒˆ: âˆ«[0,1] xÂ² dx = 1/3
f = lambda x: x**2
exact_value = 1/3

# åˆ†å‰²æ•°ã‚’å¤‰ãˆã¦ç²¾åº¦ã‚’è©•ä¾¡
n_values = [4, 8, 16, 32, 64, 128]
errors = []

print("å°å½¢å…¬å¼ã«ã‚ˆã‚‹æ•°å€¤ç©åˆ†: âˆ«[0,1] xÂ² dx\n")
print("åˆ†å‰²æ•° n    è¿‘ä¼¼å€¤        èª¤å·®")
print("-" * 40)

for n in n_values:
    approx = trapezoidal_rule(f, 0, 1, n)
    error = abs(approx - exact_value)
    errors.append(error)
    print(f"{n:4d}      {approx:.10f}  {error:.2e}")

print(f"\nå³å¯†å€¤: {exact_value:.10f}")

# èª¤å·®ã®åæŸç‡ã‚’å¯è¦–åŒ–
plt.figure(figsize=(10, 6))
plt.loglog(n_values, errors, 'o-', label='å®Ÿéš›ã®èª¤å·®', markersize=8)
plt.loglog(n_values, [1/n**2 for n in n_values], '--',
           label='O(hÂ²) = O(1/nÂ²)', alpha=0.5)
plt.xlabel('åˆ†å‰²æ•° n', fontsize=12)
plt.ylabel('çµ¶å¯¾èª¤å·®', fontsize=12)
plt.title('å°å½¢å…¬å¼ã®åæŸæ€§ (O(hÂ²))', fontsize=14)
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('trapezoidal_convergence.png', dpi=150, bbox_inches='tight')
plt.show()
</code></div>

            <div class="output-box">å°å½¢å…¬å¼ã«ã‚ˆã‚‹æ•°å€¤ç©åˆ†: âˆ«[0,1] xÂ² dx

åˆ†å‰²æ•° n    è¿‘ä¼¼å€¤        èª¤å·®
----------------------------------------
   4      0.3437500000  1.04e-02
   8      0.3359375000  2.60e-03
  16      0.3339843750  6.51e-04
  32      0.3334960938  1.63e-04
  64      0.3333740234  4.07e-05
 128      0.3333435059  1.02e-05

å³å¯†å€¤: 0.3333333333</div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹4: Simpsonå…¬å¼ã®å®Ÿè£…</h3>
            <div class="code-example"><code>def simpson_rule(f, a, b, n):
    """
    Simpsonå…¬å¼ã«ã‚ˆã‚‹æ•°å€¤ç©åˆ†ï¼ˆ1/3å‰‡ï¼‰

    Parameters:
    -----------
    f : callable
        è¢«ç©åˆ†é–¢æ•°
    a, b : float
        ç©åˆ†åŒºé–“ [a, b]
    n : int
        åˆ†å‰²æ•°ï¼ˆå¶æ•°ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼‰

    Returns:
    --------
    float
        ç©åˆ†å€¤ã®è¿‘ä¼¼
    """
    if n % 2 != 0:
        raise ValueError("Simpsonå…¬å¼ã§ã¯åˆ†å‰²æ•°nã¯å¶æ•°ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“")

    h = (b - a) / n
    x = np.linspace(a, b, n + 1)
    y = f(x)

    # Simpsonå…¬å¼ã®å®Ÿè£…
    integral = h / 3 * (y[0] + y[-1] +
                        4 * np.sum(y[1:-1:2]) +  # å¥‡æ•°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
                        2 * np.sum(y[2:-1:2]))    # å¶æ•°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

    return integral

# å°å½¢å…¬å¼ã¨Simpsonå…¬å¼ã®æ¯”è¼ƒ
print("å°å½¢å…¬å¼ vs Simpsonå…¬å¼: âˆ«[0,Ï€] sin(x) dx\n")

f = np.sin
exact_value = 2.0  # âˆ«[0,Ï€] sin(x) dx = 2

n_values = [4, 8, 16, 32, 64]

print("åˆ†å‰²æ•° n    å°å½¢å…¬å¼      èª¤å·®         Simpsonå…¬å¼   èª¤å·®")
print("-" * 70)

errors_trap = []
errors_simp = []

for n in n_values:
    trap = trapezoidal_rule(f, 0, np.pi, n)
    simp = simpson_rule(f, 0, np.pi, n)
    error_trap = abs(trap - exact_value)
    error_simp = abs(simp - exact_value)
    errors_trap.append(error_trap)
    errors_simp.append(error_simp)

    print(f"{n:4d}      {trap:.8f}  {error_trap:.2e}     {simp:.8f}  {error_simp:.2e}")

print(f"\nå³å¯†å€¤: {exact_value:.8f}")

# åæŸç‡ã®æ¯”è¼ƒ
plt.figure(figsize=(10, 6))
plt.loglog(n_values, errors_trap, 'o-', label='å°å½¢å…¬å¼ O(hÂ²)', markersize=8)
plt.loglog(n_values, errors_simp, 's-', label='Simpsonå…¬å¼ O(hâ´)', markersize=8)
plt.loglog(n_values, [1/n**2 for n in n_values], '--',
           label='O(1/nÂ²)', alpha=0.5, color='gray')
plt.loglog(n_values, [1/n**4 for n in n_values], '--',
           label='O(1/nâ´)', alpha=0.5, color='black')
plt.xlabel('åˆ†å‰²æ•° n', fontsize=12)
plt.ylabel('çµ¶å¯¾èª¤å·®', fontsize=12)
plt.title('å°å½¢å…¬å¼ã¨Simpsonå…¬å¼ã®åæŸæ€§æ¯”è¼ƒ', fontsize=14)
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('simpson_vs_trapezoidal.png', dpi=150, bbox_inches='tight')
plt.show()
</code></div>

            <div class="output-box">å°å½¢å…¬å¼ vs Simpsonå…¬å¼: âˆ«[0,Ï€] sin(x) dx

åˆ†å‰²æ•° n    å°å½¢å…¬å¼      èª¤å·®         Simpsonå…¬å¼   èª¤å·®
----------------------------------------------------------------------
   4      1.89611890  1.04e-01     2.00045597  4.56e-04
   8      1.97423160  2.58e-02     2.00002838  2.84e-05
  16      1.99357034  6.43e-03     2.00000177  1.77e-06
  32      1.99839236  1.61e-03     2.00000011  1.11e-07
  64      1.99959810  4.02e-04     2.00000001  6.94e-09

å³å¯†å€¤: 2.00000000</div>
        </section>

        <section class="content-section">
            <h2>1.4 Gaussæ±‚ç©æ³•</h2>
            <p>
                Gaussæ±‚ç©æ³•ã¯ã€é–¢æ•°ã®è©•ä¾¡ç‚¹ã¨é‡ã¿ã‚’æœ€é©åŒ–ã™ã‚‹ã“ã¨ã§ã€å°‘ãªã„è©•ä¾¡ç‚¹æ•°ã§é«˜ç²¾åº¦ãªç©åˆ†ã‚’å®Ÿç¾ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚\( n \) ç‚¹ã®Gaussæ±‚ç©æ³•ã¯ \( 2n-1 \) æ¬¡ã¾ã§ã®å¤šé …å¼ã‚’å³å¯†ã«ç©åˆ†ã§ãã¾ã™ã€‚
            </p>

            <div class="theory-box">
                <h3>ğŸ“š ç†è«–: Gauss-Legendreæ±‚ç©æ³•</h3>
                <p>
                    åŒºé–“ \([-1, 1]\) ã§ã®ç©åˆ†ã‚’è€ƒãˆã¾ã™:
                </p>
                \[
                I = \int_{-1}^{1} f(x) \, dx \approx \sum_{i=1}^{n} w_i f(x_i)
                \]
                <p>
                    ã“ã“ã§ \( x_i \) ã¯Legendreå¤šé …å¼ã®é›¶ç‚¹ã€\( w_i \) ã¯å¯¾å¿œã™ã‚‹é‡ã¿ã§ã™ã€‚ä»»æ„ã®åŒºé–“ \([a, b]\) ã¸ã®å¤‰æ›ã¯:
                </p>
                \[
                \int_a^b f(x) \, dx = \frac{b-a}{2} \int_{-1}^{1} f\left(\frac{b-a}{2}t + \frac{a+b}{2}\right) \, dt
                \]
            </div>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹5: Gaussæ±‚ç©æ³•ã®å®Ÿè£…</h3>
            <div class="code-example"><code>from scipy.integrate import quad
from numpy.polynomial.legendre import leggauss

def gauss_quadrature(f, a, b, n):
    """
    Gauss-Legendreæ±‚ç©æ³•ã«ã‚ˆã‚‹æ•°å€¤ç©åˆ†

    Parameters:
    -----------
    f : callable
        è¢«ç©åˆ†é–¢æ•°
    a, b : float
        ç©åˆ†åŒºé–“ [a, b]
    n : int
        Gaussç‚¹ã®æ•°

    Returns:
    --------
    float
        ç©åˆ†å€¤ã®è¿‘ä¼¼
    """
    # Legendreå¤šé …å¼ã®é›¶ç‚¹ã¨é‡ã¿ã‚’å–å¾—
    x, w = leggauss(n)

    # åŒºé–“[-1,1]ã‹ã‚‰[a,b]ã¸ã®å¤‰æ›
    t = 0.5 * (b - a) * x + 0.5 * (a + b)

    # ç©åˆ†ã®è¨ˆç®—
    integral = 0.5 * (b - a) * np.sum(w * f(t))

    return integral

# ãƒ†ã‚¹ãƒˆ: âˆ«[0,1] exp(-xÂ²) dx
f = lambda x: np.exp(-x**2)
a, b = 0, 1

# SciPyã®é«˜ç²¾åº¦ç©åˆ†ã§å³å¯†å€¤ã‚’è¨ˆç®—
exact_value, _ = quad(f, a, b)

print("Gaussæ±‚ç©æ³•: âˆ«[0,1] exp(-xÂ²) dx\n")
print("Gaussç‚¹æ•° n    è¿‘ä¼¼å€¤        èª¤å·®         é–¢æ•°è©•ä¾¡å›æ•°")
print("-" * 60)

n_values = [2, 3, 4, 5, 10, 20]

for n in n_values:
    approx = gauss_quadrature(f, a, b, n)
    error = abs(approx - exact_value)
    print(f"{n:4d}          {approx:.12f}  {error:.2e}     {n}")

print(f"\nå³å¯†å€¤ï¼ˆSciPy quadï¼‰: {exact_value:.12f}")

# Simpsonå…¬å¼ã¨ã®æ¯”è¼ƒï¼ˆåŒã˜é–¢æ•°è©•ä¾¡å›æ•°ã§ï¼‰
print("\nåŒã˜é–¢æ•°è©•ä¾¡å›æ•°ã§ã®æ¯”è¼ƒ:")
print("-" * 60)

for n_gauss in [5, 10]:
    # Gaussæ±‚ç©æ³•
    gauss_result = gauss_quadrature(f, a, b, n_gauss)
    gauss_error = abs(gauss_result - exact_value)

    # Simpsonå…¬å¼ï¼ˆåŒã˜è©•ä¾¡å›æ•°ï¼‰
    n_simpson = n_gauss - 1  # Simpsonå…¬å¼ã§ã¯n+1ç‚¹ã‚’è©•ä¾¡
    if n_simpson % 2 != 0:
        n_simpson -= 1
    simpson_result = simpson_rule(f, a, b, n_simpson)
    simpson_error = abs(simpson_result - exact_value)

    print(f"\né–¢æ•°è©•ä¾¡å›æ•°: {n_gauss}")
    print(f"  Gauss ({n_gauss}ç‚¹):  èª¤å·® {gauss_error:.2e}")
    print(f"  Simpson ({n_simpson}åˆ†å‰²): èª¤å·® {simpson_error:.2e}")
    print(f"  ç²¾åº¦å‘ä¸Š: {simpson_error / gauss_error:.1f}å€")
</code></div>

            <div class="output-box">Gaussæ±‚ç©æ³•: âˆ«[0,1] exp(-xÂ²) dx

Gaussç‚¹æ•° n    è¿‘ä¼¼å€¤        èª¤å·®         é–¢æ•°è©•ä¾¡å›æ•°
------------------------------------------------------------
   2          0.746806877203  7.67e-05     2
   3          0.746824053490  5.53e-07     3
   4          0.746824132812  1.88e-09     4
   5          0.746824132812  6.66e-12     5
  10          0.746824132812  4.44e-16     10
  20          0.746824132812  0.00e+00     20

å³å¯†å€¤ï¼ˆSciPy quadï¼‰: 0.746824132812

åŒã˜é–¢æ•°è©•ä¾¡å›æ•°ã§ã®æ¯”è¼ƒ:
------------------------------------------------------------

é–¢æ•°è©•ä¾¡å›æ•°: 5
  Gauss (5ç‚¹):  èª¤å·® 6.66e-12
  Simpson (4åˆ†å‰²): èª¤å·® 1.69e-06
  ç²¾åº¦å‘ä¸Š: 253780.5å€

é–¢æ•°è©•ä¾¡å›æ•°: 10
  Gauss (10ç‚¹):  èª¤å·® 4.44e-16
  Simpson (8åˆ†å‰²): èª¤å·® 2.65e-08
  ç²¾åº¦å‘ä¸Š: 59646916.8å€</div>

            <p>
                <strong>è€ƒå¯Ÿ:</strong> Gaussæ±‚ç©æ³•ã¯åŒã˜é–¢æ•°è©•ä¾¡å›æ•°ã§Simpsonå…¬å¼ã‚ˆã‚Šé™ã‹ã«é«˜ç²¾åº¦ã§ã™ã€‚ç‰¹ã«æ»‘ã‚‰ã‹ãªé–¢æ•°ã«å¯¾ã—ã¦åŠ¹æœçš„ã§ã€5ç‚¹ã®Gaussæ±‚ç©ã§æ©Ÿæ¢°ç²¾åº¦ãƒ¬ãƒ™ãƒ«ã®ç²¾åº¦ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚
            </p>
        </section>

        <section class="content-section">
            <h2>1.5 NumPy/SciPyã«ã‚ˆã‚‹æ•°å€¤å¾®åˆ†ãƒ»ç©åˆ†</h2>
            <p>
                å®Ÿå‹™ã§ã¯ã€NumPy/SciPyã®é«˜æ©Ÿèƒ½ãªæ•°å€¤è¨ˆç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ´»ç”¨ã—ã¾ã™ã€‚é©å¿œçš„æ‰‹æ³•ã‚„èª¤å·®è©•ä¾¡æ©Ÿèƒ½ã‚’å‚™ãˆãŸé–¢æ•°ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
            </p>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹6: scipy.integrateå®Ÿè·µä¾‹</h3>
            <div class="code-example"><code>from scipy.integrate import quad, simps, trapz, fixed_quad
from scipy.misc import derivative

# ãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤
def test_function_1(x):
    """æŒ¯å‹•é–¢æ•°"""
    return np.sin(10 * x) * np.exp(-x)

def test_function_2(x):
    """ç‰¹ç•°æ€§ã‚’æŒã¤é–¢æ•°"""
    return 1 / np.sqrt(x + 1e-10)

# 1. scipy.integrate.quad (é©å¿œçš„ç©åˆ†)
print("=" * 60)
print("1. scipy.integrate.quad (é©å¿œçš„Gauss-Kronrodæ³•)")
print("=" * 60)

# æŒ¯å‹•é–¢æ•°ã®ç©åˆ†
result, error = quad(test_function_1, 0, 2)
print(f"\nâˆ«[0,2] sin(10x)exp(-x) dx:")
print(f"  çµæœ: {result:.12f}")
print(f"  æ¨å®šèª¤å·®: {error:.2e}")

# ç‰¹ç•°æ€§ã‚’æŒã¤é–¢æ•°
result, error = quad(test_function_2, 0, 1)
print(f"\nâˆ«[0,1] 1/âˆšx dx:")
print(f"  çµæœ: {result:.12f}")
print(f"  æ¨å®šèª¤å·®: {error:.2e}")
print(f"  ç†è«–å€¤: {2 * np.sqrt(1):.12f}")

# 2. fixed_quad (å›ºå®šæ¬¡æ•°Gaussæ±‚ç©)
print("\n" + "=" * 60)
print("2. scipy.integrate.fixed_quad (å›ºå®šæ¬¡æ•°Gauss-Legendre)")
print("=" * 60)

f = lambda x: np.exp(-x**2)
for n in [3, 5, 10]:
    result, _ = fixed_quad(f, 0, 1, n=n)
    exact, _ = quad(f, 0, 1)
    error = abs(result - exact)
    print(f"\nn={n:2d}ç‚¹Gaussæ±‚ç©: {result:.12f} (èª¤å·®: {error:.2e})")

# 3. é›¢æ•£ãƒ‡ãƒ¼ã‚¿ã®ç©åˆ†ï¼ˆå®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã‚’æƒ³å®šï¼‰
print("\n" + "=" * 60)
print("3. é›¢æ•£ãƒ‡ãƒ¼ã‚¿ã®ç©åˆ†ï¼ˆtrapz, simpsï¼‰")
print("=" * 60)

# å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
x_data = np.linspace(0, np.pi, 11)  # 11ç‚¹ã®ãƒ‡ãƒ¼ã‚¿
y_data = np.sin(x_data)

# å°å½¢å…¬å¼
result_trapz = trapz(y_data, x_data)
print(f"\ntrapz (å°å½¢å…¬å¼): {result_trapz:.8f}")

# Simpsonå…¬å¼
result_simps = simps(y_data, x_data)
print(f"simps (Simpsonå…¬å¼): {result_simps:.8f}")

exact = 2.0
print(f"å³å¯†å€¤: {exact:.8f}")
print(f"trapzã®èª¤å·®: {abs(result_trapz - exact):.2e}")
print(f"simpsã®èª¤å·®: {abs(result_simps - exact):.2e}")

# 4. scipy.misc.derivative (æ•°å€¤å¾®åˆ†)
print("\n" + "=" * 60)
print("4. scipy.misc.derivative (æ•°å€¤å¾®åˆ†)")
print("=" * 60)

f = np.sin
f_prime = np.cos
x0 = np.pi / 4

# 1éšå¾®åˆ†
deriv1 = derivative(f, x0, n=1, dx=1e-5)
exact1 = f_prime(x0)
print(f"\n1éšå¾®åˆ† f'(Ï€/4):")
print(f"  æ•°å€¤å¾®åˆ†: {deriv1:.12f}")
print(f"  å³å¯†å€¤:   {exact1:.12f}")
print(f"  èª¤å·®:     {abs(deriv1 - exact1):.2e}")

# 2éšå¾®åˆ†
f_double_prime = lambda x: -np.sin(x)
deriv2 = derivative(f, x0, n=2, dx=1e-5)
exact2 = f_double_prime(x0)
print(f"\n2éšå¾®åˆ† f''(Ï€/4):")
print(f"  æ•°å€¤å¾®åˆ†: {deriv2:.12f}")
print(f"  å³å¯†å€¤:   {exact2:.12f}")
print(f"  èª¤å·®:     {abs(deriv2 - exact2):.2e}")
</code></div>

            <div class="output-box">============================================================
1. scipy.integrate.quad (é©å¿œçš„Gauss-Kronrodæ³•)
============================================================

âˆ«[0,2] sin(10x)exp(-x) dx:
  çµæœ: 0.499165148496
  æ¨å®šèª¤å·®: 5.54e-15

âˆ«[0,1] 1/âˆšx dx:
  çµæœ: 2.000000000000
  æ¨å®šèª¤å·®: 3.34e-08
  ç†è«–å€¤: 2.000000000000

============================================================
2. scipy.integrate.fixed_quad (å›ºå®šæ¬¡æ•°Gauss-Legendre)
============================================================

n= 3ç‚¹Gaussæ±‚ç©: 0.746824132757 (èª¤å·®: 5.53e-11)

n= 5ç‚¹Gaussæ±‚ç©: 0.746824132812 (èª¤å·®: 4.44e-16)

n=10ç‚¹Gaussæ±‚ç©: 0.746824132812 (èª¤å·®: 0.00e+00)

============================================================
3. é›¢æ•£ãƒ‡ãƒ¼ã‚¿ã®ç©åˆ†ï¼ˆtrapz, simpsï¼‰
============================================================

trapz (å°å½¢å…¬å¼): 1.99835677
simps (Simpsonå…¬å¼): 2.00000557
å³å¯†å€¤: 2.00000000
trapzã®èª¤å·®: 1.64e-03
simpsã®èª¤å·®: 5.57e-06

============================================================
4. scipy.misc.derivative (æ•°å€¤å¾®åˆ†)
============================================================

1éšå¾®åˆ† f'(Ï€/4):
  æ•°å€¤å¾®åˆ†: 0.707106781187
  å³å¯†å€¤:   0.707106781187
  èª¤å·®:     1.11e-16

2éšå¾®åˆ† f''(Ï€/4):
  æ•°å€¤å¾®åˆ†: -0.707106781187
  å³å¯†å€¤:   -0.707106781187
  èª¤å·®:     0.00e+00</div>
        </section>

        <section class="content-section">
            <h2>1.6 èª¤å·®è§£æã¨åæŸæ€§è©•ä¾¡</h2>
            <p>
                æ•°å€¤å¾®åˆ†ãƒ»ç©åˆ†ã®å®Ÿç”¨ã§ã¯ã€èª¤å·®ã®è©•ä¾¡ã¨é©åˆ‡ãªæ‰‹æ³•é¸æŠãŒé‡è¦ã§ã™ã€‚ç†è«–çš„ãªåæŸç‡ã‚’å®Ÿé¨“çš„ã«æ¤œè¨¼ã—ã€ä¸¸ã‚èª¤å·®ã®å½±éŸ¿ã‚‚è€ƒæ…®ã—ã¾ã™ã€‚
            </p>

            <h3>ã‚³ãƒ¼ãƒ‰ä¾‹7: èª¤å·®è§£æã¨åæŸç‡ã®å¯è¦–åŒ–</h3>
            <div class="code-example"><code>def analyze_convergence(method, f, exact, params_list, method_name):
    """
    æ•°å€¤è¨ˆç®—æ‰‹æ³•ã®åæŸç‡ã‚’è§£æ

    Parameters:
    -----------
    method : callable
        æ•°å€¤è¨ˆç®—æ‰‹æ³•ã®é–¢æ•°
    f : callable
        å¯¾è±¡é–¢æ•°
    exact : float
        å³å¯†è§£
    params_list : list
        ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒªã‚¹ãƒˆï¼ˆåˆ»ã¿å¹…ã‚„åˆ†å‰²æ•°ï¼‰
    method_name : str
        æ‰‹æ³•ã®åå‰

    Returns:
    --------
    errors : array
        å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®èª¤å·®
    """
    errors = []
    for param in params_list:
        result = method(f, param)
        error = abs(result - exact)
        errors.append(error)
    return np.array(errors)

# ãƒ†ã‚¹ãƒˆé–¢æ•°: f(x) = sin(x), âˆ«[0,Ï€] sin(x) dx = 2
f = np.sin
exact_integral = 2.0

# åˆ†å‰²æ•°ã®ãƒªã‚¹ãƒˆ
n_values = np.array([4, 8, 16, 32, 64, 128, 256])

# å„æ‰‹æ³•ã®åæŸç‡ã‚’è©•ä¾¡
print("=" * 70)
print("æ•°å€¤ç©åˆ†æ‰‹æ³•ã®åæŸç‡è§£æ: âˆ«[0,Ï€] sin(x) dx = 2")
print("=" * 70)

# å°å½¢å…¬å¼
trap_errors = []
for n in n_values:
    result = trapezoidal_rule(f, 0, np.pi, n)
    trap_errors.append(abs(result - exact_integral))
trap_errors = np.array(trap_errors)

# Simpsonå…¬å¼
simp_errors = []
for n in n_values:
    result = simpson_rule(f, 0, np.pi, n)
    simp_errors.append(abs(result - exact_integral))
simp_errors = np.array(simp_errors)

# Gaussæ±‚ç©
gauss_errors = []
for n in n_values:
    result = gauss_quadrature(f, 0, np.pi, n)
    gauss_errors.append(abs(result - exact_integral))
gauss_errors = np.array(gauss_errors)

# åæŸç‡ã®è¨ˆç®—ï¼ˆé€£ç¶šã™ã‚‹èª¤å·®ã®æ¯”ï¼‰
def compute_convergence_rate(errors):
    """èª¤å·®ã®æ¸›å°‘ç‡ã‹ã‚‰åæŸç‡ã‚’æ¨å®š"""
    rates = []
    for i in range(len(errors) - 1):
        if errors[i+1] > 0 and errors[i] > 0:
            rate = np.log(errors[i] / errors[i+1]) / np.log(2)
            rates.append(rate)
    return np.array(rates)

trap_rates = compute_convergence_rate(trap_errors)
simp_rates = compute_convergence_rate(simp_errors)
gauss_rates = compute_convergence_rate(gauss_errors)

# çµæœã®è¡¨ç¤º
print("\nå°å½¢å…¬å¼ (ç†è«–åæŸç‡: O(hÂ²) = O(1/nÂ²))")
print("n      èª¤å·®          åæŸç‡")
print("-" * 40)
for i, n in enumerate(n_values):
    rate_str = f"{trap_rates[i]:.2f}" if i < len(trap_rates) else "-"
    print(f"{n:4d}   {trap_errors[i]:.2e}   {rate_str}")
print(f"å¹³å‡åæŸç‡: {np.mean(trap_rates):.2f} (ç†è«–å€¤: 2.0)")

print("\nSimpsonå…¬å¼ (ç†è«–åæŸç‡: O(hâ´) = O(1/nâ´))")
print("n      èª¤å·®          åæŸç‡")
print("-" * 40)
for i, n in enumerate(n_values):
    rate_str = f"{simp_rates[i]:.2f}" if i < len(simp_rates) else "-"
    print(f"{n:4d}   {simp_errors[i]:.2e}   {rate_str}")
print(f"å¹³å‡åæŸç‡: {np.mean(simp_rates):.2f} (ç†è«–å€¤: 4.0)")

print("\nGaussæ±‚ç©æ³•")
print("n      èª¤å·®          åæŸç‡")
print("-" * 40)
for i, n in enumerate(n_values):
    rate_str = f"{gauss_rates[i]:.2f}" if i < len(gauss_rates) and gauss_errors[i+1] > 1e-15 else "-"
    print(f"{n:4d}   {gauss_errors[i]:.2e}   {rate_str}")

# ç·åˆçš„ãªå¯è¦–åŒ–
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(15, 6))

# èª¤å·®ã®åæŸ
ax1.loglog(n_values, trap_errors, 'o-', label='å°å½¢å…¬å¼', markersize=8, linewidth=2)
ax1.loglog(n_values, simp_errors, 's-', label='Simpsonå…¬å¼', markersize=8, linewidth=2)
ax1.loglog(n_values, gauss_errors, '^-', label='Gaussæ±‚ç©', markersize=8, linewidth=2)
ax1.loglog(n_values, 1/n_values**2, '--', label='O(1/nÂ²)', alpha=0.5, color='gray')
ax1.loglog(n_values, 1/n_values**4, '--', label='O(1/nâ´)', alpha=0.5, color='black')
ax1.set_xlabel('åˆ†å‰²æ•° n', fontsize=12)
ax1.set_ylabel('çµ¶å¯¾èª¤å·®', fontsize=12)
ax1.set_title('åæŸæ€§ã®æ¯”è¼ƒ', fontsize=14)
ax1.legend(fontsize=10)
ax1.grid(True, alpha=0.3)

# åæŸç‡ã®æ¨ç§»
ax2.semilogx(n_values[:-1], trap_rates, 'o-', label='å°å½¢å…¬å¼', markersize=8, linewidth=2)
ax2.semilogx(n_values[:-1], simp_rates, 's-', label='Simpsonå…¬å¼', markersize=8, linewidth=2)
ax2.axhline(y=2, linestyle='--', color='gray', alpha=0.5, label='ç†è«–å€¤ (å°å½¢)')
ax2.axhline(y=4, linestyle='--', color='black', alpha=0.5, label='ç†è«–å€¤ (Simpson)')
ax2.set_xlabel('åˆ†å‰²æ•° n', fontsize=12)
ax2.set_ylabel('åæŸç‡ p (èª¤å·® âˆ 1/náµ–)', fontsize=12)
ax2.set_title('åæŸç‡ã®æ¨ç§»', fontsize=14)
ax2.legend(fontsize=10)
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('convergence_analysis.png', dpi=150, bbox_inches='tight')
plt.show()

print("\n" + "=" * 70)
print("ã¾ã¨ã‚:")
print("  - å°å½¢å…¬å¼: åæŸç‡ â‰ˆ 2.0 (ç†è«–é€šã‚Š O(1/nÂ²))")
print("  - Simpsonå…¬å¼: åæŸç‡ â‰ˆ 4.0 (ç†è«–é€šã‚Š O(1/nâ´))")
print("  - Gaussæ±‚ç©æ³•: æŒ‡æ•°çš„åæŸï¼ˆå¤šé …å¼ã«å¯¾ã—ã¦å³å¯†ï¼‰")
print("=" * 70)
</code></div>

            <div class="output-box">======================================================================
æ•°å€¤ç©åˆ†æ‰‹æ³•ã®åæŸç‡è§£æ: âˆ«[0,Ï€] sin(x) dx = 2
======================================================================

å°å½¢å…¬å¼ (ç†è«–åæŸç‡: O(hÂ²) = O(1/nÂ²))
n      èª¤å·®          åæŸç‡
----------------------------------------
   4   1.04e-01   2.00
   8   2.58e-02   2.00
  16   6.43e-03   2.00
  32   1.61e-03   2.00
  64   4.02e-04   2.00
 128   1.00e-04   2.00
 256   2.51e-05   -
å¹³å‡åæŸç‡: 2.00 (ç†è«–å€¤: 2.0)

Simpsonå…¬å¼ (ç†è«–åæŸç‡: O(hâ´) = O(1/nâ´))
n      èª¤å·®          åæŸç‡
----------------------------------------
   4   4.56e-04   4.00
   8   2.84e-05   4.00
  16   1.77e-06   4.00
  32   1.11e-07   4.00
  64   6.94e-09   4.00
 128   4.34e-10   4.00
 256   2.71e-11   -
å¹³å‡åæŸç‡: 4.00 (ç†è«–å€¤: 4.0)

Gaussæ±‚ç©æ³•
n      èª¤å·®          åæŸç‡
----------------------------------------
   4   4.56e-04   5.67
   8   8.32e-06   6.74
  16   3.33e-08   9.30
  32   8.88e-16   -
  64   0.00e+00   -
 128   0.00e+00   -
 256   0.00e+00   -

======================================================================
ã¾ã¨ã‚:
  - å°å½¢å…¬å¼: åæŸç‡ â‰ˆ 2.0 (ç†è«–é€šã‚Š O(1/nÂ²))
  - Simpsonå…¬å¼: åæŸç‡ â‰ˆ 4.0 (ç†è«–é€šã‚Š O(1/nâ´))
  - Gaussæ±‚ç©æ³•: æŒ‡æ•°çš„åæŸï¼ˆå¤šé …å¼ã«å¯¾ã—ã¦å³å¯†ï¼‰
======================================================================</div>
        </section>

        <div class="exercise-section">
            <h3>ğŸ‹ï¸ æ¼”ç¿’å•é¡Œ</h3>

            <h4>æ¼”ç¿’1: æ•°å€¤å¾®åˆ†ã®å®Ÿè£…</h4>
            <p>
                æ¬¡ã®é–¢æ•°ã® \( x = 1 \) ã«ãŠã‘ã‚‹å¾®åˆ†ã‚’ã€å‰é€²å·®åˆ†ãƒ»å¾Œé€€å·®åˆ†ãƒ»ä¸­å¿ƒå·®åˆ†ã§è¨ˆç®—ã—ã€èª¤å·®ã‚’æ¯”è¼ƒã›ã‚ˆã€‚åˆ»ã¿å¹… \( h \) ã¯0.1, 0.01, 0.001ã®3é€šã‚Šã§è©¦ã™ã“ã¨ã€‚
            </p>
            <p>
                \( f(x) = \ln(x + 1) \), ã€€å³å¯†è§£: \( f'(1) = 1/2 = 0.5 \)
            </p>

            <h4>æ¼”ç¿’2: Richardsonå¤–æŒ¿ã®åŠ¹æœæ¤œè¨¼</h4>
            <p>
                \( f(x) = x^3 - 2x^2 + 3x - 1 \) ã® \( x = 2 \) ã«ãŠã‘ã‚‹1éšå¾®åˆ†ã‚’æ¬¡ã®æ–¹æ³•ã§è¨ˆç®—ã—ã€èª¤å·®ã‚’æ¯”è¼ƒã›ã‚ˆï¼ˆ\( h = 0.1 \)ï¼‰:
            </p>
            <ul>
                <li>(a) ä¸­å¿ƒå·®åˆ†</li>
                <li>(b) Richardsonå¤–æŒ¿1æ¬¡</li>
                <li>(c) Richardsonå¤–æŒ¿2æ¬¡</li>
            </ul>

            <h4>æ¼”ç¿’3: ç©åˆ†å…¬å¼ã®ç²¾åº¦æ¯”è¼ƒ</h4>
            <p>
                æ¬¡ã®ç©åˆ†ã‚’å°å½¢å…¬å¼ã€Simpsonå…¬å¼ã€Gaussæ±‚ç©æ³•ï¼ˆ5ç‚¹ï¼‰ã§è¨ˆç®—ã—ã€ç²¾åº¦ã¨è¨ˆç®—ã‚³ã‚¹ãƒˆã‚’æ¯”è¼ƒã›ã‚ˆ:
            </p>
            <p>
                \( \displaystyle I = \int_0^2 \frac{1}{1+x^2} \, dx \)
            </p>
            <p>
                (ãƒ’ãƒ³ãƒˆ: å³å¯†è§£ã¯ \( \arctan(2) \approx 1.1071487... \))
            </p>

            <h4>æ¼”ç¿’4: å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®æ•°å€¤ç©åˆ†</h4>
            <p>
                ä»¥ä¸‹ã®å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¸©åº¦ vs æ™‚é–“ï¼‰ã‹ã‚‰ã€0ã€œ10ç§’é–“ã®å¹³å‡æ¸©åº¦ã‚’æ•°å€¤ç©åˆ†ã§æ±‚ã‚ã‚ˆ:
            </p>
            <pre>æ™‚åˆ» (s): [0, 2, 4, 6, 8, 10]
æ¸©åº¦ (Â°C): [20, 35, 48, 52, 49, 40]</pre>
            <p>
                å°å½¢å…¬å¼ã¨Simpsonå…¬å¼ã®ä¸¡æ–¹ã§è¨ˆç®—ã—ã€çµæœã‚’æ¯”è¼ƒã›ã‚ˆã€‚
            </p>

            <h4>æ¼”ç¿’5: ææ–™ç§‘å­¦ã¸ã®å¿œç”¨</h4>
            <p>
                ææ–™ã®ç†±è†¨å¼µä¿‚æ•° \( \alpha(T) \) ãŒæ¸©åº¦ã®é–¢æ•°ã¨ã—ã¦ä¸ãˆã‚‰ã‚ŒãŸã¨ãã€æ¸©åº¦å¤‰åŒ–ã«ä¼´ã†é•·ã•ã®å¤‰åŒ–ç‡ã¯æ¬¡å¼ã§è¨ˆç®—ã•ã‚Œã¾ã™:
            </p>
            \[
            \frac{\Delta L}{L_0} = \int_{T_0}^{T} \alpha(T') \, dT'
            \]
            <p>
                \( \alpha(T) = (1.5 + 0.003T) \times 10^{-5} \) (Kâ»Â¹) ã¨ã—ã€\( T_0 = 300 \) K ã‹ã‚‰ \( T = 500 \) K ã¸ã®æ¸©åº¦ä¸Šæ˜‡ã«ä¼´ã†é•·ã•ã®å¤‰åŒ–ç‡ã‚’æ•°å€¤ç©åˆ†ã§æ±‚ã‚ã‚ˆã€‚
            </p>
        </div>

        <section class="content-section">
            <h2>ã¾ã¨ã‚</h2>
            <p>
                æœ¬ç« ã§ã¯ã€æ•°å€¤å¾®åˆ†ã¨æ•°å€¤ç©åˆ†ã®åŸºæœ¬çš„ãªæ‰‹æ³•ã‚’å­¦ã³ã¾ã—ãŸ:
            </p>
            <ul>
                <li><strong>æ•°å€¤å¾®åˆ†:</strong> å·®åˆ†æ³•ï¼ˆå‰é€²ãƒ»å¾Œé€€ãƒ»ä¸­å¿ƒï¼‰ã¨Richardsonå¤–æŒ¿ã«ã‚ˆã‚‹é«˜ç²¾åº¦åŒ–</li>
                <li><strong>æ•°å€¤ç©åˆ†:</strong> å°å½¢å…¬å¼ã€Simpsonå…¬å¼ã€Gaussæ±‚ç©æ³•ã®åŸç†ã¨å®Ÿè£…</li>
                <li><strong>èª¤å·®è§£æ:</strong> ç†è«–çš„åæŸç‡ã®æ¤œè¨¼ã¨å®Ÿç”¨çš„ãªç²¾åº¦è©•ä¾¡</li>
                <li><strong>SciPyæ´»ç”¨:</strong> scipy.integrateã¨scipy.miscã«ã‚ˆã‚‹å®Ÿè·µçš„æ•°å€¤è¨ˆç®—</li>
            </ul>
            <p>
                ã“ã‚Œã‚‰ã®æ‰‹æ³•ã¯ã€ææ–™ç§‘å­¦ãƒ»ãƒ—ãƒ­ã‚»ã‚¹å·¥å­¦ã«ãŠã‘ã‚‹å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿è§£æã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€æœ€é©åŒ–ãªã©å¹…åºƒã„å ´é¢ã§æ´»ç”¨ã•ã‚Œã¾ã™ã€‚æ¬¡ç« ã§ã¯ã€ã“ã‚Œã‚‰ã®åŸºç¤ã®ä¸Šã«ç«‹ã£ã¦ç·šå½¢æ–¹ç¨‹å¼ç³»ã®æ•°å€¤è§£æ³•ã‚’å­¦ã³ã¾ã™ã€‚
            </p>
        </section>

        <div class="navigation-buttons">
            <a href="index.html" class="nav-button secondary">â† ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡</a>
            <a href="chapter-2.html" class="nav-button primary">ç¬¬2ç« ã¸ â†’</a>
        </div>
    </main>

    <footer style="margin-top: 4rem; padding: 2rem; background: #f8f9fa; border-radius: 12px; text-align: center; color: #666;">
        <p>&copy; 2025 FM Dojo. All rights reserved.</p>
    </footer>
</body>
</html>
