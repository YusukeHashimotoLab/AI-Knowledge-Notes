<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4ç« : ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã¨ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ› | è¤‡ç´ é–¢æ•°è«–ã¨ç‰¹æ®Šé–¢æ•° - FMé“å ´</title>
    <link rel="stylesheet" href="../../../assets/css/style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>MathJax = {tex: {inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']]}};</script>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="site-logo"><a href="../../../index.html">ğŸ›ï¸ AIå¯ºå­å±‹</a></div>
                <nav class="main-nav">
                    <a href="../../../index.html">ãƒ›ãƒ¼ãƒ </a>
                    <a href="../../index.html">çŸ¥è­˜ãƒ™ãƒ¼ã‚¹</a>
                    <a href="../index.html" class="active">FMé“å ´</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="chapter-page">
        <div class="container">
            <nav class="breadcrumb">
                <a href="../../../index.html">ãƒ›ãƒ¼ãƒ </a> &gt;
                <a href="../index.html">FMé“å ´</a> &gt;
                <a href="index.html">è¤‡ç´ é–¢æ•°è«–ã¨ç‰¹æ®Šé–¢æ•°</a> &gt;
                <span>ç¬¬4ç« </span>
            </nav>

            <article class="chapter-content">
                <div class="chapter-header">
                    <span class="chapter-label">ç¬¬4ç« </span>
                    <h1>ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã¨ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›</h1>
                    <p class="chapter-subtitle">Fourier and Laplace Transforms</p>
                    <div class="chapter-meta">
                        <span class="meta-item">â±ï¸ 22-26åˆ†</span>
                        <span class="meta-item">ğŸ’» 8ã‚³ãƒ¼ãƒ‰ä¾‹</span>
                        <span class="meta-item">ğŸ“Š ä¸­ç´š</span>
                    </div>
                </div>

                <section class="chapter-section">
                    <h2>4.1 ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°</h2>
                    <p>
                        å‘¨æœŸé–¢æ•°ã¯ä¸‰è§’é–¢æ•°ã®ç´šæ•°ï¼ˆãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°ï¼‰ã§è¡¨ç¾ã§ãã¾ã™ã€‚
                    </p>

                    <div class="theory-box">
                        <h4>ğŸ“ ç†è«–</h4>
                        <p><strong>ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°å±•é–‹:</strong></p>
                        $$f(x) = \frac{a_0}{2} + \sum_{n=1}^{\infty} \left( a_n \cos\frac{n\pi x}{L} + b_n \sin\frac{n\pi x}{L} \right)$$
                        <p><strong>ãƒ•ãƒ¼ãƒªã‚¨ä¿‚æ•°:</strong></p>
                        $$a_n = \frac{1}{L} \int_{-L}^{L} f(x) \cos\frac{n\pi x}{L} dx$$
                        $$b_n = \frac{1}{L} \int_{-L}^{L} f(x) \sin\frac{n\pi x}{L} dx$$
                    </div>

                    <div class="code-example">
                        <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹ 1: ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°å±•é–‹</h4>
                        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy import integrate

def fourier_coefficients(f, L, n_max):
    """ãƒ•ãƒ¼ãƒªã‚¨ä¿‚æ•°ã®è¨ˆç®—"""
    a0 = (1/L) * integrate.quad(f, -L, L)[0]
    
    a_n = []
    b_n = []
    
    for n in range(1, n_max + 1):
        # a_n
        integrand_a = lambda x: f(x) * np.cos(n * np.pi * x / L)
        a_n.append((1/L) * integrate.quad(integrand_a, -L, L)[0])
        
        # b_n
        integrand_b = lambda x: f(x) * np.sin(n * np.pi * x / L)
        b_n.append((1/L) * integrate.quad(integrand_b, -L, L)[0])
    
    return a0, np.array(a_n), np.array(b_n)

def fourier_series(x, a0, a_n, b_n, L):
    """ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°ã®éƒ¨åˆ†å’Œ"""
    result = a0 / 2
    for n, (a, b) in enumerate(zip(a_n, b_n), start=1):
        result += a * np.cos(n * np.pi * x / L) + b * np.sin(n * np.pi * x / L)
    return result

# ãƒ†ã‚¹ãƒˆé–¢æ•°: æ–¹å½¢æ³¢
L = np.pi
def square_wave(x):
    return np.where(np.abs(x) < L/2, 1.0, 0.0)

# ãƒ†ã‚¹ãƒˆé–¢æ•°: ã®ã“ãã‚Šæ³¢
def sawtooth_wave(x):
    return x / L

# ãƒ†ã‚¹ãƒˆé–¢æ•°: ä¸‰è§’æ³¢
def triangle_wave(x):
    return 1 - 2*np.abs(x)/L

# ãƒ•ãƒ¼ãƒªã‚¨ä¿‚æ•°ã®è¨ˆç®—
a0_sq, a_n_sq, b_n_sq = fourier_coefficients(square_wave, L, 20)
a0_saw, a_n_saw, b_n_saw = fourier_coefficients(sawtooth_wave, L, 20)
a0_tri, a_n_tri, b_n_tri = fourier_coefficients(triangle_wave, L, 20)

print("=== ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°å±•é–‹ ===\n")
print("æ–¹å½¢æ³¢:")
print(f"  a0 = {a0_sq:.6f}")
print(f"  First 5 a_n: {a_n_sq[:5]}")
print(f"  First 5 b_n: {b_n_sq[:5]}")

print("\nã®ã“ãã‚Šæ³¢:")
print(f"  a0 = {a0_saw:.6f}")
print(f"  First 5 a_n: {a_n_saw[:5]}")
print(f"  First 5 b_n: {b_n_saw[:5]}")

# å¯è¦–åŒ–
x = np.linspace(-2*L, 2*L, 1000)

fig, axes = plt.subplots(3, 1, figsize=(14, 12))

# æ–¹å½¢æ³¢
ax = axes[0]
ax.plot(x, square_wave(x % (2*L) - L), 'b-', linewidth=2, alpha=0.5, label='Original')
for n_terms in [3, 5, 10, 20]:
    y_approx = fourier_series(x % (2*L) - L, a0_sq, a_n_sq[:n_terms], b_n_sq[:n_terms], L)
    ax.plot(x, y_approx, linewidth=1.5, alpha=0.8, label=f'N={n_terms}')
ax.grid(True, alpha=0.3)
ax.set_xlabel('x', fontsize=12)
ax.set_ylabel('f(x)', fontsize=12)
ax.set_title('æ–¹å½¢æ³¢ã®ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°è¿‘ä¼¼', fontsize=12)
ax.legend()
ax.set_ylim(-0.5, 1.5)

# ã®ã“ãã‚Šæ³¢
ax = axes[1]
ax.plot(x, sawtooth_wave(x % (2*L) - L), 'b-', linewidth=2, alpha=0.5, label='Original')
for n_terms in [3, 5, 10, 20]:
    y_approx = fourier_series(x % (2*L) - L, a0_saw, a_n_saw[:n_terms], b_n_saw[:n_terms], L)
    ax.plot(x, y_approx, linewidth=1.5, alpha=0.8, label=f'N={n_terms}')
ax.grid(True, alpha=0.3)
ax.set_xlabel('x', fontsize=12)
ax.set_ylabel('f(x)', fontsize=12)
ax.set_title('ã®ã“ãã‚Šæ³¢ã®ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°è¿‘ä¼¼', fontsize=12)
ax.legend()

# ä¸‰è§’æ³¢
ax = axes[2]
ax.plot(x, triangle_wave(x % (2*L) - L), 'b-', linewidth=2, alpha=0.5, label='Original')
for n_terms in [3, 5, 10, 20]:
    y_approx = fourier_series(x % (2*L) - L, a0_tri, a_n_tri[:n_terms], b_n_tri[:n_terms], L)
    ax.plot(x, y_approx, linewidth=1.5, alpha=0.8, label=f'N={n_terms}')
ax.grid(True, alpha=0.3)
ax.set_xlabel('x', fontsize=12)
ax.set_ylabel('f(x)', fontsize=12)
ax.set_title('ä¸‰è§’æ³¢ã®ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°è¿‘ä¼¼', fontsize=12)
ax.legend()

plt.tight_layout()
plt.show()

# ã‚®ãƒ–ã‚¹ç¾è±¡ã®è¦³å¯Ÿ
print("\n=== ã‚®ãƒ–ã‚¹ç¾è±¡ ===")
print("æ–¹å½¢æ³¢ã®ä¸é€£ç¶šç‚¹è¿‘å‚ã§ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆãŒç™ºç”Ÿ")
x_gibbs = np.linspace(-L/2 - 0.5, -L/2 + 0.5, 200)
y_gibbs_20 = fourier_series(x_gibbs, a0_sq, a_n_sq[:20], b_n_sq[:20], L)
overshoot = np.max(y_gibbs_20) - 1.0
print(f"N=20ã®ã¨ãã®ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆ: {overshoot:.4f}")
print(f"ç†è«–å€¤: ç´„ 0.0895 (Gibbsã®å®šæ•° â‰ˆ 9%)")</code></pre>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>4.2 ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›</h2>
                    <p>
                        éå‘¨æœŸé–¢æ•°ã«å¯¾ã—ã¦ã¯ã€ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°ã‚’é€£ç¶šåŒ–ã—ãŸãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã‚’ç”¨ã„ã¾ã™ã€‚
                    </p>

                    <div class="theory-box">
                        <h4>ğŸ“ ç†è«–</h4>
                        <p><strong>ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›:</strong></p>
                        $$F(\omega) = \mathcal{F}[f(t)] = \int_{-\infty}^{\infty} f(t) e^{-i\omega t} dt$$
                        <p><strong>é€†ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›:</strong></p>
                        $$f(t) = \mathcal{F}^{-1}[F(\omega)] = \frac{1}{2\pi} \int_{-\infty}^{\infty} F(\omega) e^{i\omega t} d\omega$$
                    </div>

                    <div class="code-example">
                        <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹ 2: ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆFFTï¼‰</h4>
                        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.fft import fft, fftfreq, ifft

# ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
T = 0.01  # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš”
N = 2048  # ã‚µãƒ³ãƒ—ãƒ«æ•°
t = np.arange(N) * T

# ãƒ†ã‚¹ãƒˆä¿¡å·: è¤‡æ•°ã®å‘¨æ³¢æ•°æˆåˆ†
f1, f2, f3 = 5, 20, 50  # Hz
signal = (np.sin(2*np.pi*f1*t) + 
          0.5*np.sin(2*np.pi*f2*t) + 
          0.3*np.sin(2*np.pi*f3*t))

# ãƒã‚¤ã‚ºã®è¿½åŠ 
noise = 0.2 * np.random.randn(N)
signal_noisy = signal + noise

# FFT
fft_result = fft(signal_noisy)
freq = fftfreq(N, T)

# ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«
power_spectrum = np.abs(fft_result)**2

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 1, figsize=(14, 12))

# æ™‚é–“é ˜åŸŸ: å…ƒã®ä¿¡å·
ax = axes[0]
ax.plot(t[:500], signal[:500], 'b-', linewidth=2, label='Clean signal')
ax.plot(t[:500], signal_noisy[:500], 'r-', linewidth=1, alpha=0.6, label='Noisy signal')
ax.grid(True, alpha=0.3)
ax.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('æ™‚é–“é ˜åŸŸã®ä¿¡å·', fontsize=12)
ax.legend()

# å‘¨æ³¢æ•°é ˜åŸŸ: ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›
ax = axes[1]
ax.plot(freq[:N//2], np.abs(fft_result[:N//2]), 'b-', linewidth=2)
ax.axvline(f1, color='red', linestyle='--', alpha=0.5, label=f'{f1} Hz')
ax.axvline(f2, color='green', linestyle='--', alpha=0.5, label=f'{f2} Hz')
ax.axvline(f3, color='orange', linestyle='--', alpha=0.5, label=f'{f3} Hz')
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('å‘¨æ³¢æ•°ã‚¹ãƒšã‚¯ãƒˆãƒ«ï¼ˆãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼‰', fontsize=12)
ax.set_xlim(0, 100)
ax.legend()

# ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«
ax = axes[2]
ax.semilogy(freq[:N//2], power_spectrum[:N//2], 'b-', linewidth=2)
ax.axvline(f1, color='red', linestyle='--', alpha=0.5)
ax.axvline(f2, color='green', linestyle='--', alpha=0.5)
ax.axvline(f3, color='orange', linestyle='--', alpha=0.5)
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('ãƒ‘ãƒ¯ãƒ¼', fontsize=12)
ax.set_title('ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«', fontsize=12)
ax.set_xlim(0, 100)

plt.tight_layout()
plt.show()

print("=== ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã«ã‚ˆã‚‹å‘¨æ³¢æ•°è§£æ ===")
print(f"å…¥åŠ›ä¿¡å·: {f1} Hz, {f2} Hz, {f3} Hz")
print(f"\nãƒ”ãƒ¼ã‚¯æ¤œå‡º:")
# ãƒ”ãƒ¼ã‚¯ã‚’æ¤œå‡º
threshold = np.max(np.abs(fft_result[:N//2])) * 0.3
peaks = np.where(np.abs(fft_result[:N//2]) > threshold)[0]
peak_freqs = freq[peaks]
for pf in peak_freqs[:10]:
    if pf > 0:
        print(f"  {pf:.2f} Hz")</code></pre>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>4.3 ç•³ã¿è¾¼ã¿å®šç†</h2>
                    <p>
                        ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã¯ç•³ã¿è¾¼ã¿æ¼”ç®—ã‚’å˜ç´”ãªç©ã«å¤‰æ›ã—ã¾ã™ã€‚
                    </p>

                    <div class="theory-box">
                        <h4>ğŸ“ ç†è«–</h4>
                        <p><strong>ç•³ã¿è¾¼ã¿å®šç†:</strong></p>
                        $$\mathcal{F}[f * g] = \mathcal{F}[f] \cdot \mathcal{F}[g]$$
                        <p>ã“ã“ã§ç•³ã¿è¾¼ã¿ $(f * g)(t) = \int_{-\infty}^{\infty} f(\tau) g(t-\tau) d\tau$</p>
                    </div>

                    <div class="code-example">
                        <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹ 3: ç•³ã¿è¾¼ã¿ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</h4>
                        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.fft import fft, ifft, fftfreq
from scipy import signal

# ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
fs = 1000  # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•° (Hz)
T = 1/fs
N = 2048
t = np.arange(N) * T

# å…¥åŠ›ä¿¡å·: çŸ©å½¢ãƒ‘ãƒ«ã‚¹ + é«˜å‘¨æ³¢ãƒã‚¤ã‚º
pulse_width = 50
pulse = np.zeros(N)
pulse[N//2 - pulse_width//2:N//2 + pulse_width//2] = 1.0

noise_high_freq = 0.3 * np.sin(2*np.pi*200*t)
signal_input = pulse + noise_high_freq

# ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆGaussianï¼‰
cutoff_freq = 50  # Hz
sigma = 1 / (2 * np.pi * cutoff_freq)
filter_time = np.exp(-t**2 / (2*sigma**2))
filter_time = filter_time / np.sum(filter_time)  # æ­£è¦åŒ–

# æ–¹æ³•1: æ™‚é–“é ˜åŸŸã§ã®ç•³ã¿è¾¼ã¿
signal_filtered_time = np.convolve(signal_input, filter_time, mode='same')

# æ–¹æ³•2: å‘¨æ³¢æ•°é ˜åŸŸã§ã®ç©ï¼ˆç•³ã¿è¾¼ã¿å®šç†ï¼‰
fft_signal = fft(signal_input)
fft_filter = fft(filter_time)
fft_filtered = fft_signal * fft_filter
signal_filtered_freq = ifft(fft_filtered).real

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 2, figsize=(14, 12))

# æ™‚é–“é ˜åŸŸ: å…¥åŠ›ä¿¡å·
ax = axes[0, 0]
ax.plot(t[:500], signal_input[:500], 'b-', linewidth=1.5)
ax.grid(True, alpha=0.3)
ax.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('å…¥åŠ›ä¿¡å·ï¼ˆãƒ‘ãƒ«ã‚¹ + ãƒã‚¤ã‚ºï¼‰', fontsize=12)

# å‘¨æ³¢æ•°é ˜åŸŸ: å…¥åŠ›ä¿¡å·
ax = axes[0, 1]
freq = fftfreq(N, T)
ax.semilogy(freq[:N//2], np.abs(fft_signal[:N//2]), 'b-', linewidth=1.5)
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('å…¥åŠ›ä¿¡å·ã®ã‚¹ãƒšã‚¯ãƒˆãƒ«', fontsize=12)
ax.set_xlim(0, 300)

# æ™‚é–“é ˜åŸŸ: ãƒ•ã‚£ãƒ«ã‚¿
ax = axes[1, 0]
ax.plot(t[:200], filter_time[:200], 'g-', linewidth=2)
ax.grid(True, alpha=0.3)
ax.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆæ™‚é–“é ˜åŸŸï¼‰', fontsize=12)

# å‘¨æ³¢æ•°é ˜åŸŸ: ãƒ•ã‚£ãƒ«ã‚¿
ax = axes[1, 1]
ax.plot(freq[:N//2], np.abs(fft_filter[:N//2]), 'g-', linewidth=2)
ax.axvline(cutoff_freq, color='red', linestyle='--', label=f'Cutoff: {cutoff_freq} Hz')
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('ãƒ•ã‚£ãƒ«ã‚¿ã®å‘¨æ³¢æ•°å¿œç­”', fontsize=12)
ax.set_xlim(0, 300)
ax.legend()

# æ™‚é–“é ˜åŸŸ: ãƒ•ã‚£ãƒ«ã‚¿å¾Œã®ä¿¡å·
ax = axes[2, 0]
ax.plot(t[:500], signal_input[:500], 'b-', linewidth=1, alpha=0.3, label='Input')
ax.plot(t[:500], signal_filtered_time[:500], 'r-', linewidth=2, label='Filtered')
ax.grid(True, alpha=0.3)
ax.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('ãƒ•ã‚£ãƒ«ã‚¿å¾Œã®ä¿¡å·ï¼ˆæ™‚é–“é ˜åŸŸç•³ã¿è¾¼ã¿ï¼‰', fontsize=12)
ax.legend()

# å‘¨æ³¢æ•°é ˜åŸŸ: ãƒ•ã‚£ãƒ«ã‚¿å¾Œã®ä¿¡å·
ax = axes[2, 1]
ax.semilogy(freq[:N//2], np.abs(fft_signal[:N//2]), 'b-', linewidth=1, alpha=0.3, label='Input')
ax.semilogy(freq[:N//2], np.abs(fft_filtered[:N//2]), 'r-', linewidth=2, label='Filtered')
ax.axvline(cutoff_freq, color='green', linestyle='--', alpha=0.5)
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('ãƒ•ã‚£ãƒ«ã‚¿å¾Œã®ã‚¹ãƒšã‚¯ãƒˆãƒ«ï¼ˆå‘¨æ³¢æ•°é ˜åŸŸç©ï¼‰', fontsize=12)
ax.set_xlim(0, 300)
ax.legend()

plt.tight_layout()
plt.show()

# ç•³ã¿è¾¼ã¿å®šç†ã®æ¤œè¨¼
error = np.linalg.norm(signal_filtered_time - signal_filtered_freq) / np.linalg.norm(signal_filtered_time)
print("=== ç•³ã¿è¾¼ã¿å®šç†ã®æ¤œè¨¼ ===")
print(f"æ™‚é–“é ˜åŸŸç•³ã¿è¾¼ã¿ vs å‘¨æ³¢æ•°é ˜åŸŸç©")
print(f"ç›¸å¯¾èª¤å·®: {error:.2e}")
print("ç•³ã¿è¾¼ã¿å®šç†: F[f * g] = F[f] Â· F[g] âœ“")</code></pre>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>4.4 ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›</h2>
                    <p>
                        ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã¯ç‰‡å´ã®ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã‚’ä¸€èˆ¬åŒ–ã—ãŸã‚‚ã®ã§ã€å¾®åˆ†æ–¹ç¨‹å¼ã®è§£æ³•ã«æœ‰ç”¨ã§ã™ã€‚
                    </p>

                    <div class="theory-box">
                        <h4>ğŸ“ ç†è«–</h4>
                        <p><strong>ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›:</strong></p>
                        $$F(s) = \mathcal{L}[f(t)] = \int_0^{\infty} f(t) e^{-st} dt$$
                        <p><strong>ä¸»ãªæ€§è³ª:</strong></p>
                        <ul>
                            <li>å¾®åˆ†: $\mathcal{L}[f'(t)] = sF(s) - f(0)$</li>
                            <li>ç©åˆ†: $\mathcal{L}\left[\int_0^t f(\tau)d\tau\right] = \frac{F(s)}{s}$</li>
                            <li>ç•³ã¿è¾¼ã¿: $\mathcal{L}[f * g] = F(s) \cdot G(s)$</li>
                        </ul>
                    </div>

                    <div class="code-example">
                        <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹ 4: ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã®æ•°å€¤è¨ˆç®—</h4>
                        <pre><code class="language-python">import numpy as np
from scipy import integrate
import matplotlib.pyplot as plt

def laplace_transform(f, s, t_max=10):
    """ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã®æ•°å€¤è¨ˆç®—"""
    integrand = lambda t: f(t) * np.exp(-s * t)
    result, error = integrate.quad(integrand, 0, t_max)
    return result

# ãƒ†ã‚¹ãƒˆé–¢æ•°
functions = {
    'e^(-at)': lambda t, a=2: np.exp(-a*t),
    't e^(-at)': lambda t, a=1: t * np.exp(-a*t),
    'sin(Ï‰t)': lambda t, omega=3: np.sin(omega*t),
    'cos(Ï‰t)': lambda t, omega=3: np.cos(omega*t),
    'H(t-a)': lambda t, a=2: np.where(t >= a, 1.0, 0.0),  # ãƒ˜ãƒ“ã‚µã‚¤ãƒ‰é–¢æ•°
}

# ç†è«–å€¤
def theoretical_laplace(func_name, s):
    if func_name == 'e^(-at)':
        a = 2
        return 1 / (s + a)
    elif func_name == 't e^(-at)':
        a = 1
        return 1 / (s + a)**2
    elif func_name == 'sin(Ï‰t)':
        omega = 3
        return omega / (s**2 + omega**2)
    elif func_name == 'cos(Ï‰t)':
        omega = 3
        return s / (s**2 + omega**2)
    elif func_name == 'H(t-a)':
        a = 2
        return np.exp(-a*s) / s
    return None

print("=== ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã®è¨ˆç®— ===\n")

s_values = np.array([0.5, 1.0, 2.0, 5.0])

for name, f in functions.items():
    print(f"f(t) = {name}")
    for s in s_values:
        numerical = laplace_transform(f, s)
        theoretical = theoretical_laplace(name, s)
        
        if theoretical is not None:
            error = abs(numerical - theoretical) / abs(theoretical) if theoretical != 0 else abs(numerical)
            print(f"  s={s}: Numerical={numerical:.6f}, Theory={theoretical:.6f}, Error={error:.2e}")
        else:
            print(f"  s={s}: Numerical={numerical:.6f}")
    print()

# å¯è¦–åŒ–: så¹³é¢ã§ã®ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›
sigma = np.linspace(-3, 3, 50)
omega = np.linspace(-10, 10, 50)
Sigma, Omega = np.meshgrid(sigma, omega)
S = Sigma + 1j*Omega

fig, axes = plt.subplots(2, 2, figsize=(12, 12))
axes = axes.flatten()

test_cases = [
    ('e^(-2t)', lambda s: 1/(s+2), -2, None),
    ('t e^(-t)', lambda s: 1/(s+1)**2, -1, None),
    ('sin(3t)', lambda s: 3/(s**2+9), None, 3),
    ('cos(3t)', lambda s: s/(s**2+9), None, 3),
]

for idx, (name, F_theory, pole_real, pole_imag) in enumerate(test_cases):
    ax = axes[idx]
    
    # ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã®å€¤ï¼ˆç†è«–å€¤ï¼‰
    F_val = F_theory(S)
    F_abs = np.abs(F_val)
    F_abs = np.clip(F_abs, 0, 10)  # ã‚¯ãƒªãƒƒãƒ—
    
    im = ax.contourf(Sigma, Omega, F_abs, levels=20, cmap='viridis')
    
    # æ¥µã®ä½ç½®
    if pole_real is not None and pole_imag is None:
        ax.plot(pole_real, 0, 'r*', markersize=15, label=f'Pole at s={pole_real}')
    elif pole_imag is not None:
        ax.plot(0, pole_imag, 'r*', markersize=15)
        ax.plot(0, -pole_imag, 'r*', markersize=15, label=f'Poles at s=Â±{pole_imag}i')
    
    ax.axvline(0, color='white', linewidth=1, linestyle='--', alpha=0.5)
    ax.axhline(0, color='white', linewidth=1, linestyle='--', alpha=0.5)
    ax.set_xlabel('Ïƒ (Re(s))', fontsize=12)
    ax.set_ylabel('Ï‰ (Im(s))', fontsize=12)
    ax.set_title(f'$|F(s)|$ for $f(t)={name}$', fontsize=11)
    ax.legend()
    plt.colorbar(im, ax=ax)

plt.suptitle('ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã®så¹³é¢è¡¨ç¤º', fontsize=14)
plt.tight_layout()
plt.show()</code></pre>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>4.5 é€†ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã¨å¾®åˆ†æ–¹ç¨‹å¼</h2>
                    <p>
                        ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã‚’ä½¿ã†ã¨ã€å¾®åˆ†æ–¹ç¨‹å¼ã‚’ä»£æ•°æ–¹ç¨‹å¼ã«å¤‰æ›ã§ãã¾ã™ã€‚
                    </p>

                    <div class="code-example">
                        <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹ 5: é€†ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã«ã‚ˆã‚‹å¾®åˆ†æ–¹ç¨‹å¼ã®è§£æ³•</h4>
                        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy import integrate
import sympy as sp

# SymPyã§è¨˜å·è¨ˆç®—
t_sym = sp.Symbol('t', positive=True, real=True)
s_sym = sp.Symbol('s')

# å¾®åˆ†æ–¹ç¨‹å¼: y'' + 4y' + 3y = e^(-t), y(0) = 0, y'(0) = 0
print("=== å¾®åˆ†æ–¹ç¨‹å¼ã®è§£æ³•ï¼ˆãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ï¼‰ ===\n")
print("å¾®åˆ†æ–¹ç¨‹å¼: y'' + 4y' + 3y = e^(-t)")
print("åˆæœŸæ¡ä»¶: y(0) = 0, y'(0) = 0\n")

# ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›
# L[y''] = sÂ²Y(s) - sy(0) - y'(0)
# L[y'] = sY(s) - y(0)
# L[y] = Y(s)
# L[e^(-t)] = 1/(s+1)

# ä»£æ•°æ–¹ç¨‹å¼: (sÂ² + 4s + 3)Y(s) = 1/(s+1)
# Y(s) = 1/[(s+1)(sÂ²+4s+3)] = 1/[(s+1)(s+1)(s+3)] = 1/[(s+1)Â²(s+3)]

Y_s = 1 / ((s_sym + 1)**2 * (s_sym + 3))

print("ãƒ©ãƒ—ãƒ©ã‚¹ç©ºé–“ã§ã®è§£: Y(s) =", Y_s)

# éƒ¨åˆ†åˆ†æ•°åˆ†è§£
Y_partial = sp.apart(Y_s, s_sym)
print("éƒ¨åˆ†åˆ†æ•°åˆ†è§£: Y(s) =", Y_partial)

# é€†ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›
y_solution = sp.inverse_laplace_transform(Y_s, s_sym, t_sym)
print("è§£: y(t) =", y_solution)

# æ•°å€¤è¨ˆç®—ã§ã®æ¤œè¨¼
y_func = sp.lambdify(t_sym, y_solution, 'numpy')
t_num = np.linspace(0, 5, 500)
y_num = y_func(t_num)

# ç›´æ¥æ•°å€¤è§£ï¼ˆæ¯”è¼ƒç”¨ï¼‰
def ode_system(t, y):
    """y = [y, y']"""
    return [y[1], np.exp(-t) - 3*y[0] - 4*y[1]]

from scipy.integrate import solve_ivp
sol = solve_ivp(ode_system, [0, 5], [0, 0], t_eval=t_num, method='RK45')

# å¯è¦–åŒ–
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 5))

# è§£ã®æ¯”è¼ƒ
ax1.plot(t_num, y_num, 'b-', linewidth=2, label='Laplace method')
ax1.plot(sol.t, sol.y[0], 'r--', linewidth=2, alpha=0.7, label='Numerical ODE')
ax1.grid(True, alpha=0.3)
ax1.set_xlabel('t', fontsize=12)
ax1.set_ylabel('y(t)', fontsize=12)
ax1.set_title('å¾®åˆ†æ–¹ç¨‹å¼ã®è§£ï¼ˆæ¯”è¼ƒï¼‰', fontsize=12)
ax1.legend()

# èª¤å·®
error = np.abs(y_num - sol.y[0])
ax2.semilogy(t_num, error, 'g-', linewidth=2)
ax2.grid(True, alpha=0.3)
ax2.set_xlabel('t', fontsize=12)
ax2.set_ylabel('èª¤å·®', fontsize=12)
ax2.set_title('ãƒ©ãƒ—ãƒ©ã‚¹æ³• vs æ•°å€¤è§£ã®èª¤å·®', fontsize=12)

plt.tight_layout()
plt.show()

print(f"\næœ€å¤§èª¤å·®: {np.max(error):.2e}")

# åˆ¥ã®ä¾‹: å¼·åˆ¶æŒ¯å‹•
print("\n\n=== ä¾‹2: å¼·åˆ¶æŒ¯å‹• ===")
print("å¾®åˆ†æ–¹ç¨‹å¼: y'' + Ï‰â‚€Â²y = Fâ‚€sin(Ï‰t)")
print("åˆæœŸæ¡ä»¶: y(0) = 0, y'(0) = 0")

omega_0 = 2.0
omega = 1.5
F0 = 1.0

# Y(s) = Fâ‚€Ï‰ / [(sÂ² + Ï‰Â²)(sÂ² + Ï‰â‚€Â²)]
Y_forced = (F0 * omega) / ((s_sym**2 + omega**2) * (s_sym**2 + omega_0**2))
print(f"\nY(s) =", Y_forced)

# éƒ¨åˆ†åˆ†æ•°åˆ†è§£
Y_forced_partial = sp.apart(Y_forced, s_sym)
print("éƒ¨åˆ†åˆ†æ•°åˆ†è§£:", Y_forced_partial)

# é€†ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›
y_forced = sp.inverse_laplace_transform(Y_forced, s_sym, t_sym)
y_forced_simplified = sp.simplify(y_forced)
print("è§£:", y_forced_simplified)

# æ•°å€¤è©•ä¾¡
y_forced_func = sp.lambdify(t_sym, y_forced, 'numpy')
t_forced = np.linspace(0, 20, 1000)
y_forced_num = y_forced_func(t_forced)

plt.figure(figsize=(12, 5))
plt.plot(t_forced, y_forced_num, 'b-', linewidth=2)
plt.plot(t_forced, (F0*omega/(omega_0**2 - omega**2)) * np.sin(omega*t_forced), 
         'r--', linewidth=1, alpha=0.5, label='Forcing term (scaled)')
plt.grid(True, alpha=0.3)
plt.xlabel('t', fontsize=12)
plt.ylabel('y(t)', fontsize=12)
plt.title(f'å¼·åˆ¶æŒ¯å‹•ã®è§£ (Ï‰â‚€={omega_0}, Ï‰={omega})', fontsize=14)
plt.legend()
plt.tight_layout()
plt.show()

print("\næŒ¯å‹•ã®ç‰¹å¾´:")
print(f"å›ºæœ‰è§’å‘¨æ³¢æ•°: Ï‰â‚€ = {omega_0}")
print(f"å¤–åŠ›ã®è§’å‘¨æ³¢æ•°: Ï‰ = {omega}")
print(f"Ï‰ â‰  Ï‰â‚€ ã®ãŸã‚ã€ã†ãªã‚ŠãŒè¦³å¯Ÿã•ã‚Œã‚‹")</code></pre>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>4.6 ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã®æ€§è³ª</h2>
                    <p>
                        ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã«ã¯æ§˜ã€…ãªæœ‰ç”¨ãªæ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚
                    </p>

                    <div class="code-example">
                        <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹ 6: ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã®æ€§è³ªï¼ˆã‚·ãƒ•ãƒˆã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã€å¾®åˆ†ï¼‰</h4>
                        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.fft import fft, fftfreq, fftshift

# ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
fs = 1000
T = 1/fs
N = 2048
t = np.arange(N) * T
freq = fftfreq(N, T)

# å…ƒã®ä¿¡å·: Gaussianãƒ‘ãƒ«ã‚¹
sigma = 0.05
t_center = N * T / 2
gaussian = np.exp(-(t - t_center)**2 / (2*sigma**2))

# æ€§è³ª1: æ™‚é–“ã‚·ãƒ•ãƒˆ
t_shift = 0.2
gaussian_shifted = np.exp(-(t - t_center - t_shift)**2 / (2*sigma**2))

# æ€§è³ª2: ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
sigma_scaled = sigma * 2
gaussian_scaled = np.exp(-(t - t_center)**2 / (2*sigma_scaled**2))

# æ€§è³ª3: å¾®åˆ†
gaussian_deriv = -(t - t_center) / sigma**2 * gaussian

# FFT
fft_orig = fftshift(fft(gaussian))
fft_shifted = fftshift(fft(gaussian_shifted))
fft_scaled = fftshift(fft(gaussian_scaled))
fft_deriv = fftshift(fft(gaussian_deriv))
freq_shifted = fftshift(freq)

# å¯è¦–åŒ–
fig, axes = plt.subplots(4, 2, figsize=(14, 14))

# å…ƒã®ä¿¡å·
ax = axes[0, 0]
ax.plot(t, gaussian, 'b-', linewidth=2)
ax.grid(True, alpha=0.3)
ax.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('å…ƒã®ä¿¡å·: Gaussian', fontsize=12)

ax = axes[0, 1]
ax.plot(freq_shifted, np.abs(fft_orig), 'b-', linewidth=2)
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›', fontsize=12)
ax.set_xlim(-100, 100)

# æ™‚é–“ã‚·ãƒ•ãƒˆ
ax = axes[1, 0]
ax.plot(t, gaussian, 'b-', linewidth=1, alpha=0.3, label='Original')
ax.plot(t, gaussian_shifted, 'r-', linewidth=2, label=f'Shifted by {t_shift}s')
ax.grid(True, alpha=0.3)
ax.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('æ™‚é–“ã‚·ãƒ•ãƒˆ', fontsize=12)
ax.legend()

ax = axes[1, 1]
ax.plot(freq_shifted, np.abs(fft_orig), 'b-', linewidth=1, alpha=0.3, label='Original')
ax.plot(freq_shifted, np.abs(fft_shifted), 'r-', linewidth=2, label='Shifted')
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('ã‚·ãƒ•ãƒˆå¾Œã®ã‚¹ãƒšã‚¯ãƒˆãƒ«ï¼ˆæŒ¯å¹…ä¸å¤‰ï¼‰', fontsize=12)
ax.set_xlim(-100, 100)
ax.legend()

# ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
ax = axes[2, 0]
ax.plot(t, gaussian, 'b-', linewidth=1, alpha=0.3, label='Original')
ax.plot(t, gaussian_scaled, 'g-', linewidth=2, label=f'Scaled (ÏƒÃ—2)')
ax.grid(True, alpha=0.3)
ax.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('æ™‚é–“ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°', fontsize=12)
ax.legend()

ax = axes[2, 1]
ax.plot(freq_shifted, np.abs(fft_orig), 'b-', linewidth=1, alpha=0.3, label='Original')
ax.plot(freq_shifted, np.abs(fft_scaled), 'g-', linewidth=2, label='Scaled')
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('ã‚¹ã‚±ãƒ¼ãƒ«å¾Œã®ã‚¹ãƒšã‚¯ãƒˆãƒ«ï¼ˆå‘¨æ³¢æ•°åœ§ç¸®ï¼‰', fontsize=12)
ax.set_xlim(-100, 100)
ax.legend()

# å¾®åˆ†
ax = axes[3, 0]
ax.plot(t, gaussian, 'b-', linewidth=1, alpha=0.3, label='f(t)')
ax.plot(t, gaussian_deriv, 'm-', linewidth=2, label="f'(t)")
ax.grid(True, alpha=0.3)
ax.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('å¾®åˆ†', fontsize=12)
ax.legend()

ax = axes[3, 1]
ax.plot(freq_shifted, np.abs(fft_orig), 'b-', linewidth=1, alpha=0.3, label='F(Ï‰)')
ax.plot(freq_shifted, np.abs(fft_deriv), 'm-', linewidth=2, label="F[f'(t)] = iÏ‰F(Ï‰)")
ax.grid(True, alpha=0.3)
ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax.set_ylabel('æŒ¯å¹…', fontsize=12)
ax.set_title('å¾®åˆ†å¾Œã®ã‚¹ãƒšã‚¯ãƒˆãƒ«ï¼ˆé«˜å‘¨æ³¢å¼·èª¿ï¼‰', fontsize=12)
ax.set_xlim(-100, 100)
ax.legend()

plt.suptitle('ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã®æ€§è³ª', fontsize=14)
plt.tight_layout()
plt.show()

print("=== ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã®æ€§è³ª ===")
print("1. æ™‚é–“ã‚·ãƒ•ãƒˆ: f(t-tâ‚€) â†’ e^(-iÏ‰tâ‚€)F(Ï‰) (æŒ¯å¹…ä¸å¤‰ã€ä½ç›¸å¤‰åŒ–)")
print("2. ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°: f(at) â†’ (1/|a|)F(Ï‰/a) (æ™‚é–“æ‹¡å¤§ â†” å‘¨æ³¢æ•°åœ§ç¸®)")
print("3. å¾®åˆ†: f'(t) â†’ iÏ‰F(Ï‰) (é«˜å‘¨æ³¢å¼·èª¿)")</code></pre>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>4.7 ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã¨ã‚¹ãƒšã‚¯ãƒˆãƒ«æ¼ã‚Œ</h2>
                    <p>
                        æœ‰é™é•·ã®ä¿¡å·ã‚’FFTã§è§£æã™ã‚‹éš›ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã‚’ä½¿ã£ã¦ ã‚¹ãƒšã‚¯ãƒˆãƒ«æ¼ã‚Œã‚’æŠ‘åˆ¶ã—ã¾ã™ã€‚
                    </p>

                    <div class="code-example">
                        <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹ 7: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã®åŠ¹æœ</h4>
                        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.fft import fft, fftfreq
from scipy import signal as sig

# ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
fs = 1000
T = 1/fs
N = 1024
t = np.arange(N) * T

# ãƒ†ã‚¹ãƒˆä¿¡å·: 50.5 Hz ã®æ­£å¼¦æ³¢ï¼ˆãƒ“ãƒ³ä¸­å¿ƒã‹ã‚‰ãšã‚Œã¦ã„ã‚‹ï¼‰
f_signal = 50.5
signal_pure = np.sin(2*np.pi*f_signal*t)

# æ§˜ã€…ãªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°
windows = {
    'Rectangular (no window)': np.ones(N),
    'Hann': sig.windows.hann(N),
    'Hamming': sig.windows.hamming(N),
    'Blackman': sig.windows.blackman(N),
    'Kaiser (Î²=5)': sig.windows.kaiser(N, 5),
}

# å¯è¦–åŒ–
fig = plt.figure(figsize=(16, 12))
gs = fig.add_gridspec(4, 3, hspace=0.3, wspace=0.3)

# æ™‚é–“é ˜åŸŸã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
ax_time = fig.add_subplot(gs[0, :])
for name, window in windows.items():
    ax_time.plot(t[:200], window[:200], linewidth=2, label=name, alpha=0.7)
ax_time.grid(True, alpha=0.3)
ax_time.set_xlabel('æ™‚é–“ (s)', fontsize=12)
ax_time.set_ylabel('æŒ¯å¹…', fontsize=12)
ax_time.set_title('ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ï¼ˆæ™‚é–“é ˜åŸŸï¼‰', fontsize=14)
ax_time.legend()

# å„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã®ã‚¹ãƒšã‚¯ãƒˆãƒ«
freq = fftfreq(N, T)

for idx, (name, window) in enumerate(windows.items()):
    # ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é©ç”¨
    signal_windowed = signal_pure * window
    
    # FFT
    fft_result = fft(signal_windowed)
    magnitude_db = 20 * np.log10(np.abs(fft_result[:N//2]) / N + 1e-10)
    
    # ãƒ—ãƒ­ãƒƒãƒˆä½ç½®
    row = (idx // 2) + 1
    col = idx % 2
    ax = fig.add_subplot(gs[row, col])
    
    ax.plot(freq[:N//2], magnitude_db, 'b-', linewidth=1.5)
    ax.axvline(f_signal, color='red', linestyle='--', label=f'{f_signal} Hz')
    ax.grid(True, alpha=0.3)
    ax.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
    ax.set_ylabel('æŒ¯å¹… (dB)', fontsize=12)
    ax.set_title(f'{name}', fontsize=12)
    ax.set_xlim(0, 150)
    ax.set_ylim(-100, 0)
    ax.legend()

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å‘¨æ³¢æ•°ç‰¹æ€§ã®æ¯”è¼ƒ
ax_compare = fig.add_subplot(gs[1:, 2])
for name, window in windows.items():
    fft_window = fft(window, N)
    magnitude_db = 20 * np.log10(np.abs(fft_window[:N//2]) / N + 1e-10)
    ax_compare.plot(freq[:N//2], magnitude_db, linewidth=2, label=name, alpha=0.7)

ax_compare.grid(True, alpha=0.3)
ax_compare.set_xlabel('å‘¨æ³¢æ•° (Hz)', fontsize=12)
ax_compare.set_ylabel('æŒ¯å¹… (dB)', fontsize=12)
ax_compare.set_title('ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å‘¨æ³¢æ•°ç‰¹æ€§', fontsize=12)
ax_compare.set_xlim(0, 50)
ax_compare.set_ylim(-100, 10)
ax_compare.legend()

plt.suptitle('ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã¨ã‚¹ãƒšã‚¯ãƒˆãƒ«æ¼ã‚Œã®æŠ‘åˆ¶', fontsize=16)
plt.tight_layout()
plt.show()

print("=== ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã®ç‰¹æ€§ ===\n")
for name, window in windows.items():
    # ãƒ¡ã‚¤ãƒ³ãƒ­ãƒ¼ãƒ–å¹…ã¨ã‚µã‚¤ãƒ‰ãƒ­ãƒ¼ãƒ–ãƒ¬ãƒ™ãƒ«ã‚’è¨ˆç®—
    fft_window = fft(window, N)
    magnitude = np.abs(fft_window[:N//2])
    magnitude_db = 20 * np.log10(magnitude / np.max(magnitude) + 1e-10)
    
    # ãƒ¡ã‚¤ãƒ³ãƒ­ãƒ¼ãƒ–å¹…ï¼ˆ-3dBå¹…ï¼‰
    main_lobe_idx = np.where(magnitude_db > -3)[0]
    main_lobe_width = len(main_lobe_idx) * fs / N
    
    # æœ€å¤§ã‚µã‚¤ãƒ‰ãƒ­ãƒ¼ãƒ–ãƒ¬ãƒ™ãƒ«
    # ãƒ¡ã‚¤ãƒ³ãƒ­ãƒ¼ãƒ–ã‚’é™¤å¤–
    sidelobe_start = main_lobe_idx[-1] + 1 if len(main_lobe_idx) > 0 else 10
    if sidelobe_start < len(magnitude_db):
        max_sidelobe = np.max(magnitude_db[sidelobe_start:])
    else:
        max_sidelobe = -np.inf
    
    print(f"{name}:")
    print(f"  ãƒ¡ã‚¤ãƒ³ãƒ­ãƒ¼ãƒ–å¹…: {main_lobe_width:.2f} Hz")
    print(f"  æœ€å¤§ã‚µã‚¤ãƒ‰ãƒ­ãƒ¼ãƒ–ãƒ¬ãƒ™ãƒ«: {max_sidelobe:.1f} dB")
    print()</code></pre>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>4.8 ææ–™ç§‘å­¦ã¸ã®å¿œç”¨: Xç·šå›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³è§£æ</h2>
                    <p>
                        çµæ™¶æ§‹é€ ã®è§£æã§ã¯ã€å®Ÿç©ºé–“ã®åŸå­é…åˆ—ã¨ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã•ã‚ŒãŸé€†æ ¼å­ç©ºé–“ï¼ˆå›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ãŒå¯¾å¿œã—ã¾ã™ã€‚
                    </p>

                    <div class="code-example">
                        <h4>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹ 8: 1æ¬¡å…ƒçµæ™¶ã®Xç·šå›æŠ˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h4>
                        <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.fft import fft, fftfreq, fftshift

# 1æ¬¡å…ƒçµæ™¶ãƒ¢ãƒ‡ãƒ«
a = 1.0  # æ ¼å­å®šæ•°
N_unit_cells = 50  # ãƒ¦ãƒ‹ãƒƒãƒˆã‚»ãƒ«ã®æ•°
N_points = 1024  # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‚¹æ•°

# å®Ÿç©ºé–“ã®æ ¼å­ç‚¹
x = np.linspace(0, N_unit_cells * a, N_points)
dx = x[1] - x[0]

# åŸå­å¯†åº¦é–¢æ•°ï¼ˆãƒ‡ãƒ«ã‚¿é–¢æ•°ã®è¿‘ä¼¼ã¨ã—ã¦ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ï¼‰
rho = np.zeros(N_points)
sigma_atom = 0.02  # åŸå­ã®ã‚µã‚¤ã‚º

for n in range(N_unit_cells):
    x_atom = n * a
    rho += np.exp(-(x - x_atom)**2 / (2*sigma_atom**2))

# ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ï¼ˆæ§‹é€ å› å­ï¼‰
structure_factor = fftshift(fft(rho))
k = fftshift(fftfreq(N_points, dx)) * 2 * np.pi  # é€†æ ¼å­ãƒ™ã‚¯ãƒˆãƒ«

# å›æŠ˜å¼·åº¦ï¼ˆ|F(k)|Â²ï¼‰
diffraction_intensity = np.abs(structure_factor)**2

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 1, figsize=(14, 12))

# å®Ÿç©ºé–“: åŸå­é…åˆ—
ax = axes[0]
ax.plot(x, rho, 'b-', linewidth=2)
ax.stem([n*a for n in range(N_unit_cells)], [np.max(rho)]*N_unit_cells, 
        linefmt='r-', markerfmt='ro', basefmt=' ', label='æ ¼å­ç‚¹')
ax.grid(True, alpha=0.3)
ax.set_xlabel('ä½ç½® x', fontsize=12)
ax.set_ylabel('é›»å­å¯†åº¦ Ï(x)', fontsize=12)
ax.set_title(f'å®Ÿç©ºé–“: 1æ¬¡å…ƒçµæ™¶ï¼ˆæ ¼å­å®šæ•° a={a}ï¼‰', fontsize=12)
ax.legend()
ax.set_xlim(0, 10*a)

# é€†ç©ºé–“: æ§‹é€ å› å­
ax = axes[1]
ax.plot(k, np.abs(structure_factor), 'g-', linewidth=2)
# ãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯ã®ä½ç½®
k_bragg = 2*np.pi * np.arange(-5, 6) / a
for kb in k_bragg:
    if abs(kb) < np.max(k):
        ax.axvline(kb, color='red', linestyle='--', alpha=0.3)
ax.grid(True, alpha=0.3)
ax.set_xlabel('é€†æ ¼å­ãƒ™ã‚¯ãƒˆãƒ« k (2Ï€/a)', fontsize=12)
ax.set_ylabel('|F(k)|', fontsize=12)
ax.set_title('é€†ç©ºé–“: æ§‹é€ å› å­', fontsize=12)
ax.set_xlim(-30, 30)

# å›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³
ax = axes[2]
ax.plot(k, diffraction_intensity, 'purple', linewidth=2)
# ãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯
for kb in k_bragg:
    if abs(kb) < np.max(k):
        ax.axvline(kb, color='red', linestyle='--', alpha=0.5, label='Bragg peaks' if kb == k_bragg[5] else '')
ax.grid(True, alpha=0.3)
ax.set_xlabel('é€†æ ¼å­ãƒ™ã‚¯ãƒˆãƒ« k (2Ï€/a)', fontsize=12)
ax.set_ylabel('å›æŠ˜å¼·åº¦ |F(k)|Â²', fontsize=12)
ax.set_title('Xç·šå›æŠ˜ãƒ‘ã‚¿ãƒ¼ãƒ³', fontsize=12)
ax.set_xlim(-30, 30)
ax.legend()

plt.suptitle('1æ¬¡å…ƒçµæ™¶ã®Xç·šå›æŠ˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', fontsize=14)
plt.tight_layout()
plt.show()

print("=== Xç·šå›æŠ˜ã®è§£æ ===")
print(f"æ ¼å­å®šæ•°: a = {a}")
print(f"ãƒ¦ãƒ‹ãƒƒãƒˆã‚»ãƒ«æ•°: N = {N_unit_cells}")
print(f"\nãƒ–ãƒ©ãƒƒã‚°ã®æ¡ä»¶: k = 2Ï€n/a (n = æ•´æ•°)")
print(f"ç¬¬1ãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯: k = {2*np.pi/a:.2f}")
print(f"ç¬¬2ãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯: k = {4*np.pi/a:.2f}")
print(f"ç¬¬3ãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯: k = {6*np.pi/a:.2f}")

print("\nç‰©ç†çš„è§£é‡ˆ:")
print("- å®Ÿç©ºé–“ã®å‘¨æœŸæ§‹é€  â†’ é€†ç©ºé–“ã®é›¢æ•£çš„ãªãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯")
print("- æ ¼å­å®šæ•° a ãŒå¤§ãã„ â†’ ãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯é–“éš”ãŒå°ã•ã„")
print("- çµæ™¶ã‚µã‚¤ã‚ºï¼ˆNã‚»ãƒ«ï¼‰ãŒå¤§ãã„ â†’ ãƒ–ãƒ©ãƒƒã‚°ãƒ”ãƒ¼ã‚¯ãŒã‚·ãƒ£ãƒ¼ãƒ—")</code></pre>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>ğŸ“ ç« æœ«å•é¡Œ</h2>
                    <div class="exercise-box">
                        <h4>æ¼”ç¿’å•é¡Œ</h4>
                        <ol>
                            <li>æ–¹å½¢æ³¢ã®ãƒ•ãƒ¼ãƒªã‚¨ç´šæ•°å±•é–‹ã‚’10æ¬¡ã¾ã§æ±‚ã‚ã€ã‚®ãƒ–ã‚¹ç¾è±¡ã‚’è¦³å¯Ÿã›ã‚ˆã€‚</li>
                            <li>Gaussiané–¢æ•° $f(t) = e^{-t^2/(2\sigma^2)}$ ã®ãƒ•ãƒ¼ãƒªã‚¨å¤‰æ›ã‚’è¨ˆç®—ã—ã€è‡ªå·±åŒå¯¾æ€§ã‚’ç¢ºèªã›ã‚ˆã€‚</li>
                            <li>ç•³ã¿è¾¼ã¿å®šç†ã‚’ä½¿ã£ã¦ã€2ã¤ã®ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã®ç¸¦ç¶šæ¥ç¶šã®å‘¨æ³¢æ•°å¿œç­”ã‚’æ±‚ã‚ã‚ˆã€‚</li>
                            <li>ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã‚’ä½¿ã£ã¦ã€å¾®åˆ†æ–¹ç¨‹å¼ $y'' + 2y' + 2y = \sin(t)$, $y(0)=0$, $y'(0)=1$ ã‚’è§£ã‘ã€‚</li>
                        </ol>
                    </div>
                </section>

                <section class="chapter-section">
                    <h2>ğŸ”— å‚è€ƒæ–‡çŒ®</h2>
                    <ul class="reference-list">
                        <li>Bracewell, R. N. (1986). <em>The Fourier Transform and Its Applications</em>. McGraw-Hill.</li>
                        <li>Oppenheim, A. V., & Schafer, R. W. (2009). <em>Discrete-Time Signal Processing</em>. Prentice Hall.</li>
                    </ul>
                </section>
            </article>

            <nav class="chapter-navigation">
                <a href="chapter-3.html" class="btn btn-secondary">â† ç¬¬3ç« ã¸</a>
                <a href="chapter-5.html" class="btn btn-primary">ç¬¬5ç« ã¸ â†’</a>
            </nav>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2025 AI Terakoya. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
