# FM配下（基礎数理）コンテンツ 改善案
最終更新: 自動生成（本レポートは wp/knowledge/jp/FM を対象）

## 1. 現状サマリ
- ディレクトリ: 12シリーズ（解析・線形代数・確率/統計・熱力学・量子力学・偏微分方程式 等）
- 主要ファイル: 各シリーズの index.html と chapter-*.html（または chapter*.html）
- Mermaid: 現状エラーなし（wp 全体検査で 556図/エラー0）
- リンク整合性: FM配下で 40件のリンク切れを検出（詳細は下記）

## 2. 問題点（検出結果）
1) 相対リンクが浅すぎる/深すぎる（トップ・CSS 参照）
- 例: `../../../index.html`（存在しない）、`../../../../assets/css/*.css`（存在しない）
- 影響ファイル:
  - numerical-analysis-fundamentals/chapter-[1-5].html
  - complex-special-functions/chapter-2.html（複数の CSS 相対参照）
  - pde-numerical-methods/chapter[1-5].html（../../assets/css/style.css）

2) シリーズ index からの章リンクが未実装/不一致
- 例: computational-statistical-mechanics/index.html → `chapter-1.html`（実体: chapter1.html など命名揺れ）
- 該当シリーズ: computational-statistical-mechanics, non-equilibrium-statistical-mechanics, pde-numerical-methods など

3) 命名規則の不統一（chapter-1.html / chapter1.html）
- 同一シリーズ内で命名が混在し、index からの参照が合致していない箇所あり

4) テンプレート差（ヘッダ/フッタ/ナビ/メタタグの不統一）
- シリーズにより CSS の当て方、ナビゲーション、メタ（description/title）などの品質に差

5) 数式表示の安定性（MathJax 初期化の有無）
- 数式を含むシリーズで MathJax 初期化がない/不統一な可能性（要横断確認）

## 3. 優先度と方針
- A（最優先）: リンク切れの是正（学習遷移に直結）
- B: 命名規則の統一と index → 章リンクの自動補正
- C: CSS/JS の参照方法の統一（絶対パス化）
- D: ヘッダ/フッタ/ナビ/メタのテンプレート統一
- E: MathJax/アクセシビリティ/SEO のベースライン揃え

## 4. 具体的な改善案
### 4.1 リンク方針（絶対パス化）
- ルート固定で参照の安定性を上げる:
  - トップ: `/index.html` に統一
  - CSS: `/assets/css/*.css` に統一
  - 共通JS/画像: `/assets/js/*.js`, `/assets/images/*` 等に統一
- 理由: ディレクトリ階層が深いシリーズでの相対パス崩れを防止

### 4.2 章ファイルの命名規則と index からの参照
- 規則: `chapter-1.html`〜`chapter-5.html` に統一（ハイフン区切り）
- 既存ファイルが `chapter1.html` の場合:
  - いずれかに統一（推奨: chapter-1.html 形式）
  - 移行期間は index 側のリンクを実体に合わせて自動補正
- 自動補正ロジック（例）:
  - index.html 内の `./chapter-N.html` をシリーズ内の最初に一致する `chapterN-*.html` or `chapter-N*.html` に置換

### 4.3 「未実装章」への対応
- シリーズ index に章リンクがあるが章が未生成のケース:
  - Plan 1: `chapter-N.html`（準備中）を自動生成（テンプレ: タイトル/概要/戻るリンク）
  - Plan 2: index で該当章のリンクを無効化（薄字/リンク無効＋「準備中」ラベル）

### 4.4 テンプレート統一（最低限）
- ヘッダ: タイトル、サブタイトル、meta description
- Mermaid: `<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>` + `mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });`
- MathJax（数式があるシリーズ）:
  ```html
  <script>
    MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  ```
- ナビ: 前へ/シリーズ目次へ/次へ の3ボタン（相対リンクは index ベースで自動生成）
- フッタ: 著作権・ライセンス・更新日

### 4.5 アクセシビリティ/SEO
- 画像の alt、リンクの title、見出しの階層（h1→h2→h3…）
- テーブルの thead/tbody 分離、scope 属性（可能なら）
- meta description を各章に設定（シリーズ index の要約でも可）

## 5. 自動化スクリプト案（最小セット）
- 5.1 絶対パス一括置換（HTML）
  - `../../../index.html` → `/index.html`
  - `../../../../assets/css/*.css`、`../../assets/css/style.css` → `/assets/css/style.css` 等
- 5.2 章リンク補正（index.html毎）
  - `./chapter-N.html` をシリーズ内の `chapter-N*.html`（または `chapterN-*.html`）に置換
- 5.3 未実装章のプレースホルダ生成
  - `chapter-N.html` が存在しなければ、最低限の「準備中」ページを生成
- 5.4 Mermaidプレーン化
  - もし `<pre class="mermaid">` が残っていれば div.mermaid 内のプレーンテキスト化＋`<br>`→`\n` 置換

## 6. 対象シリーズ別の改善ポイント（抜粋）
- numerical-analysis-fundamentals
  - `../../../assets/css/style.css`, `../../../index.html` を絶対パスに変更
- complex-special-functions
  - 複数 CSS の相対参照（../../../../assets/css/*.css）→ 絶対パス化
  - `../../../../index.html` → `/index.html`
- pde-numerical-methods
  - chapter1〜5.html の CSS 相対参照（../../assets/css/style.css）→ 絶対パス化
  - index からの `chapter-*.html` リンクを実体に合わせて補正
- computational-statistical-mechanics / non-equilibrium-statistical-mechanics
  - index の `chapter-*.html` → 実体（chapter1.html 等）に合わせて暫定補正
  - 将来的に命名規則を統一（再生成）
- その他各シリーズ
  - index の章リンクを自動検査・補正（存在しない場合は準備中ページ生成）

## 7. 実施順序（推奨）
1) 一括置換: トップ/アセット参照を絶対パス化
2) 章リンク補正: index → 実ファイル名に合わせて更新
3) 準備中プレースホルダの生成（必要な章のみ）
4) Mermaid/MathJax 初期化のテンプレ統一（数式ありシリーズのみ MathJax 追加）
5) ナビ/フッタ/メタ/アクセシビリティの最小整備

## 8. 検証とゲート
- Mermaid検査（既存の validate_mermaid.py）→ エラー0継続
- リンク検査（ローカル相対リンク解決スクリプト）→ 0件目標
- 表示確認: ローカルHTTP（`python -m http.server 8000`）でFM配下を横断確認

## 9. リスクと回避
- 相対→絶対パス化で、GitHub Pages 基準パスとの不整合リスク
  - リポジトリ直下公開なら `/assets/*` で安全（サブディレクトリ公開の場合は `/<repo-name>/assets/*` に変更）
- 命名統一時の既存リンク切れ
  - 段階的に index 側参照を実体に合わせつつ、最終的に命名再生成

## 10. まとめ
- まずはリンク切れと相対パス崩れの是正（A/B）で学習遷移の詰まりを解消。
- 次にテンプレート/初期化/アクセシビリティ等（C/D/E）を段階的に揃え、シリーズ間の品質差を縮小。
- 自動検証を継続し、FM配下の安定運用を目指す。
