<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç« : é‡å­åŒ–å­¦è¨ˆç®—ã®å®Ÿè·µ | é‡å­åŒ–å­¦å…¥é–€</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8;
            color: #333;
            background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .content-box {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #667eea;
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #667eea;
        }
        h3 {
            color: #764ba2;
            margin: 1.5rem 0 1rem 0;
        }
        .theory-box {
            background: #f8f9ff;
            padding: 1.5rem;
            border-left: 4px solid #667eea;
            margin: 1.5rem 0;
        }
        .code-example {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .code-comment { color: #6a9955; }
        .code-keyword { color: #569cd6; }
        .code-string { color: #ce9178; }
        .code-function { color: #dcdcaa; }
        .code-number { color: #b5cea8; }
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
        }
        .nav-button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: transform 0.3s;
        }
        .nav-button:hover { transform: translateY(-2px); }
        ul, ol { margin-left: 2rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
        .exercise {
            background: #fff9e6;
            padding: 1.5rem;
            border-left: 4px solid #ffc107;
            margin: 1.5rem 0;
        }
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 4rem;
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>
</head>
<body>
            <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="../../MI/index.html">ãƒãƒ†ãƒªã‚¢ãƒ«ã‚ºãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹</a><span class="breadcrumb-separator">â€º</span><a href="../../MI/quantum-chemistry-introduction/index.html">Quantum Chemistry</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 5</span>
        </div>
    </nav>

        <header>
        <h1>ç¬¬5ç« : é‡å­åŒ–å­¦è¨ˆç®—ã®å®Ÿè·µ</h1>
        <p class="subtitle">Practical Quantum Chemistry Calculations</p>
    </header>

    <div class="container">
        <div class="nav-buttons">
            <a href="chapter-4.html" class="nav-button">â† ç¬¬4ç« : å¯†åº¦æ±é–¢æ•°ç†è«–</a>
            <a href="index.html" class="nav-button">ç›®æ¬¡ã«æˆ»ã‚‹</a>
        </div>

        <div class="content-box">
            <h2>5.1 PySCFã«ã‚ˆã‚‹åˆ†å­è¨ˆç®—</h2>

            <div class="theory-box">
                <h3>ğŸ“š PySCFã¨ã¯</h3>
                <p><strong>PySCF (Python-based Simulations of Chemistry Framework)</strong>ã¯ã€é‡å­åŒ–å­¦è¨ˆç®—ã®ãŸã‚ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚</p>
                <ul>
                    <li><strong>Hartree-Fockæ³•</strong>: RHF, UHF, ROHF</li>
                    <li><strong>DFT</strong>: å¤šæ§˜ãªäº¤æ›ç›¸é–¢æ±é–¢æ•°ï¼ˆLDA, GGA, hybridï¼‰</li>
                    <li><strong>Post-HFæ³•</strong>: MP2, CCSD, CI</li>
                    <li><strong>åŠ±èµ·çŠ¶æ…‹</strong>: TD-DFT, EOM-CCSD</li>
                    <li><strong>å›ºä½“è¨ˆç®—</strong>: PBC (Periodic Boundary Conditions)</li>
                </ul>
            </div>

            <h3>æ°´åˆ†å­ã®Hartree-Fockè¨ˆç®—</h3>
            <p>PySCFã§æ°´åˆ†å­ï¼ˆHâ‚‚Oï¼‰ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨åˆ†å­è»Œé“ã‚’è¨ˆç®—ã—ã¾ã™ã€‚</p>

            <div class="code-example">
<span class="code-keyword">import</span> numpy <span class="code-keyword">as</span> np
<span class="code-keyword">import</span> matplotlib.pyplot <span class="code-keyword">as</span> plt
<span class="code-keyword">from</span> scipy.linalg <span class="code-keyword">import</span> eigh

<span class="code-comment"># PySCFäº’æ›ã®ãƒŸãƒ‹ãƒãƒ«å®Ÿè£…ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰</span>
<span class="code-keyword">class</span> <span class="code-function">WaterMoleculeHF</span>:
    <span class="code-string">"""æ°´åˆ†å­ã®Hartree-Fockè¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰"""</span>
    <span class="code-keyword">def</span> <span class="code-function">__init__</span>(self, basis=<span class="code-string">'sto-3g'</span>):
        <span class="code-comment"># æ°´åˆ†å­ã®æ§‹é€ ï¼ˆO-Hè·é›¢0.96Ã…, H-O-Hè§’104.5Â°ï¼‰</span>
        self.atoms = [
            (<span class="code-string">'O'</span>, [<span class="code-number">0.0</span>, <span class="code-number">0.0</span>, <span class="code-number">0.0</span>]),
            (<span class="code-string">'H'</span>, [<span class="code-number">0.0</span>, <span class="code-number">0.757</span>, <span class="code-number">0.587</span>]),
            (<span class="code-string">'H'</span>, [<span class="code-number">0.0</span>, -<span class="code-number">0.757</span>, <span class="code-number">0.587</span>])
        ]
        self.n_electrons = <span class="code-number">10</span>  <span class="code-comment"># 8(O) + 1(H) + 1(H)</span>
        self.n_basis = <span class="code-number">7</span>      <span class="code-comment"># STO-3G: O(5) + H(1) + H(1)</span>

    <span class="code-keyword">def</span> <span class="code-function">compute_integrals</span>(self):
        <span class="code-string">"""ç©åˆ†è¡Œåˆ—ã®è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰"""</span>
        <span class="code-comment"># é‡ãªã‚Šç©åˆ†è¡Œåˆ—ï¼ˆå¯¾è§’åŒ–ã§å˜ä½è¡Œåˆ—ã«è¿‘ã„å½¢ï¼‰</span>
        S = np.eye(self.n_basis)
        <span class="code-keyword">for</span> i <span class="code-keyword">in</span> range(self.n_basis):
            <span class="code-keyword">for</span> j <span class="code-keyword">in</span> range(i+<span class="code-number">1</span>, self.n_basis):
                S[i,j] = S[j,i] = <span class="code-number">0.2</span> * np.exp(-<span class="code-number">0.5</span> * (i-j)**<span class="code-number">2</span>)

        <span class="code-comment"># ã‚³ã‚¢ãƒãƒŸãƒ«ãƒˆãƒ‹ã‚¢ãƒ³ï¼ˆé‹å‹•ã‚¨ãƒãƒ«ã‚®ãƒ¼ + æ ¸-é›»å­å¼•åŠ›ï¼‰</span>
        H_core = -np.diag([<span class="code-number">20.0</span>, <span class="code-number">15.0</span>, <span class="code-number">15.0</span>, <span class="code-number">15.0</span>, <span class="code-number">15.0</span>, <span class="code-number">7.0</span>, <span class="code-number">7.0</span>])

        <span class="code-comment"># 2é›»å­ç©åˆ†ï¼ˆç°¡æ˜“ç‰ˆï¼‰</span>
        g = np.zeros((self.n_basis, self.n_basis, self.n_basis, self.n_basis))
        <span class="code-keyword">for</span> i <span class="code-keyword">in</span> range(self.n_basis):
            <span class="code-keyword">for</span> j <span class="code-keyword">in</span> range(self.n_basis):
                g[i,i,j,j] = <span class="code-number">10.0</span> / (i+j+<span class="code-number">2</span>)
                g[i,j,i,j] = <span class="code-number">8.0</span> / (i+j+<span class="code-number">3</span>)

        <span class="code-keyword">return</span> S, H_core, g

    <span class="code-keyword">def</span> <span class="code-function">build_fock</span>(self, P, H_core, g):
        <span class="code-string">"""Fockè¡Œåˆ—ã®æ§‹ç¯‰"""</span>
        F = H_core.copy()
        <span class="code-keyword">for</span> i <span class="code-keyword">in</span> range(self.n_basis):
            <span class="code-keyword">for</span> j <span class="code-keyword">in</span> range(self.n_basis):
                <span class="code-keyword">for</span> k <span class="code-keyword">in</span> range(self.n_basis):
                    <span class="code-keyword">for</span> l <span class="code-keyword">in</span> range(self.n_basis):
                        F[i,j] += P[k,l] * (g[i,j,k,l] - <span class="code-number">0.5</span> * g[i,k,j,l])
        <span class="code-keyword">return</span> F

    <span class="code-keyword">def</span> <span class="code-function">run_scf</span>(self, max_iter=<span class="code-number">30</span>, conv=<span class="code-number">1e-6</span>):
        <span class="code-string">"""SCFè¨ˆç®—"""</span>
        S, H_core, g = self.compute_integrals()

        <span class="code-comment"># åˆæœŸå¯†åº¦è¡Œåˆ—</span>
        P = np.zeros((self.n_basis, self.n_basis))
        E_old = <span class="code-number">0.0</span>
        energies = []

        <span class="code-keyword">for</span> iteration <span class="code-keyword">in</span> range(max_iter):
            <span class="code-comment"># Fockè¡Œåˆ—æ§‹ç¯‰</span>
            F = self.build_fock(P, H_core, g)

            <span class="code-comment"># ä¸€èˆ¬åŒ–å›ºæœ‰å€¤å•é¡Œ</span>
            epsilon, C = eigh(F, S)

            <span class="code-comment"># å¯†åº¦è¡Œåˆ—æ›´æ–°ï¼ˆ10é›»å­ = 5å æœ‰è»Œé“ï¼‰</span>
            n_occ = self.n_electrons // <span class="code-number">2</span>
            P_new = <span class="code-number">2</span> * C[:, :n_occ] @ C[:, :n_occ].T

            <span class="code-comment"># ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—</span>
            E_elec = np.sum(P_new * (H_core + F)) / <span class="code-number">2</span>
            E_nuc = <span class="code-number">9.0</span>  <span class="code-comment"># æ ¸é–“åç™ºï¼ˆç°¡æ˜“å€¤ï¼‰</span>
            E_total = E_elec + E_nuc
            energies.append(E_total)

            <span class="code-comment"># åæŸåˆ¤å®š</span>
            <span class="code-keyword">if</span> np.abs(E_total - E_old) < conv:
                <span class="code-keyword">print</span>(<span class="code-string">f"SCFåæŸ: {iteration+1}åå¾©"</span>)
                <span class="code-keyword">break</span>

            E_old = E_total
            P = P_new

        <span class="code-keyword">return</span> E_total, epsilon, C, energies

<span class="code-comment"># æ°´åˆ†å­ã®HFè¨ˆç®—å®Ÿè¡Œ</span>
h2o = WaterMoleculeHF()
E_total, epsilon, C, energies = h2o.run_scf()

<span class="code-comment"># å¯è¦–åŒ–</span>
fig, axes = plt.subplots(<span class="code-number">2</span>, <span class="code-number">2</span>, figsize=(<span class="code-number">12</span>, <span class="code-number">10</span>))

<span class="code-comment"># (1) SCFåæŸ</span>
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].plot(energies, <span class="code-string">'o-'</span>, linewidth=<span class="code-number">2</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Iteration'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Energy (Hartree)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'SCF Convergence'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># (2) è»Œé“ã‚¨ãƒãƒ«ã‚®ãƒ¼æº–ä½</span>
n_occ = h2o.n_electrons // <span class="code-number">2</span>
colors = [<span class="code-string">'blue'</span> <span class="code-keyword">if</span> i < n_occ <span class="code-keyword">else</span> <span class="code-string">'red'</span> <span class="code-keyword">for</span> i <span class="code-keyword">in</span> range(h2o.n_basis)]
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].barh(range(h2o.n_basis), epsilon, color=colors, alpha=<span class="code-number">0.7</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].axvline(<span class="code-number">0</span>, color=<span class="code-string">'black'</span>, linestyle=<span class="code-string">'--'</span>, alpha=<span class="code-number">0.5</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_xlabel(<span class="code-string">'Energy (Hartree)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_ylabel(<span class="code-string">'Orbital Index'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_title(<span class="code-string">'Orbital Energy Levels'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].legend([<span class="code-string">'Occupied'</span>, <span class="code-string">'Virtual'</span>], loc=<span class="code-string">'best'</span>)

<span class="code-comment"># (3) HOMO-LUMOä¿‚æ•°</span>
homo_idx = n_occ - <span class="code-number">1</span>
lumo_idx = n_occ
x = np.arange(h2o.n_basis)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].bar(x - <span class="code-number">0.2</span>, C[:, homo_idx], width=<span class="code-number">0.4</span>, label=<span class="code-string">'HOMO'</span>, alpha=<span class="code-number">0.8</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].bar(x + <span class="code-number">0.2</span>, C[:, lumo_idx], width=<span class="code-number">0.4</span>, label=<span class="code-string">'LUMO'</span>, alpha=<span class="code-number">0.8</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Basis Function'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Coefficient'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'HOMO-LUMO Molecular Orbitals'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].legend()
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>, axis=<span class="code-string">'y'</span>)

<span class="code-comment"># (4) è¨ˆç®—çµæœã‚µãƒãƒªãƒ¼</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].axis(<span class="code-string">'off'</span>)
summary = <span class="code-string">f"""
Hâ‚‚O Hartree-Fock Calculation

Total Energy:  {E_total:.6f} Hartree
               {E_total * 27.211:.2f} eV

HOMO Energy:   {epsilon[homo_idx]:.6f} Hartree
LUMO Energy:   {epsilon[lumo_idx]:.6f} Hartree
HOMO-LUMO Gap: {(epsilon[lumo_idx] - epsilon[homo_idx]) * 27.211:.2f} eV

Basis Set:     STO-3G
Electrons:     {h2o.n_electrons}
Basis Funcs:   {h2o.n_basis}
"""</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].text(<span class="code-number">0.1</span>, <span class="code-number">0.5</span>, summary, fontsize=<span class="code-number">11</span>, family=<span class="code-string">'monospace'</span>,
                   verticalalignment=<span class="code-string">'center'</span>)

plt.tight_layout()
plt.savefig(<span class="code-string">'water_hf_calculation.png'</span>, dpi=<span class="code-number">150</span>, bbox_inches=<span class="code-string">'tight'</span>)
plt.show()

<span class="code-keyword">print</span>(<span class="code-string">f"Hâ‚‚O Total Energy: {E_total:.6f} Hartree"</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"HOMO-LUMO Gap: {(epsilon[lumo_idx] - epsilon[homo_idx]) * 27.211:.2f} eV"</span>)
</div>

            <h3>DFTè¨ˆç®—ã¨ã®æ¯”è¼ƒ</h3>
            <p>åŒã˜æ°´åˆ†å­ã‚’DFTï¼ˆB3LYPæ±é–¢æ•°ï¼‰ã§è¨ˆç®—ã—ã€HFæ³•ã¨æ¯”è¼ƒã—ã¾ã™ã€‚</p>

            <div class="code-example">
<span class="code-keyword">class</span> <span class="code-function">WaterMoleculeDFT</span>(WaterMoleculeHF):
    <span class="code-string">"""æ°´åˆ†å­ã®DFTè¨ˆç®—ï¼ˆB3LYPç°¡æ˜“ç‰ˆï¼‰"""</span>
    <span class="code-keyword">def</span> <span class="code-function">__init__</span>(self, functional=<span class="code-string">'b3lyp'</span>):
        <span class="code-keyword">super</span>().__init__()
        self.functional = functional

    <span class="code-keyword">def</span> <span class="code-function">xc_energy</span>(self, rho):
        <span class="code-string">"""äº¤æ›ç›¸é–¢ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆB3LYPè¿‘ä¼¼ï¼‰"""</span>
        <span class="code-comment"># LDA exchange</span>
        C_x = (<span class="code-number">3</span>/<span class="code-number">4</span>) * (<span class="code-number">3</span>/np.pi)**(<span class="code-number">1</span>/<span class="code-number">3</span>)
        E_x_lda = -C_x * rho**(<span class="code-number">4</span>/<span class="code-number">3</span>)

        <span class="code-comment"># GGA correction (gradient approximation)</span>
        E_x_gga = E_x_lda * (<span class="code-number">1.0</span> + <span class="code-number">0.1</span> * rho**(<span class="code-number">1</span>/<span class="code-number">3</span>))

        <span class="code-comment"># B3LYP mixing (20% HF + 80% DFT)</span>
        E_xc = <span class="code-number">0.8</span> * E_x_gga

        <span class="code-keyword">return</span> E_xc

    <span class="code-keyword">def</span> <span class="code-function">build_fock_dft</span>(self, P, H_core, g):
        <span class="code-string">"""Kohn-Sham Fockè¡Œåˆ—"""</span>
        F = H_core.copy()

        <span class="code-comment"># Coulomb + Exchange</span>
        <span class="code-keyword">for</span> i <span class="code-keyword">in</span> range(self.n_basis):
            <span class="code-keyword">for</span> j <span class="code-keyword">in</span> range(self.n_basis):
                <span class="code-keyword">for</span> k <span class="code-keyword">in</span> range(self.n_basis):
                    <span class="code-keyword">for</span> l <span class="code-keyword">in</span> range(self.n_basis):
                        <span class="code-comment"># Coulomb</span>
                        F[i,j] += P[k,l] * g[i,j,k,l]
                        <span class="code-comment"># Exchange (20% HF for B3LYP)</span>
                        F[i,j] -= <span class="code-number">0.2</span> * P[k,l] * g[i,k,j,l]

        <span class="code-comment"># XC potential (simplified)</span>
        rho = np.diag(P)
        V_xc = self.xc_energy(rho + <span class="code-number">1e-10</span>)
        F += np.diag(V_xc)

        <span class="code-keyword">return</span> F

    <span class="code-keyword">def</span> <span class="code-function">run_dft</span>(self, max_iter=<span class="code-number">30</span>, conv=<span class="code-number">1e-6</span>):
        <span class="code-string">"""DFT-SCFè¨ˆç®—"""</span>
        S, H_core, g = self.compute_integrals()
        P = np.zeros((self.n_basis, self.n_basis))
        E_old = <span class="code-number">0.0</span>
        energies = []

        <span class="code-keyword">for</span> iteration <span class="code-keyword">in</span> range(max_iter):
            F = self.build_fock_dft(P, H_core, g)
            epsilon, C = eigh(F, S)

            n_occ = self.n_electrons // <span class="code-number">2</span>
            P_new = <span class="code-number">2</span> * C[:, :n_occ] @ C[:, :n_occ].T

            E_elec = np.sum(P_new * (H_core + F)) / <span class="code-number">2</span>
            E_nuc = <span class="code-number">9.0</span>
            E_total = E_elec + E_nuc
            energies.append(E_total)

            <span class="code-keyword">if</span> np.abs(E_total - E_old) < conv:
                <span class="code-keyword">print</span>(<span class="code-string">f"DFT-SCFåæŸ: {iteration+1}åå¾©"</span>)
                <span class="code-keyword">break</span>

            E_old = E_total
            P = P_new

        <span class="code-keyword">return</span> E_total, epsilon, C, energies

<span class="code-comment"># DFTè¨ˆç®—å®Ÿè¡Œ</span>
h2o_dft = WaterMoleculeDFT()
E_dft, eps_dft, C_dft, energies_dft = h2o_dft.run_dft()

<span class="code-comment"># HF vs DFT æ¯”è¼ƒ</span>
<span class="code-keyword">print</span>(<span class="code-string">f"\n=== Hâ‚‚O Energy Comparison ==="</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"HF  Energy: {E_total:.6f} Hartree"</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"DFT Energy: {E_dft:.6f} Hartree"</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"Difference: {(E_dft - E_total)*1000:.2f} mHartree"</span>)

n_occ = h2o.n_electrons // <span class="code-number">2</span>
homo_hf = epsilon[n_occ-<span class="code-number">1</span>]
lumo_hf = epsilon[n_occ]
homo_dft = eps_dft[n_occ-<span class="code-number">1</span>]
lumo_dft = eps_dft[n_occ]

<span class="code-keyword">print</span>(<span class="code-string">f"\nHOMO-LUMO Gap:"</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"HF:  {(lumo_hf - homo_hf)*27.211:.2f} eV"</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"DFT: {(lumo_dft - homo_dft)*27.211:.2f} eV"</span>)
</div>

            <h2>5.2 æ§‹é€ æœ€é©åŒ–ã¨æŒ¯å‹•è§£æ</h2>

            <div class="theory-box">
                <h3>ğŸ“š ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚¨ãƒãƒ«ã‚®ãƒ¼æ›²é¢</h3>
                <p><strong>æ§‹é€ æœ€é©åŒ–</strong>ã¯ã€ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚¨ãƒãƒ«ã‚®ãƒ¼æ›²é¢ï¼ˆPESï¼‰ä¸Šã§æœ€å°ã‚¨ãƒãƒ«ã‚®ãƒ¼æ§‹é€ ã‚’æ¢ç´¢ã™ã‚‹éç¨‹ã§ã™ã€‚</p>
                <p>ã‚¨ãƒãƒ«ã‚®ãƒ¼å‹¾é…:</p>
                <p>\[
                \mathbf{g}_I = -\frac{\partial E}{\partial \mathbf{R}_I}
                \]</p>
                <p>åŠ›ãŒ0ã«ãªã‚‹ç‚¹ï¼ˆ\(\mathbf{g}_I = 0\)ï¼‰ãŒå®‰å®šæ§‹é€ ã§ã™ã€‚</p>
            </div>

            <h3>æ°´ç´ åˆ†å­ã®çµåˆè·é›¢æœ€é©åŒ–</h3>
            <p>Hâ‚‚åˆ†å­ã®çµåˆè·é›¢ã‚’æœ€é©åŒ–ã—ã€å¹³è¡¡æ§‹é€ ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ±‚ã‚ã¾ã™ã€‚</p>

            <div class="code-example">
<span class="code-keyword">from</span> scipy.optimize <span class="code-keyword">import</span> minimize

<span class="code-keyword">def</span> <span class="code-function">h2_energy</span>(R):
    <span class="code-string">"""Hâ‚‚åˆ†å­ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆMorse potentialè¿‘ä¼¼ï¼‰"""</span>
    D_e = <span class="code-number">4.75</span>  <span class="code-comment"># eV</span>
    alpha = <span class="code-number">1.44</span>  <span class="code-comment"># Ã…â»Â¹</span>
    R_e = <span class="code-number">0.741</span>  <span class="code-comment"># Ã…</span>

    E = D_e * ((<span class="code-number">1</span> - np.exp(-alpha * (R - R_e)))**<span class="code-number">2</span> - <span class="code-number">1</span>)
    <span class="code-keyword">return</span> E

<span class="code-keyword">def</span> <span class="code-function">h2_gradient</span>(R):
    <span class="code-string">"""ã‚¨ãƒãƒ«ã‚®ãƒ¼å‹¾é…"""</span>
    D_e = <span class="code-number">4.75</span>
    alpha = <span class="code-number">1.44</span>
    R_e = <span class="code-number">0.741</span>

    exp_term = np.exp(-alpha * (R - R_e))
    dE_dR = <span class="code-number">2</span> * D_e * alpha * (<span class="code-number">1</span> - exp_term) * exp_term
    <span class="code-keyword">return</span> dE_dR

<span class="code-comment"># æ§‹é€ æœ€é©åŒ–ï¼ˆåˆæœŸå€¤: R=1.0Ã…ï¼‰</span>
result = minimize(h2_energy, x0=[<span class="code-number">1.0</span>], method=<span class="code-string">'BFGS'</span>, jac=h2_gradient)

R_opt = result.x[<span class="code-number">0</span>]
E_opt = result.fun

<span class="code-keyword">print</span>(<span class="code-string">f"æœ€é©åŒ–çµæœ:"</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"  å¹³è¡¡è·é›¢: {R_opt:.4f} Ã…"</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"  çµåˆã‚¨ãƒãƒ«ã‚®ãƒ¼: {E_opt:.4f} eV"</span>)

<span class="code-comment"># ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«æ›²ç·šã¨PES</span>
R_range = np.linspace(<span class="code-number">0.3</span>, <span class="code-number">3.0</span>, <span class="code-number">100</span>)
E_range = [h2_energy(r) <span class="code-keyword">for</span> r <span class="code-keyword">in</span> R_range]

fig, axes = plt.subplots(<span class="code-number">2</span>, <span class="code-number">2</span>, figsize=(<span class="code-number">12</span>, <span class="code-number">10</span>))

<span class="code-comment"># (1) ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚¨ãƒãƒ«ã‚®ãƒ¼æ›²ç·š</span>
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].plot(R_range, E_range, <span class="code-string">'b-'</span>, linewidth=<span class="code-number">2</span>, label=<span class="code-string">'Morse Potential'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].plot(R_opt, E_opt, <span class="code-string">'ro'</span>, markersize=<span class="code-number">10</span>, label=<span class="code-string">f'Minimum: {R_opt:.3f}Ã…'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].axhline(<span class="code-number">0</span>, color=<span class="code-string">'k'</span>, linestyle=<span class="code-string">'--'</span>, alpha=<span class="code-number">0.3</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'H-H Distance (Ã…)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Energy (eV)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'Hâ‚‚ Potential Energy Curve'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].legend()
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># (2) ã‚¨ãƒãƒ«ã‚®ãƒ¼å‹¾é…</span>
gradient_range = [h2_gradient(r) <span class="code-keyword">for</span> r <span class="code-keyword">in</span> R_range]
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].plot(R_range, gradient_range, <span class="code-string">'g-'</span>, linewidth=<span class="code-number">2</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].axhline(<span class="code-number">0</span>, color=<span class="code-string">'r'</span>, linestyle=<span class="code-string">'--'</span>, linewidth=<span class="code-number">2</span>, label=<span class="code-string">'Zero gradient'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].plot(R_opt, <span class="code-number">0</span>, <span class="code-string">'ro'</span>, markersize=<span class="code-number">10</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_xlabel(<span class="code-string">'H-H Distance (Ã…)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_ylabel(<span class="code-string">'dE/dR (eV/Ã…)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_title(<span class="code-string">'Energy Gradient'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].legend()
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># (3) æŒ¯å‹•ã‚¨ãƒãƒ«ã‚®ãƒ¼æº–ä½</span>
<span class="code-comment"># MorseæŒ¯å‹•å­ã®æº–ä½</span>
omega = <span class="code-number">4401.2</span>  <span class="code-comment"># cmâ»Â¹ (Hâ‚‚æŒ¯å‹•æ•°)</span>
D_e_cm = D_e * <span class="code-number">8065.5</span>  <span class="code-comment"># eV â†’ cmâ»Â¹</span>
n_max = <span class="code-keyword">int</span>(D_e_cm / omega)

n_levels = np.arange(<span class="code-number">0</span>, min(n_max, <span class="code-number">15</span>))
E_vib = omega * (n_levels + <span class="code-number">0.5</span>) - omega**<span class="code-number">2</span> * (n_levels + <span class="code-number">0.5</span>)**<span class="code-number">2</span> / (<span class="code-number">4</span> * D_e_cm)

axes[<span class="code-number">1</span>,<span class="code-number">0</span>].barh(n_levels, E_vib / <span class="code-number">8065.5</span>, height=<span class="code-number">0.8</span>, alpha=<span class="code-number">0.7</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Vibrational Quantum Number (n)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Energy (eV)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'Vibrational Energy Levels'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>, axis=<span class="code-string">'x'</span>)

<span class="code-comment"># (4) æœ€é©åŒ–ã‚µãƒãƒªãƒ¼</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].axis(<span class="code-string">'off'</span>)
summary = <span class="code-string">f"""
Hâ‚‚ Geometry Optimization

Equilibrium Distance:  {R_opt:.4f} Ã…
Bond Energy:           {-E_opt:.4f} eV
                       {-E_opt * 96.485:.1f} kJ/mol

Vibrational Frequency: {omega:.1f} cmâ»Â¹
Zero-Point Energy:     {E_vib[0] / 8065.5:.4f} eV

Optimization Method:   BFGS
Convergence:           {result.success}
Iterations:            {result.nit}
"""</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].text(<span class="code-number">0.1</span>, <span class="code-number">0.5</span>, summary, fontsize=<span class="code-number">11</span>, family=<span class="code-string">'monospace'</span>,
                   verticalalignment=<span class="code-string">'center'</span>)

plt.tight_layout()
plt.savefig(<span class="code-string">'h2_geometry_optimization.png'</span>, dpi=<span class="code-number">150</span>, bbox_inches=<span class="code-string">'tight'</span>)
plt.show()
</div>

            <h2>5.3 åŠ±èµ·çŠ¶æ…‹è¨ˆç®—ï¼ˆTD-DFTï¼‰</h2>

            <div class="theory-box">
                <h3>ğŸ“š æ™‚é–“ä¾å­˜å¯†åº¦æ±é–¢æ•°ç†è«–</h3>
                <p><strong>TD-DFT (Time-Dependent DFT)</strong>ã¯ã€åŠ±èµ·çŠ¶æ…‹ã®é›»å­æ§‹é€ ã‚’è¨ˆç®—ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚</p>
                <p>ç·šå½¢å¿œç­”ç†è«–ã«åŸºã¥ãã€åŸºåº•çŠ¶æ…‹ã‹ã‚‰ã®åŠ±èµ·ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ±‚ã‚ã¾ã™:</p>
                <p>\[
                \omega_n = E_n - E_0
                \]</p>
                <p>å¸åã‚¹ãƒšã‚¯ãƒˆãƒ«ã€ç™ºå…‰ã‚¹ãƒšã‚¯ãƒˆãƒ«ã€å…‰åŒ–å­¦åå¿œã®è§£æã«ä½¿ã‚ã‚Œã¾ã™ã€‚</p>
            </div>

            <h3>ã‚¨ãƒãƒ¬ãƒ³åˆ†å­ã®åŠ±èµ·çŠ¶æ…‹</h3>
            <p>ã‚¨ãƒãƒ¬ãƒ³ï¼ˆCâ‚‚Hâ‚„ï¼‰ã®Ï€â†’Ï€*é·ç§»ã‚’è¨ˆç®—ã—ã€ç´«å¤–å¸åã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚</p>

            <div class="code-example">
<span class="code-keyword">class</span> <span class="code-function">EthyleneTDDFT</span>:
    <span class="code-string">"""ã‚¨ãƒãƒ¬ãƒ³åˆ†å­ã®TD-DFTè¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰"""</span>
    <span class="code-keyword">def</span> <span class="code-function">__init__</span>(self):
        self.n_occ = <span class="code-number">6</span>  <span class="code-comment"># å æœ‰è»Œé“æ•°</span>
        self.n_virt = <span class="code-number">4</span>  <span class="code-comment"># ä»®æƒ³è»Œé“æ•°</span>

        <span class="code-comment"># è»Œé“ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆå®Ÿé¨“å€¤è¿‘ä¼¼ã€Hartreeå˜ä½ï¼‰</span>
        self.epsilon_occ = np.array([-<span class="code-number">0.8</span>, -<span class="code-number">0.7</span>, -<span class="code-number">0.6</span>, -<span class="code-number">0.5</span>, -<span class="code-number">0.4</span>, -<span class="code-number">0.35</span>])
        self.epsilon_virt = np.array([<span class="code-number">0.1</span>, <span class="code-number">0.2</span>, <span class="code-number">0.3</span>, <span class="code-number">0.4</span>])

    <span class="code-keyword">def</span> <span class="code-function">compute_excitations</span>(self):
        <span class="code-string">"""ä¸€é›»å­åŠ±èµ·ã‚¨ãƒãƒ«ã‚®ãƒ¼"""</span>
        excitations = []

        <span class="code-keyword">for</span> i, e_occ <span class="code-keyword">in</span> enumerate(self.epsilon_occ):
            <span class="code-keyword">for</span> a, e_virt <span class="code-keyword">in</span> enumerate(self.epsilon_virt):
                omega = e_virt - e_occ
                <span class="code-comment"># æŒ¯å‹•å­å¼·åº¦ï¼ˆç°¡æ˜“è¿‘ä¼¼ï¼‰</span>
                f = <span class="code-number">0.1</span> * np.exp(-<span class="code-number">2</span> * (i + a))
                excitations.append({
                    <span class="code-string">'from'</span>: i,
                    <span class="code-string">'to'</span>: a,
                    <span class="code-string">'energy_hartree'</span>: omega,
                    <span class="code-string">'energy_eV'</span>: omega * <span class="code-number">27.211</span>,
                    <span class="code-string">'wavelength_nm'</span>: <span class="code-number">1239.8</span> / (omega * <span class="code-number">27.211</span>),
                    <span class="code-string">'oscillator_strength'</span>: f
                })

        <span class="code-keyword">return</span> sorted(excitations, key=<span class="code-keyword">lambda</span> x: x[<span class="code-string">'energy_eV'</span>])

    <span class="code-keyword">def</span> <span class="code-function">absorption_spectrum</span>(self, excitations, lambda_range):
        <span class="code-string">"""å¸åã‚¹ãƒšã‚¯ãƒˆãƒ«ã®è¨ˆç®—"""</span>
        spectrum = np.zeros_like(lambda_range)

        <span class="code-keyword">for</span> exc <span class="code-keyword">in</span> excitations:
            <span class="code-comment"># Lorentzian broadening</span>
            gamma = <span class="code-number">20</span>  <span class="code-comment"># nm (åŠå€¤å¹…)</span>
            lambda_0 = exc[<span class="code-string">'wavelength_nm'</span>]
            f = exc[<span class="code-string">'oscillator_strength'</span>]

            spectrum += f * (gamma / <span class="code-number">2</span>) / ((lambda_range - lambda_0)**<span class="code-number">2</span> + (gamma / <span class="code-number">2</span>)**<span class="code-number">2</span>)

        <span class="code-keyword">return</span> spectrum

<span class="code-comment"># TD-DFTè¨ˆç®—å®Ÿè¡Œ</span>
ethylene = EthyleneTDDFT()
excitations = ethylene.compute_excitations()

<span class="code-comment"># ä¸»è¦ãªåŠ±èµ·çŠ¶æ…‹ï¼ˆæŒ¯å‹•å­å¼·åº¦ > 0.01ï¼‰</span>
major_exc = [exc <span class="code-keyword">for</span> exc <span class="code-keyword">in</span> excitations <span class="code-keyword">if</span> exc[<span class="code-string">'oscillator_strength'</span>] > <span class="code-number">0.01</span>]

<span class="code-keyword">print</span>(<span class="code-string">"ä¸»è¦ãªåŠ±èµ·çŠ¶æ…‹:"</span>)
<span class="code-keyword">for</span> i, exc <span class="code-keyword">in</span> enumerate(major_exc[:<span class="code-number">5</span>], <span class="code-number">1</span>):
    <span class="code-keyword">print</span>(<span class="code-string">f"{i}. {exc['energy_eV']:.2f} eV ({exc['wavelength_nm']:.1f} nm) "</span>
          <span class="code-string">f"[{exc['from']}â†’{exc['to']}] f={exc['oscillator_strength']:.3f}"</span>)

<span class="code-comment"># ã‚¹ãƒšã‚¯ãƒˆãƒ«è¨ˆç®—</span>
lambda_range = np.linspace(<span class="code-number">100</span>, <span class="code-number">400</span>, <span class="code-number">500</span>)
spectrum = ethylene.absorption_spectrum(excitations, lambda_range)

<span class="code-comment"># å¯è¦–åŒ–</span>
fig, axes = plt.subplots(<span class="code-number">2</span>, <span class="code-number">2</span>, figsize=(<span class="code-number">12</span>, <span class="code-number">10</span>))

<span class="code-comment"># (1) è»Œé“ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ </span>
y_occ = np.arange(ethylene.n_occ)
y_virt = np.arange(ethylene.n_virt) + ethylene.n_occ + <span class="code-number">1</span>

axes[<span class="code-number">0</span>,<span class="code-number">0</span>].barh(y_occ, ethylene.epsilon_occ * <span class="code-number">27.211</span>,
                height=<span class="code-number">0.6</span>, color=<span class="code-string">'blue'</span>, alpha=<span class="code-number">0.7</span>, label=<span class="code-string">'Occupied'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].barh(y_virt, ethylene.epsilon_virt * <span class="code-number">27.211</span>,
                height=<span class="code-number">0.6</span>, color=<span class="code-string">'red'</span>, alpha=<span class="code-number">0.7</span>, label=<span class="code-string">'Virtual'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].axvline(<span class="code-number">0</span>, color=<span class="code-string">'k'</span>, linestyle=<span class="code-string">'--'</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># Ï€â†’Ï€*é·ç§»ã®çŸ¢å°</span>
homo = ethylene.n_occ - <span class="code-number">1</span>
lumo = ethylene.n_occ + <span class="code-number">1</span>
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].annotate(<span class="code-string">''</span>, xy=(ethylene.epsilon_virt[<span class="code-number">0</span>]*<span class="code-number">27.211</span>, lumo),
                    xytext=(ethylene.epsilon_occ[-<span class="code-number">1</span>]*<span class="code-number">27.211</span>, homo),
                    arrowprops=<span class="code-keyword">dict</span>(arrowstyle=<span class="code-string">'->'</span>, lw=<span class="code-number">2</span>, color=<span class="code-string">'green'</span>))
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].text(-<span class="code-number">5</span>, (homo+lumo)/<span class="code-number">2</span>, <span class="code-string">'Ï€â†’Ï€*'</span>, fontsize=<span class="code-number">12</span>, color=<span class="code-string">'green'</span>,
                fontweight=<span class="code-string">'bold'</span>)

axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Energy (eV)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Orbital Index'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'Molecular Orbital Diagram'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].legend()

<span class="code-comment"># (2) åŠ±èµ·ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«ï¼ˆã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚¹ãƒšã‚¯ãƒˆãƒ«ï¼‰</span>
energies = [exc[<span class="code-string">'energy_eV'</span>] <span class="code-keyword">for</span> exc <span class="code-keyword">in</span> major_exc]
intensities = [exc[<span class="code-string">'oscillator_strength'</span>] <span class="code-keyword">for</span> exc <span class="code-keyword">in</span> major_exc]

axes[<span class="code-number">0</span>,<span class="code-number">1</span>].stem(energies, intensities, basefmt=<span class="code-string">' '</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_xlabel(<span class="code-string">'Excitation Energy (eV)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_ylabel(<span class="code-string">'Oscillator Strength'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_title(<span class="code-string">'Excitation Spectrum'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># (3) UV-Viså¸åã‚¹ãƒšã‚¯ãƒˆãƒ«</span>
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].plot(lambda_range, spectrum, <span class="code-string">'b-'</span>, linewidth=<span class="code-number">2</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].fill_between(lambda_range, spectrum, alpha=<span class="code-number">0.3</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Wavelength (nm)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Absorbance (a.u.)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'UV-Vis Absorption Spectrum'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_xlim(<span class="code-number">100</span>, <span class="code-number">400</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># ä¸»è¦ãƒ”ãƒ¼ã‚¯ä½ç½®ã‚’æ³¨é‡ˆ</span>
max_idx = np.argmax(spectrum)
max_lambda = lambda_range[max_idx]
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].annotate(<span class="code-string">f'{max_lambda:.1f} nm'</span>,
                    xy=(max_lambda, spectrum[max_idx]),
                    xytext=(max_lambda+<span class="code-number">50</span>, spectrum[max_idx]*<span class="code-number">0.8</span>),
                    arrowprops=<span class="code-keyword">dict</span>(arrowstyle=<span class="code-string">'->'</span>, color=<span class="code-string">'red'</span>),
                    fontsize=<span class="code-number">11</span>, color=<span class="code-string">'red'</span>, fontweight=<span class="code-string">'bold'</span>)

<span class="code-comment"># (4) åŠ±èµ·çŠ¶æ…‹ã‚µãƒãƒªãƒ¼</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].axis(<span class="code-string">'off'</span>)
summary = <span class="code-string">f"""
Câ‚‚Hâ‚„ TD-DFT Excitation Analysis

Lowest Excitation:
  Energy: {major_exc[0]['energy_eV']:.2f} eV
  Wavelength: {major_exc[0]['wavelength_nm']:.1f} nm
  Type: Ï€ â†’ Ï€*
  f: {major_exc[0]['oscillator_strength']:.3f}

Max Absorption:
  Î»max: {max_lambda:.1f} nm
  Region: {'UV-C' if max_lambda < 280 else 'UV-B' if max_lambda < 315 else 'UV-A'}

Total Excitations: {len(excitations)}
Major (f>0.01): {len(major_exc)}
"""</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].text(<span class="code-number">0.1</span>, <span class="code-number">0.5</span>, summary, fontsize=<span class="code-number">11</span>, family=<span class="code-string">'monospace'</span>,
                   verticalalignment=<span class="code-string">'center'</span>)

plt.tight_layout()
plt.savefig(<span class="code-string">'ethylene_tddft.png'</span>, dpi=<span class="code-number">150</span>, bbox_inches=<span class="code-string">'tight'</span>)
plt.show()
</div>

            <h2>5.4 å›ºä½“ãƒãƒ³ãƒ‰è¨ˆç®—</h2>

            <div class="theory-box">
                <h3>ğŸ“š å‘¨æœŸå¢ƒç•Œæ¡ä»¶ã¨Blochå®šç†</h3>
                <p>å›ºä½“ã¯å‘¨æœŸçš„ãªçµæ™¶æ§‹é€ ã‚’æŒã¡ã¾ã™ã€‚<strong>Blochå®šç†</strong>ã«ã‚ˆã‚Šã€æ³¢å‹•é–¢æ•°ã¯:</p>
                <p>\[
                \psi_{n\mathbf{k}}(\mathbf{r}) = e^{i\mathbf{k}\cdot\mathbf{r}} u_{n\mathbf{k}}(\mathbf{r})
                \]</p>
                <p>ã“ã“ã§\(u_{n\mathbf{k}}\)ã¯æ ¼å­å‘¨æœŸé–¢æ•°ã§ã™ã€‚\(\mathbf{k}\)ã¯æ³¢æ•°ãƒ™ã‚¯ãƒˆãƒ«ã§ã€<strong>ãƒãƒ³ãƒ‰æ§‹é€ </strong>\(E_n(\mathbf{k})\)ã‚’å®šç¾©ã—ã¾ã™ã€‚</p>
            </div>

            <h3>1æ¬¡å…ƒå‘¨æœŸãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã®ãƒãƒ³ãƒ‰æ§‹é€ </h3>
            <p>Kronig-Penneyãƒ¢ãƒ‡ãƒ«ã§1æ¬¡å…ƒå›ºä½“ã®ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã‚’è¨ˆç®—ã—ã¾ã™ã€‚</p>

            <div class="code-example">
<span class="code-keyword">class</span> <span class="code-function">KronigPenney1D</span>:
    <span class="code-string">"""1æ¬¡å…ƒå‘¨æœŸãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆKronig-Penneyãƒ¢ãƒ‡ãƒ«ï¼‰"""</span>
    <span class="code-keyword">def</span> <span class="code-function">__init__</span>(self, a=<span class="code-number">1.0</span>, V0=<span class="code-number">10.0</span>, N_pw=<span class="code-number">21</span>):
        self.a = a        <span class="code-comment"># æ ¼å­å®šæ•°</span>
        self.V0 = V0      <span class="code-comment"># ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«æ·±ã•</span>
        self.N_pw = N_pw  <span class="code-comment"># å¹³é¢æ³¢æ•°</span>

    <span class="code-keyword">def</span> <span class="code-function">potential</span>(self, x):
        <span class="code-string">"""å‘¨æœŸãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆã‚³ã‚µã‚¤ãƒ³å‹ï¼‰"""</span>
        <span class="code-keyword">return</span> -self.V0 * np.cos(<span class="code-number">2</span> * np.pi * x / self.a)

    <span class="code-keyword">def</span> <span class="code-function">hamiltonian_matrix</span>(self, k):
        <span class="code-string">"""kç‚¹ã§ã®ãƒãƒŸãƒ«ãƒˆãƒ‹ã‚¢ãƒ³è¡Œåˆ—"""</span>
        <span class="code-comment"># å¹³é¢æ³¢åŸºåº•: exp(i(k + n*G)x), G = 2Ï€/a</span>
        G = <span class="code-number">2</span> * np.pi / self.a
        n_indices = np.arange(-self.N_pw // <span class="code-number">2</span>, self.N_pw // <span class="code-number">2</span> + <span class="code-number">1</span>)

        H = np.zeros((self.N_pw, self.N_pw), dtype=complex)

        <span class="code-keyword">for</span> i, n_i <span class="code-keyword">in</span> enumerate(n_indices):
            <span class="code-keyword">for</span> j, n_j <span class="code-keyword">in</span> enumerate(n_indices):
                k_i = k + n_i * G
                k_j = k + n_j * G

                <span class="code-keyword">if</span> i == j:
                    <span class="code-comment"># é‹å‹•ã‚¨ãƒãƒ«ã‚®ãƒ¼</span>
                    H[i,j] = <span class="code-number">0.5</span> * k_i**<span class="code-number">2</span>
                <span class="code-keyword">elif</span> abs(n_i - n_j) == <span class="code-number">1</span>:
                    <span class="code-comment"># ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ï¼ˆç¬¬ä¸€è¿‘æ¥ã®ã¿ï¼‰</span>
                    H[i,j] = -self.V0 / <span class="code-number">2</span>

        <span class="code-keyword">return</span> H

    <span class="code-keyword">def</span> <span class="code-function">compute_bands</span>(self, k_points):
        <span class="code-string">"""ãƒãƒ³ãƒ‰æ§‹é€ è¨ˆç®—"""</span>
        bands = []

        <span class="code-keyword">for</span> k <span class="code-keyword">in</span> k_points:
            H = self.hamiltonian_matrix(k)
            eigenvalues = eigh(H, eigvals_only=<span class="code-keyword">True</span>)
            bands.append(eigenvalues)

        <span class="code-keyword">return</span> np.array(bands)

<span class="code-comment"># ãƒãƒ³ãƒ‰æ§‹é€ è¨ˆç®—</span>
kp = KronigPenney1D(a=<span class="code-number">1.0</span>, V0=<span class="code-number">5.0</span>, N_pw=<span class="code-number">21</span>)

<span class="code-comment"># ç¬¬1ãƒ–ãƒªãƒ«ã‚¢ãƒ³ã‚¾ãƒ¼ãƒ³: -Ï€/a â‰¤ k â‰¤ Ï€/a</span>
k_points = np.linspace(-np.pi/kp.a, np.pi/kp.a, <span class="code-number">100</span>)
bands = kp.compute_bands(k_points)

<span class="code-comment"># ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—æ¤œå‡º</span>
<span class="code-keyword">def</span> <span class="code-function">find_band_gap</span>(bands):
    <span class="code-string">"""ç›´æ¥ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã‚’æ¤œå‡º"""</span>
    valence_band_max = np.max(bands[:, :<span class="code-number">11</span>])  <span class="code-comment"># ä¸‹ä½ãƒãƒ³ãƒ‰</span>
    conduction_band_min = np.min(bands[:, <span class="code-number">11</span>:])  <span class="code-comment"># ä¸Šä½ãƒãƒ³ãƒ‰</span>
    gap = conduction_band_min - valence_band_max
    <span class="code-keyword">return</span> gap, valence_band_max, conduction_band_min

gap, vbm, cbm = find_band_gap(bands)

<span class="code-comment"># å¯è¦–åŒ–</span>
fig, axes = plt.subplots(<span class="code-number">2</span>, <span class="code-number">2</span>, figsize=(<span class="code-number">12</span>, <span class="code-number">10</span>))

<span class="code-comment"># (1) å‘¨æœŸãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</span>
x = np.linspace(<span class="code-number">0</span>, <span class="code-number">3</span>*kp.a, <span class="code-number">500</span>)
V = kp.potential(x)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].plot(x, V, <span class="code-string">'b-'</span>, linewidth=<span class="code-number">2</span>)
<span class="code-keyword">for</span> i <span class="code-keyword">in</span> range(<span class="code-number">4</span>):
    axes[<span class="code-number">0</span>,<span class="code-number">0</span>].axvline(i*kp.a, color=<span class="code-string">'gray'</span>, linestyle=<span class="code-string">'--'</span>, alpha=<span class="code-number">0.5</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Position x/a'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Potential V(x)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'Periodic Potential'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># (2) ãƒãƒ³ãƒ‰æ§‹é€ </span>
<span class="code-keyword">for</span> n <span class="code-keyword">in</span> range(min(<span class="code-number">10</span>, bands.shape[<span class="code-number">1</span>])):
    color = <span class="code-string">'blue'</span> <span class="code-keyword">if</span> n < <span class="code-number">5</span> <span class="code-keyword">else</span> <span class="code-string">'red'</span>
    axes[<span class="code-number">0</span>,<span class="code-number">1</span>].plot(k_points * kp.a / np.pi, bands[:, n], color=color, linewidth=<span class="code-number">2</span>)

axes[<span class="code-number">0</span>,<span class="code-number">1</span>].axhline(vbm, color=<span class="code-string">'blue'</span>, linestyle=<span class="code-string">'--'</span>, alpha=<span class="code-number">0.5</span>, label=<span class="code-string">'VBM'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].axhline(cbm, color=<span class="code-string">'red'</span>, linestyle=<span class="code-string">'--'</span>, alpha=<span class="code-number">0.5</span>, label=<span class="code-string">'CBM'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].axvline(<span class="code-number">0</span>, color=<span class="code-string">'black'</span>, linestyle=<span class="code-string">'-'</span>, alpha=<span class="code-number">0.3</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_xlabel(<span class="code-string">'Wave Vector (k/Ï€/a)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_ylabel(<span class="code-string">'Energy (a.u.)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_title(<span class="code-string">'Band Structure'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_xlim(-<span class="code-number">1</span>, <span class="code-number">1</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].legend()
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—é ˜åŸŸã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ</span>
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].fill_between([-<span class="code-number">1</span>, <span class="code-number">1</span>], vbm, cbm, alpha=<span class="code-number">0.2</span>, color=<span class="code-string">'yellow'</span>)

<span class="code-comment"># (3) çŠ¶æ…‹å¯†åº¦ï¼ˆDOSï¼‰</span>
energy_bins = np.linspace(bands.min(), bands.max(), <span class="code-number">200</span>)
dos, _ = np.histogram(bands.flatten(), bins=energy_bins, density=<span class="code-keyword">True</span>)

axes[<span class="code-number">1</span>,<span class="code-number">0</span>].plot(dos, energy_bins[:-<span class="code-number">1</span>], <span class="code-string">'b-'</span>, linewidth=<span class="code-number">2</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].fill_betweenx(energy_bins[:-<span class="code-number">1</span>], dos, alpha=<span class="code-number">0.3</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].axhline(vbm, color=<span class="code-string">'blue'</span>, linestyle=<span class="code-string">'--'</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].axhline(cbm, color=<span class="code-string">'red'</span>, linestyle=<span class="code-string">'--'</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Density of States'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Energy (a.u.)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'Density of States (DOS)'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># (4) è¨ˆç®—çµæœã‚µãƒãƒªãƒ¼</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].axis(<span class="code-string">'off'</span>)
summary = <span class="code-string">f"""
1D Periodic Crystal Band Structure

Lattice Constant: {kp.a:.2f}
Potential Depth:  {kp.V0:.2f}
Plane Waves:      {kp.N_pw}

Band Gap:         {gap:.4f} a.u.
                  {gap * 27.211:.2f} eV

VBM:              {vbm:.4f} a.u.
CBM:              {cbm:.4f} a.u.

Material Type:    {'Insulator' if gap > 0.2 else 'Semiconductor'}
"""</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].text(<span class="code-number">0.1</span>, <span class="code-number">0.5</span>, summary, fontsize=<span class="code-number">11</span>, family=<span class="code-string">'monospace'</span>,
                   verticalalignment=<span class="code-string">'center'</span>)

plt.tight_layout()
plt.savefig(<span class="code-string">'band_structure_1d.png'</span>, dpi=<span class="code-number">150</span>, bbox_inches=<span class="code-string">'tight'</span>)
plt.show()

<span class="code-keyword">print</span>(<span class="code-string">f"\nãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—: {gap * 27.211:.2f} eV"</span>)
<span class="code-keyword">print</span>(<span class="code-string">f"ææ–™ã‚¿ã‚¤ãƒ—: {'çµ¶ç¸ä½“' if gap > 0.2 else 'åŠå°ä½“'}"</span>)
</div>

            <div class="exercise">
                <h3>ğŸ¯ æ¼”ç¿’å•é¡Œ</h3>
                <ol>
                    <li><strong>ãƒ¡ã‚¿ãƒ³ï¼ˆCHâ‚„ï¼‰ã®HFè¨ˆç®—</strong>: æ­£å››é¢ä½“æ§‹é€ ã®ãƒ¡ã‚¿ãƒ³åˆ†å­ã§HF-SCFè¨ˆç®—ã‚’å®Ÿè£…ã—ã€å…¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨åˆ†å­è»Œé“ã‚’æ±‚ã‚ã‚ˆã€‚</li>
                    <li><strong>COâ‚‚ã®æ§‹é€ æœ€é©åŒ–</strong>: COâ‚‚åˆ†å­ã®C=Oçµåˆè·é›¢ã¨âˆ OCOè§’åº¦ã‚’æœ€é©åŒ–ã—ã€èµ¤å¤–æ´»æ€§ãªæŒ¯å‹•ãƒ¢ãƒ¼ãƒ‰ã‚’è¨ˆç®—ã›ã‚ˆã€‚</li>
                    <li><strong>ãƒ™ãƒ³ã‚¼ãƒ³ã®åŠ±èµ·çŠ¶æ…‹</strong>: ãƒ™ãƒ³ã‚¼ãƒ³ã®Ï€â†’Ï€*é·ç§»ã‚’TD-DFTã§è¨ˆç®—ã—ã€ç´«å¤–å¸åã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚’äºˆæ¸¬ã›ã‚ˆã€‚</li>
                    <li><strong>ã‚·ãƒªã‚³ãƒ³ã®ãƒãƒ³ãƒ‰æ§‹é€ </strong>: ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰æ§‹é€ ã‚·ãƒªã‚³ãƒ³ã®ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã‚’è¨ˆç®—ã—ã€å®Ÿé¨“å€¤ï¼ˆ1.1 eVï¼‰ã¨æ¯”è¼ƒã›ã‚ˆã€‚</li>
                    <li><strong>åå¿œçµŒè·¯æ¢ç´¢</strong>: Hâ‚‚ + F â†’ HF + Håå¿œã®é·ç§»çŠ¶æ…‹ã‚’æ¢ç´¢ã—ã€æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ±‚ã‚ã‚ˆã€‚</li>
                </ol>
            </div>

            <h2>5.5 ææ–™ç§‘å­¦ã¸ã®å¿œç”¨</h2>

            <div class="theory-box">
                <h3>ğŸ“š ç¬¬ä¸€åŸç†è¨ˆç®—ã®ææ–™å¿œç”¨</h3>
                <p>é‡å­åŒ–å­¦è¨ˆç®—ã¯ã€å®Ÿé¨“ã«å…ˆç«‹ã¤<strong>ææ–™ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</strong>ã€<strong>åå¿œæ©Ÿæ§‹è§£æ˜</strong>ã€<strong>ç‰©æ€§äºˆæ¸¬</strong>ã«ä¸å¯æ¬ ã§ã™ã€‚</p>
                <ul>
                    <li><strong>è§¦åª’è¨­è¨ˆ</strong>: å¸ç€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€åå¿œéšœå£ã®è¨ˆç®—</li>
                    <li><strong>é›»æ± ææ–™</strong>: é›»æ¥µé›»ä½ã€ã‚¤ã‚ªãƒ³æ‹¡æ•£ä¿‚æ•°</li>
                    <li><strong>åŠå°ä½“</strong>: ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã€ã‚­ãƒ£ãƒªã‚¢ç§»å‹•åº¦</li>
                    <li><strong>å…‰å­¦ææ–™</strong>: å¸åã‚¹ãƒšã‚¯ãƒˆãƒ«ã€éç·šå½¢å…‰å­¦å¿œç­”</li>
                    <li><strong>æ©Ÿæ¢°å­¦ç¿’ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</strong>: DFTãƒ‡ãƒ¼ã‚¿ã§è¨“ç·´ã€é«˜é€ŸMD</li>
                </ul>
            </div>

            <h3>è§¦åª’è¡¨é¢å¸ç€ã‚¨ãƒãƒ«ã‚®ãƒ¼</h3>
            <p>é‡‘å±è¡¨é¢ã¸ã®COå¸ç€ã‚’è¨ˆç®—ã—ã€è§¦åª’æ´»æ€§ã‚’è©•ä¾¡ã—ã¾ã™ã€‚</p>

            <div class="code-example">
<span class="code-keyword">class</span> <span class="code-function">MetalSurfaceAdsorption</span>:
    <span class="code-string">"""é‡‘å±è¡¨é¢å¸ç€ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—ï¼ˆç°¡æ˜“ãƒ¢ãƒ‡ãƒ«ï¼‰"""</span>
    <span class="code-keyword">def</span> <span class="code-function">__init__</span>(self, metal=<span class="code-string">'Pt'</span>):
        self.metal = metal
        <span class="code-comment"># é‡‘å±ã®ä»•äº‹é–¢æ•°ï¼ˆeVï¼‰</span>
        self.work_functions = {<span class="code-string">'Pt'</span>: <span class="code-number">5.65</span>, <span class="code-string">'Pd'</span>: <span class="code-number">5.12</span>, <span class="code-string">'Cu'</span>: <span class="code-number">4.65</span>, <span class="code-string">'Au'</span>: <span class="code-number">5.1</span>}
        self.phi = self.work_functions.get(metal, <span class="code-number">5.0</span>)

    <span class="code-keyword">def</span> <span class="code-function">lennard_jones</span>(self, r, epsilon, sigma):
        <span class="code-string">"""Lennard-Jonesãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«"""</span>
        <span class="code-keyword">return</span> <span class="code-number">4</span> * epsilon * ((sigma/r)**<span class="code-number">12</span> - (sigma/r)**<span class="code-number">6</span>)

    <span class="code-keyword">def</span> <span class="code-function">adsorption_energy</span>(self, z, molecule=<span class="code-string">'CO'</span>):
        <span class="code-string">"""å¸ç€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®è¨ˆç®—"""</span>
        <span class="code-comment"># LJ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆé‡‘å±-COï¼‰</span>
        epsilon = <span class="code-number">0.5</span>  <span class="code-comment"># eV</span>
        sigma = <span class="code-number">2.5</span>    <span class="code-comment"># Ã…</span>

        <span class="code-comment"># å¸ç€ã‚¨ãƒãƒ«ã‚®ãƒ¼ = LJ + é™é›»ç›¸äº’ä½œç”¨</span>
        E_vdw = self.lennard_jones(z, epsilon, sigma)
        E_elec = -<span class="code-number">0.3</span> * self.phi * np.exp(-z / <span class="code-number">2.0</span>)

        <span class="code-keyword">return</span> E_vdw + E_elec

    <span class="code-keyword">def</span> <span class="code-function">find_optimal_height</span>(self):
        <span class="code-string">"""æœ€é©å¸ç€é«˜ã•ã®æ¢ç´¢"""</span>
        z_range = np.linspace(<span class="code-number">1.5</span>, <span class="code-number">6.0</span>, <span class="code-number">200</span>)
        E_ads = [self.adsorption_energy(z) <span class="code-keyword">for</span> z <span class="code-keyword">in</span> z_range]

        min_idx = np.argmin(E_ads)
        z_opt = z_range[min_idx]
        E_opt = E_ads[min_idx]

        <span class="code-keyword">return</span> z_opt, E_opt, z_range, E_ads

<span class="code-comment"># è¤‡æ•°é‡‘å±ã®æ¯”è¼ƒ</span>
metals = [<span class="code-string">'Pt'</span>, <span class="code-string">'Pd'</span>, <span class="code-string">'Cu'</span>, <span class="code-string">'Au'</span>]
results = {}

<span class="code-keyword">for</span> metal <span class="code-keyword">in</span> metals:
    surface = MetalSurfaceAdsorption(metal)
    z_opt, E_opt, z_range, E_ads = surface.find_optimal_height()
    results[metal] = {<span class="code-string">'z'</span>: z_opt, <span class="code-string">'E'</span>: E_opt, <span class="code-string">'curve'</span>: (z_range, E_ads)}
    <span class="code-keyword">print</span>(<span class="code-string">f"{metal}: z = {z_opt:.2f} Ã…, E_ads = {E_opt:.3f} eV"</span>)

<span class="code-comment"># å¯è¦–åŒ–</span>
fig, axes = plt.subplots(<span class="code-number">2</span>, <span class="code-number">2</span>, figsize=(<span class="code-number">12</span>, <span class="code-number">10</span>))

<span class="code-comment"># (1) å¸ç€ã‚¨ãƒãƒ«ã‚®ãƒ¼æ›²ç·š</span>
colors = {<span class="code-string">'Pt'</span>: <span class="code-string">'blue'</span>, <span class="code-string">'Pd'</span>: <span class="code-string">'green'</span>, <span class="code-string">'Cu'</span>: <span class="code-string">'orange'</span>, <span class="code-string">'Au'</span>: <span class="code-string">'gold'</span>}
<span class="code-keyword">for</span> metal, data <span class="code-keyword">in</span> results.items():
    z_range, E_ads = data[<span class="code-string">'curve'</span>]
    axes[<span class="code-number">0</span>,<span class="code-number">0</span>].plot(z_range, E_ads, color=colors[metal], linewidth=<span class="code-number">2</span>, label=metal)
    axes[<span class="code-number">0</span>,<span class="code-number">0</span>].plot(data[<span class="code-string">'z'</span>], data[<span class="code-string">'E'</span>], <span class="code-string">'o'</span>, color=colors[metal], markersize=<span class="code-number">8</span>)

axes[<span class="code-number">0</span>,<span class="code-number">0</span>].axhline(<span class="code-number">0</span>, color=<span class="code-string">'k'</span>, linestyle=<span class="code-string">'--'</span>, alpha=<span class="code-number">0.3</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Distance from Surface (Ã…)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'Adsorption Energy (eV)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'CO Adsorption on Metal Surfaces'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].legend()
axes[<span class="code-number">0</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># (2) å¸ç€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æ¯”è¼ƒ</span>
metal_names = list(results.keys())
E_ads_values = [-results[m][<span class="code-string">'E'</span>] <span class="code-keyword">for</span> m <span class="code-keyword">in</span> metal_names]  <span class="code-comment"># æ­£ã®å€¤ã§è¡¨ç¤º</span>
bar_colors = [colors[m] <span class="code-keyword">for</span> m <span class="code-keyword">in</span> metal_names]

axes[<span class="code-number">0</span>,<span class="code-number">1</span>].bar(metal_names, E_ads_values, color=bar_colors, alpha=<span class="code-number">0.7</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_ylabel(<span class="code-string">'|E_ads| (eV)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].set_title(<span class="code-string">'Adsorption Energy Comparison'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>, axis=<span class="code-string">'y'</span>)

<span class="code-comment"># æœ€å¼·å¸ç€ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ</span>
max_idx = np.argmax(E_ads_values)
axes[<span class="code-number">0</span>,<span class="code-number">1</span>].text(max_idx, E_ads_values[max_idx] + <span class="code-number">0.05</span>, <span class="code-string">'Strongest'</span>,
                ha=<span class="code-string">'center'</span>, fontsize=<span class="code-number">10</span>, fontweight=<span class="code-string">'bold'</span>)

<span class="code-comment"># (3) ä»•äº‹é–¢æ•° vs å¸ç€ã‚¨ãƒãƒ«ã‚®ãƒ¼</span>
phi_values = [MetalSurfaceAdsorption(m).phi <span class="code-keyword">for</span> m <span class="code-keyword">in</span> metal_names]
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].scatter(phi_values, E_ads_values, s=<span class="code-number">150</span>, c=bar_colors, alpha=<span class="code-number">0.7</span>)

<span class="code-keyword">for</span> i, metal <span class="code-keyword">in</span> enumerate(metal_names):
    axes[<span class="code-number">1</span>,<span class="code-number">0</span>].annotate(metal, (phi_values[i], E_ads_values[i]),
                        xytext=(<span class="code-number">5</span>, <span class="code-number">5</span>), textcoords=<span class="code-string">'offset points'</span>,
                        fontsize=<span class="code-number">11</span>, fontweight=<span class="code-string">'bold'</span>)

<span class="code-comment"># ç·šå½¢ãƒ•ã‚£ãƒƒãƒˆ</span>
z = np.polyfit(phi_values, E_ads_values, <span class="code-number">1</span>)
p = np.poly1d(z)
phi_fit = np.linspace(min(phi_values), max(phi_values), <span class="code-number">100</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].plot(phi_fit, p(phi_fit), <span class="code-string">'r--'</span>, alpha=<span class="code-number">0.5</span>, label=<span class="code-string">f'y = {z[0]:.2f}x + {z[1]:.2f}'</span>)

axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_xlabel(<span class="code-string">'Work Function (eV)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_ylabel(<span class="code-string">'|E_ads| (eV)'</span>, fontsize=<span class="code-number">12</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].set_title(<span class="code-string">'Work Function vs Adsorption Energy'</span>, fontsize=<span class="code-number">14</span>, fontweight=<span class="code-string">'bold'</span>)
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].legend()
axes[<span class="code-number">1</span>,<span class="code-number">0</span>].grid(<span class="code-keyword">True</span>, alpha=<span class="code-number">0.3</span>)

<span class="code-comment"># (4) è§¦åª’æ´»æ€§ã‚µãƒãƒªãƒ¼</span>
axes[<span class="code-number">1</span>,<span class="code-number">1</span>].axis(<span class="code-string">'off'</span>)
best_metal = metal_names[max_idx]
summary = <span class="code-string">f"""
CO Adsorption on Metal Surfaces

Best Catalyst: {best_metal}
  E_ads:       {-results[best_metal]['E']:.3f} eV
  Height:      {results[best_metal]['z']:.2f} Ã…
  Work Func:   {MetalSurfaceAdsorption(best_metal).phi:.2f} eV

Ranking (by |E_ads|):
"""</span>
<span class="code-keyword">for</span> i, m <span class="code-keyword">in</span> enumerate(sorted(metal_names, key=<span class="code-keyword">lambda</span> x: -results[x][<span class="code-string">'E'</span>]), <span class="code-number">1</span>):
    summary += <span class="code-string">f"  {i}. {m:3s}  {-results[m]['E']:.3f} eV\n"</span>

axes[<span class="code-number">1</span>,<span class="code-number">1</span>].text(<span class="code-number">0.1</span>, <span class="code-number">0.5</span>, summary, fontsize=<span class="code-number">11</span>, family=<span class="code-string">'monospace'</span>,
                   verticalalignment=<span class="code-string">'center'</span>)

plt.tight_layout()
plt.savefig(<span class="code-string">'catalyst_adsorption.png'</span>, dpi=<span class="code-number">150</span>, bbox_inches=<span class="code-string">'tight'</span>)
plt.show()
</div>

            <h2>ã¾ã¨ã‚</h2>
            <p>æœ¬ç« ã§ã¯ã€é‡å­åŒ–å­¦è¨ˆç®—ã®å®Ÿè·µçš„æ‰‹æ³•ã‚’å­¦ã³ã¾ã—ãŸ:</p>
            <ul>
                <li><strong>PySCFã«ã‚ˆã‚‹åˆ†å­è¨ˆç®—</strong>: HFæ³•ã¨DFTã§æ°´åˆ†å­ã®é›»å­çŠ¶æ…‹ã‚’è¨ˆç®—</li>
                <li><strong>æ§‹é€ æœ€é©åŒ–</strong>: ã‚¨ãƒãƒ«ã‚®ãƒ¼å‹¾é…ã«åŸºã¥ãå¹³è¡¡æ§‹é€ ã®æ¢ç´¢</li>
                <li><strong>æŒ¯å‹•è§£æ</strong>: èª¿å’ŒæŒ¯å‹•å­è¿‘ä¼¼ã«ã‚ˆã‚‹æŒ¯å‹•ã‚¹ãƒšã‚¯ãƒˆãƒ«äºˆæ¸¬</li>
                <li><strong>TD-DFT</strong>: åŠ±èµ·çŠ¶æ…‹è¨ˆç®—ã¨UV-Viså¸åã‚¹ãƒšã‚¯ãƒˆãƒ«</li>
                <li><strong>ãƒãƒ³ãƒ‰è¨ˆç®—</strong>: å‘¨æœŸç³»ã®Blochå®šç†ã¨å›ºä½“é›»å­æ§‹é€ </li>
                <li><strong>ææ–™å¿œç”¨</strong>: è§¦åª’ã€é›»æ± ã€åŠå°ä½“ã¸ã®å®Ÿç”¨çš„å¿œç”¨</li>
            </ul>
            <p>ã“ã‚Œã‚‰ã®æ‰‹æ³•ã¯ã€<strong>Materials Informatics</strong>ã«ãŠã„ã¦ã€æ©Ÿæ¢°å­¦ç¿’ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€é«˜é€Ÿãªææ–™ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã¨ç‰©æ€§äºˆæ¸¬ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ç¬¬ä¸€åŸç†è¨ˆç®—ã§ç”Ÿæˆã•ã‚ŒãŸé«˜ç²¾åº¦ãƒ‡ãƒ¼ã‚¿ã¯ã€æ©Ÿæ¢°å­¦ç¿’ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã®è¨“ç·´ã€è¨˜è¿°å­ã®è¨­è¨ˆã€äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰ã«æ´»ç”¨ã•ã‚Œã¾ã™ã€‚</p>
        </div>

        <div class="nav-buttons">
            <a href="chapter-4.html" class="nav-button">â† ç¬¬4ç« : å¯†åº¦æ±é–¢æ•°ç†è«–</a>
            <a href="index.html" class="nav-button">ç›®æ¬¡ã«æˆ»ã‚‹</a>
        </div>
    </div>

    <section class="disclaimer">
<h3>å…è²¬äº‹é …</h3>
<ul>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹Code examplesã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
<li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
</ul>
</section>

<footer>
        <p>&copy; 2025 AI Terakoya - Quantum Chemistry for Materials Science</p>
        <p>Materials Informatics Education Series</p>
    </footer>
</body>
</html>
