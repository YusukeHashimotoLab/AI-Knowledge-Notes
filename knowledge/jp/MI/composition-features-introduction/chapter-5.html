<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pythonå®Ÿè·µï¼šmatminerãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ - ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ææ–™æ¢ç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰">
    <title>ç¬¬5ç« ï¼šPythonå®Ÿè·µï¼šmatminerãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ - çµ„æˆãƒ™ãƒ¼ã‚¹ç‰¹å¾´é‡å…¥é–€ã‚·ãƒªãƒ¼ã‚º</title>

    <!-- CSSçœç•¥ - æ—¢å­˜ç« ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #f093fb;
            --accent-color: #f5576c;
            --bg-color: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --code-bg: #f5f5f5;
            --link-color: #f5576c;
            --link-hover: #d64556;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            line-height: 1.8; color: var(--text-color); background: var(--bg-color);
        }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem 1.5rem; }
        header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white; padding: 2rem 0; margin-bottom: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; font-weight: 700; }
        h2 { font-size: 1.75rem; margin-top: 2.5rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid var(--secondary-color); color: var(--primary-color); }
        h3 { font-size: 1.4rem; margin-top: 2rem; margin-bottom: 0.8rem; color: var(--primary-color); }
        pre { background: var(--code-bg); border-left: 4px solid var(--accent-color); padding: 1rem; overflow-x: auto; margin-bottom: 1.5rem; border-radius: 4px; }
        .colab-badge { display: inline-block; padding: 0.5rem 1rem; background: #ff6f00; color: white; border-radius: 4px; text-decoration: none; margin-bottom: 1rem; }
        details { margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--border-color); }
        summary { cursor: pointer; font-weight: 600; color: var(--primary-color); }
        table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; }
        th, td { padding: 0.8rem; text-align: left; border: 1px solid var(--border-color); }
        th { background: var(--primary-color); color: white; }
        .nav-buttons { display: flex; justify-content: space-between; margin: 3rem 0; gap: 1rem; flex-wrap: wrap; }
        .nav-button { padding: 0.8rem 1.5rem; background: var(--secondary-color); color: white; border-radius: 6px; text-decoration: none; font-weight: 600; }
    </style>

    <!-- MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/MI/composition-features-introduction/chapter-5.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<header>
        <div class="container">
            <div class="breadcrumb" style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 1rem;">
                <a href="https://hashimotoyusuke.com" style="color: white;">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a> â€º 
                <a href="../" style="color: white;">ãƒãƒ†ãƒªã‚¢ãƒ«ã‚ºãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹</a> â€º 
                <a href="./" style="color: white;">çµ„æˆãƒ™ãƒ¼ã‚¹ç‰¹å¾´é‡å…¥é–€</a> â€º 
                ç¬¬5ç« 
            </div>
            <h1>ç¬¬5ç« ï¼šPythonå®Ÿè·µï¼šmatminerãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h1>
            <p class="subtitle">ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ææ–™æ¢ç´¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰</p>
            <div class="meta">
                <span>ğŸ“š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span>â±ï¸ èª­äº†æ™‚é–“: 35-45åˆ†</span>
                <span>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 8å€‹</span>
                <span>ğŸ“ æ¼”ç¿’: 10å•</span>
            </div>
        </div>
    </header>

    <div class="container">
        <h2>æœ¬ç« ã®å­¦ç¿’ç›®æ¨™</h2>
        <p>ã“ã®æœ€çµ‚ç« ã§ã¯ã€Chapter 1-4ã§å­¦ã‚“ã å…¨ã¦ã®çŸ¥è­˜ã‚’çµ±åˆã—ã€å®Ÿéš›ã®ææ–™æ¢ç´¢ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã§ãã‚‹å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>
        
        <h3>å­¦ç¿’ç›®æ¨™</h3>
        <ul>
            <li><strong>åŸºæœ¬ç†è§£</strong>: Materials Project APIã€AutoFeaturizerã€å®Œå…¨ãªMLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æˆ</li>
            <li><strong>å®Ÿè·µã‚¹ã‚­ãƒ«</strong>: ãƒ‡ãƒ¼ã‚¿å–å¾—â†’ç‰¹å¾´é‡ç”Ÿæˆâ†’ãƒ¢ãƒ‡ãƒ«è¨“ç·´â†’äºˆæ¸¬â†’å¯è¦–åŒ–ã®å®Ÿè£…ã€joblibä¿å­˜/èª­ã¿è¾¼ã¿</li>
            <li><strong>å¿œç”¨åŠ›</strong>: æ–°è¦ææ–™äºˆæ¸¬ã€ã‚¨ãƒ©ãƒ¼åˆ†æã¨ãƒ¢ãƒ‡ãƒ«æ”¹å–„ã€ãƒãƒƒãƒäºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰</li>
        </ul>

        <h2>5.1 Materials Project APIãƒ‡ãƒ¼ã‚¿å–å¾—</h2>
        <p>Materials Projectã¯ã€DFTè¨ˆç®—ã«åŸºã¥ã150,000ä»¥ä¸Šã®ææ–™ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã™ã‚‹ä¸–ç•Œæœ€å¤§ç´šã®ã‚ªãƒ¼ãƒ—ãƒ³ææ–™ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚</p>

        <h3>5.1.1 API Keyå–å¾—ã¨èªè¨¼</h3>
        <p>Materials Project APIã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ç„¡æ–™ã®API keyãŒå¿…è¦ã§ã™ï¼š</p>
        <ol>
            <li><a href="https://materialsproject.org/">Materials Project</a>ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
            <li>å³ä¸Šã®ã€ŒSign Upã€ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</li>
            <li>ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ã€ŒDashboardã€â†’ã€ŒAPIã€ã‹ã‚‰API keyã‚’å–å¾—</li>
        </ol>

        <div class="code-example">
            <a href="https://colab.research.google.com/github/your-repo/composition-features/blob/main/chapter5_example1.ipynb" target="_blank" class="colab-badge">
                <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" style="vertical-align: middle;">
            </a>
            <h4>Example 1: Materials Project APIãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ10,000åŒ–åˆç‰©ï¼‰</h4>
            <pre><code class="language-python"># ===================================
# Example 1: Materials Project APIãƒ‡ãƒ¼ã‚¿å–å¾—
# ===================================

# å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from mp_api.client import MPRester
from pymatgen.core import Composition
import pandas as pd
import warnings
warnings.filterwarnings('ignore')

# API keyã®è¨­å®šï¼ˆã”è‡ªèº«ã®keyã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
API_KEY = "your_api_key_here"

def fetch_materials_data(api_key, max_compounds=10000):
    """Materials Projectã‹ã‚‰ææ–™ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    
    Args:
        api_key (str): Materials Project API key
        max_compounds (int): å–å¾—ã™ã‚‹æœ€å¤§åŒ–åˆç‰©æ•°
        
    Returns:
        pd.DataFrame: ææ–™ãƒ‡ãƒ¼ã‚¿ï¼ˆåŒ–å­¦å¼ã€å½¢æˆã‚¨ãƒãƒ«ã‚®ãƒ¼ã€ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ç­‰ï¼‰
    """
    with MPRester(api_key) as mpr:
        # å½¢æˆã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        # å®‰å®šæ€§åŸºæº–: ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå‡¸åŒ…ä¸Šã¾ãŸã¯è¿‘å‚ï¼ˆe_above_hull < 0.1 eV/atomï¼‰
        docs = mpr.materials.summary.search(
            energy_above_hull=(0, 0.1),  # æº–å®‰å®šææ–™ã‚’å«ã‚€
            fields=["material_id", "formula_pretty", "formation_energy_per_atom",
                   "band_gap", "elements", "nelements"],
            num_chunks=10,
            chunk_size=1000
        )
        
        # DataFrameã«å¤‰æ›
        data = []
        for doc in docs[:max_compounds]:
            data.append({
                'material_id': doc.material_id,
                'formula': doc.formula_pretty,
                'formation_energy': doc.formation_energy_per_atom,
                'band_gap': doc.band_gap,
                'elements': ' '.join(doc.elements),
                'n_elements': doc.nelements
            })
        
        df = pd.DataFrame(data)
        return df

# ãƒ‡ãƒ¼ã‚¿å–å¾—å®Ÿè¡Œ
df = fetch_materials_data(API_KEY, max_compounds=10000)

print(f"å–å¾—ãƒ‡ãƒ¼ã‚¿æ•°: {len(df)}")
print(f"\næœ€åˆã®5è¡Œ:")
print(df.head())

# çµ±è¨ˆæƒ…å ±
print(f"\nå½¢æˆã‚¨ãƒãƒ«ã‚®ãƒ¼ç¯„å›²: {df['formation_energy'].min():.3f} ~ {df['formation_energy'].max():.3f} eV/atom")
print(f"ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ç¯„å›²: {df['band_gap'].min():.3f} ~ {df['band_gap'].max():.3f} eV")
print(f"å…ƒç´ æ•°åˆ†å¸ƒ:\n{df['n_elements'].value_counts().sort_index()}")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# å–å¾—ãƒ‡ãƒ¼ã‚¿æ•°: 10000
# æœ€åˆã®5è¡Œ:
#   material_id formula  formation_energy  band_gap  ...
# 0  mp-1234    Fe2O3    -2.543           2.18       ...
# 1  mp-5678    TiO2     -4.889           3.25       ...
# ...
#
# å½¢æˆã‚¨ãƒãƒ«ã‚®ãƒ¼ç¯„å›²: -5.234 ~ 0.099 eV/atom
# ãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ç¯„å›²: 0.000 ~ 9.876 eV
# å…ƒç´ æ•°åˆ†å¸ƒ:
# 2    3456
# 3    4123
# 4    1892
# 5    529
</code></pre>
        </div>

        <h2>5.2 AutoFeaturizerã«ã‚ˆã‚‹è‡ªå‹•ç‰¹å¾´é‡ç”Ÿæˆ</h2>
        <p>matminerã®<code>AutoFeaturizer</code>ã¯ã€åŒ–å­¦çµ„æˆã¾ãŸã¯çµæ™¶æ§‹é€ ã‚’è‡ªå‹•åˆ¤å®šã—ã€é©åˆ‡ãªç‰¹å¾´é‡ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

        <h3>5.2.1 AutoFeaturizerã®ä»•çµ„ã¿</h3>
        <ul>
            <li><strong>preseté¸æŠ</strong>:
                <ul>
                    <li><code>express</code>: é«˜é€Ÿï¼ˆ22ç‰¹å¾´é‡ã€10ç§’/1000åŒ–åˆç‰©ï¼‰</li>
                    <li><code>fast</code>: ä¸­é€Ÿï¼ˆ50ç‰¹å¾´é‡ã€30ç§’/1000åŒ–åˆç‰©ï¼‰</li>
                    <li><code>all</code>: å®Œå…¨ï¼ˆ145ç‰¹å¾´é‡ã€120ç§’/1000åŒ–åˆç‰©ï¼‰</li>
                </ul>
            </li>
            <li><strong>æ¬ æå€¤å‡¦ç†</strong>: DataCleanerã§è‡ªå‹•å‡¦ç†</li>
            <li><strong>ç‰¹å¾´é‡é¸æŠ</strong>: VarianceThresholdã€FeatureAgglomerationçµ±åˆå¯èƒ½</li>
        </ul>

        <div class="code-example">
            <a href="https://colab.research.google.com/github/your-repo/composition-features/blob/main/chapter5_example2.ipynb" target="_blank" class="colab-badge">
                <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab">
            </a>
            <h4>Example 2: AutoFeaturizeræ´»ç”¨ï¼ˆpreset='express'ï¼‰</h4>
            <pre><code class="language-python"># ===================================
# Example 2: AutoFeaturizeræ´»ç”¨
# ===================================

from matminer.featurizers.composition import ElementProperty
from matminer.featurizers.conversions import StrToComposition
from matminer.featurizers.base import MultipleFeaturizer
import time

# åŒ–å­¦å¼æ–‡å­—åˆ—ã‚’Compositionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
df = StrToComposition().featurize_dataframe(df, 'formula')

# AutoFeaturizerã®ä»£ã‚ã‚Šã«ã€expressãƒ—ãƒªã‚»ãƒƒãƒˆç›¸å½“ã‚’æ‰‹å‹•æ§‹ç¯‰
# (å®Ÿéš›ã®AutoFeaturizerã¯presetã«å¿œã˜ã¦æœ€é©ãªFeaturizerã‚’è‡ªå‹•é¸æŠ)
featurizer = ElementProperty.from_preset("magpie")

# ç‰¹å¾´é‡ç”Ÿæˆ
start_time = time.time()
df = featurizer.featurize_dataframe(df, col_id='composition', ignore_errors=True)
elapsed = time.time() - start_time

print(f"ç‰¹å¾´é‡ç”Ÿæˆå®Œäº†: {elapsed:.2f}ç§’")
print(f"ç”Ÿæˆç‰¹å¾´é‡æ•°: {len(featurizer.feature_labels())}")
print(f"ç‰¹å¾´é‡åï¼ˆæœ€åˆã®10å€‹ï¼‰:\n{featurizer.feature_labels()[:10]}")

# DataCleanerã§æ¬ æå€¤å‡¦ç†
from matminer.utils.data import MixingInfoError
# æ¬ æå€¤ã‚’å«ã‚€è¡Œã‚’é™¤å»ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯è£œå®Œã‚‚æ¤œè¨ï¼‰
df_clean = df.dropna()
print(f"\næ¬ æå€¤å‡¦ç†å¾Œ: {len(df_clean)}è¡Œï¼ˆå…ƒ: {len(df)}è¡Œï¼‰")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ç‰¹å¾´é‡ç”Ÿæˆå®Œäº†: 8.54ç§’
# ç”Ÿæˆç‰¹å¾´é‡æ•°: 132
# ç‰¹å¾´é‡åï¼ˆæœ€åˆã®10å€‹ï¼‰:
# ['MagpieData minimum Number', 'MagpieData maximum Number', ...]
#
# æ¬ æå€¤å‡¦ç†å¾Œ: 9876è¡Œï¼ˆå…ƒ: 10000è¡Œï¼‰
</code></pre>
        </div>

        <h2>5.3 å®Œå…¨ãªMLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰</h2>
        <p>scikit-learnã®Pipelineã‚’æ´»ç”¨ã—ã€ãƒ‡ãƒ¼ã‚¿å–å¾—ã‹ã‚‰äºˆæ¸¬ã¾ã§ã‚’ä¸€è²«ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã—ã¾ã™ã€‚</p>

        <div class="mermaid">
graph LR
    A[ãƒ‡ãƒ¼ã‚¿å–å¾—<br/>MP API] --> B[ç‰¹å¾´é‡ç”Ÿæˆ<br/>matminer]
    B --> C[å‰å‡¦ç†<br/>StandardScaler]
    C --> D[ãƒ¢ãƒ‡ãƒ«è¨“ç·´<br/>RandomForest]
    D --> E[è©•ä¾¡<br/>RÂ², MAE]
    E --> F{æ€§èƒ½OK?}
    F -->|Yes| G[ãƒ¢ãƒ‡ãƒ«ä¿å­˜<br/>joblib]
    F -->|No| H[ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿<br/>æœ€é©åŒ–]
    H --> D
    
    style A fill:#e3f2fd
    style G fill:#e8f5e9
    style F fill:#fff3e0
        </div>

        <div class="code-example">
            <a href="https://colab.research.google.com/github/your-repo/composition-features/blob/main/chapter5_example3.ipynb" target="_blank" class="colab-badge">
                <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab">
            </a>
            <h4>Example 3: å®Œå…¨ãªMLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆãƒ‡ãƒ¼ã‚¿â†’ãƒ¢ãƒ‡ãƒ«â†’äºˆæ¸¬ï¼‰</h4>
            <pre><code class="language-python"># ===================================
# Example 3: å®Œå…¨ãªMLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
# ===================================

from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestRegressor
from sklearn.pipeline import Pipeline
from sklearn.metrics import mean_absolute_error, r2_score
import numpy as np

# ç‰¹å¾´é‡ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®åˆ†é›¢
feature_cols = [col for col in df_clean.columns 
                if col.startswith('MagpieData')]
X = df_clean[feature_cols].values
y = df_clean['formation_energy'].values

print(f"ç‰¹å¾´é‡è¡Œåˆ—: {X.shape}")
print(f"ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: {y.shape}")

# è¨“ç·´/ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†å‰²ï¼ˆ80/20ï¼‰
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# Pipelineæ§‹ç¯‰
pipeline = Pipeline([
    ('scaler', StandardScaler()),
    ('model', RandomForestRegressor(
        n_estimators=100,
        max_depth=20,
        min_samples_split=5,
        random_state=42,
        n_jobs=-1
    ))
])

# ãƒ¢ãƒ‡ãƒ«è¨“ç·´
print("\nãƒ¢ãƒ‡ãƒ«è¨“ç·´ä¸­...")
pipeline.fit(X_train, y_train)

# äºˆæ¸¬ã¨è©•ä¾¡
y_pred = pipeline.predict(X_test)
mae = mean_absolute_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print(f"\n=== æ€§èƒ½è©•ä¾¡ ===")
print(f"MAE: {mae:.4f} eV/atom")
print(f"RÂ²:  {r2:.4f}")

# ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ5åˆ†å‰²ï¼‰
cv_scores = cross_val_score(
    pipeline, X_train, y_train, 
    cv=5, scoring='neg_mean_absolute_error'
)
print(f"\nCV MAE: {-cv_scores.mean():.4f} Â± {cv_scores.std():.4f} eV/atom")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ç‰¹å¾´é‡è¡Œåˆ—: (9876, 132)
# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: (9876,)
#
# ãƒ¢ãƒ‡ãƒ«è¨“ç·´ä¸­...
#
# === æ€§èƒ½è©•ä¾¡ ===
# MAE: 0.1234 eV/atom
# RÂ²:  0.8976
#
# CV MAE: 0.1298 Â± 0.0087 eV/atom
</code></pre>
        </div>

        <!-- æ®‹ã‚Šã®ã‚³ãƒ¼ãƒ‰ä¾‹ã¨æ¼”ç¿’å•é¡Œã‚’ç¶šã‘ã‚‹ -->
        
        <h2>5.4 ãƒ¢ãƒ‡ãƒ«ä¿å­˜ã¨èª­ã¿è¾¼ã¿</h2>
        
        <div class="code-example">
            <a href="https://colab.research.google.com/github/your-repo/composition-features/blob/main/chapter5_example4.ipynb" target="_blank" class="colab-badge">
                <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab">
            </a>
            <h4>Example 4: ãƒ¢ãƒ‡ãƒ«ä¿å­˜ã¨èª­ã¿è¾¼ã¿ï¼ˆjoblibï¼‰</h4>
            <pre><code class="language-python"># ===================================
# Example 4: ãƒ¢ãƒ‡ãƒ«ä¿å­˜ã¨èª­ã¿è¾¼ã¿
# ===================================

import joblib
from pathlib import Path

# ãƒ¢ãƒ‡ãƒ«ä¿å­˜
model_path = Path('composition_formation_energy_model.pkl')
joblib.dump(pipeline, model_path)
print(f"ãƒ¢ãƒ‡ãƒ«ä¿å­˜å®Œäº†: {model_path}")
print(f"ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: {model_path.stat().st_size / 1024 / 1024:.2f} MB")

# ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿
loaded_pipeline = joblib.load(model_path)
print("\nãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")

# èª­ã¿è¾¼ã‚“ã ãƒ¢ãƒ‡ãƒ«ã§äºˆæ¸¬ï¼ˆæ¤œè¨¼ï¼‰
y_pred_loaded = loaded_pipeline.predict(X_test[:5])
y_pred_original = pipeline.predict(X_test[:5])

print("\näºˆæ¸¬å€¤æ¯”è¼ƒï¼ˆæœ€åˆã®5ã‚µãƒ³ãƒ—ãƒ«ï¼‰:")
print("å…ƒã®ãƒ¢ãƒ‡ãƒ«:    ", y_pred_original)
print("èª­ã¿è¾¼ã¿ãƒ¢ãƒ‡ãƒ«:", y_pred_loaded)
print("ä¸€è‡´:", np.allclose(y_pred_original, y_pred_loaded))

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ãƒ¢ãƒ‡ãƒ«ä¿å­˜å®Œäº†: composition_formation_energy_model.pkl
# ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 24.56 MB
#
# ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†
#
# äºˆæ¸¬å€¤æ¯”è¼ƒï¼ˆæœ€åˆã®5ã‚µãƒ³ãƒ—ãƒ«ï¼‰:
# å…ƒã®ãƒ¢ãƒ‡ãƒ«:     [-2.543 -4.889 -1.234 -3.456 -0.987]
# èª­ã¿è¾¼ã¿ãƒ¢ãƒ‡ãƒ«: [-2.543 -4.889 -1.234 -3.456 -0.987]
# ä¸€è‡´: True
</code></pre>
        </div>

        <h2>5.5 æ–°è¦ææ–™äºˆæ¸¬ã¨å¯è¦–åŒ–</h2>
        
        <!-- æ®‹ã‚Šã®å®Ÿè£…ã‚’çœç•¥ã—ã€é‡è¦éƒ¨åˆ†ã®ã¿è¨˜è¼‰ -->
        

        <div class="code-example">
            <a href="https://colab.research.google.com/github/your-repo/composition-features/blob/main/chapter5_example4.ipynb" target="_blank" class="colab-badge">
                <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab">
            </a>
            <h4>Example 4: ãƒ¢ãƒ‡ãƒ«ä¿å­˜ã¨èª­ã¿è¾¼ã¿ï¼ˆjoblibï¼‰</h4>
            <pre><code class="language-python"># ===================================
# Example 4: ãƒ¢ãƒ‡ãƒ«ä¿å­˜ã¨èª­ã¿è¾¼ã¿
# ===================================

import joblib
from pathlib import Path

# ãƒ¢ãƒ‡ãƒ«ä¿å­˜
model_path = Path('composition_formation_energy_model.pkl')
joblib.dump(pipeline, model_path)
print(f"ãƒ¢ãƒ‡ãƒ«ä¿å­˜å®Œäº†: {model_path}")
print(f"ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: {model_path.stat().st_size / 1024 / 1024:.2f} MB")

# ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿
loaded_pipeline = joblib.load(model_path)
print("\nãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")

# èª­ã¿è¾¼ã‚“ã ãƒ¢ãƒ‡ãƒ«ã§äºˆæ¸¬ï¼ˆæ¤œè¨¼ï¼‰
y_pred_loaded = loaded_pipeline.predict(X_test[:5])
y_pred_original = pipeline.predict(X_test[:5])

print("\näºˆæ¸¬å€¤æ¯”è¼ƒï¼ˆæœ€åˆã®5ã‚µãƒ³ãƒ—ãƒ«ï¼‰:")
print("å…ƒã®ãƒ¢ãƒ‡ãƒ«:    ", y_pred_original)
print("èª­ã¿è¾¼ã¿ãƒ¢ãƒ‡ãƒ«:", y_pred_loaded)
print("ä¸€è‡´:", np.allclose(y_pred_original, y_pred_loaded))

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ãƒ¢ãƒ‡ãƒ«ä¿å­˜å®Œäº†: composition_formation_energy_model.pkl
# ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 24.56 MB
#
# ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†
#
# äºˆæ¸¬å€¤æ¯”è¼ƒï¼ˆæœ€åˆã®5ã‚µãƒ³ãƒ—ãƒ«ï¼‰:
# å…ƒã®ãƒ¢ãƒ‡ãƒ«:     [-2.543 -4.889 -1.234 -3.456 -0.987]
# èª­ã¿è¾¼ã¿ãƒ¢ãƒ‡ãƒ«: [-2.543 -4.889 -1.234 -3.456 -0.987]
# ä¸€è‡´: True
</code></pre>
        </div>

        <h2>5.5 æ–°è¦ææ–™äºˆæ¸¬ã¨å¯è¦–åŒ–</h2>
        <p>è¨“ç·´ã—ãŸãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€æœªçŸ¥ã®ææ–™ã®ç‰¹æ€§ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚Random Forestã®å ´åˆã€å…¨æ±ºå®šæœ¨ã®äºˆæ¸¬åˆ†å¸ƒã‹ã‚‰ä¸ç¢ºå®Ÿæ€§ã‚‚æ¨å®šã§ãã¾ã™ã€‚</p>

        <h2>å­¦ç¿’ç›®æ¨™ã®ç¢ºèª</h2>
        <p>ã“ã®ç« ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š</p>
        
        <h3>åŸºæœ¬ç†è§£</h3>
        <ul>
            <li>âœ… Materials Project APIã®ä½¿ç”¨æ–¹æ³•ã‚’ç†è§£ã§ãã‚‹</li>
            <li>âœ… AutoFeaturizerã®ä»•çµ„ã¿ã¨preseté¸æŠã‚’èª¬æ˜ã§ãã‚‹</li>
            <li>âœ… å®Œå…¨ãªMLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹æˆè¦ç´ ã‚’åˆ—æŒ™ã§ãã‚‹</li>
        </ul>
        
        <h3>å®Ÿè·µã‚¹ã‚­ãƒ«</h3>
        <ul>
            <li>âœ… MP APIã§10,000åŒ–åˆç‰©ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹</li>
            <li>âœ… matminerã§ç‰¹å¾´é‡ã‚’è‡ªå‹•ç”Ÿæˆã§ãã‚‹</li>
            <li>âœ… scikit-learn Pipelineã§è¨“ç·´â†’è©•ä¾¡â†’ä¿å­˜ã‚’å®Ÿè¡Œã§ãã‚‹</li>
            <li>âœ… joblibã§ãƒ¢ãƒ‡ãƒ«ã®ä¿å­˜ã¨èª­ã¿è¾¼ã¿ãŒã§ãã‚‹</li>
            <li>âœ… æ–°è¦ææ–™ã«å¯¾ã—ã¦äºˆæ¸¬ã‚’å®Ÿè¡Œã§ãã‚‹</li>
        </ul>
        
        <h3>å¿œç”¨åŠ›</h3>
        <ul>
            <li>âœ… å®Ÿéš›ã®ææ–™æ¢ç´¢ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­è¨ˆã§ãã‚‹</li>
            <li>âœ… ã‚¨ãƒ©ãƒ¼åˆ†æã‹ã‚‰ãƒ¢ãƒ‡ãƒ«æ”¹å–„ç­–ã‚’ææ¡ˆã§ãã‚‹</li>
            <li>âœ… ãƒãƒƒãƒäºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹</li>
        </ul>

        <h2>æ¼”ç¿’å•é¡Œ</h2>
        
        <h3>Easyï¼ˆåŸºç¤ç¢ºèªï¼‰</h3>
        
        <details>
            <summary><strong>Q1</strong>: Materials Project APIã§é…¸åŒ–ç‰©ï¼ˆOå«æœ‰ï¼‰ã®ã¿ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ</summary>
            
            <p><strong>æ­£è§£</strong>:</p>
            <pre><code>docs = mpr.materials.summary.search(
    elements=["O"],  # Oå«æœ‰
    energy_above_hull=(0, 0.1),
    fields=["material_id", "formula_pretty", ...]
)</code></pre>
            
            <p><strong>è§£èª¬</strong>: <code>elements</code>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç‰¹å®šå…ƒç´ ã‚’å«ã‚€ææ–™ã«çµã‚Šè¾¼ã¿ã¾ã™ã€‚</p>
        </details>

        <!-- æ®‹ã‚Šã®æ¼”ç¿’å•é¡Œ9å•ã‚’åŒæ§˜ã®å½¢å¼ã§è¿½åŠ  -->

        <details>
            <summary><strong>Q2</strong>: AutoFeaturizerã®preset='fast'ã¨'all'ã®é•ã„ã¯ï¼Ÿã„ã¤'all'ã‚’ä½¿ã†ã¹ãã‹èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</summary>
            
            <p><strong>æ­£è§£</strong>:</p>
            <p><strong>preset='fast'</strong>: ç´„50ç‰¹å¾´é‡ã€30ç§’/1000åŒ–åˆç‰©<br>
            <strong>preset='all'</strong>: ç´„145ç‰¹å¾´é‡ï¼ˆMagpieå®Œå…¨ç‰ˆï¼‰ã€120ç§’/1000åŒ–åˆç‰©</p>
            
            <p><strong>'all'ã‚’ä½¿ã†ã¹ãå ´åˆ</strong>:</p>
            <ul>
                <li>ãƒ‡ãƒ¼ã‚¿æ•°ãŒååˆ†ï¼ˆ>10,000ã‚µãƒ³ãƒ—ãƒ«ï¼‰ã§éå­¦ç¿’ãƒªã‚¹ã‚¯ãŒä½ã„</li>
                <li>ç²¾åº¦ãŒæœ€å„ªå…ˆï¼ˆè¨ˆç®—æ™‚é–“ã¯è¨±å®¹ï¼‰</li>
                <li>ç‰¹å¾´é‡é‡è¦åº¦åˆ†æã§æœ€é©ãªè¨˜è¿°å­ã‚’æ¢ç´¢ã—ãŸã„</li>
            </ul>
            
            <p><strong>è§£èª¬</strong>: preset='express'ï¼ˆ22ç‰¹å¾´é‡ï¼‰â†’ 'fast'ï¼ˆ50ç‰¹å¾´é‡ï¼‰â†’ 'all'ï¼ˆ145ç‰¹å¾´é‡ï¼‰ã¨ã€ç‰¹å¾´é‡æ•°ãŒå¢—ãˆã‚‹ã»ã©ç²¾åº¦å‘ä¸Šã®å¯èƒ½æ€§ãŒã‚ã‚‹ä¸€æ–¹ã€è¨ˆç®—æ™‚é–“ã¨éå­¦ç¿’ãƒªã‚¹ã‚¯ã‚‚å¢—åŠ ã—ã¾ã™ã€‚</p>
        </details>

        <details>
            <summary><strong>Q3</strong>: Materials Project APIã§ã€Œæº–å®‰å®šææ–™ã€ï¼ˆenergy_above_hull < 0.1 eV/atomï¼‰ã‚‚å–å¾—ã™ã‚‹ç†ç”±ã¯ï¼Ÿ</summary>
            
            <p><strong>æ­£è§£</strong>: æº–å®‰å®šææ–™ã¯ç†±åŠ›å­¦çš„ã«å®Œå…¨å®‰å®šã§ã¯ãªã„ãŒã€å®Ÿç”¨ä¸Šåˆæˆå¯èƒ½ã§ã€æœ‰ç”¨ãªç‰¹æ€§ã‚’æŒã¤ã“ã¨ãŒå¤šã„ãŸã‚ã€‚</p>
            
            <p><strong>è©³ç´°è§£èª¬</strong>:</p>
            <ul>
                <li><strong>energy_above_hull = 0</strong>: å®Œå…¨å®‰å®šï¼ˆå‡¸åŒ…ä¸Šï¼‰</li>
                <li><strong>0 < e_above_hull < 0.1</strong>: æº–å®‰å®šï¼ˆå®Ÿç”¨çš„ã«åˆæˆå¯èƒ½ï¼‰</li>
                <li><strong>e_above_hull > 0.1</strong>: ä¸å®‰å®šï¼ˆåˆæˆå›°é›£ï¼‰</li>
            </ul>
            
            <p><strong>å®Ÿä¾‹</strong>: ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ï¼ˆe_above_hull â‰ˆ 0.0025 eV/atomï¼‰ã¯æº–å®‰å®šã ãŒã€å®Ÿç”¨ææ–™ã¨ã—ã¦é‡è¦ã€‚</p>
            
            <pre><code class="language-python"># å®‰å®šæ€§åˆ¥ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ä¾‹
stable_only = mpr.materials.summary.search(
    energy_above_hull=(0, 0.001),  # å®Œå…¨å®‰å®šã®ã¿
    fields=["material_id", "formula_pretty"]
)

metastable = mpr.materials.summary.search(
    energy_above_hull=(0.001, 0.1),  # æº–å®‰å®šææ–™
    fields=["material_id", "formula_pretty"]
)

print(f"å®Œå…¨å®‰å®šææ–™: {len(stable_only)}")
print(f"æº–å®‰å®šææ–™: {len(metastable)}")
# å‡ºåŠ›ä¾‹: å®Œå…¨å®‰å®šææ–™: 15,234 / æº–å®‰å®šææ–™: 42,156
</code></pre>
        </details>

        <details>
            <summary><strong>Q4</strong>: scikit-learn Pipelineã«matminer Featurizerã‚’çµ±åˆã™ã‚‹éš›ã€<code>ignore_errors=True</code>ã‚’ä½¿ã†ç†ç”±ã¯ï¼Ÿ</summary>
            
            <p><strong>æ­£è§£</strong>: ä¸€éƒ¨ã®åŒ–å­¦å¼ã§ç‰¹å¾´é‡ç”Ÿæˆã«å¤±æ•—ã—ã¦ã‚‚ã€å…¨ä½“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œã‚’ä¸­æ–­ã›ãšã«ç¶™ç¶šã™ã‚‹ãŸã‚ã€‚</p>
            
            <p><strong>è©³ç´°è§£èª¬</strong>:</p>
            <p>matminer Featurizerã¯ã€ä»¥ä¸‹ã®å ´åˆã«ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š</p>
            <ul>
                <li>æœªçŸ¥ã®å…ƒç´ ï¼ˆè¶…é‡å…ƒç´ ç­‰ï¼‰</li>
                <li>å…ƒç´ ç‰¹æ€§ãƒ‡ãƒ¼ã‚¿ã®æ¬ æ</li>
                <li>ç„¡åŠ¹ãªé…¸åŒ–çŠ¶æ…‹</li>
            </ul>
            
            <p><code>ignore_errors=True</code>ã‚’è¨­å®šã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸè¡Œã«ã¯NaNãŒå…¥ã‚Šã€å¾Œã§<code>dropna()</code>ã§é™¤å»ã§ãã¾ã™ã€‚</p>
            
            <pre><code class="language-python"># ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¯”è¼ƒ
# âŒ æ‚ªã„ä¾‹: ignore_errors=Falseï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
df = featurizer.featurize_dataframe(df, 'composition')
# â†’ 1ã¤ã®ã‚¨ãƒ©ãƒ¼ã§å…¨ä½“ãŒåœæ­¢

# âœ… è‰¯ã„ä¾‹: ignore_errors=True
df = featurizer.featurize_dataframe(df, 'composition', ignore_errors=True)
df_clean = df.dropna()  # ã‚¨ãƒ©ãƒ¼è¡Œã‚’é™¤å»
print(f"æˆåŠŸ: {len(df_clean)} / å…¨ä½“: {len(df)}")
</code></pre>
        </details>

        <h3>Mediumï¼ˆå¿œç”¨ï¼‰</h3>

        <details>
            <summary><strong>Q5</strong>: Random Forestã®å…¨æ±ºå®šæœ¨äºˆæ¸¬ã‹ã‚‰ä¸ç¢ºå®Ÿæ€§ã‚’æ¨å®šã™ã‚‹æ–¹æ³•ã‚’å®Ÿè£…ã—ã€ä¿¡é ¼åº¦ãŒä½ã„ï¼ˆstd > 0.3ï¼‰äºˆæ¸¬ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚</summary>
            
            <p><strong>è§£ç­”ä¾‹</strong>:</p>
            <pre><code class="language-python"># Random Forestä¸ç¢ºå®Ÿæ€§æ¨å®š
from sklearn.ensemble import RandomForestRegressor
import numpy as np

# è¨“ç·´æ¸ˆã¿Random Forestãƒ¢ãƒ‡ãƒ«
rf_model = pipeline.named_steps['model']

# å…¨æ±ºå®šæœ¨ã§äºˆæ¸¬
tree_predictions = np.array([
    tree.predict(pipeline.named_steps['scaler'].transform(X_test))
    for tree in rf_model.estimators_
])

# äºˆæ¸¬ã®å¹³å‡ã¨æ¨™æº–åå·®
y_pred_mean = tree_predictions.mean(axis=0)
y_pred_std = tree_predictions.std(axis=0)

# ä¿¡é ¼åº¦åˆ†é¡
low_confidence_mask = y_pred_std > 0.3
high_confidence_mask = y_pred_std <= 0.3

print(f"é«˜ä¿¡é ¼åº¦äºˆæ¸¬: {high_confidence_mask.sum()} ã‚µãƒ³ãƒ—ãƒ«")
print(f"ä½ä¿¡é ¼åº¦äºˆæ¸¬: {low_confidence_mask.sum()} ã‚µãƒ³ãƒ—ãƒ«")

# ä½ä¿¡é ¼åº¦ã‚µãƒ³ãƒ—ãƒ«ã®åˆ†æ
low_conf_indices = np.where(low_confidence_mask)[0]
for idx in low_conf_indices[:5]:
    print(f"\\nã‚µãƒ³ãƒ—ãƒ« {idx}:")
    print(f"  äºˆæ¸¬å€¤: {y_pred_mean[idx]:.3f} Â± {y_pred_std[idx]:.3f}")
    print(f"  å®Ÿæ¸¬å€¤: {y_test[idx]:.3f}")
    print(f"  åŒ–å­¦å¼: {df_clean.iloc[idx]['formula']}")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# é«˜ä¿¡é ¼åº¦äºˆæ¸¬: 1,856 ã‚µãƒ³ãƒ—ãƒ«
# ä½ä¿¡é ¼åº¦äºˆæ¸¬: 119 ã‚µãƒ³ãƒ—ãƒ«
#
# ã‚µãƒ³ãƒ—ãƒ« 23:
#   äºˆæ¸¬å€¤: -1.234 Â± 0.456
#   å®Ÿæ¸¬å€¤: -0.987
#   åŒ–å­¦å¼: CuFeO2
</code></pre>
            
            <p><strong>è§£èª¬</strong>: æ¨™æº–åå·®ãŒå¤§ãã„äºˆæ¸¬ã¯ã€è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã«é¡ä¼¼ã‚µãƒ³ãƒ—ãƒ«ãŒå°‘ãªã„ã€ã¾ãŸã¯è¤‡é›‘ãªææ–™ç³»ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºå”†ã—ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªäºˆæ¸¬ã«ã¯è¿½åŠ ã®å®Ÿé¨“æ¤œè¨¼ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚</p>
        </details>

        <details>
            <summary><strong>Q6</strong>: matminerã®Featurizerã‚’scikit-learn Pipelineã«çµ±åˆã™ã‚‹éš›ã€<code>StandardScaler</code>ã‚’ä½¿ã†ç†ç”±ã¨ã€ãã®ä½ç½®ï¼ˆFeaturizerã®å‰ or å¾Œï¼‰ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</summary>
            
            <p><strong>æ­£è§£</strong>: Featurizerã®**å¾Œ**ï¼ˆç‰¹å¾´é‡ç”Ÿæˆå¾Œï¼‰ã«é…ç½®ã—ã€ç‰¹å¾´é‡ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚’æ­£è¦åŒ–ã™ã‚‹ãŸã‚ã€‚</p>
            
            <p><strong>è©³ç´°è§£èª¬</strong>:</p>
            <p>matminer Featurizerã¯å…ƒç´ ç‰¹æ€§ã‹ã‚‰çµ±è¨ˆé‡ï¼ˆå¹³å‡ã€æœ€å¤§ã€æœ€å°ç­‰ï¼‰ã‚’è¨ˆç®—ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ç•°ãªã‚‹ã‚¹ã‚±ãƒ¼ãƒ«ã‚’æŒã¤ãŸã‚ï¼š</p>
            <ul>
                <li>åŸå­ç•ªå·: 1-118</li>
                <li>åŸå­åŠå¾„: 30-300 pm</li>
                <li>é›»æ°—é™°æ€§åº¦: 0.7-4.0</li>
                <li>èç‚¹: 14-3,683 K</li>
            </ul>
            
            <p>StandardScalerã§æ­£è¦åŒ–ï¼ˆå¹³å‡0ã€æ¨™æº–åå·®1ï¼‰ã™ã‚‹ã“ã¨ã§ï¼š</p>
            <ol>
                <li>ã‚¹ã‚±ãƒ¼ãƒ«ã®å¤§ãã„ç‰¹å¾´é‡ãŒæ”¯é…çš„ã«ãªã‚‹ã®ã‚’é˜²ã</li>
                <li>å‹¾é…é™ä¸‹æ³•ã®åæŸã‚’é«˜é€ŸåŒ–ï¼ˆNeural Networkç­‰ï¼‰</li>
                <li>è·é›¢ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆKNNã€SVMï¼‰ã®æ€§èƒ½å‘ä¸Š</li>
            </ol>
            
            <pre><code class="language-python"># âœ… æ­£ã—ã„Pipelineæ§‹æˆ
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestRegressor

pipeline = Pipeline([
    # ('featurizer', matminer_featurizer),  # é€šå¸¸ã¯DataFrameæ®µéšã§å®Ÿè¡Œ
    ('scaler', StandardScaler()),  # Featurizerå¾Œã«æ­£è¦åŒ–
    ('model', RandomForestRegressor())
])

# âŒ é–“é•ã„: Featurizerã®å‰ã«Scaler
# â†’ Composition objectã¯ã‚¹ã‚±ãƒ¼ãƒ«ã§ããªã„
</code></pre>
        </details>

        <details>
            <summary><strong>Q7</strong>: 10,000åŒ–åˆç‰©ã®Matbenchãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã€Chapter 4ã®Matbenchãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯è¡¨ï¼ˆçµ„æˆãƒ™ãƒ¼ã‚¹ vs GNNï¼‰ã‚’å†ç¾ã—ã¦ãã ã•ã„ã€‚Random Forestã§å½¢æˆã‚¨ãƒãƒ«ã‚®ãƒ¼äºˆæ¸¬ã®MAEã‚’è¨ˆç®—ã—ã€CGCNNï¼ˆMAE=0.039ï¼‰ã¨æ¯”è¼ƒã—ã¦ãã ã•ã„ã€‚</summary>
            
            <p><strong>è§£ç­”ä¾‹</strong>:</p>
            <pre><code class="language-python"># Matbenchãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å†ç¾
from matminer.featurizers.composition import ElementProperty
from sklearn.model_selection import cross_val_score
from sklearn.ensemble import RandomForestRegressor
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import Pipeline
import numpy as np

# Matbenchå½¢æˆã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆç°¡ç•¥ç‰ˆã€å®Ÿéš›ã¯matbenchã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ï¼‰
# from matbench.bench import MatbenchBenchmark
# mb = MatbenchBenchmark(autoload=False)
# task = mb.matbench_mp_e_form

# ç°¡ç•¥åŒ–ã®ãŸã‚ã€MP APIã‹ã‚‰10,000åŒ–åˆç‰©å–å¾—ï¼ˆå‰è¿°ã®ã‚³ãƒ¼ãƒ‰ï¼‰
# df, X, y = ... (å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å–å¾—æ¸ˆã¿)

# Pipelineæ§‹ç¯‰ï¼ˆMagpieç‰¹å¾´é‡ + Random Forestï¼‰
pipeline = Pipeline([
    ('scaler', StandardScaler()),
    ('model', RandomForestRegressor(
        n_estimators=200,
        max_depth=30,
        min_samples_split=5,
        random_state=42,
        n_jobs=-1
    ))
])

# 5-fold Cross Validation
cv_scores = cross_val_score(
    pipeline, X, y,
    cv=5,
    scoring='neg_mean_absolute_error',
    n_jobs=-1
)

mae_composition = -cv_scores.mean()
mae_std = cv_scores.std()

print("=== Matbenchãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ¯”è¼ƒ ===")
print(f"çµ„æˆãƒ™ãƒ¼ã‚¹ï¼ˆMagpie + RFï¼‰: MAE = {mae_composition:.3f} Â± {mae_std:.3f} eV/atom")
print(f"GNNï¼ˆCGCNNï¼‰:              MAE = 0.039 eV/atomï¼ˆæ–‡çŒ®å€¤ï¼‰")
print(f"\\næ€§èƒ½æ¯”: CGCNN / Composition = {mae_composition / 0.039:.2f}x é«˜ç²¾åº¦")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === Matbenchãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ¯”è¼ƒ ===
# çµ„æˆãƒ™ãƒ¼ã‚¹ï¼ˆMagpie + RFï¼‰: MAE = 0.124 Â± 0.008 eV/atom
# GNNï¼ˆCGCNNï¼‰:              MAE = 0.039 eV/atomï¼ˆæ–‡çŒ®å€¤ï¼‰
#
# æ€§èƒ½æ¯”: CGCNN / Composition = 3.18x é«˜ç²¾åº¦
</code></pre>
            
            <p><strong>è§£èª¬</strong>: çµ„æˆãƒ™ãƒ¼ã‚¹ç‰¹å¾´é‡ã®ã¿ã§ã‚‚å®Ÿç”¨çš„ãªäºˆæ¸¬ï¼ˆMAE ~0.12 eV/atomï¼‰ãŒå¯èƒ½ã§ã™ãŒã€çµæ™¶æ§‹é€ æƒ…å ±ã‚’æ´»ç”¨ã™ã‚‹GNNã¯ç´„3å€ã®ç²¾åº¦ã‚’é”æˆã—ã¾ã™ã€‚ãŸã ã—ã€çµ„æˆãƒ™ãƒ¼ã‚¹ã¯ï¼š</p>
            <ul>
                <li>âœ… çµæ™¶æ§‹é€ ä¸è¦ï¼ˆæœªçŸ¥æ§‹é€ ææ–™ã«ã‚‚é©ç”¨å¯èƒ½ï¼‰</li>
                <li>âœ… è¨ˆç®—é€Ÿåº¦ãŒé€Ÿã„ï¼ˆGNNã®10-100å€ï¼‰</li>
                <li>âœ… è§£é‡ˆæ€§ãŒé«˜ã„ï¼ˆç‰¹å¾´é‡é‡è¦åº¦åˆ†æãŒå®¹æ˜“ï¼‰</li>
            </ul>
            <p>ç”¨é€”ã«å¿œã˜ã¦ä½¿ã„åˆ†ã‘ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚</p>
        </details>

        <h3>Hardï¼ˆç™ºå±•ï¼‰</h3>

        <details>
            <summary><strong>Q8</strong>: High-Entropy Alloyï¼ˆHEAã€ä¾‹: CoCrFeNiMnï¼‰ã®å½¢æˆã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’äºˆæ¸¬ã—ã€å„å…ƒç´ ã‚’1ã¤ãšã¤ç½®æ›ã—ãŸå ´åˆï¼ˆä¾‹: CuCrFeNiMnï¼‰ã®äºˆæ¸¬å¤‰åŒ–ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚</summary>
            
            <p><strong>è§£ç­”ä¾‹</strong>:</p>
            <pre><code class="language-python"># High-Entropy Alloyåˆ†æ
from pymatgen.core import Composition
import pandas as pd
import matplotlib.pyplot as plt

# å…ƒã®HEA
base_hea = "CoCrFeNiMn"
base_comp = Composition(base_hea)

# ç½®æ›å€™è£œå…ƒç´ 
substitute_elements = ['Cu', 'Ti', 'V', 'Zn', 'Mo', 'W', 'Al']

# å„å…ƒç´ ã‚’é †ç•ªã«ç½®æ›
results = []
for original_elem in ['Co', 'Cr', 'Fe', 'Ni', 'Mn']:
    for sub_elem in substitute_elements:
        # ç½®æ›HEAã®ç”Ÿæˆ
        new_formula = base_hea.replace(original_elem, sub_elem, 1)
        new_comp = Composition(new_formula)
        
        # ç‰¹å¾´é‡ç”Ÿæˆã¨äºˆæ¸¬
        feat_dict = {'composition': new_comp}
        feat_df = pd.DataFrame([feat_dict])
        feat_df = featurizer.featurize_dataframe(feat_df, 'composition', ignore_errors=True)
        
        if not feat_df.dropna().empty:
            X_pred = feat_df[feature_cols].values
            y_pred = loaded_pipeline.predict(X_pred)[0]
            
            results.append({
                'Original': original_elem,
                'Substitute': sub_elem,
                'Formula': new_formula,
                'Predicted_Hf': y_pred
            })

# å…ƒã®HEAäºˆæ¸¬
base_feat_df = pd.DataFrame([{'composition': base_comp}])
base_feat_df = featurizer.featurize_dataframe(base_feat_df, 'composition')
X_base = base_feat_df[feature_cols].values
y_base = loaded_pipeline.predict(X_base)[0]

results_df = pd.DataFrame(results)
results_df['Delta_Hf'] = results_df['Predicted_Hf'] - y_base

# æœ€ã‚‚å®‰å®šåŒ–ã™ã‚‹ç½®æ›
best_substitutions = results_df.nsmallest(5, 'Delta_Hf')
print("=== æœ€ã‚‚å®‰å®šåŒ–ã™ã‚‹å…ƒç´ ç½®æ›ï¼ˆTop 5ï¼‰===")
print(best_substitutions[['Original', 'Substitute', 'Formula', 'Delta_Hf']])

# å¯è¦–åŒ–
fig, ax = plt.subplots(figsize=(10, 6))
for original in ['Co', 'Cr', 'Fe', 'Ni', 'Mn']:
    subset = results_df[results_df['Original'] == original]
    ax.plot(subset['Substitute'], subset['Delta_Hf'], 
            marker='o', label=f'{original}ç½®æ›')

ax.axhline(y=0, color='r', linestyle='--', label='å…ƒã®HEA')
ax.set_xlabel('ç½®æ›å…ƒç´ ')
ax.set_ylabel('Î”å½¢æˆã‚¨ãƒãƒ«ã‚®ãƒ¼ (eV/atom)')
ax.set_title('HEAå…ƒç´ ç½®æ›ã®åŠ¹æœ')
ax.legend()
ax.grid(True, alpha=0.3)
plt.tight_layout()
plt.savefig('hea_substitution_analysis.png', dpi=300)

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === æœ€ã‚‚å®‰å®šåŒ–ã™ã‚‹å…ƒç´ ç½®æ›ï¼ˆTop 5ï¼‰===
#   Original Substitute    Formula  Delta_Hf
# 12       Cr          Cu  CoCuFeNiMn  -0.234
# 18       Fe          Al  CoCrAlNiMn  -0.189
# 23       Ni          Ti  CoCrFeTiMn  -0.156
# ...
</code></pre>
            
            <p><strong>è§£èª¬</strong>: ã“ã®åˆ†æã«ã‚ˆã‚Šã€HEAã®å®‰å®šæ€§ã‚’å‘ä¸Šã•ã›ã‚‹å…ƒç´ ç½®æ›ã‚’äºˆæ¸¬ã§ãã¾ã™ã€‚å®Ÿé¨“æ¤œè¨¼ã®å‰ã«ã€å¤šæ•°ã®å€™è£œã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§ã€ææ–™æ¢ç´¢ã‚’åŠ é€Ÿã§ãã¾ã™ã€‚</p>
        </details>

        <details>
            <summary><strong>Q9</strong>: Chapter 4ã®Stacking Regressorã‚’ä½¿ç”¨ã—ã¦ã€Random Forestã€XGBoostã€MLPã®3ã¤ã®ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ã—ã€å˜ä¸€ãƒ¢ãƒ‡ãƒ«ã‚ˆã‚Šã‚‚é«˜ç²¾åº¦ãªäºˆæ¸¬ã‚’å®Ÿç¾ã—ã¦ãã ã•ã„ã€‚</summary>
            
            <p><strong>è§£ç­”ä¾‹</strong>:</p>
            <pre><code class="language-python"># Stacking Ensembleå®Ÿè£…
from sklearn.ensemble import StackingRegressor, RandomForestRegressor, GradientBoostingRegressor
from sklearn.neural_network import MLPRegressor
from sklearn.linear_model import Ridge
from sklearn.model_selection import cross_val_score
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import Pipeline

# ãƒ™ãƒ¼ã‚¹å­¦ç¿’å™¨
base_estimators = [
    ('rf', RandomForestRegressor(
        n_estimators=100, max_depth=20, random_state=42, n_jobs=-1
    )),
    ('gb', GradientBoostingRegressor(
        n_estimators=100, max_depth=10, learning_rate=0.1, random_state=42
    )),
    ('mlp', MLPRegressor(
        hidden_layer_sizes=(128, 64), activation='relu', 
        max_iter=500, random_state=42
    ))
]

# ãƒ¡ã‚¿å­¦ç¿’å™¨ï¼ˆRidgeå›å¸°ï¼‰
meta_estimator = Ridge(alpha=1.0)

# Stacking Regressor
stacking_model = StackingRegressor(
    estimators=base_estimators,
    final_estimator=meta_estimator,
    cv=5,
    n_jobs=-1
)

# Pipeline with scaling
stacking_pipeline = Pipeline([
    ('scaler', StandardScaler()),
    ('stacking', stacking_model)
])

# è¨“ç·´ã¨è©•ä¾¡
stacking_pipeline.fit(X_train, y_train)
y_pred_stacking = stacking_pipeline.predict(X_test)
mae_stacking = mean_absolute_error(y_test, y_pred_stacking)
r2_stacking = r2_score(y_test, y_pred_stacking)

# å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«ã¨ã®æ¯”è¼ƒ
print("=== ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æ€§èƒ½æ¯”è¼ƒ ===")
for name, model in base_estimators:
    pipeline_single = Pipeline([('scaler', StandardScaler()), ('model', model)])
    pipeline_single.fit(X_train, y_train)
    y_pred_single = pipeline_single.predict(X_test)
    mae_single = mean_absolute_error(y_test, y_pred_single)
    print(f"{name.upper():5s}: MAE = {mae_single:.4f} eV/atom")

print(f"\\n{'STACK':5s}: MAE = {mae_stacking:.4f} eV/atom (RÂ² = {r2_stacking:.4f})")

# Cross-validationè©•ä¾¡
cv_scores_stacking = cross_val_score(
    stacking_pipeline, X_train, y_train,
    cv=5, scoring='neg_mean_absolute_error'
)
print(f"\\nCV MAE: {-cv_scores_stacking.mean():.4f} Â± {cv_scores_stacking.std():.4f}")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æ€§èƒ½æ¯”è¼ƒ ===
# RF   : MAE = 0.1234 eV/atom
# GB   : MAE = 0.1189 eV/atom
# MLP  : MAE = 0.1312 eV/atom
#
# STACK: MAE = 0.1156 eV/atom (RÂ² = 0.9087)
#
# CV MAE: 0.1178 Â± 0.0065
</code></pre>
            
            <p><strong>è§£èª¬</strong>: Stacking Ensembleã¯ã€å„ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã®å¼·ã¿ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€å˜ä¸€ãƒ¢ãƒ‡ãƒ«ã‚ˆã‚Šã‚‚ç´„3-5%ç²¾åº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚ãŸã ã—ã€è¨“ç·´æ™‚é–“ã¯3å€ä»¥ä¸Šã‹ã‹ã‚‹ãŸã‚ã€ç²¾åº¦ãŒæœ€å„ªå…ˆã®å ´åˆã«ä½¿ç”¨ã—ã¾ã™ã€‚</p>
        </details>

        <details>
            <summary><strong>Q10</strong>: 50,000åŒ–åˆç‰©ã®å¤§è¦æ¨¡äºˆæ¸¬ã‚’å®Ÿè¡Œã—ã€ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªãƒãƒƒãƒå‡¦ç†ï¼ˆãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º1,000ï¼‰ã¨ä¸¦åˆ—åŒ–ï¼ˆn_jobs=-1ï¼‰ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚å‡¦ç†é€Ÿåº¦ï¼ˆåŒ–åˆç‰©/ç§’ï¼‰ã‚’æ¸¬å®šã—ã¦ãã ã•ã„ã€‚</summary>
            
            <p><strong>è§£ç­”ä¾‹</strong>:</p>
            <pre><code class="language-python"># å¤§è¦æ¨¡ãƒãƒƒãƒäºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ 
import time
import numpy as np
from tqdm import tqdm

def batch_predict_optimized(model, formulas, batch_size=1000, n_jobs=-1):
    """ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªãƒãƒƒãƒäºˆæ¸¬
    
    Args:
        model: è¨“ç·´æ¸ˆã¿Pipeline
        formulas (list): åŒ–å­¦å¼ãƒªã‚¹ãƒˆ
        batch_size (int): ãƒãƒƒãƒã‚µã‚¤ã‚º
        n_jobs (int): ä¸¦åˆ—ã‚¸ãƒ§ãƒ–æ•°
        
    Returns:
        tuple: (predictions, elapsed_time, throughput)
    """
    from concurrent.futures import ProcessPoolExecutor, as_completed
    from pymatgen.core import Composition
    
    start_time = time.time()
    predictions = []
    n_batches = (len(formulas) + batch_size - 1) // batch_size
    
    def process_batch(batch_formulas):
        """ãƒãƒƒãƒå‡¦ç†é–¢æ•°"""
        try:
            # åŒ–å­¦å¼â†’Compositionå¤‰æ›
            batch_comps = [Composition(f) for f in batch_formulas]
            batch_df = pd.DataFrame({'composition': batch_comps})
            
            # ç‰¹å¾´é‡ç”Ÿæˆ
            batch_df = featurizer.featurize_dataframe(
                batch_df, 'composition', ignore_errors=True
            )
            batch_df = batch_df.dropna(subset=feature_cols)
            
            if len(batch_df) > 0:
                X_batch = batch_df[feature_cols].values
                return model.predict(X_batch)
            else:
                return np.array([])
        except Exception as e:
            print(f"Batch error: {e}")
            return np.array([])
    
    # ä¸¦åˆ—ãƒãƒƒãƒå‡¦ç†
    with ProcessPoolExecutor(max_workers=n_jobs if n_jobs > 0 else None) as executor:
        futures = []
        for i in range(n_batches):
            start_idx = i * batch_size
            end_idx = min((i + 1) * batch_size, len(formulas))
            batch_formulas = formulas[start_idx:end_idx]
            futures.append(executor.submit(process_batch, batch_formulas))
        
        # çµæœåé›†ï¼ˆé€²æ—è¡¨ç¤ºä»˜ãï¼‰
        for future in tqdm(as_completed(futures), total=n_batches, desc="Processing"):
            batch_preds = future.result()
            if len(batch_preds) > 0:
                predictions.extend(batch_preds)
    
    elapsed_time = time.time() - start_time
    throughput = len(predictions) / elapsed_time if elapsed_time > 0 else 0
    
    return np.array(predictions), elapsed_time, throughput

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆ50,000åŒ–åˆç‰©ï¼‰
# å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã¯çœç•¥ã€ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ä»£ç”¨
np.random.seed(42)
elements_pool = ['Li', 'Na', 'K', 'Mg', 'Ca', 'Al', 'Ti', 'Fe', 'Cu', 'Zn', 'O', 'S', 'N']
test_formulas = []
for _ in range(50000):
    n_elem = np.random.randint(2, 4)
    elem_set = np.random.choice(elements_pool, n_elem, replace=False)
    formula = ''.join([f"{e}{np.random.randint(1,3)}" for e in elem_set])
    test_formulas.append(formula)

print("=== å¤§è¦æ¨¡ãƒãƒƒãƒäºˆæ¸¬å®Ÿè¡Œ ===")
print(f"å¯¾è±¡åŒ–åˆç‰©æ•°: {len(test_formulas):,}")
print(f"ãƒãƒƒãƒã‚µã‚¤ã‚º: 1,000")
print(f"ä¸¦åˆ—åŒ–: CPUå…¨ã‚³ã‚¢ä½¿ç”¨\n")

# predictions, elapsed, throughput = batch_predict_optimized(
#     loaded_pipeline, test_formulas, batch_size=1000, n_jobs=-1
# )

# æ¨å®šçµæœï¼ˆå®Ÿéš›ã®å®Ÿè¡Œæ™‚é–“ã¯ç’°å¢ƒä¾å­˜ï¼‰
print("æ¨å®šæ€§èƒ½:")
print(f"å‡¦ç†æ™‚é–“: ~5-7åˆ†ï¼ˆCPU 8ã‚³ã‚¢ï¼‰")
print(f"ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ: ~120-150 åŒ–åˆç‰©/ç§’")
print(f"ãƒ¡ãƒ¢ãƒªä½¿ç”¨: ~2-3 GBï¼ˆãƒ”ãƒ¼ã‚¯ï¼‰")
print(f"\\næœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ:")
print("- ãƒãƒƒãƒã‚µã‚¤ã‚º: 500-1,000ãŒæœ€é©ï¼ˆãƒ¡ãƒ¢ãƒª vs é€Ÿåº¦ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ï¼‰")
print("- n_jobs=-1: CPUå…¨ã‚³ã‚¢æ´»ç”¨ã§ç·šå½¢ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°")
print("- ProcessPoolExecutor: GILåˆ¶ç´„ã‚’å›é¿")
</code></pre>
            
            <p><strong>è§£èª¬</strong>: å¤§è¦æ¨¡äºˆæ¸¬ã§ã¯ã€ãƒ¡ãƒ¢ãƒªç®¡ç†ã¨ä¸¦åˆ—åŒ–ãŒé‡è¦ã§ã™ã€‚ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’é©åˆ‡ã«è¨­å®šã—ï¼ˆ1,000å‰å¾Œï¼‰ã€å…¨CPUã‚³ã‚¢ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€æ•°ä¸‡åŒ–åˆç‰©ã®äºˆæ¸¬ã‚’æ•°åˆ†ã§å®Œäº†ã§ãã¾ã™ã€‚</p>
        </details>
        <h2>å‚è€ƒæ–‡çŒ®</h2>
        <ol>
            <li>Ward, L. et al. (2018). "Matminer: An open source toolkit for materials data mining." <em>Computational Materials Science</em>, 152, 60-69.</li>
            <li>Dunn, A. et al. (2020). "Benchmarking materials property prediction methods: the Matbench test set and Automatminer reference algorithm." <em>npj Computational Materials</em>, 6, 138, pp. 5-8.</li>
            <li>Ong, S.P. et al. (2015). "The Materials Application Programming Interface (API)." <em>Computational Materials Science</em>, 97, 209-215.</li>
            <li>Materials Project API Documentation. https://docs.materialsproject.org/</li>
            <li>matminer Examples Gallery. https://hackingmaterials.lbl.gov/matminer/examples/</li>
            <li>pandas Documentation: Data manipulation. https://pandas.pydata.org/docs/</li>
            <li>matplotlib/seaborn Documentation. https://matplotlib.org/</li>
        </ol>

        <h2>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h2>
        <p>ğŸ‰ <strong>ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</strong> çµ„æˆãƒ™ãƒ¼ã‚¹ç‰¹å¾´é‡å…¥é–€ã‚·ãƒªãƒ¼ã‚ºã‚’å®Œäº†ã—ã¾ã—ãŸã€‚</p>
        
        <p>æ¬¡ã®å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹:</p>
        <ul>
            <li><strong>gnn-features-comparison</strong>: çµ„æˆãƒ™ãƒ¼ã‚¹ vs GNNæ§‹é€ ãƒ™ãƒ¼ã‚¹ç‰¹å¾´é‡ã®è©³ç´°æ¯”è¼ƒ</li>
            <li><strong>Advanced MI Topics</strong>: è»¢ç§»å­¦ç¿’ã€Active Learningã€ãƒ™ã‚¤ã‚ºæœ€é©åŒ–</li>
            <li><strong>å®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</strong>: Kaggle Materials Science competitions</li>
        </ul>

        <div class="nav-buttons">
            <a href="chapter-4.html" class="nav-button">â† ç¬¬4ç« : æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã¨ã®çµ±åˆ</a>
            <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
        </div>

        <section class="disclaimer">
<h3>å…è²¬äº‹é …</h3>
<ul>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹Code examplesã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
<li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
<li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
</ul>
</section>

<footer>
            <p>Â© 2025 AIå¯ºå­å±‹ - Yusuke Hashimoto, Tohoku University</p>
            <p><a href="mailto:yusuke.hashimoto.b8@tohoku.ac.jp">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ»è³ªå•ã¯ã“ã¡ã‚‰</a></p>
        </footer>
    </div>
</body>
</html>
