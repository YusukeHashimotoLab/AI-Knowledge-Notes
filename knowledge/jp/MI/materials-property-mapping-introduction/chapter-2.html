<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }
        .disclaimer {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            border-radius: 4px;
        }

        .disclaimer h3 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .disclaimer ul {
            list-style: none;
            padding-left: 0;
        }

        .disclaimer li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.6;
        }

        .disclaimer li::before {
            content: "âš ï¸";
            position: absolute;
            left: 0;
        }


        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\(', '\)']],
                displayMath: [['$$', '$$'], ['\[', '\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
            <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="/AI-Knowledge-Notes/knowledge/jp/index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="/AI-Knowledge-Notes/knowledge/jp/MI/index.html">ãƒãƒ†ãƒªã‚¢ãƒ«ã‚ºãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹</a><span class="breadcrumb-separator">â€º</span><a href="/AI-Knowledge-Notes/knowledge/jp/MI/materials-property-mapping-introduction/index.html">Materials Property Mapping</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 2</span>
        </div>
    </nav>

        <header>
        <div class="header-content">
            <h1>Chapter</h1>
            <p class="subtitle"></p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 20-25åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: åˆç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 0å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 0å•</span>
            </div>
        </div>
    </header>

    <main class="container">
<h1>ç¬¬2ç« ï¼šæ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã«ã‚ˆã‚‹ææ–™ç©ºé–“ã®ãƒãƒƒãƒ”ãƒ³ã‚°</h1>
<h2>æ¦‚è¦</h2>
<p>é«˜æ¬¡å…ƒã®ææ–™ç‰¹æ€§ãƒ‡ãƒ¼ã‚¿ã‚’2æ¬¡å…ƒãƒ»3æ¬¡å…ƒã«å°„å½±ã™ã‚‹ã“ã¨ã§ã€ææ–™é–“ã®é¡ä¼¼æ€§ã‚„æ§‹é€ ã‚’è¦–è¦šçš„ã«æŠŠæ¡ã§ãã¾ã™ã€‚æœ¬ç« ã§ã¯ã€ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ã€t-SNEã€UMAPãªã©ã®æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã‚’ææ–™ãƒ‡ãƒ¼ã‚¿ã«é©ç”¨ã—ã€åŠ¹æœçš„ãªææ–™ç©ºé–“ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã¾ã™ã€‚</p>
<h3>å­¦ç¿’ç›®æ¨™</h3>
<ul>
<li>PCAã€t-SNEã€UMAPã®åŸç†ã¨ç‰¹å¾´ã‚’ç†è§£ã™ã‚‹</li>
<li>å„æ‰‹æ³•ã‚’ææ–™ãƒ‡ãƒ¼ã‚¿ã«é©ç”¨ã—ã€çµæœã‚’æ¯”è¼ƒã§ãã‚‹</li>
<li>æ¬¡å…ƒå‰Šæ¸›çµæœã®å“è³ªã‚’è©•ä¾¡ã§ãã‚‹</li>
<li>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªå¯è¦–åŒ–ã‚’å®Ÿè£…ã§ãã‚‹</li>
</ul>
<h2>2.1 ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰</h2>
<p>PCAã¯ã€ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ•£ã‚’æœ€å¤§åŒ–ã™ã‚‹æ–¹å‘ã«æ–°ã—ã„è»¸ï¼ˆä¸»æˆåˆ†ï¼‰ã‚’è¨­å®šã™ã‚‹ç·šå½¢æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã§ã™ã€‚ææ–™ç‰¹æ€§é–“ã®ç›¸é–¢æ§‹é€ ã‚’ä¿æŒã—ãªãŒã‚‰æ¬¡å…ƒã‚’å‰Šæ¸›ã§ãã¾ã™ã€‚</p>
<h3>2.1.1 PCAã®åŸºæœ¬å®Ÿè£…</h3>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹1: PCAã«ã‚ˆã‚‹æ¬¡å…ƒå‰Šæ¸›</h3>
<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.decomposition import PCA
from sklearn.preprocessing import StandardScaler

# ææ–™ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆç¬¬1ç« ã§ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ï¼‰
materials_data = pd.read_csv('materials_properties.csv')

# ç‰¹æ€§åˆ—ã®æŠ½å‡º
feature_cols = ['band_gap', 'formation_energy', 'density',
                'bulk_modulus', 'shear_modulus', 'melting_point']
X = materials_data[feature_cols].values

# æ¨™æº–åŒ–ï¼ˆPCAã¯ç‰¹æ€§ã®ã‚¹ã‚±ãƒ¼ãƒ«ã«æ•æ„Ÿï¼‰
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# PCAã®å®Ÿè¡Œï¼ˆ2æ¬¡å…ƒã«å‰Šæ¸›ï¼‰
pca = PCA(n_components=2)
X_pca = pca.fit_transform(X_scaled)

# çµæœã‚’DataFrameã«æ ¼ç´
materials_data['PC1'] = X_pca[:, 0]
materials_data['PC2'] = X_pca[:, 1]

# ä¸»æˆåˆ†ã®å¯„ä¸ç‡
explained_variance = pca.explained_variance_ratio_
print(&quot;ä¸»æˆåˆ†åˆ†æã®çµæœ:&quot;)
print(f&quot;PC1ã®å¯„ä¸ç‡: {explained_variance[0]:.3f}&quot;)
print(f&quot;PC2ã®å¯„ä¸ç‡: {explained_variance[1]:.3f}&quot;)
print(f&quot;ç´¯ç©å¯„ä¸ç‡: {sum(explained_variance):.3f}&quot;)

# ä¸»æˆåˆ†ã®æˆåˆ†ï¼ˆå„ç‰¹æ€§ã®é‡ã¿ï¼‰
components_df = pd.DataFrame(
    pca.components_.T,
    columns=['PC1', 'PC2'],
    index=feature_cols
)
print(&quot;\nä¸»æˆåˆ†ã®æˆåˆ†ï¼ˆå„ç‰¹æ€§ã®å¯„ä¸ï¼‰:&quot;)
print(components_df.round(3))
</code></pre>
<p><strong>å‡ºåŠ›ä¾‹</strong>:</p>
<pre><code>ä¸»æˆåˆ†åˆ†æã®çµæœ:
PC1ã®å¯„ä¸ç‡: 0.342
PC2ã®å¯„ä¸ç‡: 0.234
ç´¯ç©å¯„ä¸ç‡: 0.576

ä¸»æˆåˆ†ã®æˆåˆ†ï¼ˆå„ç‰¹æ€§ã®å¯„ä¸ï¼‰:
                       PC1     PC2
band_gap            -0.245   0.512
formation_energy     0.387  -0.298
density              0.456   0.321
bulk_modulus         0.498   0.145
shear_modulus        0.445   0.087
melting_point        0.312   -0.687
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹2: PCAçµæœã®å¯è¦–åŒ–</h3>
<pre><code class="language-python">import matplotlib.pyplot as plt
import numpy as np

# PCAã‚¹ã‚³ã‚¢ãƒ—ãƒ­ãƒƒãƒˆ
fig, ax = plt.subplots(figsize=(12, 9))

# å®‰å®šæ€§ã§ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘
colors = materials_data['formation_energy'].apply(
    lambda x: 'green' if x &lt; -1.0 else 'orange' if x &lt; 0 else 'red'
)

scatter = ax.scatter(materials_data['PC1'],
                     materials_data['PC2'],
                     c=colors,
                     s=50,
                     alpha=0.6,
                     edgecolors='black',
                     linewidth=0.5)

# è»¸ãƒ©ãƒ™ãƒ«ï¼ˆå¯„ä¸ç‡ã‚’å«ã‚€ï¼‰
ax.set_xlabel(f'PC1 ({explained_variance[0]*100:.1f}% variance)',
              fontsize=14, fontweight='bold')
ax.set_ylabel(f'PC2 ({explained_variance[1]*100:.1f}% variance)',
              fontsize=14, fontweight='bold')
ax.set_title('PCA: Materials Space Visualization',
             fontsize=16, fontweight='bold')

# ã‚°ãƒªãƒƒãƒ‰
ax.grid(True, alpha=0.3, linestyle='--')
ax.axhline(y=0, color='k', linestyle='-', linewidth=0.5, alpha=0.5)
ax.axvline(x=0, color='k', linestyle='-', linewidth=0.5, alpha=0.5)

# å‡¡ä¾‹
from matplotlib.patches import Patch
legend_elements = [
    Patch(facecolor='green', edgecolor='black', label='Stable (E &lt; -1 eV)'),
    Patch(facecolor='orange', edgecolor='black', label='Metastable (-1 &lt; E &lt; 0 eV)'),
    Patch(facecolor='red', edgecolor='black', label='Unstable (E &gt; 0 eV)')
]
ax.legend(handles=legend_elements, loc='best', fontsize=12)

plt.tight_layout()
plt.savefig('pca_materials_space.png', dpi=300, bbox_inches='tight')
print(&quot;PCAã‚¹ã‚³ã‚¢ãƒ—ãƒ­ãƒƒãƒˆã‚’ pca_materials_space.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.show()
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹3: PCAå¯„ä¸ç‡ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ—ãƒ­ãƒƒãƒˆ</h3>
<pre><code class="language-python">import matplotlib.pyplot as plt
from sklearn.decomposition import PCA

# å…¨ä¸»æˆåˆ†ã‚’è¨ˆç®—
pca_full = PCA()
pca_full.fit(X_scaled)

# ã‚¹ã‚¯ãƒªãƒ¼ãƒ—ãƒ­ãƒƒãƒˆ
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(15, 6))

# å·¦: å„ä¸»æˆåˆ†ã®å¯„ä¸ç‡
n_components = len(pca_full.explained_variance_ratio_)
ax1.bar(range(1, n_components + 1),
        pca_full.explained_variance_ratio_,
        alpha=0.7,
        edgecolor='black',
        color='steelblue')
ax1.set_xlabel('Principal Component', fontsize=14, fontweight='bold')
ax1.set_ylabel('Explained Variance Ratio', fontsize=14, fontweight='bold')
ax1.set_title('Scree Plot: Individual Variance', fontsize=16, fontweight='bold')
ax1.grid(True, alpha=0.3, axis='y')

# å³: ç´¯ç©å¯„ä¸ç‡
cumsum_variance = np.cumsum(pca_full.explained_variance_ratio_)
ax2.plot(range(1, n_components + 1),
         cumsum_variance,
         marker='o',
         linewidth=2,
         markersize=8,
         color='darkred')
ax2.axhline(y=0.95, color='green', linestyle='--', linewidth=2,
            label='95% variance threshold', alpha=0.7)
ax2.set_xlabel('Number of Components', fontsize=14, fontweight='bold')
ax2.set_ylabel('Cumulative Explained Variance', fontsize=14, fontweight='bold')
ax2.set_title('Cumulative Variance Explained', fontsize=16, fontweight='bold')
ax2.grid(True, alpha=0.3)
ax2.legend(fontsize=12)

plt.tight_layout()
plt.savefig('pca_scree_plot.png', dpi=300, bbox_inches='tight')
print(f&quot;ã‚¹ã‚¯ãƒªãƒ¼ãƒ—ãƒ­ãƒƒãƒˆã‚’ pca_scree_plot.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
print(f&quot;\n95%ã®åˆ†æ•£ã‚’èª¬æ˜ã™ã‚‹ãŸã‚ã«å¿…è¦ãªä¸»æˆåˆ†æ•°: {np.argmax(cumsum_variance &gt;= 0.95) + 1}&quot;)
plt.show()
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹4: PCAãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ—ãƒ­ãƒƒãƒˆï¼ˆãƒã‚¤ãƒ—ãƒ­ãƒƒãƒˆï¼‰</h3>
<pre><code class="language-python">import matplotlib.pyplot as plt
import numpy as np

# ãƒã‚¤ãƒ—ãƒ­ãƒƒãƒˆ
fig, ax = plt.subplots(figsize=(12, 10))

# ã‚¹ã‚³ã‚¢ãƒ—ãƒ­ãƒƒãƒˆï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
ax.scatter(materials_data['PC1'],
           materials_data['PC2'],
           alpha=0.3,
           s=20,
           color='lightblue',
           edgecolors='none',
           label='Materials')

# ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆå¤‰æ•°ï¼‰
scale_factor = 3.0  # ãƒ™ã‚¯ãƒˆãƒ«ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
for i, feature in enumerate(feature_cols):
    ax.arrow(0, 0,
             pca.components_[0, i] * scale_factor,
             pca.components_[1, i] * scale_factor,
             head_width=0.15,
             head_length=0.15,
             fc='red',
             ec='darkred',
             linewidth=2,
             alpha=0.8)

    # ãƒ©ãƒ™ãƒ«
    ax.text(pca.components_[0, i] * scale_factor * 1.15,
            pca.components_[1, i] * scale_factor * 1.15,
            feature.replace('_', ' ').title(),
            fontsize=11,
            fontweight='bold',
            ha='center',
            va='center',
            bbox=dict(boxstyle='round,pad=0.5', facecolor='yellow', alpha=0.7))

ax.set_xlabel(f'PC1 ({explained_variance[0]*100:.1f}% variance)',
              fontsize=14, fontweight='bold')
ax.set_ylabel(f'PC2 ({explained_variance[1]*100:.1f}% variance)',
              fontsize=14, fontweight='bold')
ax.set_title('PCA Biplot: Materials and Features',
             fontsize=16, fontweight='bold')

ax.grid(True, alpha=0.3, linestyle='--')
ax.axhline(y=0, color='k', linestyle='-', linewidth=0.5)
ax.axvline(x=0, color='k', linestyle='-', linewidth=0.5)
ax.legend(fontsize=12, loc='upper right')

plt.tight_layout()
plt.savefig('pca_biplot.png', dpi=300, bbox_inches='tight')
print(&quot;PCAãƒã‚¤ãƒ—ãƒ­ãƒƒãƒˆã‚’ pca_biplot.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.show()
</code></pre>
<h2>2.2 t-SNEï¼ˆt-Distributed Stochastic Neighbor Embeddingï¼‰</h2>
<p>t-SNEã¯ã€é«˜æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã®å±€æ‰€çš„ãªæ§‹é€ ï¼ˆè¿‘å‚é–¢ä¿‚ï¼‰ã‚’ä¿æŒã—ãªãŒã‚‰ä½æ¬¡å…ƒã«å°„å½±ã™ã‚‹éç·šå½¢æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã§ã™ã€‚ã‚¯ãƒ©ã‚¹ã‚¿æ§‹é€ ã®å¯è¦–åŒ–ã«å„ªã‚Œã¦ã„ã¾ã™ã€‚</p>
<h3>2.2.1 t-SNEã®åŸºæœ¬å®Ÿè£…</h3>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹5: t-SNEã«ã‚ˆã‚‹æ¬¡å…ƒå‰Šæ¸›</h3>
<pre><code class="language-python">from sklearn.manifold import TSNE
import numpy as np
import time

# t-SNEã®å®Ÿè¡Œï¼ˆè¤‡æ•°ã®perplexityã§å®Ÿé¨“ï¼‰
perplexities = [5, 30, 50]
tsne_results = {}

for perplexity in perplexities:
    print(f&quot;\nt-SNE (perplexity={perplexity}) ã‚’å®Ÿè¡Œä¸­...&quot;)
    start_time = time.time()

    tsne = TSNE(n_components=2,
                perplexity=perplexity,
                n_iter=1000,
                random_state=42,
                verbose=0)

    X_tsne = tsne.fit_transform(X_scaled)
    tsne_results[perplexity] = X_tsne

    elapsed_time = time.time() - start_time
    print(f&quot;å®Œäº† (æ‰€è¦æ™‚é–“: {elapsed_time:.2f}ç§’)&quot;)
    print(f&quot;KL divergence: {tsne.kl_divergence_:.3f}&quot;)

# çµæœã®ä¿å­˜ï¼ˆperplexity=30ã®å ´åˆï¼‰
materials_data['tsne1'] = tsne_results[30][:, 0]
materials_data['tsne2'] = tsne_results[30][:, 1]
</code></pre>
<p><strong>å‡ºåŠ›ä¾‹</strong>:</p>
<pre><code>t-SNE (perplexity=5) ã‚’å®Ÿè¡Œä¸­...
å®Œäº† (æ‰€è¦æ™‚é–“: 3.45ç§’)
KL divergence: 1.234

t-SNE (perplexity=30) ã‚’å®Ÿè¡Œä¸­...
å®Œäº† (æ‰€è¦æ™‚é–“: 3.67ç§’)
KL divergence: 0.987

t-SNE (perplexity=50) ã‚’å®Ÿè¡Œä¸­...
å®Œäº† (æ‰€è¦æ™‚é–“: 3.89ç§’)
KL divergence: 1.056
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹6: ç•°ãªã‚‹perplexityã§ã®æ¯”è¼ƒ</h3>
<pre><code class="language-python">import matplotlib.pyplot as plt

# 3ã¤ã®perplexityã§ã®çµæœã‚’ä¸¦ã¹ã¦è¡¨ç¤º
fig, axes = plt.subplots(1, 3, figsize=(18, 6))

for idx, perplexity in enumerate(perplexities):
    ax = axes[idx]
    X_tsne = tsne_results[perplexity]

    scatter = ax.scatter(X_tsne[:, 0],
                         X_tsne[:, 1],
                         c=materials_data['band_gap'],
                         cmap='viridis',
                         s=50,
                         alpha=0.6,
                         edgecolors='black',
                         linewidth=0.5)

    ax.set_title(f't-SNE (perplexity={perplexity})',
                 fontsize=14, fontweight='bold')
    ax.set_xlabel('t-SNE 1', fontsize=12, fontweight='bold')
    ax.set_ylabel('t-SNE 2', fontsize=12, fontweight='bold')
    ax.grid(True, alpha=0.3, linestyle='--')

    # ã‚«ãƒ©ãƒ¼ãƒãƒ¼
    cbar = plt.colorbar(scatter, ax=ax)
    cbar.set_label('Band Gap (eV)', fontsize=10, fontweight='bold')

plt.tight_layout()
plt.savefig('tsne_perplexity_comparison.png', dpi=300, bbox_inches='tight')
print(&quot;t-SNE perplexityæ¯”è¼ƒã‚’ tsne_perplexity_comparison.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.show()
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹7: t-SNEã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°çµæœã®å¯è¦–åŒ–</h3>
<pre><code class="language-python">from sklearn.cluster import KMeans
import matplotlib.pyplot as plt

# t-SNEçµæœã«å¯¾ã—ã¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
n_clusters = 5
kmeans = KMeans(n_clusters=n_clusters, random_state=42, n_init=10)
cluster_labels = kmeans.fit_predict(tsne_results[30])

materials_data['cluster'] = cluster_labels

# ã‚¯ãƒ©ã‚¹ã‚¿ã”ã¨ã®å¯è¦–åŒ–
fig, ax = plt.subplots(figsize=(12, 9))

colors = plt.cm.Set3(np.linspace(0, 1, n_clusters))

for cluster_id in range(n_clusters):
    mask = cluster_labels == cluster_id
    ax.scatter(tsne_results[30][mask, 0],
               tsne_results[30][mask, 1],
               c=[colors[cluster_id]],
               label=f'Cluster {cluster_id}',
               s=60,
               alpha=0.7,
               edgecolors='black',
               linewidth=0.5)

# ã‚¯ãƒ©ã‚¹ã‚¿ä¸­å¿ƒ
centers_tsne = kmeans.cluster_centers_
ax.scatter(centers_tsne[:, 0],
           centers_tsne[:, 1],
           c='red',
           marker='X',
           s=300,
           edgecolors='black',
           linewidth=2,
           label='Cluster Centers',
           zorder=10)

ax.set_xlabel('t-SNE 1', fontsize=14, fontweight='bold')
ax.set_ylabel('t-SNE 2', fontsize=14, fontweight='bold')
ax.set_title(f't-SNE with K-Means Clustering (k={n_clusters})',
             fontsize=16, fontweight='bold')
ax.legend(fontsize=11, loc='best')
ax.grid(True, alpha=0.3, linestyle='--')

plt.tight_layout()
plt.savefig('tsne_clustering.png', dpi=300, bbox_inches='tight')
print(f&quot;t-SNEã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°çµæœã‚’ tsne_clustering.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.show()

# å„ã‚¯ãƒ©ã‚¹ã‚¿ã®ç‰¹æ€§å¹³å‡å€¤
print(&quot;\nã‚¯ãƒ©ã‚¹ã‚¿ã”ã¨ã®ç‰¹æ€§å¹³å‡å€¤:&quot;)
cluster_stats = materials_data.groupby('cluster')[feature_cols].mean()
print(cluster_stats.round(2))
</code></pre>
<h2>2.3 UMAPï¼ˆUniform Manifold Approximation and Projectionï¼‰</h2>
<p>UMAPã¯ã€t-SNEã‚ˆã‚Šã‚‚é«˜é€Ÿã§ã€å¤§åŸŸçš„æ§‹é€ ã‚‚ä¿æŒã™ã‚‹æœ€æ–°ã®æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã§ã™ã€‚å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã‚‚åŠ¹ç‡çš„ã«å‹•ä½œã—ã¾ã™ã€‚</p>
<h3>2.3.1 UMAPã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨åŸºæœ¬å®Ÿè£…</h3>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹8: UMAPã«ã‚ˆã‚‹æ¬¡å…ƒå‰Šæ¸›</h3>
<pre><code class="language-python"># UMAPã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
# !pip install umap-learn

import umap
import numpy as np
import time

# UMAPã®å®Ÿè¡Œï¼ˆè¤‡æ•°ã®n_neighborsã§å®Ÿé¨“ï¼‰
n_neighbors_list = [5, 15, 50]
umap_results = {}

for n_neighbors in n_neighbors_list:
    print(f&quot;\nUMAP (n_neighbors={n_neighbors}) ã‚’å®Ÿè¡Œä¸­...&quot;)
    start_time = time.time()

    reducer = umap.UMAP(n_components=2,
                        n_neighbors=n_neighbors,
                        min_dist=0.1,
                        metric='euclidean',
                        random_state=42)

    X_umap = reducer.fit_transform(X_scaled)
    umap_results[n_neighbors] = X_umap

    elapsed_time = time.time() - start_time
    print(f&quot;å®Œäº† (æ‰€è¦æ™‚é–“: {elapsed_time:.2f}ç§’)&quot;)

# çµæœã®ä¿å­˜ï¼ˆn_neighbors=15ã®å ´åˆï¼‰
materials_data['umap1'] = umap_results[15][:, 0]
materials_data['umap2'] = umap_results[15][:, 1]

print(&quot;\nUMAPå®Ÿè¡Œå®Œäº†ã€‚çµæœã‚’DataFrameã«ä¿å­˜ã—ã¾ã—ãŸã€‚&quot;)
</code></pre>
<p><strong>å‡ºåŠ›ä¾‹</strong>:</p>
<pre><code>UMAP (n_neighbors=5) ã‚’å®Ÿè¡Œä¸­...
å®Œäº† (æ‰€è¦æ™‚é–“: 1.23ç§’)

UMAP (n_neighbors=15) ã‚’å®Ÿè¡Œä¸­...
å®Œäº† (æ‰€è¦æ™‚é–“: 1.34ç§’)

UMAP (n_neighbors=50) ã‚’å®Ÿè¡Œä¸­...
å®Œäº† (æ‰€è¦æ™‚é–“: 1.45ç§’)

UMAPå®Ÿè¡Œå®Œäº†ã€‚çµæœã‚’DataFrameã«ä¿å­˜ã—ã¾ã—ãŸã€‚
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹9: ç•°ãªã‚‹n_neighborsã§ã®æ¯”è¼ƒ</h3>
<pre><code class="language-python">import matplotlib.pyplot as plt

# 3ã¤ã®n_neighborsã§ã®çµæœã‚’ä¸¦ã¹ã¦è¡¨ç¤º
fig, axes = plt.subplots(1, 3, figsize=(18, 6))

for idx, n_neighbors in enumerate(n_neighbors_list):
    ax = axes[idx]
    X_umap = umap_results[n_neighbors]

    scatter = ax.scatter(X_umap[:, 0],
                         X_umap[:, 1],
                         c=materials_data['formation_energy'],
                         cmap='RdYlGn_r',
                         s=50,
                         alpha=0.6,
                         edgecolors='black',
                         linewidth=0.5)

    ax.set_title(f'UMAP (n_neighbors={n_neighbors})',
                 fontsize=14, fontweight='bold')
    ax.set_xlabel('UMAP 1', fontsize=12, fontweight='bold')
    ax.set_ylabel('UMAP 2', fontsize=12, fontweight='bold')
    ax.grid(True, alpha=0.3, linestyle='--')

    # ã‚«ãƒ©ãƒ¼ãƒãƒ¼
    cbar = plt.colorbar(scatter, ax=ax)
    cbar.set_label('Formation Energy (eV/atom)', fontsize=10, fontweight='bold')

plt.tight_layout()
plt.savefig('umap_neighbors_comparison.png', dpi=300, bbox_inches='tight')
print(&quot;UMAP n_neighborsæ¯”è¼ƒã‚’ umap_neighbors_comparison.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.show()
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹10: UMAPå¯†åº¦ãƒãƒƒãƒ—</h3>
<pre><code class="language-python">import matplotlib.pyplot as plt
from scipy.stats import gaussian_kde

# UMAPçµæœã®å¯†åº¦æ¨å®š
X_umap = umap_results[15]

# KDEï¼ˆã‚«ãƒ¼ãƒãƒ«å¯†åº¦æ¨å®šï¼‰
xy = np.vstack([X_umap[:, 0], X_umap[:, 1]])
density = gaussian_kde(xy)(xy)

# å¯†åº¦ã§ã‚½ãƒ¼ãƒˆï¼ˆé«˜å¯†åº¦ç‚¹ã‚’ä¸Šã«æç”»ï¼‰
idx = density.argsort()
x, y, z = X_umap[idx, 0], X_umap[idx, 1], density[idx]

# ãƒ—ãƒ­ãƒƒãƒˆ
fig, ax = plt.subplots(figsize=(12, 9))

scatter = ax.scatter(x, y, c=z, cmap='hot', s=50, alpha=0.7,
                     edgecolors='black', linewidth=0.3)

ax.set_xlabel('UMAP 1', fontsize=14, fontweight='bold')
ax.set_ylabel('UMAP 2', fontsize=14, fontweight='bold')
ax.set_title('UMAP: Materials Space Density Map',
             fontsize=16, fontweight='bold')
ax.grid(True, alpha=0.3, linestyle='--')

cbar = plt.colorbar(scatter, ax=ax)
cbar.set_label('Point Density', fontsize=12, fontweight='bold')

plt.tight_layout()
plt.savefig('umap_density_map.png', dpi=300, bbox_inches='tight')
print(&quot;UMAPå¯†åº¦ãƒãƒƒãƒ—ã‚’ umap_density_map.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.show()
</code></pre>
<h2>2.4 æ‰‹æ³•ã®æ¯”è¼ƒ</h2>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹11: PCA vs t-SNE vs UMAPã®ä¸¦åˆ—æ¯”è¼ƒ</h3>
<pre><code class="language-python">import matplotlib.pyplot as plt

# 3ã¤ã®æ‰‹æ³•ã®çµæœã‚’ä¸¦ã¹ã¦è¡¨ç¤º
fig, axes = plt.subplots(1, 3, figsize=(18, 6))

# å…±é€šã®ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—ï¼ˆãƒãƒ³ãƒ‰ã‚®ãƒ£ãƒƒãƒ—ã§è‰²ä»˜ã‘ï¼‰
vmin = materials_data['band_gap'].min()
vmax = materials_data['band_gap'].max()

# PCA
ax = axes[0]
scatter = ax.scatter(materials_data['PC1'],
                     materials_data['PC2'],
                     c=materials_data['band_gap'],
                     cmap='viridis',
                     s=50,
                     alpha=0.6,
                     edgecolors='black',
                     linewidth=0.5,
                     vmin=vmin,
                     vmax=vmax)
ax.set_title('PCA', fontsize=16, fontweight='bold')
ax.set_xlabel('PC1', fontsize=12, fontweight='bold')
ax.set_ylabel('PC2', fontsize=12, fontweight='bold')
ax.grid(True, alpha=0.3, linestyle='--')

# t-SNE
ax = axes[1]
scatter = ax.scatter(materials_data['tsne1'],
                     materials_data['tsne2'],
                     c=materials_data['band_gap'],
                     cmap='viridis',
                     s=50,
                     alpha=0.6,
                     edgecolors='black',
                     linewidth=0.5,
                     vmin=vmin,
                     vmax=vmax)
ax.set_title('t-SNE', fontsize=16, fontweight='bold')
ax.set_xlabel('t-SNE 1', fontsize=12, fontweight='bold')
ax.set_ylabel('t-SNE 2', fontsize=12, fontweight='bold')
ax.grid(True, alpha=0.3, linestyle='--')

# UMAP
ax = axes[2]
scatter = ax.scatter(materials_data['umap1'],
                     materials_data['umap2'],
                     c=materials_data['band_gap'],
                     cmap='viridis',
                     s=50,
                     alpha=0.6,
                     edgecolors='black',
                     linewidth=0.5,
                     vmin=vmin,
                     vmax=vmax)
ax.set_title('UMAP', fontsize=16, fontweight='bold')
ax.set_xlabel('UMAP 1', fontsize=12, fontweight='bold')
ax.set_ylabel('UMAP 2', fontsize=12, fontweight='bold')
ax.grid(True, alpha=0.3, linestyle='--')

# å…±é€šã‚«ãƒ©ãƒ¼ãƒãƒ¼
fig.subplots_adjust(right=0.9)
cbar_ax = fig.add_axes([0.92, 0.15, 0.02, 0.7])
cbar = fig.colorbar(scatter, cax=cbar_ax)
cbar.set_label('Band Gap (eV)', fontsize=12, fontweight='bold')

plt.savefig('dimensionality_reduction_comparison.png', dpi=300, bbox_inches='tight')
print(&quot;æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•æ¯”è¼ƒã‚’ dimensionality_reduction_comparison.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.show()
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹12: è¿‘å‚ä¿å­˜ç‡ã®è©•ä¾¡</h3>
<pre><code class="language-python">from sklearn.neighbors import NearestNeighbors
import numpy as np

def calculate_neighborhood_preservation(X_high, X_low, k=10):
    &quot;&quot;&quot;
    é«˜æ¬¡å…ƒç©ºé–“ã¨ä½æ¬¡å…ƒç©ºé–“ã§ã®è¿‘å‚ä¿å­˜ç‡ã‚’è¨ˆç®—

    Parameters:
    -----------
    X_high : array-like
        é«˜æ¬¡å…ƒç©ºé–“ã®ãƒ‡ãƒ¼ã‚¿
    X_low : array-like
        ä½æ¬¡å…ƒç©ºé–“ã®ãƒ‡ãƒ¼ã‚¿
    k : int
        è¿‘å‚ã®æ•°

    Returns:
    --------
    preservation_rate : float
        è¿‘å‚ä¿å­˜ç‡ï¼ˆ0-1ï¼‰
    &quot;&quot;&quot;
    # é«˜æ¬¡å…ƒç©ºé–“ã§ã®kè¿‘å‚
    nbrs_high = NearestNeighbors(n_neighbors=k+1).fit(X_high)
    _, indices_high = nbrs_high.kneighbors(X_high)

    # ä½æ¬¡å…ƒç©ºé–“ã§ã®kè¿‘å‚
    nbrs_low = NearestNeighbors(n_neighbors=k+1).fit(X_low)
    _, indices_low = nbrs_low.kneighbors(X_low)

    # è¿‘å‚ä¿å­˜ç‡ã®è¨ˆç®—
    preservation_scores = []
    for i in range(len(X_high)):
        # è‡ªåˆ†è‡ªèº«ã‚’é™¤ã
        neighbors_high = set(indices_high[i, 1:])
        neighbors_low = set(indices_low[i, 1:])

        # å…±é€šã™ã‚‹è¿‘å‚ã®å‰²åˆ
        intersection = len(neighbors_high &amp; neighbors_low)
        preservation_scores.append(intersection / k)

    return np.mean(preservation_scores)

# å„æ‰‹æ³•ã®è¿‘å‚ä¿å­˜ç‡ã‚’è©•ä¾¡
k_values = [5, 10, 20, 50]
results = {
    'PCA': [],
    't-SNE': [],
    'UMAP': []
}

for k in k_values:
    pca_preservation = calculate_neighborhood_preservation(
        X_scaled, X_pca, k=k
    )
    tsne_preservation = calculate_neighborhood_preservation(
        X_scaled, tsne_results[30], k=k
    )
    umap_preservation = calculate_neighborhood_preservation(
        X_scaled, umap_results[15], k=k
    )

    results['PCA'].append(pca_preservation)
    results['t-SNE'].append(tsne_preservation)
    results['UMAP'].append(umap_preservation)

    print(f&quot;k={k}ã§ã®è¿‘å‚ä¿å­˜ç‡:&quot;)
    print(f&quot;  PCA:   {pca_preservation:.3f}&quot;)
    print(f&quot;  t-SNE: {tsne_preservation:.3f}&quot;)
    print(f&quot;  UMAP:  {umap_preservation:.3f}&quot;)
    print()

# çµæœã®ãƒ—ãƒ­ãƒƒãƒˆ
fig, ax = plt.subplots(figsize=(10, 7))

for method, scores in results.items():
    ax.plot(k_values, scores, marker='o', linewidth=2,
            markersize=8, label=method)

ax.set_xlabel('Number of Neighbors (k)', fontsize=14, fontweight='bold')
ax.set_ylabel('Neighborhood Preservation Rate', fontsize=14, fontweight='bold')
ax.set_title('Comparison of Neighborhood Preservation',
             fontsize=16, fontweight='bold')
ax.legend(fontsize=12)
ax.grid(True, alpha=0.3, linestyle='--')
ax.set_ylim([0, 1])

plt.tight_layout()
plt.savefig('neighborhood_preservation.png', dpi=300, bbox_inches='tight')
print(&quot;è¿‘å‚ä¿å­˜ç‡æ¯”è¼ƒã‚’ neighborhood_preservation.png ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.show()
</code></pre>
<h2>2.5 ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªå¯è¦–åŒ–</h2>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹13: Plotlyã«ã‚ˆã‚‹3D UMAP</h3>
<pre><code class="language-python"># Plotlyã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
# !pip install plotly

import plotly.express as px
import plotly.graph_objects as go
import umap

# 3æ¬¡å…ƒUMAPã®å®Ÿè¡Œ
reducer_3d = umap.UMAP(n_components=3,
                       n_neighbors=15,
                       min_dist=0.1,
                       random_state=42)

X_umap_3d = reducer_3d.fit_transform(X_scaled)

materials_data['umap1_3d'] = X_umap_3d[:, 0]
materials_data['umap2_3d'] = X_umap_3d[:, 1]
materials_data['umap3_3d'] = X_umap_3d[:, 2]

# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–3Dãƒ—ãƒ­ãƒƒãƒˆ
fig = px.scatter_3d(materials_data,
                    x='umap1_3d',
                    y='umap2_3d',
                    z='umap3_3d',
                    color='band_gap',
                    size='density',
                    hover_data=['formula', 'formation_energy', 'bulk_modulus'],
                    color_continuous_scale='Viridis',
                    title='Interactive 3D UMAP: Materials Space')

fig.update_traces(marker=dict(line=dict(width=0.5, color='black')))

fig.update_layout(
    scene=dict(
        xaxis_title='UMAP 1',
        yaxis_title='UMAP 2',
        zaxis_title='UMAP 3',
        xaxis=dict(backgroundcolor=&quot;rgb(230, 230,230)&quot;,
                   gridcolor=&quot;white&quot;),
        yaxis=dict(backgroundcolor=&quot;rgb(230, 230,230)&quot;,
                   gridcolor=&quot;white&quot;),
        zaxis=dict(backgroundcolor=&quot;rgb(230, 230,230)&quot;,
                   gridcolor=&quot;white&quot;),
    ),
    width=900,
    height=700,
    font=dict(size=12)
)

fig.write_html('umap_3d_interactive.html')
print(&quot;ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–3D UMAPã‚’ umap_3d_interactive.html ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
fig.show()
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹14: Bokehã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ•£å¸ƒå›³</h3>
<pre><code class="language-python"># Bokehã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
# !pip install bokeh

from bokeh.plotting import figure, output_file, save
from bokeh.models import HoverTool, ColorBar, LinearColorMapper
from bokeh.palettes import Viridis256
from bokeh.io import show

# ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ‘ãƒ¼
color_mapper = LinearColorMapper(palette=Viridis256,
                                 low=materials_data['band_gap'].min(),
                                 high=materials_data['band_gap'].max())

# ãƒ—ãƒ­ãƒƒãƒˆã®ä½œæˆ
output_file('umap_interactive.html')

p = figure(width=900,
           height=700,
           title='Interactive UMAP: Materials Space',
           tools='pan,wheel_zoom,box_zoom,reset,save')

# ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
source_data = dict(
    x=materials_data['umap1'],
    y=materials_data['umap2'],
    formula=materials_data['formula'],
    band_gap=materials_data['band_gap'],
    formation_energy=materials_data['formation_energy'],
    density=materials_data['density'],
    bulk_modulus=materials_data['bulk_modulus']
)

# æ•£å¸ƒå›³
circles = p.circle('x', 'y',
                   size=8,
                   source=source_data,
                   fill_color={'field': 'band_gap', 'transform': color_mapper},
                   fill_alpha=0.7,
                   line_color='black',
                   line_width=0.5)

# ãƒ›ãƒãƒ¼ãƒ„ãƒ¼ãƒ«
hover = HoverTool(tooltips=[
    ('Formula', '@formula'),
    ('Band Gap', '@band_gap{0.00} eV'),
    ('Formation E', '@formation_energy{0.00} eV/atom'),
    ('Density', '@density{0.00} g/cmÂ³'),
    ('Bulk Modulus', '@bulk_modulus{0.0} GPa')
])
p.add_tools(hover)

# ã‚«ãƒ©ãƒ¼ãƒãƒ¼
color_bar = ColorBar(color_mapper=color_mapper,
                     label_standoff=12,
                     title='Band Gap (eV)',
                     location=(0, 0))
p.add_layout(color_bar, 'right')

# è»¸ãƒ©ãƒ™ãƒ«
p.xaxis.axis_label = 'UMAP 1'
p.yaxis.axis_label = 'UMAP 2'
p.title.text_font_size = '16pt'
p.xaxis.axis_label_text_font_size = '14pt'
p.yaxis.axis_label_text_font_size = '14pt'

save(p)
print(&quot;ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–UMAPã‚’ umap_interactive.html ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
show(p)
</code></pre>
<h3>ã‚³ãƒ¼ãƒ‰ä¾‹15: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹æ¬¡å…ƒå‰Šæ¸›ãƒ—ãƒ­ã‚»ã‚¹ã®å¯è¦–åŒ–</h3>
<pre><code class="language-python">import matplotlib.pyplot as plt
import matplotlib.animation as animation
from sklearn.decomposition import PCA
import numpy as np

# å¤šæ®µéšPCAã«ã‚ˆã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
n_frames = 20
fig, ax = plt.subplots(figsize=(10, 8))

# åˆæœŸ3D PCA
pca_3d = PCA(n_components=3)
X_pca_3d = pca_3d.fit_transform(X_scaled)

def update(frame):
    ax.clear()

    # å›è»¢è§’åº¦
    angle = frame * (360 / n_frames)
    angle_rad = np.radians(angle)

    # å›è»¢è¡Œåˆ—ã‚’é©ç”¨
    rotation_matrix = np.array([
        [np.cos(angle_rad), -np.sin(angle_rad), 0],
        [np.sin(angle_rad), np.cos(angle_rad), 0],
        [0, 0, 1]
    ])

    X_rotated = X_pca_3d @ rotation_matrix

    # 2DæŠ•å½±
    scatter = ax.scatter(X_rotated[:, 0],
                         X_rotated[:, 1],
                         c=materials_data['band_gap'],
                         cmap='viridis',
                         s=50,
                         alpha=0.6,
                         edgecolors='black',
                         linewidth=0.5)

    ax.set_xlabel('Dimension 1', fontsize=12, fontweight='bold')
    ax.set_ylabel('Dimension 2', fontsize=12, fontweight='bold')
    ax.set_title(f'3D PCA Rotation (angle={angle:.0f}Â°)',
                 fontsize=14, fontweight='bold')
    ax.grid(True, alpha=0.3, linestyle='--')

    # è»¸ã®ç¯„å›²ã‚’å›ºå®š
    ax.set_xlim(X_rotated[:, 0].min() - 1, X_rotated[:, 0].max() + 1)
    ax.set_ylim(X_rotated[:, 1].min() - 1, X_rotated[:, 1].max() + 1)

    return scatter,

# ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
anim = animation.FuncAnimation(fig, update, frames=n_frames,
                               interval=200, blit=False)

# GIFã¨ã—ã¦ä¿å­˜
anim.save('pca_rotation_animation.gif', writer='pillow', fps=5)
print(&quot;PCAå›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ pca_rotation_animation.gif ã«ä¿å­˜ã—ã¾ã—ãŸ&quot;)
plt.close()
</code></pre>
<h2>2.6 ã¾ã¨ã‚</h2>
<p>æœ¬ç« ã§ã¯ã€æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã‚’ç”¨ã„ãŸææ–™ç©ºé–“ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸï¼š</p>
<h3>ä¸»è¦ãªæ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•</h3>
<table>
<thead>
<tr>
<th>æ‰‹æ³•</th>
<th>ç‰¹å¾´</th>
<th>åˆ©ç‚¹</th>
<th>æ¬ ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PCA</strong></td>
<td>ç·šå½¢ã€åˆ†æ•£æœ€å¤§åŒ–</td>
<td>é«˜é€Ÿã€è§£é‡ˆæ€§é«˜ã„</td>
<td>éç·šå½¢æ§‹é€ ã«å¼±ã„</td>
</tr>
<tr>
<td><strong>t-SNE</strong></td>
<td>éç·šå½¢ã€è¿‘å‚ä¿å­˜</td>
<td>ã‚¯ãƒ©ã‚¹ã‚¿å¯è¦–åŒ–ã«å„ªã‚Œã‚‹</td>
<td>é…ã„ã€å¤§åŸŸæ§‹é€ æå¤±</td>
</tr>
<tr>
<td><strong>UMAP</strong></td>
<td>éç·šå½¢ã€ãƒˆãƒãƒ­ã‚¸ãƒ¼ä¿å­˜</td>
<td>é«˜é€Ÿã€å¤§åŸŸãƒ»å±€æ‰€ä¸¡ç«‹</td>
<td>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´å¿…è¦</td>
</tr>
</tbody>
</table>
<h3>å®Ÿè£…ã—ãŸã‚³ãƒ¼ãƒ‰</h3>
<table>
<thead>
<tr>
<th>ã‚³ãƒ¼ãƒ‰ä¾‹</th>
<th>å†…å®¹</th>
<th>æ‰‹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¾‹1-4</td>
<td>PCAåŸºæœ¬å®Ÿè£…ã€å¯è¦–åŒ–</td>
<td>PCA</td>
</tr>
<tr>
<td>ä¾‹5-7</td>
<td>t-SNEå®Ÿè£…ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¯”è¼ƒ</td>
<td>t-SNE</td>
</tr>
<tr>
<td>ä¾‹8-10</td>
<td>UMAPå®Ÿè£…ã€å¯†åº¦ãƒãƒƒãƒ—</td>
<td>UMAP</td>
</tr>
<tr>
<td>ä¾‹11-12</td>
<td>æ‰‹æ³•æ¯”è¼ƒã€è©•ä¾¡æŒ‡æ¨™</td>
<td>æ¯”è¼ƒ</td>
</tr>
<tr>
<td>ä¾‹13-15</td>
<td>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–</td>
<td>Plotly, Bokeh</td>
</tr>
</tbody>
</table>
<h3>ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h3>
<ol>
<li><strong>å‰å‡¦ç†</strong>: æ¨™æº–åŒ–ï¼ˆStandardScalerï¼‰ã¯å¿…é ˆ</li>
<li><strong>æ‰‹æ³•é¸æŠ</strong>:
   - è§£é‡ˆæ€§é‡è¦– â†’ PCA
   - ã‚¯ãƒ©ã‚¹ã‚¿ç™ºè¦‹ â†’ t-SNE
   - ãƒãƒ©ãƒ³ã‚¹é‡è¦– â†’ UMAP</li>
<li><strong>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´</strong>: è¤‡æ•°ã®è¨­å®šã§å®Ÿé¨“ã—ã€æœ€é©å€¤ã‚’æ¢ç´¢</li>
<li><strong>è©•ä¾¡</strong>: è¿‘å‚ä¿å­˜ç‡ãªã©å®šé‡çš„æŒ‡æ¨™ã§å“è³ªè©•ä¾¡</li>
</ol>
<h3>æ¬¡ç« ã¸ã®å±•æœ›</h3>
<p>ç¬¬3ç« ã§ã¯ã€Graph Neural Networksï¼ˆGNNï¼‰ã‚’ç”¨ã„ã¦ææ–™ã®æ§‹é€ æƒ…å ±ã‹ã‚‰ç‰¹å¾´è¡¨ç¾ã‚’å­¦ç¿’ã—ã€ã‚ˆã‚Šé«˜åº¦ãªææ–™ç©ºé–“ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã¾ã™ã€‚CGCNNã€MEGNetã€SchNetãªã©ã®æœ€æ–°GNNãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè£…ã—ã€çµæ™¶æ§‹é€ ã‚’ç›´æ¥å…¥åŠ›ã¨ã—ã¦æ¬¡å…ƒå‰Šæ¸›ã‚’è¡Œã„ã¾ã™ã€‚</p>
<hr />
<p><strong>å‰ç« </strong>: <a href="chapter-1.html">ç¬¬1ç« ï¼šææ–™ç©ºé–“å¯è¦–åŒ–ã®åŸºç¤</a></p>
<p><strong>æ¬¡ç« </strong>: <a href="chapter-3.html">ç¬¬3ç« ï¼šGNNã«ã‚ˆã‚‹ææ–™è¡¨ç¾å­¦ç¿’</a></p>
<p><strong>ã‚·ãƒªãƒ¼ã‚ºãƒˆãƒƒãƒ—</strong>: <a href="index.html">ææ–™ç‰¹æ€§ãƒãƒƒãƒ”ãƒ³ã‚°å…¥é–€</a></p><div class="navigation">
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
    <a href="chapter-3.html" class="nav-button">æ¬¡ã®ç«  â†’</a>
</div>
    </main>

    
    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

<footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-17</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
