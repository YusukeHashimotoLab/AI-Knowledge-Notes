<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¬¬5ç« ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿è§£æã¨å¯è¦–åŒ– - ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿è§£æå®Ÿè·µã‚·ãƒªãƒ¼ã‚º">
    <title>ç¬¬5ç« ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿è§£æã¨å¯è¦–åŒ– - ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿è§£æå®Ÿè·µ | PI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #11998e;
            --color-accent-light: #38ef7d;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #11998e;
            --color-link-hover: #0d7a6f;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--color-accent);
            margin-bottom: var(--spacing-xl);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        .disclaimer {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            border-radius: 4px;
        }

        .disclaimer h3 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .disclaimer ul {
            list-style: none;
            padding-left: 0;
        }

        .disclaimer li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.6;
        }

        .disclaimer li::before {
            content: "âš ï¸";
            position: absolute;
            left: 0;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ç¬¬5ç« ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿è§£æã¨å¯è¦–åŒ–</h1>
            <p class="subtitle">ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã¨å‹•çš„ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 40-45åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´šã€œä¸Šç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 10å€‹</span>
            </div>
        </div>
    </header>

    <main class="container">

<div class="learning-objectives">
<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ã¨ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°æŠ€è¡“ã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼ˆç§»å‹•çª“ï¼‰ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆå¢—åˆ†å­¦ç¿’ï¼‰ã‚’æ§‹ç¯‰ã§ãã‚‹</li>
<li>âœ… Plotly Dashã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆã§ãã‚‹</li>
<li>âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼ˆInfluxDBã€TimescaleDBï¼‰ã‚’æ´»ç”¨ã§ãã‚‹</li>
<li>âœ… ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¨ç•°å¸¸æ¤œçŸ¥ã®è‡ªå‹•åŒ–ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… æœ¬ç•ªç’°å¢ƒã§ã®ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆãƒ»æœ€é©åŒ–ã§ãã‚‹</li>
</ul>
</div>

<hr />

<h2>5.1 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã®åŸºç¤</h2>

<h3>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®èª²é¡Œ</h3>

<p>åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã§ã¯ã€ä»¥ä¸‹ã®æŠ€è¡“çš„èª²é¡Œã«å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š</p>

<table>
<thead>
<tr>
<th>èª²é¡Œ</th>
<th>èª¬æ˜</th>
<th>è§£æ±ºç­–</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·</td>
<td>ãƒŸãƒªç§’ã€œç§’å˜ä½ã§ã®å¿œç­”</td>
<td>åŠ¹ç‡çš„ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°</td>
</tr>
<tr>
<td>é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ</td>
<td>å¤šæ•°ã®ã‚»ãƒ³ã‚µãƒ¼ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿</td>
<td>ä¸¦åˆ—å‡¦ç†ã€åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ </td>
</tr>
<tr>
<td>ãƒ‡ãƒ¼ã‚¿å“è³ª</td>
<td>æ¬ æå€¤ã€ãƒã‚¤ã‚ºã€å¤–ã‚Œå€¤</td>
<td>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</td>
</tr>
<tr>
<td>ãƒ¡ãƒ¢ãƒªåˆ¶ç´„</td>
<td>ç„¡é™ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ </td>
<td>ç§»å‹•çª“ã€ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ </td>
</tr>
<tr>
<td>ãƒ¢ãƒ‡ãƒ«é©å¿œ</td>
<td>ãƒ—ãƒ­ã‚»ã‚¹æ¡ä»¶ã®å¤‰åŒ–</td>
<td>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã€é©å¿œã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </td>
</tr>
</tbody>
</table>

<hr />

<h2>5.2 ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿å‡¦ç†</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹1: pandasã«ã‚ˆã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®åŸºç¤</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from collections import deque
import time

class StreamingDataProcessor:
    """
    ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã‚¯ãƒ©ã‚¹

    Parameters:
    -----------
    window_size : int
        ç§»å‹•çª“ã®ã‚µã‚¤ã‚ºï¼ˆãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆæ•°ï¼‰
    sampling_rate : float
        ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ [Hz]
    """

    def __init__(self, window_size=100, sampling_rate=1.0):
        self.window_size = window_size
        self.sampling_rate = sampling_rate

        # ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ•ã‚¡ï¼ˆé«˜é€Ÿãªdequeã‚’ä½¿ç”¨ï¼‰
        self.buffer = deque(maxlen=window_size)

        # çµ±è¨ˆé‡ã®å±¥æ­´
        self.timestamps = []
        self.means = []
        self.stds = []
        self.mins = []
        self.maxs = []

    def add_data_point(self, value, timestamp=None):
        """
        æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ 

        Parameters:
        -----------
        value : float
            ãƒ‡ãƒ¼ã‚¿å€¤
        timestamp : float
            ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆNoneã®å ´åˆã¯ç¾åœ¨æ™‚åˆ»ï¼‰
        """
        if timestamp is None:
            timestamp = time.time()

        self.buffer.append(value)

        # çµ±è¨ˆé‡ã®è¨ˆç®—ï¼ˆçª“å†…ã®ãƒ‡ãƒ¼ã‚¿ï¼‰
        if len(self.buffer) > 0:
            data_array = np.array(self.buffer)
            self.timestamps.append(timestamp)
            self.means.append(np.mean(data_array))
            self.stds.append(np.std(data_array))
            self.mins.append(np.min(data_array))
            self.maxs.append(np.max(data_array))

    def get_statistics(self):
        """
        ç¾åœ¨ã®çª“ã§ã®çµ±è¨ˆé‡ã‚’å–å¾—

        Returns:
        --------
        stats : dict
            çµ±è¨ˆé‡ã®è¾æ›¸
        """
        if len(self.buffer) == 0:
            return {}

        data_array = np.array(self.buffer)
        return {
            'mean': np.mean(data_array),
            'std': np.std(data_array),
            'min': np.min(data_array),
            'max': np.max(data_array),
            'median': np.median(data_array),
            'count': len(data_array)
        }

    def detect_anomaly(self, threshold_std=3.0):
        """
        ç•°å¸¸æ¤œçŸ¥ï¼ˆç§»å‹•å¹³å‡ Â± threshold_std Ã— æ¨™æº–åå·®ï¼‰

        Parameters:
        -----------
        threshold_std : float
            æ¨™æº–åå·®ã®å€æ•°ï¼ˆé–¾å€¤ï¼‰

        Returns:
        --------
        is_anomaly : bool
            ç•°å¸¸ã‹ã©ã†ã‹
        """
        if len(self.buffer) < 2:
            return False

        data_array = np.array(self.buffer)
        mean = np.mean(data_array)
        std = np.std(data_array)
        latest_value = data_array[-1]

        # 3ã‚·ã‚°ãƒãƒ«ãƒ¼ãƒ«
        is_anomaly = abs(latest_value - mean) > threshold_std * std

        return is_anomaly


# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å‡¦ç†
np.random.seed(42)

# ãƒ—ãƒ­ã‚»ãƒƒã‚µã®åˆæœŸåŒ–
processor = StreamingDataProcessor(window_size=50, sampling_rate=10.0)

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã¨ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†
n_points = 300
anomaly_indices = [100, 150, 250]  # ç•°å¸¸ã‚’æ³¨å…¥ã™ã‚‹ä½ç½®

for i in range(n_points):
    # é€šå¸¸ãƒ‡ãƒ¼ã‚¿ + ç•°å¸¸
    if i in anomaly_indices:
        value = 180 + np.random.randn() * 15  # ç•°å¸¸ã«å¤§ããªå¤‰å‹•
    else:
        value = 180 + 2 * np.sin(0.1 * i) + np.random.randn() * 1

    # ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ 
    processor.add_data_point(value, timestamp=i)

    # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç•°å¸¸æ¤œçŸ¥
    if processor.detect_anomaly(threshold_std=3.0) and i > 50:
        print(f"Anomaly detected at time {i}: value = {value:.2f}")


# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 1, figsize=(14, 10))

# ç”Ÿãƒ‡ãƒ¼ã‚¿ã¨ç§»å‹•å¹³å‡
time_axis = processor.timestamps
axes[0].plot(time_axis, processor.means, color='#11998e', linewidth=2, label='Moving Mean')
axes[0].fill_between(time_axis,
                      np.array(processor.means) - np.array(processor.stds),
                      np.array(processor.means) + np.array(processor.stds),
                      color='#11998e', alpha=0.2, label='Â±1Ïƒ')
axes[0].plot(time_axis, processor.mins, color='red', linewidth=1, alpha=0.5, label='Min/Max')
axes[0].plot(time_axis, processor.maxs, color='red', linewidth=1, alpha=0.5)

# ç•°å¸¸ä½ç½®ã‚’ãƒãƒ¼ã‚¯
for idx in anomaly_indices:
    if idx < len(time_axis):
        axes[0].axvline(x=time_axis[idx], color='red', linestyle='--',
                        linewidth=2, alpha=0.7)

axes[0].set_xlabel('Time [s]')
axes[0].set_ylabel('Temperature [Â°C]')
axes[0].set_title('Real-time Streaming Data Processing (Moving Window)', fontweight='bold')
axes[0].legend()
axes[0].grid(alpha=0.3)

# ç§»å‹•æ¨™æº–åå·®ï¼ˆå¤‰å‹•æ€§ã®ç›£è¦–ï¼‰
axes[1].plot(time_axis, processor.stds, color='orange', linewidth=2)
axes[1].axhline(y=np.mean(processor.stds) + 2*np.std(processor.stds),
                color='red', linestyle='--', linewidth=2, label='Threshold (Mean + 2Ïƒ)')
axes[1].set_xlabel('Time [s]')
axes[1].set_ylabel('Moving Std Dev [Â°C]')
axes[1].set_title('Process Variability Monitoring', fontweight='bold')
axes[1].legend()
axes[1].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# æœ€çµ‚çµ±è¨ˆ
final_stats = processor.get_statistics()
print("\nFinal Window Statistics:")
print("=" * 50)
for key, value in final_stats.items():
    print(f"{key:10s}: {value:10.4f}")
</code></pre>

<p><strong>è§£èª¬:</strong> <code>deque</code>ã‚’ä½¿ã£ãŸç§»å‹•çª“ã¯ã€å›ºå®šã‚µã‚¤ã‚ºã®ãƒãƒƒãƒ•ã‚¡ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã—ã€O(1)ã®æ™‚é–“è¤‡é›‘åº¦ã§æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã§ãã¾ã™ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç•°å¸¸æ¤œçŸ¥ã¯3ã‚·ã‚°ãƒãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãã€çµ±è¨ˆçš„ãªå¤–ã‚Œå€¤ã‚’æ¤œå‡ºã—ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹2: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼ˆEWMAï¼‰</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

class EWMAMonitor:
    """
    æŒ‡æ•°ç§»å‹•å¹³å‡ï¼ˆEWMAï¼‰ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

    Parameters:
    -----------
    alpha : float
        å¹³æ»‘åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ0 < alpha <= 1ï¼‰
        å°ã•ã„ã»ã©éå»ã®ãƒ‡ãƒ¼ã‚¿ã«é‡ã¿ã‚’ç½®ã
    """

    def __init__(self, alpha=0.1):
        self.alpha = alpha
        self.ewma = None
        self.ewmvar = None  # EWMA variance

        # å±¥æ­´
        self.values = []
        self.ewma_values = []
        self.ewmvar_values = []
        self.control_limits_upper = []
        self.control_limits_lower = []

    def update(self, new_value):
        """
        æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã§EWMAã‚’æ›´æ–°

        Parameters:
        -----------
        new_value : float
            æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿å€¤
        """
        # åˆæœŸåŒ–
        if self.ewma is None:
            self.ewma = new_value
            self.ewmvar = 0
        else:
            # EWMAæ›´æ–°
            self.ewma = self.alpha * new_value + (1 - self.alpha) * self.ewma

            # EWMAåˆ†æ•£æ›´æ–°
            deviation = new_value - self.ewma
            self.ewmvar = self.alpha * (deviation ** 2) + (1 - self.alpha) * self.ewmvar

        # ç®¡ç†é™ç•Œï¼ˆUCL/LCL: Upper/Lower Control Limitï¼‰
        ewm_std = np.sqrt(self.ewmvar)
        ucl = self.ewma + 3 * ewm_std
        lcl = self.ewma - 3 * ewm_std

        # å±¥æ­´ã«ä¿å­˜
        self.values.append(new_value)
        self.ewma_values.append(self.ewma)
        self.ewmvar_values.append(self.ewmvar)
        self.control_limits_upper.append(ucl)
        self.control_limits_lower.append(lcl)

    def is_out_of_control(self, threshold=3.0):
        """
        ç®¡ç†é™ç•Œã‚’è¶…ãˆã¦ã„ã‚‹ã‹åˆ¤å®š

        Returns:
        --------
        bool : ç®¡ç†é™ç•Œå¤–ã‹ã©ã†ã‹
        """
        if len(self.values) < 2:
            return False

        latest_value = self.values[-1]
        ucl = self.control_limits_upper[-1]
        lcl = self.control_limits_lower[-1]

        return latest_value > ucl or latest_value < lcl


# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
np.random.seed(42)
n_points = 300

# ãƒ—ãƒ­ã‚»ã‚¹ã‚·ãƒ•ãƒˆï¼ˆ100æ™‚ç‚¹ã€200æ™‚ç‚¹ã§å¹³å‡ãŒã‚·ãƒ•ãƒˆï¼‰
data = []
for i in range(n_points):
    if i < 100:
        value = 180 + np.random.randn() * 2
    elif i < 200:
        value = 185 + np.random.randn() * 2  # å¹³å‡ã‚·ãƒ•ãƒˆï¼ˆ+5Â°Cï¼‰
    else:
        value = 180 + np.random.randn() * 3  # å¤‰å‹•å¢—åŠ 

    data.append(value)

# EWMAãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
monitor = EWMAMonitor(alpha=0.2)

for i, value in enumerate(data):
    monitor.update(value)
    if monitor.is_out_of_control():
        print(f"Out of control at time {i}: value = {value:.2f}")

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 1, figsize=(14, 10))

time_axis = np.arange(len(data))

# EWMAç®¡ç†å›³
axes[0].plot(time_axis, monitor.values, color='gray', alpha=0.5,
             linewidth=1, label='Raw Data')
axes[0].plot(time_axis, monitor.ewma_values, color='#11998e',
             linewidth=2.5, label='EWMA')
axes[0].plot(time_axis, monitor.control_limits_upper, color='red',
             linestyle='--', linewidth=2, label='UCL/LCL')
axes[0].plot(time_axis, monitor.control_limits_lower, color='red',
             linestyle='--', linewidth=2)
axes[0].fill_between(time_axis, monitor.control_limits_lower,
                      monitor.control_limits_upper,
                      color='green', alpha=0.1, label='Control Region')

# ãƒ—ãƒ­ã‚»ã‚¹ã‚·ãƒ•ãƒˆä½ç½®ã‚’ãƒãƒ¼ã‚¯
axes[0].axvline(x=100, color='blue', linestyle=':', linewidth=2, alpha=0.7)
axes[0].axvline(x=200, color='blue', linestyle=':', linewidth=2, alpha=0.7)

axes[0].set_xlabel('Time [samples]')
axes[0].set_ylabel('Temperature [Â°C]')
axes[0].set_title('EWMA Control Chart (Î±=0.2)', fontweight='bold')
axes[0].legend()
axes[0].grid(alpha=0.3)

# EWMAåˆ†æ•£ï¼ˆå¤‰å‹•æ€§ç›£è¦–ï¼‰
axes[1].plot(time_axis, np.sqrt(monitor.ewmvar_values), color='orange', linewidth=2)
axes[1].set_xlabel('Time [samples]')
axes[1].set_ylabel('EWMA Std Dev [Â°C]')
axes[1].set_title('Process Variability (EWMA Variance)', fontweight='bold')
axes[1].axvline(x=200, color='blue', linestyle=':', linewidth=2, alpha=0.7,
                label='Variability Increase')
axes[1].legend()
axes[1].grid(alpha=0.3)

plt.tight_layout()
plt.show()

print(f"\nEWMA Monitor Summary:")
print(f"  Total samples: {len(data)}")
print(f"  Final EWMA: {monitor.ewma:.2f}")
print(f"  Final EWMA Std: {np.sqrt(monitor.ewmvar):.2f}")
</code></pre>

<p><strong>è§£èª¬:</strong> EWMAï¼ˆExponentially Weighted Moving Averageï¼‰ã¯ã€å°ã•ãªãƒ—ãƒ­ã‚»ã‚¹ã‚·ãƒ•ãƒˆã‚’è¿…é€Ÿã«æ¤œå‡ºã§ãã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–æ‰‹æ³•ã§ã™ã€‚å˜ç´”ç§»å‹•å¹³å‡ã‚ˆã‚Šã‚‚æœ€è¿‘ã®ãƒ‡ãƒ¼ã‚¿ã«é‡ã¿ã‚’ç½®ãã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒä½ã„ãŸã‚ã€åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®åˆ¶å¾¡ã«é©ã—ã¦ã„ã¾ã™ã€‚</p>

<hr />

<h2>5.3 ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ©Ÿæ¢°å­¦ç¿’</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹3: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç·šå½¢å›å¸°ï¼ˆå¢—åˆ†å­¦ç¿’ï¼‰</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from sklearn.linear_model import SGDRegressor
from sklearn.preprocessing import StandardScaler

class OnlineLinearRegressor:
    """
    ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã«ã‚ˆã‚‹ç·šå½¢å›å¸°ãƒ¢ãƒ‡ãƒ«

    Parameters:
    -----------
    learning_rate : str
        å­¦ç¿’ç‡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« ('constant', 'optimal', 'adaptive')
    """

    def __init__(self, learning_rate='constant', eta0=0.01):
        self.model = SGDRegressor(
            learning_rate=learning_rate,
            eta0=eta0,
            random_state=42,
            warm_start=True  # å¢—åˆ†å­¦ç¿’ã‚’æœ‰åŠ¹åŒ–
        )
        self.scaler_X = StandardScaler()
        self.scaler_y = StandardScaler()
        self.is_fitted = False

        # å±¥æ­´
        self.predictions = []
        self.actuals = []
        self.errors = []

    def partial_fit(self, X, y):
        """
        æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã§éƒ¨åˆ†çš„ã«ãƒ•ã‚£ãƒƒãƒˆï¼ˆå¢—åˆ†å­¦ç¿’ï¼‰

        Parameters:
        -----------
        X : array-like, shape (n_samples, n_features)
            ç‰¹å¾´é‡
        y : array-like, shape (n_samples,)
            ç›®çš„å¤‰æ•°
        """
        X = np.atleast_2d(X)
        y = np.atleast_1d(y)

        # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
        if not self.is_fitted:
            self.scaler_X.fit(X)
            self.scaler_y.fit(y.reshape(-1, 1))
            self.is_fitted = True

        X_scaled = self.scaler_X.transform(X)
        y_scaled = self.scaler_y.transform(y.reshape(-1, 1)).ravel()

        # å¢—åˆ†å­¦ç¿’
        self.model.partial_fit(X_scaled, y_scaled)

    def predict(self, X):
        """
        äºˆæ¸¬

        Parameters:
        -----------
        X : array-like, shape (n_samples, n_features)
            ç‰¹å¾´é‡

        Returns:
        --------
        y_pred : array-like
            äºˆæ¸¬å€¤
        """
        if not self.is_fitted:
            return np.zeros(X.shape[0])

        X = np.atleast_2d(X)
        X_scaled = self.scaler_X.transform(X)
        y_scaled_pred = self.model.predict(X_scaled)
        y_pred = self.scaler_y.inverse_transform(y_scaled_pred.reshape(-1, 1)).ravel()

        return y_pred

    def update_and_predict(self, X, y):
        """
        äºˆæ¸¬ã—ã¦ã‹ã‚‰å­¦ç¿’ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã®å…¸å‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

        Parameters:
        -----------
        X : array-like
            ç‰¹å¾´é‡
        y : float
            å®Ÿéš›ã®å€¤

        Returns:
        --------
        y_pred : float
            äºˆæ¸¬å€¤
        """
        # äºˆæ¸¬
        y_pred = self.predict(X)

        # å­¦ç¿’
        self.partial_fit(X, y)

        # å±¥æ­´æ›´æ–°
        self.predictions.append(y_pred[0] if len(y_pred) > 0 else 0)
        self.actuals.append(y)
        self.errors.append(y - (y_pred[0] if len(y_pred) > 0 else 0))

        return y_pred[0] if len(y_pred) > 0 else 0


# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼šã‚ªãƒ³ãƒ©ã‚¤ãƒ³å›å¸°
np.random.seed(42)
n_samples = 500

# æ™‚é–“å¤‰åŒ–ã™ã‚‹ç·šå½¢é–¢ä¿‚ï¼ˆæ¦‚å¿µãƒ‰ãƒªãƒ•ãƒˆï¼‰
X_stream = []
y_stream = []

for i in range(n_samples):
    # ç‰¹å¾´é‡
    x1 = np.random.randn()
    x2 = np.random.randn()
    X_stream.append([x1, x2])

    # çœŸã®é–¢ä¿‚ï¼ˆæ™‚é–“ã¨ã¨ã‚‚ã«å¤‰åŒ–ï¼‰
    if i < 200:
        # Phase 1: y = 3*x1 + 2*x2
        y_true = 3*x1 + 2*x2
    elif i < 400:
        # Phase 2: y = 2*x1 + 4*x2 (é–¢ä¿‚æ€§ãŒå¤‰åŒ–)
        y_true = 2*x1 + 4*x2
    else:
        # Phase 3: y = 1*x1 + 5*x2 (ã•ã‚‰ã«å¤‰åŒ–)
        y_true = 1*x1 + 5*x2

    y_stream.append(y_true + np.random.randn() * 0.5)  # ãƒã‚¤ã‚ºè¿½åŠ 

X_stream = np.array(X_stream)
y_stream = np.array(y_stream)

# ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’
online_model = OnlineLinearRegressor(learning_rate='constant', eta0=0.01)

# åˆæœŸå­¦ç¿’ï¼ˆæœ€åˆã®10ã‚µãƒ³ãƒ—ãƒ«ï¼‰
online_model.partial_fit(X_stream[:10], y_stream[:10])

# ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å­¦ç¿’
for i in range(10, n_samples):
    X_current = X_stream[i:i+1]
    y_current = y_stream[i]
    online_model.update_and_predict(X_current, y_current)


# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 1, figsize=(14, 10))

time_axis = np.arange(10, n_samples)

# äºˆæ¸¬ vs å®Ÿéš›
axes[0].plot(time_axis, online_model.actuals, color='#11998e',
             linewidth=1.5, label='Actual', alpha=0.7)
axes[0].plot(time_axis, online_model.predictions, color='orange',
             linewidth=2, label='Predicted (Online)', linestyle='--')
axes[0].axvline(x=200, color='red', linestyle=':', linewidth=2, alpha=0.7,
                label='Concept Drift')
axes[0].axvline(x=400, color='red', linestyle=':', linewidth=2, alpha=0.7)
axes[0].set_xlabel('Time [samples]')
axes[0].set_ylabel('Target Value')
axes[0].set_title('Online Learning with Concept Drift', fontweight='bold')
axes[0].legend()
axes[0].grid(alpha=0.3)

# äºˆæ¸¬èª¤å·®ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã®é©å¿œæ€§ã‚’è©•ä¾¡ï¼‰
axes[1].plot(time_axis, online_model.errors, color='purple', linewidth=1.5)
axes[1].axhline(y=0, color='red', linestyle='--', linewidth=1)
axes[1].fill_between(time_axis, -1, 1, color='green', alpha=0.1, label='Acceptable Error')
axes[1].axvline(x=200, color='red', linestyle=':', linewidth=2, alpha=0.7)
axes[1].axvline(x=400, color='red', linestyle=':', linewidth=2, alpha=0.7)
axes[1].set_xlabel('Time [samples]')
axes[1].set_ylabel('Prediction Error')
axes[1].set_title('Prediction Error Over Time', fontweight='bold')
axes[1].legend()
axes[1].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# å„ãƒ•ã‚§ãƒ¼ã‚ºã§ã®RMSE
phase1_rmse = np.sqrt(np.mean(np.array(online_model.errors[:190])**2))
phase2_rmse = np.sqrt(np.mean(np.array(online_model.errors[190:390])**2))
phase3_rmse = np.sqrt(np.mean(np.array(online_model.errors[390:])**2))

print(f"\nOnline Learning Performance:")
print(f"  Phase 1 RMSE: {phase1_rmse:.4f}")
print(f"  Phase 2 RMSE: {phase2_rmse:.4f}")
print(f"  Phase 3 RMSE: {phase3_rmse:.4f}")
</code></pre>

<p><strong>è§£èª¬:</strong> ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ï¼ˆå¢—åˆ†å­¦ç¿’ï¼‰ã¯ã€ãƒ‡ãƒ¼ã‚¿ãŒåˆ°ç€ã™ã‚‹ãŸã³ã«ãƒ¢ãƒ‡ãƒ«ã‚’æ›´æ–°ã—ã€æ¦‚å¿µãƒ‰ãƒªãƒ•ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿åˆ†å¸ƒã®å¤‰åŒ–ï¼‰ã«é©å¿œã—ã¾ã™ã€‚ãƒãƒƒãƒå­¦ç¿’ã¨ç•°ãªã‚Šã€å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒãªãã€ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ã§ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹4: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³PCAã«ã‚ˆã‚‹é©å¿œçš„ç•°å¸¸æ¤œçŸ¥</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from sklearn.decomposition import IncrementalPCA

class OnlineAnomalyDetector:
    """
    ã‚ªãƒ³ãƒ©ã‚¤ãƒ³PCAã«ã‚ˆã‚‹é©å¿œçš„ç•°å¸¸æ¤œçŸ¥

    Parameters:
    -----------
    n_components : int
        ä¸»æˆåˆ†æ•°
    threshold : float
        ç•°å¸¸åˆ¤å®šã®é–¾å€¤ï¼ˆSPEã®æ¨™æº–åå·®ã®å€æ•°ï¼‰
    """

    def __init__(self, n_components=2, threshold=3.0):
        self.n_components = n_components
        self.threshold = threshold
        self.ipca = IncrementalPCA(n_components=n_components)
        self.is_fitted = False
        self.spe_history = []
        self.anomalies = []

    def fit(self, X_initial):
        """
        åˆæœŸãƒ‡ãƒ¼ã‚¿ã§PCAã‚’ãƒ•ã‚£ãƒƒãƒˆ

        Parameters:
        -----------
        X_initial : array-like, shape (n_samples, n_features)
            åˆæœŸå­¦ç¿’ãƒ‡ãƒ¼ã‚¿
        """
        self.ipca.partial_fit(X_initial)
        self.is_fitted = True

    def detect(self, X):
        """
        ç•°å¸¸æ¤œçŸ¥

        Parameters:
        -----------
        X : array-like, shape (n_features,) or (n_samples, n_features)
            ç›£è¦–å¯¾è±¡ãƒ‡ãƒ¼ã‚¿

        Returns:
        --------
        is_anomaly : bool or array
            ç•°å¸¸ã‹ã©ã†ã‹
        spe : float or array
            SPE (Squared Prediction Error)
        """
        if not self.is_fitted:
            return False, 0.0

        X = np.atleast_2d(X)

        # ä¸»æˆåˆ†ç©ºé–“ã¸ã®æŠ•å½±ã¨å†æ§‹æˆ
        X_transformed = self.ipca.transform(X)
        X_reconstructed = self.ipca.inverse_transform(X_transformed)

        # SPEï¼ˆäºŒä¹—äºˆæ¸¬èª¤å·®ï¼‰è¨ˆç®—
        spe = np.sum((X - X_reconstructed) ** 2, axis=1)

        # é–¾å€¤åˆ¤å®š
        if len(self.spe_history) > 30:
            spe_mean = np.mean(self.spe_history)
            spe_std = np.std(self.spe_history)
            threshold_value = spe_mean + self.threshold * spe_std
        else:
            threshold_value = np.inf  # åˆæœŸæ®µéšã¯é–¾å€¤ãªã—

        is_anomaly = spe > threshold_value

        # å±¥æ­´æ›´æ–°
        self.spe_history.extend(spe.tolist())

        return is_anomaly[0] if len(is_anomaly) == 1 else is_anomaly, spe[0] if len(spe) == 1 else spe


# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼šå¤šå¤‰é‡ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿
np.random.seed(42)
n_samples = 500
n_features = 10

# æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆç›¸é–¢ã®ã‚ã‚‹å¤šå¤‰é‡ãƒ‡ãƒ¼ã‚¿ï¼‰
mean_normal = np.zeros(n_features)
cov_normal = np.eye(n_features) + 0.3 * np.random.randn(n_features, n_features)
cov_normal = cov_normal @ cov_normal.T  # æ­£å®šå€¤å¯¾ç§°è¡Œåˆ—

X_normal = np.random.multivariate_normal(mean_normal, cov_normal, size=400)

# ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã®æ³¨å…¥ï¼ˆå¤§ããªåå·®ï¼‰
anomaly_indices = [100, 150, 250, 350, 450]
X_stream = []
anomaly_labels = []

for i in range(n_samples):
    if i < 400:
        X_stream.append(X_normal[i])
        anomaly_labels.append(0)
    else:
        # æœ«å°¾100ã‚µãƒ³ãƒ—ãƒ«ã¯ç•°å¸¸ã‚’æ³¨å…¥
        if i in anomaly_indices:
            X_anomaly = X_normal[i-400] + np.random.randn(n_features) * 5
        else:
            X_anomaly = X_normal[i-400] + np.random.randn(n_features) * 0.5
        X_stream.append(X_anomaly)
        anomaly_labels.append(1 if i in anomaly_indices else 0)

X_stream = np.array(X_stream)
anomaly_labels = np.array(anomaly_labels)

# ã‚ªãƒ³ãƒ©ã‚¤ãƒ³PCAç•°å¸¸æ¤œçŸ¥
detector = OnlineAnomalyDetector(n_components=3, threshold=3.0)
detector.fit(X_stream[:50])  # åˆæœŸå­¦ç¿’

detected_anomalies = []
spe_values = []

for i in range(50, n_samples):
    X_current = X_stream[i:i+1]
    is_anomaly, spe = detector.detect(X_current)
    detected_anomalies.append(is_anomaly)
    spe_values.append(spe)

    # å®šæœŸçš„ã«ãƒ¢ãƒ‡ãƒ«æ›´æ–°
    if i % 10 == 0:
        detector.ipca.partial_fit(X_stream[i-10:i])

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 1, figsize=(14, 10))

time_axis = np.arange(50, n_samples)

# SPEå€¤ã¨é–¾å€¤
axes[0].plot(time_axis, spe_values, color='#11998e', linewidth=1.5, label='SPE')

# å‹•çš„é–¾å€¤
if len(detector.spe_history) > 30:
    spe_mean = np.mean(detector.spe_history)
    spe_std = np.std(detector.spe_history)
    threshold_line = spe_mean + 3 * spe_std
    axes[0].axhline(y=threshold_line, color='red', linestyle='--',
                    linewidth=2, label=f'Threshold (Î¼+3Ïƒ)')

# çœŸã®ç•°å¸¸ä½ç½®ã‚’ãƒãƒ¼ã‚¯
for idx in anomaly_indices:
    if idx >= 50:
        axes[0].axvline(x=idx, color='red', linestyle=':', linewidth=2, alpha=0.7)

axes[0].set_xlabel('Time [samples]')
axes[0].set_ylabel('SPE (Squared Prediction Error)')
axes[0].set_title('Online PCA Anomaly Detection', fontweight='bold')
axes[0].legend()
axes[0].set_yscale('log')
axes[0].grid(alpha=0.3)

# æ¤œçŸ¥çµæœã®å¯è¦–åŒ–
axes[1].scatter(time_axis[np.array(detected_anomalies)],
                np.ones(np.sum(detected_anomalies)),
                color='red', s=100, marker='x', label='Detected Anomalies', zorder=5)
axes[1].scatter(time_axis[~np.array(detected_anomalies)],
                np.zeros(np.sum(~np.array(detected_anomalies))),
                color='green', s=50, marker='o', alpha=0.3, label='Normal')

# çœŸã®ç•°å¸¸
true_anomaly_times = [idx for idx in anomaly_indices if idx >= 50]
axes[1].scatter(true_anomaly_times, [1.5]*len(true_anomaly_times),
                color='blue', s=150, marker='*', label='True Anomalies', zorder=5)

axes[1].set_xlabel('Time [samples]')
axes[1].set_yticks([0, 1, 1.5])
axes[1].set_yticklabels(['Normal', 'Detected', 'True'])
axes[1].set_title('Anomaly Detection Results', fontweight='bold')
axes[1].legend()
axes[1].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# æ¤œçŸ¥ç²¾åº¦ã®è©•ä¾¡
true_labels = anomaly_labels[50:]
detected_labels = np.array(detected_anomalies).astype(int)

from sklearn.metrics import precision_score, recall_score, f1_score

precision = precision_score(true_labels, detected_labels, zero_division=0)
recall = recall_score(true_labels, detected_labels, zero_division=0)
f1 = f1_score(true_labels, detected_labels, zero_division=0)

print(f"\nAnomaly Detection Performance:")
print(f"  Precision: {precision:.4f}")
print(f"  Recall:    {recall:.4f}")
print(f"  F1-Score:  {f1:.4f}")
</code></pre>

<p><strong>è§£èª¬:</strong> ã‚ªãƒ³ãƒ©ã‚¤ãƒ³PCAã¯ã€å¤šå¤‰é‡ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã®ä¸»æˆåˆ†ã‚’é€æ¬¡çš„ã«æ›´æ–°ã—ã€å†æ§‹æˆèª¤å·®ï¼ˆSPEï¼‰ã«åŸºã¥ã„ã¦ç•°å¸¸ã‚’æ¤œçŸ¥ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ã®æ­£å¸¸å¤‰å‹•ã«é©å¿œã—ãªãŒã‚‰ã€ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºã§ãã¾ã™ã€‚</p>

<hr />

<h2>5.4 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹5: Plotly Dashã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>

<pre><code class="language-python">import dash
from dash import dcc, html
from dash.dependencies import Input, Output
import plotly.graph_objs as go
import numpy as np
import pandas as pd
from collections import deque
from datetime import datetime
import random

# ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ•ã‚¡ï¼ˆæœ€æ–°1000ãƒã‚¤ãƒ³ãƒˆã‚’ä¿æŒï¼‰
max_length = 1000
time_buffer = deque(maxlen=max_length)
temp_buffer = deque(maxlen=max_length)
pressure_buffer = deque(maxlen=max_length)
flow_buffer = deque(maxlen=max_length)

# Dashã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
app = dash.Dash(__name__)

app.layout = html.Div([
    html.H1("Chemical Process Real-Time Dashboard",
            style={'textAlign': 'center', 'color': '#11998e'}),

    html.Div([
        html.Div([
            html.H3("Temperature Monitor", style={'textAlign': 'center'}),
            dcc.Graph(id='temperature-graph')
        ], className='six columns'),

        html.Div([
            html.H3("Pressure Monitor", style={'textAlign': 'center'}),
            dcc.Graph(id='pressure-graph')
        ], className='six columns'),
    ], className='row'),

    html.Div([
        html.Div([
            html.H3("Flow Rate Monitor", style={'textAlign': 'center'}),
            dcc.Graph(id='flow-graph')
        ], className='six columns'),

        html.Div([
            html.H3("Process Statistics", style={'textAlign': 'center'}),
            html.Div(id='stats-display', style={
                'fontSize': '18px',
                'padding': '20px',
                'backgroundColor': '#f0f0f0',
                'borderRadius': '10px',
                'marginTop': '20px'
            })
        ], className='six columns'),
    ], className='row'),

    # æ›´æ–°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ï¼ˆ1ç§’ã”ã¨ï¼‰
    dcc.Interval(
        id='interval-component',
        interval=1000,  # ãƒŸãƒªç§’
        n_intervals=0
    )
])


@app.callback(
    [Output('temperature-graph', 'figure'),
     Output('pressure-graph', 'figure'),
     Output('flow-graph', 'figure'),
     Output('stats-display', 'children')],
    [Input('interval-component', 'n_intervals')]
)
def update_dashboard(n):
    """
    ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
    """
    # æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆï¼ˆå®Ÿéš›ã«ã¯ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼‰
    current_time = datetime.now()
    temperature = 180 + 5 * np.sin(n * 0.1) + np.random.randn() * 1
    pressure = 3.0 + 0.2 * np.cos(n * 0.08) + np.random.randn() * 0.1
    flow_rate = 50 + 5 * np.random.randn()

    # ãƒãƒƒãƒ•ã‚¡ã«è¿½åŠ 
    time_buffer.append(current_time)
    temp_buffer.append(temperature)
    pressure_buffer.append(pressure)
    flow_buffer.append(flow_rate)

    # æ¸©åº¦ã‚°ãƒ©ãƒ•
    temp_figure = {
        'data': [
            go.Scatter(
                x=list(time_buffer),
                y=list(temp_buffer),
                mode='lines',
                name='Temperature',
                line=dict(color='#11998e', width=2)
            )
        ],
        'layout': go.Layout(
            xaxis=dict(title='Time'),
            yaxis=dict(title='Temperature [Â°C]', range=[170, 190]),
            margin=dict(l=50, r=50, t=20, b=50),
            hovermode='closest'
        )
    }

    # åœ§åŠ›ã‚°ãƒ©ãƒ•
    pressure_figure = {
        'data': [
            go.Scatter(
                x=list(time_buffer),
                y=list(pressure_buffer),
                mode='lines',
                name='Pressure',
                line=dict(color='#38ef7d', width=2)
            )
        ],
        'layout': go.Layout(
            xaxis=dict(title='Time'),
            yaxis=dict(title='Pressure [bar]', range=[2.5, 3.5]),
            margin=dict(l=50, r=50, t=20, b=50),
            hovermode='closest'
        )
    }

    # æµé‡ã‚°ãƒ©ãƒ•
    flow_figure = {
        'data': [
            go.Scatter(
                x=list(time_buffer),
                y=list(flow_buffer),
                mode='lines',
                name='Flow Rate',
                line=dict(color='orange', width=2)
            )
        ],
        'layout': go.Layout(
            xaxis=dict(title='Time'),
            yaxis=dict(title='Flow Rate [L/h]', range=[30, 70]),
            margin=dict(l=50, r=50, t=20, b=50),
            hovermode='closest'
        )
    }

    # çµ±è¨ˆæƒ…å ±
    if len(temp_buffer) > 0:
        stats = html.Div([
            html.P(f"Temperature: {temperature:.2f} Â°C"),
            html.P(f"  Mean: {np.mean(temp_buffer):.2f} Â°C"),
            html.P(f"  Std Dev: {np.std(temp_buffer):.2f} Â°C"),
            html.Br(),
            html.P(f"Pressure: {pressure:.2f} bar"),
            html.P(f"  Mean: {np.mean(pressure_buffer):.2f} bar"),
            html.P(f"  Std Dev: {np.std(pressure_buffer):.2f} bar"),
            html.Br(),
            html.P(f"Flow Rate: {flow_rate:.2f} L/h"),
            html.P(f"  Mean: {np.mean(flow_buffer):.2f} L/h"),
            html.P(f"  Std Dev: {np.std(flow_buffer):.2f} L/h"),
        ])
    else:
        stats = html.P("Waiting for data...")

    return temp_figure, pressure_figure, flow_figure, stats


# æ³¨æ„ï¼šã“ã®ã‚³ãƒ¼ãƒ‰ã¯Jupyter Notebookã§ã¯å‹•ä½œã—ã¾ã›ã‚“
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼špython dashboard.py
if __name__ == '__main__':
    print("Starting Real-Time Dashboard...")
    print("Open browser and navigate to: http://127.0.0.1:8050/")
    app.run_server(debug=True, port=8050)
</code></pre>

<p><strong>å®Ÿè¡Œæ–¹æ³•:</strong></p>
<pre><code class="language-bash"># dashboard.pyã¨ã—ã¦ä¿å­˜å¾Œã€å®Ÿè¡Œ
pip install dash plotly pandas
python dashboard.py

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://127.0.0.1:8050/ ã‚’é–‹ã
</code></pre>

<p><strong>è§£èª¬:</strong> Plotly Dashã¯ã€Pythonã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ§‹ç¯‰ã§ãã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚<code>dcc.Interval</code>ã«ã‚ˆã‚Šå®šæœŸçš„ã«æ›´æ–°ã•ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•çš„ãªãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ãŒå¯èƒ½ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ã€DCSã‚„MESã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨çµ±åˆã—ã¾ã™ã€‚</p>

<hr />

<h2>5.5 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹6: InfluxDBã«ã‚ˆã‚‹æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°</h3>

<pre><code class="language-python"># InfluxDB 2.xç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
from influxdb_client import InfluxDBClient, Point, WriteOptions
from influxdb_client.client.write_api import SYNCHRONOUS
import numpy as np
from datetime import datetime, timedelta
import time

# æ³¨æ„ï¼šã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€InfluxDBã‚µãƒ¼ãƒãƒ¼ãŒå¿…è¦ã§ã™
# Dockerã§ç°¡å˜ã«èµ·å‹•å¯èƒ½ï¼š
# docker run -d -p 8086:8086 influxdb:2.0

class InfluxDBStreamer:
    """
    InfluxDBã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°

    Parameters:
    -----------
    url : str
        InfluxDBã®URL
    token : str
        èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
    org : str
        çµ„ç¹”å
    bucket : str
        ãƒã‚±ãƒƒãƒˆå
    """

    def __init__(self, url="http://localhost:8086", token="your-token",
                 org="your-org", bucket="process-data"):
        self.url = url
        self.token = token
        self.org = org
        self.bucket = bucket

        # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶š
        try:
            self.client = InfluxDBClient(url=url, token=token, org=org)
            self.write_api = self.client.write_api(write_options=SYNCHRONOUS)
            self.query_api = self.client.query_api()
            print("Connected to InfluxDB successfully")
        except Exception as e:
            print(f"Failed to connect to InfluxDB: {e}")
            self.client = None

    def write_data_point(self, measurement, tags, fields, timestamp=None):
        """
        ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’æ›¸ãè¾¼ã¿

        Parameters:
        -----------
        measurement : str
            æ¸¬å®šåï¼ˆä¾‹: "temperature", "pressure"ï¼‰
        tags : dict
            ã‚¿ã‚°ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€ä¾‹: {"sensor_id": "T101", "location": "reactor"}ï¼‰
        fields : dict
            ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ã€ä¾‹: {"value": 180.5}ï¼‰
        timestamp : datetime
            ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆNoneã®å ´åˆã¯ç¾åœ¨æ™‚åˆ»ï¼‰
        """
        if self.client is None:
            print("InfluxDB client not initialized")
            return

        if timestamp is None:
            timestamp = datetime.utcnow()

        # ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆä½œæˆ
        point = Point(measurement)
        for key, value in tags.items():
            point = point.tag(key, value)
        for key, value in fields.items():
            point = point.field(key, value)
        point = point.time(timestamp)

        # æ›¸ãè¾¼ã¿
        try:
            self.write_api.write(bucket=self.bucket, org=self.org, record=point)
        except Exception as e:
            print(f"Failed to write data: {e}")

    def query_recent_data(self, measurement, time_range="-1h"):
        """
        æœ€è¿‘ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ã‚¨ãƒª

        Parameters:
        -----------
        measurement : str
            æ¸¬å®šå
        time_range : str
            æ™‚é–“ç¯„å›²ï¼ˆä¾‹: "-1h", "-30m", "-10s"ï¼‰

        Returns:
        --------
        data : list
            ã‚¯ã‚¨ãƒªçµæœ
        """
        if self.client is None:
            return []

        # Fluxã‚¯ã‚¨ãƒª
        query = f'''
        from(bucket: "{self.bucket}")
          |> range(start: {time_range})
          |> filter(fn: (r) => r["_measurement"] == "{measurement}")
        '''

        try:
            result = self.query_api.query(org=self.org, query=query)
            data = []
            for table in result:
                for record in table.records:
                    data.append({
                        'time': record.get_time(),
                        'value': record.get_value(),
                        'field': record.get_field(),
                        'tags': record.values
                    })
            return data
        except Exception as e:
            print(f"Failed to query data: {e}")
            return []

    def close(self):
        """ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’é–‰ã˜ã‚‹"""
        if self.client:
            self.client.close()


# ä½¿ç”¨ä¾‹ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
def simulate_streaming():
    """
    ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    """
    # InfluxDBã‚¹ãƒˆãƒªãƒ¼ãƒãƒ¼åˆæœŸåŒ–
    # æ³¨æ„ï¼šå®Ÿéš›ã®ç’°å¢ƒã«åˆã‚ã›ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„
    streamer = InfluxDBStreamer(
        url="http://localhost:8086",
        token="your-influxdb-token",  # å®Ÿéš›ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š
        org="my-org",
        bucket="process-data"
    )

    print("Starting data streaming simulation...")
    print("Press Ctrl+C to stop")

    try:
        for i in range(100):
            # ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            temperature = 180 + 5 * np.sin(i * 0.1) + np.random.randn()
            pressure = 3.0 + 0.2 * np.cos(i * 0.08) + np.random.randn() * 0.1
            flow_rate = 50 + 5 * np.random.randn()

            # ãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿
            streamer.write_data_point(
                measurement="temperature",
                tags={"sensor_id": "T101", "unit": "reactor"},
                fields={"value": temperature},
                timestamp=datetime.utcnow()
            )

            streamer.write_data_point(
                measurement="pressure",
                tags={"sensor_id": "P201", "unit": "reactor"},
                fields={"value": pressure},
                timestamp=datetime.utcnow()
            )

            streamer.write_data_point(
                measurement="flow_rate",
                tags={"sensor_id": "F301", "unit": "feed"},
                fields={"value": flow_rate},
                timestamp=datetime.utcnow()
            )

            print(f"Sample {i+1}: T={temperature:.2f}Â°C, P={pressure:.2f}bar, F={flow_rate:.2f}L/h")

            time.sleep(1)  # 1ç§’é–“éš”

    except KeyboardInterrupt:
        print("\nStreaming stopped by user")

    finally:
        # æœ€è¿‘ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ã‚¨ãƒª
        print("\nQuerying recent temperature data...")
        recent_data = streamer.query_recent_data("temperature", time_range="-5m")
        print(f"Retrieved {len(recent_data)} data points")

        if len(recent_data) > 0:
            print("\nSample data:")
            for i, point in enumerate(recent_data[:5]):
                print(f"  {i+1}. Time: {point['time']}, Value: {point['value']:.2f}")

        streamer.close()


# æ³¨æ„ï¼šInfluxDBã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹å ´åˆã®ã¿å®Ÿè¡Œå¯èƒ½
# simulate_streaming()

print("""
InfluxDB Streaming Example Code

To run this example:
1. Install InfluxDB: docker run -d -p 8086:8086 influxdb:2.0
2. Create an API token in InfluxDB UI (http://localhost:8086)
3. Update the connection parameters in the code
4. Install client: pip install influxdb-client
5. Run: python influxdb_streaming.py

Key Features:
- Real-time data ingestion
- Tag-based indexing (sensor_id, location, etc.)
- Powerful time-series queries (Flux language)
- Automatic data downsampling and retention policies
- Integration with Grafana for visualization
""")
</code></pre>

<p><strong>è§£èª¬:</strong> InfluxDBã¯æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã«ç‰¹åŒ–ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã€é«˜é€Ÿãªæ›¸ãè¾¼ã¿ã¨ã‚¯ã‚¨ãƒªãŒå¯èƒ½ã§ã™ã€‚ã‚¿ã‚°ã«ã‚ˆã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€è‡ªå‹•ãƒ€ã‚¦ãƒ³ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã€Grafanaã¨ã®çµ±åˆã«ã‚ˆã‚Šã€ç”£æ¥­ç”¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤ã¨ã—ã¦åºƒãä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹7: WebSocketã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿é…ä¿¡</h3>

<pre><code class="language-python">import asyncio
import websockets
import json
import numpy as np
from datetime import datetime

# WebSocketã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒ‡ãƒ¼ã‚¿é…ä¿¡å´ï¼‰
class ProcessDataServer:
    """
    WebSocketã‚µãƒ¼ãƒãƒ¼ã§ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’é…ä¿¡
    """

    def __init__(self, host='localhost', port=8765):
        self.host = host
        self.port = port
        self.clients = set()

    async def register_client(self, websocket):
        """ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²"""
        self.clients.add(websocket)
        print(f"Client connected: {websocket.remote_address}")

    async def unregister_client(self, websocket):
        """ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²è§£é™¤"""
        self.clients.remove(websocket)
        print(f"Client disconnected: {websocket.remote_address}")

    async def send_data_to_clients(self, data):
        """å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡"""
        if self.clients:
            message = json.dumps(data)
            await asyncio.gather(
                *[client.send(message) for client in self.clients],
                return_exceptions=True
            )

    async def handler(self, websocket, path):
        """
        ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šãƒãƒ³ãƒ‰ãƒ©
        """
        await self.register_client(websocket)
        try:
            # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¾…æ©Ÿï¼ˆæ¥ç¶šç¶­æŒï¼‰
            async for message in websocket:
                print(f"Received from client: {message}")
        except websockets.exceptions.ConnectionClosed:
            pass
        finally:
            await self.unregister_client(websocket)

    async def generate_and_broadcast_data(self):
        """
        å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
        """
        iteration = 0
        while True:
            # ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            temperature = 180 + 5 * np.sin(iteration * 0.1) + np.random.randn()
            pressure = 3.0 + 0.2 * np.cos(iteration * 0.08) + np.random.randn() * 0.1
            flow_rate = 50 + 5 * np.random.randn()

            data = {
                'timestamp': datetime.now().isoformat(),
                'temperature': round(temperature, 2),
                'pressure': round(pressure, 2),
                'flow_rate': round(flow_rate, 2),
                'iteration': iteration
            }

            # å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡
            await self.send_data_to_clients(data)

            iteration += 1
            await asyncio.sleep(1)  # 1ç§’é–“éš”

    async def start(self):
        """ã‚µãƒ¼ãƒãƒ¼èµ·å‹•"""
        # WebSocketã‚µãƒ¼ãƒãƒ¼é–‹å§‹
        server = await websockets.serve(self.handler, self.host, self.port)
        print(f"WebSocket server started on ws://{self.host}:{self.port}")

        # ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ»é…ä¿¡ã‚¿ã‚¹ã‚¯é–‹å§‹
        await self.generate_and_broadcast_data()


# WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿å—ä¿¡å´ï¼‰
class ProcessDataClient:
    """
    WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡
    """

    def __init__(self, uri='ws://localhost:8765'):
        self.uri = uri
        self.data_buffer = []

    async def receive_data(self):
        """
        ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ã¦å‡¦ç†
        """
        async with websockets.connect(self.uri) as websocket:
            print(f"Connected to server: {self.uri}")

            try:
                async for message in websocket:
                    data = json.loads(message)
                    self.data_buffer.append(data)

                    # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†
                    print(f"Received: T={data['temperature']}Â°C, "
                          f"P={data['pressure']}bar, "
                          f"F={data['flow_rate']}L/h")

                    # ç•°å¸¸æ¤œçŸ¥ã®ä¾‹
                    if data['temperature'] > 185:
                        print(f"  WARNING: High temperature detected!")

                    # ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚ºåˆ¶é™
                    if len(self.data_buffer) > 1000:
                        self.data_buffer.pop(0)

            except websockets.exceptions.ConnectionClosed:
                print("Connection closed by server")


# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
async def run_server():
    server = ProcessDataServer(host='localhost', port=8765)
    await server.start()


# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
async def run_client():
    client = ProcessDataClient(uri='ws://localhost:8765')
    await client.receive_data()


# ä½¿ç”¨ä¾‹
print("""
WebSocket Real-Time Data Streaming Example

Server Side:
-----------
python
import asyncio
from your_module import run_server
asyncio.run(run_server())

Client Side:
-----------
python
import asyncio
from your_module import run_client
asyncio.run(run_client())

Key Features:
- Low-latency bidirectional communication
- Multiple clients can connect simultaneously
- Automatic reconnection handling
- JSON data serialization
- Real-time anomaly detection on client side

Installation:
pip install websockets
""")

# å®Ÿè¡Œä¾‹ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆè§£é™¤ã—ã¦ä½¿ç”¨ï¼‰
# asyncio.run(run_server())  # ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
# asyncio.run(run_client())  # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèµ·å‹•
</code></pre>

<p><strong>è§£èª¬:</strong> WebSocketã¯åŒæ–¹å‘é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã€HTTPã‚ˆã‚Šã‚‚ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’é…ä¿¡ã§ãã¾ã™ã€‚DCSã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’WebSocketã‚µãƒ¼ãƒãƒ¼ã§é…ä¿¡ã—ã€è¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€åˆ†æãƒ„ãƒ¼ãƒ«ï¼‰ãŒåŒæ™‚ã«å—ä¿¡ã§ãã¾ã™ã€‚</p>

<hr />

<h2>5.6 ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¨è‡ªå‹•åŒ–</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹8: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ </h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from datetime import datetime
from enum import Enum
import smtplib
from email.mime.text import MIMEText

class AlertSeverity(Enum):
    """ã‚¢ãƒ©ãƒ¼ãƒˆé‡è¦åº¦"""
    INFO = 1
    WARNING = 2
    CRITICAL = 3
    EMERGENCY = 4


class Alert:
    """ã‚¢ãƒ©ãƒ¼ãƒˆæƒ…å ±"""
    def __init__(self, severity, message, value, threshold, timestamp=None):
        self.severity = severity
        self.message = message
        self.value = value
        self.threshold = threshold
        self.timestamp = timestamp if timestamp else datetime.now()

    def __str__(self):
        return (f"[{self.severity.name}] {self.timestamp.strftime('%Y-%m-%d %H:%M:%S')} - "
                f"{self.message} (Value: {self.value:.2f}, Threshold: {self.threshold:.2f})")


class ProcessAlertSystem:
    """
    ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ 

    Parameters:
    -----------
    rules : list of dict
        ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«ã®ãƒªã‚¹ãƒˆ
        ä¾‹: {'variable': 'temperature', 'condition': '>', 'threshold': 185, 'severity': AlertSeverity.WARNING}
    """

    def __init__(self, rules):
        self.rules = rules
        self.alerts = []
        self.alert_counts = {severity: 0 for severity in AlertSeverity}

    def evaluate_rules(self, data):
        """
        ãƒ«ãƒ¼ãƒ«ã‚’è©•ä¾¡ã—ã¦ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç”Ÿæˆ

        Parameters:
        -----------
        data : dict
            ç›£è¦–ãƒ‡ãƒ¼ã‚¿ï¼ˆå¤‰æ•°å: å€¤ï¼‰

        Returns:
        --------
        alerts : list of Alert
            ç”Ÿæˆã•ã‚ŒãŸã‚¢ãƒ©ãƒ¼ãƒˆã®ãƒªã‚¹ãƒˆ
        """
        current_alerts = []

        for rule in self.rules:
            variable = rule['variable']
            condition = rule['condition']
            threshold = rule['threshold']
            severity = rule['severity']

            if variable not in data:
                continue

            value = data[variable]

            # æ¡ä»¶è©•ä¾¡
            triggered = False
            if condition == '>':
                triggered = value > threshold
            elif condition == '<':
                triggered = value < threshold
            elif condition == '>=':
                triggered = value >= threshold
            elif condition == '<=':
                triggered = value <= threshold
            elif condition == '==':
                triggered = abs(value - threshold) < 1e-6
            elif condition == '!=':
                triggered = abs(value - threshold) >= 1e-6

            if triggered:
                message = f"{variable} {condition} {threshold}"
                alert = Alert(severity, message, value, threshold)
                current_alerts.append(alert)
                self.alerts.append(alert)
                self.alert_counts[severity] += 1

        return current_alerts

    def send_alert_notification(self, alert):
        """
        ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ã‚’é€ä¿¡ï¼ˆãƒ¡ãƒ¼ãƒ«ã€SMSã€ç­‰ï¼‰

        Parameters:
        -----------
        alert : Alert
            é€ä¿¡ã™ã‚‹ã‚¢ãƒ©ãƒ¼ãƒˆ
        """
        print(f"\n*** ALERT NOTIFICATION ***")
        print(alert)
        print("*" * 50)

        # å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚„SMSé€ä¿¡ã‚’è¡Œã†
        # if alert.severity == AlertSeverity.CRITICAL:
        #     self._send_email(alert)
        #     self._send_sms(alert)

    def _send_email(self, alert):
        """ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆå®Ÿè£…ä¾‹ï¼‰"""
        # æ³¨æ„ï¼šå®Ÿéš›ã®ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¦ãã ã•ã„
        smtp_server = "smtp.example.com"
        smtp_port = 587
        sender = "alerts@example.com"
        recipient = "operator@example.com"
        password = "your-password"

        msg = MIMEText(str(alert))
        msg['Subject'] = f"[{alert.severity.name}] Process Alert"
        msg['From'] = sender
        msg['To'] = recipient

        try:
            with smtplib.SMTP(smtp_server, smtp_port) as server:
                server.starttls()
                server.login(sender, password)
                server.send_message(msg)
                print(f"Email sent to {recipient}")
        except Exception as e:
            print(f"Failed to send email: {e}")

    def get_alert_summary(self):
        """ã‚¢ãƒ©ãƒ¼ãƒˆã‚µãƒãƒªãƒ¼ã‚’å–å¾—"""
        return {
            'total_alerts': len(self.alerts),
            'by_severity': self.alert_counts,
            'recent_alerts': self.alerts[-10:] if len(self.alerts) > 0 else []
        }


# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
np.random.seed(42)

# ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«å®šç¾©
alert_rules = [
    {'variable': 'temperature', 'condition': '>', 'threshold': 185, 'severity': AlertSeverity.WARNING},
    {'variable': 'temperature', 'condition': '>', 'threshold': 190, 'severity': AlertSeverity.CRITICAL},
    {'variable': 'temperature', 'condition': '<', 'threshold': 170, 'severity': AlertSeverity.WARNING},
    {'variable': 'pressure', 'condition': '>', 'threshold': 3.5, 'severity': AlertSeverity.WARNING},
    {'variable': 'pressure', 'condition': '<', 'threshold': 2.5, 'severity': AlertSeverity.WARNING},
    {'variable': 'flow_rate', 'condition': '<', 'threshold': 40, 'severity': AlertSeverity.INFO},
]

# ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
alert_system = ProcessAlertSystem(rules=alert_rules)

# ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†
print("Starting Process Monitoring...")
print("=" * 70)

for i in range(100):
    # ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆæ™‚ã€…ç•°å¸¸å€¤ã‚’å«ã‚€ï¼‰
    if i in [25, 50, 75]:
        # ç•°å¸¸ãƒ‡ãƒ¼ã‚¿
        temperature = 192 + np.random.randn()
        pressure = 3.8 + np.random.randn() * 0.1
    else:
        # æ­£å¸¸ãƒ‡ãƒ¼ã‚¿
        temperature = 180 + 5 * np.sin(i * 0.1) + np.random.randn() * 2
        pressure = 3.0 + 0.2 * np.cos(i * 0.08) + np.random.randn() * 0.1

    flow_rate = 50 + 5 * np.random.randn()

    data = {
        'temperature': temperature,
        'pressure': pressure,
        'flow_rate': flow_rate
    }

    # ãƒ«ãƒ¼ãƒ«è©•ä¾¡
    current_alerts = alert_system.evaluate_rules(data)

    # ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥
    for alert in current_alerts:
        alert_system.send_alert_notification(alert)

# ã‚¢ãƒ©ãƒ¼ãƒˆã‚µãƒãƒªãƒ¼
summary = alert_system.get_alert_summary()
print("\n\n" + "=" * 70)
print("ALERT SUMMARY")
print("=" * 70)
print(f"Total Alerts: {summary['total_alerts']}")
print("\nBy Severity:")
for severity, count in summary['by_severity'].items():
    print(f"  {severity.name:12s}: {count}")

print("\nRecent Alerts (last 10):")
for alert in summary['recent_alerts']:
    print(f"  {alert}")
</code></pre>

<p><strong>è§£èª¬:</strong> ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¯ã€é–¾å€¤ã‚„æ¡ä»¶ã«åŸºã¥ã„ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ç•°å¸¸ã‚’æ¤œçŸ¥ã—ã€é‡è¦åº¦ã«å¿œã˜ã¦é€šçŸ¥ã—ã¾ã™ã€‚è¤‡æ•°ã®é€šçŸ¥ãƒãƒ£ãƒãƒ«ï¼ˆãƒ¡ãƒ¼ãƒ«ã€SMSã€SCADAç”»é¢ï¼‰ã¸ã®çµ±åˆãŒå¯èƒ½ã§ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹9: æ©Ÿæ¢°å­¦ç¿’ãƒ™ãƒ¼ã‚¹ã®ç•°å¸¸æ¤œçŸ¥ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.ensemble import IsolationForest
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt

class MLAnomalyDetector:
    """
    æ©Ÿæ¢°å­¦ç¿’ãƒ™ãƒ¼ã‚¹ã®ç•°å¸¸æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

    Parameters:
    -----------
    contamination : float
        ç•°å¸¸ã®å‰²åˆï¼ˆ0.0ã€œ0.5ï¼‰
    """

    def __init__(self, contamination=0.05):
        self.model = IsolationForest(
            contamination=contamination,
            random_state=42,
            n_estimators=100
        )
        self.scaler = StandardScaler()
        self.is_fitted = False
        self.anomaly_scores = []
        self.predictions = []

    def fit(self, X_normal):
        """
        æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’

        Parameters:
        -----------
        X_normal : array-like, shape (n_samples, n_features)
            æ­£å¸¸ãƒ‡ãƒ¼ã‚¿
        """
        X_scaled = self.scaler.fit_transform(X_normal)
        self.model.fit(X_scaled)
        self.is_fitted = True

    def predict(self, X):
        """
        ç•°å¸¸æ¤œçŸ¥

        Parameters:
        -----------
        X : array-like, shape (n_samples, n_features)
            ãƒ‡ãƒ¼ã‚¿

        Returns:
        --------
        is_anomaly : array, shape (n_samples,)
            ç•°å¸¸ãƒ•ãƒ©ã‚°ï¼ˆ1: ç•°å¸¸, -1: æ­£å¸¸ï¼‰
        anomaly_score : array, shape (n_samples,)
            ç•°å¸¸ã‚¹ã‚³ã‚¢ï¼ˆä½ã„ã»ã©ç•°å¸¸ï¼‰
        """
        if not self.is_fitted:
            return np.zeros(X.shape[0]), np.zeros(X.shape[0])

        X_scaled = self.scaler.transform(X)
        predictions = self.model.predict(X_scaled)  # 1: normal, -1: anomaly
        anomaly_scores = self.model.score_samples(X_scaled)  # ç•°å¸¸ã‚¹ã‚³ã‚¢ï¼ˆä½ã„ã»ã©ç•°å¸¸ï¼‰

        self.predictions.extend(predictions.tolist())
        self.anomaly_scores.extend(anomaly_scores.tolist())

        return predictions, anomaly_scores


# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
np.random.seed(42)

# æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’
n_train = 500
X_train = np.random.multivariate_normal(
    mean=[180, 3.0, 50],
    cov=[[4, 0.1, 0.2], [0.1, 0.04, 0.05], [0.2, 0.05, 25]],
    size=n_train
)

# ç•°å¸¸æ¤œçŸ¥å™¨ã®å­¦ç¿’
detector = MLAnomalyDetector(contamination=0.05)
detector.fit(X_train)

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆæ­£å¸¸ + ç•°å¸¸ï¼‰
n_test = 300
X_test = []
true_labels = []

for i in range(n_test):
    if i % 50 == 49:  # 50ã‚µãƒ³ãƒ—ãƒ«ã”ã¨ã«ç•°å¸¸ã‚’æ³¨å…¥
        # ç•°å¸¸ãƒ‡ãƒ¼ã‚¿
        X_test.append([195, 3.8, 35])  # æ¸©åº¦é«˜ã€åœ§åŠ›é«˜ã€æµé‡ä½
        true_labels.append(-1)
    else:
        # æ­£å¸¸ãƒ‡ãƒ¼ã‚¿
        sample = np.random.multivariate_normal(
            mean=[180, 3.0, 50],
            cov=[[4, 0.1, 0.2], [0.1, 0.04, 0.05], [0.2, 0.05, 25]]
        )
        X_test.append(sample)
        true_labels.append(1)

X_test = np.array(X_test)
true_labels = np.array(true_labels)

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç•°å¸¸æ¤œçŸ¥
print("Real-Time ML Anomaly Detection")
print("=" * 70)

detected_anomalies = []
for i in range(n_test):
    X_current = X_test[i:i+1]
    prediction, score = detector.predict(X_current)

    if prediction[0] == -1:
        print(f"Time {i}: ANOMALY DETECTED (Score: {score[0]:.3f})")
        print(f"  Data: T={X_current[0,0]:.2f}Â°C, P={X_current[0,1]:.2f}bar, F={X_current[0,2]:.2f}L/h")
        detected_anomalies.append(i)

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(16, 12))

# ç•°å¸¸ã‚¹ã‚³ã‚¢ã®æ™‚ç³»åˆ—
axes[0, 0].plot(detector.anomaly_scores, color='#11998e', linewidth=1.5)
axes[0, 0].axhline(y=np.percentile(detector.anomaly_scores, 5), color='red',
                   linestyle='--', linewidth=2, label='Anomaly Threshold (5%ile)')
for idx in detected_anomalies:
    axes[0, 0].axvline(x=idx, color='red', linestyle=':', linewidth=1, alpha=0.5)
axes[0, 0].set_xlabel('Time [samples]')
axes[0, 0].set_ylabel('Anomaly Score')
axes[0, 0].set_title('Anomaly Score Over Time', fontweight='bold')
axes[0, 0].legend()
axes[0, 0].grid(alpha=0.3)

# æ¸©åº¦ vs åœ§åŠ›ï¼ˆç•°å¸¸ã®å¯è¦–åŒ–ï¼‰
normal_idx = np.array(detector.predictions) == 1
anomaly_idx = np.array(detector.predictions) == -1
axes[0, 1].scatter(X_test[normal_idx, 0], X_test[normal_idx, 1],
                   color='green', alpha=0.5, label='Normal', s=30)
axes[0, 1].scatter(X_test[anomaly_idx, 0], X_test[anomaly_idx, 1],
                   color='red', alpha=0.8, label='Anomaly', s=100, marker='x', linewidths=2)
axes[0, 1].set_xlabel('Temperature [Â°C]')
axes[0, 1].set_ylabel('Pressure [bar]')
axes[0, 1].set_title('Anomalies in Temperature-Pressure Space', fontweight='bold')
axes[0, 1].legend()
axes[0, 1].grid(alpha=0.3)

# åœ§åŠ› vs æµé‡
axes[1, 0].scatter(X_test[normal_idx, 1], X_test[normal_idx, 2],
                   color='green', alpha=0.5, label='Normal', s=30)
axes[1, 0].scatter(X_test[anomaly_idx, 1], X_test[anomaly_idx, 2],
                   color='red', alpha=0.8, label='Anomaly', s=100, marker='x', linewidths=2)
axes[1, 0].set_xlabel('Pressure [bar]')
axes[1, 0].set_ylabel('Flow Rate [L/h]')
axes[1, 0].set_title('Anomalies in Pressure-Flow Space', fontweight='bold')
axes[1, 0].legend()
axes[1, 0].grid(alpha=0.3)

# ç•°å¸¸ã‚¹ã‚³ã‚¢ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ 
axes[1, 1].hist(np.array(detector.anomaly_scores)[normal_idx], bins=30,
                color='green', alpha=0.6, label='Normal', edgecolor='black')
axes[1, 1].hist(np.array(detector.anomaly_scores)[anomaly_idx], bins=30,
                color='red', alpha=0.6, label='Anomaly', edgecolor='black')
axes[1, 1].set_xlabel('Anomaly Score')
axes[1, 1].set_ylabel('Frequency')
axes[1, 1].set_title('Distribution of Anomaly Scores', fontweight='bold')
axes[1, 1].legend()
axes[1, 1].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# æ¤œçŸ¥æ€§èƒ½ã®è©•ä¾¡
from sklearn.metrics import classification_report

predicted_labels = np.array(detector.predictions)
print("\n\nAnomaly Detection Performance:")
print("=" * 70)
print(classification_report(true_labels, predicted_labels,
                           target_names=['Anomaly', 'Normal']))
</code></pre>

<p><strong>è§£èª¬:</strong> æ©Ÿæ¢°å­¦ç¿’ãƒ™ãƒ¼ã‚¹ã®ç•°å¸¸æ¤œçŸ¥ã¯ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§ã¯æ‰ãˆã‚‰ã‚Œãªã„è¤‡é›‘ãªç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºã§ãã¾ã™ã€‚Isolation Forestã¯æ•™å¸«ãªã—å­¦ç¿’ã§ã€æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‹ã‚‰å­¦ç¿’ã—ã€å¤–ã‚Œå€¤ã‚’åŠ¹ç‡çš„ã«æ¤œå‡ºã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ã®éç·šå½¢ãªé–¢ä¿‚ã‚„å¤šå¤‰é‡ç›¸é–¢ã‚‚è€ƒæ…®ã§ãã¾ã™ã€‚</p>

<hr />

<h2>5.7 æœ¬ç•ªç’°å¢ƒã¸ã®å±•é–‹</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹10: æœ¬ç•ªç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆå®Ÿè£…</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from datetime import datetime, timedelta
from collections import deque
import logging
import threading
import time

# ãƒ­ã‚®ãƒ³ã‚°è¨­å®š
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('process_monitoring.log'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger('ProcessMonitor')


class ProductionMonitoringSystem:
    """
    æœ¬ç•ªç’°å¢ƒç”¨ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 

    Parameters:
    -----------
    sampling_interval : float
        ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš” [ç§’]
    buffer_size : int
        ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º
    alert_threshold : dict
        ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤ã®è¾æ›¸
    """

    def __init__(self, sampling_interval=1.0, buffer_size=1000, alert_threshold=None):
        self.sampling_interval = sampling_interval
        self.buffer_size = buffer_size
        self.alert_threshold = alert_threshold or {}

        # ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ•ã‚¡
        self.data_buffer = {
            'timestamp': deque(maxlen=buffer_size),
            'temperature': deque(maxlen=buffer_size),
            'pressure': deque(maxlen=buffer_size),
            'flow_rate': deque(maxlen=buffer_size)
        }

        # çµ±è¨ˆæƒ…å ±
        self.statistics = {}
        self.alert_count = 0
        self.uptime_start = datetime.now()

        # åˆ¶å¾¡ãƒ•ãƒ©ã‚°
        self.is_running = False
        self.monitoring_thread = None

        logger.info("Production Monitoring System initialized")

    def read_sensor_data(self):
        """
        ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹

        å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€DCSã€PLCã€OPC-UAã‚µãƒ¼ãƒãƒ¼ç­‰ã‹ã‚‰èª­ã¿å–ã‚Š

        Returns:
        --------
        data : dict
            ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿
        """
        # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
        # å®Ÿç’°å¢ƒã§ã¯ã€OPC-UAã€Modbusã€MQTTç­‰ã§å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        timestamp = datetime.now()
        temperature = 180 + 5 * np.sin(time.time() * 0.1) + np.random.randn()
        pressure = 3.0 + 0.2 * np.cos(time.time() * 0.08) + np.random.randn() * 0.1
        flow_rate = 50 + 5 * np.random.randn()

        return {
            'timestamp': timestamp,
            'temperature': temperature,
            'pressure': pressure,
            'flow_rate': flow_rate
        }

    def update_buffer(self, data):
        """
        ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ•ã‚¡ã‚’æ›´æ–°

        Parameters:
        -----------
        data : dict
            æ–°ã—ã„ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿
        """
        for key, value in data.items():
            self.data_buffer[key].append(value)

    def calculate_statistics(self):
        """
        ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ•ã‚¡ã‹ã‚‰çµ±è¨ˆé‡ã‚’è¨ˆç®—

        Returns:
        --------
        stats : dict
            çµ±è¨ˆé‡ã®è¾æ›¸
        """
        stats = {}

        for variable in ['temperature', 'pressure', 'flow_rate']:
            data_array = np.array(self.data_buffer[variable])
            if len(data_array) > 0:
                stats[variable] = {
                    'mean': np.mean(data_array),
                    'std': np.std(data_array),
                    'min': np.min(data_array),
                    'max': np.max(data_array),
                    'latest': data_array[-1]
                }

        self.statistics = stats
        return stats

    def check_alerts(self, data):
        """
        ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯

        Parameters:
        -----------
        data : dict
            ç¾åœ¨ã®ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿

        Returns:
        --------
        alerts : list
            ç™ºç”Ÿã—ãŸã‚¢ãƒ©ãƒ¼ãƒˆã®ãƒªã‚¹ãƒˆ
        """
        alerts = []

        # æ¸©åº¦ã‚¢ãƒ©ãƒ¼ãƒˆ
        if data['temperature'] > self.alert_threshold.get('temperature_high', 185):
            alert_msg = f"HIGH TEMPERATURE: {data['temperature']:.2f}Â°C"
            alerts.append(alert_msg)
            logger.warning(alert_msg)

        if data['temperature'] < self.alert_threshold.get('temperature_low', 170):
            alert_msg = f"LOW TEMPERATURE: {data['temperature']:.2f}Â°C"
            alerts.append(alert_msg)
            logger.warning(alert_msg)

        # åœ§åŠ›ã‚¢ãƒ©ãƒ¼ãƒˆ
        if data['pressure'] > self.alert_threshold.get('pressure_high', 3.5):
            alert_msg = f"HIGH PRESSURE: {data['pressure']:.2f}bar"
            alerts.append(alert_msg)
            logger.warning(alert_msg)

        if data['pressure'] < self.alert_threshold.get('pressure_low', 2.5):
            alert_msg = f"LOW PRESSURE: {data['pressure']:.2f}bar"
            alerts.append(alert_msg)
            logger.warning(alert_msg)

        # æµé‡ã‚¢ãƒ©ãƒ¼ãƒˆ
        if data['flow_rate'] < self.alert_threshold.get('flow_rate_low', 40):
            alert_msg = f"LOW FLOW RATE: {data['flow_rate']:.2f}L/h"
            alerts.append(alert_msg)
            logger.warning(alert_msg)

        self.alert_count += len(alerts)
        return alerts

    def monitoring_loop(self):
        """
        ãƒ¡ã‚¤ãƒ³ç›£è¦–ãƒ«ãƒ¼ãƒ—
        """
        logger.info("Monitoring loop started")

        while self.is_running:
            try:
                # ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿å–ã‚Š
                data = self.read_sensor_data()

                # ãƒãƒƒãƒ•ã‚¡æ›´æ–°
                self.update_buffer(data)

                # çµ±è¨ˆé‡è¨ˆç®—
                self.calculate_statistics()

                # ã‚¢ãƒ©ãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
                alerts = self.check_alerts(data)

                # ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚°ï¼ˆå®šæœŸçš„ã«DBã«ä¿å­˜ã™ã‚‹ç­‰ï¼‰
                if len(self.data_buffer['timestamp']) % 60 == 0:  # 1åˆ†ã”ã¨
                    logger.info(f"System running normally. "
                               f"T={data['temperature']:.2f}Â°C, "
                               f"P={data['pressure']:.2f}bar, "
                               f"F={data['flow_rate']:.2f}L/h")

                # æ¬¡ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã¾ã§å¾…æ©Ÿ
                time.sleep(self.sampling_interval)

            except Exception as e:
                logger.error(f"Error in monitoring loop: {e}", exc_info=True)
                time.sleep(5)  # ã‚¨ãƒ©ãƒ¼æ™‚ã¯5ç§’å¾…æ©Ÿã—ã¦å†è©¦è¡Œ

    def start(self):
        """ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹å§‹"""
        if not self.is_running:
            self.is_running = True
            self.monitoring_thread = threading.Thread(target=self.monitoring_loop, daemon=True)
            self.monitoring_thread.start()
            logger.info("Production monitoring system started")

    def stop(self):
        """ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’åœæ­¢"""
        if self.is_running:
            self.is_running = False
            if self.monitoring_thread:
                self.monitoring_thread.join(timeout=5)
            logger.info("Production monitoring system stopped")

    def get_system_status(self):
        """
        ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—

        Returns:
        --------
        status : dict
            ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±
        """
        uptime = datetime.now() - self.uptime_start

        return {
            'is_running': self.is_running,
            'uptime': str(uptime),
            'buffer_size': len(self.data_buffer['timestamp']),
            'total_alerts': self.alert_count,
            'statistics': self.statistics,
            'latest_data': {
                'temperature': self.data_buffer['temperature'][-1] if len(self.data_buffer['temperature']) > 0 else None,
                'pressure': self.data_buffer['pressure'][-1] if len(self.data_buffer['pressure']) > 0 else None,
                'flow_rate': self.data_buffer['flow_rate'][-1] if len(self.data_buffer['flow_rate']) > 0 else None
            }
        }


# ä½¿ç”¨ä¾‹
if __name__ == "__main__":
    # ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
    alert_thresholds = {
        'temperature_high': 185,
        'temperature_low': 170,
        'pressure_high': 3.5,
        'pressure_low': 2.5,
        'flow_rate_low': 40
    }

    monitor = ProductionMonitoringSystem(
        sampling_interval=1.0,
        buffer_size=1000,
        alert_threshold=alert_thresholds
    )

    # ç›£è¦–é–‹å§‹
    monitor.start()

    try:
        # 60ç§’é–“å®Ÿè¡Œ
        for i in range(60):
            time.sleep(1)

            # 10ç§’ã”ã¨ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
            if i % 10 == 0:
                status = monitor.get_system_status()
                print(f"\n--- System Status (t={i}s) ---")
                print(f"Running: {status['is_running']}")
                print(f"Uptime: {status['uptime']}")
                print(f"Buffer: {status['buffer_size']}/{monitor.buffer_size}")
                print(f"Alerts: {status['total_alerts']}")
                if status['latest_data']['temperature']:
                    print(f"Latest Data:")
                    print(f"  T: {status['latest_data']['temperature']:.2f}Â°C")
                    print(f"  P: {status['latest_data']['pressure']:.2f}bar")
                    print(f"  F: {status['latest_data']['flow_rate']:.2f}L/h")

    except KeyboardInterrupt:
        print("\nShutting down...")

    finally:
        # ç›£è¦–åœæ­¢
        monitor.stop()

    print("\n" + "=" * 70)
    print("Production Monitoring System - Final Status")
    print("=" * 70)
    final_status = monitor.get_system_status()
    print(f"Total uptime: {final_status['uptime']}")
    print(f"Total alerts: {final_status['total_alerts']}")
    print(f"Total samples: {final_status['buffer_size']}")
</code></pre>

<p><strong>è§£èª¬:</strong> æœ¬ç•ªç’°å¢ƒã®ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã¯ã€å …ç‰¢æ€§ã€ãƒ­ã‚®ãƒ³ã‚°ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ã‚¹ãƒ¬ãƒƒãƒ‰ç®¡ç†ãŒé‡è¦ã§ã™ã€‚ã“ã®å®Ÿè£…ã¯ã€DCS/PLCã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æã€ã‚¢ãƒ©ãƒ¼ãƒˆç”Ÿæˆã€ãƒ­ã‚°è¨˜éŒ²ã‚’çµ±åˆã—ã€24æ™‚é–“365æ—¥ã®é€£ç¶šé‹ç”¨ã«å¯¾å¿œã—ã¾ã™ã€‚</p>

<hr />

<h2>5.8 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><strong>ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿å‡¦ç†</strong>
<ul>
<li>ç§»å‹•çª“ï¼ˆdequeï¼‰ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°</li>
<li>EWMAï¼ˆæŒ‡æ•°ç§»å‹•å¹³å‡ï¼‰ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆç›£è¦–</li>
</ul>
</li>
<li><strong>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ©Ÿæ¢°å­¦ç¿’</strong>
<ul>
<li>å¢—åˆ†å­¦ç¿’ï¼ˆSGDRegressorï¼‰ã«ã‚ˆã‚‹é©å¿œçš„ãƒ¢ãƒ‡ãƒ«</li>
<li>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³PCAã«ã‚ˆã‚‹å¤šå¤‰é‡ç•°å¸¸æ¤œçŸ¥</li>
</ul>
</li>
<li><strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–</strong>
<ul>
<li>Plotly Dashã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</li>
<li>å®šæœŸæ›´æ–°ã¨å‹•çš„ã‚°ãƒ©ãƒ•ç”Ÿæˆ</li>
</ul>
</li>
<li><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆ</strong>
<ul>
<li>InfluxDBã«ã‚ˆã‚‹æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°</li>
<li>WebSocketã«ã‚ˆã‚‹ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·é…ä¿¡</li>
</ul>
</li>
<li><strong>ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ </strong>
<ul>
<li>ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥</li>
<li>æ©Ÿæ¢°å­¦ç¿’ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥ï¼ˆIsolation Forestï¼‰</li>
<li>é‡è¦åº¦ã«å¿œã˜ãŸé€šçŸ¥</li>
</ul>
</li>
<li><strong>æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ</strong>
<ul>
<li>ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†</li>
<li>ãƒ­ã‚®ãƒ³ã‚°ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</li>
<li>é€£ç¶šé‹ç”¨ã¨ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–</li>
</ul>
</li>
</ol>

<h3>é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h3>

<ul>
<li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã§ã¯ã€ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã¨ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒé‡è¦</li>
<li>ç§»å‹•çª“ã¨EWMAã¯ã€ç„¡é™ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã§ãã‚‹</li>
<li>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã¯ã€æ¦‚å¿µãƒ‰ãƒªãƒ•ãƒˆï¼ˆãƒ—ãƒ­ã‚»ã‚¹å¤‰åŒ–ï¼‰ã«é©å¿œå¯èƒ½</li>
<li>Plotly Dashã¨InfluxDBã¯ã€ç”£æ¥­ç”¨ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®æ¨™æº–ãƒ„ãƒ¼ãƒ«</li>
<li>ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¯ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã¨MLãƒ™ãƒ¼ã‚¹ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨åŠ¹æœçš„</li>
<li>æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã¯ã€ãƒ­ãƒã‚¹ãƒˆæ€§ã€ãƒ­ã‚®ãƒ³ã‚°ã€ç›£è¦–æ©Ÿèƒ½ãŒä¸å¯æ¬ </li>
<li>WebSocketã¯åŒæ–¹å‘é€šä¿¡ãŒå¿…è¦ãªå ´åˆã«æœ‰åŠ¹</li>
</ul>

<h3>ã•ã‚‰ã«å­¦ã¶ã«ã¯</h3>

<ul>
<li><strong>Apache Kafka</strong>: å¤§è¦æ¨¡ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿å‡¦ç†</li>
<li><strong>Apache Flink</strong>: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</li>
<li><strong>Grafana</strong>: é«˜åº¦ãªå¯è¦–åŒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</li>
<li><strong>Prometheus</strong>: ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã¨ç›£è¦–</li>
<li><strong>Docker/Kubernetes</strong>: ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã¨è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</li>
<li><strong>OPC-UA</strong>: ç”£æ¥­æ©Ÿå™¨ã¨ã®æ¨™æº–é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«</li>
</ul>

<div class="navigation">
    <a href="chapter-4.html" class="nav-button">â† å‰ã®ç« </a>
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
</div>

    </main>

    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

    <footer>
        <p><strong>ä½œæˆè€…</strong>: PI Knowledge Hub Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-26</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>&copy; 2025 PI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
