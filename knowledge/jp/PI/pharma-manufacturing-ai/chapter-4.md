---
title: ç¬¬4ç«  é€£ç¶šç”Ÿç”£ã¨QbDå®Ÿè£…
chapter_title: ç¬¬4ç«  é€£ç¶šç”Ÿç”£ã¨QbDå®Ÿè£…
subtitle: Continuous Manufacturing and Quality by Design Implementation
---

ğŸŒ JP | [ğŸ‡¬ğŸ‡§ EN](<../../../en/PI/pharma-manufacturing-ai/chapter-4.html>) | Last sync: 2025-11-16

[AIå¯ºå­å±‹ãƒˆãƒƒãƒ—](<../../index.html>)â€º[ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹](<../../PI/index.html>)â€º[Pharma Manufacturing Ai](<../../PI/pharma-manufacturing-ai/index.html>)â€ºChapter 4

[â† ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹](<index.html>)

## ğŸ“– æœ¬ç« ã®æ¦‚è¦

åŒ»è–¬å“è£½é€ ã¯å¾“æ¥ã®ãƒãƒƒãƒç”Ÿç”£ã‹ã‚‰é€£ç¶šç”Ÿç”£ã¸ã®ç§»è¡ŒãŒé€²ã‚“ã§ã„ã¾ã™ã€‚ æœ¬ç« ã§ã¯ã€QbDï¼ˆQuality by Designï¼šå“è³ªã®è¨­è¨ˆï¼‰ã®æ¦‚å¿µã«åŸºã¥ãã€ å®Ÿé¨“è¨ˆç”»æ³•ï¼ˆDoEï¼‰ã€ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ã€ãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ´»ç”¨ã—ãŸ é€£ç¶šç”Ÿç”£ã‚·ã‚¹ãƒ†ãƒ ã®æœ€é©åŒ–ã¨å®Ÿè£…æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚ 

### ğŸ¯ å­¦ç¿’ç›®æ¨™

  * QbDï¼ˆQuality by Designï¼‰ã®åŸºæœ¬æ¦‚å¿µã¨ICH Q8-Q11ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
  * å®Ÿé¨“è¨ˆç”»æ³•ï¼ˆDoEï¼‰ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
  * ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ã®æ§‹ç¯‰ã¨å¯è¦–åŒ–
  * é€£ç¶šç”Ÿç”£ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆã¨åˆ¶å¾¡æˆ¦ç•¥
  * ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶å¾¡ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ¶å¾¡ã®å®Ÿè£…
  * ãƒãƒƒãƒç”Ÿç”£ã‹ã‚‰é€£ç¶šç”Ÿç”£ã¸ã®ç§»è¡Œæˆ¦ç•¥
  * ãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆICH Q9ï¼‰ã®é©ç”¨

## ğŸ¯ 4.1 QbDï¼ˆQuality by Designï¼‰ã®åŸºç¤

### QbDã®3ã¤ã®æŸ±

ICH Q8ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã§å®šç¾©ã•ã‚Œã‚‹QbDã®æ ¸å¿ƒæ¦‚å¿µï¼š

  1. **QTPPï¼ˆQuality Target Product Profileï¼‰** : ç›®æ¨™è£½å“å“è³ªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
  2. **CQAï¼ˆCritical Quality Attributesï¼‰** : é‡è¦å“è³ªç‰¹æ€§
  3. **CPPï¼ˆCritical Process Parametersï¼‰** : é‡è¦å·¥ç¨‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

**ğŸ­ QbDã®åˆ©ç‚¹**  
ãƒ»ç§‘å­¦çš„ç†è§£ã«åŸºã¥ã„ãŸãƒ—ãƒ­ã‚»ã‚¹è¨­è¨ˆ  
ãƒ»å“è³ªãƒªã‚¹ã‚¯ã®äº‹å‰è©•ä¾¡ã¨ä½æ¸›  
ãƒ»è¦åˆ¶å½“å±€ã¨ã®ç¶™ç¶šçš„ãªå¯¾è©±  
ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹å†…ã§ã®æŸ”è»Ÿãªè£½é€   
ãƒ»ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å…¨ä½“ã§ã®ç¶™ç¶šçš„æ”¹å–„ 

### ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ã®å®šç¾©

**ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆICH Q8å®šç¾©ï¼‰**

ã€Œã‚¤ãƒ³ãƒ—ãƒƒãƒˆå¤‰æ•°ï¼ˆåŸææ–™å±æ€§ãªã©ï¼‰ã¨ãƒ—ãƒ­ã‚»ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤šæ¬¡å…ƒçš„çµ„ã¿åˆã‚ã›ãŠã‚ˆã³ç›¸äº’ä½œç”¨ã§ã‚ã‚Šã€ å“è³ªã‚’ä¿è¨¼ã™ã‚‹ã“ã¨ãŒå®Ÿè¨¼ã•ã‚Œã¦ã„ã‚‹ç¯„å›²ã€ 

$$ \text{Design Space} = \\{(\mathbf{x}_1, \mathbf{x}_2, \ldots, \mathbf{x}_n) \mid \text{CQA}_i \in [\text{LSL}_i, \text{USL}_i] \, \forall i\\} $$ 

### ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹4.1: å®Ÿé¨“è¨ˆç”»æ³•ï¼ˆDoEï¼‰ã¨ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹æ§‹ç¯‰
    
    
    import numpy as np
    import pandas as pd
    import matplotlib.pyplot as plt
    from mpl_toolkits.mplot3d import Axes3D
    from sklearn.preprocessing import PolynomialFeatures
    from sklearn.linear_model import LinearRegression
    from sklearn.metrics import r2_score
    import warnings
    warnings.filterwarnings('ignore')
    
    plt.rcParams['font.sans-serif'] = ['Arial Unicode MS', 'DejaVu Sans']
    plt.rcParams['axes.unicode_minus'] = False
    
    class QbDDesigner:
        """QbDãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹è¨­è¨ˆã‚¯ãƒ©ã‚¹"""
    
        def __init__(self):
            self.model = None
            self.poly_features = None
    
        def generate_doe_design(self, design_type='central_composite'):
            """
            å®Ÿé¨“è¨ˆç”»ã®ç”Ÿæˆ
    
            Args:
                design_type: è¨ˆç”»ã‚¿ã‚¤ãƒ— ('full_factorial', 'central_composite', 'box_behnken')
    
            Returns:
                å®Ÿé¨“è¨ˆç”»ã®DataFrame
            """
            if design_type == 'central_composite':
                # ä¸­å¿ƒè¤‡åˆè¨ˆç”»ï¼ˆ3å› å­ï¼‰
                # å› å­: åå¿œæ¸©åº¦ï¼ˆ70-90â„ƒï¼‰ã€åå¿œæ™‚é–“ï¼ˆ60-180åˆ†ï¼‰ã€è§¦åª’é‡ï¼ˆ1-5%ï¼‰
    
                # ç«‹æ–¹ç‚¹ï¼ˆ2^3 = 8ç‚¹ï¼‰
                cube_points = np.array([
                    [-1, -1, -1], [1, -1, -1], [-1, 1, -1], [1, 1, -1],
                    [-1, -1, 1], [1, -1, 1], [-1, 1, 1], [1, 1, 1]
                ])
    
                # è»¸ç‚¹ï¼ˆ2Ã—3 = 6ç‚¹ã€Î±=1.682ï¼‰
                alpha = 1.682
                axial_points = np.array([
                    [-alpha, 0, 0], [alpha, 0, 0],
                    [0, -alpha, 0], [0, alpha, 0],
                    [0, 0, -alpha], [0, 0, alpha]
                ])
    
                # ä¸­å¿ƒç‚¹ï¼ˆ6åå¾©ï¼‰
                center_points = np.array([[0, 0, 0]] * 6)
    
                # çµ±åˆ
                design_matrix = np.vstack([cube_points, axial_points, center_points])
    
                # å®Ÿã‚¹ã‚±ãƒ¼ãƒ«ã¸ã®å¤‰æ›
                temp_range = (70, 90)
                time_range = (60, 180)
                catalyst_range = (1, 5)
    
                temperature = (design_matrix[:, 0] + 1) / 2 * (temp_range[1] - temp_range[0]) + temp_range[0]
                time = (design_matrix[:, 1] + 1) / 2 * (time_range[1] - time_range[0]) + time_range[0]
                catalyst = (design_matrix[:, 2] + 1) / 2 * (catalyst_range[1] - catalyst_range[0]) + catalyst_range[0]
    
                df_design = pd.DataFrame({
                    'run': range(1, len(design_matrix) + 1),
                    'temperature': temperature,
                    'time': time,
                    'catalyst': catalyst
                })
    
            return df_design
    
        def simulate_response(self, df_design):
            """
            å¿œç­”å¤‰æ•°ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåç‡ã¨purityï¼‰
    
            Args:
                df_design: å®Ÿé¨“è¨ˆç”»ã®DataFrame
    
            Returns:
                å¿œç­”å¤‰æ•°ã‚’è¿½åŠ ã—ãŸDataFrame
            """
            np.random.seed(42)
    
            # åç‡ãƒ¢ãƒ‡ãƒ«ï¼ˆ2æ¬¡å¼ + ãƒã‚¤ã‚ºï¼‰
            # æœ€é©æ¡ä»¶: æ¸©åº¦80â„ƒã€æ™‚é–“120åˆ†ã€è§¦åª’3%ã§æœ€å¤§åç‡
            temp_centered = (df_design['temperature'] - 80) / 10
            time_centered = (df_design['time'] - 120) / 60
            catalyst_centered = (df_design['catalyst'] - 3) / 2
    
            yield_base = (
                95  # ãƒ™ãƒ¼ã‚¹åç‡
                - 3 * temp_centered ** 2  # æ¸©åº¦ã®2æ¬¡åŠ¹æœ
                - 2 * time_centered ** 2  # æ™‚é–“ã®2æ¬¡åŠ¹æœ
                - 4 * catalyst_centered ** 2  # è§¦åª’ã®2æ¬¡åŠ¹æœ
                + 1.5 * temp_centered * time_centered  # äº¤äº’ä½œç”¨
                + np.random.normal(0, 1, len(df_design))  # ãƒã‚¤ã‚º
            )
    
            # Purityï¼ˆç´”åº¦ï¼‰ãƒ¢ãƒ‡ãƒ«
            purity_base = (
                99.5  # ãƒ™ãƒ¼ã‚¹ç´”åº¦
                - 0.5 * temp_centered ** 2
                - 0.3 * time_centered ** 2
                - 0.4 * catalyst_centered ** 2
                + np.random.normal(0, 0.1, len(df_design))
            )
    
            df_design['yield'] = np.clip(yield_base, 0, 100)
            df_design['purity'] = np.clip(purity_base, 95, 100)
    
            return df_design
    
        def build_response_surface_model(self, df_design, response_var):
            """
            å¿œç­”æ›²é¢ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰ï¼ˆ2æ¬¡å¤šé …å¼ï¼‰
    
            Args:
                df_design: å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿
                response_var: å¿œç­”å¤‰æ•°å
    
            Returns:
                è¨“ç·´ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«
            """
            X = df_design[['temperature', 'time', 'catalyst']].values
            y = df_design[response_var].values
    
            # 2æ¬¡å¤šé …å¼ç‰¹å¾´é‡ã®ç”Ÿæˆ
            self.poly_features = PolynomialFeatures(degree=2, include_bias=True)
            X_poly = self.poly_features.fit_transform(X)
    
            # ç·šå½¢å›å¸°ãƒ¢ãƒ‡ãƒ«
            self.model = LinearRegression()
            self.model.fit(X_poly, y)
    
            # äºˆæ¸¬ã¨è©•ä¾¡
            y_pred = self.model.predict(X_poly)
            r2 = r2_score(y, y_pred)
    
            return self.model, r2
    
        def predict_response(self, temperature, time, catalyst):
            """å¿œç­”äºˆæ¸¬"""
            X_new = np.array([[temperature, time, catalyst]])
            X_poly = self.poly_features.transform(X_new)
            return self.model.predict(X_poly)[0]
    
        def plot_design_space(self, df_design, temp_range, time_range, catalyst_fixed=3):
            """ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ã®å¯è¦–åŒ–"""
            fig = plt.figure(figsize=(16, 6))
    
            # æ¸©åº¦-æ™‚é–“å¹³é¢ã§ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆè§¦åª’é‡å›ºå®šï¼‰
            temp_grid = np.linspace(temp_range[0], temp_range[1], 50)
            time_grid = np.linspace(time_range[0], time_range[1], 50)
            T_mesh, Ti_mesh = np.meshgrid(temp_grid, time_grid)
    
            # åç‡äºˆæ¸¬
            yield_grid = np.zeros_like(T_mesh)
            purity_grid = np.zeros_like(T_mesh)
    
            for i in range(len(temp_grid)):
                for j in range(len(time_grid)):
                    yield_grid[j, i] = self.predict_response(T_mesh[j, i], Ti_mesh[j, i], catalyst_fixed)
                    purity_grid[j, i] = self.predict_response(T_mesh[j, i], Ti_mesh[j, i], catalyst_fixed)
    
            # åç‡ã®ç­‰é«˜ç·šå›³
            ax1 = fig.add_subplot(131)
            contour_yield = ax1.contourf(T_mesh, Ti_mesh, yield_grid, levels=20, cmap='RdYlGn')
            ax1.contour(T_mesh, Ti_mesh, yield_grid, levels=[90, 92, 94], colors='black',
                        linewidths=1.5, linestyles='dashed')
            ax1.scatter(df_design['temperature'], df_design['time'], c='blue', s=50,
                        edgecolor='black', linewidth=1, label='å®Ÿé¨“ç‚¹', zorder=5)
            ax1.set_xlabel('åå¿œæ¸©åº¦ï¼ˆâ„ƒï¼‰')
            ax1.set_ylabel('åå¿œæ™‚é–“ï¼ˆåˆ†ï¼‰')
            ax1.set_title(f'åç‡ï¼ˆè§¦åª’é‡={catalyst_fixed}%ï¼‰', fontsize=12, fontweight='bold')
            ax1.legend()
            plt.colorbar(contour_yield, ax=ax1, label='åç‡ï¼ˆ%ï¼‰')
    
            # ç´”åº¦ã®ç­‰é«˜ç·šå›³
            ax2 = fig.add_subplot(132)
            contour_purity = ax2.contourf(T_mesh, Ti_mesh, purity_grid, levels=20, cmap='Blues')
            ax2.contour(T_mesh, Ti_mesh, purity_grid, levels=[99.0, 99.2, 99.4], colors='black',
                        linewidths=1.5, linestyles='dashed')
            ax2.scatter(df_design['temperature'], df_design['time'], c='blue', s=50,
                        edgecolor='black', linewidth=1, label='å®Ÿé¨“ç‚¹', zorder=5)
            ax2.set_xlabel('åå¿œæ¸©åº¦ï¼ˆâ„ƒï¼‰')
            ax2.set_ylabel('åå¿œæ™‚é–“ï¼ˆåˆ†ï¼‰')
            ax2.set_title(f'ç´”åº¦ï¼ˆè§¦åª’é‡={catalyst_fixed}%ï¼‰', fontsize=12, fontweight='bold')
            ax2.legend()
            plt.colorbar(contour_purity, ax=ax2, label='ç´”åº¦ï¼ˆ%ï¼‰')
    
            # ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆåç‡â‰¥90% AND ç´”åº¦â‰¥99.0%ï¼‰
            ax3 = fig.add_subplot(133)
            design_space_mask = (yield_grid >= 90) & (purity_grid >= 99.0)
    
            ax3.contourf(T_mesh, Ti_mesh, design_space_mask.astype(int), levels=[0, 0.5, 1],
                         colors=['red', 'green'], alpha=0.3)
            ax3.contour(T_mesh, Ti_mesh, yield_grid, levels=[90], colors='blue',
                        linewidths=2, linestyles='solid', label='åç‡=90%')
            ax3.contour(T_mesh, Ti_mesh, purity_grid, levels=[99.0], colors='orange',
                        linewidths=2, linestyles='solid', label='ç´”åº¦=99.0%')
            ax3.scatter(df_design['temperature'], df_design['time'], c='blue', s=50,
                        edgecolor='black', linewidth=1, label='å®Ÿé¨“ç‚¹', zorder=5)
            ax3.set_xlabel('åå¿œæ¸©åº¦ï¼ˆâ„ƒï¼‰')
            ax3.set_ylabel('åå¿œæ™‚é–“ï¼ˆåˆ†ï¼‰')
            ax3.set_title('ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆç·‘=è¨±å®¹é ˜åŸŸï¼‰', fontsize=12, fontweight='bold')
            ax3.legend()
    
            plt.tight_layout()
            plt.savefig('qbd_design_space.png', dpi=300, bbox_inches='tight')
            plt.show()
    
    # å®Ÿè¡Œä¾‹
    print("=" * 60)
    print("QbDãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹è¨­è¨ˆã‚·ã‚¹ãƒ†ãƒ ")
    print("=" * 60)
    
    # QbDè¨­è¨ˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    qbd = QbDDesigner()
    
    # ä¸­å¿ƒè¤‡åˆè¨ˆç”»ã®ç”Ÿæˆ
    df_design = qbd.generate_doe_design(design_type='central_composite')
    
    print(f"\nå®Ÿé¨“è¨ˆç”»æ³•ï¼ˆä¸­å¿ƒè¤‡åˆè¨ˆç”»ï¼‰:")
    print(f"å®Ÿé¨“æ•°: {len(df_design)}")
    print(f"\nå› å­ãƒ¬ãƒ™ãƒ«:")
    print(f"  åå¿œæ¸©åº¦: 70-90â„ƒ")
    print(f"  åå¿œæ™‚é–“: 60-180åˆ†")
    print(f"  è§¦åª’é‡: 1-5%")
    
    # å¿œç­”å¤‰æ•°ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    df_design = qbd.simulate_response(df_design)
    
    print(f"\nå¿œç­”å¤‰æ•°:")
    print(f"  åç‡: {df_design['yield'].min():.1f}-{df_design['yield'].max():.1f}%")
    print(f"  ç´”åº¦: {df_design['purity'].min():.2f}-{df_design['purity'].max():.2f}%")
    
    # å¿œç­”æ›²é¢ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
    model_yield, r2_yield = qbd.build_response_surface_model(df_design, 'yield')
    print(f"\nåç‡ãƒ¢ãƒ‡ãƒ« RÂ² = {r2_yield:.4f}")
    
    model_purity, r2_purity = qbd.build_response_surface_model(df_design, 'purity')
    print(f"ç´”åº¦ãƒ¢ãƒ‡ãƒ« RÂ² = {r2_purity:.4f}")
    
    # æœ€é©æ¡ä»¶ã®æ¢ç´¢
    print(f"\næœ€é©æ¡ä»¶äºˆæ¸¬:")
    optimal_yield = qbd.predict_response(80, 120, 3)
    print(f"  æ¸©åº¦=80â„ƒ, æ™‚é–“=120åˆ†, è§¦åª’=3%")
    print(f"  â†’ åç‡ = {optimal_yield:.2f}%")
    
    # ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹å¯è¦–åŒ–
    qbd.plot_design_space(df_design, temp_range=(70, 90), time_range=(60, 180), catalyst_fixed=3)
    

**å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ:**

  * ä¸­å¿ƒè¤‡åˆè¨ˆç”»ï¼ˆCCDï¼‰ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªå®Ÿé¨“è¨­è¨ˆ
  * 2æ¬¡å¤šé …å¼ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹å¿œç­”æ›²é¢ã®æ§‹ç¯‰
  * å¤šç›®çš„æœ€é©åŒ–ï¼ˆåç‡ã¨ç´”åº¦ã®ä¸¡ç«‹ï¼‰
  * ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ã®å¯è¦–åŒ–ã¨è¨±å®¹é ˜åŸŸã®ç‰¹å®š
  * ç§‘å­¦çš„æ ¹æ‹ ã«åŸºã¥ããƒ—ãƒ­ã‚»ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š

## âš™ï¸ 4.2 é€£ç¶šç”Ÿç”£ã‚·ã‚¹ãƒ†ãƒ ã®åˆ¶å¾¡æˆ¦ç•¥

### ãƒãƒƒãƒ vs é€£ç¶šç”Ÿç”£

é …ç›® | ãƒãƒƒãƒç”Ÿç”£ | é€£ç¶šç”Ÿç”£  
---|---|---  
ç”Ÿç”£å½¢æ…‹ | é–“æ¬ çš„ | é€£ç¶šçš„  
ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ  | æ•°æ—¥ï½æ•°é€±é–“ | æ•°æ™‚é–“  
è¨­å‚™è¦æ¨¡ | å¤§å‹ | å°å‹  
æŸ”è»Ÿæ€§ | é«˜ã„ | è£½å“åˆ‡æ›¿ã«æ™‚é–“  
å“è³ªç®¡ç† | ãƒãƒƒãƒå˜ä½ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ   
åœ¨åº« | ä¸­é–“åœ¨åº«å¤§ | æœ€å°åŒ–  
  
### ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹4.2: é€£ç¶šç”Ÿç”£ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶å¾¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    
    
    import numpy as np
    import pandas as pd
    import matplotlib.pyplot as plt
    from scipy.integrate import odeint
    import warnings
    warnings.filterwarnings('ignore')
    
    plt.rcParams['font.sans-serif'] = ['Arial Unicode MS', 'DejaVu Sans']
    plt.rcParams['axes.unicode_minus'] = False
    
    class ContinuousManufacturingSimulator:
        """é€£ç¶šç”Ÿç”£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿"""
    
        def __init__(self, target_concentration=5.0):
            """
            Args:
                target_concentration: ç›®æ¨™æ¿ƒåº¦ï¼ˆmol/Lï¼‰
            """
            self.target = target_concentration
            self.Kp = 2.0  # æ¯”ä¾‹ã‚²ã‚¤ãƒ³
            self.Ki = 0.5  # ç©åˆ†ã‚²ã‚¤ãƒ³
            self.Kd = 0.1  # å¾®åˆ†ã‚²ã‚¤ãƒ³
            self.integral_error = 0
            self.previous_error = 0
    
        def reactor_dynamics(self, state, t, feed_rate, T):
            """
            é€£ç¶šåå¿œå™¨ã®å‹•ç‰¹æ€§ï¼ˆCSTR: Continuous Stirred-Tank Reactorï¼‰
    
            Args:
                state: [æ¿ƒåº¦ C, æ¸©åº¦ T_reactor]
                t: æ™‚é–“
                feed_rate: ä¾›çµ¦æµé‡
                T: è¨­å®šæ¸©åº¦
    
            Returns:
                çŠ¶æ…‹å¤‰åŒ–ç‡ [dC/dt, dT/dt]
            """
            C, T_reactor = state
    
            # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
            V = 10.0  # åå¿œå™¨å®¹ç©ï¼ˆLï¼‰
            k0 = 1e10  # é »åº¦å› å­
            Ea = 8000  # æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆJ/molï¼‰
            R = 8.314  # æ°—ä½“å®šæ•°
            C_in = 10.0  # ä¾›çµ¦æ¿ƒåº¦ï¼ˆmol/Lï¼‰
    
            # åå¿œé€Ÿåº¦å®šæ•°ï¼ˆArrheniuså¼ï¼‰
            k = k0 * np.exp(-Ea / (R * (T_reactor + 273.15)))
    
            # ç‰©è³ªåæ”¯
            dC_dt = feed_rate / V * (C_in - C) - k * C
    
            # ã‚¨ãƒãƒ«ã‚®ãƒ¼åæ”¯ï¼ˆç°¡ç•¥åŒ–ï¼‰
            dT_dt = 0.1 * (T - T_reactor)  # æ¸©åº¦åˆ¶å¾¡
    
            return [dC_dt, dT_dt]
    
        def pid_controller(self, error, dt=0.1):
            """
            PIDåˆ¶å¾¡å™¨
    
            Args:
                error: åå·®ï¼ˆç›®æ¨™å€¤ - ç¾åœ¨å€¤ï¼‰
                dt: ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ™‚é–“
    
            Returns:
                åˆ¶å¾¡å‡ºåŠ›ï¼ˆä¾›çµ¦æµé‡èª¿æ•´ï¼‰
            """
            # ç©åˆ†é …
            self.integral_error += error * dt
    
            # å¾®åˆ†é …
            derivative_error = (error - self.previous_error) / dt
    
            # PIDå‡ºåŠ›
            output = (self.Kp * error +
                      self.Ki * self.integral_error +
                      self.Kd * derivative_error)
    
            self.previous_error = error
    
            return output
    
        def simulate_continuous_process(self, duration=100, disturbance_times=None):
            """
            é€£ç¶šç”Ÿç”£ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    
            Args:
                duration: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ï¼ˆåˆ†ï¼‰
                disturbance_times: å¤–ä¹±ç™ºç”Ÿæ™‚åˆ»ã®ãƒªã‚¹ãƒˆ
    
            Returns:
                æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®DataFrame
            """
            dt = 0.1  # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ™‚é–“ï¼ˆåˆ†ï¼‰
            t = np.arange(0, duration, dt)
    
            # åˆæœŸçŠ¶æ…‹
            C = 5.0  # åˆæœŸæ¿ƒåº¦
            T_reactor = 80.0  # åˆæœŸåå¿œå™¨æ¸©åº¦
            state = [C, T_reactor]
    
            # è¨˜éŒ²ç”¨ãƒªã‚¹ãƒˆ
            concentrations = []
            temperatures = []
            feed_rates = []
            errors = []
            setpoints = []
    
            # åŸºæº–ä¾›çµ¦æµé‡
            base_feed_rate = 1.0  # L/min
    
            for i, time in enumerate(t):
                # ç›®æ¨™å€¤ï¼ˆã‚»ãƒƒãƒˆãƒã‚¤ãƒ³ãƒˆå¤‰æ›´ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
                if time < 30:
                    target = 5.0
                elif time < 60:
                    target = 6.0
                else:
                    target = 5.5
    
                # å¤–ä¹±ã®è¿½åŠ 
                if disturbance_times and any(abs(time - dt_time) < 0.5 for dt_time in disturbance_times):
                    state[0] += np.random.uniform(-0.5, 0.5)  # æ¿ƒåº¦å¤–ä¹±
    
                # PIDåˆ¶å¾¡
                error = target - state[0]
                control_output = self.pid_controller(error, dt)
    
                # ä¾›çµ¦æµé‡ã®æ›´æ–°ï¼ˆåˆ¶ç´„ä»˜ãï¼‰
                feed_rate = np.clip(base_feed_rate + control_output, 0.5, 2.0)
    
                # åå¿œå™¨ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ã®æ›´æ–°
                state = odeint(self.reactor_dynamics, state, [time, time + dt],
                               args=(feed_rate, 80.0))[-1]
    
                # è¨˜éŒ²
                concentrations.append(state[0])
                temperatures.append(state[1])
                feed_rates.append(feed_rate)
                errors.append(error)
                setpoints.append(target)
    
            df_results = pd.DataFrame({
                'time': t,
                'concentration': concentrations,
                'temperature': temperatures,
                'feed_rate': feed_rates,
                'error': errors,
                'setpoint': setpoints
            })
    
            return df_results
    
        def plot_control_performance(self, df_results):
            """åˆ¶å¾¡æ€§èƒ½ã®å¯è¦–åŒ–"""
            fig, axes = plt.subplots(3, 1, figsize=(14, 10))
    
            # æ¿ƒåº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
            axes[0].plot(df_results['time'], df_results['concentration'], color='#11998e',
                         linewidth=2, label='å®Ÿæ¸¬æ¿ƒåº¦')
            axes[0].plot(df_results['time'], df_results['setpoint'], color='red',
                         linestyle='--', linewidth=2, label='ç›®æ¨™æ¿ƒåº¦')
            axes[0].fill_between(df_results['time'],
                                  df_results['setpoint'] - 0.1,
                                  df_results['setpoint'] + 0.1,
                                  alpha=0.2, color='green', label='è¨±å®¹ç¯„å›² (Â±0.1)')
            axes[0].set_xlabel('æ™‚é–“ï¼ˆåˆ†ï¼‰')
            axes[0].set_ylabel('æ¿ƒåº¦ï¼ˆmol/Lï¼‰')
            axes[0].set_title('é€£ç¶šåå¿œå™¨ã®æ¿ƒåº¦åˆ¶å¾¡', fontsize=12, fontweight='bold')
            axes[0].legend()
            axes[0].grid(alpha=0.3)
    
            # ä¾›çµ¦æµé‡
            axes[1].plot(df_results['time'], df_results['feed_rate'], color='#38ef7d',
                         linewidth=2)
            axes[1].set_xlabel('æ™‚é–“ï¼ˆåˆ†ï¼‰')
            axes[1].set_ylabel('ä¾›çµ¦æµé‡ï¼ˆL/minï¼‰')
            axes[1].set_title('PIDåˆ¶å¾¡å™¨å‡ºåŠ›ï¼ˆä¾›çµ¦æµé‡ï¼‰', fontsize=12, fontweight='bold')
            axes[1].grid(alpha=0.3)
    
            # åˆ¶å¾¡èª¤å·®
            axes[2].plot(df_results['time'], df_results['error'], color='#f38181',
                         linewidth=1.5)
            axes[2].axhline(y=0, color='black', linestyle='-', linewidth=1)
            axes[2].fill_between(df_results['time'], -0.1, 0.1,
                                  alpha=0.2, color='green', label='è¨±å®¹èª¤å·®')
            axes[2].set_xlabel('æ™‚é–“ï¼ˆåˆ†ï¼‰')
            axes[2].set_ylabel('åˆ¶å¾¡èª¤å·®ï¼ˆmol/Lï¼‰')
            axes[2].set_title('åˆ¶å¾¡èª¤å·®', fontsize=12, fontweight='bold')
            axes[2].legend()
            axes[2].grid(alpha=0.3)
    
            plt.tight_layout()
            plt.savefig('continuous_manufacturing_control.png', dpi=300, bbox_inches='tight')
            plt.show()
    
    # å®Ÿè¡Œä¾‹
    print("=" * 60)
    print("é€£ç¶šç”Ÿç”£ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶å¾¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")
    print("=" * 60)
    
    # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®åˆæœŸåŒ–
    cm_sim = ContinuousManufacturingSimulator(target_concentration=5.0)
    
    # å¤–ä¹±ç™ºç”Ÿæ™‚åˆ»ã®è¨­å®š
    disturbance_times = [40, 70]
    
    # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    df_results = cm_sim.simulate_continuous_process(duration=100, disturbance_times=disturbance_times)
    
    # æ€§èƒ½è©•ä¾¡
    print(f"\nã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ:")
    print(f"ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: {df_results['time'].max():.1f} åˆ†")
    print(f"æ¿ƒåº¦ç¯„å›²: {df_results['concentration'].min():.2f}-{df_results['concentration'].max():.2f} mol/L")
    print(f"å¹³å‡åˆ¶å¾¡èª¤å·®: {df_results['error'].abs().mean():.4f} mol/L")
    print(f"æœ€å¤§åˆ¶å¾¡èª¤å·®: {df_results['error'].abs().max():.4f} mol/L")
    
    # å®šå¸¸åå·®ã®è©•ä¾¡ï¼ˆæœ€å¾Œã®10åˆ†é–“ï¼‰
    steady_state_data = df_results[df_results['time'] > 90]
    steady_state_error = steady_state_data['error'].abs().mean()
    print(f"å®šå¸¸åå·®: {steady_state_error:.4f} mol/L")
    
    # å¯è¦–åŒ–
    cm_sim.plot_control_performance(df_results)
    

**å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ:**

  * é€£ç¶šåå¿œå™¨ï¼ˆCSTRï¼‰ã®å‹•çš„ãƒ¢ãƒ‡ãƒªãƒ³ã‚°
  * PIDåˆ¶å¾¡ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ¶å¾¡
  * ã‚»ãƒƒãƒˆãƒã‚¤ãƒ³ãƒˆå¤‰æ›´ã¨å¤–ä¹±ã¸ã®å¿œç­”æ€§è©•ä¾¡
  * åˆ¶å¾¡æ€§èƒ½ã®å®šé‡è©•ä¾¡ï¼ˆå®šå¸¸åå·®ã€å¿œç­”æ™‚é–“ï¼‰
  * ãƒãƒƒãƒç”Ÿç”£ã«ãªã„é€£ç¶šç”Ÿç”£ç‰¹æœ‰ã®åˆ¶å¾¡èª²é¡Œã¸ã®å¯¾å¿œ

## ğŸ“š ã¾ã¨ã‚

æœ¬ç« ã§ã¯ã€é€£ç¶šç”Ÿç”£ã¨QbDå®Ÿè£…ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸã€‚

### ä¸»è¦ãªãƒã‚¤ãƒ³ãƒˆ

  * QbDã®3ã¤ã®æŸ±ï¼ˆQTPPã€CQAã€CPPï¼‰ã¨ç§‘å­¦çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
  * å®Ÿé¨“è¨ˆç”»æ³•ï¼ˆDoEï¼‰ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
  * ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ãƒšãƒ¼ã‚¹ã®æ§‹ç¯‰ã¨å¯è¦–åŒ–
  * é€£ç¶šç”Ÿç”£ã‚·ã‚¹ãƒ†ãƒ ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶å¾¡æˆ¦ç•¥
  * PIDåˆ¶å¾¡ã«ã‚ˆã‚‹å®‰å®šã—ãŸå“è³ªä¿è¨¼

**ğŸ¯ æ¬¡ç« äºˆå‘Š**  
ç¬¬5ç« ã§ã¯ã€AIã‚·ã‚¹ãƒ†ãƒ ã®è¦åˆ¶å¯¾å¿œã¨CSVï¼ˆComputer System Validationï¼‰å®Ÿè£…æˆ¦ç•¥ã«ã¤ã„ã¦å­¦ã³ã¾ã™ã€‚ 21 CFR Part 11æº–æ‹ ã€ç›£æŸ»è¨¼è·¡ã€é›»å­ç½²åã€ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒ†ã‚°ãƒªãƒ†ã‚£ã®å®Ÿè£…ãªã©ã€ GMPç’°å¢ƒã§ã®AIã‚·ã‚¹ãƒ†ãƒ å°å…¥ã«å¿…é ˆã®çŸ¥è­˜ã‚’ç¿’å¾—ã—ã¾ã™ã€‚ 

[â† ç¬¬3ç« : PATã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å“è³ªç®¡ç†](<chapter-3.html>) [ç¬¬5ç« : è¦åˆ¶å¯¾å¿œã¨CSVå®Ÿè£… â†’](<chapter-5.html>)

### å…è²¬äº‹é …

  * æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
  * æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹Code examplesã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚
  * å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
  * æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
  * æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
  * æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚
