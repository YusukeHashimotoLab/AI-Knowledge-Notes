<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¬¬3ç« ï¼šç•°å¸¸æ¤œçŸ¥ã¨ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦– - æ©Ÿæ¢°å­¦ç¿’ã‚’ç”¨ã„ãŸé«˜åº¦ãªç•°å¸¸æ¤œçŸ¥æ‰‹æ³•">
    <title>ç¬¬3ç« ï¼šç•°å¸¸æ¤œçŸ¥ã¨ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦– - PI Terakoya</title>

        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8; color: #333; background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; padding: 2rem 1rem; text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .back-link {
            display: inline-block; margin-bottom: 2rem; padding: 0.5rem 1rem;
            background: white; color: #11998e; text-decoration: none;
            border-radius: 6px; font-weight: 600;
        }
        .content-box {
            background: white; padding: 2rem; border-radius: 12px;
            margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #11998e; margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem; border-bottom: 3px solid #11998e;
        }
        h3 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h4 { color: #2c3e50; margin: 1rem 0 0.5rem 0; }
        p { margin-bottom: 1rem; }
        ul, ol { margin-left: 2rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
        pre {
            background: #1e1e1e; color: #d4d4d4; padding: 1.5rem;
            border-radius: 8px; overflow-x: auto; margin: 1rem 0;
            border-left: 4px solid #11998e;
        }
        code {
            font-family: 'Courier New', monospace; font-size: 0.9rem;
        }
        .key-point {
            background: #e8f5e9; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #4caf50; margin: 1rem 0;
        }
        .tech-note {
            background: #e3f2fd; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #2196f3; margin: 1rem 0;
        }
        .formula {
            background: #f0f7ff; padding: 1rem; border-radius: 6px;
            margin: 1rem 0; overflow-x: auto;
        }
        table {
            width: 100%; border-collapse: collapse; margin: 1rem 0;
        }
        th, td {
            border: 1px solid #ddd; padding: 0.75rem; text-align: left;
        }
        th {
            background: #11998e; color: white; font-weight: 600;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: 3rem;
        }
        .nav-buttons a {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; text-decoration: none; border-radius: 6px;
            font-weight: 600;
        }
        footer {
            background: #2c3e50; color: white; text-align: center;
            padding: 2rem 1rem; margin-top: 4rem;
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.6rem; }
            .container { padding: 0 0.5rem; }
            pre { padding: 1rem; }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
            <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/PI/process-monitoring-control-introduction/chapter-3.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="../../PI/index.html">ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹</a><span class="breadcrumb-separator">â€º</span><a href="../../PI/process-monitoring-control-introduction/index.html">Process Monitoring Control</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 3</span>
        </div>
    </nav>

        <header>
        <div class="container">
            <h1>ç¬¬3ç« ï¼šç•°å¸¸æ¤œçŸ¥ã¨ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–</h1>
            <p class="subtitle">ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ©Ÿæ¢°å­¦ç¿’ã¾ã§ - åŒ…æ‹¬çš„ãªç•°å¸¸æ¤œçŸ¥æ‰‹æ³•</p>
            <div class="meta">
                <span class="meta">ğŸ“– èª­äº†æ™‚é–“: 30-35åˆ†</span>
                <span class="meta">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´šã€œä¸Šç´š</span>
                <span class="meta">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 8å€‹</span>
            </div>
        </div>
    </header>

    <main class="container">

<div class="learning-objectives">
<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥ã®å®Ÿè£…ã¨é™ç•Œã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… çµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥æ‰‹æ³•ï¼ˆZ-score, ä¿®æ­£Z-scoreï¼‰ã‚’é©ç”¨ã§ãã‚‹</li>
<li>âœ… æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥ï¼ˆIsolation Forest, One-Class SVMï¼‰ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆLSTM Autoencoderï¼‰ã§æ™‚ç³»åˆ—ç•°å¸¸ã‚’æ¤œçŸ¥ã§ãã‚‹</li>
<li>âœ… ã‚¢ãƒ©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆã—èª¤å ±ã‚’å‰Šæ¸›ã§ãã‚‹</li>
</ul>
</div>

<hr />

<h2>3.1 ç•°å¸¸æ¤œçŸ¥ã®åŸºç¤</h2>

<h3>ç•°å¸¸æ¤œçŸ¥ã¨ã¯</h3>

<p><strong>ç•°å¸¸æ¤œçŸ¥ï¼ˆAnomaly Detectionï¼‰</strong>ã¯ã€æ­£å¸¸ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰å¤§ããé€¸è„±ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è­˜åˆ¥ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã§ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ç”£æ¥­ã§ã¯ã€è¨­å‚™æ•…éšœã€å“è³ªç•°å¸¸ã€ãƒ—ãƒ­ã‚»ã‚¹ç•°å¸¸ã®æ—©æœŸç™ºè¦‹ã«ä¸å¯æ¬ ã§ã™ã€‚</p>

<table>
<thead>
<tr>
<th>ç•°å¸¸æ¤œçŸ¥æ‰‹æ³•</th>
<th>ç‰¹å¾´</th>
<th>åˆ©ç‚¹</th>
<th>æ¬ ç‚¹</th>
<th>é©ç”¨ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹</strong></td>
<td>é–¾å€¤ã«ã‚ˆã‚‹åˆ¤å®š</td>
<td>ã‚·ãƒ³ãƒ—ãƒ«ã€è§£é‡ˆå®¹æ˜“</td>
<td>è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºå›°é›£</td>
<td>æ¸©åº¦ãƒ»åœ§åŠ›ç›£è¦–</td>
</tr>
<tr>
<td><strong>çµ±è¨ˆçš„æ‰‹æ³•</strong></td>
<td>çµ±è¨ˆåˆ†å¸ƒã‹ã‚‰ã®é€¸è„±</td>
<td>ç†è«–çš„æ ¹æ‹ ã‚ã‚Š</td>
<td>æ­£è¦åˆ†å¸ƒä»®å®šãŒå¿…è¦</td>
<td>ãƒ—ãƒ­ã‚»ã‚¹å¤‰æ•°ç›£è¦–</td>
</tr>
<tr>
<td><strong>æ©Ÿæ¢°å­¦ç¿’</strong></td>
<td>ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³å­¦ç¿’</td>
<td>è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºå¯èƒ½</td>
<td>è§£é‡ˆæ€§ä½ã„ã€ãƒ‡ãƒ¼ã‚¿å¿…è¦</td>
<td>å¤šå¤‰é‡ç•°å¸¸æ¤œçŸ¥</td>
</tr>
<tr>
<td><strong>ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°</strong></td>
<td>æ·±å±¤ç‰¹å¾´æŠ½å‡º</td>
<td>é«˜æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿å¯¾å¿œ</td>
<td>è¨ˆç®—ã‚³ã‚¹ãƒˆé«˜ã€ãƒ‡ãƒ¼ã‚¿å¤§é‡</td>
<td>æ™‚ç³»åˆ—ç•°å¸¸æ¤œçŸ¥</td>
</tr>
</tbody>
</table>

<h3>ç•°å¸¸æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</h3>

<div class="mermaid">
graph TD
    A[ãƒ‡ãƒ¼ã‚¿åé›†] --> B[å‰å‡¦ç†ãƒ»æ­£è¦åŒ–]
    B --> C[ç‰¹å¾´æŠ½å‡º]
    C --> D[ç•°å¸¸æ¤œçŸ¥ãƒ¢ãƒ‡ãƒ«]
    D --> E{ç•°å¸¸åˆ¤å®š}
    E -->|æ­£å¸¸| F[é€šå¸¸é‹è»¢ç¶™ç¶š]
    E -->|ç•°å¸¸| G[ã‚¢ãƒ©ãƒ¼ãƒ ç”Ÿæˆ]
    G --> H[æ ¹æœ¬åŸå› åˆ†æ]
    H --> I[å¯¾ç­–å®Ÿè¡Œ]
    I --> A

    style A fill:#e8f5e9
    style D fill:#b3e5fc
    style G fill:#ffcdd2
    style I fill:#fff9c4
</div>

<hr />

<h2>3.2 ã‚³ãƒ¼ãƒ‰ä¾‹ï¼šç•°å¸¸æ¤œçŸ¥æ‰‹æ³•ã®å®Ÿè£…</h2>

<div class="code-example">
<h4>ã‚³ãƒ¼ãƒ‰ä¾‹1: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥ï¼ˆé–¾å€¤ãƒ™ãƒ¼ã‚¹ï¼‰</h4>

<p><strong>ç›®çš„</strong>: ã‚·ãƒ³ãƒ—ãƒ«ãªé–¾å€¤ãƒ«ãƒ¼ãƒ«ã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã™ã‚‹ã€‚</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
plt.rcParams['font.sans-serif'] = ['Hiragino Sans', 'Arial']
plt.rcParams['axes.unicode_minus'] = False

np.random.seed(42)

# ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆåå¿œå™¨æ¸©åº¦ã€200ã‚µãƒ³ãƒ—ãƒ«ï¼‰
n_samples = 200
time_index = pd.date_range('2025-01-01', periods=n_samples, freq='1min')

# æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ï¼ˆå¹³å‡175Â°Cã€æ¨™æº–åå·®2Â°Cï¼‰
temperature = np.random.normal(175, 2, n_samples)

# æ„å›³çš„ãªç•°å¸¸ã‚’æŒ¿å…¥
# ç•°å¸¸1: ã‚¹ãƒ‘ã‚¤ã‚¯ï¼ˆã‚µãƒ³ãƒ—ãƒ«50ï¼‰
temperature[50] = 190

# ç•°å¸¸2: å¾ã€…ã«ä¸Šæ˜‡ï¼ˆã‚µãƒ³ãƒ—ãƒ«120-140ï¼‰
temperature[120:141] = 175 + np.linspace(0, 10, 21)

# ç•°å¸¸3: ä½æ¸©ç•°å¸¸ï¼ˆã‚µãƒ³ãƒ—ãƒ«180-190ï¼‰
temperature[180:191] = np.random.normal(165, 1.5, 11)

# DataFrameã«æ ¼ç´
df = pd.DataFrame({
    'timestamp': time_index,
    'temperature': temperature
})
df.set_index('timestamp', inplace=True)

class RuleBasedAnomalyDetector:
    """ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, rules):
        """
        Parameters:
        -----------
        rules : dict
            ç•°å¸¸æ¤œçŸ¥ãƒ«ãƒ¼ãƒ«ã®è¾æ›¸
            ä¾‹: {'upper_limit': 180, 'lower_limit': 170, ...}
        """
        self.rules = rules
        self.anomalies = []

    def detect(self, data):
        """ç•°å¸¸æ¤œçŸ¥ã‚’å®Ÿè¡Œ"""
        anomaly_flags = np.zeros(len(data), dtype=bool)
        anomaly_types = [''] * len(data)

        for i, value in enumerate(data):
            # ãƒ«ãƒ¼ãƒ«1: ä¸Šé™é–¾å€¤ãƒã‚§ãƒƒã‚¯
            if value > self.rules.get('upper_limit', float('inf')):
                anomaly_flags[i] = True
                anomaly_types[i] = 'ä¸Šé™è¶…é'
                self.anomalies.append({
                    'index': i,
                    'value': value,
                    'type': 'ä¸Šé™è¶…é',
                    'severity': 'HIGH'
                })

            # ãƒ«ãƒ¼ãƒ«2: ä¸‹é™é–¾å€¤ãƒã‚§ãƒƒã‚¯
            elif value < self.rules.get('lower_limit', float('-inf')):
                anomaly_flags[i] = True
                anomaly_types[i] = 'ä¸‹é™æœªæº€'
                self.anomalies.append({
                    'index': i,
                    'value': value,
                    'type': 'ä¸‹é™æœªæº€',
                    'severity': 'HIGH'
                })

            # ãƒ«ãƒ¼ãƒ«3: å¤‰åŒ–ç‡ãƒã‚§ãƒƒã‚¯ï¼ˆå‰ã‚µãƒ³ãƒ—ãƒ«ã¨ã®å·®ï¼‰
            if i > 0:
                rate_of_change = abs(value - data[i-1])
                if rate_of_change > self.rules.get('max_change_rate', float('inf')):
                    anomaly_flags[i] = True
                    anomaly_types[i] = 'æ€¥æ¿€ãªå¤‰åŒ–'
                    self.anomalies.append({
                        'index': i,
                        'value': value,
                        'type': 'æ€¥æ¿€ãªå¤‰åŒ–',
                        'severity': 'MEDIUM'
                    })

            # ãƒ«ãƒ¼ãƒ«4: é€£ç¶šé€¸è„±ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šç¯„å›²ï¼‰
            # å®Ÿè£…ã¯æ¬¡ã®ãƒ«ãƒ¼ãƒ—ã§å®Ÿè¡Œï¼ˆé€£ç¶šæ€§ã®åˆ¤å®šãŒå¿…è¦ï¼‰

        # ãƒ«ãƒ¼ãƒ«4ã®å®Ÿè£…: é€£ç¶š5ã‚µãƒ³ãƒ—ãƒ«ãŒè­¦å‘Šç¯„å›²ã‚’è¶…ãˆã‚‹
        warning_upper = self.rules.get('warning_upper', float('inf'))
        warning_lower = self.rules.get('warning_lower', float('-inf'))

        consecutive_warning = 0
        for i, value in enumerate(data):
            if value > warning_upper or value < warning_lower:
                consecutive_warning += 1
                if consecutive_warning >= 5 and not anomaly_flags[i]:
                    anomaly_flags[i] = True
                    anomaly_types[i] = 'é€£ç¶šè­¦å‘Š'
                    self.anomalies.append({
                        'index': i,
                        'value': value,
                        'type': 'é€£ç¶šè­¦å‘Š',
                        'severity': 'MEDIUM'
                    })
            else:
                consecutive_warning = 0

        return anomaly_flags, anomaly_types

# ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥å™¨ã®è¨­å®š
rules = {
    'upper_limit': 180,        # ä¸Šé™é–¾å€¤
    'lower_limit': 170,        # ä¸‹é™é–¾å€¤
    'warning_upper': 178,      # è­¦å‘Šä¸Šé™
    'warning_lower': 172,      # è­¦å‘Šä¸‹é™
    'max_change_rate': 8       # æœ€å¤§å¤‰åŒ–ç‡ï¼ˆÂ°C/åˆ†ï¼‰
}

detector = RuleBasedAnomalyDetector(rules)
anomaly_flags, anomaly_types = detector.detect(df['temperature'].values)

# å¯è¦–åŒ–
fig, ax = plt.subplots(figsize=(16, 6))

# æ­£å¸¸ãƒ‡ãƒ¼ã‚¿
normal_mask = ~anomaly_flags
ax.plot(df.index[normal_mask], df['temperature'][normal_mask],
        'o', color='#11998e', markersize=4, alpha=0.6, label='æ­£å¸¸')

# ç•°å¸¸ãƒ‡ãƒ¼ã‚¿
anomaly_mask = anomaly_flags
ax.scatter(df.index[anomaly_mask], df['temperature'][anomaly_mask],
          color='red', s=80, marker='o', zorder=5, label='ç•°å¸¸')

# é–¾å€¤ç·š
ax.axhline(y=rules['upper_limit'], color='red', linestyle='--',
          linewidth=2, label=f'ä¸Šé™é–¾å€¤ ({rules["upper_limit"]}Â°C)')
ax.axhline(y=rules['lower_limit'], color='red', linestyle='--',
          linewidth=2, label=f'ä¸‹é™é–¾å€¤ ({rules["lower_limit"]}Â°C)')
ax.axhline(y=rules['warning_upper'], color='orange', linestyle=':',
          linewidth=1.5, alpha=0.7, label='è­¦å‘Šç¯„å›²')
ax.axhline(y=rules['warning_lower'], color='orange', linestyle=':',
          linewidth=1.5, alpha=0.7)

# ç›®æ¨™å€¤
target = 175
ax.axhline(y=target, color='blue', linestyle='-', linewidth=2,
          label=f'ç›®æ¨™å€¤ ({target}Â°C)')

ax.set_xlabel('æ™‚åˆ»', fontsize=12)
ax.set_ylabel('æ¸©åº¦ (Â°C)', fontsize=12)
ax.set_title('ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥', fontsize=14, fontweight='bold')
ax.legend(loc='upper left')
ax.grid(alpha=0.3)

plt.tight_layout()
plt.show()

# ç•°å¸¸æ¤œçŸ¥çµæœã®ã‚µãƒãƒªãƒ¼
print("=== ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥ çµæœ ===")
print(f"\nç·ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆæ•°: {len(df)}")
print(f"ç•°å¸¸æ¤œå‡ºæ•°: {anomaly_flags.sum()} ({anomaly_flags.sum()/len(df)*100:.1f}%)")

# ç•°å¸¸ã‚¿ã‚¤ãƒ—åˆ¥ã®é›†è¨ˆ
df_anomalies = pd.DataFrame(detector.anomalies)
if len(df_anomalies) > 0:
    print(f"\nã€ç•°å¸¸ã‚¿ã‚¤ãƒ—åˆ¥é›†è¨ˆã€‘")
    type_counts = df_anomalies['type'].value_counts()
    for anomaly_type, count in type_counts.items():
        print(f"  {anomaly_type}: {count}ä»¶")

    print(f"\nã€é‡è¦åº¦åˆ¥é›†è¨ˆã€‘")
    severity_counts = df_anomalies['severity'].value_counts()
    for severity, count in severity_counts.items():
        print(f"  {severity}: {count}ä»¶")

    # æœ€åˆã®5ä»¶ã®ç•°å¸¸ã‚’è¡¨ç¤º
    print(f"\nã€æ¤œå‡ºã•ã‚ŒãŸç•°å¸¸ï¼ˆæœ€åˆã®5ä»¶ï¼‰ã€‘")
    for i, anomaly in enumerate(df_anomalies.head(5).to_dict('records')):
        print(f"{i+1}. ã‚µãƒ³ãƒ—ãƒ« {anomaly['index']+1} | "
              f"å€¤: {anomaly['value']:.2f}Â°C | "
              f"ã‚¿ã‚¤ãƒ—: {anomaly['type']} | "
              f"é‡è¦åº¦: {anomaly['severity']}")
</code></pre>

<p><strong>è§£èª¬</strong>: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç•°å¸¸æ¤œçŸ¥ã¯ã€æ˜ç¢ºãªé–¾å€¤ã‚„å¤‰åŒ–ç‡ã«åŸºã¥ã„ã¦ç•°å¸¸ã‚’åˆ¤å®šã™ã‚‹æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ‰‹æ³•ã§ã™ã€‚å®Ÿè£…ãŒå®¹æ˜“ã§è§£é‡ˆæ€§ãŒé«˜ã„åé¢ã€è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„æ–‡è„ˆä¾å­˜ã®ç•°å¸¸ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ãŒå›°é›£ã§ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ç”£æ¥­ã§ã¯ã€å®‰å…¨ä¸Šé‡è¦ãªå¤‰æ•°ï¼ˆæ¸©åº¦ã€åœ§åŠ›ï¼‰ã®ä¸€æ¬¡ç›£è¦–ã¨ã—ã¦åºƒãä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
</div>

<div class="code-example">
<h4>ã‚³ãƒ¼ãƒ‰ä¾‹2: çµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥ï¼ˆZ-scoreã¨ä¿®æ­£Z-scoreï¼‰</h4>

<p><strong>ç›®çš„</strong>: Z-scoreãŠã‚ˆã³ä¿®æ­£Z-scoreï¼ˆMedian Absolute Deviationï¼‰ã‚’ç”¨ã„ãŸçµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥ã‚’å®Ÿè£…ã™ã‚‹ã€‚</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy import stats

np.random.seed(42)

# ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
n_samples = 300
data = np.random.normal(100, 5, n_samples)

# å¤–ã‚Œå€¤ã‚’è¿½åŠ 
outlier_indices = [50, 100, 150, 200, 250]
data[outlier_indices] = [130, 70, 125, 65, 135]

def z_score_detection(data, threshold=3):
    """
    Z-scoreã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥

    Parameters:
    -----------
    data : array-like
        å…¥åŠ›ãƒ‡ãƒ¼ã‚¿
    threshold : float
        ç•°å¸¸åˆ¤å®šã®é–¾å€¤ï¼ˆæ¨™æº–åå·®ã®å€æ•°ï¼‰

    Returns:
    --------
    anomalies : boolean array
        ç•°å¸¸ãƒ•ãƒ©ã‚°
    z_scores : array
        Z-scoreå€¤
    """
    mean = np.mean(data)
    std = np.std(data, ddof=1)
    z_scores = np.abs((data - mean) / std)
    anomalies = z_scores > threshold

    return anomalies, z_scores

def modified_z_score_detection(data, threshold=3.5):
    """
    ä¿®æ­£Z-scoreï¼ˆMADãƒ™ãƒ¼ã‚¹ï¼‰ã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥
    å¤–ã‚Œå€¤ã«é ‘å¥ãªæ‰‹æ³•

    Parameters:
    -----------
    data : array-like
        å…¥åŠ›ãƒ‡ãƒ¼ã‚¿
    threshold : float
        ç•°å¸¸åˆ¤å®šã®é–¾å€¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3.5ï¼‰

    Returns:
    --------
    anomalies : boolean array
        ç•°å¸¸ãƒ•ãƒ©ã‚°
    modified_z_scores : array
        ä¿®æ­£Z-scoreå€¤
    """
    median = np.median(data)

    # MADï¼ˆMedian Absolute Deviationï¼‰ã®è¨ˆç®—
    mad = np.median(np.abs(data - median))

    # ä¿®æ­£Z-scoreã®è¨ˆç®—
    # å®šæ•°0.6745ã¯MADã‚’æ¨™æº–åå·®ã«å¤‰æ›ã™ã‚‹ãŸã‚ã®ä¿‚æ•°
    modified_z_scores = 0.6745 * (data - median) / mad

    anomalies = np.abs(modified_z_scores) > threshold

    return anomalies, modified_z_scores

# Z-scoreæ³•ã«ã‚ˆã‚‹æ¤œå‡º
anomalies_z, z_scores = z_score_detection(data, threshold=3)

# ä¿®æ­£Z-scoreæ³•ã«ã‚ˆã‚‹æ¤œå‡º
anomalies_modified, modified_z_scores = modified_z_score_detection(data, threshold=3.5)

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 1, figsize=(16, 12))

# å…ƒãƒ‡ãƒ¼ã‚¿ã¨ç•°å¸¸æ¤œå‡ºçµæœï¼ˆZ-scoreæ³•ï¼‰
axes[0].plot(range(n_samples), data, 'o', color='lightgray',
            markersize=4, alpha=0.5, label='å…¨ãƒ‡ãƒ¼ã‚¿')
axes[0].scatter(np.where(anomalies_z)[0], data[anomalies_z],
               color='red', s=100, marker='o', zorder=5, label='ç•°å¸¸ï¼ˆZ-scoreæ³•ï¼‰')
axes[0].axhline(y=np.mean(data), color='blue', linestyle='-', linewidth=2,
               label=f'å¹³å‡ = {np.mean(data):.2f}')
axes[0].axhline(y=np.mean(data) + 3*np.std(data), color='orange',
               linestyle='--', linewidth=2, label='Â±3Ïƒ')
axes[0].axhline(y=np.mean(data) - 3*np.std(data), color='orange',
               linestyle='--', linewidth=2)
axes[0].set_ylabel('ãƒ‡ãƒ¼ã‚¿å€¤', fontsize=11)
axes[0].set_title('Z-scoreæ³•ã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥', fontsize=13, fontweight='bold')
axes[0].legend()
axes[0].grid(alpha=0.3)

# Z-scoreã®å¯è¦–åŒ–
axes[1].plot(range(n_samples), z_scores, 'o-', color='#11998e',
            markersize=4, linewidth=1, alpha=0.7, label='Z-score')
axes[1].axhline(y=3, color='red', linestyle='--', linewidth=2,
               label='é–¾å€¤ = 3')
axes[1].scatter(np.where(anomalies_z)[0], z_scores[anomalies_z],
               color='red', s=100, marker='o', zorder=5)
axes[1].set_ylabel('Z-score', fontsize=11)
axes[1].set_title('Z-scoreã®åˆ†å¸ƒ', fontsize=13, fontweight='bold')
axes[1].legend()
axes[1].grid(alpha=0.3)

# ä¿®æ­£Z-scoreã®å¯è¦–åŒ–
axes[2].plot(range(n_samples), np.abs(modified_z_scores), 'o-', color='#7b2cbf',
            markersize=4, linewidth=1, alpha=0.7, label='ä¿®æ­£Z-score')
axes[2].axhline(y=3.5, color='red', linestyle='--', linewidth=2,
               label='é–¾å€¤ = 3.5')
axes[2].scatter(np.where(anomalies_modified)[0],
               np.abs(modified_z_scores[anomalies_modified]),
               color='red', s=100, marker='o', zorder=5)
axes[2].set_xlabel('ã‚µãƒ³ãƒ—ãƒ«ç•ªå·', fontsize=11)
axes[2].set_ylabel('ä¿®æ­£Z-scoreï¼ˆçµ¶å¯¾å€¤ï¼‰', fontsize=11)
axes[2].set_title('ä¿®æ­£Z-scoreã®åˆ†å¸ƒï¼ˆMADãƒ™ãƒ¼ã‚¹ï¼‰', fontsize=13, fontweight='bold')
axes[2].legend()
axes[2].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# çµ±è¨ˆã‚µãƒãƒªãƒ¼
print("=== çµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥ çµæœ ===")
print(f"\nãƒ‡ãƒ¼ã‚¿çµ±è¨ˆ:")
print(f"  å¹³å‡: {np.mean(data):.2f}")
print(f"  ä¸­å¤®å€¤: {np.median(data):.2f}")
print(f"  æ¨™æº–åå·®: {np.std(data, ddof=1):.2f}")
print(f"  MAD: {np.median(np.abs(data - np.median(data))):.2f}")

print(f"\nã€Z-scoreæ³•ã€‘")
print(f"  æ¤œå‡ºã•ã‚ŒãŸç•°å¸¸æ•°: {anomalies_z.sum()} ({anomalies_z.sum()/n_samples*100:.1f}%)")
if anomalies_z.any():
    print(f"  ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«: {np.where(anomalies_z)[0] + 1}")
    print(f"  ç•°å¸¸å€¤: {data[anomalies_z]}")

print(f"\nã€ä¿®æ­£Z-scoreæ³•ï¼ˆMADãƒ™ãƒ¼ã‚¹ï¼‰ã€‘")
print(f"  æ¤œå‡ºã•ã‚ŒãŸç•°å¸¸æ•°: {anomalies_modified.sum()} "
      f"({anomalies_modified.sum()/n_samples*100:.1f}%)")
if anomalies_modified.any():
    print(f"  ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«: {np.where(anomalies_modified)[0] + 1}")
    print(f"  ç•°å¸¸å€¤: {data[anomalies_modified]}")

# æ‰‹æ³•ã®æ¯”è¼ƒ
print(f"\nã€æ‰‹æ³•æ¯”è¼ƒã€‘")
print(f"  ä¸¡æ‰‹æ³•ã§æ¤œå‡º: {np.sum(anomalies_z & anomalies_modified)}ä»¶")
print(f"  Z-scoreã®ã¿æ¤œå‡º: {np.sum(anomalies_z & ~anomalies_modified)}ä»¶")
print(f"  ä¿®æ­£Z-scoreã®ã¿æ¤œå‡º: {np.sum(~anomalies_z & anomalies_modified)}ä»¶")

print(f"\nã€æ¨å¥¨ã€‘")
print("  - Z-scoreæ³•: ãƒ‡ãƒ¼ã‚¿ãŒæ­£è¦åˆ†å¸ƒã«å¾“ã†å ´åˆã«æœ‰åŠ¹")
print("  - ä¿®æ­£Z-scoreæ³•: å¤–ã‚Œå€¤ãŒå¤šã„å ´åˆã«é ‘å¥ï¼ˆMADã¯å¤–ã‚Œå€¤ã®å½±éŸ¿ã‚’å—ã‘ã«ãã„ï¼‰")
</code></pre>

<p><strong>è§£èª¬</strong>: Z-scoreæ³•ã¯ã€ãƒ‡ãƒ¼ã‚¿ãŒæ­£è¦åˆ†å¸ƒã«å¾“ã†ã¨ä»®å®šã—ã¦ã€å¹³å‡ã‹ã‚‰ä½•æ¨™æº–åå·®é›¢ã‚Œã¦ã„ã‚‹ã‹ã‚’è¨ˆç®—ã—ã¾ã™ã€‚ä¿®æ­£Z-scoreæ³•ã¯ã€å¹³å‡ã®ä»£ã‚ã‚Šã«ä¸­å¤®å€¤ã€æ¨™æº–åå·®ã®ä»£ã‚ã‚Šã«MADï¼ˆMedian Absolute Deviationï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€å¤–ã‚Œå€¤ã®å½±éŸ¿ã‚’å—ã‘ã«ãã„é ‘å¥ãªæ‰‹æ³•ã§ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã«å¤–ã‚Œå€¤ãŒå«ã¾ã‚Œã‚‹å ´åˆã¯ã€ä¿®æ­£Z-scoreæ³•ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚</p>
</div>

<div class="code-example">
<h4>ã‚³ãƒ¼ãƒ‰ä¾‹3: Isolation Forestï¼ˆå­¤ç«‹æ£®æ—æ³•ï¼‰ã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥</h4>

<p><strong>ç›®çš„</strong>: æ©Ÿæ¢°å­¦ç¿’ãƒ™ãƒ¼ã‚¹ã®ç•°å¸¸æ¤œçŸ¥æ‰‹æ³•ã§ã‚ã‚‹Isolation Forestã‚’å®Ÿè£…ã™ã‚‹ã€‚</p>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from sklearn.ensemble import IsolationForest
from sklearn.preprocessing import StandardScaler

np.random.seed(42)

# 2å¤‰é‡ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆæ¸©åº¦ã¨åœ§åŠ›ï¼‰
n_normal = 300
n_anomalies = 20

# æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ï¼ˆç›¸é–¢ã®ã‚ã‚‹2å¤‰æ•°ï¼‰
mean_normal = [100, 50]
cov_normal = [[25, 10], [10, 16]]
normal_data = np.random.multivariate_normal(mean_normal, cov_normal, n_normal)

# ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ï¼ˆæ­£å¸¸ç¯„å›²ã‹ã‚‰å¤–ã‚ŒãŸç‚¹ï¼‰
anomaly_data = np.array([
    np.random.uniform(85, 95, n_anomalies),  # ä½æ¸©
    np.random.uniform(60, 70, n_anomalies)   # é«˜åœ§
]).T

# ãƒ‡ãƒ¼ã‚¿ã®çµåˆ
X = np.vstack([normal_data, anomaly_data])
labels_true = np.hstack([np.zeros(n_normal), np.ones(n_anomalies)])

# ãƒ‡ãƒ¼ã‚¿ã®æ¨™æº–åŒ–
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# Isolation Forestãƒ¢ãƒ‡ãƒ«ã®è¨“ç·´
clf = IsolationForest(
    contamination=0.1,     # ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã®å‰²åˆï¼ˆ10%ã¨ä»®å®šï¼‰
    random_state=42,
    n_estimators=100       # æ±ºå®šæœ¨ã®æ•°
)

# ç•°å¸¸ã‚¹ã‚³ã‚¢ã®è¨ˆç®—
y_pred = clf.fit_predict(X_scaled)  # -1: ç•°å¸¸, 1: æ­£å¸¸
anomaly_scores = clf.score_samples(X_scaled)  # ç•°å¸¸ã‚¹ã‚³ã‚¢ï¼ˆä½ã„ã»ã©ç•°å¸¸ï¼‰

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(16, 6))

# æ•£å¸ƒå›³ï¼ˆäºˆæ¸¬çµæœï¼‰
normal_pred = y_pred == 1
anomaly_pred = y_pred == -1

axes[0].scatter(X[normal_pred, 0], X[normal_pred, 1],
               c='#11998e', s=40, alpha=0.6, label='æ­£å¸¸ï¼ˆäºˆæ¸¬ï¼‰')
axes[0].scatter(X[anomaly_pred, 0], X[anomaly_pred, 1],
               c='red', s=80, marker='x', linewidths=2, label='ç•°å¸¸ï¼ˆäºˆæ¸¬ï¼‰')

# çœŸã®ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã‚’å¼·èª¿
axes[0].scatter(X[n_normal:, 0], X[n_normal:, 1],
               facecolors='none', edgecolors='orange', s=150,
               linewidths=2, label='çœŸã®ç•°å¸¸')

axes[0].set_xlabel('æ¸©åº¦ (Â°C)', fontsize=12)
axes[0].set_ylabel('åœ§åŠ› (kPa)', fontsize=12)
axes[0].set_title('Isolation Forest - ç•°å¸¸æ¤œçŸ¥çµæœ', fontsize=14, fontweight='bold')
axes[0].legend()
axes[0].grid(alpha=0.3)

# ç•°å¸¸ã‚¹ã‚³ã‚¢ã®åˆ†å¸ƒ
axes[1].hist(anomaly_scores[labels_true == 0], bins=30, alpha=0.6,
            color='#11998e', label='æ­£å¸¸ãƒ‡ãƒ¼ã‚¿', density=True)
axes[1].hist(anomaly_scores[labels_true == 1], bins=30, alpha=0.6,
            color='red', label='ç•°å¸¸ãƒ‡ãƒ¼ã‚¿', density=True)
axes[1].axvline(x=np.percentile(anomaly_scores, 10), color='orange',
               linestyle='--', linewidth=2, label='æ±ºå®šå¢ƒç•Œï¼ˆ10ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ï¼‰')
axes[1].set_xlabel('ç•°å¸¸ã‚¹ã‚³ã‚¢', fontsize=12)
axes[1].set_ylabel('ç¢ºç‡å¯†åº¦', fontsize=12)
axes[1].set_title('ç•°å¸¸ã‚¹ã‚³ã‚¢ã®åˆ†å¸ƒ', fontsize=14, fontweight='bold')
axes[1].legend()
axes[1].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# æ€§èƒ½è©•ä¾¡
from sklearn.metrics import confusion_matrix, classification_report, roc_auc_score

# äºˆæ¸¬ãƒ©ãƒ™ãƒ«ã‚’0/1ã«å¤‰æ›
y_pred_binary = (y_pred == -1).astype(int)

# æ··åŒè¡Œåˆ—
cm = confusion_matrix(labels_true, y_pred_binary)

print("=== Isolation Forest ç•°å¸¸æ¤œçŸ¥çµæœ ===")
print(f"\nãƒ‡ãƒ¼ã‚¿æ§‹æˆ:")
print(f"  æ­£å¸¸ãƒ‡ãƒ¼ã‚¿: {n_normal}ã‚µãƒ³ãƒ—ãƒ«")
print(f"  ç•°å¸¸ãƒ‡ãƒ¼ã‚¿: {n_anomalies}ã‚µãƒ³ãƒ—ãƒ«")
print(f"  æ±šæŸ“ç‡ï¼ˆcontaminationï¼‰: {clf.contamination}")

print(f"\næ··åŒè¡Œåˆ—:")
print(f"                äºˆæ¸¬")
print(f"              æ­£å¸¸  ç•°å¸¸")
print(f"å®Ÿéš›  æ­£å¸¸    {cm[0,0]:3d}   {cm[0,1]:3d}")
print(f"      ç•°å¸¸    {cm[1,0]:3d}   {cm[1,1]:3d}")

# è©•ä¾¡æŒ‡æ¨™
TP = cm[1, 1]  # True Positive
TN = cm[0, 0]  # True Negative
FP = cm[0, 1]  # False Positive
FN = cm[1, 0]  # False Negative

precision = TP / (TP + FP) if (TP + FP) > 0 else 0
recall = TP / (TP + FN) if (TP + FN) > 0 else 0
f1_score = 2 * precision * recall / (precision + recall) if (precision + recall) > 0 else 0
accuracy = (TP + TN) / (TP + TN + FP + FN)

print(f"\næ€§èƒ½æŒ‡æ¨™:")
print(f"  ç²¾åº¦ï¼ˆPrecisionï¼‰: {precision:.3f}")
print(f"  å†ç¾ç‡ï¼ˆRecallï¼‰: {recall:.3f}")
print(f"  F1ã‚¹ã‚³ã‚¢: {f1_score:.3f}")
print(f"  æ­£è§£ç‡ï¼ˆAccuracyï¼‰: {accuracy:.3f}")

# AUC-ROC
try:
    auc_roc = roc_auc_score(labels_true, -anomaly_scores)  # ã‚¹ã‚³ã‚¢ãŒä½ã„ã»ã©ç•°å¸¸ãªã®ã§ç¬¦å·åè»¢
    print(f"  AUC-ROC: {auc_roc:.3f}")
except:
    print("  AUC-ROC: è¨ˆç®—ã§ãã¾ã›ã‚“")

print(f"\nç•°å¸¸ã‚¹ã‚³ã‚¢çµ±è¨ˆ:")
print(f"  æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã®å¹³å‡ã‚¹ã‚³ã‚¢: {np.mean(anomaly_scores[labels_true == 0]):.4f}")
print(f"  ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã®å¹³å‡ã‚¹ã‚³ã‚¢: {np.mean(anomaly_scores[labels_true == 1]):.4f}")
</code></pre>

<p><strong>è§£èª¬</strong>: Isolation Forestã¯ã€ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã¯æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã‚ˆã‚Šã‚‚ã€Œå­¤ç«‹ã—ã‚„ã™ã„ã€ã¨ã„ã†åŸç†ã«åŸºã¥ãæ•™å¸«ãªã—å­¦ç¿’æ‰‹æ³•ã§ã™ã€‚ãƒ©ãƒ³ãƒ€ãƒ ã«ç‰¹å¾´ã¨åˆ†å‰²ç‚¹ã‚’é¸ã³ã€ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„åˆ†å‰²ã§å­¤ç«‹ã™ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚å¤šå¤‰é‡ãƒ‡ãƒ¼ã‚¿ã®ç•°å¸¸æ¤œçŸ¥ã«é©ã—ã¦ãŠã‚Šã€è¨ˆç®—ã‚³ã‚¹ãƒˆãŒä½ãã€é«˜æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã«ã‚‚å¯¾å¿œã§ãã‚‹åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ç”£æ¥­ã§ã¯ã€è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹å¤‰æ•°ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹ç•°å¸¸ã‚’æ¤œå‡ºã™ã‚‹éš›ã«æœ‰åŠ¹ã§ã™ã€‚</p>
</div>

<div class="code-example">
<h4>ã‚³ãƒ¼ãƒ‰ä¾‹4: One-Class SVMï¼ˆæ­£å¸¸é‹è»¢ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ï¼‰</h4>

<p><strong>ç›®çš„</strong>: æ­£å¸¸é‹è»¢ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‹ã‚‰å­¦ç¿’ã—ã€ç•°å¸¸ã‚’æ¤œå‡ºã™ã‚‹One-Class SVMã‚’å®Ÿè£…ã™ã‚‹ã€‚</p>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from sklearn.svm import OneClassSVM
from sklearn.preprocessing import StandardScaler

np.random.seed(42)

# æ­£å¸¸é‹è»¢ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆï¼ˆè¨“ç·´ãƒ‡ãƒ¼ã‚¿ï¼‰
n_train = 200
train_data = np.random.multivariate_normal(
    mean=[100, 50],
    cov=[[20, 8], [8, 15]],
    size=n_train
)

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆï¼ˆæ­£å¸¸ + ç•°å¸¸ï¼‰
n_test_normal = 100
n_test_anomaly = 30

test_normal = np.random.multivariate_normal(
    mean=[100, 50],
    cov=[[20, 8], [8, 15]],
    size=n_test_normal
)

# ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ï¼ˆè¤‡æ•°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
test_anomaly_1 = np.random.multivariate_normal(
    mean=[85, 60], cov=[[10, 0], [0, 10]], size=n_test_anomaly//3
)
test_anomaly_2 = np.random.multivariate_normal(
    mean=[115, 45], cov=[[10, 0], [0, 10]], size=n_test_anomaly//3
)
test_anomaly_3 = np.random.uniform(
    low=[80, 35], high=[120, 65], size=(n_test_anomaly//3, 2)
)

test_data = np.vstack([test_normal, test_anomaly_1, test_anomaly_2, test_anomaly_3])
test_labels = np.hstack([
    np.zeros(n_test_normal),
    np.ones(n_test_anomaly)
])

# ãƒ‡ãƒ¼ã‚¿ã®æ¨™æº–åŒ–
scaler = StandardScaler()
train_scaled = scaler.fit_transform(train_data)
test_scaled = scaler.transform(test_data)

# One-Class SVMãƒ¢ãƒ‡ãƒ«ã®è¨“ç·´
oc_svm = OneClassSVM(
    kernel='rbf',      # RBFã‚«ãƒ¼ãƒãƒ«ï¼ˆæ”¾å°„åŸºåº•é–¢æ•°ï¼‰
    gamma='auto',      # ã‚«ãƒ¼ãƒãƒ«ä¿‚æ•°
    nu=0.05            # ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã®ä¸Šé™å‰²åˆï¼ˆ5%ï¼‰
)

oc_svm.fit(train_scaled)

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§ã®äºˆæ¸¬
y_pred = oc_svm.predict(test_scaled)  # 1: æ­£å¸¸, -1: ç•°å¸¸
decision_scores = oc_svm.decision_function(test_scaled)  # æ±ºå®šé–¢æ•°ã®å€¤

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(16, 6))

# è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã¨æ±ºå®šå¢ƒç•Œ
xx, yy = np.meshgrid(
    np.linspace(scaler.inverse_transform(train_scaled)[:, 0].min() - 10,
                scaler.inverse_transform(train_scaled)[:, 0].max() + 10, 100),
    np.linspace(scaler.inverse_transform(train_scaled)[:, 1].min() - 10,
                scaler.inverse_transform(train_scaled)[:, 1].max() + 10, 100)
)
grid_scaled = scaler.transform(np.c_[xx.ravel(), yy.ravel()])
Z = oc_svm.decision_function(grid_scaled)
Z = Z.reshape(xx.shape)

# æ±ºå®šå¢ƒç•Œã®ãƒ—ãƒ­ãƒƒãƒˆ
axes[0].contour(xx, yy, Z, levels=[0], linewidths=2, colors='orange',
               linestyles='--', label='æ±ºå®šå¢ƒç•Œ')
axes[0].contourf(xx, yy, Z, levels=np.linspace(Z.min(), 0, 7),
                cmap='Reds', alpha=0.3)

# è¨“ç·´ãƒ‡ãƒ¼ã‚¿
axes[0].scatter(train_data[:, 0], train_data[:, 1],
               c='#11998e', s=30, alpha=0.6, label='è¨“ç·´ãƒ‡ãƒ¼ã‚¿ï¼ˆæ­£å¸¸ï¼‰')

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
test_normal_pred = (y_pred == 1)
test_anomaly_pred = (y_pred == -1)

axes[0].scatter(test_data[test_normal_pred, 0], test_data[test_normal_pred, 1],
               c='green', s=40, alpha=0.6, marker='o', label='æ­£å¸¸ï¼ˆäºˆæ¸¬ï¼‰')
axes[0].scatter(test_data[test_anomaly_pred, 0], test_data[test_anomaly_pred, 1],
               c='red', s=60, alpha=0.8, marker='x', linewidths=2, label='ç•°å¸¸ï¼ˆäºˆæ¸¬ï¼‰')

axes[0].set_xlabel('æ¸©åº¦ (Â°C)', fontsize=12)
axes[0].set_ylabel('åœ§åŠ› (kPa)', fontsize=12)
axes[0].set_title('One-Class SVM - æ±ºå®šå¢ƒç•Œã¨ç•°å¸¸æ¤œçŸ¥',
                  fontsize=14, fontweight='bold')
axes[0].legend()
axes[0].grid(alpha=0.3)

# æ±ºå®šé–¢æ•°ã‚¹ã‚³ã‚¢ã®åˆ†å¸ƒ
axes[1].hist(decision_scores[test_labels == 0], bins=30, alpha=0.6,
            color='#11998e', label='æ­£å¸¸ãƒ‡ãƒ¼ã‚¿', density=True)
axes[1].hist(decision_scores[test_labels == 1], bins=30, alpha=0.6,
            color='red', label='ç•°å¸¸ãƒ‡ãƒ¼ã‚¿', density=True)
axes[1].axvline(x=0, color='orange', linestyle='--', linewidth=2,
               label='æ±ºå®šå¢ƒç•Œ')
axes[1].set_xlabel('æ±ºå®šé–¢æ•°ã‚¹ã‚³ã‚¢', fontsize=12)
axes[1].set_ylabel('ç¢ºç‡å¯†åº¦', fontsize=12)
axes[1].set_title('æ±ºå®šé–¢æ•°ã‚¹ã‚³ã‚¢ã®åˆ†å¸ƒ', fontsize=14, fontweight='bold')
axes[1].legend()
axes[1].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# æ€§èƒ½è©•ä¾¡
from sklearn.metrics import confusion_matrix, classification_report

# äºˆæ¸¬ãƒ©ãƒ™ãƒ«ã‚’0/1ã«å¤‰æ›
y_pred_binary = (y_pred == -1).astype(int)

cm = confusion_matrix(test_labels, y_pred_binary)

print("=== One-Class SVM ç•°å¸¸æ¤œçŸ¥çµæœ ===")
print(f"\nè¨“ç·´ãƒ‡ãƒ¼ã‚¿:")
print(f"  ã‚µãƒ³ãƒ—ãƒ«æ•°: {n_train}")
print(f"  ç‰¹å¾´: æ¸©åº¦ã€åœ§åŠ›ï¼ˆ2æ¬¡å…ƒï¼‰")

print(f"\nãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿:")
print(f"  æ­£å¸¸: {n_test_normal}ã‚µãƒ³ãƒ—ãƒ«")
print(f"  ç•°å¸¸: {n_test_anomaly}ã‚µãƒ³ãƒ—ãƒ«")

print(f"\nãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:")
print(f"  ã‚«ãƒ¼ãƒãƒ«: {oc_svm.kernel}")
print(f"  nuï¼ˆç•°å¸¸ç‡ä¸Šé™ï¼‰: {oc_svm.nu}")

print(f"\næ··åŒè¡Œåˆ—:")
print(f"                äºˆæ¸¬")
print(f"              æ­£å¸¸  ç•°å¸¸")
print(f"å®Ÿéš›  æ­£å¸¸    {cm[0,0]:3d}   {cm[0,1]:3d}")
print(f"      ç•°å¸¸    {cm[1,0]:3d}   {cm[1,1]:3d}")

# è©•ä¾¡æŒ‡æ¨™
TP = cm[1, 1]
TN = cm[0, 0]
FP = cm[0, 1]
FN = cm[1, 0]

precision = TP / (TP + FP) if (TP + FP) > 0 else 0
recall = TP / (TP + FN) if (TP + FN) > 0 else 0
f1_score = 2 * precision * recall / (precision + recall) if (precision + recall) > 0 else 0
accuracy = (TP + TN) / len(test_labels)

print(f"\næ€§èƒ½æŒ‡æ¨™:")
print(f"  ç²¾åº¦ï¼ˆPrecisionï¼‰: {precision:.3f}")
print(f"  å†ç¾ç‡ï¼ˆRecallï¼‰: {recall:.3f}")
print(f"  F1ã‚¹ã‚³ã‚¢: {f1_score:.3f}")
print(f"  æ­£è§£ç‡ï¼ˆAccuracyï¼‰: {accuracy:.3f}")

print(f"\næ±ºå®šé–¢æ•°ã‚¹ã‚³ã‚¢çµ±è¨ˆ:")
print(f"  æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã®å¹³å‡ã‚¹ã‚³ã‚¢: {np.mean(decision_scores[test_labels == 0]):.4f}")
print(f"  ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã®å¹³å‡ã‚¹ã‚³ã‚¢: {np.mean(decision_scores[test_labels == 1]):.4f}")

print(f"\nã€ç‰¹å¾´ã€‘")
print("  - æ­£å¸¸é‹è»¢ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§å­¦ç¿’å¯èƒ½ï¼ˆæ•™å¸«ãªã—å­¦ç¿’ï¼‰")
print("  - éç·šå½¢ãªæ±ºå®šå¢ƒç•Œã‚’å­¦ç¿’å¯èƒ½ï¼ˆRBFã‚«ãƒ¼ãƒãƒ«ï¼‰")
print("  - nuãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç•°å¸¸ç‡ã‚’èª¿æ•´å¯èƒ½")
</code></pre>

<p><strong>è§£èª¬</strong>: One-Class SVMã¯ã€æ­£å¸¸é‹è»¢ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‹ã‚‰æ­£å¸¸é ˜åŸŸã®å¢ƒç•Œã‚’å­¦ç¿’ã™ã‚‹æ•™å¸«ãªã—å­¦ç¿’æ‰‹æ³•ã§ã™ã€‚RBFã‚«ãƒ¼ãƒãƒ«ã«ã‚ˆã‚Šéç·šå½¢ãªæ±ºå®šå¢ƒç•Œã‚’å­¦ç¿’ã§ãã€è¤‡é›‘ãªæ­£å¸¸é ˜åŸŸã‚’è¡¨ç¾ã§ãã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ç”£æ¥­ã§ã¯ã€æ­£å¸¸é‹è»¢ãƒ‡ãƒ¼ã‚¿ã¯è±Šå¯Œã ãŒç•°å¸¸ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„å ´åˆã«æœ‰åŠ¹ã§ã™ã€‚nuãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç•°å¸¸ç‡ã®ä¸Šé™ã‚’è¨­å®šã§ãã€èª¤å ±ç‡ã®èª¿æ•´ãŒå¯èƒ½ã§ã™ã€‚</p>
</div>

<div class="code-example">
<h4>ã‚³ãƒ¼ãƒ‰ä¾‹5: LSTM Autoencoderã«ã‚ˆã‚‹æ™‚ç³»åˆ—ç•°å¸¸æ¤œçŸ¥</h4>

<p><strong>ç›®çš„</strong>: ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆLSTM Autoencoderï¼‰ã‚’ç”¨ã„ãŸæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ç•°å¸¸æ¤œçŸ¥ã‚’å®Ÿè£…ã™ã‚‹ã€‚</p>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

np.random.seed(42)

# æ³¨: å®Ÿéš›ã®LSTM Autoencoderã®è¨“ç·´ã¯çœç•¥ã—ã€æ¦‚å¿µã‚’ç¤ºã™ã‚³ãƒ¼ãƒ‰ã‚’æä¾›ã—ã¾ã™
# TensorFlow/KerasãŒå¿…è¦ã§ã™ãŒã€ã“ã“ã§ã¯æ¦‚å¿µçš„ãªå®Ÿè£…ã‚’ç¤ºã—ã¾ã™

# æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
n_samples = 500
time = np.linspace(0, 100, n_samples)

# æ­£å¸¸ãªå‘¨æœŸçš„ãƒ‘ã‚¿ãƒ¼ãƒ³
normal_signal = 50 + 10 * np.sin(2 * np.pi * time / 20) + \
                5 * np.sin(2 * np.pi * time / 5) + \
                np.random.normal(0, 1, n_samples)

# ç•°å¸¸ã‚’æŒ¿å…¥
abnormal_signal = normal_signal.copy()
# ç•°å¸¸1: ã‚¹ãƒ‘ã‚¤ã‚¯ï¼ˆã‚µãƒ³ãƒ—ãƒ«150-160ï¼‰
abnormal_signal[150:161] += 20
# ç•°å¸¸2: ãƒ‰ãƒªãƒ•ãƒˆï¼ˆã‚µãƒ³ãƒ—ãƒ«300-400ï¼‰
abnormal_signal[300:401] += np.linspace(0, 15, 101)
# ç•°å¸¸3: å‘¨æœŸæ€§ã®æ¶ˆå¤±ï¼ˆã‚µãƒ³ãƒ—ãƒ«450-480ï¼‰
abnormal_signal[450:481] = np.random.normal(50, 5, 31)

# LSTM Autoencoderã®æ¦‚å¿µçš„ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
# å®Ÿéš›ã«ã¯ã€TensorFlow/Kerasã§å®Ÿè£…ã—ã¾ã™

def simulate_autoencoder_reconstruction(signal, window_size=50):
    """
    Autoencoderã«ã‚ˆã‚‹å†æ§‹æˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    ï¼ˆå®Ÿéš›ã«ã¯ã€LSTM Autoencoderã§å®Ÿè£…ï¼‰
    """
    reconstructed = np.zeros_like(signal)

    # ç§»å‹•å¹³å‡ã«ã‚ˆã‚‹æ“¬ä¼¼çš„ãªå†æ§‹æˆ
    for i in range(len(signal)):
        start = max(0, i - window_size // 2)
        end = min(len(signal), i + window_size // 2)
        reconstructed[i] = np.mean(signal[start:end])

    # ãƒã‚¤ã‚ºã‚’è¿½åŠ ã—ã¦ä¸å®Œå…¨ãªå†æ§‹æˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    reconstructed += np.random.normal(0, 0.5, len(signal))

    return reconstructed

# æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã§ã®å†æ§‹æˆï¼ˆè¨“ç·´ãƒ•ã‚§ãƒ¼ã‚ºã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
reconstructed = simulate_autoencoder_reconstruction(abnormal_signal)

# å†æ§‹æˆèª¤å·®ã®è¨ˆç®—
reconstruction_error = np.abs(abnormal_signal - reconstructed)

# ç•°å¸¸åˆ¤å®šé–¾å€¤ï¼ˆå†æ§‹æˆèª¤å·®ã®99ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ï¼‰
threshold = np.percentile(reconstruction_error[:200], 99)  # æ­£å¸¸éƒ¨åˆ†ã‹ã‚‰é–¾å€¤ã‚’æ¨å®š

# ç•°å¸¸æ¤œçŸ¥
anomalies = reconstruction_error > threshold

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 1, figsize=(16, 12))

# å…ƒä¿¡å·ã¨å†æ§‹æˆä¿¡å·
axes[0].plot(time, abnormal_signal, 'b-', linewidth=1, alpha=0.7,
            label='å…ƒä¿¡å·ï¼ˆç•°å¸¸ã‚’å«ã‚€ï¼‰')
axes[0].plot(time, reconstructed, 'r-', linewidth=1, alpha=0.7,
            label='å†æ§‹æˆä¿¡å·')
axes[0].set_ylabel('ä¿¡å·å€¤', fontsize=11)
axes[0].set_title('LSTM Autoencoder - å…ƒä¿¡å·ã¨å†æ§‹æˆä¿¡å·',
                  fontsize=13, fontweight='bold')
axes[0].legend()
axes[0].grid(alpha=0.3)

# å†æ§‹æˆèª¤å·®
axes[1].plot(time, reconstruction_error, 'g-', linewidth=1.5,
            label='å†æ§‹æˆèª¤å·®')
axes[1].axhline(y=threshold, color='red', linestyle='--', linewidth=2,
               label=f'é–¾å€¤ = {threshold:.2f}')
axes[1].fill_between(time, 0, threshold, alpha=0.2, color='green',
                     label='æ­£å¸¸ç¯„å›²')
axes[1].set_ylabel('å†æ§‹æˆèª¤å·®', fontsize=11)
axes[1].set_title('å†æ§‹æˆèª¤å·®ã®æ™‚ç³»åˆ—', fontsize=13, fontweight='bold')
axes[1].legend()
axes[1].grid(alpha=0.3)

# ç•°å¸¸æ¤œçŸ¥çµæœ
normal_mask = ~anomalies
anomaly_mask = anomalies

axes[2].plot(time[normal_mask], abnormal_signal[normal_mask],
            'o', color='#11998e', markersize=3, alpha=0.6, label='æ­£å¸¸')
axes[2].scatter(time[anomaly_mask], abnormal_signal[anomaly_mask],
               color='red', s=30, marker='o', zorder=5, label='ç•°å¸¸')
axes[2].set_xlabel('æ™‚é–“', fontsize=11)
axes[2].set_ylabel('ä¿¡å·å€¤', fontsize=11)
axes[2].set_title('ç•°å¸¸æ¤œçŸ¥çµæœ', fontsize=13, fontweight='bold')
axes[2].legend()
axes[2].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# çµæœã‚µãƒãƒªãƒ¼
print("=== LSTM Autoencoder æ™‚ç³»åˆ—ç•°å¸¸æ¤œçŸ¥ ===")
print(f"\nãƒ‡ãƒ¼ã‚¿:")
print(f"  ã‚µãƒ³ãƒ—ãƒ«æ•°: {n_samples}")
print(f"  æ™‚é–“ç¯„å›²: {time[0]:.1f} ï½ {time[-1]:.1f}")

print(f"\nAutoencoderè¨­å®šï¼ˆæ¦‚å¿µï¼‰:")
print("  - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€: LSTMå±¤ã§æ™‚ç³»åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åœ§ç¸®")
print("  - ãƒ‡ã‚³ãƒ¼ãƒ€: LSTMå±¤ã§å…ƒã®æ™‚ç³»åˆ—ã‚’å†æ§‹æˆ")
print("  - æå¤±é–¢æ•°: å¹³å‡äºŒä¹—èª¤å·®ï¼ˆMSEï¼‰")

print(f"\nå†æ§‹æˆèª¤å·®:")
print(f"  å¹³å‡èª¤å·®: {np.mean(reconstruction_error):.3f}")
print(f"  æ¨™æº–åå·®: {np.std(reconstruction_error):.3f}")
print(f"  æœ€å¤§èª¤å·®: {np.max(reconstruction_error):.3f}")
print(f"  é–¾å€¤ï¼ˆ99ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ï¼‰: {threshold:.3f}")

print(f"\nç•°å¸¸æ¤œçŸ¥çµæœ:")
print(f"  æ¤œå‡ºã•ã‚ŒãŸç•°å¸¸: {anomalies.sum()}ã‚µãƒ³ãƒ—ãƒ« "
      f"({anomalies.sum()/n_samples*100:.1f}%)")

# ç•°å¸¸åŒºé–“ã®ç‰¹å®š
anomaly_periods = []
in_anomaly = False
start_idx = 0

for i in range(len(anomalies)):
    if anomalies[i] and not in_anomaly:
        start_idx = i
        in_anomaly = True
    elif not anomalies[i] and in_anomaly:
        anomaly_periods.append((start_idx, i-1))
        in_anomaly = False

if in_anomaly:
    anomaly_periods.append((start_idx, len(anomalies)-1))

print(f"\næ¤œå‡ºã•ã‚ŒãŸç•°å¸¸æœŸé–“:")
for idx, (start, end) in enumerate(anomaly_periods[:5]):  # æœ€åˆã®5æœŸé–“
    duration = end - start + 1
    print(f"  {idx+1}. ã‚µãƒ³ãƒ—ãƒ« {start+1}ï½{end+1} ({duration}ã‚µãƒ³ãƒ—ãƒ«)")

print(f"\nã€LSTM Autoencoderã®åˆ©ç‚¹ã€‘")
print("  - æ™‚ç³»åˆ—ã®è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’å¯èƒ½")
print("  - æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§å­¦ç¿’å¯èƒ½ï¼ˆæ•™å¸«ãªã—å­¦ç¿’ï¼‰")
print("  - é•·æœŸä¾å­˜é–¢ä¿‚ã‚’è€ƒæ…®ã—ãŸç•°å¸¸æ¤œçŸ¥")
print("  - å¤šå¤‰é‡æ™‚ç³»åˆ—ã«ã‚‚æ‹¡å¼µå¯èƒ½")
</code></pre>

<p><strong>è§£èª¬</strong>: LSTM Autoencoderã¯ã€LSTMãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€-ãƒ‡ã‚³ãƒ¼ãƒ€æ§‹é€ ã‚’æ§‹ç¯‰ã—ã€æ­£å¸¸ãªæ™‚ç³»åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã—ã¾ã™ã€‚ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã¯æ­£å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ãšã‚Œã¦ã„ã‚‹ãŸã‚ã€å†æ§‹æˆèª¤å·®ãŒå¤§ãããªã‚Šã¾ã™ã€‚ã“ã®å†æ§‹æˆèª¤å·®ã‚’é–¾å€¤åˆ¤å®šã™ã‚‹ã“ã¨ã§ç•°å¸¸ã‚’æ¤œå‡ºã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ç”£æ¥­ã§ã¯ã€è¤‡é›‘ãªå‘¨æœŸæ€§ã‚„é•·æœŸä¾å­˜æ€§ã‚’æŒã¤æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ç•°å¸¸æ¤œçŸ¥ã«æœ‰åŠ¹ã§ã™ã€‚å®Ÿéš›ã®å®Ÿè£…ã«ã¯TensorFlow/Kerasã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>
</div>

<div class="code-example">
<h4>ã‚³ãƒ¼ãƒ‰ä¾‹6: ã‚¢ãƒ©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆ</h4>

<p><strong>ç›®çš„</strong>: å„ªå…ˆé †ä½ä»˜ã‘ã¨ãƒ‡ãƒã‚¦ãƒ³ã‚·ãƒ³ã‚°ã‚’å«ã‚€å®Ÿè·µçš„ãªã‚¢ãƒ©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆã™ã‚‹ã€‚</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
from datetime import datetime, timedelta
from collections import deque

class AlarmManager:
    """é«˜åº¦ãªã‚¢ãƒ©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, debounce_time=5, priority_rules=None):
        """
        Parameters:
        -----------
        debounce_time : int
            ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ™‚é–“ï¼ˆç§’ï¼‰- ã“ã®æ™‚é–“å†…ã®é€£ç¶šã‚¢ãƒ©ãƒ¼ãƒ ã‚’1ã¤ã«ã¾ã¨ã‚ã‚‹
        priority_rules : dict
            å„ªå…ˆé †ä½ãƒ«ãƒ¼ãƒ«
        """
        self.debounce_time = debounce_time
        self.priority_rules = priority_rules or {
            'CRITICAL': 1,
            'HIGH': 2,
            'MEDIUM': 3,
            'LOW': 4
        }

        self.active_alarms = {}  # ã‚¢ãƒ©ãƒ¼ãƒ ID -> ã‚¢ãƒ©ãƒ¼ãƒ æƒ…å ±
        self.alarm_history = []  # å…¨ã‚¢ãƒ©ãƒ¼ãƒ å±¥æ­´
        self.alarm_counter = 0

    def raise_alarm(self, sensor_id, value, alarm_type, severity='MEDIUM',
                   message=''):
        """
        ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ç™ºç”Ÿã•ã›ã‚‹

        Parameters:
        -----------
        sensor_id : str
            ã‚»ãƒ³ã‚µãƒ¼ID
        value : float
            ç•°å¸¸å€¤
        alarm_type : str
            ã‚¢ãƒ©ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—
        severity : str
            é‡è¦åº¦ï¼ˆCRITICAL, HIGH, MEDIUM, LOWï¼‰
        message : str
            ã‚¢ãƒ©ãƒ¼ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        """
        current_time = datetime.now()

        # ãƒ‡ãƒã‚¦ãƒ³ã‚·ãƒ³ã‚°: åŒã˜ã‚»ãƒ³ã‚µãƒ¼ã®ç›´è¿‘ã®ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ãƒã‚§ãƒƒã‚¯
        alarm_key = f"{sensor_id}_{alarm_type}"

        if alarm_key in self.active_alarms:
            last_alarm = self.active_alarms[alarm_key]
            time_diff = (current_time - last_alarm['timestamp']).total_seconds()

            # ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ™‚é–“å†…ã§ã‚ã‚Œã°ã€ã‚«ã‚¦ãƒ³ã‚¿ã‚’å¢—ã‚„ã™ã®ã¿
            if time_diff < self.debounce_time:
                last_alarm['count'] += 1
                last_alarm['last_occurrence'] = current_time
                return None  # æ–°è¦ã‚¢ãƒ©ãƒ¼ãƒ ã¯ç™ºç”Ÿã•ã›ãªã„

        # æ–°è¦ã‚¢ãƒ©ãƒ¼ãƒ ã®ä½œæˆ
        self.alarm_counter += 1
        alarm_id = f"ALM{self.alarm_counter:05d}"

        alarm = {
            'alarm_id': alarm_id,
            'sensor_id': sensor_id,
            'value': value,
            'alarm_type': alarm_type,
            'severity': severity,
            'priority': self.priority_rules.get(severity, 99),
            'message': message,
            'timestamp': current_time,
            'last_occurrence': current_time,
            'count': 1,
            'acknowledged': False,
            'resolved': False
        }

        self.active_alarms[alarm_key] = alarm
        self.alarm_history.append(alarm.copy())

        return alarm

    def acknowledge_alarm(self, alarm_key):
        """ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ç¢ºèªã™ã‚‹"""
        if alarm_key in self.active_alarms:
            self.active_alarms[alarm_key]['acknowledged'] = True
            return True
        return False

    def resolve_alarm(self, alarm_key):
        """ã‚¢ãƒ©ãƒ¼ãƒ ã‚’è§£æ±ºã™ã‚‹"""
        if alarm_key in self.active_alarms:
            alarm = self.active_alarms.pop(alarm_key)
            alarm['resolved'] = True
            alarm['resolved_time'] = datetime.now()
            return True
        return False

    def get_active_alarms_by_priority(self):
        """å„ªå…ˆé †ä½é †ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒ ã‚’å–å¾—"""
        alarms = list(self.active_alarms.values())
        alarms.sort(key=lambda x: (x['priority'], x['timestamp']))
        return alarms

    def get_alarm_summary(self):
        """ã‚¢ãƒ©ãƒ¼ãƒ ã‚µãƒãƒªãƒ¼ã‚’å–å¾—"""
        if not self.active_alarms:
            return "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒ : ãªã—"

        summary = {}
        for alarm in self.active_alarms.values():
            severity = alarm['severity']
            summary[severity] = summary.get(severity, 0) + 1

        return summary

# ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
print("=== ã‚¢ãƒ©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===\n")

# ã‚¢ãƒ©ãƒ¼ãƒ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–
alarm_mgr = AlarmManager(debounce_time=3)

# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒ ç™ºç”Ÿ
np.random.seed(42)

# ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
sensors = {
    'TEMP_101': {'target': 175, 'std': 2, 'UCL': 180, 'LCL': 170},
    'PRES_201': {'target': 1.5, 'std': 0.05, 'UCL': 1.6, 'LCL': 1.4},
    'FLOW_301': {'target': 50, 'std': 3, 'UCL': 58, 'LCL': 42}
}

print("ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ã‚’é–‹å§‹...\n")

# 60ç§’é–“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
for t in range(60):
    for sensor_id, config in sensors.items():
        # ã‚»ãƒ³ã‚µãƒ¼å€¤ã®ç”Ÿæˆ
        value = np.random.normal(config['target'], config['std'])

        # æ„å›³çš„ãªç•°å¸¸ã‚’æŒ¿å…¥
        if t == 10 and sensor_id == 'TEMP_101':
            value = 185  # é«˜æ¸©ç•°å¸¸
        elif t in [20, 21, 22] and sensor_id == 'PRES_201':
            value = 1.7  # é«˜åœ§ç•°å¸¸ï¼ˆé€£ç¶šï¼‰
        elif t == 40 and sensor_id == 'FLOW_301':
            value = 30  # ä½æµé‡ç•°å¸¸

        # ç•°å¸¸ãƒã‚§ãƒƒã‚¯ã¨ã‚¢ãƒ©ãƒ¼ãƒ ç™ºç”Ÿ
        if value > config['UCL']:
            alarm = alarm_mgr.raise_alarm(
                sensor_id=sensor_id,
                value=value,
                alarm_type='HIGH_LIMIT',
                severity='HIGH' if (value - config['UCL']) > config['std'] else 'MEDIUM',
                message=f"{sensor_id}ãŒä¸Šé™ã‚’è¶…é: {value:.2f}"
            )
            if alarm:
                print(f"[{t:2d}ç§’] ğŸš¨ {alarm['severity']:8s} | "
                      f"{alarm['sensor_id']:10s} | {alarm['message']}")

        elif value < config['LCL']:
            alarm = alarm_mgr.raise_alarm(
                sensor_id=sensor_id,
                value=value,
                alarm_type='LOW_LIMIT',
                severity='HIGH' if (config['LCL'] - value) > config['std'] else 'MEDIUM',
                message=f"{sensor_id}ãŒä¸‹é™ã‚’ä¸‹å›ã‚‹: {value:.2f}"
            )
            if alarm:
                print(f"[{t:2d}ç§’] ğŸš¨ {alarm['severity']:8s} | "
                      f"{alarm['sensor_id']:10s} | {alarm['message']}")

# ã‚¢ãƒ©ãƒ¼ãƒ ã‚µãƒãƒªãƒ¼
print("\n" + "="*70)
print("ã‚¢ãƒ©ãƒ¼ãƒ ç®¡ç†ã‚µãƒãƒªãƒ¼")
print("="*70)

summary = alarm_mgr.get_alarm_summary()
print(f"\nã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒ æ•°: {len(alarm_mgr.active_alarms)}")
for severity, count in sorted(summary.items(),
                             key=lambda x: alarm_mgr.priority_rules.get(x[0], 99)):
    print(f"  {severity}: {count}ä»¶")

print(f"\nã‚¢ãƒ©ãƒ¼ãƒ å±¥æ­´ç·æ•°: {len(alarm_mgr.alarm_history)}")

# å„ªå…ˆé †ä½é †ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒ ã‚’è¡¨ç¤º
print(f"\nã€å„ªå…ˆé †ä½é †ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒ ã€‘")
active_alarms = alarm_mgr.get_active_alarms_by_priority()
for idx, alarm in enumerate(active_alarms[:5], 1):  # æœ€åˆã®5ä»¶
    print(f"\n{idx}. [{alarm['severity']}] {alarm['alarm_id']}")
    print(f"   ã‚»ãƒ³ã‚µãƒ¼: {alarm['sensor_id']}")
    print(f"   å€¤: {alarm['value']:.2f}")
    print(f"   ç™ºç”Ÿæ™‚åˆ»: {alarm['timestamp'].strftime('%H:%M:%S')}")
    print(f"   ç™ºç”Ÿå›æ•°: {alarm['count']}")
    print(f"   ç¢ºèªæ¸ˆã¿: {'ã¯ã„' if alarm['acknowledged'] else 'ã„ã„ãˆ'}")

print("\n" + "="*70)

# ãƒ‡ãƒã‚¦ãƒ³ã‚·ãƒ³ã‚°åŠ¹æœã®æ¤œè¨¼
print(f"\nã€ãƒ‡ãƒã‚¦ãƒ³ã‚·ãƒ³ã‚°åŠ¹æœã€‘")
print(f"  ã‚¢ãƒ©ãƒ¼ãƒ å±¥æ­´ç·æ•°: {len(alarm_mgr.alarm_history)}ä»¶")
print(f"  ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒ æ•°: {len(alarm_mgr.active_alarms)}ä»¶")
print(f"  å‰Šæ¸›ç‡: {(1 - len(alarm_mgr.active_alarms)/len(alarm_mgr.alarm_history))*100:.1f}%")
print(f"  ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ™‚é–“: {alarm_mgr.debounce_time}ç§’")
</code></pre>

<p><strong>è§£èª¬</strong>: å®Ÿè·µçš„ãªã‚¢ãƒ©ãƒ¼ãƒ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¯ã€å˜ã«ç•°å¸¸ã‚’æ¤œå‡ºã™ã‚‹ã ã‘ã§ãªãã€å„ªå…ˆé †ä½ä»˜ã‘ã€ãƒ‡ãƒã‚¦ãƒ³ã‚·ãƒ³ã‚°ï¼ˆçŸ­æ™‚é–“ã®é€£ç¶šã‚¢ãƒ©ãƒ¼ãƒ ã‚’1ã¤ã«ã¾ã¨ã‚ã‚‹ï¼‰ã€ã‚¢ãƒ©ãƒ¼ãƒ ã®ç¢ºèªãƒ»è§£æ±ºç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚ãƒ‡ãƒã‚¦ãƒ³ã‚·ãƒ³ã‚°ã«ã‚ˆã‚Šã€ãƒã‚¤ã‚ºã«ã‚ˆã‚‹èª¤å ±ã‚’å‰Šæ¸›ã—ã€ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã®è² æ‹…ã‚’è»½æ¸›ã§ãã¾ã™ã€‚å„ªå…ˆé †ä½ä»˜ã‘ã«ã‚ˆã‚Šã€é‡è¦ãªã‚¢ãƒ©ãƒ¼ãƒ ã«æ³¨æ„ã‚’é›†ä¸­ã§ãã¾ã™ã€‚</p>
</div>

<div class="code-example">
<h4>ã‚³ãƒ¼ãƒ‰ä¾‹7: èª¤å ±å‰Šæ¸›æŠ€æ³•ï¼ˆãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰</h4>

<p><strong>ç›®çš„</strong>: ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šã€èª¤å ±ã‚’å‰Šæ¸›ã™ã‚‹æŠ€æ³•ã‚’å®Ÿè£…ã™ã‚‹ã€‚</p>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy import signal

np.random.seed(42)

# ãƒã‚¤ã‚ºã‚’å«ã‚€ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
n_samples = 500
time = np.arange(n_samples)

# åŸºæœ¬ä¿¡å· + ãƒã‚¤ã‚º
base_signal = 50 + 5 * np.sin(2 * np.pi * time / 100)
noise = np.random.normal(0, 2, n_samples)
noisy_signal = base_signal + noise

# é–¾å€¤
upper_threshold = 55
lower_threshold = 45

# æ‰‹æ³•1: ã‚·ãƒ³ãƒ—ãƒ«ãªé–¾å€¤åˆ¤å®šï¼ˆèª¤å ±ãŒå¤šã„ï¼‰
def simple_threshold_detection(data, upper, lower):
    """ã‚·ãƒ³ãƒ—ãƒ«ãªé–¾å€¤åˆ¤å®š"""
    alarms = (data > upper) | (data < lower)
    return alarms

# æ‰‹æ³•2: ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ã‚’ç”¨ã„ãŸé–¾å€¤åˆ¤å®š
def hysteresis_detection(data, upper, lower, hysteresis_band=1):
    """
    ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ã‚’ç”¨ã„ãŸé–¾å€¤åˆ¤å®š

    Parameters:
    -----------
    data : array-like
        å…¥åŠ›ãƒ‡ãƒ¼ã‚¿
    upper : float
        ä¸Šé™é–¾å€¤
    lower : float
        ä¸‹é™é–¾å€¤
    hysteresis_band : float
        ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ãƒãƒ³ãƒ‰å¹…
    """
    alarms = np.zeros(len(data), dtype=bool)
    alarm_active = False

    for i in range(len(data)):
        if not alarm_active:
            # ã‚¢ãƒ©ãƒ¼ãƒ éæ´»æ€§çŠ¶æ…‹: å¤–å´é–¾å€¤ã§åˆ¤å®š
            if data[i] > upper or data[i] < lower:
                alarm_active = True
                alarms[i] = True
        else:
            # ã‚¢ãƒ©ãƒ¼ãƒ æ´»æ€§çŠ¶æ…‹: å†…å´é–¾å€¤ï¼ˆãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ï¼‰ã§è§£é™¤åˆ¤å®š
            inner_upper = upper - hysteresis_band
            inner_lower = lower + hysteresis_band

            if inner_lower < data[i] < inner_upper:
                alarm_active = False
            else:
                alarms[i] = True

    return alarms

# æ‰‹æ³•3: ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ + é–¾å€¤åˆ¤å®š
def filtered_detection(data, upper, lower, filter_order=3, cutoff_freq=0.05):
    """
    ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã®é–¾å€¤åˆ¤å®š

    Parameters:
    -----------
    data : array-like
        å…¥åŠ›ãƒ‡ãƒ¼ã‚¿
    upper : float
        ä¸Šé™é–¾å€¤
    lower : float
        ä¸‹é™é–¾å€¤
    filter_order : int
        ãƒ•ã‚£ãƒ«ã‚¿æ¬¡æ•°
    cutoff_freq : float
        ã‚«ãƒƒãƒˆã‚ªãƒ•å‘¨æ³¢æ•°ï¼ˆæ­£è¦åŒ–å‘¨æ³¢æ•°ã€0ï½1ï¼‰
    """
    # Butterworthãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã®è¨­è¨ˆ
    b, a = signal.butter(filter_order, cutoff_freq, btype='low')

    # ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    filtered_data = signal.filtfilt(b, a, data)

    # é–¾å€¤åˆ¤å®š
    alarms = (filtered_data > upper) | (filtered_data < lower)

    return alarms, filtered_data

# å„æ‰‹æ³•ã‚’é©ç”¨
simple_alarms = simple_threshold_detection(noisy_signal, upper_threshold, lower_threshold)
hysteresis_alarms = hysteresis_detection(noisy_signal, upper_threshold, lower_threshold,
                                         hysteresis_band=2)
filtered_alarms, filtered_signal = filtered_detection(noisy_signal, upper_threshold,
                                                      lower_threshold)

# å¯è¦–åŒ–
fig, axes = plt.subplots(4, 1, figsize=(16, 14))

# å…ƒãƒ‡ãƒ¼ã‚¿
axes[0].plot(time, noisy_signal, 'b-', linewidth=0.8, alpha=0.7, label='ãƒã‚¤ã‚ºå«ã‚€ä¿¡å·')
axes[0].plot(time, base_signal, 'g--', linewidth=1.5, label='çœŸã®ä¿¡å·')
axes[0].axhline(y=upper_threshold, color='red', linestyle='--', linewidth=2,
               label='é–¾å€¤')
axes[0].axhline(y=lower_threshold, color='red', linestyle='--', linewidth=2)
axes[0].set_ylabel('ä¿¡å·å€¤', fontsize=11)
axes[0].set_title('å…ƒãƒ‡ãƒ¼ã‚¿ï¼ˆãƒã‚¤ã‚ºã‚’å«ã‚€ï¼‰', fontsize=13, fontweight='bold')
axes[0].legend()
axes[0].grid(alpha=0.3)

# æ‰‹æ³•1: ã‚·ãƒ³ãƒ—ãƒ«ãªé–¾å€¤åˆ¤å®š
axes[1].plot(time, noisy_signal, 'b-', linewidth=0.8, alpha=0.5, label='ä¿¡å·')
axes[1].scatter(time[simple_alarms], noisy_signal[simple_alarms],
               color='red', s=20, marker='o', zorder=5, label='ã‚¢ãƒ©ãƒ¼ãƒ ')
axes[1].axhline(y=upper_threshold, color='red', linestyle='--', linewidth=2)
axes[1].axhline(y=lower_threshold, color='red', linestyle='--', linewidth=2)
axes[1].set_ylabel('ä¿¡å·å€¤', fontsize=11)
axes[1].set_title(f'æ‰‹æ³•1: ã‚·ãƒ³ãƒ—ãƒ«ãªé–¾å€¤åˆ¤å®šï¼ˆã‚¢ãƒ©ãƒ¼ãƒ æ•°: {simple_alarms.sum()}ï¼‰',
                  fontsize=13, fontweight='bold')
axes[1].legend()
axes[1].grid(alpha=0.3)

# æ‰‹æ³•2: ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹
axes[2].plot(time, noisy_signal, 'b-', linewidth=0.8, alpha=0.5, label='ä¿¡å·')
axes[2].scatter(time[hysteresis_alarms], noisy_signal[hysteresis_alarms],
               color='orange', s=20, marker='o', zorder=5, label='ã‚¢ãƒ©ãƒ¼ãƒ ')
axes[2].axhline(y=upper_threshold, color='red', linestyle='--', linewidth=2,
               label='å¤–å´é–¾å€¤')
axes[2].axhline(y=lower_threshold, color='red', linestyle='--', linewidth=2)
axes[2].axhline(y=upper_threshold - 2, color='orange', linestyle=':', linewidth=1.5,
               label='å†…å´é–¾å€¤ï¼ˆãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ï¼‰')
axes[2].axhline(y=lower_threshold + 2, color='orange', linestyle=':', linewidth=1.5)
axes[2].set_ylabel('ä¿¡å·å€¤', fontsize=11)
axes[2].set_title(f'æ‰‹æ³•2: ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ï¼ˆã‚¢ãƒ©ãƒ¼ãƒ æ•°: {hysteresis_alarms.sum()}ï¼‰',
                  fontsize=13, fontweight='bold')
axes[2].legend()
axes[2].grid(alpha=0.3)

# æ‰‹æ³•3: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
axes[3].plot(time, noisy_signal, 'b-', linewidth=0.8, alpha=0.3, label='å…ƒä¿¡å·')
axes[3].plot(time, filtered_signal, 'g-', linewidth=1.5, label='ãƒ•ã‚£ãƒ«ã‚¿å¾Œã®ä¿¡å·')
axes[3].scatter(time[filtered_alarms], filtered_signal[filtered_alarms],
               color='purple', s=20, marker='o', zorder=5, label='ã‚¢ãƒ©ãƒ¼ãƒ ')
axes[3].axhline(y=upper_threshold, color='red', linestyle='--', linewidth=2,
               label='é–¾å€¤')
axes[3].axhline(y=lower_threshold, color='red', linestyle='--', linewidth=2)
axes[3].set_xlabel('æ™‚é–“', fontsize=11)
axes[3].set_ylabel('ä¿¡å·å€¤', fontsize=11)
axes[3].set_title(f'æ‰‹æ³•3: ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚¢ãƒ©ãƒ¼ãƒ æ•°: {filtered_alarms.sum()}ï¼‰',
                  fontsize=13, fontweight='bold')
axes[3].legend()
axes[3].grid(alpha=0.3)

plt.tight_layout()
plt.show()

# æ€§èƒ½æ¯”è¼ƒ
print("=== èª¤å ±å‰Šæ¸›æŠ€æ³•ã®æ¯”è¼ƒ ===")
print(f"\nãƒ‡ãƒ¼ã‚¿:")
print(f"  ã‚µãƒ³ãƒ—ãƒ«æ•°: {n_samples}")
print(f"  ä¿¡å·: æ­£å¼¦æ³¢ + ã‚¬ã‚¦ã‚¹ãƒã‚¤ã‚º")
print(f"  é–¾å€¤: ä¸Šé™ {upper_threshold}, ä¸‹é™ {lower_threshold}")

print(f"\nã€ã‚¢ãƒ©ãƒ¼ãƒ æ•°ã®æ¯”è¼ƒã€‘")
print(f"  æ‰‹æ³•1ï¼ˆã‚·ãƒ³ãƒ—ãƒ«é–¾å€¤åˆ¤å®šï¼‰: {simple_alarms.sum()}å›")
print(f"  æ‰‹æ³•2ï¼ˆãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ï¼‰: {hysteresis_alarms.sum()}å› "
      f"({(1 - hysteresis_alarms.sum()/simple_alarms.sum())*100:.1f}% å‰Šæ¸›)")
print(f"  æ‰‹æ³•3ï¼ˆãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼‰: {filtered_alarms.sum()}å› "
      f"({(1 - filtered_alarms.sum()/simple_alarms.sum())*100:.1f}% å‰Šæ¸›)")

# ã‚¢ãƒ©ãƒ¼ãƒ ã®é€£ç¶šæ€§ï¼ˆãƒãƒ£ã‚¿ãƒªãƒ³ã‚°ï¼‰ã®è©•ä¾¡
def count_alarm_transitions(alarms):
    """ã‚¢ãƒ©ãƒ¼ãƒ ã®ã‚ªãƒ³/ã‚ªãƒ•åˆ‡ã‚Šæ›¿ãˆå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ"""
    transitions = np.sum(np.diff(alarms.astype(int)) != 0)
    return transitions

simple_transitions = count_alarm_transitions(simple_alarms)
hysteresis_transitions = count_alarm_transitions(hysteresis_alarms)
filtered_transitions = count_alarm_transitions(filtered_alarms)

print(f"\nã€ã‚¢ãƒ©ãƒ¼ãƒ ã®åˆ‡ã‚Šæ›¿ãˆå›æ•°ï¼ˆãƒãƒ£ã‚¿ãƒªãƒ³ã‚°æŒ‡æ¨™ï¼‰ã€‘")
print(f"  æ‰‹æ³•1: {simple_transitions}å›")
print(f"  æ‰‹æ³•2: {hysteresis_transitions}å› "
      f"({(1 - hysteresis_transitions/simple_transitions)*100:.1f}% å‰Šæ¸›)")
print(f"  æ‰‹æ³•3: {filtered_transitions}å› "
      f"({(1 - filtered_transitions/simple_transitions)*100:.1f}% å‰Šæ¸›)")

print(f"\nã€æ¨å¥¨ã€‘")
print("  - ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹: é–¾å€¤ä»˜è¿‘ã§ã®ãƒãƒ£ã‚¿ãƒªãƒ³ã‚°é˜²æ­¢ã«æœ‰åŠ¹")
print("  - ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿: é«˜å‘¨æ³¢ãƒã‚¤ã‚ºã®é™¤å»ã«æœ‰åŠ¹ï¼ˆä½ç›¸é…ã‚Œã«æ³¨æ„ï¼‰")
print("  - çµ„ã¿åˆã‚ã›: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° + ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ã§æœ€å¤§ã®åŠ¹æœ")
</code></pre>

<p><strong>è§£èª¬</strong>: èª¤å ±å‰Šæ¸›ã¯ã€å®Ÿç”¨çš„ãªã‚¢ãƒ©ãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ ã®é‡è¦ãªè¦ç´ ã§ã™ã€‚<strong>ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹</strong>ã¯ã€ã‚¢ãƒ©ãƒ¼ãƒ ã®ã‚ªãƒ³ã¨ã‚ªãƒ•ã«ç•°ãªã‚‹é–¾å€¤ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€é–¾å€¤ä»˜è¿‘ã§ã®ãƒãƒ£ã‚¿ãƒªãƒ³ã‚°ï¼ˆé »ç¹ãªã‚ªãƒ³/ã‚ªãƒ•åˆ‡ã‚Šæ›¿ãˆï¼‰ã‚’é˜²ãã¾ã™ã€‚<strong>ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿</strong>ã¯ã€é«˜å‘¨æ³¢ãƒã‚¤ã‚ºã‚’é™¤å»ã—ã¦ã‹ã‚‰é–¾å€¤åˆ¤å®šã‚’è¡Œã†ã“ã¨ã§ã€ãƒã‚¤ã‚ºã«ã‚ˆã‚‹èª¤å ±ã‚’å‰Šæ¸›ã—ã¾ã™ã€‚å®Ÿéš›ã®ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ã§ã¯ã€ã“ã‚Œã‚‰ã®æŠ€æ³•ã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã—ã¾ã™ã€‚</p>
</div>

<div class="code-example">
<h4>ã‚³ãƒ¼ãƒ‰ä¾‹8: æ ¹æœ¬åŸå› åˆ†æã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…</h4>

<p><strong>ç›®çš„</strong>: ç•°å¸¸æ¤œçŸ¥å¾Œã®æ ¹æœ¬åŸå› åˆ†æï¼ˆRoot Cause Analysisï¼‰ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã™ã‚‹ã€‚</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy.stats import pearsonr

np.random.seed(42)

# å¤šå¤‰é‡ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
n_samples = 200
time_index = pd.date_range('2025-01-01', periods=n_samples, freq='1min')

# ãƒ—ãƒ­ã‚»ã‚¹å¤‰æ•°ã®ç”Ÿæˆ
# å¤‰æ•°é–“ã«å› æœé–¢ä¿‚ã‚’æŒãŸã›ã‚‹
feed_flow = 50 + np.random.normal(0, 2, n_samples)
reactor_temp = 175 + 0.5 * (feed_flow - 50) + np.random.normal(0, 1.5, n_samples)
reactor_pressure = 1.5 + 0.02 * (reactor_temp - 175) + np.random.normal(0, 0.05, n_samples)
product_quality = 95 + 0.3 * (reactor_temp - 175) - 0.1 * (reactor_pressure - 1.5) + \
                  np.random.normal(0, 1, n_samples)

# ç•°å¸¸ã‚’æŒ¿å…¥: ä¾›çµ¦æµé‡ã®æ€¥æ¿€ãªå¢—åŠ ï¼ˆã‚µãƒ³ãƒ—ãƒ«100-120ï¼‰
feed_flow[100:121] += np.linspace(0, 10, 21)
reactor_temp[100:121] += 0.5 * np.linspace(0, 10, 21) + np.random.normal(0, 1, 21)
reactor_pressure[100:121] += 0.02 * 0.5 * np.linspace(0, 10, 21) + \
                              np.random.normal(0, 0.05, 21)
product_quality[100:121] += 0.3 * 0.5 * np.linspace(0, 10, 21)

# DataFrameã«æ ¼ç´
df = pd.DataFrame({
    'timestamp': time_index,
    'feed_flow': feed_flow,
    'reactor_temp': reactor_temp,
    'reactor_pressure': reactor_pressure,
    'product_quality': product_quality
})
df.set_index('timestamp', inplace=True)

class RootCauseAnalyzer:
    """æ ¹æœ¬åŸå› åˆ†æã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, data, variable_names):
        """
        Parameters:
        -----------
        data : DataFrame
            ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿
        variable_names : list
            å¤‰æ•°åã®ãƒªã‚¹ãƒˆ
        """
        self.data = data
        self.variable_names = variable_names

    def detect_anomaly_period(self, variable, threshold_factor=3):
        """ç•°å¸¸æœŸé–“ã‚’æ¤œå‡º"""
        mean = self.data[variable].mean()
        std = self.data[variable].std()

        z_scores = np.abs((self.data[variable] - mean) / std)
        anomaly_mask = z_scores > threshold_factor

        # é€£ç¶šã™ã‚‹ç•°å¸¸æœŸé–“ã‚’ç‰¹å®š
        anomaly_periods = []
        in_anomaly = False
        start_idx = None

        for i, is_anomaly in enumerate(anomaly_mask):
            if is_anomaly and not in_anomaly:
                start_idx = i
                in_anomaly = True
            elif not is_anomaly and in_anomaly:
                anomaly_periods.append((start_idx, i-1))
                in_anomaly = False

        if in_anomaly:
            anomaly_periods.append((start_idx, len(anomaly_mask)-1))

        return anomaly_periods

    def correlation_analysis(self, anomaly_period, target_variable):
        """
        ç•°å¸¸æœŸé–“ã«ãŠã‘ã‚‹å¤‰æ•°é–“ã®ç›¸é–¢åˆ†æ

        Parameters:
        -----------
        anomaly_period : tuple
            ç•°å¸¸æœŸé–“ï¼ˆé–‹å§‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹, çµ‚äº†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
        target_variable : str
            å¯¾è±¡å¤‰æ•°
        """
        start, end = anomaly_period

        # ç•°å¸¸æœŸé–“å‰ã®æ­£å¸¸ãƒ‡ãƒ¼ã‚¿
        normal_period = (max(0, start-50), max(0, start-1))
        normal_data = self.data.iloc[normal_period[0]:normal_period[1]+1]

        # ç•°å¸¸æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿
        anomaly_data = self.data.iloc[start:end+1]

        correlations = {}

        for var in self.variable_names:
            if var != target_variable:
                # æ­£å¸¸æœŸé–“ã®ç›¸é–¢
                normal_corr, _ = pearsonr(normal_data[target_variable],
                                         normal_data[var])

                # ç•°å¸¸æœŸé–“ã®ç›¸é–¢
                anomaly_corr, _ = pearsonr(anomaly_data[target_variable],
                                          anomaly_data[var])

                # ç›¸é–¢ã®å¤‰åŒ–
                corr_change = abs(anomaly_corr - normal_corr)

                correlations[var] = {
                    'normal_corr': normal_corr,
                    'anomaly_corr': anomaly_corr,
                    'change': corr_change
                }

        # ç›¸é–¢å¤‰åŒ–ã®å¤§ãã„é †ã«ã‚½ãƒ¼ãƒˆ
        sorted_vars = sorted(correlations.items(),
                           key=lambda x: x[1]['change'],
                           reverse=True)

        return sorted_vars

    def time_sequence_analysis(self, anomaly_period):
        """
        ç•°å¸¸ç™ºç”Ÿã®æ™‚é–“é †åºã‚’åˆ†æ

        Parameters:
        -----------
        anomaly_period : tuple
            ç•°å¸¸æœŸé–“ï¼ˆé–‹å§‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹, çµ‚äº†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
        """
        start, end = anomaly_period

        # å„å¤‰æ•°ã®ç•°å¸¸é–‹å§‹æ™‚åˆ»ã‚’ç‰¹å®š
        anomaly_start_times = {}

        for var in self.variable_names:
            mean = self.data[var].mean()
            std = self.data[var].std()

            for i in range(start, end+1):
                z_score = abs((self.data[var].iloc[i] - mean) / std)
                if z_score > 2:  # 2Ïƒä»¥ä¸Šã®é€¸è„±
                    anomaly_start_times[var] = i
                    break

        # æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆ
        sorted_times = sorted(anomaly_start_times.items(),
                            key=lambda x: x[1])

        return sorted_times

# æ ¹æœ¬åŸå› åˆ†æã®å®Ÿè¡Œ
analyzer = RootCauseAnalyzer(df, df.columns.tolist())

# è£½å“å“è³ªã®ç•°å¸¸ã‚’æ¤œå‡º
quality_anomalies = analyzer.detect_anomaly_period('product_quality',
                                                   threshold_factor=2)

print("=== æ ¹æœ¬åŸå› åˆ†æã‚·ã‚¹ãƒ†ãƒ  ===")
print(f"\nç•°å¸¸æ¤œå‡º:")
print(f"  å¯¾è±¡å¤‰æ•°: è£½å“å“è³ª")
print(f"  æ¤œå‡ºã•ã‚ŒãŸç•°å¸¸æœŸé–“: {len(quality_anomalies)}å€‹")

if quality_anomalies:
    anomaly_period = quality_anomalies[0]  # æœ€åˆã®ç•°å¸¸æœŸé–“ã‚’åˆ†æ
    start, end = anomaly_period

    print(f"\nã€åˆ†æå¯¾è±¡ç•°å¸¸æœŸé–“ã€‘")
    print(f"  æœŸé–“: ã‚µãƒ³ãƒ—ãƒ« {start+1} ï½ {end+1}")
    print(f"  æ™‚åˆ»: {df.index[start]} ï½ {df.index[end]}")

    # ç›¸é–¢åˆ†æ
    print(f"\nã€å¤‰æ•°é–“ç›¸é–¢åˆ†æã€‘")
    correlations = analyzer.correlation_analysis(anomaly_period, 'product_quality')

    print("  æ ¹æœ¬åŸå› å€™è£œï¼ˆç›¸é–¢å¤‰åŒ–ã®å¤§ãã„é †ï¼‰:")
    for idx, (var, corr_info) in enumerate(correlations, 1):
        print(f"\n  {idx}. {var}")
        print(f"     æ­£å¸¸æ™‚ç›¸é–¢: {corr_info['normal_corr']:+.3f}")
        print(f"     ç•°å¸¸æ™‚ç›¸é–¢: {corr_info['anomaly_corr']:+.3f}")
        print(f"     å¤‰åŒ–: {corr_info['change']:.3f}")

    # æ™‚é–“é †åºåˆ†æ
    print(f"\nã€ç•°å¸¸ç™ºç”Ÿã®æ™‚é–“é †åºã€‘")
    time_sequence = analyzer.time_sequence_analysis(anomaly_period)

    print("  ç•°å¸¸ãŒæœ€åˆã«ç¾ã‚ŒãŸé †åº:")
    for idx, (var, sample_idx) in enumerate(time_sequence, 1):
        time_delay = sample_idx - time_sequence[0][1] if idx > 1 else 0
        print(f"  {idx}. {var}: ã‚µãƒ³ãƒ—ãƒ« {sample_idx+1} "
              f"({time_delay}åˆ†å¾Œ)" if time_delay > 0 else
              f"  {idx}. {var}: ã‚µãƒ³ãƒ—ãƒ« {sample_idx+1} (èµ·ç‚¹)")

    # å¯è¦–åŒ–
    fig, axes = plt.subplots(len(df.columns), 1, figsize=(16, 12), sharex=True)

    for idx, var in enumerate(df.columns):
        # æ­£å¸¸ãƒ‡ãƒ¼ã‚¿
        normal_mask = np.ones(len(df), dtype=bool)
        normal_mask[start:end+1] = False

        axes[idx].plot(df.index[normal_mask], df[var][normal_mask],
                      'o', color='#11998e', markersize=3, alpha=0.6)

        # ç•°å¸¸ãƒ‡ãƒ¼ã‚¿
        axes[idx].plot(df.index[start:end+1], df[var].iloc[start:end+1],
                      'o', color='red', markersize=4, alpha=0.8, label='ç•°å¸¸æœŸé–“')

        # å¹³å‡ç·š
        mean = df[var].mean()
        axes[idx].axhline(y=mean, color='blue', linestyle='--',
                         linewidth=1, alpha=0.5)

        axes[idx].set_ylabel(var, fontsize=10)
        axes[idx].grid(alpha=0.3)

        if idx == 0:
            axes[idx].set_title('æ ¹æœ¬åŸå› åˆ†æ - æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿',
                              fontsize=13, fontweight='bold')
        if idx == 0:
            axes[idx].legend()

    axes[-1].set_xlabel('æ™‚åˆ»', fontsize=11)
    plt.tight_layout()
    plt.show()

    # çµè«–
    print(f"\nã€æ ¹æœ¬åŸå› ã®æ¨å®šã€‘")
    if time_sequence:
        root_cause = time_sequence[0][0]
        print(f"  æ¨å®šæ ¹æœ¬åŸå› : {root_cause}")
        print(f"  ç†ç”±:")
        print(f"    1. ç•°å¸¸ç™ºç”Ÿã®æœ€ã‚‚æ—©ã„å¤‰æ•°")
        print(f"    2. ç•°å¸¸æœŸé–“ä¸­ã«ä»–å¤‰æ•°ã¨ã®ç›¸é–¢å¤‰åŒ–ãŒå¤§ãã„")
        print(f"\n  æ¨å¥¨å¯¾å¿œ:")
        print(f"    - {root_cause}ã‚’æ­£å¸¸ç¯„å›²ã«æˆ»ã™")
        print(f"    - {root_cause}ã®åˆ¶å¾¡ãƒ«ãƒ¼ãƒ—ã‚’ç¢ºèª")
        print(f"    - é–¢é€£ã™ã‚‹ä¸Šæµãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¿æŸ»")
</code></pre>

<p><strong>è§£èª¬</strong>: æ ¹æœ¬åŸå› åˆ†æï¼ˆRCAï¼‰ã¯ã€ç•°å¸¸æ¤œçŸ¥å¾Œã«ã€Œãªãœç•°å¸¸ãŒç™ºç”Ÿã—ãŸã‹ã€ã‚’ç‰¹å®šã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã§ã™ã€‚ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€(1) å¤‰æ•°é–“ã®ç›¸é–¢åˆ†æã«ã‚ˆã‚Šé–¢é€£ã™ã‚‹å¤‰æ•°ã‚’ç‰¹å®šã—ã€(2) æ™‚é–“é †åºåˆ†æã«ã‚ˆã‚Šç•°å¸¸ãŒæœ€åˆã«ç¾ã‚ŒãŸå¤‰æ•°ï¼ˆæ ¹æœ¬åŸå› ã®å€™è£œï¼‰ã‚’ç‰¹å®šã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ç”£æ¥­ã§ã¯ã€è¿…é€ŸãªRCAã«ã‚ˆã‚Šã€å•é¡Œã®å†ç™ºé˜²æ­¢ã¨åŠ¹ç‡çš„ãªå¯¾ç­–å®Ÿæ–½ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
</div>

<hr />

<h2>3.3 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><strong>ç•°å¸¸æ¤œçŸ¥ã®åŸºç¤</strong>
    <ul>
        <li>ç•°å¸¸æ¤œçŸ¥ã®ç›®çš„ã¨é‡è¦æ€§</li>
        <li>ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã€çµ±è¨ˆçš„ã€æ©Ÿæ¢°å­¦ç¿’ã€ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã®4ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</li>
        <li>å„æ‰‹æ³•ã®åˆ©ç‚¹ã¨æ¬ ç‚¹ã®ç†è§£</li>
    </ul>
</li>
<li><strong>çµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥</strong>
    <ul>
        <li>Z-scoreæ³•: æ­£è¦åˆ†å¸ƒã‚’ä»®å®šã—ãŸå¤–ã‚Œå€¤æ¤œå‡º</li>
        <li>ä¿®æ­£Z-scoreæ³•ï¼ˆMADï¼‰: å¤–ã‚Œå€¤ã«é ‘å¥ãªæ‰‹æ³•</li>
        <li>é©ç”¨æ¡ä»¶ã¨ä½¿ã„åˆ†ã‘</li>
    </ul>
</li>
<li><strong>æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥</strong>
    <ul>
        <li>Isolation Forest: å­¤ç«‹æ€§ã«åŸºã¥ãç•°å¸¸æ¤œçŸ¥</li>
        <li>One-Class SVM: æ­£å¸¸é ˜åŸŸã®å¢ƒç•Œå­¦ç¿’</li>
        <li>æ•™å¸«ãªã—å­¦ç¿’ã«ã‚ˆã‚‹å®Ÿè£…</li>
    </ul>
</li>
<li><strong>ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°</strong>
    <ul>
        <li>LSTM Autoencoder: æ™‚ç³»åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å­¦ç¿’</li>
        <li>å†æ§‹æˆèª¤å·®ã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥</li>
        <li>è¤‡é›‘ãªæ™‚ç³»åˆ—ã¸ã®å¯¾å¿œ</li>
    </ul>
</li>
<li><strong>ã‚¢ãƒ©ãƒ¼ãƒ ç®¡ç†</strong>
    <ul>
        <li>å„ªå…ˆé †ä½ä»˜ã‘ã¨ãƒ‡ãƒã‚¦ãƒ³ã‚·ãƒ³ã‚°</li>
        <li>ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹èª¤å ±å‰Šæ¸›</li>
        <li>æ ¹æœ¬åŸå› åˆ†æã‚·ã‚¹ãƒ†ãƒ </li>
    </ul>
</li>
</ol>

<h3>é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h3>

<ul>
<li><strong>æ‰‹æ³•ã®é¸æŠ</strong>: ãƒ‡ãƒ¼ã‚¿ã®ç‰¹æ€§ã¨ç›®çš„ã«å¿œã˜ã¦é©åˆ‡ãªç•°å¸¸æ¤œçŸ¥æ‰‹æ³•ã‚’é¸æŠ</li>
<li><strong>èª¤å ±å‰Šæ¸›</strong>: å®Ÿç”¨çš„ãªã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€èª¤å ±å‰Šæ¸›æŠ€æ³•ãŒä¸å¯æ¬ </li>
<li><strong>æ ¹æœ¬åŸå› åˆ†æ</strong>: ç•°å¸¸æ¤œçŸ¥ã ã‘ã§ãªãã€åŸå› ç‰¹å®šã¾ã§è¡Œã†ã“ã¨ãŒé‡è¦</li>
<li><strong>æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</strong>: ã‚·ãƒ³ãƒ—ãƒ«ãªæ‰‹æ³•ã‹ã‚‰å§‹ã‚ã€å¿…è¦ã«å¿œã˜ã¦é«˜åº¦ãªæ‰‹æ³•ã‚’å°å…¥</li>
<li><strong>çµ±åˆã‚·ã‚¹ãƒ†ãƒ </strong>: è¤‡æ•°ã®æ‰‹æ³•ã‚’çµ„ã¿åˆã‚ã›ãŸçµ±åˆçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒåŠ¹æœçš„</li>
</ul>

<h3>æ¬¡ã®ç« ã¸</h3>

<p>ç¬¬4ç« ã§ã¯ã€<strong>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ¶å¾¡ã¨PIDåˆ¶å¾¡</strong>ã‚’å­¦ã³ã¾ã™ï¼š</p>
<ul>
<li>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ¶å¾¡ã®åŸºç¤ç†è«–</li>
<li>ä¸€æ¬¡é…ã‚Œç³»ã¨ã‚¹ãƒ†ãƒƒãƒ—å¿œç­”</li>
<li>PIDåˆ¶å¾¡å™¨ã®å®Ÿè£…ï¼ˆP, PI, PIDï¼‰</li>
<li>Ziegler-Nicholsãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æ‰‹æ³•</li>
<li>ã‚¢ãƒ³ãƒãƒ¯ã‚¤ãƒ³ãƒ‰ã‚¢ãƒƒãƒ—ã¨ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰åˆ¶å¾¡</li>
</ul>

<div class="navigation">
    <a href="chapter-2.html" class="nav-button">â† å‰ã®ç« </a>
    <span class="coming-soon">æ¬¡ã®ç«  â†’ï¼ˆæº–å‚™ä¸­ï¼‰</span>
</div>

    </main>

    
    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

<footer>
        <p><strong>ä½œæˆè€…</strong>: PI Knowledge Hub - Dr. Yusuke Hashimoto, Tohoku University</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-25</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>&copy; 2025 PI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
