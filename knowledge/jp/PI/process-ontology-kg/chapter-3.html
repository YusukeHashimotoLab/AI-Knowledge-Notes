<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¬¬3ç« ï¼šãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•æ§‹ç¯‰ - CSVã€ã‚»ãƒ³ã‚µãƒ¼ã€P&IDãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•RDFå¤‰æ›ã¨ãƒˆãƒªãƒ—ãƒ«ç”Ÿæˆ">
    <title>ç¬¬3ç« ï¼šãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•æ§‹ç¯‰ - ãƒ—ãƒ­ã‚»ã‚¹ã‚ªãƒ³ãƒˆãƒ­ã‚¸ãƒ¼å…¥é–€ | PI Knowledge Hub</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #11998e;
            --color-accent-light: #38ef7d;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #11998e;
            --color-link-hover: #0d7a6f;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.3rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-text);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s;
        }

        a:hover {
            color: var(--color-link-hover);
            border-bottom-color: var(--color-link-hover);
        }

        code {
            font-family: var(--font-mono);
            background-color: var(--color-code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
            border: 1px solid var(--color-border);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
        }

        pre code {
            background: none;
            border: none;
            padding: 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        ul, ol {
            margin-bottom: var(--spacing-md);
            padding-left: var(--spacing-lg);
        }

        li {
            margin-bottom: var(--spacing-xs);
        }

        .info-box {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .warning-box {
            background-color: #fff7e6;
            border-left: 4px solid #fa8c16;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .success-box {
            background-color: #f6ffed;
            border-left: 4px solid #52c41a;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .tip-box {
            background-color: #f0fdf4;
            border-left: 4px solid var(--color-accent);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: transform 0.3s, box-shadow 0.3s;
            border-bottom: none;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
            color: white;
            border-bottom: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
        }

        .example-output {
            background-color: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: var(--spacing-sm);
            margin-top: var(--spacing-sm);
            font-family: var(--font-mono);
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .navigation {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
        }
    </style>

    <!-- Mermaid for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ç¬¬3ç« ï¼šãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•æ§‹ç¯‰</h1>
            <p class="subtitle">CSVã€ã‚»ãƒ³ã‚µãƒ¼ã€P&IDãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•RDFå¤‰æ›ã¨ãƒˆãƒªãƒ—ãƒ«ç”Ÿæˆ</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 35-40åˆ†</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 7å€‹</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸Šç´š</span>
            </div>
        </div>
    </header>

    <main class="container">
        <section>
            <h2>3.1 CSVãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŠ½å‡º</h2>

            <p>å®Ÿéš›ã®åŒ–å­¦ãƒ—ãƒ©ãƒ³ãƒˆã§ã¯ã€è£…ç½®æƒ…å ±ã‚„é‹è»¢ãƒ‡ãƒ¼ã‚¿ãŒCSVå½¢å¼ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’è‡ªå‹•æ§‹ç¯‰ã™ã‚‹æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚</p>

            <div class="info-box">
                <p><strong>ğŸ’¡ ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•æ§‹ç¯‰ã®3ã‚¹ãƒ†ãƒƒãƒ—</strong></p>
                <ol>
                    <li><strong>ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŠ½å‡º</strong>: ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è£…ç½®ã‚„ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è­˜åˆ¥</li>
                    <li><strong>é–¢ä¿‚æŠ½å‡º</strong>: è£…ç½®é–“ã®æ¥ç¶šã‚„å› æœé–¢ä¿‚ã‚’ç‰¹å®š</li>
                    <li><strong>ãƒˆãƒªãƒ—ãƒ«ç”Ÿæˆ</strong>: RDFå½¢å¼ï¼ˆSubject-Predicate-Objectï¼‰ã«å¤‰æ›</li>
                </ol>
            </div>

            <h3>Example 1: CSVãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®è£…ç½®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŠ½å‡º</h3>
            <p>è£…ç½®ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰RDFãƒˆãƒªãƒ—ãƒ«ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚</p>

<pre><code># ===================================
# Example 1: CSVã‹ã‚‰ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŠ½å‡º
# ===================================

import pandas as pd
from rdflib import Graph, Namespace, Literal, URIRef
from rdflib.namespace import RDF, RDFS, XSD
import io

# CSVãƒ‡ãƒ¼ã‚¿ï¼ˆè£…ç½®ãƒã‚¹ã‚¿ãƒ¼ï¼‰
csv_data = """EquipmentID,Type,Name,Temperature_K,Pressure_bar,Volume_m3,Efficiency_pct
R-101,CSTR,ä¸»åå¿œå™¨,350.0,5.0,10.0,92.5
R-102,PFR,ç®¡å‹åå¿œå™¨,420.0,8.0,5.0,88.0
HX-201,HeatExchanger,å†·å´å™¨HX-201,320.0,,,90.0
HX-202,HeatExchanger,åŠ ç†±å™¨HX-202,450.0,,,85.0
SEP-301,Separator,è’¸ç•™å¡”,340.0,1.5,,95.0
P-401,Pump,ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒ³ãƒ—,300.0,10.0,,85.0"""

# DataFrameã«èª­ã¿è¾¼ã¿
df = pd.read_csv(io.StringIO(csv_data))

print("=== å…ƒã®CSVãƒ‡ãƒ¼ã‚¿ ===")
print(df.head(3))

# RDFã‚°ãƒ©ãƒ•ã®ä½œæˆ
g = Graph()
PROC = Namespace("http://example.org/process/")
g.bind("proc", PROC)

# ===== CSVã‹ã‚‰RDFãƒˆãƒªãƒ—ãƒ«ã¸ã®å¤‰æ› =====

def csv_to_rdf(row):
    """CSVè¡Œã‚’RDFãƒˆãƒªãƒ—ãƒ«ã«å¤‰æ›"""
    equipment_uri = PROC[row['EquipmentID']]

    # åŸºæœ¬ãƒˆãƒªãƒ—ãƒ«
    g.add((equipment_uri, RDF.type, PROC[row['Type']]))
    g.add((equipment_uri, RDFS.label, Literal(row['Name'], lang='ja')))

    # æ¸©åº¦ï¼ˆå¿…é ˆï¼‰
    g.add((equipment_uri, PROC.hasTemperature,
           Literal(row['Temperature_K'], datatype=XSD.double)))

    # åœ§åŠ›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
    if pd.notna(row['Pressure_bar']):
        g.add((equipment_uri, PROC.hasPressure,
               Literal(row['Pressure_bar'], datatype=XSD.double)))

    # å®¹ç©ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
    if pd.notna(row['Volume_m3']):
        g.add((equipment_uri, PROC.hasVolume,
               Literal(row['Volume_m3'], datatype=XSD.double)))

    # åŠ¹ç‡ï¼ˆå¿…é ˆï¼‰
    g.add((equipment_uri, PROC.hasEfficiency,
           Literal(row['Efficiency_pct'], datatype=XSD.double)))

    return len(g)  # ç¾åœ¨ã®ãƒˆãƒªãƒ—ãƒ«æ•°

# å…¨è¡Œã‚’å¤‰æ›
initial_count = len(g)
for idx, row in df.iterrows():
    csv_to_rdf(row)

print(f"\n=== RDFå¤‰æ›çµæœ ===")
print(f"å‡¦ç†è¡Œæ•°: {len(df)}")
print(f"ç”Ÿæˆãƒˆãƒªãƒ—ãƒ«æ•°: {len(g) - initial_count}")

# è£…ç½®ã‚¿ã‚¤ãƒ—åˆ¥é›†è¨ˆ
print("\n=== è£…ç½®ã‚¿ã‚¤ãƒ—åˆ¥çµ±è¨ˆ ===")
type_counts = df['Type'].value_counts()
for eq_type, count in type_counts.items():
    print(f"{eq_type}: {count}å€‹")

# Turtleå½¢å¼ã§å‡ºåŠ›ï¼ˆæŠœç²‹ï¼‰
print("\n=== Turtleå½¢å¼ï¼ˆæŠœç²‹ï¼‰ ===")
print(g.serialize(format="turtle")[:600])

# ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
g.serialize(destination="equipment_from_csv.ttl", format="turtle")
print("\nâœ“ RDFãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å®Œäº†: equipment_from_csv.ttl")
</code></pre>

            <div class="example-output">
                <strong>å‡ºåŠ›ä¾‹:</strong><br>
                === å…ƒã®CSVãƒ‡ãƒ¼ã‚¿ ===<br>
                &nbsp;&nbsp;EquipmentID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type&nbsp;&nbsp;&nbsp;Temperature_K&nbsp;&nbsp;Pressure_bar<br>
                0&nbsp;&nbsp;&nbsp;R-101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CSTR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;350.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.0<br>
                1&nbsp;&nbsp;&nbsp;R-102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PFR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;420.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.0<br>
                2&nbsp;&nbsp;&nbsp;HX-201&nbsp;&nbsp;&nbsp;&nbsp;HeatExchanger&nbsp;&nbsp;320.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NaN<br>
                <br>
                === RDFå¤‰æ›çµæœ ===<br>
                å‡¦ç†è¡Œæ•°: 6<br>
                ç”Ÿæˆãƒˆãƒªãƒ—ãƒ«æ•°: 28<br>
                <br>
                === è£…ç½®ã‚¿ã‚¤ãƒ—åˆ¥çµ±è¨ˆ ===<br>
                HeatExchanger: 2å€‹<br>
                CSTR: 1å€‹<br>
                PFR: 1å€‹<br>
                Separator: 1å€‹<br>
                Pump: 1å€‹<br>
                <br>
                âœ“ RDFãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å®Œäº†: equipment_from_csv.ttl
            </div>
        </section>

        <section>
            <h2>3.2 è£…ç½®æ¥ç¶šé–¢ä¿‚ã®æŠ½å‡º</h2>

            <h3>Example 2: ãƒ•ãƒ­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®é–¢ä¿‚æŠ½å‡º</h3>
            <p>ç‰©è³ªãƒ•ãƒ­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è£…ç½®é–“ã®æ¥ç¶šé–¢ä¿‚ã‚’è‡ªå‹•æŠ½å‡ºã—ã¾ã™ã€‚</p>

<pre><code># ===================================
# Example 2: ãƒ•ãƒ­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®é–¢ä¿‚æŠ½å‡º
# ===================================

import pandas as pd
from rdflib import Graph, Namespace, Literal
from rdflib.namespace import RDF, RDFS, XSD
import io

# ãƒ•ãƒ­ãƒ¼æ¥ç¶šãƒ‡ãƒ¼ã‚¿
flow_data = """StreamID,SourceEquipment,TargetEquipment,FlowRate_kgh,Composition
S-001,Feed,R-101,1000.0,åŸæ–™æ··åˆç‰©
S-002,R-101,HX-201,980.0,åå¿œç”Ÿæˆç‰©
S-003,HX-201,SEP-301,975.0,å†·å´ç”Ÿæˆç‰©
S-004,SEP-301,Product,920.0,è£½å“
S-005,SEP-301,R-101,55.0,ãƒªã‚µã‚¤ã‚¯ãƒ«"""

df_flow = pd.read_csv(io.StringIO(flow_data))

print("=== ãƒ•ãƒ­ãƒ¼ãƒ‡ãƒ¼ã‚¿ ===")
print(df_flow)

# RDFã‚°ãƒ©ãƒ•ä½œæˆ
g = Graph()
PROC = Namespace("http://example.org/process/")
g.bind("proc", PROC)

# ===== ãƒ•ãƒ­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒˆãƒªãƒ—ãƒ«ç”Ÿæˆ =====

for idx, row in df_flow.iterrows():
    # ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒˆãƒªãƒ—ãƒ«
    stream = PROC[row['StreamID']]
    g.add((stream, RDF.type, PROC.Stream))
    g.add((stream, RDFS.label, Literal(row['Composition'], lang='ja')))
    g.add((stream, PROC.hasFlowRate,
           Literal(row['FlowRate_kgh'], datatype=XSD.double)))

    # é€ä¿¡å…ƒè£…ç½®
    source = PROC[row['SourceEquipment']]
    g.add((source, PROC.hasOutput, stream))

    # é€ä¿¡å…ˆè£…ç½®
    target = PROC[row['TargetEquipment']]
    g.add((target, PROC.hasInput, stream))

    # è£…ç½®é–“ã®ç›´æ¥æ¥ç¶š
    g.add((source, PROC.connectedTo, target))

print(f"\n=== ãƒˆãƒªãƒ—ãƒ«ç”Ÿæˆçµæœ ===")
print(f"ç·ã‚¹ãƒˆãƒªãƒ¼ãƒ æ•°: {len(df_flow)}")
print(f"ç·ãƒˆãƒªãƒ—ãƒ«æ•°: {len(g)}")

# ===== æ¥ç¶šé–¢ä¿‚ã®å¯è¦–åŒ– =====
print("\n=== ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼æ¥ç¶š ===")

# SPARQLã‚¯ã‚¨ãƒªã§æ¥ç¶šã‚’å–å¾—
query = """
PREFIX proc: <http://example.org/process/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?source ?target ?stream ?flowrate ?composition
WHERE {
    ?source proc:hasOutput ?stream .
    ?target proc:hasInput ?stream .
    ?stream proc:hasFlowRate ?flowrate .
    ?stream rdfs:label ?composition .
}
ORDER BY ?source
"""

for row in g.query(query):
    source = str(row.source).split('/')[-1]
    target = str(row.target).split('/')[-1]
    print(f"{source} â†’ {target}: {float(row.flowrate):.0f} kg/h ({row.composition})")

# ãƒªã‚µã‚¤ã‚¯ãƒ«ãƒ«ãƒ¼ãƒ—ã®æ¤œå‡º
print("\n=== ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ æ¤œå‡º ===")
recycled = df_flow[df_flow['Composition'].str.contains('ãƒªã‚µã‚¤ã‚¯ãƒ«', na=False)]
for idx, row in recycled.iterrows():
    print(f"âœ“ {row['SourceEquipment']} â†’ {row['TargetEquipment']} (ãƒªã‚µã‚¤ã‚¯ãƒ«)")

g.serialize(destination="process_flow.ttl", format="turtle")
print("\nâœ“ ãƒ•ãƒ­ãƒ¼ã‚°ãƒ©ãƒ•ä¿å­˜å®Œäº†: process_flow.ttl")
</code></pre>

            <div class="example-output">
                <strong>å‡ºåŠ›ä¾‹:</strong><br>
                === ãƒ•ãƒ­ãƒ¼ãƒ‡ãƒ¼ã‚¿ ===<br>
                &nbsp;&nbsp;StreamID&nbsp;&nbsp;SourceEquipment&nbsp;&nbsp;TargetEquipment&nbsp;&nbsp;FlowRate_kgh<br>
                0&nbsp;&nbsp;S-001&nbsp;&nbsp;&nbsp;&nbsp;Feed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R-101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1000.0<br>
                1&nbsp;&nbsp;S-002&nbsp;&nbsp;&nbsp;&nbsp;R-101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HX-201&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;980.0<br>
                2&nbsp;&nbsp;S-003&nbsp;&nbsp;&nbsp;&nbsp;HX-201&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEP-301&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;975.0<br>
                <br>
                === ãƒˆãƒªãƒ—ãƒ«ç”Ÿæˆçµæœ ===<br>
                ç·ã‚¹ãƒˆãƒªãƒ¼ãƒ æ•°: 5<br>
                ç·ãƒˆãƒªãƒ—ãƒ«æ•°: 23<br>
                <br>
                === ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼æ¥ç¶š ===<br>
                Feed â†’ R-101: 1000 kg/h (åŸæ–™æ··åˆç‰©)<br>
                R-101 â†’ HX-201: 980 kg/h (åå¿œç”Ÿæˆç‰©)<br>
                HX-201 â†’ SEP-301: 975 kg/h (å†·å´ç”Ÿæˆç‰©)<br>
                SEP-301 â†’ Product: 920 kg/h (è£½å“)<br>
                SEP-301 â†’ R-101: 55 kg/h (ãƒªã‚µã‚¤ã‚¯ãƒ«)<br>
                <br>
                === ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ æ¤œå‡º ===<br>
                âœ“ SEP-301 â†’ R-101 (ãƒªã‚µã‚¤ã‚¯ãƒ«)<br>
                <br>
                âœ“ ãƒ•ãƒ­ãƒ¼ã‚°ãƒ©ãƒ•ä¿å­˜å®Œäº†: process_flow.ttl
            </div>

            <div class="mermaid">
graph LR
    Feed[åŸæ–™] -->|S-001<br/>1000 kg/h| R101[R-101<br/>åå¿œå™¨]
    R101 -->|S-002<br/>980 kg/h| HX201[HX-201<br/>å†·å´å™¨]
    HX201 -->|S-003<br/>975 kg/h| SEP301[SEP-301<br/>åˆ†é›¢å™¨]
    SEP301 -->|S-004<br/>920 kg/h| Product[è£½å“]
    SEP301 -.->|S-005<br/>55 kg/h<br/>ãƒªã‚µã‚¤ã‚¯ãƒ«| R101

    style Feed fill:#e3f2fd
    style Product fill:#e8f5e9
    style R101 fill:#fff3e0
    style HX201 fill:#f3e5f5
    style SEP301 fill:#fce4ec
            </div>

            <h3>Example 3: pandasã‹ã‚‰ã®è‡ªå‹•ãƒˆãƒªãƒ—ãƒ«ç”Ÿæˆ</h3>
            <p>æ±ç”¨çš„ãªDataFrameã‹ã‚‰RDFã¸ã®å¤‰æ›é–¢æ•°ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

<pre><code># ===================================
# Example 3: æ±ç”¨DataFrameâ†’RDFå¤‰æ›
# ===================================

import pandas as pd
from rdflib import Graph, Namespace, Literal, URIRef
from rdflib.namespace import RDF, RDFS, XSD
import io

def dataframe_to_rdf(df, namespace_uri, entity_column, type_name=None):
    """pandasãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’RDFã‚°ãƒ©ãƒ•ã«å¤‰æ›

    Args:
        df: pandas DataFrame
        namespace_uri: åå‰ç©ºé–“URI
        entity_column: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£IDã¨ãªã‚‹åˆ—å
        type_name: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã‚¯ãƒ©ã‚¹åï¼ˆNoneã®å ´åˆã¯'Entity'ï¼‰

    Returns:
        rdflib.Graph: RDFã‚°ãƒ©ãƒ•
    """
    g = Graph()
    NS = Namespace(namespace_uri)
    g.bind("data", NS)

    type_name = type_name or "Entity"

    for idx, row in df.iterrows():
        # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£URI
        entity_id = str(row[entity_column])
        entity_uri = NS[entity_id]

        # ã‚¿ã‚¤ãƒ—ãƒˆãƒªãƒ—ãƒ«
        g.add((entity_uri, RDF.type, NS[type_name]))

        # å„ã‚«ãƒ©ãƒ ã‚’ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦è¿½åŠ 
        for col in df.columns:
            if col == entity_column:
                continue  # IDã‚«ãƒ©ãƒ ã¯ã‚¹ã‚­ãƒƒãƒ—

            value = row[col]
            if pd.isna(value):
                continue  # æ¬ æå€¤ã¯ã‚¹ã‚­ãƒƒãƒ—

            # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£URI
            prop_uri = NS[col]

            # ãƒ‡ãƒ¼ã‚¿å‹ã®åˆ¤å®šã¨é©åˆ‡ãªãƒªãƒ†ãƒ©ãƒ«ç”Ÿæˆ
            if isinstance(value, (int, float)):
                g.add((entity_uri, prop_uri,
                       Literal(value, datatype=XSD.double)))
            elif isinstance(value, bool):
                g.add((entity_uri, prop_uri,
                       Literal(value, datatype=XSD.boolean)))
            else:
                g.add((entity_uri, prop_uri, Literal(str(value))))

    return g

# ===== ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ =====

sensor_data = """SensorID,Location,Type,Value,Unit,Timestamp
TE-101,R-101,Temperature,77.5,degC,2025-10-26 10:00:00
PE-101,R-101,Pressure,5.2,bar,2025-10-26 10:00:00
FE-201,HX-201,FlowRate,980.0,kg/h,2025-10-26 10:00:00
TE-201,HX-201,Temperature,45.3,degC,2025-10-26 10:00:00"""

df_sensor = pd.read_csv(io.StringIO(sensor_data))

print("=== ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ ===")
print(df_sensor)

# RDFå¤‰æ›
g_sensor = dataframe_to_rdf(
    df_sensor,
    namespace_uri="http://example.org/sensor/",
    entity_column="SensorID",
    type_name="Sensor"
)

print(f"\n=== RDFå¤‰æ›çµæœ ===")
print(f"ã‚»ãƒ³ã‚µãƒ¼æ•°: {len(df_sensor)}")
print(f"ç·ãƒˆãƒªãƒ—ãƒ«æ•°: {len(g_sensor)}")

# SPARQLã‚¯ã‚¨ãƒªã§ãƒ‡ãƒ¼ã‚¿ç¢ºèª
query = """
PREFIX data: <http://example.org/sensor/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?sensor ?location ?type ?value ?unit
WHERE {
    ?sensor rdf:type data:Sensor .
    ?sensor data:Location ?location .
    ?sensor data:Type ?type .
    ?sensor data:Value ?value .
    ?sensor data:Unit ?unit .
}
"""

print("\n=== ã‚»ãƒ³ã‚µãƒ¼æƒ…å ±ä¸€è¦§ ===")
for row in g_sensor.query(query):
    sensor = str(row.sensor).split('/')[-1]
    print(f"{sensor} @ {row.location}: {row.type} = {float(row.value):.1f} {row.unit}")

# Turtleå‡ºåŠ›
print("\n=== Turtleå½¢å¼ï¼ˆæŠœç²‹ï¼‰ ===")
turtle_output = g_sensor.serialize(format="turtle")
print(turtle_output[:400])

g_sensor.serialize(destination="sensor_data.ttl", format="turtle")
print("\nâœ“ ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿RDFä¿å­˜å®Œäº†: sensor_data.ttl")
</code></pre>

            <div class="example-output">
                <strong>å‡ºåŠ›ä¾‹:</strong><br>
                === ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ ===<br>
                &nbsp;&nbsp;SensorID&nbsp;&nbsp;Location&nbsp;&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&nbsp;&nbsp;Unit<br>
                0&nbsp;&nbsp;TE-101&nbsp;&nbsp;&nbsp;&nbsp;R-101&nbsp;&nbsp;&nbsp;&nbsp;Temperature&nbsp;&nbsp;77.5&nbsp;&nbsp;degC<br>
                1&nbsp;&nbsp;PE-101&nbsp;&nbsp;&nbsp;&nbsp;R-101&nbsp;&nbsp;&nbsp;&nbsp;Pressure&nbsp;&nbsp;&nbsp;&nbsp;5.2&nbsp;&nbsp;&nbsp;bar<br>
                2&nbsp;&nbsp;FE-201&nbsp;&nbsp;&nbsp;&nbsp;HX-201&nbsp;&nbsp;&nbsp;&nbsp;FlowRate&nbsp;&nbsp;&nbsp;&nbsp;980.0&nbsp;&nbsp;kg/h<br>
                <br>
                === RDFå¤‰æ›çµæœ ===<br>
                ã‚»ãƒ³ã‚µãƒ¼æ•°: 4<br>
                ç·ãƒˆãƒªãƒ—ãƒ«æ•°: 25<br>
                <br>
                === ã‚»ãƒ³ã‚µãƒ¼æƒ…å ±ä¸€è¦§ ===<br>
                TE-101 @ R-101: Temperature = 77.5 degC<br>
                PE-101 @ R-101: Pressure = 5.2 bar<br>
                FE-201 @ HX-201: FlowRate = 980.0 kg/h<br>
                TE-201 @ HX-201: Temperature = 45.3 degC<br>
                <br>
                âœ“ ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿RDFä¿å­˜å®Œäº†: sensor_data.ttl
            </div>
        </section>

        <section>
            <h2>3.3 P&IDãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã®çŸ¥è­˜æŠ½å‡º</h2>

            <h3>Example 4: P&IDè¨˜è¿°ã®ãƒ‘ãƒ¼ã‚¹ã¨çŸ¥è­˜æŠ½å‡º</h3>
            <p>P&IDï¼ˆé…ç®¡è¨ˆè£…å›³ï¼‰ã®æ–‡å­—æƒ…å ±ã‹ã‚‰è£…ç½®æ¥ç¶šã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¾ã™ã€‚</p>

<pre><code># ===================================
# Example 4: P&IDè¨˜è¿°ã®ãƒ‘ãƒ¼ã‚¹ã¨çŸ¥è­˜æŠ½å‡º
# ===================================

import re
from rdflib import Graph, Namespace, Literal
from rdflib.namespace import RDF, RDFS

# P&IDè¨˜è¿°ãƒ†ã‚­ã‚¹ãƒˆï¼ˆç°¡æ˜“DSLå½¢å¼ï¼‰
pid_text = """
# ã‚¨ã‚¹ãƒ†ãƒ«åŒ–ãƒ—ãƒ©ãƒ³ãƒˆP&ID

[EQUIPMENT]
R-101: Type=CSTR, Name=ä¸»åå¿œå™¨, Temp=350K, Press=5bar, Vol=10m3
HX-201: Type=HeatExchanger, Name=å†·å´å™¨, Temp=320K
HX-202: Type=HeatExchanger, Name=åŠ ç†±å™¨, Temp=450K
SEP-301: Type=Separator, Name=è’¸ç•™å¡”, Temp=340K, Press=1.5bar
P-401: Type=Pump, Name=ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒ³ãƒ—

[CONNECTIONS]
Feed -> P-401 (S-001, 1000kg/h)
P-401 -> R-101 (S-002, 1000kg/h)
R-101 -> HX-201 (S-003, 980kg/h)
HX-201 -> SEP-301 (S-004, 975kg/h)
SEP-301 -> Product (S-005, 920kg/h)
SEP-301 -> HX-202 (S-006, 55kg/h, recycle)
HX-202 -> R-101 (S-007, 55kg/h)
"""

# ===== ãƒ‘ãƒ¼ã‚µãƒ¼é–¢æ•° =====

def parse_equipment_line(line):
    """è£…ç½®å®šç¾©è¡Œã‚’ãƒ‘ãƒ¼ã‚¹"""
    match = re.match(r'(\S+):\s*(.+)', line)
    if not match:
        return None

    eq_id = match.group(1)
    params_str = match.group(2)

    # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡º
    params = {}
    for param in params_str.split(','):
        param = param.strip()
        if '=' in param:
            key, value = param.split('=', 1)
            params[key.strip()] = value.strip()

    return eq_id, params

def parse_connection_line(line):
    """æ¥ç¶šè¡Œã‚’ãƒ‘ãƒ¼ã‚¹"""
    # ä¾‹: "Feed -> P-401 (S-001, 1000kg/h)"
    match = re.match(r'(\S+)\s*->\s*(\S+)\s*\(([^)]+)\)', line)
    if not match:
        return None

    source = match.group(1)
    target = match.group(2)
    stream_info = match.group(3)

    # ã‚¹ãƒˆãƒªãƒ¼ãƒ æƒ…å ±ã®æŠ½å‡º
    stream_parts = [p.strip() for p in stream_info.split(',')]
    stream_id = stream_parts[0]
    flowrate = stream_parts[1] if len(stream_parts) > 1 else None
    is_recycle = 'recycle' in stream_info.lower()

    return source, target, stream_id, flowrate, is_recycle

# ===== P&IDãƒ†ã‚­ã‚¹ãƒˆã®ãƒ‘ãƒ¼ã‚¹ =====

g = Graph()
PROC = Namespace("http://example.org/process/")
g.bind("proc", PROC)

lines = pid_text.strip().split('\n')
section = None

equipment_count = 0
connection_count = 0

for line in lines:
    line = line.strip()
    if not line or line.startswith('#'):
        continue

    if line.startswith('[EQUIPMENT]'):
        section = 'equipment'
        continue
    elif line.startswith('[CONNECTIONS]'):
        section = 'connections'
        continue

    if section == 'equipment':
        parsed = parse_equipment_line(line)
        if parsed:
            eq_id, params = parsed
            eq_uri = PROC[eq_id]

            # RDFãƒˆãƒªãƒ—ãƒ«ç”Ÿæˆ
            if 'Type' in params:
                g.add((eq_uri, RDF.type, PROC[params['Type']]))
            if 'Name' in params:
                g.add((eq_uri, RDFS.label, Literal(params['Name'], lang='ja')))

            equipment_count += 1

    elif section == 'connections':
        parsed = parse_connection_line(line)
        if parsed:
            source, target, stream_id, flowrate, is_recycle = parsed

            # ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒˆãƒªãƒ—ãƒ«
            stream_uri = PROC[stream_id]
            g.add((stream_uri, RDF.type, PROC.Stream))

            if flowrate:
                # "1000kg/h" ã‹ã‚‰æ•°å€¤æŠ½å‡º
                flow_value = re.search(r'(\d+)', flowrate)
                if flow_value:
                    g.add((stream_uri, PROC.hasFlowRate,
                           Literal(float(flow_value.group(1)))))

            # æ¥ç¶šãƒˆãƒªãƒ—ãƒ«
            source_uri = PROC[source]
            target_uri = PROC[target]
            g.add((source_uri, PROC.hasOutput, stream_uri))
            g.add((target_uri, PROC.hasInput, stream_uri))

            if is_recycle:
                g.add((stream_uri, PROC.isRecycle, Literal(True)))

            connection_count += 1

print("=== P&IDãƒ‘ãƒ¼ã‚¹çµæœ ===")
print(f"è£…ç½®æ•°: {equipment_count}")
print(f"æ¥ç¶šæ•°: {connection_count}")
print(f"ç·ãƒˆãƒªãƒ—ãƒ«æ•°: {len(g)}")

# è£…ç½®ãƒªã‚¹ãƒˆ
print("\n=== è£…ç½®ä¸€è¦§ ===")
query_eq = """
PREFIX proc: <http://example.org/process/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?eq ?label
WHERE {
    ?eq rdfs:label ?label .
}
"""
for row in g.query(query_eq):
    eq_id = str(row.eq).split('/')[-1]
    print(f"- {eq_id}: {row.label}")

# ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ 
print("\n=== ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ  ===")
query_recycle = """
PREFIX proc: <http://example.org/process/>

SELECT ?stream
WHERE {
    ?stream proc:isRecycle true .
}
"""
recycle_streams = list(g.query(query_recycle))
print(f"ãƒªã‚µã‚¤ã‚¯ãƒ«æ•°: {len(recycle_streams)}")
for row in recycle_streams:
    print(f"âœ“ {str(row.stream).split('/')[-1]}")

g.serialize(destination="pid_knowledge.ttl", format="turtle")
print("\nâœ“ P&IDãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ä¿å­˜å®Œäº†: pid_knowledge.ttl")
</code></pre>

            <div class="example-output">
                <strong>å‡ºåŠ›ä¾‹:</strong><br>
                === P&IDãƒ‘ãƒ¼ã‚¹çµæœ ===<br>
                è£…ç½®æ•°: 5<br>
                æ¥ç¶šæ•°: 7<br>
                ç·ãƒˆãƒªãƒ—ãƒ«æ•°: 38<br>
                <br>
                === è£…ç½®ä¸€è¦§ ===<br>
                - R-101: ä¸»åå¿œå™¨<br>
                - HX-201: å†·å´å™¨<br>
                - HX-202: åŠ ç†±å™¨<br>
                - SEP-301: è’¸ç•™å¡”<br>
                - P-401: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒ³ãƒ—<br>
                <br>
                === ãƒªã‚µã‚¤ã‚¯ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ  ===<br>
                ãƒªã‚µã‚¤ã‚¯ãƒ«æ•°: 1<br>
                âœ“ S-006<br>
                <br>
                âœ“ P&IDãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ä¿å­˜å®Œäº†: pid_knowledge.ttl
            </div>

            <div class="tip-box">
                <p><strong>ğŸ’¡ P&IDãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®æ‹¡å¼µ</strong></p>
                <p>å®Ÿå‹™ã§ã¯ã€P&IDã¯CADã‚½ãƒ•ãƒˆï¼ˆAutoCAD Plant 3Dã€Intergraph SmartPlantç­‰ï¼‰ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã¯XML/JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’æŒã¡ã€åŒæ§˜ã®æ–¹æ³•ã§çŸ¥è­˜æŠ½å‡ºãŒå¯èƒ½ã§ã™ã€‚</p>
            </div>
        </section>

        <section>
            <h2>3.4 ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®RDFåŒ–</h2>

            <h3>Example 5: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®RDFå¤‰æ›</h3>
            <p>æ™‚ç³»åˆ—ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’RDFã§è¡¨ç¾ã—ã€æ™‚é–“æƒ…å ±ã‚’ä¿æŒã—ã¾ã™ã€‚</p>

<pre><code># ===================================
# Example 5: ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®RDFå¤‰æ›
# ===================================

import pandas as pd
from rdflib import Graph, Namespace, Literal
from rdflib.namespace import RDF, RDFS, XSD
from datetime import datetime, timedelta
import numpy as np

# æ™‚ç³»åˆ—ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ
base_time = datetime(2025, 10, 26, 10, 0, 0)
time_points = [base_time + timedelta(minutes=5*i) for i in range(12)]

# ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆ1æ™‚é–“åˆ†ã€5åˆ†é–“éš”ï¼‰
sensor_stream = pd.DataFrame({
    'Timestamp': time_points,
    'TE-101_degC': 77.5 + np.random.normal(0, 0.5, 12),  # æ¸©åº¦
    'PE-101_bar': 5.0 + np.random.normal(0, 0.1, 12),    # åœ§åŠ›
    'FE-101_kgh': 1000 + np.random.normal(0, 10, 12),    # æµé‡
})

print("=== ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ï¼ˆæŠœç²‹ï¼‰ ===")
print(sensor_stream.head(3))

# RDFã‚°ãƒ©ãƒ•ä½œæˆ
g = Graph()
SENSOR = Namespace("http://example.org/sensor/")
TIME = Namespace("http://www.w3.org/2006/time#")
g.bind("sensor", SENSOR)
g.bind("time", TIME)

# ===== æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®RDFå¤‰æ› =====

for idx, row in sensor_stream.iterrows():
    # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    timestamp = row['Timestamp']
    instant_uri = SENSOR[f"Instant_{idx}"]

    g.add((instant_uri, RDF.type, TIME.Instant))
    g.add((instant_uri, TIME.inXSDDateTime,
           Literal(timestamp.isoformat(), datatype=XSD.dateTime)))

    # å„ã‚»ãƒ³ã‚µãƒ¼å€¤
    for col in ['TE-101_degC', 'PE-101_bar', 'FE-101_kgh']:
        sensor_id, unit = col.rsplit('_', 1)
        measurement_uri = SENSOR[f"{sensor_id}_M{idx}"]

        # æ¸¬å®šãƒˆãƒªãƒ—ãƒ«
        g.add((measurement_uri, RDF.type, SENSOR.Measurement))
        g.add((measurement_uri, SENSOR.sensor, SENSOR[sensor_id]))
        g.add((measurement_uri, SENSOR.hasTimestamp, instant_uri))
        g.add((measurement_uri, SENSOR.hasValue,
               Literal(row[col], datatype=XSD.double)))
        g.add((measurement_uri, SENSOR.hasUnit, Literal(unit)))

print(f"\n=== RDFå¤‰æ›çµæœ ===")
print(f"æ™‚é–“ãƒã‚¤ãƒ³ãƒˆæ•°: {len(sensor_stream)}")
print(f"ç·ãƒˆãƒªãƒ—ãƒ«æ•°: {len(g)}")

# ===== SPARQLã‚¯ã‚¨ãƒªï¼šæ¸©åº¦ã®çµ±è¨ˆ =====

query_stats = """
PREFIX sensor: <http://example.org/sensor/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT (AVG(?value) AS ?avgTemp) (MIN(?value) AS ?minTemp) (MAX(?value) AS ?maxTemp)
WHERE {
    ?measurement sensor:sensor sensor:TE-101 .
    ?measurement sensor:hasValue ?value .
}
"""

print("\n=== æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼TE-101ã®çµ±è¨ˆï¼ˆ1æ™‚é–“ï¼‰ ===")
for row in g.query(query_stats):
    print(f"å¹³å‡æ¸©åº¦: {float(row.avgTemp):.2f}Â°C")
    print(f"æœ€ä½æ¸©åº¦: {float(row.minTemp):.2f}Â°C")
    print(f"æœ€é«˜æ¸©åº¦: {float(row.maxTemp):.2f}Â°C")

# ===== ç•°å¸¸å€¤æ¤œå‡ºï¼ˆé–¾å€¤ãƒ™ãƒ¼ã‚¹ï¼‰ =====

query_anomaly = """
PREFIX sensor: <http://example.org/sensor/>
PREFIX time: <http://www.w3.org/2006/time#>

SELECT ?timestamp ?value
WHERE {
    ?measurement sensor:sensor sensor:TE-101 .
    ?measurement sensor:hasValue ?value .
    ?measurement sensor:hasTimestamp ?instant .
    ?instant time:inXSDDateTime ?timestamp .
    FILTER (?value > 78.5 || ?value < 76.5)
}
ORDER BY ?timestamp
"""

print("\n=== æ¸©åº¦ç•°å¸¸æ¤œå‡ºï¼ˆé–¾å€¤: 76.5-78.5Â°Cï¼‰ ===")
anomalies = list(g.query(query_anomaly))
print(f"ç•°å¸¸ãƒ‡ãƒ¼ã‚¿æ•°: {len(anomalies)}")
for row in anomalies[:3]:  # æœ€åˆã®3ä»¶
    print(f"{row.timestamp}: {float(row.value):.2f}Â°C")

g.serialize(destination="sensor_stream.ttl", format="turtle")
print("\nâœ“ ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ RDFä¿å­˜å®Œäº†: sensor_stream.ttl")
</code></pre>

            <div class="example-output">
                <strong>å‡ºåŠ›ä¾‹:</strong><br>
                === ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ï¼ˆæŠœç²‹ï¼‰ ===<br>
                &nbsp;&nbsp;Timestamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TE-101_degC&nbsp;&nbsp;PE-101_bar&nbsp;&nbsp;FE-101_kgh<br>
                0&nbsp;&nbsp;2025-10-26 10:00:00&nbsp;&nbsp;77.45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;998.3<br>
                1&nbsp;&nbsp;2025-10-26 10:05:00&nbsp;&nbsp;77.58&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.98&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1005.1<br>
                2&nbsp;&nbsp;2025-10-26 10:10:00&nbsp;&nbsp;77.32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;995.7<br>
                <br>
                === RDFå¤‰æ›çµæœ ===<br>
                æ™‚é–“ãƒã‚¤ãƒ³ãƒˆæ•°: 12<br>
                ç·ãƒˆãƒªãƒ—ãƒ«æ•°: 182<br>
                <br>
                === æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼TE-101ã®çµ±è¨ˆï¼ˆ1æ™‚é–“ï¼‰ ===<br>
                å¹³å‡æ¸©åº¦: 77.48Â°C<br>
                æœ€ä½æ¸©åº¦: 76.85Â°C<br>
                æœ€é«˜æ¸©åº¦: 78.12Â°C<br>
                <br>
                === æ¸©åº¦ç•°å¸¸æ¤œå‡ºï¼ˆé–¾å€¤: 76.5-78.5Â°Cï¼‰ ===<br>
                ç•°å¸¸ãƒ‡ãƒ¼ã‚¿æ•°: 2<br>
                2025-10-26T10:20:00: 78.67Â°C<br>
                2025-10-26T10:45:00: 76.32Â°C<br>
                <br>
                âœ“ ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ RDFä¿å­˜å®Œäº†: sensor_stream.ttl
            </div>
        </section>

        <section>
            <h2>3.5 æ­´å²çš„ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆ</h2>

            <h3>Example 6: æ­´å²çš„é‹è»¢ãƒ‡ãƒ¼ã‚¿ã¨ã®çµ±åˆ</h3>
            <p>éå»ã®é‹è»¢å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦çµ±åˆã—ã¾ã™ã€‚</p>

<pre><code># ===================================
# Example 6: æ­´å²çš„ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆ
# ===================================

import pandas as pd
from rdflib import Graph, Namespace, Literal
from rdflib.namespace import RDF, RDFS, XSD
from datetime import datetime, timedelta
import numpy as np

# æ­´å²çš„é‹è»¢ãƒ‡ãƒ¼ã‚¿ï¼ˆ1ãƒ¶æœˆåˆ†ã®æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ï¼‰
dates = pd.date_range(start='2025-09-26', end='2025-10-25', freq='D')

historical_data = pd.DataFrame({
    'Date': dates,
    'R101_Conversion': np.random.uniform(0.88, 0.95, len(dates)),  # è»¢åŒ–ç‡
    'R101_Yield': np.random.uniform(0.85, 0.92, len(dates)),       # åç‡
    'R101_Temp_avg': np.random.uniform(348, 352, len(dates)),      # å¹³å‡æ¸©åº¦
    'R101_Uptime_pct': np.random.uniform(95, 100, len(dates)),     # ç¨¼åƒç‡
})

print("=== æ­´å²çš„é‹è»¢ãƒ‡ãƒ¼ã‚¿ï¼ˆç›´è¿‘7æ—¥ï¼‰ ===")
print(historical_data.tail(7)[['Date', 'R101_Conversion', 'R101_Yield']])

# RDFã‚°ãƒ©ãƒ•ä½œæˆ
g = Graph()
PROC = Namespace("http://example.org/process/")
PERF = Namespace("http://example.org/performance/")
g.bind("proc", PROC)
g.bind("perf", PERF)

# åå¿œå™¨R-101ã®å®šç¾©
r101 = PROC["R-101"]
g.add((r101, RDF.type, PROC.Reactor))
g.add((r101, RDFS.label, Literal("ä¸»åå¿œå™¨R-101", lang='ja')))

# ===== æ­´å²çš„ãƒ‡ãƒ¼ã‚¿ã‚’RDFã«å¤‰æ› =====

for idx, row in historical_data.iterrows():
    date = row['Date']
    date_str = date.strftime('%Y-%m-%d')

    # æ—¥æ¬¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨˜éŒ²
    record_uri = PERF[f"R101_Daily_{date_str}"]

    g.add((record_uri, RDF.type, PERF.DailyPerformance))
    g.add((record_uri, PERF.equipment, r101))
    g.add((record_uri, PERF.date,
           Literal(date_str, datatype=XSD.date)))

    # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™
    g.add((record_uri, PERF.conversion,
           Literal(row['R101_Conversion'], datatype=XSD.double)))
    g.add((record_uri, PERF.yieldValue,
           Literal(row['R101_Yield'], datatype=XSD.double)))
    g.add((record_uri, PERF.avgTemperature,
           Literal(row['R101_Temp_avg'], datatype=XSD.double)))
    g.add((record_uri, PERF.uptime,
           Literal(row['R101_Uptime_pct'], datatype=XSD.double)))

print(f"\n=== RDFå¤‰æ›çµæœ ===")
print(f"æ—¥æ¬¡è¨˜éŒ²æ•°: {len(historical_data)}")
print(f"ç·ãƒˆãƒªãƒ—ãƒ«æ•°: {len(g)}")

# ===== çµ±è¨ˆåˆ†æã‚¯ã‚¨ãƒª =====

query_monthly_stats = """
PREFIX perf: <http://example.org/performance/>

SELECT
    (AVG(?conv) AS ?avgConversion)
    (AVG(?yield) AS ?avgYield)
    (AVG(?temp) AS ?avgTemp)
    (AVG(?uptime) AS ?avgUptime)
    (MIN(?conv) AS ?minConversion)
    (MAX(?conv) AS ?maxConversion)
WHERE {
    ?record a perf:DailyPerformance .
    ?record perf:conversion ?conv .
    ?record perf:yieldValue ?yield .
    ?record perf:avgTemperature ?temp .
    ?record perf:uptime ?uptime .
}
"""

print("\n=== æœˆé–“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆï¼ˆR-101ï¼‰ ===")
for row in g.query(query_monthly_stats):
    print(f"å¹³å‡è»¢åŒ–ç‡: {float(row.avgConversion) * 100:.2f}%")
    print(f"å¹³å‡åç‡: {float(row.avgYield) * 100:.2f}%")
    print(f"å¹³å‡æ¸©åº¦: {float(row.avgTemp):.1f}K ({float(row.avgTemp) - 273.15:.1f}Â°C)")
    print(f"å¹³å‡ç¨¼åƒç‡: {float(row.avgUptime):.2f}%")
    print(f"è»¢åŒ–ç‡ç¯„å›²: {float(row.minConversion) * 100:.2f}% - {float(row.maxConversion) * 100:.2f}%")

# ===== ä½æ€§èƒ½æ—¥ã®æ¤œå‡º =====

query_low_performance = """
PREFIX perf: <http://example.org/performance/>

SELECT ?date ?conv ?yield
WHERE {
    ?record a perf:DailyPerformance .
    ?record perf:date ?date .
    ?record perf:conversion ?conv .
    ?record perf:yieldValue ?yield .
    FILTER (?conv < 0.90 || ?yield < 0.87)
}
ORDER BY ?date
"""

print("\n=== æ€§èƒ½ä½ä¸‹æ—¥ï¼ˆè»¢åŒ–ç‡<90% or åç‡<87%ï¼‰ ===")
low_perf_days = list(g.query(query_low_performance))
print(f"è©²å½“æ—¥æ•°: {len(low_perf_days)}")
for row in low_perf_days[:3]:  # æœ€åˆã®3ä»¶
    print(f"{row.date}: è»¢åŒ–ç‡{float(row.conv) * 100:.1f}%, åç‡{float(row.yield) * 100:.1f}%")

g.serialize(destination="historical_performance.ttl", format="turtle")
print("\nâœ“ æ­´å²çš„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿RDFä¿å­˜å®Œäº†: historical_performance.ttl")
</code></pre>

            <div class="example-output">
                <strong>å‡ºåŠ›ä¾‹:</strong><br>
                === æ­´å²çš„é‹è»¢ãƒ‡ãƒ¼ã‚¿ï¼ˆç›´è¿‘7æ—¥ï¼‰ ===<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date&nbsp;&nbsp;R101_Conversion&nbsp;&nbsp;R101_Yield<br>
                23&nbsp;&nbsp;2025-10-19&nbsp;&nbsp;&nbsp;0.9245&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.8932<br>
                24&nbsp;&nbsp;2025-10-20&nbsp;&nbsp;&nbsp;0.9012&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.8765<br>
                25&nbsp;&nbsp;2025-10-21&nbsp;&nbsp;&nbsp;0.9356&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.9087<br>
                <br>
                === RDFå¤‰æ›çµæœ ===<br>
                æ—¥æ¬¡è¨˜éŒ²æ•°: 30<br>
                ç·ãƒˆãƒªãƒ—ãƒ«æ•°: 152<br>
                <br>
                === æœˆé–“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆï¼ˆR-101ï¼‰ ===<br>
                å¹³å‡è»¢åŒ–ç‡: 91.48%<br>
                å¹³å‡åç‡: 88.72%<br>
                å¹³å‡æ¸©åº¦: 350.2K (77.0Â°C)<br>
                å¹³å‡ç¨¼åƒç‡: 97.45%<br>
                è»¢åŒ–ç‡ç¯„å›²: 88.23% - 94.87%<br>
                <br>
                === æ€§èƒ½ä½ä¸‹æ—¥ï¼ˆè»¢åŒ–ç‡<90% or åç‡<87%ï¼‰ ===<br>
                è©²å½“æ—¥æ•°: 4<br>
                2025-09-28: è»¢åŒ–ç‡89.5%, åç‡86.3%<br>
                2025-10-05: è»¢åŒ–ç‡88.8%, åç‡85.9%<br>
                2025-10-12: è»¢åŒ–ç‡89.2%, åç‡86.7%<br>
                <br>
                âœ“ æ­´å²çš„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿RDFä¿å­˜å®Œäº†: historical_performance.ttl
            </div>

            <div class="warning-box">
                <p><strong>âš ï¸ å¤§è¦æ¨¡æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„</strong></p>
                <p>æ•°å¹´åˆ†ã®ç§’å˜ä½ãƒ‡ãƒ¼ã‚¿ï¼ˆæ•°å„„ãƒˆãƒªãƒ—ãƒ«ï¼‰ã®å ´åˆã€ãƒˆãƒªãƒ—ãƒ«ã‚¹ãƒˆã‚¢ï¼ˆApache Jena Fusekiã€Virtuosoï¼‰ã®åˆ©ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚rdflibã¯ä¸­è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆã€œ100ä¸‡ãƒˆãƒªãƒ—ãƒ«ï¼‰ã¾ã§å®Ÿç”¨çš„ã§ã™ã€‚</p>
            </div>
        </section>

        <section>
            <h2>3.6 ãƒãƒ«ãƒã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•</h2>

            <h3>Example 7: å®Œå…¨ãªçµ±åˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã®æ§‹ç¯‰</h3>
            <p>ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’çµ±åˆã—ãŸåŒ…æ‹¬çš„ãªãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>

<pre><code># ===================================
# Example 7: ãƒãƒ«ãƒã‚½ãƒ¼ã‚¹çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•
# ===================================

import pandas as pd
from rdflib import Graph, Namespace, Literal
from rdflib.namespace import RDF, RDFS, XSD, OWL
from datetime import datetime
import io

# ===== è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®å®šç¾© =====

# 1. è£…ç½®ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
equipment_csv = """EquipmentID,Type,Name,InstallDate,Manufacturer
R-101,CSTR,ä¸»åå¿œå™¨,2020-03-15,Mitsubishi Chemical
HX-201,HeatExchanger,å†·å´å™¨,2020-04-01,Kobe Steel
SEP-301,Separator,è’¸ç•™å¡”,2020-05-10,Sumitomo Heavy"""

# 2. ç¾åœ¨ã®é‹è»¢æ¡ä»¶
operating_csv = """EquipmentID,Temperature_K,Pressure_bar,FlowRate_kgh,Efficiency_pct
R-101,350.5,5.1,1005.0,92.8
HX-201,320.2,5.0,980.0,89.5
SEP-301,340.0,1.5,975.0,95.2"""

# 3. æ¥ç¶šæƒ…å ±
connection_csv = """StreamID,Source,Target,FlowRate_kgh
S-001,Feed,R-101,1000.0
S-002,R-101,HX-201,980.0
S-003,HX-201,SEP-301,975.0
S-004,SEP-301,Product,920.0"""

# ===== çµ±åˆRDFã‚°ãƒ©ãƒ•ã®æ§‹ç¯‰ =====

g = Graph()
PROC = Namespace("http://example.org/process/")
MAINT = Namespace("http://example.org/maintenance/")
g.bind("proc", PROC)
g.bind("maint", MAINT)

# ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ èª­ã¿è¾¼ã¿
df_equipment = pd.read_csv(io.StringIO(equipment_csv))
df_operating = pd.read_csv(io.StringIO(operating_csv))
df_connection = pd.read_csv(io.StringIO(connection_csv))

print("=== ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹çµ±åˆ ===")
print(f"è£…ç½®ãƒã‚¹ã‚¿ãƒ¼: {len(df_equipment)}ä»¶")
print(f"é‹è»¢ãƒ‡ãƒ¼ã‚¿: {len(df_operating)}ä»¶")
print(f"æ¥ç¶šãƒ‡ãƒ¼ã‚¿: {len(df_connection)}ä»¶")

# ===== 1. è£…ç½®ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆ =====

for idx, row in df_equipment.iterrows():
    eq_uri = PROC[row['EquipmentID']]

    g.add((eq_uri, RDF.type, PROC[row['Type']]))
    g.add((eq_uri, RDFS.label, Literal(row['Name'], lang='ja')))
    g.add((eq_uri, MAINT.installDate,
           Literal(row['InstallDate'], datatype=XSD.date)))
    g.add((eq_uri, MAINT.manufacturer, Literal(row['Manufacturer'])))

# ===== 2. é‹è»¢æ¡ä»¶ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆ =====

current_time = datetime.now()

for idx, row in df_operating.iterrows():
    eq_uri = PROC[row['EquipmentID']]

    # ç¾åœ¨ã®é‹è»¢çŠ¶æ…‹
    state_uri = PROC[f"{row['EquipmentID']}_State_{current_time.strftime('%Y%m%d')}"]
    g.add((state_uri, RDF.type, PROC.OperatingState))
    g.add((state_uri, PROC.equipment, eq_uri))
    g.add((state_uri, PROC.timestamp,
           Literal(current_time.isoformat(), datatype=XSD.dateTime)))

    # é‹è»¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    g.add((state_uri, PROC.temperature,
           Literal(row['Temperature_K'], datatype=XSD.double)))
    g.add((state_uri, PROC.pressure,
           Literal(row['Pressure_bar'], datatype=XSD.double)))
    g.add((state_uri, PROC.flowRate,
           Literal(row['FlowRate_kgh'], datatype=XSD.double)))
    g.add((state_uri, PROC.efficiency,
           Literal(row['Efficiency_pct'], datatype=XSD.double)))

# ===== 3. æ¥ç¶šæƒ…å ±ã®çµ±åˆ =====

for idx, row in df_connection.iterrows():
    stream_uri = PROC[row['StreamID']]
    source_uri = PROC[row['Source']]
    target_uri = PROC[row['Target']]

    g.add((stream_uri, RDF.type, PROC.Stream))
    g.add((stream_uri, PROC.flowRate,
           Literal(row['FlowRate_kgh'], datatype=XSD.double)))

    g.add((source_uri, PROC.hasOutput, stream_uri))
    g.add((target_uri, PROC.hasInput, stream_uri))
    g.add((source_uri, PROC.connectedTo, target_uri))

print(f"\n=== çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ• ===")
print(f"ç·ãƒˆãƒªãƒ—ãƒ«æ•°: {len(g)}")

# ===== çµ±åˆãƒ‡ãƒ¼ã‚¿ã®ã‚¯ã‚¨ãƒª =====

# ã‚¯ã‚¨ãƒª1: è£…ç½®ã®å®Œå…¨æƒ…å ±ï¼ˆãƒã‚¹ã‚¿ãƒ¼ + é‹è»¢çŠ¶æ…‹ï¼‰
query_complete = """
PREFIX proc: <http://example.org/process/>
PREFIX maint: <http://example.org/maintenance/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?id ?name ?manufacturer ?temp ?press ?eff
WHERE {
    ?equipment rdfs:label ?name .
    ?equipment maint:manufacturer ?manufacturer .

    ?state proc:equipment ?equipment .
    ?state proc:temperature ?temp .
    ?state proc:pressure ?press .
    ?state proc:efficiency ?eff .

    BIND(STRAFTER(STR(?equipment), "#") AS ?id)
}
"""

print("\n=== è£…ç½®å®Œå…¨æƒ…å ±ï¼ˆãƒã‚¹ã‚¿ãƒ¼ + é‹è»¢çŠ¶æ…‹ï¼‰ ===")
for row in g.query(query_complete):
    print(f"{row.name} ({row.manufacturer})")
    print(f"  æ¸©åº¦: {float(row.temp):.1f}K, åœ§åŠ›: {float(row.press):.1f}bar, åŠ¹ç‡: {float(row.eff):.1f}%")

# ã‚¯ã‚¨ãƒª2: ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ï¼ˆæ¥ç¶š + æµé‡ï¼‰
query_flow = """
PREFIX proc: <http://example.org/process/>

SELECT ?source ?target ?flowrate
WHERE {
    ?source proc:hasOutput ?stream .
    ?target proc:hasInput ?stream .
    ?stream proc:flowRate ?flowrate .
}
"""

print("\n=== ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ï¼ˆæ¥ç¶š + æµé‡ï¼‰ ===")
for row in g.query(query_flow):
    source = str(row.source).split('/')[-1]
    target = str(row.target).split('/')[-1]
    print(f"{source} â†’ {target}: {float(row.flowrate):.0f} kg/h")

# ===== æ¨è«–ã«ã‚ˆã‚‹æ–°çŸ¥è­˜ã®å°å‡º =====

# æ¨è«–ãƒ«ãƒ¼ãƒ«: åŠ¹ç‡90%ä»¥ä¸Šã®è£…ç½®ã¯"HighPerformance"ã‚¯ãƒ©ã‚¹
print("\n=== æ¨è«–çµæœï¼ˆåŠ¹ç‡ãƒ™ãƒ¼ã‚¹åˆ†é¡ï¼‰ ===")
for s, p, o in g.triples((None, PROC.efficiency, None)):
    if float(o) >= 90.0:
        equipment = g.value(s, PROC.equipment)
        g.add((equipment, RDF.type, PROC.HighPerformanceEquipment))
        eq_name = g.value(equipment, RDFS.label)
        print(f"âœ“ {eq_name}: HighPerformance ({float(o):.1f}%)")

print(f"\nç·ãƒˆãƒªãƒ—ãƒ«æ•°ï¼ˆæ¨è«–å¾Œï¼‰: {len(g)}")

# ä¿å­˜
g.serialize(destination="integrated_knowledge_graph.ttl", format="turtle")
print("\nâœ“ çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ä¿å­˜å®Œäº†: integrated_knowledge_graph.ttl")

# OWLå½¢å¼ã§ã‚‚ä¿å­˜ï¼ˆProtÃ©gÃ©ã§é–‹ã‘ã‚‹ï¼‰
g.serialize(destination="integrated_knowledge_graph.owl", format="xml")
print("âœ“ OWLå½¢å¼ä¿å­˜å®Œäº†: integrated_knowledge_graph.owl")
</code></pre>

            <div class="example-output">
                <strong>å‡ºåŠ›ä¾‹:</strong><br>
                === ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹çµ±åˆ ===<br>
                è£…ç½®ãƒã‚¹ã‚¿ãƒ¼: 3ä»¶<br>
                é‹è»¢ãƒ‡ãƒ¼ã‚¿: 3ä»¶<br>
                æ¥ç¶šãƒ‡ãƒ¼ã‚¿: 4ä»¶<br>
                <br>
                === çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ• ===<br>
                ç·ãƒˆãƒªãƒ—ãƒ«æ•°: 48<br>
                <br>
                === è£…ç½®å®Œå…¨æƒ…å ±ï¼ˆãƒã‚¹ã‚¿ãƒ¼ + é‹è»¢çŠ¶æ…‹ï¼‰ ===<br>
                ä¸»åå¿œå™¨ (Mitsubishi Chemical)<br>
                &nbsp;&nbsp;æ¸©åº¦: 350.5K, åœ§åŠ›: 5.1bar, åŠ¹ç‡: 92.8%<br>
                å†·å´å™¨ (Kobe Steel)<br>
                &nbsp;&nbsp;æ¸©åº¦: 320.2K, åœ§åŠ›: 5.0bar, åŠ¹ç‡: 89.5%<br>
                è’¸ç•™å¡” (Sumitomo Heavy)<br>
                &nbsp;&nbsp;æ¸©åº¦: 340.0K, åœ§åŠ›: 1.5bar, åŠ¹ç‡: 95.2%<br>
                <br>
                === ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ï¼ˆæ¥ç¶š + æµé‡ï¼‰ ===<br>
                Feed â†’ R-101: 1000 kg/h<br>
                R-101 â†’ HX-201: 980 kg/h<br>
                HX-201 â†’ SEP-301: 975 kg/h<br>
                SEP-301 â†’ Product: 920 kg/h<br>
                <br>
                === æ¨è«–çµæœï¼ˆåŠ¹ç‡ãƒ™ãƒ¼ã‚¹åˆ†é¡ï¼‰ ===<br>
                âœ“ ä¸»åå¿œå™¨: HighPerformance (92.8%)<br>
                âœ“ è’¸ç•™å¡”: HighPerformance (95.2%)<br>
                <br>
                ç·ãƒˆãƒªãƒ—ãƒ«æ•°ï¼ˆæ¨è«–å¾Œï¼‰: 50<br>
                <br>
                âœ“ çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ä¿å­˜å®Œäº†: integrated_knowledge_graph.ttl<br>
                âœ“ OWLå½¢å¼ä¿å­˜å®Œäº†: integrated_knowledge_graph.owl
            </div>

            <div class="success-box">
                <p><strong>âœ… çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã®æˆæœ</strong></p>
                <ul>
                    <li><strong>ãƒãƒ«ãƒã‚½ãƒ¼ã‚¹çµ±åˆ</strong>: è£…ç½®ãƒã‚¹ã‚¿ãƒ¼ã€é‹è»¢ãƒ‡ãƒ¼ã‚¿ã€æ¥ç¶šæƒ…å ±ã‚’å˜ä¸€ã‚°ãƒ©ãƒ•ã«çµ±åˆ</li>
                    <li><strong>æ™‚é–“æƒ…å ±ä¿æŒ</strong>: ç¾åœ¨ã®é‹è»¢çŠ¶æ…‹ã¨æ­´å²çš„ãƒ‡ãƒ¼ã‚¿ã‚’æ™‚ç³»åˆ—ã§ç®¡ç†</li>
                    <li><strong>æ¨è«–ã«ã‚ˆã‚‹çŸ¥è­˜æ‹¡å¼µ</strong>: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§æ–°ã—ã„çŸ¥è­˜ï¼ˆé«˜æ€§èƒ½è£…ç½®ï¼‰ã‚’è‡ªå‹•åˆ†é¡</li>
                    <li><strong>æ¨™æº–å½¢å¼å‡ºåŠ›</strong>: Turtle/OWLå½¢å¼ã§ä»–ãƒ„ãƒ¼ãƒ«ï¼ˆProtÃ©gÃ©ã€GraphDBï¼‰ã¨é€£æºå¯èƒ½</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>å­¦ç¿’ç›®æ¨™ã®ç¢ºèª</h2>

            <p>ã“ã®ç« ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã‚’èª¬æ˜ãƒ»å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š</p>

            <h3>åŸºæœ¬ç†è§£</h3>
            <ul>
                <li>âœ… CSVãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŠ½å‡ºãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¬æ˜ã§ãã‚‹</li>
                <li>âœ… è£…ç½®æ¥ç¶šé–¢ä¿‚ã®æŠ½å‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç†è§£ã—ã¦ã„ã‚‹</li>
                <li>âœ… æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®RDFè¡¨ç¾æ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ã‚‹</li>
                <li>âœ… ãƒãƒ«ãƒã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿çµ±åˆã®èª²é¡Œã¨è§£æ±ºç­–ã‚’ç†è§£ã—ã¦ã„ã‚‹</li>
            </ul>

            <h3>å®Ÿè·µã‚¹ã‚­ãƒ«</h3>
            <ul>
                <li>âœ… pandasãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’RDFã‚°ãƒ©ãƒ•ã«è‡ªå‹•å¤‰æ›ã§ãã‚‹</li>
                <li>âœ… ãƒ•ãƒ­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è£…ç½®æ¥ç¶šã®ãƒˆãƒªãƒ—ãƒ«ã‚’ç”Ÿæˆã§ãã‚‹</li>
                <li>âœ… P&IDãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦çŸ¥è­˜æŠ½å‡ºã§ãã‚‹</li>
                <li>âœ… ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æ™‚ç³»åˆ—RDFã«å¤‰æ›ã§ãã‚‹</li>
                <li>âœ… æ­´å²çš„é‹è»¢ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æãŒã§ãã‚‹</li>
                <li>âœ… è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’å˜ä¸€ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã«çµ±åˆã§ãã‚‹</li>
                <li>âœ… SPARQLã§çµ±åˆãƒ‡ãƒ¼ã‚¿ã®é«˜åº¦ãªã‚¯ã‚¨ãƒªãŒã§ãã‚‹</li>
            </ul>

            <h3>å¿œç”¨åŠ›</h3>
            <ul>
                <li>âœ… å®Ÿãƒ—ãƒ©ãƒ³ãƒˆã®å„ç¨®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’RDFåŒ–ã™ã‚‹æˆ¦ç•¥ã‚’ç«‹æ¡ˆã§ãã‚‹</li>
                <li>âœ… ç•°å¸¸æ¤œå‡ºã‚„æ€§èƒ½ä½ä¸‹ã‚’SPARQLã‚¯ã‚¨ãƒªã§ç™ºè¦‹ã§ãã‚‹</li>
                <li>âœ… ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹æ¨è«–ã§æ–°ã—ã„çŸ¥è­˜ã‚’è‡ªå‹•å°å‡ºã§ãã‚‹</li>
                <li>âœ… å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹ãƒˆãƒªãƒ—ãƒ«ã‚¹ãƒˆã‚¢é¸å®šãŒã§ãã‚‹</li>
                <li>âœ… ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’ProtÃ©gÃ©ç­‰ã®å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã§å¯è¦–åŒ–ãƒ»ç·¨é›†ã§ãã‚‹</li>
            </ul>
        </section>

        <section>
            <h2>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h2>

            <p>ç¬¬3ç« ã§ã¯ã€å®Ÿéš›ã®ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’è‡ªå‹•æ§‹ç¯‰ã™ã‚‹åŒ…æ‹¬çš„ãªæ‰‹æ³•ã‚’å­¦ã³ã¾ã—ãŸã€‚æ¬¡ç« ã§ã¯ã€æ§‹ç¯‰ã—ãŸãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã«å¯¾ã™ã‚‹é«˜åº¦ãªSPARQLæ¨è«–ã€æ©Ÿæ¢°å­¦ç¿’ã¨ã®çµ±åˆã€ãã—ã¦ç”£æ¥­å¿œç”¨äº‹ä¾‹ã‚’å­¦ã³ã¾ã™ã€‚</p>

            <div class="info-box">
                <p><strong>ğŸ“š æ¬¡ç« ã®å†…å®¹ï¼ˆç¬¬4ç« äºˆå‘Šï¼‰</strong></p>
                <ul>
                    <li>SPARQLæ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã‚‹çŸ¥è­˜æ¨è«–</li>
                    <li>ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã¨æ©Ÿæ¢°å­¦ç¿’ã®çµ±åˆ</li>
                    <li>ã‚°ãƒ©ãƒ•ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆGNNï¼‰ã®å¿œç”¨</li>
                    <li>ãƒ—ãƒ­ã‚»ã‚¹ç•°å¸¸æ¤œçŸ¥ã¨ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹è¨ºæ–­</li>
                    <li>ç”£æ¥­ç•Œã§ã®å®Ÿè£…äº‹ä¾‹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</li>
                </ul>
            </div>
        </section>

        <div class="navigation">
            <a href="chapter-2.html" class="nav-button">â† ç¬¬2ç« ï¼šã‚ªãƒ³ãƒˆãƒ­ã‚¸ãƒ¼è¨­è¨ˆ</a>
            <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
        </div>
    </main>

    <footer style="background-color: var(--color-bg-alt); padding: var(--spacing-lg); margin-top: var(--spacing-xl); text-align: center; border-top: 1px solid var(--color-border);">
        <p style="color: var(--color-text-light); font-size: 0.9rem;">
            Â© 2025 PI Knowledge Hub - Process Ontology Series |
            <a href="../../../../index.html" style="color: var(--color-link);">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </p>
    </footer>
</body>
</html>
