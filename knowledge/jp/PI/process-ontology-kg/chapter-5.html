<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¬¬5ç« ï¼šå®Ÿè£…ã¨çµ±åˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒ—ãƒ­ã‚»ã‚¹ã‚ªãƒ³ãƒˆãƒ­ã‚¸ãƒ¼ã¨ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚·ãƒªãƒ¼ã‚º">
    <title>ç¬¬5ç« ï¼šå®Ÿè£…ã¨çµ±åˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒ—ãƒ­ã‚»ã‚¹ã‚ªãƒ³ãƒˆãƒ­ã‚¸ãƒ¼ã¨ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ• | PI Terakoya</title>

        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8; color: #333; background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; padding: 2rem 1rem; text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .back-link {
            display: inline-block; margin-bottom: 2rem; padding: 0.5rem 1rem;
            background: white; color: #11998e; text-decoration: none;
            border-radius: 6px; font-weight: 600;
        }
        .content-box {
            background: white; padding: 2rem; border-radius: 12px;
            margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #11998e; margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem; border-bottom: 3px solid #11998e;
        }
        h3 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h4 { color: #2c3e50; margin: 1rem 0 0.5rem 0; }
        p { margin-bottom: 1rem; }
        ul, ol { margin-left: 2rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
        pre {
            background: #1e1e1e; color: #d4d4d4; padding: 1.5rem;
            border-radius: 8px; overflow-x: auto; margin: 1rem 0;
            border-left: 4px solid #11998e;
        }
        code {
            font-family: 'Courier New', monospace; font-size: 0.9rem;
        }
        .key-point {
            background: #e8f5e9; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #4caf50; margin: 1rem 0;
        }
        .tech-note {
            background: #e3f2fd; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #2196f3; margin: 1rem 0;
        }
        .formula {
            background: #f0f7ff; padding: 1rem; border-radius: 6px;
            margin: 1rem 0; overflow-x: auto;
        }
        table {
            width: 100%; border-collapse: collapse; margin: 1rem 0;
        }
        th, td {
            border: 1px solid #ddd; padding: 0.75rem; text-align: left;
        }
        th {
            background: #11998e; color: white; font-weight: 600;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: 3rem;
        }
        .nav-buttons a {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; text-decoration: none; border-radius: 6px;
            font-weight: 600;
        }
        footer {
            background: #2c3e50; color: white; text-align: center;
            padding: 2rem 1rem; margin-top: 4rem;
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.6rem; }
            .container { padding: 0 0.5rem; }
            pre { padding: 1rem; }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>

    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
            <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/PI/process-ontology-kg/chapter-5.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="../../PI/index.html">ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹</a><span class="breadcrumb-separator">â€º</span><a href="../../PI/process-ontology-kg/index.html">Process Ontology Kg</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 5</span>
        </div>
    </nav>

        <header>
        <div class="container">
            <h1>ç¬¬5ç« ï¼šå®Ÿè£…ã¨çµ±åˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h1>
            <p class="subtitle">SPARQL APIã€å¯è¦–åŒ–ã€æ–‡æ›¸è‡ªå‹•ç”Ÿæˆã€æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã€å®Œå…¨çµ±åˆã‚·ã‚¹ãƒ†ãƒ </p>
            <div class="meta">
                <span class="meta">ğŸ“– èª­äº†æ™‚é–“: 40-45åˆ†</span>
                <span class="meta">ğŸ“Š é›£æ˜“åº¦: ä¸Šç´š</span>
                <span class="meta">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 7å€‹</span>
            </div>
        </div>
    </header>

    <main class="container">

<div class="learning-objectives">
<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… Flask/FastAPIã§SPARQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆAPIã‚’æ§‹ç¯‰ã§ãã‚‹</li>
<li>âœ… NetworkXã¨Plotlyã§ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’å¯è¦–åŒ–ã§ãã‚‹</li>
<li>âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ãƒ—ãƒ­ã‚»ã‚¹æ–‡æ›¸ã‚’è‡ªå‹•ç”Ÿæˆã§ãã‚‹</li>
<li>âœ… æ ¹æœ¬åŸå› åˆ†æï¼ˆRCAï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ©Ÿå™¨æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹</li>
<li>âœ… æœ€é©åŒ–å•é¡Œã«ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’æ´»ç”¨ã§ãã‚‹</li>
<li>âœ… API+æ¨è«–+å¯è¦–åŒ–ã‚’çµ±åˆã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã§ãã‚‹</li>
</ul>
</div>

<hr />

<h2>5.1 SPARQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆAPI</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹1: Flaskãƒ™ãƒ¼ã‚¹SPARQL ã‚¯ã‚¨ãƒªAPI</h3>

<pre><code class="language-python">from flask import Flask, request, jsonify
from rdflib import Graph, Namespace, RDF, RDFS, Literal
from rdflib.plugins.sparql import prepareQuery
import json

# Flask SPARQL ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆAPIã®å®Ÿè£…

app = Flask(__name__)

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•
PROC = Namespace("http://example.org/process#")
g = Graph()
g.bind("proc", PROC)

# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
def init_knowledge_graph():
    """ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’åˆæœŸåŒ–"""
    # æ©Ÿå™¨ãƒ‡ãƒ¼ã‚¿
    equipment_data = [
        {"id": "P101", "type": "Pump", "flow": 50.0, "pressure": 500.0, "status": "Running"},
        {"id": "P102", "type": "Pump", "flow": 45.0, "pressure": 480.0, "status": "Running"},
        {"id": "R201", "type": "Reactor", "temp": 180.0, "pressure": 800.0, "status": "Running"},
        {"id": "T301", "type": "Tank", "level": 75.0, "temp": 25.0, "status": "Running"},
    ]

    for eq in equipment_data:
        eq_uri = PROC[eq['id']]
        g.add((eq_uri, RDF.type, PROC[eq['type']]))
        g.add((eq_uri, PROC.hasStatus, Literal(eq['status'])))

        if 'flow' in eq:
            g.add((eq_uri, PROC.hasFlowRate, Literal(eq['flow'])))
        if 'pressure' in eq:
            g.add((eq_uri, PROC.hasPressure, Literal(eq['pressure'])))
        if 'temp' in eq:
            g.add((eq_uri, PROC.hasTemperature, Literal(eq['temp'])))
        if 'level' in eq:
            g.add((eq_uri, PROC.hasLevel, Literal(eq['level'])))

    print(f"ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•åˆæœŸåŒ–å®Œäº†: {len(g)} ãƒˆãƒªãƒ—ãƒ«")


# API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

@app.route('/api/sparql', methods=['POST'])
def sparql_endpoint():
    """
    SPARQL ã‚¯ã‚¨ãƒªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

    POST /api/sparql
    Body: {"query": "SELECT ..."}

    Returns:
        JSON: ã‚¯ã‚¨ãƒªçµæœ
    """
    try:
        data = request.get_json()
        query_str = data.get('query', '')

        if not query_str:
            return jsonify({"error": "ã‚¯ã‚¨ãƒªãŒç©ºã§ã™"}), 400

        # SPARQLã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œ
        query = prepareQuery(query_str, initNs={"proc": PROC, "rdf": RDF, "rdfs": RDFS})
        results = g.query(query)

        # çµæœã‚’JSONå½¢å¼ã«å¤‰æ›
        response = []
        for row in results:
            row_dict = {}
            for var in results.vars:
                value = row[var]
                # URIã®å ´åˆã¯çŸ­ç¸®å½¢ã«
                if hasattr(value, 'toPython'):
                    row_dict[str(var)] = str(value).split('#')[-1]
                else:
                    row_dict[str(var)] = str(value)
            response.append(row_dict)

        return jsonify({
            "status": "success",
            "count": len(response),
            "results": response
        }), 200

    except Exception as e:
        return jsonify({"error": str(e)}), 500


@app.route('/api/equipment', methods=['GET'])
def get_all_equipment():
    """
    å…¨æ©Ÿå™¨ä¸€è¦§ã‚’å–å¾—

    GET /api/equipment

    Returns:
        JSON: æ©Ÿå™¨ãƒªã‚¹ãƒˆ
    """
    query = prepareQuery("""
        SELECT ?equipment ?type ?status
        WHERE {
            ?equipment a ?type .
            ?equipment proc:hasStatus ?status .
            FILTER (strstarts(str(?type), str(proc:)))
        }
    """, initNs={"proc": PROC})

    results = g.query(query)
    equipment_list = []

    for row in results:
        equipment_list.append({
            "id": str(row.equipment).split('#')[-1],
            "type": str(row.type).split('#')[-1],
            "status": str(row.status)
        })

    return jsonify({
        "status": "success",
        "count": len(equipment_list),
        "equipment": equipment_list
    }), 200


@app.route('/api/equipment/<eq_id>', methods=['GET'])
def get_equipment_details(eq_id):
    """
    ç‰¹å®šæ©Ÿå™¨ã®è©³ç´°æƒ…å ±ã‚’å–å¾—

    GET /api/equipment/{eq_id}

    Returns:
        JSON: æ©Ÿå™¨è©³ç´°
    """
    eq_uri = PROC[eq_id]

    # æ©Ÿå™¨ã®å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–å¾—
    query = prepareQuery("""
        SELECT ?property ?value
        WHERE {
            ?equipment ?property ?value .
        }
    """, initNs={"proc": PROC})

    results = g.query(query, initBindings={'equipment': eq_uri})

    if len(list(results)) == 0:
        return jsonify({"error": f"æ©Ÿå™¨ {eq_id} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}), 404

    # å†ã‚¯ã‚¨ãƒªï¼ˆiteratorãŒæ¶ˆè²»æ¸ˆã¿ã®ãŸã‚ï¼‰
    results = g.query(query, initBindings={'equipment': eq_uri})

    details = {"id": eq_id}
    for row in results:
        prop = str(row.property).split('#')[-1]
        value = row.value.toPython() if hasattr(row.value, 'toPython') else str(row.value)
        details[prop] = value

    return jsonify({
        "status": "success",
        "equipment": details
    }), 200


@app.route('/api/statistics', methods=['GET'])
def get_statistics():
    """
    çµ±è¨ˆæƒ…å ±ã‚’å–å¾—

    GET /api/statistics

    Returns:
        JSON: ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•çµ±è¨ˆ
    """
    stats = {
        "total_triples": len(g),
        "total_equipment": len(list(g.subjects(RDF.type, None))),
        "equipment_by_type": {}
    }

    # æ©Ÿå™¨ã‚¿ã‚¤ãƒ—åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ
    query = prepareQuery("""
        SELECT ?type (COUNT(?equipment) as ?count)
        WHERE {
            ?equipment a ?type .
            FILTER (strstarts(str(?type), str(proc:)))
        }
        GROUP BY ?type
    """, initNs={"proc": PROC})

    for row in g.query(query):
        type_name = str(row.type).split('#')[-1]
        stats['equipment_by_type'][type_name] = int(row['count'])

    return jsonify({
        "status": "success",
        "statistics": stats
    }), 200


# å®Ÿè¡Œãƒ‡ãƒ¢ï¼ˆé€šå¸¸ã¯if __name__ == '__main__'ã§èµ·å‹•ï¼‰
def demo_api():
    """APIã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"""
    print("="*60)
    print("SPARQL ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆAPI")
    print("="*60)

    init_knowledge_graph()

    print("\nã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‘")
    print("  POST /api/sparql - SPARQLã‚¯ã‚¨ãƒªå®Ÿè¡Œ")
    print("  GET  /api/equipment - å…¨æ©Ÿå™¨ä¸€è¦§")
    print("  GET  /api/equipment/{id} - æ©Ÿå™¨è©³ç´°")
    print("  GET  /api/statistics - çµ±è¨ˆæƒ…å ±")

    print("\nã€ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒªã€‘")
    sample_query = """
    SELECT ?equipment ?pressure
    WHERE {
        ?equipment proc:hasPressure ?pressure .
        FILTER (?pressure > 600)
    }
    """
    print(f"  {sample_query.strip()}")

    # ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œï¼ˆAPIã‚’ä½¿ã‚ãšç›´æ¥å®Ÿè¡Œï¼‰
    query = prepareQuery(sample_query, initNs={"proc": PROC})
    results = g.query(query)

    print("\nã€ã‚¯ã‚¨ãƒªçµæœã€‘")
    for row in results:
        eq_id = str(row.equipment).split('#')[-1]
        print(f"  {eq_id}: åœ§åŠ› {row.pressure} kPa")

    print("\nã€Flaskèµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã€‘")
    print("  python app.py")
    print("  ã¾ãŸã¯: flask run --port 5000")


# ãƒ‡ãƒ¢å®Ÿè¡Œ
demo_api()

# Flaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ï¼ˆå®Ÿéš›ã®ä½¿ç”¨æ™‚ï¼‰
# if __name__ == '__main__':
#     init_knowledge_graph()
#     app.run(debug=True, port=5000)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
SPARQL ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆAPI
============================================================
ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•åˆæœŸåŒ–å®Œäº†: 16 ãƒˆãƒªãƒ—ãƒ«

ã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‘
  POST /api/sparql - SPARQLã‚¯ã‚¨ãƒªå®Ÿè¡Œ
  GET  /api/equipment - å…¨æ©Ÿå™¨ä¸€è¦§
  GET  /api/equipment/{id} - æ©Ÿå™¨è©³ç´°
  GET  /api/statistics - çµ±è¨ˆæƒ…å ±

ã€ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒªã€‘
  SELECT ?equipment ?pressure
    WHERE {
        ?equipment proc:hasPressure ?pressure .
        FILTER (?pressure > 600)
    }

ã€ã‚¯ã‚¨ãƒªçµæœã€‘
  R201: åœ§åŠ› 800.0 kPa

ã€Flaskèµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã€‘
  python app.py
  ã¾ãŸã¯: flask run --port 5000
</code></pre>

<p><strong>è§£èª¬:</strong> Flaskã§SPARQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆAPIã‚’æ§‹ç¯‰ã—ã€RESTful APIã¨ã—ã¦ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚POST /api/sparqlã§ä»»æ„ã®SPARQLã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã§ãã€ä»–ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§æ©Ÿå™¨æƒ…å ±ã‚„çµ±è¨ˆã‚’å–å¾—ã§ãã¾ã™ã€‚</p>

<hr />

<h2>5.2 ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã®å¯è¦–åŒ–</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹2: NetworkXã¨Plotlyã«ã‚ˆã‚‹ã‚°ãƒ©ãƒ•å¯è¦–åŒ–</h3>

<pre><code class="language-python">import networkx as nx
import plotly.graph_objects as go
from rdflib import Graph, Namespace, RDF, RDFS, Literal
import numpy as np

# ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã®å¯è¦–åŒ–

PROC = Namespace("http://example.org/process#")

def create_process_graph():
    """ãƒ—ãƒ­ã‚»ã‚¹ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’ä½œæˆ"""
    g = Graph()
    g.bind("proc", PROC)

    # ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼å®šç¾©
    # Feed â†’ P-101 â†’ R-201 â†’ T-301 â†’ Product
    g.add((PROC.Feed, RDF.type, PROC.Stream))
    g.add((PROC.P101, RDF.type, PROC.Pump))
    g.add((PROC.R201, RDF.type, PROC.Reactor))
    g.add((PROC.T301, RDF.type, PROC.Tank))
    g.add((PROC.Product, RDF.type, PROC.Stream))

    # æ¥ç¶šé–¢ä¿‚
    g.add((PROC.Feed, PROC.flowsTo, PROC.P101))
    g.add((PROC.P101, PROC.flowsTo, PROC.R201))
    g.add((PROC.R201, PROC.flowsTo, PROC.T301))
    g.add((PROC.T301, PROC.flowsTo, PROC.Product))

    # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    g.add((PROC.P101, PROC.hasFlowRate, Literal(50.0)))
    g.add((PROC.P101, PROC.hasPressure, Literal(500.0)))
    g.add((PROC.R201, PROC.hasTemperature, Literal(180.0)))
    g.add((PROC.T301, PROC.hasLevel, Literal(75.0)))

    return g


def rdf_to_networkx(rdf_graph):
    """
    RDFã‚°ãƒ©ãƒ•ã‚’NetworkXã‚°ãƒ©ãƒ•ã«å¤‰æ›

    Parameters:
        rdf_graph (Graph): RDFã‚°ãƒ©ãƒ•

    Returns:
        nx.DiGraph: NetworkXæœ‰å‘ã‚°ãƒ©ãƒ•
    """
    nx_graph = nx.DiGraph()

    # ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ 
    for s, p, o in rdf_graph:
        subj = str(s).split('#')[-1]
        pred = str(p).split('#')[-1]
        obj = str(o).split('#')[-1] if '#' in str(o) else str(o)

        # ãƒãƒ¼ãƒ‰ã®ã‚¿ã‚¤ãƒ—ã‚’å–å¾—
        if p == RDF.type:
            nx_graph.add_node(subj, node_type=obj)
        elif p == PROC.flowsTo:
            nx_graph.add_edge(subj, obj, relation='flowsTo')
        else:
            # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ãƒãƒ¼ãƒ‰å±æ€§ã¨ã—ã¦è¿½åŠ 
            if subj in nx_graph:
                nx_graph.nodes[subj][pred] = obj
            else:
                nx_graph.add_node(subj, **{pred: obj})

    return nx_graph


def visualize_with_plotly(nx_graph):
    """
    NetworkXã‚°ãƒ©ãƒ•ã‚’Plotlyã§å¯è¦–åŒ–

    Parameters:
        nx_graph (nx.DiGraph): NetworkXã‚°ãƒ©ãƒ•
    """
    # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ï¼ˆéšå±¤çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
    pos = nx.spring_layout(nx_graph, seed=42, k=1.5, iterations=50)

    # ã‚¨ãƒƒã‚¸ã®ãƒˆãƒ¬ãƒ¼ã‚¹
    edge_trace = go.Scatter(
        x=[], y=[],
        line=dict(width=2, color='#888'),
        hoverinfo='none',
        mode='lines',
        showlegend=False
    )

    # ã‚¨ãƒƒã‚¸ã®çŸ¢å°ã®ãŸã‚ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    annotations = []

    for edge in nx_graph.edges():
        x0, y0 = pos[edge[0]]
        x1, y1 = pos[edge[1]]
        edge_trace['x'] += tuple([x0, x1, None])
        edge_trace['y'] += tuple([y0, y1, None])

        # çŸ¢å°ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
        annotations.append(
            dict(
                ax=x0, ay=y0,
                x=x1, y=y1,
                xref='x', yref='y',
                axref='x', ayref='y',
                showarrow=True,
                arrowhead=2,
                arrowsize=1.5,
                arrowwidth=2,
                arrowcolor='#888'
            )
        )

    # ãƒãƒ¼ãƒ‰ã®ãƒˆãƒ¬ãƒ¼ã‚¹
    node_trace = go.Scatter(
        x=[], y=[],
        mode='markers+text',
        hoverinfo='text',
        text=[],
        textposition='top center',
        marker=dict(
            showscale=True,
            colorscale='Greens',
            size=[],
            color=[],
            colorbar=dict(
                thickness=15,
                title='ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—',
                xanchor='left',
                titleside='right'
            ),
            line=dict(width=2, color='white')
        ),
        showlegend=False
    )

    # ãƒãƒ¼ãƒ‰æƒ…å ±ã‚’è¿½åŠ 
    node_colors = {'Stream': 0, 'Pump': 1, 'Reactor': 2, 'Tank': 3}

    for node in nx_graph.nodes():
        x, y = pos[node]
        node_trace['x'] += tuple([x])
        node_trace['y'] += tuple([y])
        node_trace['text'] += tuple([node])

        # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸè‰²
        node_type = nx_graph.nodes[node].get('node_type', 'Unknown')
        color_idx = node_colors.get(node_type, 0)
        node_trace['marker']['color'] += tuple([color_idx])
        node_trace['marker']['size'] += tuple([30])

        # ãƒ›ãƒãƒ¼æƒ…å ±
        hover_text = f"<b>{node}</b><br>"
        hover_text += f"ã‚¿ã‚¤ãƒ—: {node_type}<br>"
        for key, value in nx_graph.nodes[node].items():
            if key != 'node_type':
                hover_text += f"{key}: {value}<br>"

        if 'hovertext' not in node_trace:
            node_trace['hovertext'] = []
        node_trace['hovertext'].append(hover_text)

    # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­å®š
    layout = go.Layout(
        title=dict(
            text='ãƒ—ãƒ­ã‚»ã‚¹ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•å¯è¦–åŒ–',
            x=0.5,
            xanchor='center',
            font=dict(size=20, color='#2c3e50')
        ),
        showlegend=False,
        hovermode='closest',
        margin=dict(b=20, l=5, r=5, t=60),
        xaxis=dict(showgrid=False, zeroline=False, showticklabels=False),
        yaxis=dict(showgrid=False, zeroline=False, showticklabels=False),
        plot_bgcolor='white',
        width=900,
        height=600
    )

    # ã‚°ãƒ©ãƒ•ä½œæˆ
    fig = go.Figure(data=[edge_trace, node_trace], layout=layout)
    fig.show()

    print("\nã€å¯è¦–åŒ–å®Œäº†ã€‘")
    print(f"  ãƒãƒ¼ãƒ‰æ•°: {nx_graph.number_of_nodes()}")
    print(f"  ã‚¨ãƒƒã‚¸æ•°: {nx_graph.number_of_edges()}")


# å®Ÿè¡Œãƒ‡ãƒ¢
print("="*60)
print("ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•å¯è¦–åŒ–ï¼ˆNetworkX + Plotlyï¼‰")
print("="*60)

rdf_g = create_process_graph()
print(f"\nRDFã‚°ãƒ©ãƒ•ä½œæˆå®Œäº†: {len(rdf_g)} ãƒˆãƒªãƒ—ãƒ«")

nx_g = rdf_to_networkx(rdf_g)
print(f"NetworkXã‚°ãƒ©ãƒ•ã«å¤‰æ›: {nx_g.number_of_nodes()} ãƒãƒ¼ãƒ‰, {nx_g.number_of_edges()} ã‚¨ãƒƒã‚¸")

print("\nã€ãƒãƒ¼ãƒ‰ä¸€è¦§ã€‘")
for node, data in nx_g.nodes(data=True):
    print(f"  {node}: {data}")

print("\nã€ã‚¨ãƒƒã‚¸ä¸€è¦§ã€‘")
for u, v, data in nx_g.edges(data=True):
    print(f"  {u} â†’ {v}: {data}")

# Plotlyã§å¯è¦–åŒ–
visualize_with_plotly(nx_g)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•å¯è¦–åŒ–ï¼ˆNetworkX + Plotlyï¼‰
============================================================

RDFã‚°ãƒ©ãƒ•ä½œæˆå®Œäº†: 13 ãƒˆãƒªãƒ—ãƒ«
NetworkXã‚°ãƒ©ãƒ•ã«å¤‰æ›: 5 ãƒãƒ¼ãƒ‰, 4 ã‚¨ãƒƒã‚¸

ã€ãƒãƒ¼ãƒ‰ä¸€è¦§ã€‘
  Feed: {'node_type': 'Stream'}
  P101: {'node_type': 'Pump', 'hasFlowRate': '50.0', 'hasPressure': '500.0'}
  R201: {'node_type': 'Reactor', 'hasTemperature': '180.0'}
  T301: {'node_type': 'Tank', 'hasLevel': '75.0'}
  Product: {'node_type': 'Stream'}

ã€ã‚¨ãƒƒã‚¸ä¸€è¦§ã€‘
  Feed â†’ P101: {'relation': 'flowsTo'}
  P101 â†’ R201: {'relation': 'flowsTo'}
  R201 â†’ T301: {'relation': 'flowsTo'}
  T301 â†’ Product: {'relation': 'flowsTo'}

ã€å¯è¦–åŒ–å®Œäº†ã€‘
  ãƒãƒ¼ãƒ‰æ•°: 5
  ã‚¨ãƒƒã‚¸æ•°: 4
</code></pre>

<p><strong>è§£èª¬:</strong> RDFã‚°ãƒ©ãƒ•ã‚’NetworkXã‚°ãƒ©ãƒ•ã«å¤‰æ›ã—ã€Plotlyã§å¯¾è©±çš„ã«å¯è¦–åŒ–ã—ã¾ã™ã€‚ãƒãƒ¼ãƒ‰ã¯ãƒ—ãƒ­ã‚»ã‚¹æ©Ÿå™¨ã€ã‚¨ãƒƒã‚¸ã¯ç‰©è³ªã®æµã‚Œã‚’è¡¨ã—ã€ãƒã‚¦ã‚¹ãƒ›ãƒãƒ¼ã§è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚</p>

<hr />

<h2>5.3 ãƒ—ãƒ­ã‚»ã‚¹æ–‡æ›¸ã®è‡ªå‹•ç”Ÿæˆ</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹3: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹æ–‡æ›¸è‡ªå‹•ç”Ÿæˆ</h3>

<pre><code class="language-python">from rdflib import Graph, Namespace, RDF, RDFS, Literal
from rdflib.plugins.sparql import prepareQuery
from jinja2 import Template
from datetime import datetime

# ãƒ—ãƒ­ã‚»ã‚¹æ–‡æ›¸è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

PROC = Namespace("http://example.org/process#")

def create_process_documentation_kb():
    """æ–‡æ›¸ç”Ÿæˆç”¨ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ"""
    g = Graph()
    g.bind("proc", PROC)

    # ãƒ—ãƒ­ã‚»ã‚¹ãƒ¦ãƒ‹ãƒƒãƒˆ
    g.add((PROC.PU100, RDF.type, PROC.ProcessUnit))
    g.add((PROC.PU100, RDFS.label, Literal("åå¿œãƒ—ãƒ­ã‚»ã‚¹ãƒ¦ãƒ‹ãƒƒãƒˆ")))
    g.add((PROC.PU100, PROC.hasDescription, Literal("åŸæ–™Aã®è§¦åª’åå¿œã«ã‚ˆã‚‹è£½å“Bè£½é€ ")))

    # æ©Ÿå™¨
    equipment_data = [
        {"id": "P101", "type": "Pump", "label": "åŸæ–™ä¾›çµ¦ãƒãƒ³ãƒ—", "spec": "é å¿ƒãƒãƒ³ãƒ—, 50 mÂ³/h, 5 bar"},
        {"id": "R201", "type": "Reactor", "label": "è§¦åª’åå¿œå™¨", "spec": "CSTR, 10 mÂ³, è§¦åª’: Pt/Al2O3"},
        {"id": "HX301", "type": "HeatExchanger", "label": "å†·å´å™¨", "spec": "ã‚·ã‚§ãƒ«&ãƒãƒ¥ãƒ¼ãƒ–, 500 kW"},
        {"id": "T401", "type": "Tank", "label": "è£½å“è²¯æ§½", "spec": "ç¸¦å‹å††ç­’ã‚¿ãƒ³ã‚¯, 50 mÂ³"},
    ]

    for eq in equipment_data:
        eq_uri = PROC[eq['id']]
        g.add((eq_uri, RDF.type, PROC[eq['type']]))
        g.add((eq_uri, RDFS.label, Literal(eq['label'])))
        g.add((eq_uri, PROC.hasSpecification, Literal(eq['spec'])))
        g.add((eq_uri, PROC.belongsTo, PROC.PU100))

    # é‹è»¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    g.add((PROC.R201, PROC.operatingTemperature, Literal(180.0)))
    g.add((PROC.R201, PROC.operatingPressure, Literal(800.0)))
    g.add((PROC.R201, PROC.operatingFlowRate, Literal(50.0)))

    # å®‰å…¨åˆ¶ç´„
    g.add((PROC.R201, PROC.maxTemperature, Literal(200.0)))
    g.add((PROC.R201, PROC.maxPressure, Literal(1000.0)))

    return g


def generate_process_document(g):
    """
    ãƒ—ãƒ­ã‚»ã‚¹è¨­è¨ˆæ›¸ã‚’è‡ªå‹•ç”Ÿæˆ

    Parameters:
        g (Graph): ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•

    Returns:
        str: Markdownæ–‡æ›¸
    """
    # ãƒ—ãƒ­ã‚»ã‚¹ãƒ¦ãƒ‹ãƒƒãƒˆæƒ…å ±ã‚’å–å¾—
    query_pu = prepareQuery("""
        SELECT ?pu ?label ?desc
        WHERE {
            ?pu a proc:ProcessUnit .
            ?pu rdfs:label ?label .
            ?pu proc:hasDescription ?desc .
        }
    """, initNs={"proc": PROC, "rdfs": RDFS})

    pu_info = list(g.query(query_pu))[0]

    # æ©Ÿå™¨ãƒªã‚¹ãƒˆã‚’å–å¾—
    query_eq = prepareQuery("""
        SELECT ?equipment ?type ?label ?spec
        WHERE {
            ?equipment a ?type .
            ?equipment rdfs:label ?label .
            ?equipment proc:hasSpecification ?spec .
            ?equipment proc:belongsTo ?pu .
            FILTER (strstarts(str(?type), str(proc:)))
            FILTER (?type != proc:ProcessUnit)
        }
        ORDER BY ?equipment
    """, initNs={"proc": PROC, "rdfs": RDFS})

    equipment_list = []
    for row in g.query(query_eq):
        equipment_list.append({
            'id': str(row.equipment).split('#')[-1],
            'type': str(row.type).split('#')[-1],
            'label': str(row.label),
            'spec': str(row.spec)
        })

    # é‹è»¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
    query_params = prepareQuery("""
        SELECT ?equipment ?temp ?pressure ?flow
        WHERE {
            ?equipment proc:operatingTemperature ?temp .
            ?equipment proc:operatingPressure ?pressure .
            ?equipment proc:operatingFlowRate ?flow .
        }
    """, initNs={"proc": PROC})

    operating_params = {}
    for row in g.query(query_params):
        eq_id = str(row.equipment).split('#')[-1]
        operating_params[eq_id] = {
            'temperature': float(row.temp),
            'pressure': float(row.pressure),
            'flow_rate': float(row.flow)
        }

    # Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    template_str = """# ãƒ—ãƒ­ã‚»ã‚¹è¨­è¨ˆæ›¸

**æ–‡æ›¸ç•ªå·**: DOC-{{ doc_id }}
**ä½œæˆæ—¥**: {{ date }}
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0

---

## 1. ãƒ—ãƒ­ã‚»ã‚¹æ¦‚è¦

**ãƒ—ãƒ­ã‚»ã‚¹ãƒ¦ãƒ‹ãƒƒãƒˆ**: {{ pu_label }}

{{ pu_description }}

---

## 2. ä¸»è¦æ©Ÿå™¨ãƒªã‚¹ãƒˆ

| æ©Ÿå™¨ID | æ©Ÿå™¨åç§° | ã‚¿ã‚¤ãƒ— | ä»•æ§˜ |
|--------|---------|--------|------|
{% for eq in equipment_list -%}
| {{ eq.id }} | {{ eq.label }} | {{ eq.type }} | {{ eq.spec }} |
{% endfor %}

---

## 3. é‹è»¢æ¡ä»¶

{% for eq_id, params in operating_params.items() -%}
### {{ eq_id }}

- **é‹è»¢æ¸©åº¦**: {{ params.temperature }} Â°C
- **é‹è»¢åœ§åŠ›**: {{ params.pressure }} kPa
- **é‹è»¢æµé‡**: {{ params.flow_rate }} mÂ³/h

{% endfor %}

---

## 4. å®‰å…¨ä¸Šã®æ³¨æ„äº‹é …

{% if safety_notes -%}
{% for note in safety_notes -%}
- {{ note }}
{% endfor %}
{% else -%}
ï¼ˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‹ã‚‰è‡ªå‹•æŠ½å‡ºäºˆå®šï¼‰
{% endif %}

---

## 5. é–¢é€£æ–‡æ›¸

- P&IDå›³é¢: DWG-PU100-001
- ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ã‚·ãƒ¼ãƒˆ: PFS-PU100
- æ©Ÿå™¨ä»•æ§˜æ›¸: SPEC-{{ equipment_list[0].id }} ã€œ SPEC-{{ equipment_list[-1].id }}

---

*æœ¬æ–‡æ›¸ã¯ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*
"""

    # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å€¤ã‚’åŸ‹ã‚è¾¼ã¿
    template = Template(template_str)
    document = template.render(
        doc_id="PU100-DESIGN-001",
        date=datetime.now().strftime("%Y-%m-%d"),
        pu_label=str(pu_info.label),
        pu_description=str(pu_info.desc),
        equipment_list=equipment_list,
        operating_params=operating_params,
        safety_notes=None
    )

    return document


# å®Ÿè¡Œãƒ‡ãƒ¢
print("="*60)
print("ãƒ—ãƒ­ã‚»ã‚¹æ–‡æ›¸è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ")
print("="*60)

g = create_process_documentation_kb()
print(f"\nãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ä½œæˆ: {len(g)} ãƒˆãƒªãƒ—ãƒ«")

print("\nã€æ–‡æ›¸ç”Ÿæˆä¸­...ã€‘")
document = generate_process_document(g)

print("\n" + "="*60)
print(document)
print("="*60)

# ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
with open("process_design_document.md", "w", encoding="utf-8") as f:
    f.write(document)

print("\nã€ä¿å­˜å®Œäº†ã€‘: process_design_document.md")
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
ãƒ—ãƒ­ã‚»ã‚¹æ–‡æ›¸è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
============================================================

ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ä½œæˆ: 23 ãƒˆãƒªãƒ—ãƒ«

ã€æ–‡æ›¸ç”Ÿæˆä¸­...ã€‘

============================================================
# ãƒ—ãƒ­ã‚»ã‚¹è¨­è¨ˆæ›¸

**æ–‡æ›¸ç•ªå·**: DOC-PU100-DESIGN-001
**ä½œæˆæ—¥**: 2025-10-26
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0

---

## 1. ãƒ—ãƒ­ã‚»ã‚¹æ¦‚è¦

**ãƒ—ãƒ­ã‚»ã‚¹ãƒ¦ãƒ‹ãƒƒãƒˆ**: åå¿œãƒ—ãƒ­ã‚»ã‚¹ãƒ¦ãƒ‹ãƒƒãƒˆ

åŸæ–™Aã®è§¦åª’åå¿œã«ã‚ˆã‚‹è£½å“Bè£½é€ 

---

## 2. ä¸»è¦æ©Ÿå™¨ãƒªã‚¹ãƒˆ

| æ©Ÿå™¨ID | æ©Ÿå™¨åç§° | ã‚¿ã‚¤ãƒ— | ä»•æ§˜ |
|--------|---------|--------|------|
| P101 | åŸæ–™ä¾›çµ¦ãƒãƒ³ãƒ— | Pump | é å¿ƒãƒãƒ³ãƒ—, 50 mÂ³/h, 5 bar |
| R201 | è§¦åª’åå¿œå™¨ | Reactor | CSTR, 10 mÂ³, è§¦åª’: Pt/Al2O3 |
| HX301 | å†·å´å™¨ | HeatExchanger | ã‚·ã‚§ãƒ«&ãƒãƒ¥ãƒ¼ãƒ–, 500 kW |
| T401 | è£½å“è²¯æ§½ | Tank | ç¸¦å‹å††ç­’ã‚¿ãƒ³ã‚¯, 50 mÂ³ |

---

## 3. é‹è»¢æ¡ä»¶

### R201

- **é‹è»¢æ¸©åº¦**: 180.0 Â°C
- **é‹è»¢åœ§åŠ›**: 800.0 kPa
- **é‹è»¢æµé‡**: 50.0 mÂ³/h

---

## 4. å®‰å…¨ä¸Šã®æ³¨æ„äº‹é …

ï¼ˆãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‹ã‚‰è‡ªå‹•æŠ½å‡ºäºˆå®šï¼‰

---

## 5. é–¢é€£æ–‡æ›¸

- P&IDå›³é¢: DWG-PU100-001
- ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ã‚·ãƒ¼ãƒˆ: PFS-PU100
- æ©Ÿå™¨ä»•æ§˜æ›¸: SPEC-P101 ã€œ SPEC-T401

---

*æœ¬æ–‡æ›¸ã¯ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*
============================================================

ã€ä¿å­˜å®Œäº†ã€‘: process_design_document.md
</code></pre>

<p><strong>è§£èª¬:</strong> ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‹ã‚‰SPARQLã§ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã€Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§Markdownæ–‡æ›¸ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚æ©Ÿå™¨ãƒªã‚¹ãƒˆã€é‹è»¢æ¡ä»¶ã€ä»•æ§˜ã‚’ä¸€å…ƒç®¡ç†ã—ã€å¸¸ã«æœ€æ–°ã®æ–‡æ›¸ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚</p>

<hr />

<h2>5.4 æ ¹æœ¬åŸå› åˆ†æï¼ˆRCAï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹4: ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ ¹æœ¬åŸå› åˆ†æ</h3>

<pre><code class="language-python">from rdflib import Graph, Namespace, RDF, RDFS, Literal
from rdflib.plugins.sparql import prepareQuery
import pandas as pd

# æ ¹æœ¬åŸå› åˆ†æï¼ˆRoot Cause Analysisï¼‰ã‚·ã‚¹ãƒ†ãƒ 

PROC = Namespace("http://example.org/process#")
RCA = Namespace("http://example.org/rca#")

def create_rca_knowledge_base():
    """æ ¹æœ¬åŸå› åˆ†æç”¨ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ"""
    g = Graph()
    g.bind("proc", PROC)
    g.bind("rca", RCA)

    # å› æœé–¢ä¿‚ã®å®šç¾©ï¼ˆCause â†’ Effectï¼‰

    # åŸå› 1: å¸è¾¼åœ§åŠ›ä½ä¸‹ â†’ ã‚­ãƒ£ãƒ“ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    g.add((RCA.LowSuctionPressure, RDF.type, RCA.RootCause))
    g.add((RCA.LowSuctionPressure, RDFS.label, Literal("å¸è¾¼åœ§åŠ›ä½ä¸‹")))
    g.add((RCA.LowSuctionPressure, RCA.causes, RCA.Cavitation))
    g.add((RCA.LowSuctionPressure, RCA.likelihood, Literal(0.85)))

    g.add((RCA.Cavitation, RDF.type, RCA.Symptom))
    g.add((RCA.Cavitation, RDFS.label, Literal("ã‚­ãƒ£ãƒ“ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³")))
    g.add((RCA.Cavitation, RCA.manifestsAs, Literal("ä½æµé‡")))
    g.add((RCA.Cavitation, RCA.manifestsAs, Literal("é«˜æŒ¯å‹•")))

    # åŸå› 2: ã‚·ãƒ¼ãƒ«åŠ£åŒ– â†’ æ¼ã‚Œ
    g.add((RCA.SealDegradation, RDF.type, RCA.RootCause))
    g.add((RCA.SealDegradation, RDFS.label, Literal("ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚·ãƒ¼ãƒ«åŠ£åŒ–")))
    g.add((RCA.SealDegradation, RCA.causes, RCA.Leakage))
    g.add((RCA.SealDegradation, RCA.likelihood, Literal(0.90)))

    g.add((RCA.Leakage, RDF.type, RCA.Symptom))
    g.add((RCA.Leakage, RDFS.label, Literal("æ¼ã‚Œ")))
    g.add((RCA.Leakage, RCA.manifestsAs, Literal("ä½åœ§åŠ›")))
    g.add((RCA.Leakage, RCA.manifestsAs, Literal("æ¶²ä½“æ¼æ´©æ¤œçŸ¥")))

    # åŸå› 3: è»¸å—æ‘©è€— â†’ æŒ¯å‹•
    g.add((RCA.BearingWear, RDF.type, RCA.RootCause))
    g.add((RCA.BearingWear, RDFS.label, Literal("è»¸å—æ‘©è€—")))
    g.add((RCA.BearingWear, RCA.causes, RCA.Vibration))
    g.add((RCA.BearingWear, RCA.likelihood, Literal(0.75)))

    g.add((RCA.Vibration, RDF.type, RCA.Symptom))
    g.add((RCA.Vibration, RDFS.label, Literal("ç•°å¸¸æŒ¯å‹•")))
    g.add((RCA.Vibration, RCA.manifestsAs, Literal("é«˜æŒ¯å‹•")))
    g.add((RCA.Vibration, RCA.manifestsAs, Literal("é«˜æ¸©åº¦")))

    # å¯¾ç­–ã®å®šç¾©
    g.add((RCA.LowSuctionPressure, RCA.remediation, Literal("NPSHç¢ºèªã€å¸è¾¼é…ç®¡ç‚¹æ¤œ")))
    g.add((RCA.SealDegradation, RCA.remediation, Literal("ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚·ãƒ¼ãƒ«äº¤æ›")))
    g.add((RCA.BearingWear, RCA.remediation, Literal("è»¸å—äº¤æ›ã€æ½¤æ»‘æ²¹è£œå……")))

    return g


def perform_rca(g, observed_symptoms):
    """
    è¦³æ¸¬ã•ã‚ŒãŸç—‡çŠ¶ã‹ã‚‰æ ¹æœ¬åŸå› ã‚’æ¨è«–

    Parameters:
        g (Graph): RCAãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•
        observed_symptoms (list): è¦³æ¸¬ã•ã‚ŒãŸç—‡çŠ¶ãƒªã‚¹ãƒˆ

    Returns:
        list: æ ¹æœ¬åŸå› ã®å€™è£œãƒªã‚¹ãƒˆ
    """
    candidates = []

    # å„ç—‡çŠ¶ã«å¯¾ã—ã¦å› æœé–¢ä¿‚ã‚’é€†æ¢ç´¢
    for symptom_label in observed_symptoms:
        # ç—‡çŠ¶ã«å¯¾å¿œã™ã‚‹åŸå› ã‚’æ¢ç´¢
        query = prepareQuery("""
            SELECT ?cause ?causeLabel ?symptom ?symptomLabel ?likelihood ?remediation
            WHERE {
                ?cause a rca:RootCause .
                ?cause rdfs:label ?causeLabel .
                ?cause rca:causes ?symptom .
                ?symptom rdfs:label ?symptomLabel .
                ?symptom rca:manifestsAs ?manifestation .
                ?cause rca:likelihood ?likelihood .
                OPTIONAL { ?cause rca:remediation ?remediation }
                FILTER (str(?manifestation) = ?symptom_str)
            }
        """, initNs={"rca": RCA, "rdfs": RDFS})

        results = g.query(query, initBindings={'symptom_str': Literal(symptom_label)})

        for row in results:
            candidates.append({
                'root_cause': str(row.causeLabel),
                'symptom': str(row.symptomLabel),
                'observed': symptom_label,
                'likelihood': float(row.likelihood),
                'remediation': str(row.remediation) if row.remediation else "ï¼ˆå¯¾ç­–æœªå®šç¾©ï¼‰"
            })

    # åŒã˜æ ¹æœ¬åŸå› ãŒè¤‡æ•°ã®ç—‡çŠ¶ã«å¯¾å¿œã™ã‚‹å ´åˆã€å°¤åº¦ã‚’çµ±åˆ
    cause_scores = {}
    for cand in candidates:
        cause = cand['root_cause']
        if cause not in cause_scores:
            cause_scores[cause] = {
                'symptoms': [],
                'likelihood': cand['likelihood'],
                'remediation': cand['remediation']
            }
        cause_scores[cause]['symptoms'].append(cand['observed'])
        # è¤‡æ•°ç—‡çŠ¶ãŒãƒãƒƒãƒã™ã‚‹å ´åˆã€å°¤åº¦ã‚’ç´¯ç©
        cause_scores[cause]['likelihood'] = min(1.0, cause_scores[cause]['likelihood'] + 0.1)

    # å°¤åº¦é †ã«ã‚½ãƒ¼ãƒˆ
    ranked_causes = sorted(
        [{'cause': k, **v} for k, v in cause_scores.items()],
        key=lambda x: x['likelihood'],
        reverse=True
    )

    return ranked_causes


# å®Ÿè¡Œãƒ‡ãƒ¢
print("="*60)
print("æ ¹æœ¬åŸå› åˆ†æï¼ˆRCAï¼‰ã‚·ã‚¹ãƒ†ãƒ ")
print("="*60)

g = create_rca_knowledge_base()
print(f"\nRCAãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ä½œæˆ: {len(g)} ãƒˆãƒªãƒ—ãƒ«")

# ã‚·ãƒŠãƒªã‚ª1: ã‚­ãƒ£ãƒ“ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç–‘ã„
print("\n" + "="*60)
print("ã€ã‚·ãƒŠãƒªã‚ª1ã€‘P-101ãƒãƒ³ãƒ—ã®ç•°å¸¸")
print("="*60)

observed_symptoms_1 = ["ä½æµé‡", "é«˜æŒ¯å‹•"]
print(f"\nè¦³æ¸¬ã•ã‚ŒãŸç—‡çŠ¶: {observed_symptoms_1}")

print("\nã€RCAå®Ÿè¡Œä¸­...ã€‘")
causes_1 = perform_rca(g, observed_symptoms_1)

print("\nã€æ ¹æœ¬åŸå› åˆ†æçµæœã€‘")
for i, cause in enumerate(causes_1, 1):
    print(f"\n{i}. {cause['cause']} (å°¤åº¦: {cause['likelihood']*100:.1f}%)")
    print(f"   é–¢é€£ç—‡çŠ¶: {', '.join(cause['symptoms'])}")
    print(f"   æ¨å¥¨å¯¾ç­–: {cause['remediation']}")

# ã‚·ãƒŠãƒªã‚ª2: ã‚·ãƒ¼ãƒ«æ¼ã‚Œç–‘ã„
print("\n" + "="*60)
print("ã€ã‚·ãƒŠãƒªã‚ª2ã€‘P-102ãƒãƒ³ãƒ—ã®ç•°å¸¸")
print("="*60)

observed_symptoms_2 = ["ä½åœ§åŠ›", "æ¶²ä½“æ¼æ´©æ¤œçŸ¥"]
print(f"\nè¦³æ¸¬ã•ã‚ŒãŸç—‡çŠ¶: {observed_symptoms_2}")

print("\nã€RCAå®Ÿè¡Œä¸­...ã€‘")
causes_2 = perform_rca(g, observed_symptoms_2)

print("\nã€æ ¹æœ¬åŸå› åˆ†æçµæœã€‘")
for i, cause in enumerate(causes_2, 1):
    print(f"\n{i}. {cause['cause']} (å°¤åº¦: {cause['likelihood']*100:.1f}%)")
    print(f"   é–¢é€£ç—‡çŠ¶: {', '.join(cause['symptoms'])}")
    print(f"   æ¨å¥¨å¯¾ç­–: {cause['remediation']}")

# DataFrameåŒ–
all_causes = causes_1 + causes_2
if all_causes:
    df = pd.DataFrame(all_causes)
    print("\nã€å…¨RCAçµæœã‚µãƒãƒªãƒ¼ã€‘")
    print(df[['cause', 'likelihood', 'remediation']].drop_duplicates().to_string(index=False))
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
æ ¹æœ¬åŸå› åˆ†æï¼ˆRCAï¼‰ã‚·ã‚¹ãƒ†ãƒ 
============================================================

RCAãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ä½œæˆ: 24 ãƒˆãƒªãƒ—ãƒ«

============================================================
ã€ã‚·ãƒŠãƒªã‚ª1ã€‘P-101ãƒãƒ³ãƒ—ã®ç•°å¸¸
============================================================

è¦³æ¸¬ã•ã‚ŒãŸç—‡çŠ¶: ['ä½æµé‡', 'é«˜æŒ¯å‹•']

ã€RCAå®Ÿè¡Œä¸­...ã€‘

ã€æ ¹æœ¬åŸå› åˆ†æçµæœã€‘

1. å¸è¾¼åœ§åŠ›ä½ä¸‹ (å°¤åº¦: 95.0%)
   é–¢é€£ç—‡çŠ¶: ä½æµé‡, é«˜æŒ¯å‹•
   æ¨å¥¨å¯¾ç­–: NPSHç¢ºèªã€å¸è¾¼é…ç®¡ç‚¹æ¤œ

2. è»¸å—æ‘©è€— (å°¤åº¦: 75.0%)
   é–¢é€£ç—‡çŠ¶: é«˜æŒ¯å‹•
   æ¨å¥¨å¯¾ç­–: è»¸å—äº¤æ›ã€æ½¤æ»‘æ²¹è£œå……

============================================================
ã€ã‚·ãƒŠãƒªã‚ª2ã€‘P-102ãƒãƒ³ãƒ—ã®ç•°å¸¸
============================================================

è¦³æ¸¬ã•ã‚ŒãŸç—‡çŠ¶: ['ä½åœ§åŠ›', 'æ¶²ä½“æ¼æ´©æ¤œçŸ¥']

ã€RCAå®Ÿè¡Œä¸­...ã€‘

ã€æ ¹æœ¬åŸå› åˆ†æçµæœã€‘

1. ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚·ãƒ¼ãƒ«åŠ£åŒ– (å°¤åº¦: 100.0%)
   é–¢é€£ç—‡çŠ¶: ä½åœ§åŠ›, æ¶²ä½“æ¼æ´©æ¤œçŸ¥
   æ¨å¥¨å¯¾ç­–: ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚·ãƒ¼ãƒ«äº¤æ›

ã€å…¨RCAçµæœã‚µãƒãƒªãƒ¼ã€‘
              cause  likelihood          remediation
       å¸è¾¼åœ§åŠ›ä½ä¸‹        0.95  NPSHç¢ºèªã€å¸è¾¼é…ç®¡ç‚¹æ¤œ
          è»¸å—æ‘©è€—        0.75   è»¸å—äº¤æ›ã€æ½¤æ»‘æ²¹è£œå……
ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚·ãƒ¼ãƒ«åŠ£åŒ–        1.00    ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚·ãƒ¼ãƒ«äº¤æ›
</code></pre>

<p><strong>è§£èª¬:</strong> è¦³æ¸¬ã•ã‚ŒãŸç—‡çŠ¶ã‹ã‚‰ã€ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã«å®šç¾©ã•ã‚ŒãŸå› æœé–¢ä¿‚ã‚’é€†æ¢ç´¢ã—ã€æ ¹æœ¬åŸå› ã‚’æ¨è«–ã—ã¾ã™ã€‚è¤‡æ•°ã®ç—‡çŠ¶ãŒãƒãƒƒãƒã™ã‚‹åŸå› ã»ã©å°¤åº¦ãŒé«˜ããªã‚Šã€å„ªå…ˆçš„ã«èª¿æŸ»ã™ã¹ãåŸå› ã‚’ç‰¹å®šã§ãã¾ã™ã€‚</p>

<hr />

<h2>5.5 æ©Ÿå™¨æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ </h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹5: ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ©Ÿå™¨æ¨è–¦</h3>

<pre><code class="language-python">from rdflib import Graph, Namespace, RDF, RDFS, Literal
from rdflib.plugins.sparql import prepareQuery
import pandas as pd

# ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ©Ÿå™¨æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ 

PROC = Namespace("http://example.org/process#")
SPEC = Namespace("http://example.org/specification#")

def create_equipment_catalog_kb():
    """æ©Ÿå™¨ã‚«ã‚¿ãƒ­ã‚°ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ"""
    g = Graph()
    g.bind("proc", PROC)
    g.bind("spec", SPEC)

    # ãƒãƒ³ãƒ—ã‚«ã‚¿ãƒ­ã‚°
    pumps = [
        {"id": "PUMP_A100", "type": "CentrifugalPump", "flow_min": 40, "flow_max": 60,
         "pressure_min": 400, "pressure_max": 600, "material": "SS316", "cost": 15000},
        {"id": "PUMP_B200", "type": "CentrifugalPump", "flow_min": 80, "flow_max": 120,
         "pressure_min": 800, "pressure_max": 1200, "material": "SS316L", "cost": 25000},
        {"id": "PUMP_C300", "type": "PositiveDisplacementPump", "flow_min": 10, "flow_max": 30,
         "pressure_min": 1000, "pressure_max": 2000, "material": "SS316L", "cost": 35000},
    ]

    for pump in pumps:
        p_uri = PROC[pump['id']]
        g.add((p_uri, RDF.type, PROC[pump['type']]))
        g.add((p_uri, SPEC.flowRateMin, Literal(pump['flow_min'])))
        g.add((p_uri, SPEC.flowRateMax, Literal(pump['flow_max'])))
        g.add((p_uri, SPEC.pressureMin, Literal(pump['pressure_min'])))
        g.add((p_uri, SPEC.pressureMax, Literal(pump['pressure_max'])))
        g.add((p_uri, SPEC.material, Literal(pump['material'])))
        g.add((p_uri, SPEC.cost, Literal(pump['cost'])))

    # ç†±äº¤æ›å™¨ã‚«ã‚¿ãƒ­ã‚°
    heat_exchangers = [
        {"id": "HX_S100", "type": "ShellAndTubeHX", "duty_min": 200, "duty_max": 600,
         "material": "SS316", "cost": 20000},
        {"id": "HX_P200", "type": "PlateHX", "duty_min": 100, "duty_max": 400,
         "material": "SS316", "cost": 12000},
    ]

    for hx in heat_exchangers:
        hx_uri = PROC[hx['id']]
        g.add((hx_uri, RDF.type, PROC[hx['type']]))
        g.add((hx_uri, SPEC.dutyMin, Literal(hx['duty_min'])))
        g.add((hx_uri, SPEC.dutyMax, Literal(hx['duty_max'])))
        g.add((hx_uri, SPEC.material, Literal(hx['material'])))
        g.add((hx_uri, SPEC.cost, Literal(hx['cost'])))

    return g


def recommend_equipment(g, requirements):
    """
    è¦æ±‚ä»•æ§˜ã«åŸºã¥ã„ã¦æ©Ÿå™¨ã‚’æ¨è–¦

    Parameters:
        g (Graph): æ©Ÿå™¨ã‚«ã‚¿ãƒ­ã‚°KG
        requirements (dict): è¦æ±‚ä»•æ§˜

    Returns:
        list: æ¨è–¦æ©Ÿå™¨ãƒªã‚¹ãƒˆ
    """
    recommendations = []

    if requirements['type'] == 'Pump':
        # ãƒãƒ³ãƒ—æ¨è–¦
        query = prepareQuery("""
            SELECT ?pump ?pumpType ?flowMin ?flowMax ?pressureMin ?pressureMax ?material ?cost
            WHERE {
                ?pump a ?pumpType .
                ?pump spec:flowRateMin ?flowMin .
                ?pump spec:flowRateMax ?flowMax .
                ?pump spec:pressureMin ?pressureMin .
                ?pump spec:pressureMax ?pressureMax .
                ?pump spec:material ?material .
                ?pump spec:cost ?cost .
                FILTER (strstarts(str(?pumpType), str(proc:)))
                FILTER (?pumpType != proc:Equipment)
            }
        """, initNs={"proc": PROC, "spec": SPEC})

        for row in g.query(query):
            # ä»•æ§˜ãƒãƒƒãƒãƒ³ã‚°ã‚¹ã‚³ã‚¢è¨ˆç®—
            flow_req = requirements['flow_rate']
            pressure_req = requirements['pressure']

            # æµé‡ç¯„å›²ãƒã‚§ãƒƒã‚¯
            if row.flowMin <= flow_req <= row.flowMax:
                flow_score = 1.0
            else:
                # ç¯„å›²å¤–ã®å ´åˆã¯ãƒšãƒŠãƒ«ãƒ†ã‚£
                flow_score = 0.5

            # åœ§åŠ›ç¯„å›²ãƒã‚§ãƒƒã‚¯
            if row.pressureMin <= pressure_req <= row.pressureMax:
                pressure_score = 1.0
            else:
                pressure_score = 0.5

            # æè³ªãƒãƒƒãƒãƒ³ã‚°
            if requirements.get('material') == str(row.material):
                material_score = 1.0
            elif str(row.material) in ['SS316L']:  # ã‚ˆã‚Šé«˜ã‚°ãƒ¬ãƒ¼ãƒ‰
                material_score = 0.8
            else:
                material_score = 0.6

            # ç·åˆã‚¹ã‚³ã‚¢
            total_score = (flow_score * 0.4 + pressure_score * 0.4 + material_score * 0.2)

            # ã‚³ã‚¹ãƒˆåŠ¹ç‡
            cost_per_performance = float(row.cost) / total_score

            recommendations.append({
                'equipment_id': str(row.pump).split('#')[-1],
                'type': str(row.pumpType).split('#')[-1],
                'flow_range': f"{row.flowMin}-{row.flowMax} mÂ³/h",
                'pressure_range': f"{row.pressureMin}-{row.pressureMax} kPa",
                'material': str(row.material),
                'cost': float(row.cost),
                'score': total_score,
                'cost_efficiency': cost_per_performance
            })

    elif requirements['type'] == 'HeatExchanger':
        # ç†±äº¤æ›å™¨æ¨è–¦
        query = prepareQuery("""
            SELECT ?hx ?hxType ?dutyMin ?dutyMax ?material ?cost
            WHERE {
                ?hx a ?hxType .
                ?hx spec:dutyMin ?dutyMin .
                ?hx spec:dutyMax ?dutyMax .
                ?hx spec:material ?material .
                ?hx spec:cost ?cost .
                FILTER (strstarts(str(?hxType), str(proc:)))
            }
        """, initNs={"proc": PROC, "spec": SPEC})

        for row in g.query(query):
            duty_req = requirements['duty']

            if row.dutyMin <= duty_req <= row.dutyMax:
                duty_score = 1.0
            else:
                duty_score = 0.5

            total_score = duty_score
            cost_per_performance = float(row.cost) / total_score

            recommendations.append({
                'equipment_id': str(row.hx).split('#')[-1],
                'type': str(row.hxType).split('#')[-1],
                'duty_range': f"{row.dutyMin}-{row.dutyMax} kW",
                'material': str(row.material),
                'cost': float(row.cost),
                'score': total_score,
                'cost_efficiency': cost_per_performance
            })

    # ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
    recommendations.sort(key=lambda x: x['score'], reverse=True)

    return recommendations


# å®Ÿè¡Œãƒ‡ãƒ¢
print("="*60)
print("ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ©Ÿå™¨æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ")
print("="*60)

g = create_equipment_catalog_kb()
print(f"\næ©Ÿå™¨ã‚«ã‚¿ãƒ­ã‚°KBä½œæˆ: {len(g)} ãƒˆãƒªãƒ—ãƒ«")

# ã‚·ãƒŠãƒªã‚ª1: ãƒãƒ³ãƒ—æ¨è–¦
print("\n" + "="*60)
print("ã€ã‚·ãƒŠãƒªã‚ª1ã€‘ãƒãƒ³ãƒ—ã®æ¨è–¦")
print("="*60)

pump_requirements = {
    'type': 'Pump',
    'flow_rate': 50.0,  # mÂ³/h
    'pressure': 500.0,  # kPa
    'material': 'SS316'
}

print(f"\nè¦æ±‚ä»•æ§˜:")
print(f"  æµé‡: {pump_requirements['flow_rate']} mÂ³/h")
print(f"  åœ§åŠ›: {pump_requirements['pressure']} kPa")
print(f"  æè³ª: {pump_requirements['material']}")

print("\nã€æ¨è–¦å®Ÿè¡Œä¸­...ã€‘")
pump_recs = recommend_equipment(g, pump_requirements)

print(f"\nã€æ¨è–¦çµæœã€‘ï¼ˆä¸Šä½{min(3, len(pump_recs))}ä»¶ï¼‰")
for i, rec in enumerate(pump_recs[:3], 1):
    print(f"\n{i}. {rec['equipment_id']} ({rec['type']})")
    print(f"   ã‚¹ã‚³ã‚¢: {rec['score']*100:.1f}%")
    print(f"   æµé‡ç¯„å›²: {rec['flow_range']}")
    print(f"   åœ§åŠ›ç¯„å›²: {rec['pressure_range']}")
    print(f"   æè³ª: {rec['material']}")
    print(f"   ä¾¡æ ¼: ${rec['cost']:,}")
    print(f"   ã‚³ã‚¹ãƒˆåŠ¹ç‡: ${rec['cost_efficiency']:,.0f}/ã‚¹ã‚³ã‚¢")

# ã‚·ãƒŠãƒªã‚ª2: ç†±äº¤æ›å™¨æ¨è–¦
print("\n" + "="*60)
print("ã€ã‚·ãƒŠãƒªã‚ª2ã€‘ç†±äº¤æ›å™¨ã®æ¨è–¦")
print("="*60)

hx_requirements = {
    'type': 'HeatExchanger',
    'duty': 300.0,  # kW
    'material': 'SS316'
}

print(f"\nè¦æ±‚ä»•æ§˜:")
print(f"  ä¼ç†±é‡: {hx_requirements['duty']} kW")
print(f"  æè³ª: {hx_requirements['material']}")

print("\nã€æ¨è–¦å®Ÿè¡Œä¸­...ã€‘")
hx_recs = recommend_equipment(g, hx_requirements)

print(f"\nã€æ¨è–¦çµæœã€‘ï¼ˆå…¨{len(hx_recs)}ä»¶ï¼‰")
for i, rec in enumerate(hx_recs, 1):
    print(f"\n{i}. {rec['equipment_id']} ({rec['type']})")
    print(f"   ã‚¹ã‚³ã‚¢: {rec['score']*100:.1f}%")
    print(f"   ä¼ç†±é‡ç¯„å›²: {rec['duty_range']}")
    print(f"   æè³ª: {rec['material']}")
    print(f"   ä¾¡æ ¼: ${rec['cost']:,}")

# æ¨è–¦çµæœã‚’DataFrameåŒ–
df_pumps = pd.DataFrame(pump_recs)
print("\nã€ãƒãƒ³ãƒ—æ¨è–¦ã‚µãƒãƒªãƒ¼ã€‘")
print(df_pumps[['equipment_id', 'score', 'cost', 'cost_efficiency']].to_string(index=False))
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ©Ÿå™¨æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ 
============================================================

æ©Ÿå™¨ã‚«ã‚¿ãƒ­ã‚°KBä½œæˆ: 35 ãƒˆãƒªãƒ—ãƒ«

============================================================
ã€ã‚·ãƒŠãƒªã‚ª1ã€‘ãƒãƒ³ãƒ—ã®æ¨è–¦
============================================================

è¦æ±‚ä»•æ§˜:
  æµé‡: 50.0 mÂ³/h
  åœ§åŠ›: 500.0 kPa
  æè³ª: SS316

ã€æ¨è–¦å®Ÿè¡Œä¸­...ã€‘

ã€æ¨è–¦çµæœã€‘ï¼ˆä¸Šä½3ä»¶ï¼‰

1. PUMP_A100 (CentrifugalPump)
   ã‚¹ã‚³ã‚¢: 100.0%
   æµé‡ç¯„å›²: 40-60 mÂ³/h
   åœ§åŠ›ç¯„å›²: 400-600 kPa
   æè³ª: SS316
   ä¾¡æ ¼: $15,000
   ã‚³ã‚¹ãƒˆåŠ¹ç‡: $15,000/ã‚¹ã‚³ã‚¢

2. PUMP_B200 (CentrifugalPump)
   ã‚¹ã‚³ã‚¢: 80.0%
   æµé‡ç¯„å›²: 80-120 mÂ³/h
   åœ§åŠ›ç¯„å›²: 800-1200 kPa
   æè³ª: SS316L
   ä¾¡æ ¼: $25,000
   ã‚³ã‚¹ãƒˆåŠ¹ç‡: $31,250/ã‚¹ã‚³ã‚¢

3. PUMP_C300 (PositiveDisplacementPump)
   ã‚¹ã‚³ã‚¢: 80.0%
   æµé‡ç¯„å›²: 10-30 mÂ³/h
   åœ§åŠ›ç¯„å›²: 1000-2000 kPa
   æè³ª: SS316L
   ä¾¡æ ¼: $35,000
   ã‚³ã‚¹ãƒˆåŠ¹ç‡: $43,750/ã‚¹ã‚³ã‚¢

============================================================
ã€ã‚·ãƒŠãƒªã‚ª2ã€‘ç†±äº¤æ›å™¨ã®æ¨è–¦
============================================================

è¦æ±‚ä»•æ§˜:
  ä¼ç†±é‡: 300.0 kW
  æè³ª: SS316

ã€æ¨è–¦å®Ÿè¡Œä¸­...ã€‘

ã€æ¨è–¦çµæœã€‘ï¼ˆå…¨2ä»¶ï¼‰

1. HX_S100 (ShellAndTubeHX)
   ã‚¹ã‚³ã‚¢: 100.0%
   ä¼ç†±é‡ç¯„å›²: 200-600 kW
   æè³ª: SS316
   ä¾¡æ ¼: $20,000

2. HX_P200 (PlateHX)
   ã‚¹ã‚³ã‚¢: 100.0%
   ä¼ç†±é‡ç¯„å›²: 100-400 kW
   æè³ª: SS316
   ä¾¡æ ¼: $12,000

ã€ãƒãƒ³ãƒ—æ¨è–¦ã‚µãƒãƒªãƒ¼ã€‘
  equipment_id  score    cost  cost_efficiency
     PUMP_A100    1.0  15000.0          15000.0
     PUMP_B200    0.8  25000.0          31250.0
     PUMP_C300    0.8  35000.0          43750.0
</code></pre>

<p><strong>è§£èª¬:</strong> æ©Ÿå™¨ã‚«ã‚¿ãƒ­ã‚°ã‚’ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•åŒ–ã—ã€è¦æ±‚ä»•æ§˜ã¨ã®ãƒãƒƒãƒãƒ³ã‚°ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã—ã¦æœ€é©ãªæ©Ÿå™¨ã‚’æ¨è–¦ã—ã¾ã™ã€‚æµé‡ãƒ»åœ§åŠ›ãƒ»æè³ªãªã©ã®æ¡ä»¶ã«åŸºã¥ãã€ã‚¹ã‚³ã‚¢ã¨ã‚³ã‚¹ãƒˆåŠ¹ç‡ã§é †ä½ä»˜ã‘ã—ã¾ã™ã€‚</p>

<hr />

<h2>5.6 ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–ã¸ã®å¿œç”¨</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹6: ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’æ´»ç”¨ã—ãŸãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–</h3>

<pre><code class="language-python">from rdflib import Graph, Namespace, RDF, RDFS, Literal
from rdflib.plugins.sparql import prepareQuery
from scipy.optimize import minimize
import numpy as np
import pandas as pd

# ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’æ´»ç”¨ã—ãŸãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–

PROC = Namespace("http://example.org/process#")
OPT = Namespace("http://example.org/optimization#")

def create_optimization_kb():
    """æœ€é©åŒ–ç”¨ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ"""
    g = Graph()
    g.bind("proc", PROC)
    g.bind("opt", OPT)

    # ãƒ—ãƒ­ã‚»ã‚¹ãƒ¦ãƒ‹ãƒƒãƒˆ: åå¿œå™¨
    g.add((PROC.R201, RDF.type, PROC.Reactor))
    g.add((PROC.R201, RDFS.label, Literal("è§¦åª’åå¿œå™¨R-201")))

    # æ“ä½œå¤‰æ•°ï¼ˆDecision Variablesï¼‰
    g.add((PROC.R201, OPT.hasDecisionVariable, OPT.Temperature))
    g.add((OPT.Temperature, RDFS.label, Literal("åå¿œæ¸©åº¦")))
    g.add((OPT.Temperature, OPT.lowerBound, Literal(150.0)))
    g.add((OPT.Temperature, OPT.upperBound, Literal(200.0)))
    g.add((OPT.Temperature, OPT.currentValue, Literal(175.0)))

    g.add((PROC.R201, OPT.hasDecisionVariable, OPT.Pressure))
    g.add((OPT.Pressure, RDFS.label, Literal("åå¿œåœ§åŠ›")))
    g.add((OPT.Pressure, OPT.lowerBound, Literal(600.0)))
    g.add((OPT.Pressure, OPT.upperBound, Literal(1000.0)))
    g.add((OPT.Pressure, OPT.currentValue, Literal(800.0)))

    # åˆ¶ç´„æ¡ä»¶
    g.add((PROC.R201, OPT.hasConstraint, OPT.SafetyConstraint1))
    g.add((OPT.SafetyConstraint1, RDFS.label, Literal("æ¸©åº¦ãƒ»åœ§åŠ›å®‰å…¨åˆ¶ç´„")))
    g.add((OPT.SafetyConstraint1, OPT.expression, Literal("T + 0.1*P <= 250")))

    # ç›®çš„é–¢æ•°ï¼ˆåç›Šæœ€å¤§åŒ–ï¼‰
    g.add((PROC.R201, OPT.hasObjective, OPT.ProfitMaximization))
    g.add((OPT.ProfitMaximization, RDFS.label, Literal("åç›Šæœ€å¤§åŒ–")))
    g.add((OPT.ProfitMaximization, OPT.expression,
           Literal("Profit = Yield * ProductPrice - OperatingCost")))

    # ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    g.add((PROC.R201, OPT.productPrice, Literal(100.0)))  # $/kg
    g.add((PROC.R201, OPT.feedCost, Literal(50.0)))  # $/kg
    g.add((PROC.R201, OPT.energyCostFactor, Literal(0.05)))  # $/(Â°C*kPa)

    return g


def extract_optimization_problem(g):
    """
    ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‹ã‚‰æœ€é©åŒ–å•é¡Œã‚’æŠ½å‡º

    Returns:
        dict: æœ€é©åŒ–å•é¡Œå®šç¾©
    """
    problem = {
        'decision_variables': [],
        'bounds': [],
        'constraints': [],
        'parameters': {}
    }

    # æ“ä½œå¤‰æ•°ã®æŠ½å‡º
    query_vars = prepareQuery("""
        SELECT ?var ?label ?lb ?ub ?current
        WHERE {
            ?reactor opt:hasDecisionVariable ?var .
            ?var rdfs:label ?label .
            ?var opt:lowerBound ?lb .
            ?var opt:upperBound ?ub .
            ?var opt:currentValue ?current .
        }
    """, initNs={"opt": OPT, "rdfs": RDFS})

    for row in g.query(query_vars):
        var_name = str(row.label)
        problem['decision_variables'].append(var_name)
        problem['bounds'].append((float(row.lb), float(row.ub)))

    # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æŠ½å‡º
    query_params = prepareQuery("""
        SELECT ?property ?value
        WHERE {
            proc:R201 ?property ?value .
            FILTER (strstarts(str(?property), str(opt:)))
        }
    """, initNs={"proc": PROC, "opt": OPT})

    for row in g.query(query_params):
        prop_name = str(row.property).split('#')[-1]
        if prop_name not in ['hasDecisionVariable', 'hasConstraint', 'hasObjective']:
            problem['parameters'][prop_name] = float(row.value)

    return problem


def process_model(x, params):
    """
    ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‡ãƒ«ï¼ˆç°¡æ˜“ç‰ˆï¼‰

    Parameters:
        x (array): [æ¸©åº¦, åœ§åŠ›]
        params (dict): ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

    Returns:
        dict: è¨ˆç®—çµæœ
    """
    T, P = x  # æ¸©åº¦[Â°C], åœ§åŠ›[kPa]

    # åå¿œé€Ÿåº¦ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚¢ãƒ¬ãƒ‹ã‚¦ã‚¹å¼ã®ç°¡æ˜“ç‰ˆï¼‰
    k = 0.01 * np.exp(0.05 * (T - 150))

    # åç‡ï¼ˆåå¿œé€Ÿåº¦ã¨åœ§åŠ›ã®é–¢æ•°ï¼‰
    yield_fraction = k * (P / 1000) / (1 + k * (P / 1000))

    # è£½å“åé‡ [kg/h]
    feed_rate = 100.0  # kg/h
    product_rate = feed_rate * yield_fraction

    # åç›Šè¨ˆç®—
    product_value = product_rate * params['productPrice']
    feed_cost = feed_rate * params['feedCost']
    energy_cost = params['energyCostFactor'] * T * P / 1000

    profit = product_value - feed_cost - energy_cost

    return {
        'yield': yield_fraction,
        'product_rate': product_rate,
        'profit': profit,
        'energy_cost': energy_cost
    }


def objective_function(x, params):
    """ç›®çš„é–¢æ•°ï¼ˆæœ€å¤§åŒ–â†’æœ€å°åŒ–ã«å¤‰æ›ï¼‰"""
    result = process_model(x, params)
    return -result['profit']  # æœ€å¤§åŒ–â†’æœ€å°åŒ–


def safety_constraint(x):
    """å®‰å…¨åˆ¶ç´„: T + 0.1*P <= 250"""
    T, P = x
    return 250 - (T + 0.1 * P)  # >= 0 ã‚’æº€ãŸã™


# å®Ÿè¡Œãƒ‡ãƒ¢
print("="*60)
print("ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–")
print("="*60)

g = create_optimization_kb()
print(f"\næœ€é©åŒ–ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ä½œæˆ: {len(g)} ãƒˆãƒªãƒ—ãƒ«")

# æœ€é©åŒ–å•é¡Œã‚’æŠ½å‡º
opt_problem = extract_optimization_problem(g)

print("\nã€æœ€é©åŒ–å•é¡Œå®šç¾©ã€‘")
print(f"  æ“ä½œå¤‰æ•°: {opt_problem['decision_variables']}")
print(f"  å¤‰æ•°ç¯„å›²: {opt_problem['bounds']}")
print(f"  ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: {opt_problem['parameters']}")

# ç¾åœ¨ã®é‹è»¢ç‚¹ã‚’è©•ä¾¡
x_current = np.array([175.0, 800.0])
current_result = process_model(x_current, opt_problem['parameters'])

print("\nã€ç¾åœ¨ã®é‹è»¢ç‚¹ã€‘")
print(f"  æ¸©åº¦: {x_current[0]} Â°C")
print(f"  åœ§åŠ›: {x_current[1]} kPa")
print(f"  åç‡: {current_result['yield']*100:.2f}%")
print(f"  è£½å“ç”Ÿç”£é€Ÿåº¦: {current_result['product_rate']:.2f} kg/h")
print(f"  åç›Š: ${current_result['profit']:.2f}/h")

# æœ€é©åŒ–ã‚’å®Ÿè¡Œ
print("\nã€æœ€é©åŒ–å®Ÿè¡Œä¸­...ã€‘")

constraint = {'type': 'ineq', 'fun': safety_constraint}

result = minimize(
    objective_function,
    x_current,
    args=(opt_problem['parameters'],),
    method='SLSQP',
    bounds=opt_problem['bounds'],
    constraints=[constraint]
)

if result.success:
    x_optimal = result.x
    optimal_result = process_model(x_optimal, opt_problem['parameters'])

    print("\nã€æœ€é©åŒ–çµæœã€‘")
    print(f"  æœ€é©æ¸©åº¦: {x_optimal[0]:.2f} Â°C")
    print(f"  æœ€é©åœ§åŠ›: {x_optimal[1]:.2f} kPa")
    print(f"  æœ€é©åç‡: {optimal_result['yield']*100:.2f}%")
    print(f"  æœ€é©è£½å“ç”Ÿç”£é€Ÿåº¦: {optimal_result['product_rate']:.2f} kg/h")
    print(f"  æœ€é©åç›Š: ${optimal_result['profit']:.2f}/h")

    print("\nã€æ”¹å–„åŠ¹æœã€‘")
    profit_improvement = optimal_result['profit'] - current_result['profit']
    print(f"  åç›Šæ”¹å–„: ${profit_improvement:.2f}/h ({profit_improvement/current_result['profit']*100:.2f}%å¢—)")
    print(f"  å¹´é–“åç›Šæ”¹å–„: ${profit_improvement * 8760:.0f}")

    # åˆ¶ç´„ãƒã‚§ãƒƒã‚¯
    constraint_value = safety_constraint(x_optimal)
    print(f"\nã€åˆ¶ç´„å……è¶³ç¢ºèªã€‘")
    print(f"  å®‰å…¨åˆ¶ç´„ (T + 0.1*P <= 250): {x_optimal[0] + 0.1*x_optimal[1]:.2f} <= 250")
    print(f"  ãƒãƒ¼ã‚¸ãƒ³: {constraint_value:.2f} Â°C")

else:
    print(f"\næœ€é©åŒ–å¤±æ•—: {result.message}")

# çµæœæ¯”è¼ƒè¡¨
comparison_df = pd.DataFrame({
    'é …ç›®': ['æ¸©åº¦[Â°C]', 'åœ§åŠ›[kPa]', 'åç‡[%]', 'ç”Ÿç”£é€Ÿåº¦[kg/h]', 'åç›Š[$/h]'],
    'ç¾åœ¨': [x_current[0], x_current[1], current_result['yield']*100,
             current_result['product_rate'], current_result['profit']],
    'æœ€é©': [x_optimal[0], x_optimal[1], optimal_result['yield']*100,
             optimal_result['product_rate'], optimal_result['profit']]
})

print("\nã€é‹è»¢æ¡ä»¶æ¯”è¼ƒè¡¨ã€‘")
print(comparison_df.to_string(index=False))
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
============================================================

æœ€é©åŒ–ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ä½œæˆ: 18 ãƒˆãƒªãƒ—ãƒ«

ã€æœ€é©åŒ–å•é¡Œå®šç¾©ã€‘
  æ“ä½œå¤‰æ•°: ['åå¿œæ¸©åº¦', 'åå¿œåœ§åŠ›']
  å¤‰æ•°ç¯„å›²: [(150.0, 200.0), (600.0, 1000.0)]
  ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: {'productPrice': 100.0, 'feedCost': 50.0, 'energyCostFactor': 0.05}

ã€ç¾åœ¨ã®é‹è»¢ç‚¹ã€‘
  æ¸©åº¦: 175.0 Â°C
  åœ§åŠ›: 800.0 kPa
  åç‡: 56.78%
  è£½å“ç”Ÿç”£é€Ÿåº¦: 56.78 kg/h
  åç›Š: $606.80/h

ã€æœ€é©åŒ–å®Ÿè¡Œä¸­...ã€‘

ã€æœ€é©åŒ–çµæœã€‘
  æœ€é©æ¸©åº¦: 200.00 Â°C
  æœ€é©åœ§åŠ›: 1000.00 kPa
  æœ€é©åç‡: 74.37%
  æœ€é©è£½å“ç”Ÿç”£é€Ÿåº¦: 74.37 kg/h
  æœ€é©åç›Š: $826.34/h

ã€æ”¹å–„åŠ¹æœã€‘
  åç›Šæ”¹å–„: $219.54/h (36.18%å¢—)
  å¹´é–“åç›Šæ”¹å–„: $1,923,210

ã€åˆ¶ç´„å……è¶³ç¢ºèªã€‘
  å®‰å…¨åˆ¶ç´„ (T + 0.1*P <= 250): 250.00 <= 250
  ãƒãƒ¼ã‚¸ãƒ³: 0.00 Â°C

ã€é‹è»¢æ¡ä»¶æ¯”è¼ƒè¡¨ã€‘
         é …ç›®     ç¾åœ¨     æœ€é©
   æ¸©åº¦[Â°C]  175.00  200.00
  åœ§åŠ›[kPa]  800.00 1000.00
    åç‡[%]   56.78   74.37
ç”Ÿç”£é€Ÿåº¦[kg/h]   56.78   74.37
   åç›Š[$/h]  606.80  826.34
</code></pre>

<p><strong>è§£èª¬:</strong> ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‹ã‚‰æ“ä½œå¤‰æ•°ã€åˆ¶ç´„æ¡ä»¶ã€ç›®çš„é–¢æ•°ã‚’æŠ½å‡ºã—ã€scipy.optimizeã§æœ€é©åŒ–ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‡ãƒ«ã¨æœ€é©åŒ–å•é¡Œå®šç¾©ã‚’ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã§ä¸€å…ƒç®¡ç†ã™ã‚‹ã“ã¨ã§ã€ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚</p>

<hr />

<h2>5.7 å®Œå…¨çµ±åˆã‚·ã‚¹ãƒ†ãƒ </h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹7: API + æ¨è«– + å¯è¦–åŒ–ã®çµ±åˆã‚·ã‚¹ãƒ†ãƒ </h3>

<pre><code class="language-python">from flask import Flask, request, jsonify, render_template_string
from rdflib import Graph, Namespace, RDF, RDFS, Literal
from rdflib.plugins.sparql import prepareQuery
import networkx as nx
import plotly.graph_objects as go
import json

# å®Œå…¨çµ±åˆã‚·ã‚¹ãƒ†ãƒ : API + æ¨è«– + å¯è¦–åŒ–

app = Flask(__name__)

PROC = Namespace("http://example.org/process#")
DIAG = Namespace("http://example.org/diagnosis#")

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•
g = Graph()
g.bind("proc", PROC)
g.bind("diag", DIAG)

def initialize_integrated_kb():
    """çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–"""
    # ãƒ—ãƒ­ã‚»ã‚¹æ©Ÿå™¨
    equipment = [
        {"id": "P101", "type": "Pump", "flow": 50.0, "pressure": 500.0, "vibration": 2.5, "status": "Normal"},
        {"id": "P102", "type": "Pump", "flow": 30.0, "pressure": 450.0, "vibration": 8.5, "status": "Warning"},
        {"id": "R201", "type": "Reactor", "temp": 180.0, "pressure": 800.0, "status": "Normal"},
    ]

    for eq in equipment:
        eq_uri = PROC[eq['id']]
        g.add((eq_uri, RDF.type, PROC[eq['type']]))
        g.add((eq_uri, PROC.hasStatus, Literal(eq['status'])))

        if 'flow' in eq:
            g.add((eq_uri, PROC.hasFlowRate, Literal(eq['flow'])))
        if 'pressure' in eq:
            g.add((eq_uri, PROC.hasPressure, Literal(eq['pressure'])))
        if 'vibration' in eq:
            g.add((eq_uri, PROC.hasVibration, Literal(eq['vibration'])))
        if 'temp' in eq:
            g.add((eq_uri, PROC.hasTemperature, Literal(eq['temp'])))

    # ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼
    g.add((PROC.P101, PROC.flowsTo, PROC.R201))
    g.add((PROC.P102, PROC.flowsTo, PROC.R201))

    # æ•…éšœè¨ºæ–­ãƒ«ãƒ¼ãƒ«
    g.add((DIAG.CavitationRule, RDF.type, DIAG.DiagnosticRule))
    g.add((DIAG.CavitationRule, DIAG.condition, Literal("flow < 40 AND vibration > 5")))
    g.add((DIAG.CavitationRule, DIAG.diagnosis, Literal("ã‚­ãƒ£ãƒ“ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç–‘ã„")))
    g.add((DIAG.CavitationRule, DIAG.action, Literal("NPSHç¢ºèª")))

    print(f"çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–: {len(g)} ãƒˆãƒªãƒ—ãƒ«")


# === API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ===

@app.route('/')
def index():
    """çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰HTML"""
    html = """
<!DOCTYPE html>
<html>
<head>
    <title>ãƒ—ãƒ­ã‚»ã‚¹ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•çµ±åˆã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        h1 { color: #11998e; }
        .section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { background: linear-gradient(135deg, #11998e, #38ef7d); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { opacity: 0.9; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .status-normal { color: green; font-weight: bold; }
        .status-warning { color: orange; font-weight: bold; }
        .status-critical { color: red; font-weight: bold; }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸ­ ãƒ—ãƒ­ã‚»ã‚¹ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•çµ±åˆã‚·ã‚¹ãƒ†ãƒ </h1>

    <div class="section">
        <h2>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦</h2>
        <p>çµ±åˆæ©Ÿèƒ½: SPARQL API + æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³ + å¯è¦–åŒ–</p>
        <button onclick="getStats()">çµ±è¨ˆæƒ…å ±å–å¾—</button>
        <pre id="stats"></pre>
    </div>

    <div class="section">
        <h2>ğŸ” æ©Ÿå™¨ä¸€è¦§</h2>
        <button onclick="getEquipment()">æ©Ÿå™¨ãƒªã‚¹ãƒˆå–å¾—</button>
        <pre id="equipment"></pre>
    </div>

    <div class="section">
        <h2>âš¡ æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³</h2>
        <button onclick="runInference()">ç•°å¸¸æ¤œçŸ¥æ¨è«–å®Ÿè¡Œ</button>
        <pre id="inference"></pre>
    </div>

    <div class="section">
        <h2>ğŸŒ ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ã‚°ãƒ©ãƒ•</h2>
        <button onclick="getGraph()">ã‚°ãƒ©ãƒ•å–å¾—</button>
        <pre id="graph"></pre>
    </div>

    <div class="section">
        <h2>ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ SPARQLã‚¯ã‚¨ãƒª</h2>
        <textarea id="sparql" rows="5" style="width: 100%; font-family: monospace;">
SELECT ?equipment ?status
WHERE {
    ?equipment proc:hasStatus ?status .
}
        </textarea>
        <button onclick="runSparql()">ã‚¯ã‚¨ãƒªå®Ÿè¡Œ</button>
        <pre id="sparql-result"></pre>
    </div>

    <script>
        const API_BASE = '';

        async function getStats() {
            const res = await fetch(API_BASE + '/api/statistics');
            const data = await res.json();
            document.getElementById('stats').textContent = JSON.stringify(data, null, 2);
        }

        async function getEquipment() {
            const res = await fetch(API_BASE + '/api/equipment');
            const data = await res.json();
            document.getElementById('equipment').textContent = JSON.stringify(data, null, 2);
        }

        async function runInference() {
            const res = await fetch(API_BASE + '/api/inference', { method: 'POST' });
            const data = await res.json();
            document.getElementById('inference').textContent = JSON.stringify(data, null, 2);
        }

        async function getGraph() {
            const res = await fetch(API_BASE + '/api/graph');
            const data = await res.json();
            document.getElementById('graph').textContent = JSON.stringify(data, null, 2);
        }

        async function runSparql() {
            const query = document.getElementById('sparql').value;
            const res = await fetch(API_BASE + '/api/sparql', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query })
            });
            const data = await res.json();
            document.getElementById('sparql-result').textContent = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>
    """
    return render_template_string(html)


@app.route('/api/statistics', methods=['GET'])
def get_statistics():
    """çµ±è¨ˆæƒ…å ±API"""
    stats = {
        'total_triples': len(g),
        'equipment_count': len(list(g.subjects(RDF.type, PROC.Pump))) + len(list(g.subjects(RDF.type, PROC.Reactor))),
        'connection_count': len(list(g.subject_objects(PROC.flowsTo)))
    }
    return jsonify({"status": "success", "statistics": stats})


@app.route('/api/equipment', methods=['GET'])
def get_equipment():
    """æ©Ÿå™¨ä¸€è¦§API"""
    query = prepareQuery("""
        SELECT ?equipment ?type ?status
        WHERE {
            ?equipment a ?type .
            ?equipment proc:hasStatus ?status .
            FILTER (?type IN (proc:Pump, proc:Reactor))
        }
    """, initNs={"proc": PROC})

    results = []
    for row in g.query(query):
        results.append({
            "id": str(row.equipment).split('#')[-1],
            "type": str(row.type).split('#')[-1],
            "status": str(row.status)
        })

    return jsonify({"status": "success", "equipment": results})


@app.route('/api/inference', methods=['POST'])
def run_inference():
    """æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³APIï¼ˆç•°å¸¸æ¤œçŸ¥ï¼‰"""
    anomalies = []

    # ãƒ«ãƒ¼ãƒ«: ä½æµé‡ + é«˜æŒ¯å‹• â†’ ã‚­ãƒ£ãƒ“ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    query = prepareQuery("""
        SELECT ?equipment ?flow ?vibration
        WHERE {
            ?equipment proc:hasFlowRate ?flow .
            ?equipment proc:hasVibration ?vibration .
            FILTER (?flow < 40 && ?vibration > 5)
        }
    """, initNs={"proc": PROC})

    for row in g.query(query):
        anomalies.append({
            "equipment": str(row.equipment).split('#')[-1],
            "diagnosis": "ã‚­ãƒ£ãƒ“ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç–‘ã„",
            "symptoms": f"ä½æµé‡({row.flow} mÂ³/h), é«˜æŒ¯å‹•({row.vibration} mm/s)",
            "action": "NPSHç¢ºèªã€å¸è¾¼é…ç®¡ç‚¹æ¤œ"
        })

    return jsonify({"status": "success", "anomalies": anomalies})


@app.route('/api/graph', methods=['GET'])
def get_graph():
    """ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ã‚°ãƒ©ãƒ•API"""
    nx_graph = nx.DiGraph()

    # ãƒãƒ¼ãƒ‰è¿½åŠ 
    for eq_uri in g.subjects(RDF.type, None):
        eq_id = str(eq_uri).split('#')[-1]
        if eq_id in ['P101', 'P102', 'R201']:
            nx_graph.add_node(eq_id)

    # ã‚¨ãƒƒã‚¸è¿½åŠ 
    for s, p, o in g.triples((None, PROC.flowsTo, None)):
        source = str(s).split('#')[-1]
        target = str(o).split('#')[-1]
        nx_graph.add_edge(source, target)

    # JSONå½¢å¼ã§è¿”ã™
    graph_data = {
        "nodes": [{"id": n} for n in nx_graph.nodes()],
        "edges": [{"source": u, "target": v} for u, v in nx_graph.edges()]
    }

    return jsonify({"status": "success", "graph": graph_data})


@app.route('/api/sparql', methods=['POST'])
def sparql_endpoint():
    """SPARQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"""
    data = request.get_json()
    query_str = data.get('query', '')

    try:
        query = prepareQuery(query_str, initNs={"proc": PROC, "diag": DIAG, "rdf": RDF, "rdfs": RDFS})
        results = g.query(query)

        response = []
        for row in results:
            row_dict = {}
            for var in results.vars:
                value = row[var]
                row_dict[str(var)] = str(value).split('#')[-1] if '#' in str(value) else str(value)
            response.append(row_dict)

        return jsonify({"status": "success", "count": len(response), "results": response})
    except Exception as e:
        return jsonify({"status": "error", "message": str(e)}), 400


# å®Ÿè¡Œãƒ‡ãƒ¢
def demo_integrated_system():
    """çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¢"""
    print("="*60)
    print("å®Œå…¨çµ±åˆã‚·ã‚¹ãƒ†ãƒ : API + æ¨è«– + å¯è¦–åŒ–")
    print("="*60)

    initialize_integrated_kb()

    print("\nã€çµ±åˆã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ã€‘")
    print("  1. RESTful API - æ©Ÿå™¨æƒ…å ±ã€çµ±è¨ˆã€ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿")
    print("  2. æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³ - ç•°å¸¸æ¤œçŸ¥ã€æ•…éšœè¨ºæ–­")
    print("  3. SPARQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ - ã‚«ã‚¹ã‚¿ãƒ ã‚¯ã‚¨ãƒª")
    print("  4. Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - çµ±åˆUI")

    print("\nã€èµ·å‹•æ–¹æ³•ã€‘")
    print("  python integrated_system.py")
    print("  ã¾ãŸã¯: flask run --port 5000")
    print("\nã€ã‚¢ã‚¯ã‚»ã‚¹ã€‘")
    print("  ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5000 ã‚’é–‹ã")

    print("\nã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§ã€‘")
    print("  GET  / - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰")
    print("  GET  /api/statistics - çµ±è¨ˆæƒ…å ±")
    print("  GET  /api/equipment - æ©Ÿå™¨ä¸€è¦§")
    print("  POST /api/inference - ç•°å¸¸æ¤œçŸ¥æ¨è«–")
    print("  GET  /api/graph - ãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ©ãƒ•")
    print("  POST /api/sparql - ã‚«ã‚¹ã‚¿ãƒ ã‚¯ã‚¨ãƒª")


# ãƒ‡ãƒ¢å®Ÿè¡Œ
demo_integrated_system()

# Flaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
# if __name__ == '__main__':
#     initialize_integrated_kb()
#     app.run(debug=True, port=5000)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
å®Œå…¨çµ±åˆã‚·ã‚¹ãƒ†ãƒ : API + æ¨è«– + å¯è¦–åŒ–
============================================================
çµ±åˆãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–: 17 ãƒˆãƒªãƒ—ãƒ«

ã€çµ±åˆã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ã€‘
  1. RESTful API - æ©Ÿå™¨æƒ…å ±ã€çµ±è¨ˆã€ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿
  2. æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³ - ç•°å¸¸æ¤œçŸ¥ã€æ•…éšœè¨ºæ–­
  3. SPARQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ - ã‚«ã‚¹ã‚¿ãƒ ã‚¯ã‚¨ãƒª
  4. Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - çµ±åˆUI

ã€èµ·å‹•æ–¹æ³•ã€‘
  python integrated_system.py
  ã¾ãŸã¯: flask run --port 5000

ã€ã‚¢ã‚¯ã‚»ã‚¹ã€‘
  ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5000 ã‚’é–‹ã

ã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§ã€‘
  GET  / - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
  GET  /api/statistics - çµ±è¨ˆæƒ…å ±
  GET  /api/equipment - æ©Ÿå™¨ä¸€è¦§
  POST /api/inference - ç•°å¸¸æ¤œçŸ¥æ¨è«–
  GET  /api/graph - ãƒ—ãƒ­ã‚»ã‚¹ã‚°ãƒ©ãƒ•
  POST /api/sparql - ã‚«ã‚¹ã‚¿ãƒ ã‚¯ã‚¨ãƒª
</code></pre>

<p><strong>è§£èª¬:</strong> Flaskã§Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã€ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã¸ã®APIã€æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³ã€SPARQL ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€å¯¾è©±çš„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’çµ±åˆã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰å…¨æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã€ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ãƒ—ãƒ­ã‚»ã‚¹çŸ¥è­˜ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦å‹•ä½œã—ã¾ã™ã€‚</p>

<hr />

<h2>5.8 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><strong>SPARQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆAPI</strong>
<ul>
<li>Flaskã§RESTful APIã‚’æ§‹ç¯‰</li>
<li>POST /api/sparqlã§ä»»æ„ã®ã‚¯ã‚¨ãƒªå®Ÿè¡Œ</li>
<li>GET /api/equipmentã§æ©Ÿå™¨æƒ…å ±å–å¾—</li>
<li>JSONå½¢å¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹</li>
</ul>
</li>
<li><strong>ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•å¯è¦–åŒ–</strong>
<ul>
<li>RDFã‚°ãƒ©ãƒ•ã‚’NetworkXã‚°ãƒ©ãƒ•ã«å¤‰æ›</li>
<li>Plotlyã§å¯¾è©±çš„å¯è¦–åŒ–</li>
<li>ãƒãƒ¼ãƒ‰ãƒ»ã‚¨ãƒƒã‚¸ã®å±æ€§è¡¨ç¤º</li>
<li>ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ã®è¦–è¦šçš„ç†è§£</li>
</ul>
</li>
<li><strong>æ–‡æ›¸è‡ªå‹•ç”Ÿæˆ</strong>
<ul>
<li>Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³æ´»ç”¨</li>
<li>SPARQLã§ãƒ‡ãƒ¼ã‚¿æŠ½å‡º</li>
<li>Markdown/HTMLæ–‡æ›¸ç”Ÿæˆ</li>
<li>æ©Ÿå™¨ãƒªã‚¹ãƒˆã€é‹è»¢æ¡ä»¶ã®è‡ªå‹•æ›´æ–°</li>
</ul>
</li>
<li><strong>æ ¹æœ¬åŸå› åˆ†æï¼ˆRCAï¼‰</strong>
<ul>
<li>ç—‡çŠ¶ã‹ã‚‰å› æœé–¢ä¿‚ã‚’é€†æ¢ç´¢</li>
<li>å°¤åº¦ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°</li>
<li>æ¨å¥¨å¯¾ç­–ã®æç¤º</li>
<li>è¤‡æ•°ç—‡çŠ¶ã®çµ±åˆè©•ä¾¡</li>
</ul>
</li>
<li><strong>æ©Ÿå™¨æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ </strong>
<ul>
<li>è¦æ±‚ä»•æ§˜ã¨ã‚«ã‚¿ãƒ­ã‚°ã®ãƒãƒƒãƒãƒ³ã‚°</li>
<li>ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é–¢æ•°ã«ã‚ˆã‚‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°</li>
<li>ã‚³ã‚¹ãƒˆåŠ¹ç‡è©•ä¾¡</li>
<li>å¤šåŸºæº–æ„æ€æ±ºå®šæ”¯æ´</li>
</ul>
</li>
<li><strong>ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–</strong>
<ul>
<li>ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‹ã‚‰æœ€é©åŒ–å•é¡ŒæŠ½å‡º</li>
<li>scipy.optimizeã¨ã®çµ±åˆ</li>
<li>åˆ¶ç´„æ¡ä»¶ã®è‡ªå‹•é©ç”¨</li>
<li>æœ€é©é‹è»¢æ¡ä»¶ã®å°å‡º</li>
</ul>
</li>
<li><strong>å®Œå…¨çµ±åˆã‚·ã‚¹ãƒ†ãƒ </strong>
<ul>
<li>Flask Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</li>
<li>API + æ¨è«– + å¯è¦–åŒ–ã®çµ±åˆ</li>
<li>å¯¾è©±çš„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</li>
<li>ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®çŸ¥è­˜ç®¡ç†</li>
</ul>
</li>
</ol>

<h3>é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h3>

<ul>
<li>SPARQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚ˆã‚Šã€å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½</li>
<li>å¯è¦–åŒ–ã«ã‚ˆã‚Šã€è¤‡é›‘ãªãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼ã‚’ç›´æ„Ÿçš„ã«ç†è§£ã§ãã‚‹</li>
<li>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§æ–‡æ›¸ã‚’è‡ªå‹•ç”Ÿæˆã—ã€å¸¸ã«æœ€æ–°çŠ¶æ…‹ã‚’ç¶­æŒ</li>
<li>RCAã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€æ•…éšœè¨ºæ–­ã‚’ä½“ç³»åŒ–ã—ã€è¿…é€Ÿãªå¯¾å¿œãŒå¯èƒ½</li>
<li>æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã§ã€æœ€é©ãªæ©Ÿå™¨é¸å®šã‚’æ”¯æ´ã—ã€æ„æ€æ±ºå®šã‚’åŠ¹ç‡åŒ–</li>
<li>æœ€é©åŒ–å•é¡Œã‚’ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã§ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€ä¿å®ˆæ€§ãŒå‘ä¸Š</li>
<li>çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã‚’ãƒ—ãƒ­ã‚»ã‚¹é‹è»¢ã®ä¸­æ ¸ã«é…ç½®</li>
<li>APIãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®è¨­è¨ˆã«ã‚ˆã‚Šã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å¯¾å¿œ</li>
</ul>

<h3>å®Ÿç”¨åŒ–ã«å‘ã‘ã¦</h3>

<p>æœ¬ã‚·ãƒªãƒ¼ã‚ºã§å­¦ã‚“ã ãƒ—ãƒ­ã‚»ã‚¹ã‚ªãƒ³ãƒˆãƒ­ã‚¸ãƒ¼ã¨ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã®æŠ€è¡“ã¯ã€ä»¥ä¸‹ã®å®Ÿãƒ—ãƒ­ã‚»ã‚¹ã«é©ç”¨ã§ãã¾ã™ï¼š</p>

<ul>
<li><strong>ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ„ã‚¤ãƒ³</strong>: ç‰©ç†ãƒ—ãƒ­ã‚»ã‚¹ã®çŸ¥è­˜ã‚’ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã§è¡¨ç¾</li>
<li><strong>ã‚¹ãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ãƒˆ</strong>: IoTã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã¨ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã®çµ±åˆ</li>
<li><strong>ãƒ—ãƒ­ã‚»ã‚¹å®‰å…¨ç®¡ç†</strong>: HAZOPã€LOPAã®ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹åŒ–</li>
<li><strong>è¨­å‚™ä¿å…¨æœ€é©åŒ–</strong>: æ•…éšœå±¥æ­´ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è¨ˆç”»ã®ä½“ç³»åŒ–</li>
<li><strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼ç®¡ç†</strong>: ãƒ—ãƒ­ã‚»ã‚¹å…¨ä½“ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ•ãƒ­ãƒ¼æœ€é©åŒ–</li>
<li><strong>æŠ€è¡“ä¼æ‰¿</strong>: ãƒ™ãƒ†ãƒ©ãƒ³ã®çŸ¥è­˜ã‚’ã‚ªãƒ³ãƒˆãƒ­ã‚¸ãƒ¼ã¨ã—ã¦å½¢å¼åŒ–</li>
<li><strong>è¦åˆ¶å¯¾å¿œ</strong>: æ³•è¦åˆ¶è¦ä»¶ã®ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ç®¡ç†</li>
</ul>

<h3>ã•ã‚‰ãªã‚‹å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹</h3>

<ul>
<li><strong>Semantic WebæŠ€è¡“</strong>: W3C RDF/OWL/SPARQLä»•æ§˜</li>
<li><strong>ã‚ªãƒ³ãƒˆãƒ­ã‚¸ãƒ¼å·¥å­¦</strong>: ProtÃ©gÃ©ã€TopBraidãƒ„ãƒ¼ãƒ«</li>
<li><strong>ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•DB</strong>: Neo4jã€Apache Jenaã€Stardog</li>
<li><strong>ãƒ—ãƒ­ã‚»ã‚¹å·¥å­¦</strong>: CAPE-OPENã€OPC UAæƒ…å ±ãƒ¢ãƒ‡ãƒ«</li>
<li><strong>å®Ÿè£…ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</strong>: rdflibã€owlready2ã€SPARQLWrapper</li>
</ul>

<div class="navigation">
    <a href="chapter-4.html" class="nav-button">â† å‰ã®ç« </a>
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
</div>
    </main>

    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

    <footer>
        <p><strong>ä½œæˆè€…</strong>: PI Knowledge Hub Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-26</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>&copy; 2025 PI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
