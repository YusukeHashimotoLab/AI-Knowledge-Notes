<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¬¬2ç« ï¼šHAZOPã¨ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ - ãƒ—ãƒ­ã‚»ã‚¹å®‰å…¨æ€§è©•ä¾¡å…¥é–€ã‚·ãƒªãƒ¼ã‚º">
    <title>ç¬¬2ç« ï¼šHAZOPã¨ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ - ãƒ—ãƒ­ã‚»ã‚¹å®‰å…¨æ€§è©•ä¾¡å…¥é–€ | PI Terakoya</title>

        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8; color: #333; background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; padding: 2rem 1rem; text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .back-link {
            display: inline-block; margin-bottom: 2rem; padding: 0.5rem 1rem;
            background: white; color: #11998e; text-decoration: none;
            border-radius: 6px; font-weight: 600;
        }
        .content-box {
            background: white; padding: 2rem; border-radius: 12px;
            margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #11998e; margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem; border-bottom: 3px solid #11998e;
        }
        h3 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h4 { color: #2c3e50; margin: 1rem 0 0.5rem 0; }
        p { margin-bottom: 1rem; }
        ul, ol { margin-left: 2rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
        pre {
            background: #1e1e1e; color: #d4d4d4; padding: 1.5rem;
            border-radius: 8px; overflow-x: auto; margin: 1rem 0;
            border-left: 4px solid #11998e;
        }
        code {
            font-family: 'Courier New', monospace; font-size: 0.9rem;
        }
        .key-point {
            background: #e8f5e9; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #4caf50; margin: 1rem 0;
        }
        .tech-note {
            background: #e3f2fd; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #2196f3; margin: 1rem 0;
        }
        .formula {
            background: #f0f7ff; padding: 1rem; border-radius: 6px;
            margin: 1rem 0; overflow-x: auto;
        }
        table {
            width: 100%; border-collapse: collapse; margin: 1rem 0;
        }
        th, td {
            border: 1px solid #ddd; padding: 0.75rem; text-align: left;
        }
        th {
            background: #11998e; color: white; font-weight: 600;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: 3rem;
        }
        .nav-buttons a {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; text-decoration: none; border-radius: 6px;
            font-weight: 600;
        }
        footer {
            background: #2c3e50; color: white; text-align: center;
            padding: 2rem 1rem; margin-top: 4rem;
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.6rem; }
            .container { padding: 0 0.5rem; }
            pre { padding: 1rem; }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
            <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="/AI-Knowledge-Notes/knowledge/jp/index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="/AI-Knowledge-Notes/knowledge/jp/PI/index.html">ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹</a><span class="breadcrumb-separator">â€º</span><a href="/AI-Knowledge-Notes/knowledge/jp/PI/process-safety/index.html">Process Safety</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 2</span>
        </div>
    </nav>

        <header>
        <div class="container">
            <h1>ç¬¬2ç« ï¼šHAZOPã¨ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ</h1>
            <p class="subtitle">ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰é©ç”¨ã€é€¸è„±åˆ†æã€å®šé‡çš„ãƒªã‚¹ã‚¯è©•ä¾¡ï¼ˆQRAï¼‰ã®å®Œå…¨å®Ÿè£…</p>
            <div class="meta">
                <span class="meta">ğŸ“– èª­äº†æ™‚é–“: 30-35åˆ†</span>
                <span class="meta">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 8å€‹</span>
            </div>
        </div>
    </header>

    <main class="container">

<div class="learning-objectives">
<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… HAZOPã‚¹ã‚¿ãƒ‡ã‚£ã®æ‰‹æ³•ã‚’ç†è§£ã—å®Ÿè·µã§ãã‚‹</li>
<li>âœ… ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ï¼ˆNo, More, Less, Reverseç­‰ï¼‰ã‚’é©ç”¨ã§ãã‚‹</li>
<li>âœ… é€¸è„±åˆ†æï¼ˆDeviation Analysisï¼‰ã‚’å®Ÿæ–½ã§ãã‚‹</li>
<li>âœ… å®šé‡çš„ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆï¼ˆQRAï¼‰ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… F-Næ›²ç·šã‚’ä½œæˆã—ãƒªã‚¹ã‚¯åˆ¤å®šãŒã§ãã‚‹</li>
<li>âœ… HAZOPãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã§ãã‚‹</li>
</ul>
</div>

<hr />

<h2>2.1 HAZOPã‚¹ã‚¿ãƒ‡ã‚£ã®åŸºç¤</h2>

<h3>HAZOPã¨ã¯</h3>

<p><strong>HAZOPï¼ˆHazard and Operability Studyï¼‰</strong>ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹ã®è¨­è¨ˆæ®µéšã§ä½“ç³»çš„ã«ãƒã‚¶ãƒ¼ãƒ‰ã¨é‹è»¢ä¸Šã®å•é¡Œã‚’è­˜åˆ¥ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚1960å¹´ä»£ã«ICIã§é–‹ç™ºã•ã‚Œã€ç¾åœ¨ã§ã¯åŒ–å­¦ãƒ—ãƒ©ãƒ³ãƒˆè¨­è¨ˆã®æ¨™æº–ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p>

<h3>HAZOPã®åŸç†</h3>

<p>HAZOPã¯ã€<strong>ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ï¼ˆGuide Wordï¼‰</strong>ã‚’<strong>ãƒ—ãƒ­ã‚»ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆProcess Parameterï¼‰</strong>ã«é©ç”¨ã—ã¦<strong>é€¸è„±ï¼ˆDeviationï¼‰</strong>ã‚’ç”Ÿæˆã—ã€ãã®åŸå› ãƒ»çµæœãƒ»å¯¾ç­–ã‚’åˆ†æã—ã¾ã™ã€‚</p>

<p>$$
\text{Deviation} = \text{Guide Word} + \text{Process Parameter}
$$</p>

<h3>ä¸»è¦ãªã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰</h3>

<table>
<thead>
<tr>
<th>ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰</th>
<th>æ„å‘³</th>
<th>é©ç”¨ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>No/Not/None</strong></td>
<td>å®Œå…¨ãªå¦å®š</td>
<td>No flow, No pressure</td>
</tr>
<tr>
<td><strong>More</strong></td>
<td>é‡çš„å¢—åŠ </td>
<td>More flow, More temperature</td>
</tr>
<tr>
<td><strong>Less</strong></td>
<td>é‡çš„æ¸›å°‘</td>
<td>Less flow, Less pressure</td>
</tr>
<tr>
<td><strong>As Well As</strong></td>
<td>è¿½åŠ </td>
<td>Impurity as well as product</td>
</tr>
<tr>
<td><strong>Part Of</strong></td>
<td>ä¸€éƒ¨æ¬ è½</td>
<td>Part of composition (missing component)</td>
</tr>
<tr>
<td><strong>Reverse</strong></td>
<td>é€†æ–¹å‘</td>
<td>Reverse flow</td>
</tr>
<tr>
<td><strong>Other Than</strong></td>
<td>å®Œå…¨ã«ç•°ãªã‚‹</td>
<td>Other than normal operation</td>
</tr>
</tbody>
</table>

<h3>Example 1: HAZOPã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ³</h3>

<pre><code class="language-python"># ===================================
# Example 1: HAZOPã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ³
# ===================================

from dataclasses import dataclass
from typing import List, Dict
from enum import Enum

class GuideWord(Enum):
    """HAZOPã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰"""
    NO = "No/Not/None"
    MORE = "More"
    LESS = "Less"
    AS_WELL_AS = "As Well As"
    PART_OF = "Part Of"
    REVERSE = "Reverse"
    OTHER_THAN = "Other Than"

class ProcessParameter(Enum):
    """ãƒ—ãƒ­ã‚»ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"""
    FLOW = "Flow"
    PRESSURE = "Pressure"
    TEMPERATURE = "Temperature"
    LEVEL = "Level"
    COMPOSITION = "Composition"
    VISCOSITY = "Viscosity"
    TIME = "Time"
    MIXING = "Mixing"

@dataclass
class Deviation:
    """é€¸è„±ï¼ˆDeviationï¼‰"""
    guide_word: GuideWord
    parameter: ProcessParameter
    description: str
    potential_causes: List[str]
    potential_consequences: List[str]
    existing_safeguards: List[str]
    recommendations: List[str]
    risk_rank: str  # High/Medium/Low

class HAZOPGuideWordEngine:
    """HAZOPã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰é©ç”¨ã‚¨ãƒ³ã‚¸ãƒ³"""

    def __init__(self):
        # ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®çµ„ã¿åˆã‚ã›ãƒ«ãƒ¼ãƒ«
        self.valid_combinations = {
            GuideWord.NO: [ProcessParameter.FLOW, ProcessParameter.PRESSURE,
                           ProcessParameter.LEVEL, ProcessParameter.MIXING],
            GuideWord.MORE: [ProcessParameter.FLOW, ProcessParameter.PRESSURE,
                             ProcessParameter.TEMPERATURE, ProcessParameter.LEVEL],
            GuideWord.LESS: [ProcessParameter.FLOW, ProcessParameter.PRESSURE,
                             ProcessParameter.TEMPERATURE, ProcessParameter.LEVEL],
            GuideWord.REVERSE: [ProcessParameter.FLOW],
            GuideWord.AS_WELL_AS: [ProcessParameter.COMPOSITION],
            GuideWord.PART_OF: [ProcessParameter.COMPOSITION],
            GuideWord.OTHER_THAN: [ProcessParameter.COMPOSITION, ProcessParameter.TIME]
        }

    def is_valid_combination(self, guide_word: GuideWord,
                             parameter: ProcessParameter) -&gt; bool:
        """ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®çµ„ã¿åˆã‚ã›ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯"""
        if guide_word in self.valid_combinations:
            return parameter in self.valid_combinations[guide_word]
        return False

    def generate_deviation_description(self, guide_word: GuideWord,
                                        parameter: ProcessParameter,
                                        node_name: str = "Node") -&gt; str:
        """é€¸è„±ã®è¨˜è¿°ã‚’ç”Ÿæˆ"""
        return f"{guide_word.value} {parameter.value} at {node_name}"

    def apply_guide_words(self, node_name: str,
                          parameters: List[ProcessParameter]) -&gt; List[str]:
        """ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã‚’é©ç”¨"""
        deviations = []

        for param in parameters:
            for guide_word in GuideWord:
                if self.is_valid_combination(guide_word, param):
                    deviation = self.generate_deviation_description(
                        guide_word, param, node_name
                    )
                    deviations.append(deviation)

        return deviations


# ä½¿ç”¨ä¾‹
hazop_engine = HAZOPGuideWordEngine()

# ãƒãƒ¼ãƒ‰: åå¿œå™¨ã¸ã®åŸæ–™ä¾›çµ¦ãƒ©ã‚¤ãƒ³
node = "Reactor Feed Line (P&ID: R-101)"
parameters = [
    ProcessParameter.FLOW,
    ProcessParameter.PRESSURE,
    ProcessParameter.TEMPERATURE,
    ProcessParameter.COMPOSITION
]

# ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰é©ç”¨
deviations = hazop_engine.apply_guide_words(node, parameters)

print(f"=== HAZOP Node: {node} ===\n")
print(f"Total Deviations Generated: {len(deviations)}\n")
print("Deviations:")
for i, dev in enumerate(deviations, 1):
    print(f"{i:2d}. {dev}")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === HAZOP Node: Reactor Feed Line (P&ID: R-101) ===
#
# Total Deviations Generated: 13
#
# Deviations:
#  1. No/Not/None Flow at Reactor Feed Line (P&ID: R-101)
#  2. More Flow at Reactor Feed Line (P&ID: R-101)
#  3. Less Flow at Reactor Feed Line (P&ID: R-101)
#  4. Reverse Flow at Reactor Feed Line (P&ID: R-101)
#  5. No/Not/None Pressure at Reactor Feed Line (P&ID: R-101)
#  6. More Pressure at Reactor Feed Line (P&ID: R-101)
#  7. Less Pressure at Reactor Feed Line (P&ID: R-101)
#  8. More Temperature at Reactor Feed Line (P&ID: R-101)
#  9. Less Temperature at Reactor Feed Line (P&ID: R-101)
# 10. As Well As Composition at Reactor Feed Line (P&ID: R-101)
# 11. Part Of Composition at Reactor Feed Line (P&ID: R-101)
# 12. Other Than Composition at Reactor Feed Line (P&ID: R-101)
# 13. Other Than Time at Reactor Feed Line (P&ID: R-101)
</code></pre>

<hr />

<h2>2.2 é€¸è„±åˆ†æï¼ˆDeviation Analysisï¼‰</h2>

<h3>Example 2: é€¸è„±åˆ†æã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…</h3>

<p>å„é€¸è„±ã«å¯¾ã—ã¦ã€åŸå› ãƒ»çµæœãƒ»æ—¢å­˜å¯¾ç­–ãƒ»æ¨å¥¨äº‹é …ã‚’åˆ†æã—ã¾ã™ã€‚</p>

<pre><code class="language-python"># ===================================
# Example 2: é€¸è„±åˆ†æã‚·ã‚¹ãƒ†ãƒ 
# ===================================

import pandas as pd

class DeviationAnalyzer:
    """é€¸è„±åˆ†æã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, node_name: str, equipment_type: str):
        self.node_name = node_name
        self.equipment_type = equipment_type
        self.deviations: List[Deviation] = []
        self._load_knowledge_base()

    def _load_knowledge_base(self):
        """çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‚’ãƒ­ãƒ¼ãƒ‰ï¼ˆå…¸å‹çš„ãªåŸå› ãƒ»çµæœï¼‰"""
        # å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€éå»ã®HAZOPãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å­¦ç¿’

        self.knowledge_base = {
            ("NO", "FLOW"): {
                "causes": [
                    "Pump failure",
                    "Valve closed (inadvertent or maintenance)",
                    "Line blockage (solidification, fouling)",
                    "Suction strainer plugged",
                    "Upstream vessel empty"
                ],
                "consequences": [
                    "Reactor starvation (loss of cooling/reactant)",
                    "Pump cavitation/damage",
                    "Product off-spec",
                    "Temperature excursion (if flow is coolant)"
                ],
                "safeguards": [
                    "Low flow alarm",
                    "Pump status indication",
                    "Level indication on upstream vessel"
                ]
            },
            ("MORE", "FLOW"): {
                "causes": [
                    "Control valve fails open",
                    "Pump speed increase (VFD malfunction)",
                    "Upstream pressure increase",
                    "Parallel line opened unintentionally"
                ],
                "consequences": [
                    "Reactor flooding",
                    "Downstream vessel overflow",
                    "Product off-spec (dilution)",
                    "Increased pressure drop"
                ],
                "safeguards": [
                    "High flow alarm",
                    "Level high alarm on receiving vessel",
                    "Flow control with override"
                ]
            },
            ("MORE", "TEMPERATURE"): {
                "causes": [
                    "Cooling system failure",
                    "Heat exchanger fouling (reduced heat transfer)",
                    "Exothermic reaction runaway",
                    "External fire",
                    "Temperature transmitter failure"
                ],
                "consequences": [
                    "Thermal decomposition",
                    "Reactor overpressure",
                    "Product degradation",
                    "Equipment damage (metallurgy limits)"
                ],
                "safeguards": [
                    "High temperature alarm",
                    "Independent high temperature interlock",
                    "Pressure relief valve",
                    "Emergency cooling system"
                ]
            },
            ("REVERSE", "FLOW"): {
                "causes": [
                    "Pump stopped with downstream pressure higher",
                    "Check valve failure",
                    "Incorrect valve lineup",
                    "Siphon effect"
                ],
                "consequences": [
                    "Contamination of upstream system",
                    "Pump damage (reverse rotation)",
                    "Loss of containment",
                    "Mixing of incompatible materials"
                ],
                "safeguards": [
                    "Check valve",
                    "Backflow prevention valve",
                    "Pump discharge valve"
                ]
            }
        }

    def analyze_deviation(self, guide_word: GuideWord,
                          parameter: ProcessParameter) -&gt; Deviation:
        """é€¸è„±ã‚’åˆ†æ"""

        # çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±å–å¾—
        key = (guide_word.name, parameter.name)
        kb_entry = self.knowledge_base.get(key, {
            "causes": ["To be determined in HAZOP meeting"],
            "consequences": ["To be determined in HAZOP meeting"],
            "safeguards": ["To be determined in HAZOP meeting"]
        })

        # ãƒªã‚¹ã‚¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆç°¡ç•¥åŒ–ï¼‰
        high_risk_combos = [
            ("NO", "FLOW"), ("MORE", "TEMPERATURE"), ("MORE", "PRESSURE")
        ]
        risk_rank = "High" if key in high_risk_combos else "Medium"

        # æ¨å¥¨äº‹é …ç”Ÿæˆ
        recommendations = self._generate_recommendations(
            guide_word, parameter, kb_entry["safeguards"]
        )

        deviation = Deviation(
            guide_word=guide_word,
            parameter=parameter,
            description=f"{guide_word.value} {parameter.value} at {self.node_name}",
            potential_causes=kb_entry["causes"],
            potential_consequences=kb_entry["consequences"],
            existing_safeguards=kb_entry["safeguards"],
            recommendations=recommendations,
            risk_rank=risk_rank
        )

        self.deviations.append(deviation)
        return deviation

    def _generate_recommendations(self, guide_word: GuideWord,
                                   parameter: ProcessParameter,
                                   existing_safeguards: List[str]) -&gt; List[str]:
        """æ¨å¥¨äº‹é …ã‚’ç”Ÿæˆ"""
        recommendations = []

        # ã‚¢ãƒ©ãƒ¼ãƒ ä¸è¶³ã®ãƒã‚§ãƒƒã‚¯
        if "alarm" not in ' '.join(existing_safeguards).lower():
            recommendations.append(
                f"Install {parameter.value.lower()} alarm"
            )

        # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ­ãƒƒã‚¯ä¸è¶³ã®ãƒã‚§ãƒƒã‚¯
        if guide_word in [GuideWord.MORE, GuideWord.NO] and \
           "interlock" not in ' '.join(existing_safeguards).lower():
            recommendations.append(
                f"Consider {parameter.value.lower()} interlock (SIL assessment required)"
            )

        # å†—é•·æ€§ãƒã‚§ãƒƒã‚¯
        if len(existing_safeguards) &lt; 2:
            recommendations.append(
                "Review adequacy of protection layers (LOPA recommended)"
            )

        if not recommendations:
            recommendations.append("Existing safeguards adequate - continue routine maintenance")

        return recommendations

    def generate_hazop_worksheet(self) -&gt; pd.DataFrame:
        """HAZOP worksheetã‚’ç”Ÿæˆ"""
        data = []

        for dev in self.deviations:
            data.append({
                'Node': self.node_name,
                'Deviation': dev.description,
                'Causes': '; '.join(dev.potential_causes[:2]) + '...',  # æœ€åˆã®2ã¤
                'Consequences': '; '.join(dev.potential_consequences[:2]) + '...',
                'Safeguards': '; '.join(dev.existing_safeguards[:2]) + '...',
                'Risk': dev.risk_rank,
                'Actions': '; '.join(dev.recommendations[:1])  # æœ€å„ªå…ˆã®æ¨å¥¨äº‹é …
            })

        return pd.DataFrame(data)


# ä½¿ç”¨ä¾‹
analyzer = DeviationAnalyzer(
    node_name="Reactor Feed Line (R-101)",
    equipment_type="Piping"
)

# ä¸»è¦ãªé€¸è„±ã‚’åˆ†æ
critical_deviations = [
    (GuideWord.NO, ProcessParameter.FLOW),
    (GuideWord.MORE, ProcessParameter.FLOW),
    (GuideWord.MORE, ProcessParameter.TEMPERATURE),
    (GuideWord.REVERSE, ProcessParameter.FLOW)
]

for gw, param in critical_deviations:
    analyzer.analyze_deviation(gw, param)

# HAZOP worksheetç”Ÿæˆ
worksheet = analyzer.generate_hazop_worksheet()

print("=== HAZOP Worksheet ===\n")
print(worksheet.to_string(index=False))

print("\n=== Detailed Analysis: No Flow ===")
no_flow_dev = analyzer.deviations[0]
print(f"\nDeviation: {no_flow_dev.description}")
print(f"\nPotential Causes:")
for cause in no_flow_dev.potential_causes:
    print(f"  - {cause}")
print(f"\nPotential Consequences:")
for cons in no_flow_dev.potential_consequences:
    print(f"  - {cons}")
print(f"\nRecommendations:")
for rec in no_flow_dev.recommendations:
    print(f"  - {rec}")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === HAZOP Worksheet ===
#
#                     Node                           Deviation  Risk ...
#  Reactor Feed Line (R-101)    No/Not/None Flow at Reactor... High ...
#  Reactor Feed Line (R-101)          More Flow at Reactor... Medium ...
#  Reactor Feed Line (R-101)   More Temperature at Reactor... High ...
#  Reactor Feed Line (R-101)       Reverse Flow at Reactor... Medium ...
</code></pre>

<hr />

<h2>2.3 HAZOPè‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ </h2>

<h3>Example 3: P&IDè§£æã¨HAZOPè‡ªå‹•ç”Ÿæˆ</h3>

<p>P&IDï¼ˆé…ç®¡è¨ˆè£…å›³ï¼‰æƒ…å ±ã‹ã‚‰è‡ªå‹•çš„ã«HAZOPãƒãƒ¼ãƒ‰ã¨é€¸è„±ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

<pre><code class="language-python"># ===================================
# Example 3: P&IDè§£æã¨HAZOPè‡ªå‹•ç”Ÿæˆ
# ===================================

from dataclasses import dataclass
from typing import List, Dict, Set

@dataclass
class PIDElement:
    """P&IDè¦ç´ """
    id: str
    element_type: str  # Vessel, Pump, HeatExchanger, Valve, Line
    fluid: str
    design_pressure: float  # MPa
    design_temperature: float  # Â°C
    connected_to: List[str]  # æ¥ç¶šå…ˆè¦ç´ ID

@dataclass
class HAZOPNode:
    """HAZOPãƒãƒ¼ãƒ‰ï¼ˆæ¤œè¨å˜ä½ï¼‰"""
    id: str
    name: str
    elements: List[PIDElement]
    intent: str  # Design Intentï¼ˆè¨­è¨ˆæ„å›³ï¼‰
    parameters_of_interest: List[ProcessParameter]

class PIDHAZOPAutomation:
    """P&IDãƒ™ãƒ¼ã‚¹HAZOPè‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self):
        self.pid_elements: Dict[str, PIDElement] = {}
        self.hazop_nodes: List[HAZOPNode] = []

    def add_pid_element(self, element: PIDElement):
        """P&IDè¦ç´ ã‚’è¿½åŠ """
        self.pid_elements[element.id] = element

    def identify_hazop_nodes(self) -&gt; List[HAZOPNode]:
        """HAZOPãƒãƒ¼ãƒ‰ã‚’è‡ªå‹•è­˜åˆ¥

        ãƒãƒ¼ãƒ‰åˆ†å‰²åŸºæº–:
          - æ©Ÿèƒ½å˜ä½ï¼ˆåå¿œã€åˆ†é›¢ã€ç†±äº¤æ›ï¼‰
          - ãƒ—ãƒ­ã‚»ã‚¹æ¡ä»¶å¤‰åŒ–ç‚¹ï¼ˆç›¸å¤‰åŒ–ã€æ¸©åº¦/åœ§åŠ›å¤‰åŒ–ï¼‰
          - åˆ¶å¾¡ãƒ«ãƒ¼ãƒ—å¢ƒç•Œ
        """
        nodes = []

        # ç°¡ç•¥åŒ–: å„ä¸»è¦è¨­å‚™ã‚’ãƒãƒ¼ãƒ‰ã¨ã—ã¦æ‰±ã†
        for elem_id, elem in self.pid_elements.items():
            if elem.element_type in ['Vessel', 'Pump', 'HeatExchanger']:
                # è¨­è¨ˆæ„å›³ã‚’æ¨å®š
                intent = self._infer_design_intent(elem)

                # é–¢é€£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ±ºå®š
                parameters = self._determine_parameters(elem)

                node = HAZOPNode(
                    id=f"NODE-{elem_id}",
                    name=f"{elem.element_type}: {elem_id}",
                    elements=[elem],
                    intent=intent,
                    parameters_of_interest=parameters
                )

                nodes.append(node)

        self.hazop_nodes = nodes
        return nodes

    def _infer_design_intent(self, element: PIDElement) -&gt; str:
        """è¨­è¨ˆæ„å›³ã‚’æ¨å®š"""
        intents = {
            'Vessel': f"Contain {element.fluid} at {element.design_pressure} MPa, {element.design_temperature}Â°C",
            'Pump': f"Transfer {element.fluid} at design flow rate",
            'HeatExchanger': f"Heat/cool {element.fluid} to target temperature"
        }
        return intents.get(element.element_type, "To be determined")

    def _determine_parameters(self, element: PIDElement) -&gt; List[ProcessParameter]:
        """æ¤œè¨ã™ã¹ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ±ºå®š"""
        param_map = {
            'Vessel': [ProcessParameter.LEVEL, ProcessParameter.PRESSURE,
                       ProcessParameter.TEMPERATURE, ProcessParameter.COMPOSITION],
            'Pump': [ProcessParameter.FLOW, ProcessParameter.PRESSURE],
            'HeatExchanger': [ProcessParameter.FLOW, ProcessParameter.TEMPERATURE,
                              ProcessParameter.PRESSURE]
        }
        return param_map.get(element.element_type,
                             [ProcessParameter.FLOW, ProcessParameter.PRESSURE])

    def generate_hazop_study(self) -&gt; Dict:
        """å®Œå…¨ãªHAZOP studyã‚’ç”Ÿæˆ"""

        # ãƒãƒ¼ãƒ‰è­˜åˆ¥
        if not self.hazop_nodes:
            self.identify_hazop_nodes()

        # å„ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦HAZOPå®Ÿæ–½
        study_results = []

        for node in self.hazop_nodes:
            analyzer = DeviationAnalyzer(node.name, node.elements[0].element_type)

            # ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰é©ç”¨
            for param in node.parameters_of_interest:
                for guide_word in GuideWord:
                    if analyzer._load_knowledge_base() or True:  # simplified
                        # æœ‰åŠ¹ãªçµ„ã¿åˆã‚ã›ã®ã¿åˆ†æ
                        engine = HAZOPGuideWordEngine()
                        if engine.is_valid_combination(guide_word, param):
                            try:
                                deviation = analyzer.analyze_deviation(guide_word, param)
                                study_results.append({
                                    'Node': node.name,
                                    'Intent': node.intent,
                                    'Deviation': deviation.description,
                                    'Risk': deviation.risk_rank
                                })
                            except:
                                pass

        return {
            'total_nodes': len(self.hazop_nodes),
            'total_deviations': len(study_results),
            'results': pd.DataFrame(study_results)
        }


# ä½¿ç”¨ä¾‹: ç°¡æ˜“ãƒ—ãƒ­ã‚»ã‚¹ã®P&IDæ§‹ç¯‰
pid_system = PIDHAZOPAutomation()

# P&IDè¦ç´ ã‚’è¿½åŠ 
pid_system.add_pid_element(PIDElement(
    id="R-101",
    element_type="Vessel",
    fluid="Ethylene/Catalyst",
    design_pressure=3.0,
    design_temperature=150,
    connected_to=["P-101", "E-101"]
))

pid_system.add_pid_element(PIDElement(
    id="P-101",
    element_type="Pump",
    fluid="Product mixture",
    design_pressure=5.0,
    design_temperature=80,
    connected_to=["R-101", "T-201"]
))

pid_system.add_pid_element(PIDElement(
    id="E-101",
    element_type="HeatExchanger",
    fluid="Reactor coolant",
    design_pressure=1.5,
    design_temperature=100,
    connected_to=["R-101"]
))

# HAZOPãƒãƒ¼ãƒ‰è‡ªå‹•è­˜åˆ¥
nodes = pid_system.identify_hazop_nodes()
print(f"=== HAZOP Nodes Identified: {len(nodes)} ===\n")
for node in nodes:
    print(f"Node: {node.name}")
    print(f"  Intent: {node.intent}")
    print(f"  Parameters: {[p.value for p in node.parameters_of_interest]}\n")

# HAZOP studyè‡ªå‹•ç”Ÿæˆ
study = pid_system.generate_hazop_study()
print(f"\n=== HAZOP Study Summary ===")
print(f"Total Nodes: {study['total_nodes']}")
print(f"Total Deviations: {study['total_deviations']}\n")
print(study['results'].head(10).to_string(index=False))

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === HAZOP Nodes Identified: 3 ===
#
# Node: Vessel: R-101
#   Intent: Contain Ethylene/Catalyst at 3.0 MPa, 150Â°C
#   Parameters: ['Level', 'Pressure', 'Temperature', 'Composition']
#
# Node: Pump: P-101
#   Intent: Transfer Product mixture at design flow rate
#   Parameters: ['Flow', 'Pressure']
# ...
</code></pre>

<hr />

<h2>2.4 å®šé‡çš„ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆï¼ˆQRAï¼‰</h2>

<h3>Example 4: ã‚¤ãƒ™ãƒ³ãƒˆãƒ„ãƒªãƒ¼è§£æï¼ˆETAï¼‰</h3>

<p>èµ·å› äº‹è±¡ã‹ã‚‰æœ€çµ‚çµæœã¾ã§ã®äº‹è±¡é€£é–ã‚’ç¢ºç‡çš„ã«è©•ä¾¡ã—ã¾ã™ã€‚</p>

<pre><code class="language-python"># ===================================
# Example 4: ã‚¤ãƒ™ãƒ³ãƒˆãƒ„ãƒªãƒ¼è§£æï¼ˆETAï¼‰
# ===================================

from dataclasses import dataclass
from typing import List, Optional
import matplotlib.pyplot as plt
import numpy as np

@dataclass
class EventNode:
    """ã‚¤ãƒ™ãƒ³ãƒˆãƒ„ãƒªãƒ¼ã®ãƒãƒ¼ãƒ‰"""
    name: str
    success_probability: float
    failure_probability: float

    def __post_init__(self):
        assert abs(self.success_probability + self.failure_probability - 1.0) &lt; 1e-6, \
            "Success + Failure probability must equal 1.0"

@dataclass
class Outcome:
    """æœ€çµ‚çµæœ"""
    path: List[str]
    probability: float
    consequence: str
    severity: str  # Catastrophic, Critical, Marginal, Negligible

class EventTreeAnalysis:
    """ã‚¤ãƒ™ãƒ³ãƒˆãƒ„ãƒªãƒ¼è§£æã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, initiating_event: str, frequency: float):
        """
        Args:
            initiating_event: èµ·å› äº‹è±¡å
            frequency: èµ·å› äº‹è±¡é »åº¦ï¼ˆå›/å¹´ï¼‰
        """
        self.initiating_event = initiating_event
        self.frequency = frequency
        self.safety_functions: List[EventNode] = []
        self.outcomes: List[Outcome] = []

    def add_safety_function(self, node: EventNode):
        """å®‰å…¨æ©Ÿèƒ½ã‚’è¿½åŠ """
        self.safety_functions.append(node)

    def calculate_outcomes(self):
        """å…¨ã¦ã®çµæœãƒ‘ã‚¹ã¨ç¢ºç‡ã‚’è¨ˆç®—"""
        self.outcomes = []

        # ã™ã¹ã¦ã®å¯èƒ½ãªçµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆï¼ˆ2^né€šã‚Šï¼‰
        n_functions = len(self.safety_functions)
        for i in range(2 ** n_functions):
            path = []
            probability = self.frequency

            # ãƒã‚¤ãƒŠãƒªè¡¨ç¾ã§Success/Failureã‚’æ±ºå®š
            binary = format(i, f'0{n_functions}b')

            for j, bit in enumerate(binary):
                function = self.safety_functions[j]
                if bit == '0':  # Success
                    path.append(f"{function.name}: Success")
                    probability *= function.success_probability
                else:  # Failure
                    path.append(f"{function.name}: Failure")
                    probability *= function.failure_probability

            # çµæœã®å½±éŸ¿åº¦ã‚’åˆ¤å®š
            failure_count = binary.count('1')
            consequence, severity = self._determine_consequence(failure_count)

            self.outcomes.append(Outcome(
                path=path,
                probability=probability,
                consequence=consequence,
                severity=severity
            ))

    def _determine_consequence(self, failure_count: int) -&gt; tuple:
        """å¤±æ•—æ•°ã«å¿œã˜ã¦å½±éŸ¿åº¦ã‚’æ±ºå®š"""
        n = len(self.safety_functions)

        if failure_count == 0:
            return "Safe shutdown", "Negligible"
        elif failure_count == 1:
            return "Minor release (contained by secondary barrier)", "Marginal"
        elif failure_count == 2:
            return "Significant release (requires emergency response)", "Critical"
        else:
            return "Major release (offsite consequences)", "Catastrophic"

    def generate_eta_report(self) -&gt; str:
        """ã‚¤ãƒ™ãƒ³ãƒˆãƒ„ãƒªãƒ¼è§£æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
        if not self.outcomes:
            self.calculate_outcomes()

        report = f"""
{'='*80}
EVENT TREE ANALYSIS (ETA) REPORT
{'='*80}

Initiating Event: {self.initiating_event}
Frequency: {self.frequency:.2e} events/year

Safety Functions:
"""

        for i, sf in enumerate(self.safety_functions, 1):
            report += f"{i}. {sf.name}\n"
            report += f"   Success Prob: {sf.success_probability:.4f} ({sf.success_probability*100:.2f}%)\n"
            report += f"   Failure Prob: {sf.failure_probability:.4f} ({sf.failure_probability*100:.2f}%)\n\n"

        report += f"""
{'='*80}
OUTCOMES
{'='*80}
"""

        # å½±éŸ¿åº¦ã§ã‚½ãƒ¼ãƒˆ
        severity_order = {"Catastrophic": 0, "Critical": 1, "Marginal": 2, "Negligible": 3}
        sorted_outcomes = sorted(self.outcomes,
                                 key=lambda x: (severity_order[x.severity], -x.probability))

        for i, outcome in enumerate(sorted_outcomes, 1):
            report += f"\nOutcome {i}: {outcome.consequence}\n"
            report += f"  Severity: {outcome.severity}\n"
            report += f"  Frequency: {outcome.probability:.2e} events/year\n"
            report += f"  Path:\n"
            for step in outcome.path:
                report += f"    â†’ {step}\n"

        # ç·ãƒªã‚¹ã‚¯è¨ˆç®—
        total_risk = sum(o.probability for o in self.outcomes)
        catastrophic_risk = sum(o.probability for o in self.outcomes
                                if o.severity == "Catastrophic")

        report += f"""
{'='*80}
RISK SUMMARY
{'='*80}
Total Event Frequency (all paths): {total_risk:.2e} events/year
Catastrophic Outcome Frequency: {catastrophic_risk:.2e} events/year

Risk Acceptance Criteria (example):
  Catastrophic: < 1e-6 events/year  {'âœ… ACCEPTABLE' if catastrophic_risk &lt; 1e-6 else 'âŒ UNACCEPTABLE'}
  Critical:     < 1e-4 events/year
"""

        return report


# ä½¿ç”¨ä¾‹: å¯ç‡ƒæ€§ã‚¬ã‚¹æ¼æ´©ã‚·ãƒŠãƒªã‚ªã®ETA
eta = EventTreeAnalysis(
    initiating_event="Large flange gasket failure causing H2 release",
    frequency=1e-3  # 0.001å›/å¹´ï¼ˆ1000å¹´ã«1å›ï¼‰
)

# å®‰å…¨æ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆå¤šé‡ä¿è­·å±¤ï¼‰
eta.add_safety_function(EventNode(
    name="Gas detection system activates",
    success_probability=0.95,
    failure_probability=0.05
))

eta.add_safety_function(EventNode(
    name="Automatic isolation valve closes",
    success_probability=0.98,
    failure_probability=0.02
))

eta.add_safety_function(EventNode(
    name="Ignition prevention (no ignition sources)",
    success_probability=0.90,
    failure_probability=0.10
))

# ã‚¤ãƒ™ãƒ³ãƒˆãƒ„ãƒªãƒ¼è§£æå®Ÿè¡Œ
report = eta.generate_eta_report()
print(report)

# è©³ç´°åˆ†æ: æœ€æ‚ªã‚±ãƒ¼ã‚¹ã‚·ãƒŠãƒªã‚ª
worst_case = max(eta.outcomes, key=lambda x: x.probability
                 if x.severity == "Catastrophic" else 0)

print("\n=== WORST CASE SCENARIO ===")
print(f"Consequence: {worst_case.consequence}")
print(f"Frequency: {worst_case.probability:.2e} events/year")
print(f"Return Period: {1/worst_case.probability:.0f} years")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ============================================================================
# EVENT TREE ANALYSIS (ETA) REPORT
# ============================================================================
#
# Initiating Event: Large flange gasket failure causing H2 release
# Frequency: 1.00e-03 events/year
#
# Safety Functions:
# 1. Gas detection system activates
#    Success Prob: 0.9500 (95.00%)
#    Failure Prob: 0.0500 (5.00%)
#
# 2. Automatic isolation valve closes
#    Success Prob: 0.9800 (98.00%)
#    Failure Prob: 0.0200 (2.00%)
# ...
#
# Outcome 1: Major release (offsite consequences)
#   Severity: Catastrophic
#   Frequency: 1.00e-07 events/year  (å…¨3ã¤ã®å®‰å…¨æ©Ÿèƒ½ãŒå¤±æ•—)
#   Path:
#     â†’ Gas detection system activates: Failure
#     â†’ Automatic isolation valve closes: Failure
#     â†’ Ignition prevention (no ignition sources): Failure
</code></pre>

<hr />

<h2>2.5 æ•…éšœé »åº¦ãƒ‡ãƒ¼ã‚¿ã¨ä¿¡é ¼æ€§</h2>

<h3>Example 5: Generic Failure Rate Database</h3>

<pre><code class="language-python"># ===================================
# Example 5: Generic Failure Rate Database
# ===================================

import pandas as pd
from dataclasses import dataclass
from typing import Dict

@dataclass
class FailureRateData:
    """æ•…éšœç‡ãƒ‡ãƒ¼ã‚¿"""
    equipment_type: str
    failure_mode: str
    failure_rate: float  # failures per million hours (10^-6/hr)
    source: str  # ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼ˆOREDA, PDS, etc.ï¼‰
    confidence_factor: float  # 1.0 = nominal, >1.0 = conservative

class GenericFailureRateDatabase:
    """æ±ç”¨æ•…éšœç‡ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹"""

    def __init__(self):
        self.database: Dict[str, FailureRateData] = {}
        self._initialize_database()

    def _initialize_database(self):
        """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ï¼ˆOREDA, PDSç­‰ã®ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãï¼‰"""

        failure_rates = [
            # Valves
            ("Isolation Valve", "Fail to close on demand", 5.0, "OREDA 2015", 1.0),
            ("Control Valve", "Fail open", 10.0, "PDS 2010", 1.0),
            ("Check Valve", "Reverse flow (fail to close)", 50.0, "API 581", 1.5),
            ("Pressure Relief Valve", "Fail to open on demand", 10.0, "API 581", 1.0),

            # Pumps
            ("Centrifugal Pump", "Fail to start", 5.0, "OREDA 2015", 1.0),
            ("Centrifugal Pump", "Fail to run (shutdown)", 50.0, "OREDA 2015", 1.0),

            # Instrumentation
            ("Pressure Transmitter", "Out of calibration", 2.0, "EXIDA", 1.0),
            ("Temperature Transmitter", "Fail dangerous", 1.5, "EXIDA", 1.0),
            ("Level Transmitter", "Fail dangerous", 3.0, "EXIDA", 1.0),
            ("Gas Detector", "Fail to detect", 100.0, "Industry avg", 2.0),

            # Safety Systems
            ("SIS Logic Solver", "Fail dangerous", 0.5, "IEC 61508", 1.0),
            ("Emergency Shutdown Valve", "Fail to close", 3.0, "API 581", 1.0),

            # Vessels & Piping
            ("Pressure Vessel", "Catastrophic rupture", 0.01, "API 579", 1.0),
            ("Piping (per km)", "Major leak (>10% cross-section)", 0.5, "UKOPA", 1.0),
            ("Flange Gasket", "Leak", 10.0, "Industry avg", 1.5),

            # Heat Exchangers
            ("Shell & Tube HX", "Tube leak", 20.0, "OREDA 2015", 1.0)
        ]

        for eq_type, mode, rate, source, cf in failure_rates:
            key = f"{eq_type}_{mode}"
            self.database[key] = FailureRateData(eq_type, mode, rate, source, cf)

    def get_failure_rate(self, equipment_type: str, failure_mode: str,
                         apply_confidence_factor: bool = True) -&gt; float:
        """æ•…éšœç‡ã‚’å–å¾—

        Returns:
            Failure rate in failures per year
        """
        key = f"{equipment_type}_{failure_mode}"
        data = self.database.get(key)

        if not data:
            raise ValueError(f"No data for {equipment_type} - {failure_mode}")

        rate_per_year = data.failure_rate * 8760 / 1e6  # 10^-6/hr â†’ /year

        if apply_confidence_factor:
            rate_per_year *= data.confidence_factor

        return rate_per_year

    def get_pfd_from_test_interval(self, equipment_type: str, failure_mode: str,
                                    test_interval_months: int = 12) -&gt; float:
        """Probability of Failure on Demandï¼ˆè¦æ±‚æ™‚æ•…éšœç¢ºç‡ï¼‰ã‚’è¨ˆç®—

        ç°¡ç•¥å¼: PFD â‰ˆ Î» * T / 2
        Î»: æ•…éšœç‡ï¼ˆ/yearï¼‰
        T: ãƒ†ã‚¹ãƒˆé–“éš”ï¼ˆyearï¼‰
        """
        failure_rate = self.get_failure_rate(equipment_type, failure_mode)
        test_interval_years = test_interval_months / 12.0

        pfd = (failure_rate * test_interval_years) / 2.0

        return min(pfd, 1.0)  # PFDã¯æœ€å¤§1.0

    def generate_reliability_datasheet(self, equipment_list: List[tuple]) -&gt; pd.DataFrame:
        """ä¿¡é ¼æ€§ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆç”Ÿæˆ

        Args:
            equipment_list: [(equipment_type, failure_mode, test_interval_months), ...]
        """
        data = []

        for eq_type, mode, test_interval in equipment_list:
            failure_rate = self.get_failure_rate(eq_type, mode)
            pfd = self.get_pfd_from_test_interval(eq_type, mode, test_interval)

            # SIL capabilityåˆ¤å®š
            if pfd &lt; 1e-4:
                sil_capability = "SIL 3"
            elif pfd &lt; 1e-3:
                sil_capability = "SIL 2"
            elif pfd &lt; 1e-2:
                sil_capability = "SIL 1"
            else:
                sil_capability = "No SIL"

            data.append({
                'Equipment': eq_type,
                'Failure Mode': mode,
                'Failure Rate': f"{failure_rate:.2e} /yr",
                'Test Interval': f"{test_interval} months",
                'PFD': f"{pfd:.2e}",
                'SIL Capability': sil_capability,
                'MTTF': f"{1/failure_rate:.1f} years" if failure_rate > 0 else "N/A"
            })

        return pd.DataFrame(data)


# ä½¿ç”¨ä¾‹
failure_db = GenericFailureRateDatabase()

# ä¿¡é ¼æ€§ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆä½œæˆ
equipment_list = [
    ("Isolation Valve", "Fail to close on demand", 12),
    ("Pressure Relief Valve", "Fail to open on demand", 24),
    ("Gas Detector", "Fail to detect", 3),
    ("SIS Logic Solver", "Fail dangerous", 12),
    ("Emergency Shutdown Valve", "Fail to close", 6)
]

reliability_sheet = failure_db.generate_reliability_datasheet(equipment_list)

print("=== Reliability Datasheet ===\n")
print(reliability_sheet.to_string(index=False))

# å€‹åˆ¥ã®æ•…éšœç‡å–å¾—
prv_failure_rate = failure_db.get_failure_rate(
    "Pressure Relief Valve",
    "Fail to open on demand"
)
print(f"\n=== PRV Reliability ===")
print(f"Failure Rate: {prv_failure_rate:.2e} /year")
print(f"MTTF: {1/prv_failure_rate:.1f} years")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === Reliability Datasheet ===
#
#                   Equipment              Failure Mode Failure Rate Test Interval      PFD SIL Capability  MTTF
#          Isolation Valve  Fail to close on demand   4.38e-05 /yr     12 months 2.19e-05        SIL 3  22831.1 years
#  Pressure Relief Valve  Fail to open on demand   8.76e-05 /yr     24 months 8.76e-05        SIL 3  11415.5 years
#            Gas Detector            Fail to detect   8.76e-04 /yr      3 months 1.09e-04        SIL 3  1141.6 years
#       SIS Logic Solver           Fail dangerous   4.38e-06 /yr     12 months 2.19e-06        SIL 4  228310.5 years
# Emergency Shutdown Valve            Fail to close   2.63e-05 /yr      6 months 6.57e-06        SIL 4  38041.8 years
</code></pre>

<hr />

<h2>2.6 F-Næ›²ç·šã¨ãƒªã‚¹ã‚¯åŸºæº–</h2>

<h3>Example 6: F-Næ›²ç·šï¼ˆFrequency-Number curveï¼‰</h3>

<p>ç¤¾ä¼šãƒªã‚¹ã‚¯ã‚’è©•ä¾¡ã™ã‚‹F-Næ›²ç·šã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<pre><code class="language-python"># ===================================
# Example 6: F-Næ›²ç·šã¨ãƒªã‚¹ã‚¯åŸºæº–
# ===================================

import matplotlib.pyplot as plt
import numpy as np
from dataclasses import dataclass
from typing import List

@dataclass
class RiskScenario:
    """ãƒªã‚¹ã‚¯ã‚·ãƒŠãƒªã‚ª"""
    name: str
    frequency: float  # events/year
    fatalities: int   # Expected number of fatalities

class FNCurveAnalysis:
    """F-Næ›²ç·šåˆ†æã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, facility_name: str):
        self.facility_name = facility_name
        self.scenarios: List[RiskScenario] = []

        # è¨±å®¹ãƒªã‚¹ã‚¯åŸºæº–ç·šï¼ˆã‚ªãƒ©ãƒ³ãƒ€åŸºæº–ä¾‹ï¼‰
        self.alarp_upper_limit = lambda N: 1e-3 / (N**2)  # Upper ALARP
        self.alarp_lower_limit = lambda N: 1e-5 / (N**2)  # Lower ALARP
        self.negligible_limit = lambda N: 1e-7 / (N**2)   # Negligible

    def add_scenario(self, scenario: RiskScenario):
        """ã‚·ãƒŠãƒªã‚ªã‚’è¿½åŠ """
        self.scenarios.append(scenario)

    def calculate_fn_curve_data(self) -&gt; tuple:
        """F-Næ›²ç·šãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—

        Returns:
            (N_values, F_values): æ­»è€…æ•°ã¨ãã®ç´¯ç©é »åº¦
        """
        # æ­»è€…æ•°ã§ã‚½ãƒ¼ãƒˆ
        sorted_scenarios = sorted(self.scenarios, key=lambda x: x.fatalities)

        N_values = []
        F_values = []

        for scenario in sorted_scenarios:
            N = scenario.fatalities
            # Näººä»¥ä¸Šã®æ­»è€…ãŒå‡ºã‚‹äº‹è±¡ã®ç´¯ç©é »åº¦
            F = sum(s.frequency for s in self.scenarios if s.fatalities &gt;= N)

            N_values.append(N)
            F_values.append(F)

        return np.array(N_values), np.array(F_values)

    def plot_fn_curve(self, save_path: str = None):
        """F-Næ›²ç·šã‚’ãƒ—ãƒ­ãƒƒãƒˆ"""
        N, F = self.calculate_fn_curve_data()

        fig, ax = plt.subplots(figsize=(10, 8))

        # F-Næ›²ç·šãƒ—ãƒ­ãƒƒãƒˆ
        ax.loglog(N, F, 'bo-', linewidth=2, markersize=8,
                  label='Facility Risk Profile', zorder=5)

        # å€‹åˆ¥ã‚·ãƒŠãƒªã‚ªã‚’ãƒ—ãƒ­ãƒƒãƒˆ
        for scenario in self.scenarios:
            ax.plot(scenario.fatalities, scenario.frequency,
                    'rx', markersize=10, markeredgewidth=2)
            ax.annotate(scenario.name,
                        xy=(scenario.fatalities, scenario.frequency),
                        xytext=(10, 10), textcoords='offset points',
                        fontsize=8, alpha=0.7)

        # è¨±å®¹ãƒªã‚¹ã‚¯åŸºæº–ç·š
        N_range = np.logspace(0, 3, 100)  # 1-1000äºº

        ax.loglog(N_range, [self.alarp_upper_limit(n) for n in N_range],
                  'r--', linewidth=2, label='ALARP Upper Limit (Unacceptable)')
        ax.loglog(N_range, [self.alarp_lower_limit(n) for n in N_range],
                  'y--', linewidth=2, label='ALARP Lower Limit')
        ax.loglog(N_range, [self.negligible_limit(n) for n in N_range],
                  'g--', linewidth=2, label='Negligible Risk')

        # ALARPé ˜åŸŸã‚’å¡—ã‚Šã¤ã¶ã—
        ax.fill_between(N_range,
                        [self.alarp_lower_limit(n) for n in N_range],
                        [self.alarp_upper_limit(n) for n in N_range],
                        alpha=0.2, color='yellow', label='ALARP Region')

        ax.set_xlabel('Number of Fatalities (N)', fontsize=12, fontweight='bold')
        ax.set_ylabel('Cumulative Frequency (F) [events/year]', fontsize=12, fontweight='bold')
        ax.set_title(f'F-N Curve: {self.facility_name}\nSocietal Risk Assessment',
                     fontsize=14, fontweight='bold')
        ax.grid(True, which='both', alpha=0.3)
        ax.legend(loc='upper right')

        ax.set_xlim([1, 1000])
        ax.set_ylim([1e-8, 1e-2])

        plt.tight_layout()

        if save_path:
            plt.savefig(save_path, dpi=300, bbox_inches='tight')

        return fig

    def assess_alarp_status(self) -&gt; Dict:
        """ALARPçŠ¶æ…‹ã‚’è©•ä¾¡"""
        results = {
            'unacceptable': [],
            'alarp': [],
            'broadly_acceptable': []
        }

        for scenario in self.scenarios:
            N = scenario.fatalities
            F = scenario.frequency

            if F &gt; self.alarp_upper_limit(N):
                results['unacceptable'].append(scenario)
            elif F &gt; self.alarp_lower_limit(N):
                results['alarp'].append(scenario)
            else:
                results['broadly_acceptable'].append(scenario)

        return results

    def generate_alarp_report(self) -&gt; str:
        """ALARPãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
        status = self.assess_alarp_status()

        report = f"""
{'='*80}
F-N CURVE ANALYSIS - ALARP ASSESSMENT
{'='*80}

Facility: {self.facility_name}
Total Scenarios Analyzed: {len(self.scenarios)}

{'='*80}
RISK CLASSIFICATION
{'='*80}

UNACCEPTABLE REGION (Above ALARP Upper Limit):
  Scenarios: {len(status['unacceptable'])}
"""

        if status['unacceptable']:
            for s in status['unacceptable']:
                report += f"  âŒ {s.name}: F={s.frequency:.2e}/yr, N={s.fatalities}\n"
            report += "  ACTION: Immediate risk reduction REQUIRED\n"
        else:
            report += "  âœ… No scenarios in unacceptable region\n"

        report += f"""
ALARP REGION (Risk Reduction As Low As Reasonably Practicable):
  Scenarios: {len(status['alarp'])}
"""

        if status['alarp']:
            for s in status['alarp']:
                report += f"  âš ï¸  {s.name}: F={s.frequency:.2e}/yr, N={s.fatalities}\n"
            report += "  ACTION: Demonstrate ALARP (cost-benefit analysis)\n"
        else:
            report += "  âœ… No scenarios in ALARP region\n"

        report += f"""
BROADLY ACCEPTABLE REGION (Below ALARP Lower Limit):
  Scenarios: {len(status['broadly_acceptable'])}
"""

        if status['broadly_acceptable']:
            for s in status['broadly_acceptable']:
                report += f"  âœ… {s.name}: F={s.frequency:.2e}/yr, N={s.fatalities}\n"
            report += "  ACTION: Maintain current safety measures\n"

        report += f"\n{'='*80}\n"

        return report


# ä½¿ç”¨ä¾‹: LNGå—å…¥åŸºåœ°ã®F-Næ›²ç·šåˆ†æ
fn_analysis = FNCurveAnalysis(facility_name="LNG Import Terminal")

# ãƒªã‚¹ã‚¯ã‚·ãƒŠãƒªã‚ªã‚’è¿½åŠ 
fn_analysis.add_scenario(RiskScenario(
    name="Small LNG leak (no ignition)",
    frequency=1e-2,
    fatalities=0
))

fn_analysis.add_scenario(RiskScenario(
    name="Medium LNG leak â†’ jet fire",
    frequency=5e-4,
    fatalities=2
))

fn_analysis.add_scenario(RiskScenario(
    name="Large LNG leak â†’ pool fire",
    frequency=1e-4,
    fatalities=10
))

fn_analysis.add_scenario(RiskScenario(
    name="Catastrophic tank failure â†’ VCE",
    frequency=1e-6,
    fatalities=100
))

fn_analysis.add_scenario(RiskScenario(
    name="LNG carrier collision â†’ BLEVE",
    frequency=5e-7,
    fatalities=300
))

# ALARPãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
alarp_report = fn_analysis.generate_alarp_report()
print(alarp_report)

# F-Næ›²ç·šãƒ—ãƒ­ãƒƒãƒˆ
fig = fn_analysis.plot_fn_curve()
# plt.show()

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ============================================================================
# F-N CURVE ANALYSIS - ALARP ASSESSMENT
# ============================================================================
#
# Facility: LNG Import Terminal
# Total Scenarios Analyzed: 5
#
# ============================================================================
# RISK CLASSIFICATION
# ============================================================================
#
# UNACCEPTABLE REGION (Above ALARP Upper Limit):
#   Scenarios: 0
#   âœ… No scenarios in unacceptable region
#
# ALARP REGION (Risk Reduction As Low As Reasonably Practicable):
#   Scenarios: 2
#   âš ï¸  Medium LNG leak â†’ jet fire: F=5.00e-04/yr, N=2
#   âš ï¸  Large LNG leak â†’ pool fire: F=1.00e-04/yr, N=10
#   ACTION: Demonstrate ALARP (cost-benefit analysis)
#
# BROADLY ACCEPTABLE REGION (Below ALARP Lower Limit):
#   Scenarios: 2
#   âœ… Catastrophic tank failure â†’ VCE: F=1.00e-06/yr, N=100
#   âœ… LNG carrier collision â†’ BLEVE: F=5.00e-07/yr, N=300
#   ACTION: Maintain current safety measures
</code></pre>

<hr />

<h2>2.7 HAZOPãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ</h2>

<h3>Example 7: åŒ…æ‹¬çš„HAZOPãƒ¬ãƒãƒ¼ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h3>

<pre><code class="language-python"># ===================================
# Example 7: HAZOPãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
# ===================================

from datetime import datetime
import json

class HAZOPReportGenerator:
    """HAZOP studyå®Œå…¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, project_info: Dict):
        self.project_info = project_info
        self.hazop_nodes = []
        self.team_members = []

    def add_team_member(self, name: str, role: str):
        """ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ """
        self.team_members.append({'name': name, 'role': role})

    def generate_full_report(self, deviations_by_node: Dict[str, List[Deviation]]) -&gt; str:
        """å®Œå…¨ãªHAZOPãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ

        Args:
            deviations_by_node: {node_name: [Deviation, ...], ...}
        """

        report = self._generate_cover_page()
        report += self._generate_executive_summary(deviations_by_node)
        report += self._generate_methodology_section()
        report += self._generate_detailed_worksheets(deviations_by_node)
        report += self._generate_action_items(deviations_by_node)
        report += self._generate_appendices()

        return report

    def _generate_cover_page(self) -&gt; str:
        """è¡¨ç´™ãƒšãƒ¼ã‚¸"""
        return f"""
{'='*80}
HAZARD AND OPERABILITY STUDY (HAZOP)
FINAL REPORT
{'='*80}

Project:     {self.project_info.get('name', 'N/A')}
Facility:    {self.project_info.get('facility', 'N/A')}
Location:    {self.project_info.get('location', 'N/A')}

Study Date:  {self.project_info.get('study_date', datetime.now().strftime('%Y-%m-%d'))}
Report Date: {datetime.now().strftime('%Y-%m-%d')}

Document No: {self.project_info.get('doc_number', 'HAZOP-001')}
Revision:    {self.project_info.get('revision', '0')}

{'='*80}
STUDY TEAM
{'='*80}

"""

    def _generate_executive_summary(self, deviations_by_node: Dict) -&gt; str:
        """ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼"""

        total_deviations = sum(len(devs) for devs in deviations_by_node.values())
        high_risk = sum(1 for devs in deviations_by_node.values()
                        for dev in devs if dev.risk_rank == "High")

        summary = f"""
EXECUTIVE SUMMARY
{'='*80}

Study Scope:
  - Total HAZOP Nodes:     {len(deviations_by_node)}
  - Total Deviations:      {total_deviations}
  - High Risk Scenarios:   {high_risk}

Key Findings:
  1. {high_risk} high-risk scenarios identified requiring immediate attention
  2. All scenarios have been assessed with existing safeguards documented
  3. Recommendations provided for risk reduction where needed

Overall Assessment:
"""

        if high_risk == 0:
            summary += "  âœ… No high-risk scenarios. Facility design is robust.\n"
        elif high_risk &lt;= 3:
            summary += f"  âš ï¸  {high_risk} high-risk scenarios require mitigation.\n"
        else:
            summary += f"  âŒ {high_risk} high-risk scenarios - major design review recommended.\n"

        return summary + "\n"

    def _generate_methodology_section(self) -&gt; str:
        """æ–¹æ³•è«–ã‚»ã‚¯ã‚·ãƒ§ãƒ³"""
        return f"""
METHODOLOGY
{'='*80}

1. HAZOP Technique:
   - Guide Words applied to process parameters
   - Systematic deviation analysis
   - Cause-Consequence-Safeguard approach

2. Risk Ranking:
   - High:   Immediate action required
   - Medium: Risk reduction should be considered
   - Low:    Acceptable with existing safeguards

3. Documentation:
   - P&ID reviewed: {self.project_info.get('pid_revision', 'Rev 0')}
   - Process conditions: {self.project_info.get('process_basis', 'Normal operation')}

"""

    def _generate_detailed_worksheets(self, deviations_by_node: Dict) -&gt; str:
        """è©³ç´°ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ"""
        worksheets = f"""
DETAILED HAZOP WORKSHEETS
{'='*80}

"""

        for node_name, deviations in deviations_by_node.items():
            worksheets += f"\nNode: {node_name}\n"
            worksheets += f"{'-'*80}\n\n"

            for i, dev in enumerate(deviations, 1):
                worksheets += f"Deviation {i}: {dev.description}\n"
                worksheets += f"Risk Rank: {dev.risk_rank}\n\n"

                worksheets += "Potential Causes:\n"
                for cause in dev.potential_causes:
                    worksheets += f"  - {cause}\n"

                worksheets += "\nPotential Consequences:\n"
                for cons in dev.potential_consequences:
                    worksheets += f"  - {cons}\n"

                worksheets += "\nExisting Safeguards:\n"
                for sg in dev.existing_safeguards:
                    worksheets += f"  - {sg}\n"

                worksheets += "\nRecommendations:\n"
                for rec in dev.recommendations:
                    worksheets += f"  - {rec}\n"

                worksheets += "\n" + "-"*80 + "\n\n"

        return worksheets

    def _generate_action_items(self, deviations_by_node: Dict) -&gt; str:
        """ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ """
        actions = f"""
ACTION ITEM REGISTER
{'='*80}

"""

        action_id = 1
        for node_name, deviations in deviations_by_node.items():
            for dev in deviations:
                for rec in dev.recommendations:
                    if "adequate" not in rec.lower():  # å¯¾å¿œä¸è¦ã®æ¨å¥¨äº‹é …ã‚’ã‚¹ã‚­ãƒƒãƒ—
                        priority = "HIGH" if dev.risk_rank == "High" else "MEDIUM"
                        actions += f"Action {action_id:03d}: [{priority}] {rec}\n"
                        actions += f"  Node: {node_name}\n"
                        actions += f"  Deviation: {dev.description}\n"
                        actions += f"  Responsible: TBD\n"
                        actions += f"  Target Date: TBD\n\n"
                        action_id += 1

        return actions

    def _generate_appendices(self) -&gt; str:
        """ä»˜éŒ²"""
        return f"""
APPENDICES
{'='*80}

Appendix A: P&ID Drawings
Appendix B: Study Team Attendance Records
Appendix C: Risk Matrix Definition
Appendix D: Abbreviations and Definitions

"""

    def export_to_json(self, deviations_by_node: Dict, filepath: str):
        """JSONå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"""
        export_data = {
            'project_info': self.project_info,
            'study_date': datetime.now().isoformat(),
            'nodes': {}
        }

        for node_name, deviations in deviations_by_node.items():
            export_data['nodes'][node_name] = [
                {
                    'description': dev.description,
                    'guide_word': dev.guide_word.value,
                    'parameter': dev.parameter.value,
                    'causes': dev.potential_causes,
                    'consequences': dev.potential_consequences,
                    'safeguards': dev.existing_safeguards,
                    'recommendations': dev.recommendations,
                    'risk_rank': dev.risk_rank
                }
                for dev in deviations
            ]

        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(export_data, f, indent=2, ensure_ascii=False)


# ä½¿ç”¨ä¾‹
project_info = {
    'name': 'Ethylene Polymerization Plant',
    'facility': 'Reactor Section',
    'location': 'Yokkaichi, Japan',
    'study_date': '2025-10-15',
    'doc_number': 'HAZOP-EPP-001',
    'revision': '0',
    'pid_revision': 'Rev 2',
    'process_basis': 'Normal operation at 85% capacity'
}

report_gen = HAZOPReportGenerator(project_info)

# ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 
report_gen.add_team_member("Dr. Smith", "HAZOP Leader")
report_gen.add_team_member("Eng. Tanaka", "Process Engineer")
report_gen.add_team_member("Eng. Kim", "Instrument Engineer")

# é€¸è„±ãƒ‡ãƒ¼ã‚¿ï¼ˆExample 2ã§ç”Ÿæˆã—ãŸã‚‚ã®ï¼‰
analyzer = DeviationAnalyzer("Reactor R-101", "Vessel")
analyzer.analyze_deviation(GuideWord.NO, ProcessParameter.FLOW)
analyzer.analyze_deviation(GuideWord.MORE, ProcessParameter.TEMPERATURE)

deviations_data = {
    "Reactor R-101": analyzer.deviations
}

# ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
full_report = report_gen.generate_full_report(deviations_data)
print(full_report[:2000])  # æœ€åˆã®2000æ–‡å­—ã‚’è¡¨ç¤º

# JSON ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
# report_gen.export_to_json(deviations_data, "hazop_study_results.json")
# print("\nâœ… HAZOP study exported to hazop_study_results.json")

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# ============================================================================
# HAZARD AND OPERABILITY STUDY (HAZOP)
# FINAL REPORT
# ============================================================================
#
# Project:     Ethylene Polymerization Plant
# Facility:    Reactor Section
# Location:    Yokkaichi, Japan
# ...
</code></pre>

<hr />

<h2>2.8 ãƒªã‚¹ã‚¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¨å„ªå…ˆé †ä½ä»˜ã‘</h2>

<h3>Example 8: å¤šåŸºæº–æ„æ€æ±ºå®šåˆ†æï¼ˆMCDAï¼‰</h3>

<p>è¤‡æ•°ã®ãƒªã‚¹ã‚¯ã‚·ãƒŠãƒªã‚ªã‚’ç·åˆçš„ã«è©•ä¾¡ã—ã€å¯¾ç­–ã®å„ªå…ˆé †ä½ã‚’æ±ºå®šã—ã¾ã™ã€‚</p>

<pre><code class="language-python"># ===================================
# Example 8: å¤šåŸºæº–æ„æ€æ±ºå®šåˆ†æï¼ˆMCDAï¼‰
# ===================================

import pandas as pd
import numpy as np
from dataclasses import dataclass
from typing import List, Dict

@dataclass
class RiskCriteria:
    """ãƒªã‚¹ã‚¯è©•ä¾¡åŸºæº–"""
    likelihood: float       # 1-5
    severity_people: float  # 1-5 (äººçš„è¢«å®³)
    severity_env: float     # 1-5 (ç’°å¢ƒå½±éŸ¿)
    severity_asset: float   # 1-5 (è³‡ç”£æå¤±)
    detectability: float    # 1-5 (æ¤œçŸ¥å®¹æ˜“æ€§ã€ä½ã„ã»ã©è‰¯ã„)

class MultiCriteriaRiskRanking:
    """å¤šåŸºæº–ãƒªã‚¹ã‚¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self):
        # åŸºæº–ã®é‡ã¿ï¼ˆåˆè¨ˆ1.0ï¼‰
        self.weights = {
            'likelihood': 0.25,
            'severity_people': 0.35,  # äººçš„è¢«å®³ã‚’æœ€é‡è¦–
            'severity_env': 0.20,
            'severity_asset': 0.15,
            'detectability': 0.05
        }

    def calculate_risk_priority_number(self, criteria: RiskCriteria) -&gt; float:
        """ãƒªã‚¹ã‚¯å„ªå…ˆåº¦ç•ªå·ï¼ˆRPNï¼‰ã‚’è¨ˆç®—"""

        # åŠ é‡å¹³å‡ã‚¹ã‚³ã‚¢
        weighted_score = (
            criteria.likelihood * self.weights['likelihood'] +
            criteria.severity_people * self.weights['severity_people'] +
            criteria.severity_env * self.weights['severity_env'] +
            criteria.severity_asset * self.weights['severity_asset'] +
            criteria.detectability * self.weights['detectability']
        )

        # 0-100ã‚¹ã‚±ãƒ¼ãƒ«ã«æ­£è¦åŒ–
        rpn = weighted_score * 20

        return rpn

    def rank_scenarios(self, scenarios: Dict[str, RiskCriteria]) -&gt; pd.DataFrame:
        """ã‚·ãƒŠãƒªã‚ªã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°"""

        data = []

        for scenario_name, criteria in scenarios.items():
            rpn = self.calculate_risk_priority_number(criteria)

            # å„ªå…ˆåº¦ãƒ¬ãƒ™ãƒ«åˆ¤å®š
            if rpn &gt;= 80:
                priority = "Critical (P1)"
            elif rpn &gt;= 60:
                priority = "High (P2)"
            elif rpn &gt;= 40:
                priority = "Medium (P3)"
            else:
                priority = "Low (P4)"

            data.append({
                'Scenario': scenario_name,
                'Likelihood': criteria.likelihood,
                'Sev_People': criteria.severity_people,
                'Sev_Env': criteria.severity_env,
                'Sev_Asset': criteria.severity_asset,
                'Detectability': criteria.detectability,
                'RPN': f"{rpn:.1f}",
                'Priority': priority
            })

        df = pd.DataFrame(data)
        df = df.sort_values('RPN', ascending=False, key=lambda x: x.astype(float))

        return df

    def sensitivity_analysis(self, criteria: RiskCriteria, scenario_name: str):
        """æ„Ÿåº¦åˆ†æ: å„åŸºæº–ã®å¤‰åŒ–ãŒRPNã«ä¸ãˆã‚‹å½±éŸ¿"""

        baseline_rpn = self.calculate_risk_priority_number(criteria)

        print(f"\n=== Sensitivity Analysis: {scenario_name} ===")
        print(f"Baseline RPN: {baseline_rpn:.1f}\n")

        print("Impact of +1 change in each criterion:")

        # Likelihood +1
        temp_criteria = RiskCriteria(
            criteria.likelihood + 1,
            criteria.severity_people,
            criteria.severity_env,
            criteria.severity_asset,
            criteria.detectability
        )
        new_rpn = self.calculate_risk_priority_number(temp_criteria)
        print(f"  Likelihood +1:        {baseline_rpn:.1f} â†’ {new_rpn:.1f} (Î”{new_rpn-baseline_rpn:+.1f})")

        # Severity_People +1
        temp_criteria = RiskCriteria(
            criteria.likelihood,
            min(criteria.severity_people + 1, 5),
            criteria.severity_env,
            criteria.severity_asset,
            criteria.detectability
        )
        new_rpn = self.calculate_risk_priority_number(temp_criteria)
        print(f"  Severity_People +1:   {baseline_rpn:.1f} â†’ {new_rpn:.1f} (Î”{new_rpn-baseline_rpn:+.1f})")

        # Detectability -1 (lower is better)
        temp_criteria = RiskCriteria(
            criteria.likelihood,
            criteria.severity_people,
            criteria.severity_env,
            criteria.severity_asset,
            max(criteria.detectability - 1, 1)
        )
        new_rpn = self.calculate_risk_priority_number(temp_criteria)
        print(f"  Detectability -1:     {baseline_rpn:.1f} â†’ {new_rpn:.1f} (Î”{new_rpn-baseline_rpn:+.1f})")


# ä½¿ç”¨ä¾‹
mcda = MultiCriteriaRiskRanking()

# è¤‡æ•°ã®ãƒªã‚¹ã‚¯ã‚·ãƒŠãƒªã‚ªã‚’è©•ä¾¡
scenarios = {
    "Reactor overpressure (no relief)": RiskCriteria(
        likelihood=2,         # Occasional
        severity_people=5,    # Catastrophic
        severity_env=4,       # Critical
        severity_asset=5,     # Catastrophic
        detectability=2       # Good detection (pressure transmitter)
    ),

    "Toxic gas release (H2S)": RiskCriteria(
        likelihood=3,         # Probable
        severity_people=4,    # Critical
        severity_env=3,       # Marginal
        severity_asset=2,     # Negligible
        detectability=3       # Moderate detection
    ),

    "Loss of cooling water": RiskCriteria(
        likelihood=4,         # Frequent
        severity_people=2,    # Negligible
        severity_env=1,       # Minimal
        severity_asset=3,     # Marginal
        detectability=1       # Excellent detection (flow transmitter)
    ),

    "Runaway polymerization": RiskCriteria(
        likelihood=2,         # Occasional
        severity_people=4,    # Critical
        severity_env=3,       # Marginal
        severity_asset=4,     # Critical
        detectability=3       # Moderate detection
    ),

    "Flange gasket leak": RiskCriteria(
        likelihood=3,         # Probable
        severity_people=2,    # Negligible
        severity_env=2,       # Negligible
        severity_asset=1,     # Minimal
        detectability=4       # Poor detection (visual inspection)
    )
}

# ãƒ©ãƒ³ã‚­ãƒ³ã‚°å®Ÿæ–½
ranking = mcda.rank_scenarios(scenarios)

print("=== Multi-Criteria Risk Ranking ===\n")
print(ranking.to_string(index=False))

# æœ€é«˜ãƒªã‚¹ã‚¯ã‚·ãƒŠãƒªã‚ªã®æ„Ÿåº¦åˆ†æ
top_scenario_name = ranking.iloc[0]['Scenario']
top_scenario_criteria = scenarios[top_scenario_name]

mcda.sensitivity_analysis(top_scenario_criteria, top_scenario_name)

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# === Multi-Criteria Risk Ranking ===
#
#                        Scenario  Likelihood  Sev_People  Sev_Env  Sev_Asset  Detectability    RPN      Priority
#  Reactor overpressure (no relief)           2           5        4          5              2   80.0  Critical (P1)
#         Runaway polymerization           2           4        3          4              3   66.0      High (P2)
#          Toxic gas release (H2S)           3           4        3          2              3   66.0      High (P2)
#            Loss of cooling water           4           2        1          3              1   48.0    Medium (P3)
#                Flange gasket leak           3           2        2          1              4   44.0    Medium (P3)
#
# === Sensitivity Analysis: Reactor overpressure (no relief) ===
# Baseline RPN: 80.0
#
# Impact of +1 change in each criterion:
#   Likelihood +1:        80.0 â†’ 85.0 (Î”+5.0)
#   Severity_People +1:   80.0 â†’ 80.0 (Î”+0.0)  # Already at max (5)
#   Detectability -1:     80.0 â†’ 79.0 (Î”-1.0)
</code></pre>

<hr />

<h2>å­¦ç¿’ç›®æ¨™ã®ç¢ºèª</h2>

<p>ã“ã®chapterã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã‚’èª¬æ˜ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š</p>

<h3>åŸºæœ¬ç†è§£</h3>

<ul>
<li>âœ… HAZOPã®åŸç†ã¨ã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã®é©ç”¨æ–¹æ³•ã‚’ç†è§£ã—ã¦ã„ã‚‹</li>
<li>âœ… é€¸è„±åˆ†æã®ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆåŸå› -çµæœ-å¯¾ç­–ï¼‰ã‚’çŸ¥ã£ã¦ã„ã‚‹</li>
<li>âœ… QRAã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒ„ãƒªãƒ¼è§£æã®é•ã„ã‚’ç†è§£ã—ã¦ã„ã‚‹</li>
<li>âœ… F-Næ›²ç·šã¨ALARPæ¦‚å¿µã‚’èª¬æ˜ã§ãã‚‹</li>
</ul>

<h3>å®Ÿè·µã‚¹ã‚­ãƒ«</h3>

<ul>
<li>âœ… HAZOPã‚¬ã‚¤ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã‚’ä½“ç³»çš„ã«é©ç”¨ã§ãã‚‹</li>
<li>âœ… P&IDã‹ã‚‰HAZOPãƒãƒ¼ãƒ‰ã‚’è­˜åˆ¥ã§ãã‚‹</li>
<li>âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒ„ãƒªãƒ¼è§£æã§äº‹è±¡é€£é–ã‚’è©•ä¾¡ã§ãã‚‹</li>
<li>âœ… æ•…éšœç‡ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ´»ç”¨ã—ã¦PFDã‚’è¨ˆç®—ã§ãã‚‹</li>
<li>âœ… F-Næ›²ç·šã‚’ä½œæˆã—ALARPåˆ¤å®šãŒã§ãã‚‹</li>
<li>âœ… åŒ…æ‹¬çš„HAZOPãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã§ãã‚‹</li>
</ul>

<h3>å¿œç”¨åŠ›</h3>

<ul>
<li>âœ… å®Ÿéš›ã®åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã«å¯¾ã—ã¦HAZOPã‚¹ã‚¿ãƒ‡ã‚£ã‚’å®Ÿæ–½ã§ãã‚‹</li>
<li>âœ… å®šé‡çš„ãƒªã‚¹ã‚¯è©•ä¾¡ï¼ˆQRAï¼‰ã‚’å®Ÿè·µã§ãã‚‹</li>
<li>âœ… å¤šåŸºæº–æ„æ€æ±ºå®šåˆ†æã§å¯¾ç­–å„ªå…ˆé †ä½ã‚’æ±ºå®šã§ãã‚‹</li>
<li>âœ… HAZOPãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—æ„æ€æ±ºå®šã‚’æ”¯æ´ã§ãã‚‹</li>
</ul>

<hr />

<h2>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h2>

<p>ç¬¬2ç« ã§ã¯ã€HAZOPã€QRAã€F-Næ›²ç·šã‚’å­¦ã³ã¾ã—ãŸã€‚</p>

<p><strong>ç¬¬3ç« ã§ã¯ï¼š</strong></p>

<ul>
<li>ğŸ“‹ FMEAï¼ˆæ•…éšœãƒ¢ãƒ¼ãƒ‰å½±éŸ¿è§£æï¼‰</li>
<li>ğŸ“‹ ä¿¡é ¼æ€§å·¥å­¦ã¨MTBFè¨ˆç®—</li>
<li>ğŸ“‹ ãƒ•ã‚©ãƒ¼ãƒ«ãƒˆãƒ„ãƒªãƒ¼è§£æï¼ˆFTAï¼‰</li>
<li>ğŸ“‹ äºˆé˜²ä¿å…¨æœ€é©åŒ–ï¼ˆRCMï¼‰</li>
</ul>

<p>ã‚’å­¦ã³ã¾ã™ã€‚</p>

        <div class="navigation">
            <a href="./chapter-1.html" class="nav-button">â† ç¬¬1ç« ã«æˆ»ã‚‹</a>
            <a href="./index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡</a>
        </div>
    </main>

    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>HAZOP studyã¯è¨“ç·´ã‚’å—ã‘ãŸå°‚é–€å®¶ãƒãƒ¼ãƒ ã§å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ã«åŸºã¥ãHAZOPã¯ä¸å®Œå…¨ã§ã™ã€‚</li>
            <li>æ•…éšœç‡ãƒ‡ãƒ¼ã‚¿ã¯ä¸€èˆ¬çš„ãªå€¤ã§ã‚ã‚Šã€å®Ÿéš›ã®è¨­å‚™ã§ã¯é‹è»¢æ¡ä»¶ã€ä¿å…¨çŠ¶æ³ã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ã€‚</li>
            <li>ãƒªã‚¹ã‚¯åŸºæº–ï¼ˆF-Næ›²ç·šï¼‰ã¯å„å›½ãƒ»åœ°åŸŸã®è¦åˆ¶ã«å¾“ã£ã¦ãã ã•ã„ã€‚æœ¬ä¾‹ã¯æ•™è‚²ç›®çš„ã®ç°¡ç•¥åŒ–ãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ã«ã‚ˆã‚Šæå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
        </ul>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2025 PI Knowledge Hub - Dr. Yusuke Hashimoto, Tohoku University</p>
            <p>Licensed under CC BY 4.0</p>
        </div>
    </footer>
</body>
</html>
