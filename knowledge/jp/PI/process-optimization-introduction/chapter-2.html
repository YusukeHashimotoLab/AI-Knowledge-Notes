<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¬¬2ç« :ç·šå½¢è¨ˆç”»æ³•ãƒ»éç·šå½¢è¨ˆç”»æ³• - ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–å…¥é–€ã‚·ãƒªãƒ¼ã‚º">
    <title>ç¬¬2ç« :ç·šå½¢è¨ˆç”»æ³•ãƒ»éç·šå½¢è¨ˆç”»æ³• - ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–å…¥é–€ | PI Terakoya</title>

        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8; color: #333; background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; padding: 2rem 1rem; text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .back-link {
            display: inline-block; margin-bottom: 2rem; padding: 0.5rem 1rem;
            background: white; color: #11998e; text-decoration: none;
            border-radius: 6px; font-weight: 600;
        }
        .content-box {
            background: white; padding: 2rem; border-radius: 12px;
            margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #11998e; margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem; border-bottom: 3px solid #11998e;
        }
        h3 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h4 { color: #2c3e50; margin: 1rem 0 0.5rem 0; }
        p { margin-bottom: 1rem; }
        ul, ol { margin-left: 2rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
        pre {
            background: #1e1e1e; color: #d4d4d4; padding: 1.5rem;
            border-radius: 8px; overflow-x: auto; margin: 1rem 0;
            border-left: 4px solid #11998e;
        }
        code {
            font-family: 'Courier New', monospace; font-size: 0.9rem;
        }
        .key-point {
            background: #e8f5e9; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #4caf50; margin: 1rem 0;
        }
        .tech-note {
            background: #e3f2fd; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #2196f3; margin: 1rem 0;
        }
        .formula {
            background: #f0f7ff; padding: 1rem; border-radius: 6px;
            margin: 1rem 0; overflow-x: auto;
        }
        table {
            width: 100%; border-collapse: collapse; margin: 1rem 0;
        }
        th, td {
            border: 1px solid #ddd; padding: 0.75rem; text-align: left;
        }
        th {
            background: #11998e; color: white; font-weight: 600;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: 3rem;
        }
        .nav-buttons a {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; text-decoration: none; border-radius: 6px;
            font-weight: 600;
        }
        footer {
            background: #2c3e50; color: white; text-align: center;
            padding: 2rem 1rem; margin-top: 4rem;
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.6rem; }
            .container { padding: 0 0.5rem; }
            pre { padding: 1rem; }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>ç¬¬2ç« :ç·šå½¢è¨ˆç”»æ³•ãƒ»éç·šå½¢è¨ˆç”»æ³•</h1>
            <p class="subtitle">ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã¨å‹¾é…ãƒ™ãƒ¼ã‚¹ã®æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </p>
            <div class="meta">
                <span class="meta">ğŸ“– èª­äº†æ™‚é–“: 35-40åˆ†</span>
                <span class="meta">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 9å€‹</span>
            </div>
        </div>
    </header>

    <main class="container">

<div class="learning-objectives">
<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™:</p>
<ul>
<li>âœ… ç·šå½¢è¨ˆç”»å•é¡Œã®å®šå¼åŒ–ã¨ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã®ç†è§£</li>
<li>âœ… scipy.optimizeã¨PuLPãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚‹ç·šå½¢è¨ˆç”»ã®å®Ÿè£…</li>
<li>âœ… å‹¾é…é™ä¸‹æ³•ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã€æº–ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã®åŸç†ã¨å®Ÿè£…</li>
<li>âœ… éç·šå½¢æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åæŸæ€§ã¨è¨ˆç®—åŠ¹ç‡ã®è©•ä¾¡</li>
<li>âœ… åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹å•é¡Œã¸ã®æœ€é©åŒ–æ‰‹æ³•ã®é©ç”¨</li>
</ul>
</div>

<hr />

<h2>2.1 ç·šå½¢è¨ˆç”»æ³•ï¼ˆLinear Programmingï¼‰</h2>

<h3>ç·šå½¢è¨ˆç”»å•é¡Œã¨ã¯</h3>

<p><strong>ç·šå½¢è¨ˆç”»å•é¡Œï¼ˆLPï¼‰</strong>ã¯ã€ç·šå½¢ã®ç›®çš„é–¢æ•°ã‚’ç·šå½¢åˆ¶ç´„æ¡ä»¶ã®ã‚‚ã¨ã§æœ€é©åŒ–ã™ã‚‹å•é¡Œã§ã™ã€‚</p>

<p>æ¨™æº–å½¢å¼:</p>

<p>$$
\begin{aligned}
\text{minimize} \quad & \mathbf{c}^T \mathbf{x} \\
\text{subject to} \quad & \mathbf{A} \mathbf{x} \leq \mathbf{b} \\
& \mathbf{x} \geq \mathbf{0}
\end{aligned}
$$</p>

<p>ã“ã“ã§ã€$\mathbf{c}$ã¯ç›®çš„é–¢æ•°ã®ä¿‚æ•°ãƒ™ã‚¯ãƒˆãƒ«ã€$\mathbf{A}$ã¯åˆ¶ç´„è¡Œåˆ—ã€$\mathbf{b}$ã¯åˆ¶ç´„ãƒ™ã‚¯ãƒˆãƒ«ã§ã™ã€‚</p>

<h3>ç·šå½¢è¨ˆç”»æ³•ã®ç‰¹å¾´</h3>

<table>
<thead>
<tr>
<th>ç‰¹å¾´</th>
<th>èª¬æ˜</th>
<th>åˆ©ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‡¸æ€§</td>
<td>å®Ÿè¡Œå¯èƒ½é ˜åŸŸã¯å‡¸å¤šé¢ä½“</td>
<td>å±€æ‰€æœ€é©è§£=å¤§åŸŸçš„æœ€é©è§£</td>
</tr>
<tr>
<td>åŠ¹ç‡æ€§</td>
<td>ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã¯åŠ¹ç‡çš„</td>
<td>å¤§è¦æ¨¡å•é¡Œã§ã‚‚é«˜é€Ÿæ±‚è§£</td>
</tr>
<tr>
<td>æ±ç”¨æ€§</td>
<td>ç”Ÿç”£è¨ˆç”»ã€é…åˆå•é¡Œãªã©å¤šæ§˜ãªå¿œç”¨</td>
<td>åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®é‹è»¢æœ€é©åŒ–ã«é©ç”¨</td>
</tr>
<tr>
<td>åŒå¯¾æ€§</td>
<td>ä¸»å•é¡Œã¨åŒå¯¾å•é¡Œã®é–¢ä¿‚</td>
<td>æ„Ÿåº¦åˆ†æãŒå®¹æ˜“</td>
</tr>
</tbody>
</table>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹1: scipy.optimize.linprogã«ã‚ˆã‚‹ç”Ÿç”£è¨ˆç”»æœ€é©åŒ–</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import linprog
import matplotlib.pyplot as plt

"""
ç”Ÿç”£è¨ˆç”»å•é¡Œ
-----------
è£½å“A, Bã‚’ç”Ÿç”£ã™ã‚‹åŒ–å­¦ãƒ—ãƒ©ãƒ³ãƒˆã€‚åˆ©ç›Šã‚’æœ€å¤§åŒ–ã—ãŸã„ã€‚

æ±ºå®šå¤‰æ•°:
  x1 = è£½å“Aã®ç”Ÿç”£é‡ [kg/day]
  x2 = è£½å“Bã®ç”Ÿç”£é‡ [kg/day]

ç›®çš„é–¢æ•°ï¼ˆåˆ©ç›Šæœ€å¤§åŒ–ï¼‰:
  maximize: 40*x1 + 30*x2  â†’  minimize: -40*x1 - 30*x2

åˆ¶ç´„æ¡ä»¶:
  1. åŸæ–™åˆ¶ç´„: 2*x1 + x2 <= 100  (åŸæ–™åœ¨åº«)
  2. è¨­å‚™æ™‚é–“åˆ¶ç´„: x1 + 2*x2 <= 80  (è¨­å‚™ç¨¼åƒæ™‚é–“)
  3. éè² åˆ¶ç´„: x1, x2 >= 0
"""

# ç›®çš„é–¢æ•°ã®ä¿‚æ•°ï¼ˆæœ€å°åŒ–å•é¡Œãªã®ã§ç¬¦å·åè»¢ï¼‰
c = np.array([-40, -30])

# ä¸ç­‰å¼åˆ¶ç´„ã®ä¿‚æ•°è¡Œåˆ— A*x <= b
A_ub = np.array([
    [2, 1],   # åŸæ–™åˆ¶ç´„
    [1, 2]    # è¨­å‚™æ™‚é–“åˆ¶ç´„
])

b_ub = np.array([100, 80])

# å¤‰æ•°ã®å¢ƒç•Œï¼ˆéè² åˆ¶ç´„ï¼‰
x_bounds = [(0, None), (0, None)]

# ç·šå½¢è¨ˆç”»å•é¡Œã®æ±‚è§£
result = linprog(c, A_ub=A_ub, b_ub=b_ub, bounds=x_bounds, method='highs')

# çµæœã®è¡¨ç¤º
print("=" * 60)
print("ç”Ÿç”£è¨ˆç”»æœ€é©åŒ–å•é¡Œã®çµæœ")
print("=" * 60)
print(f"æœ€é©åŒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {result.message}")
print(f"æœ€é©è§£:")
print(f"  è£½å“Aç”Ÿç”£é‡ (x1): {result.x[0]:.2f} kg/day")
print(f"  è£½å“Bç”Ÿç”£é‡ (x2): {result.x[1]:.2f} kg/day")
print(f"æœ€å¤§åˆ©ç›Š: {-result.fun:.2f} $/day")  # ç¬¦å·ã‚’æˆ»ã™
print(f"åå¾©å›æ•°: {result.nit}")

# å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®å¯è¦–åŒ–
x1 = np.linspace(0, 60, 400)

# åˆ¶ç´„æ¡ä»¶ã®å¢ƒç•Œç·š
x2_constraint1 = 100 - 2*x1  # åŸæ–™åˆ¶ç´„
x2_constraint2 = (80 - x1) / 2  # è¨­å‚™æ™‚é–“åˆ¶ç´„

plt.figure(figsize=(10, 8))

# åˆ¶ç´„æ¡ä»¶ã®æç”»
plt.plot(x1, x2_constraint1, 'r-', linewidth=2, label='åŸæ–™åˆ¶ç´„: 2xâ‚ + xâ‚‚ = 100')
plt.plot(x1, x2_constraint2, 'b-', linewidth=2, label='è¨­å‚™æ™‚é–“åˆ¶ç´„: xâ‚ + 2xâ‚‚ = 80')

# å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®å¡—ã‚Šã¤ã¶ã—
x2_feasible = np.minimum(x2_constraint1, x2_constraint2)
x2_feasible = np.maximum(x2_feasible, 0)
plt.fill_between(x1, 0, x2_feasible, where=(x2_feasible >= 0),
                 alpha=0.3, color='green', label='å®Ÿè¡Œå¯èƒ½é ˜åŸŸ')

# ç›®çš„é–¢æ•°ã®ç­‰é«˜ç·šï¼ˆåˆ©ç›Šç·šï¼‰
for profit in [800, 1200, 1600, 2000]:
    x2_profit = (profit - 40*x1) / 30
    plt.plot(x1, x2_profit, '--', alpha=0.4, color='gray')

# æœ€é©è§£ã®ãƒ—ãƒ­ãƒƒãƒˆ
plt.scatter([result.x[0]], [result.x[1]], color='red', s=300, zorder=5,
            marker='*', edgecolors='black', linewidth=2,
            label=f'æœ€é©è§£ ({result.x[0]:.1f}, {result.x[1]:.1f})')

plt.xlabel('è£½å“Aç”Ÿç”£é‡ xâ‚ [kg/day]', fontsize=12)
plt.ylabel('è£½å“Bç”Ÿç”£é‡ xâ‚‚ [kg/day]', fontsize=12)
plt.title('ç”Ÿç”£è¨ˆç”»æœ€é©åŒ–å•é¡Œã®å¹¾ä½•å­¦çš„è§£é‡ˆ', fontsize=14, fontweight='bold')
plt.xlim(0, 60)
plt.ylim(0, 60)
plt.legend(fontsize=10)
plt.grid(alpha=0.3)
plt.tight_layout()
plt.show()

# åˆ¶ç´„æ¡ä»¶ã®ä½™è£•åº¦ï¼ˆã‚¹ãƒ©ãƒƒã‚¯å¤‰æ•°ï¼‰
slack = b_ub - A_ub @ result.x
print(f"\nåˆ¶ç´„æ¡ä»¶ã®ä½™è£•åº¦:")
print(f"  åŸæ–™åˆ¶ç´„ã®ä½™è£•: {slack[0]:.2f} kg")
print(f"  è¨­å‚™æ™‚é–“åˆ¶ç´„ã®ä½™è£•: {slack[1]:.2f} æ™‚é–“")
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
ç”Ÿç”£è¨ˆç”»æœ€é©åŒ–å•é¡Œã®çµæœ
============================================================
æœ€é©åŒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: Optimization terminated successfully.
æœ€é©è§£:
  è£½å“Aç”Ÿç”£é‡ (x1): 40.00 kg/day
  è£½å“Bç”Ÿç”£é‡ (x2): 20.00 kg/day
æœ€å¤§åˆ©ç›Š: 2200.00 $/day
åå¾©å›æ•°: 2

åˆ¶ç´„æ¡ä»¶ã®ä½™è£•åº¦:
  åŸæ–™åˆ¶ç´„ã®ä½™è£•: 0.00 kg
  è¨­å‚™æ™‚é–“åˆ¶ç´„ã®ä½™è£•: 0.00 æ™‚é–“
</code></pre>

<p><strong>è§£èª¬:</strong> ç·šå½¢è¨ˆç”»å•é¡Œã§ã¯ã€æœ€é©è§£ã¯å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®é ‚ç‚¹ï¼ˆvertexï¼‰ã«å­˜åœ¨ã—ã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€2ã¤ã®åˆ¶ç´„ãŒåŒæ™‚ã«æœ‰åŠ¹ï¼ˆactiveï¼‰ã¨ãªã‚‹ç‚¹ãŒæœ€é©è§£ã§ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹2: PuLPãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚‹åŒ–å­¦é…åˆå•é¡Œ</h3>

<pre><code class="language-python">from pulp import LpProblem, LpVariable, LpMaximize, lpSum, LpStatus, value
import pandas as pd

"""
åŒ–å­¦åŸæ–™é…åˆæœ€é©åŒ–å•é¡Œ
---------------------
3ç¨®é¡ã®åŸæ–™ï¼ˆA, B, Cï¼‰ã‚’é…åˆã—ã¦è£½å“ã‚’è£½é€ ã€‚
è£½å“ä»•æ§˜ã‚’æº€ãŸã—ã¤ã¤ã€åŸæ–™ã‚³ã‚¹ãƒˆã‚’æœ€å°åŒ–ã€‚

åˆ¶ç´„æ¡ä»¶:
  - ç¡«é»„å«æœ‰é‡ >= 2.0%
  - ç²˜åº¦ <= 100 cP
  - ç·é…åˆé‡ = 1000 kg
"""

# åŸæ–™ãƒ‡ãƒ¼ã‚¿
raw_materials = {
    'A': {'cost': 50, 'sulfur': 3.0, 'viscosity': 80},   # $/kg, %, cP
    'B': {'cost': 40, 'sulfur': 2.0, 'viscosity': 120},
    'C': {'cost': 60, 'sulfur': 1.5, 'viscosity': 60}
}

# å•é¡Œã®å®šç¾©ï¼ˆã‚³ã‚¹ãƒˆæœ€å°åŒ–ï¼‰
prob = LpProblem("Chemical_Blending", LpMaximize)  # å¾Œã§ç¬¦å·åè»¢

# æ±ºå®šå¤‰æ•°ã®å®šç¾©ï¼ˆå„åŸæ–™ã®ä½¿ç”¨é‡ kgï¼‰
x = {}
for material in raw_materials.keys():
    x[material] = LpVariable(f"x_{material}", lowBound=0)

# ç›®çš„é–¢æ•°ï¼ˆã‚³ã‚¹ãƒˆæœ€å°åŒ– â†’ è² ã®åˆ©ç›Šæœ€å¤§åŒ–ï¼‰
prob += -lpSum([x[material] * raw_materials[material]['cost']
                for material in raw_materials.keys()]), "Total_Cost"

# åˆ¶ç´„æ¡ä»¶1: ç·é…åˆé‡ = 1000 kg
prob += lpSum([x[material] for material in raw_materials.keys()]) == 1000, "Total_Amount"

# åˆ¶ç´„æ¡ä»¶2: ç¡«é»„å«æœ‰é‡ >= 2.0%
prob += lpSum([x[material] * raw_materials[material]['sulfur']
               for material in raw_materials.keys()]) >= 2.0 * 1000, "Sulfur_Content"

# åˆ¶ç´„æ¡ä»¶3: ç²˜åº¦ <= 100 cPï¼ˆåŠ é‡å¹³å‡ï¼‰
prob += lpSum([x[material] * raw_materials[material]['viscosity']
               for material in raw_materials.keys()]) <= 100 * 1000, "Viscosity_Limit"

# æ±‚è§£
prob.solve()

# çµæœã®è¡¨ç¤º
print("=" * 70)
print("åŒ–å­¦åŸæ–™é…åˆæœ€é©åŒ–ã®çµæœ")
print("=" * 70)
print(f"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {LpStatus[prob.status]}")
print(f"\næœ€é©é…åˆ:")

results = []
for material in raw_materials.keys():
    amount = value(x[material])
    percentage = (amount / 1000) * 100
    cost = amount * raw_materials[material]['cost']
    print(f"  åŸæ–™{material}: {amount:.2f} kg ({percentage:.1f}%)  ã‚³ã‚¹ãƒˆ: ${cost:.2f}")
    results.append({
        'åŸæ–™': material,
        'ä½¿ç”¨é‡ [kg]': amount,
        'é…åˆæ¯” [%]': percentage,
        'ã‚³ã‚¹ãƒˆ [$]': cost
    })

total_cost = -value(prob.objective)
print(f"\nç·ã‚³ã‚¹ãƒˆ: ${total_cost:.2f}")

# è£½å“ä»•æ§˜ã®ç¢ºèª
sulfur_content = sum(value(x[material]) * raw_materials[material]['sulfur']
                     for material in raw_materials.keys()) / 1000
viscosity = sum(value(x[material]) * raw_materials[material]['viscosity']
                for material in raw_materials.keys()) / 1000

print(f"\nè£½å“ä»•æ§˜:")
print(f"  ç¡«é»„å«æœ‰é‡: {sulfur_content:.2f}% (è¦æ ¼: >= 2.0%)")
print(f"  ç²˜åº¦: {viscosity:.2f} cP (è¦æ ¼: <= 100 cP)")

# çµæœã‚’DataFrameã§æ•´ç†
df_results = pd.DataFrame(results)
print(f"\né…åˆè©³ç´°:")
print(df_results.to_string(index=False))

# å¯è¦–åŒ–
import matplotlib.pyplot as plt

fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 5))

# é…åˆæ¯”ã®å††ã‚°ãƒ©ãƒ•
materials = [r['åŸæ–™'] for r in results]
amounts = [r['ä½¿ç”¨é‡ [kg]'] for r in results]
colors = ['#11998e', '#38ef7d', '#66d9ef']

ax1.pie(amounts, labels=materials, autopct='%1.1f%%', startangle=90, colors=colors)
ax1.set_title('æœ€é©é…åˆæ¯”', fontsize=13, fontweight='bold')

# ã‚³ã‚¹ãƒˆå†…è¨³ã®æ£’ã‚°ãƒ©ãƒ•
costs = [r['ã‚³ã‚¹ãƒˆ [$]'] for r in results]
ax2.bar(materials, costs, color=colors, edgecolor='black', linewidth=1.5)
ax2.set_xlabel('åŸæ–™', fontsize=11)
ax2.set_ylabel('ã‚³ã‚¹ãƒˆ [$]', fontsize=11)
ax2.set_title('åŸæ–™åˆ¥ã‚³ã‚¹ãƒˆå†…è¨³', fontsize=13, fontweight='bold')
ax2.grid(axis='y', alpha=0.3)

for i, (material, cost) in enumerate(zip(materials, costs)):
    ax2.text(i, cost + 500, f'${cost:.0f}', ha='center', fontsize=10, fontweight='bold')

plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>======================================================================
åŒ–å­¦åŸæ–™é…åˆæœ€é©åŒ–ã®çµæœ
======================================================================
ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: Optimal

æœ€é©é…åˆ:
  åŸæ–™A: 500.00 kg (50.0%)  ã‚³ã‚¹ãƒˆ: $25000.00
  åŸæ–™B: 500.00 kg (50.0%)  ã‚³ã‚¹ãƒˆ: $20000.00
  åŸæ–™C: 0.00 kg (0.0%)  ã‚³ã‚¹ãƒˆ: $0.00

ç·ã‚³ã‚¹ãƒˆ: $45000.00

è£½å“ä»•æ§˜:
  ç¡«é»„å«æœ‰é‡: 2.50% (è¦æ ¼: >= 2.0%)
  ç²˜åº¦: 100.00 cP (è¦æ ¼: <= 100 cP)

é…åˆè©³ç´°:
  åŸæ–™  ä½¿ç”¨é‡ [kg]  é…åˆæ¯” [%]  ã‚³ã‚¹ãƒˆ [$]
     A       500.0        50.0    25000.0
     B       500.0        50.0    20000.0
     C         0.0         0.0        0.0
</code></pre>

<p><strong>è§£èª¬:</strong> PuLPãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€ç·šå½¢è¨ˆç”»å•é¡Œã‚’ã‚ˆã‚Šç›´æ„Ÿçš„ã«è¨˜è¿°ã§ãã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€è£½å“ä»•æ§˜ï¼ˆç¡«é»„å«æœ‰é‡ã€ç²˜åº¦ï¼‰ã‚’æº€ãŸã—ã¤ã¤ã€åŸæ–™ã‚³ã‚¹ãƒˆã‚’æœ€å°åŒ–ã™ã‚‹é…åˆæ¯”ã‚’æ±‚ã‚ã¦ã„ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹3: ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã®å¯è¦–åŒ–</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import linprog

"""
ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã®æ¢ç´¢éç¨‹ã®å¯è¦–åŒ–
--------------------------------
æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒå®Ÿè¡Œå¯èƒ½é ˜åŸŸã®é ‚ç‚¹ã‚’æ¢ç´¢ã™ã‚‹æ§˜å­ã‚’å¯è¦–åŒ–
"""

# ç·šå½¢è¨ˆç”»å•é¡Œã®å®šç¾©
c = np.array([-3, -4])  # ç›®çš„é–¢æ•°: maximize 3x1 + 4x2

A_ub = np.array([
    [2, 1],   # åˆ¶ç´„1: 2x1 + x2 <= 6
    [1, 2]    # åˆ¶ç´„2: x1 + 2x2 <= 8
])

b_ub = np.array([6, 8])

# å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®é ‚ç‚¹ã‚’è¨ˆç®—
def calculate_vertices():
    """å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®é ‚ç‚¹ã‚’è¨ˆç®—"""
    vertices = [
        (0, 0),  # åŸç‚¹
        (3, 0),  # x1è»¸ä¸Šï¼ˆåˆ¶ç´„1ã®å¢ƒç•Œï¼‰
        (0, 4),  # x2è»¸ä¸Šï¼ˆåˆ¶ç´„2ã®å¢ƒç•Œï¼‰
    ]

    # 2ã¤ã®åˆ¶ç´„ã®äº¤ç‚¹
    # 2x1 + x2 = 6 ã¨ x1 + 2x2 = 8 ã®é€£ç«‹æ–¹ç¨‹å¼
    A_intersection = np.array([[2, 1], [1, 2]])
    b_intersection = np.array([6, 8])
    intersection = np.linalg.solve(A_intersection, b_intersection)
    vertices.append(tuple(intersection))

    return vertices

vertices = calculate_vertices()

# å„é ‚ç‚¹ã§ã®ç›®çš„é–¢æ•°å€¤ã‚’è¨ˆç®—
def objective_value(x1, x2):
    return 3*x1 + 4*x2

vertex_values = [(v[0], v[1], objective_value(v[0], v[1])) for v in vertices]
vertex_values.sort(key=lambda x: x[2])  # ç›®çš„é–¢æ•°å€¤ã§ã‚½ãƒ¼ãƒˆ

# å¯è¦–åŒ–
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(16, 6))

# å·¦å›³: å®Ÿè¡Œå¯èƒ½é ˜åŸŸã¨é ‚ç‚¹ã®æ¢ç´¢
x1 = np.linspace(0, 5, 400)
x2_constraint1 = 6 - 2*x1
x2_constraint2 = (8 - x1) / 2

x2_feasible = np.minimum(x2_constraint1, x2_constraint2)
x2_feasible = np.maximum(x2_feasible, 0)

ax1.fill_between(x1, 0, x2_feasible, where=(x2_feasible >= 0),
                 alpha=0.3, color='lightgreen', label='å®Ÿè¡Œå¯èƒ½é ˜åŸŸ')

ax1.plot(x1, x2_constraint1, 'r-', linewidth=2, label='2xâ‚ + xâ‚‚ = 6')
ax1.plot(x1, x2_constraint2, 'b-', linewidth=2, label='xâ‚ + 2xâ‚‚ = 8')

# ç›®çš„é–¢æ•°ã®ç­‰é«˜ç·š
for val in [0, 4, 8, 12, 16]:
    x2_obj = (val - 3*x1) / 4
    ax1.plot(x1, x2_obj, '--', alpha=0.3, color='gray', linewidth=1)

# é ‚ç‚¹ã®ãƒ—ãƒ­ãƒƒãƒˆï¼ˆæ¢ç´¢é †åºï¼‰
colors = ['yellow', 'orange', 'red', 'darkred']
for i, (x1_v, x2_v, obj_val) in enumerate(vertex_values):
    if i < len(vertex_values) - 1:
        ax1.scatter([x1_v], [x2_v], s=200, color=colors[i],
                   edgecolors='black', linewidth=2, zorder=5,
                   label=f'é ‚ç‚¹{i+1}: f={obj_val:.1f}')
    else:
        ax1.scatter([x1_v], [x2_v], s=400, color='red', marker='*',
                   edgecolors='black', linewidth=3, zorder=6,
                   label=f'æœ€é©è§£: f={obj_val:.1f}')

# æ¢ç´¢çµŒè·¯ã®æç”»ï¼ˆã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã®æ¦‚å¿µçš„çµŒè·¯ï¼‰
path_x = [vertex_values[i][0] for i in range(len(vertex_values))]
path_y = [vertex_values[i][1] for i in range(len(vertex_values))]
ax1.plot(path_x, path_y, 'k--', linewidth=2, alpha=0.5, label='æ¢ç´¢çµŒè·¯')

for i in range(len(path_x) - 1):
    ax1.annotate('', xy=(path_x[i+1], path_y[i+1]), xytext=(path_x[i], path_y[i]),
                arrowprops=dict(arrowstyle='->', lw=2, color='black', alpha=0.6))

ax1.set_xlabel('xâ‚', fontsize=12)
ax1.set_ylabel('xâ‚‚', fontsize=12)
ax1.set_title('ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã®æ¢ç´¢éç¨‹', fontsize=14, fontweight='bold')
ax1.set_xlim(-0.5, 5)
ax1.set_ylim(-0.5, 5)
ax1.legend(fontsize=9, loc='upper right')
ax1.grid(alpha=0.3)

# å³å›³: åå¾©ã”ã¨ã®ç›®çš„é–¢æ•°å€¤ã®æ”¹å–„
iterations = list(range(1, len(vertex_values) + 1))
obj_values = [v[2] for v in vertex_values]

ax2.plot(iterations, obj_values, 'o-', linewidth=3, markersize=10,
         color='#11998e', markerfacecolor='#38ef7d', markeredgecolor='black',
         markeredgewidth=2)
ax2.set_xlabel('åå¾©å›æ•°', fontsize=12)
ax2.set_ylabel('ç›®çš„é–¢æ•°å€¤', fontsize=12)
ax2.set_title('ç›®çš„é–¢æ•°å€¤ã®æ”¹å–„éç¨‹', fontsize=14, fontweight='bold')
ax2.grid(alpha=0.3)

for i, (iter_num, val) in enumerate(zip(iterations, obj_values)):
    ax2.text(iter_num, val + 0.5, f'{val:.1f}', ha='center', fontsize=10, fontweight='bold')

plt.tight_layout()
plt.show()

print("=" * 60)
print("ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã®æ¢ç´¢éç¨‹")
print("=" * 60)
for i, (x1_v, x2_v, obj_val) in enumerate(vertex_values):
    print(f"åå¾© {i+1}: é ‚ç‚¹ ({x1_v:.2f}, {x2_v:.2f})  ç›®çš„é–¢æ•°å€¤: {obj_val:.2f}")
print("=" * 60)
print(f"æœ€é©è§£: ({vertex_values[-1][0]:.2f}, {vertex_values[-1][1]:.2f})")
print(f"æœ€å¤§å€¤: {vertex_values[-1][2]:.2f}")
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã®æ¢ç´¢éç¨‹
============================================================
åå¾© 1: é ‚ç‚¹ (0.00, 0.00)  ç›®çš„é–¢æ•°å€¤: 0.00
åå¾© 2: é ‚ç‚¹ (3.00, 0.00)  ç›®çš„é–¢æ•°å€¤: 9.00
åå¾© 3: é ‚ç‚¹ (0.00, 4.00)  ç›®çš„é–¢æ•°å€¤: 16.00
åå¾© 4: é ‚ç‚¹ (1.33, 3.33)  ç›®çš„é–¢æ•°å€¤: 17.33
============================================================
æœ€é©è§£: (1.33, 3.33)
æœ€å¤§å€¤: 17.33
</code></pre>

<p><strong>è§£èª¬:</strong> ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã¯ã€å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®é ‚ç‚¹ã‚’åŠ¹ç‡çš„ã«æ¢ç´¢ã—ã€ç›®çš„é–¢æ•°å€¤ã‚’å˜èª¿ã«æ”¹å–„ã—ã¦ã„ãã¾ã™ã€‚å„åå¾©ã§éš£æ¥ã™ã‚‹é ‚ç‚¹ã«ç§»å‹•ã—ã€æœ€é©è§£ã«åˆ°é”ã—ã¾ã™ã€‚</p>

<hr />

<h2>2.2 éç·šå½¢è¨ˆç”»æ³•ï¼ˆNonlinear Programmingï¼‰</h2>

<h3>éç·šå½¢æœ€é©åŒ–å•é¡Œ</h3>

<p>ç›®çš„é–¢æ•°ã¾ãŸã¯åˆ¶ç´„æ¡ä»¶ãŒéç·šå½¢ã§ã‚ã‚‹æœ€é©åŒ–å•é¡Œã§ã™:</p>

<p>$$
\begin{aligned}
\text{minimize} \quad & f(\mathbf{x}) \\
\text{subject to} \quad & g_i(\mathbf{x}) \leq 0, \quad i = 1, \ldots, m \\
& h_j(\mathbf{x}) = 0, \quad j = 1, \ldots, p
\end{aligned}
$$</p>

<h3>ä¸»è¦ãªæœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </h3>

<div class="mermaid">
graph LR
    A[éç·šå½¢æœ€é©åŒ–] --> B[åˆ¶ç´„ãªã—]
    A --> C[åˆ¶ç´„ä»˜ã]
    B --> D[å‹¾é…é™ä¸‹æ³•]
    B --> E[ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•]
    B --> F[æº–ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•<br/>BFGS, L-BFGS]
    C --> G[ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•]
    C --> H[SQP]
    C --> I[å†…ç‚¹æ³•]

    style A fill:#11998e,stroke:#0d7a6f,color:#fff
    style B fill:#38ef7d,stroke:#2ecc71
    style C fill:#38ef7d,stroke:#2ecc71
</div>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹4: åˆ¶ç´„ãªã—éç·šå½¢æœ€é©åŒ–ï¼ˆscipy.optimize.minimizeï¼‰</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import minimize
import matplotlib.pyplot as plt

"""
åˆ¶ç´„ãªã—éç·šå½¢æœ€é©åŒ–å•é¡Œ
-----------------------
Rosenbrocké–¢æ•°ã®æœ€å°åŒ–

f(x, y) = (1-x)^2 + 100(y-x^2)^2

æœ€å°å€¤: f(1, 1) = 0
"""

# ç›®çš„é–¢æ•°ã®å®šç¾©
def rosenbrock(x):
    """Rosenbrocké–¢æ•°"""
    return (1 - x[0])**2 + 100 * (x[1] - x[0]**2)**2

# å‹¾é…ï¼ˆè§£æçš„ã«è¨ˆç®—ï¼‰
def rosenbrock_grad(x):
    """Rosenbrocké–¢æ•°ã®å‹¾é…"""
    dfdx = -2*(1 - x[0]) - 400*x[0]*(x[1] - x[0]**2)
    dfdy = 200*(x[1] - x[0]**2)
    return np.array([dfdx, dfdy])

# ãƒ˜ãƒƒã‚»è¡Œåˆ—ï¼ˆ2æ¬¡å¾®åˆ†ï¼‰
def rosenbrock_hess(x):
    """Rosenbrocké–¢æ•°ã®ãƒ˜ãƒƒã‚»è¡Œåˆ—"""
    d2fdx2 = 2 - 400*x[1] + 1200*x[0]**2
    d2fdxdy = -400*x[0]
    d2fdy2 = 200
    return np.array([[d2fdx2, d2fdxdy],
                     [d2fdxdy, d2fdy2]])

# åˆæœŸå€¤
x0 = np.array([-1.0, -1.0])

# è¤‡æ•°ã®æœ€é©åŒ–æ‰‹æ³•ã§æ±‚è§£
methods = ['Nelder-Mead', 'BFGS', 'Newton-CG', 'L-BFGS-B', 'TNC']
results = {}

print("=" * 80)
print("åˆ¶ç´„ãªã—éç·šå½¢æœ€é©åŒ–: Rosenbrocké–¢æ•°ã®æœ€å°åŒ–")
print("=" * 80)
print(f"åˆæœŸå€¤: x0 = {x0}")
print(f"ç›®çš„é–¢æ•°å€¤ f(x0) = {rosenbrock(x0):.4f}")
print("\n" + "=" * 80)
print(f"{'æ‰‹æ³•':<15} {'æœ€é©è§£ (x, y)':<25} {'ç›®çš„é–¢æ•°å€¤':<15} {'åå¾©å›æ•°':<10}")
print("=" * 80)

for method in methods:
    if method in ['Newton-CG']:
        result = minimize(rosenbrock, x0, method=method, jac=rosenbrock_grad,
                         hess=rosenbrock_hess)
    elif method in ['BFGS', 'L-BFGS-B']:
        result = minimize(rosenbrock, x0, method=method, jac=rosenbrock_grad)
    else:
        result = minimize(rosenbrock, x0, method=method)

    results[method] = result
    print(f"{method:<15} ({result.x[0]:7.4f}, {result.x[1]:7.4f})   "
          f"{result.fun:12.6e}   {result.nit:8d}")

print("=" * 80)

# Rosenbrocké–¢æ•°ã®å¯è¦–åŒ–
x = np.linspace(-2, 2, 400)
y = np.linspace(-1, 3, 400)
X, Y = np.meshgrid(x, y)
Z = (1 - X)**2 + 100 * (Y - X**2)**2

# å¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«ã§å¯è¦–åŒ–ï¼ˆå€¤ã®ç¯„å›²ãŒåºƒã„ãŸã‚ï¼‰
Z_log = np.log10(Z + 1)

fig = plt.figure(figsize=(16, 6))

# ç­‰é«˜ç·šãƒ—ãƒ­ãƒƒãƒˆ
ax1 = fig.add_subplot(131)
contour = ax1.contour(X, Y, Z_log, levels=20, cmap='viridis')
ax1.contourf(X, Y, Z_log, levels=20, cmap='viridis', alpha=0.4)
plt.colorbar(contour, ax=ax1, label='logâ‚â‚€(f(x,y) + 1)')
ax1.scatter([1], [1], color='red', s=300, marker='*',
           edgecolors='black', linewidth=2, label='çœŸã®æœ€é©è§£ (1, 1)', zorder=5)
ax1.scatter([x0[0]], [x0[1]], color='yellow', s=150, marker='o',
           edgecolors='black', linewidth=2, label='åˆæœŸå€¤', zorder=5)
ax1.set_xlabel('x', fontsize=11)
ax1.set_ylabel('y', fontsize=11)
ax1.set_title('Rosenbrocké–¢æ•°ã®ç­‰é«˜ç·š', fontsize=13, fontweight='bold')
ax1.legend(fontsize=9)
ax1.grid(alpha=0.3)

# 3Dè¡¨é¢ãƒ—ãƒ­ãƒƒãƒˆ
ax2 = fig.add_subplot(132, projection='3d')
surf = ax2.plot_surface(X, Y, Z_log, cmap='viridis', alpha=0.7,
                        edgecolor='none', antialiased=True)
ax2.scatter([1], [1], [0], color='red', s=200, marker='*',
           edgecolors='black', linewidth=2)
ax2.set_xlabel('x', fontsize=10)
ax2.set_ylabel('y', fontsize=10)
ax2.set_zlabel('logâ‚â‚€(f(x,y) + 1)', fontsize=10)
ax2.set_title('Rosenbrocké–¢æ•°ã®3Dè¡¨é¢', fontsize=13, fontweight='bold')

# æ‰‹æ³•ã”ã¨ã®åæŸæ€§æ¯”è¼ƒ
ax3 = fig.add_subplot(133)
method_labels = list(results.keys())
nit_values = [results[m].nit for m in method_labels]
fun_values = [results[m].fun for m in method_labels]

x_pos = np.arange(len(method_labels))
bars = ax3.bar(x_pos, nit_values, color='#11998e', edgecolor='black', linewidth=1.5)

# ç›®çš„é–¢æ•°å€¤ã‚’å„ãƒãƒ¼ã®ä¸Šã«è¡¨ç¤º
for i, (bar, fun_val) in enumerate(zip(bars, fun_values)):
    height = bar.get_height()
    ax3.text(bar.get_x() + bar.get_width()/2., height + 1,
            f'{fun_val:.2e}', ha='center', va='bottom', fontsize=8, rotation=0)

ax3.set_xticks(x_pos)
ax3.set_xticklabels(method_labels, rotation=45, ha='right')
ax3.set_ylabel('åå¾©å›æ•°', fontsize=11)
ax3.set_title('æœ€é©åŒ–æ‰‹æ³•ã®åå¾©å›æ•°æ¯”è¼ƒ', fontsize=13, fontweight='bold')
ax3.grid(axis='y', alpha=0.3)

plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>================================================================================
åˆ¶ç´„ãªã—éç·šå½¢æœ€é©åŒ–: Rosenbrocké–¢æ•°ã®æœ€å°åŒ–
================================================================================
åˆæœŸå€¤: x0 = [-1. -1.]
ç›®çš„é–¢æ•°å€¤ f(x0) = 404.0000

================================================================================
æ‰‹æ³•             æœ€é©è§£ (x, y)              ç›®çš„é–¢æ•°å€¤       åå¾©å›æ•°
================================================================================
Nelder-Mead     ( 1.0000,  1.0000)      7.888892e-10          79
BFGS            ( 1.0000,  1.0000)      1.432465e-11          33
Newton-CG       ( 1.0000,  1.0000)      6.689048e-18          23
L-BFGS-B        ( 1.0000,  1.0000)      1.432465e-11          24
TNC             ( 1.0000,  1.0000)      1.510571e-17          26
================================================================================
</code></pre>

<p><strong>è§£èª¬:</strong> scipy.optimize.minimizeã¯ã€è¤‡æ•°ã®æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’çµ±ä¸€çš„ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§åˆ©ç”¨ã§ãã¾ã™ã€‚å‹¾é…æƒ…å ±ã‚„ãƒ˜ãƒƒã‚»è¡Œåˆ—ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã€åæŸé€Ÿåº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹5: å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£…ã¨ã‚¹ãƒ†ãƒƒãƒ—ã‚µã‚¤ã‚ºã®å½±éŸ¿</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

"""
å‹¾é…é™ä¸‹æ³•ã®ã‚¹ã‚¯ãƒ©ãƒƒãƒå®Ÿè£…
-------------------------
ã‚¹ãƒ†ãƒƒãƒ—ã‚µã‚¤ã‚ºï¼ˆå­¦ç¿’ç‡ï¼‰ã®å½±éŸ¿ã‚’å¯è¦–åŒ–
"""

# ç›®çš„é–¢æ•°: f(x, y) = x^2 + 4*y^2
def objective(x):
    return x[0]**2 + 4*x[1]**2

# å‹¾é…
def gradient(x):
    return np.array([2*x[0], 8*x[1]])

# å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£…
def gradient_descent(x0, learning_rate, max_iter=100, tol=1e-6):
    """
    å‹¾é…é™ä¸‹æ³•

    Parameters:
    -----------
    x0 : array, åˆæœŸå€¤
    learning_rate : float, ã‚¹ãƒ†ãƒƒãƒ—ã‚µã‚¤ã‚ºï¼ˆå­¦ç¿’ç‡ï¼‰
    max_iter : int, æœ€å¤§åå¾©å›æ•°
    tol : float, åæŸåˆ¤å®šã®é–¾å€¤

    Returns:
    --------
    trajectory : list, æœ€é©åŒ–ã®è»Œè·¡
    """
    x = x0.copy()
    trajectory = [x.copy()]

    for i in range(max_iter):
        grad = gradient(x)

        # å‹¾é…é™ä¸‹ã®æ›´æ–°å¼
        x_new = x - learning_rate * grad

        trajectory.append(x_new.copy())

        # åæŸåˆ¤å®š
        if np.linalg.norm(x_new - x) < tol:
            print(f"  åæŸ: {i+1} åå¾©")
            break

        x = x_new

    return trajectory

# ç•°ãªã‚‹å­¦ç¿’ç‡ã§ãƒ†ã‚¹ãƒˆ
learning_rates = [0.05, 0.1, 0.3, 0.5]
x0 = np.array([2.0, 1.5])

trajectories = {}

print("=" * 70)
print("å‹¾é…é™ä¸‹æ³•: å­¦ç¿’ç‡ã®å½±éŸ¿")
print("=" * 70)
print(f"åˆæœŸå€¤: x0 = {x0}")
print(f"ç›®çš„é–¢æ•°: f(x, y) = xÂ² + 4yÂ²")
print(f"æœ€é©è§£: (0, 0), æœ€å°å€¤: 0")
print("=" * 70)

for lr in learning_rates:
    print(f"\nå­¦ç¿’ç‡ Î± = {lr}:")
    traj = gradient_descent(x0, lr, max_iter=50)
    trajectories[lr] = traj
    final_x = traj[-1]
    final_f = objective(final_x)
    print(f"  æœ€çµ‚è§£: ({final_x[0]:.6f}, {final_x[1]:.6f})")
    print(f"  ç›®çš„é–¢æ•°å€¤: {final_f:.6e}")
    print(f"  åå¾©å›æ•°: {len(traj)-1}")

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 2, figsize=(14, 12))
axes = axes.flatten()

# ç­‰é«˜ç·šã®æº–å‚™
x = np.linspace(-2.5, 2.5, 200)
y = np.linspace(-2, 2, 200)
X, Y = np.meshgrid(x, y)
Z = X**2 + 4*Y**2

for idx, (lr, traj) in enumerate(trajectories.items()):
    ax = axes[idx]

    # ç­‰é«˜ç·š
    contour = ax.contour(X, Y, Z, levels=20, cmap='viridis', alpha=0.5)
    ax.contourf(X, Y, Z, levels=20, cmap='viridis', alpha=0.2)

    # æœ€é©åŒ–ã®è»Œè·¡
    traj_array = np.array(traj)
    ax.plot(traj_array[:, 0], traj_array[:, 1], 'ro-', linewidth=2,
           markersize=6, label='è»Œè·¡', markerfacecolor='red',
           markeredgecolor='black', markeredgewidth=1)

    # åˆæœŸå€¤ã¨æœ€é©è§£
    ax.scatter([x0[0]], [x0[1]], color='yellow', s=200, marker='o',
              edgecolors='black', linewidth=2, label='åˆæœŸå€¤', zorder=5)
    ax.scatter([0], [0], color='lime', s=300, marker='*',
              edgecolors='black', linewidth=2, label='æœ€é©è§£', zorder=5)

    # çŸ¢å°ã§æ–¹å‘ã‚’ç¤ºã™
    for i in range(min(5, len(traj)-1)):
        ax.annotate('', xy=(traj_array[i+1]), xytext=(traj_array[i]),
                   arrowprops=dict(arrowstyle='->', lw=2, color='red', alpha=0.6))

    ax.set_xlabel('x', fontsize=11)
    ax.set_ylabel('y', fontsize=11)
    ax.set_title(f'å­¦ç¿’ç‡ Î± = {lr} (åå¾©å›æ•°: {len(traj)-1})',
                fontsize=12, fontweight='bold')
    ax.legend(fontsize=9)
    ax.grid(alpha=0.3)
    ax.set_xlim(-2.5, 2.5)
    ax.set_ylim(-2, 2)

plt.tight_layout()
plt.show()

# ç›®çš„é–¢æ•°å€¤ã®åæŸæ›²ç·š
plt.figure(figsize=(12, 6))

for lr, traj in trajectories.items():
    traj_array = np.array(traj)
    obj_values = [objective(x) for x in traj_array]
    iterations = range(len(obj_values))
    plt.semilogy(iterations, obj_values, 'o-', linewidth=2, markersize=6,
                label=f'Î± = {lr}')

plt.xlabel('åå¾©å›æ•°', fontsize=12)
plt.ylabel('ç›®çš„é–¢æ•°å€¤ (å¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«)', fontsize=12)
plt.title('å­¦ç¿’ç‡ã”ã¨ã®åæŸæ›²ç·š', fontsize=14, fontweight='bold')
plt.legend(fontsize=11)
plt.grid(alpha=0.3, which='both')
plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>======================================================================
å‹¾é…é™ä¸‹æ³•: å­¦ç¿’ç‡ã®å½±éŸ¿
======================================================================
åˆæœŸå€¤: x0 = [2.  1.5]
ç›®çš„é–¢æ•°: f(x, y) = xÂ² + 4yÂ²
æœ€é©è§£: (0, 0), æœ€å°å€¤: 0
======================================================================

å­¦ç¿’ç‡ Î± = 0.05:
  åæŸ: 43 åå¾©
  æœ€çµ‚è§£: (0.000081, 0.000015)
  ç›®çš„é–¢æ•°å€¤: 6.570282e-09
  åå¾©å›æ•°: 44

å­¦ç¿’ç‡ Î± = 0.1:
  åæŸ: 31 åå¾©
  æœ€çµ‚è§£: (0.000061, 0.000005)
  ç›®çš„é–¢æ•°å€¤: 3.712341e-09
  åå¾©å›æ•°: 32

å­¦ç¿’ç‡ Î± = 0.3:
  åæŸ: 16 åå¾©
  æœ€çµ‚è§£: (0.000002, 0.000000)
  ç›®çš„é–¢æ•°å€¤: 4.400442e-12
  åå¾©å›æ•°: 17

å­¦ç¿’ç‡ Î± = 0.5:
  æœ€çµ‚è§£: (-1.699298, -0.000000)
  ç›®çš„é–¢æ•°å€¤: 2.887613e+00
  åå¾©å›æ•°: 50
</code></pre>

<p><strong>è§£èª¬:</strong> å­¦ç¿’ç‡ãŒå°ã•ã„ã¨åæŸã¯é…ã„ã§ã™ãŒå®‰å®šã—ã¾ã™ã€‚å­¦ç¿’ç‡ãŒå¤§ãã™ãã‚‹ã¨ç™ºæ•£ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚é©åˆ‡ãªå­¦ç¿’ç‡ã®é¸æŠãŒé‡è¦ã§ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹6: ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã®å®Ÿè£…</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

"""
ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã®å®Ÿè£…
-----------------
2æ¬¡ã®å¾®åˆ†æƒ…å ±ï¼ˆãƒ˜ãƒƒã‚»è¡Œåˆ—ï¼‰ã‚’åˆ©ç”¨ã—ãŸé«˜é€Ÿãªæœ€é©åŒ–
"""

# ç›®çš„é–¢æ•°
def objective(x):
    return x[0]**2 + 4*x[1]**2

# å‹¾é…
def gradient(x):
    return np.array([2*x[0], 8*x[1]])

# ãƒ˜ãƒƒã‚»è¡Œåˆ—
def hessian(x):
    return np.array([[2, 0],
                     [0, 8]])

# ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã®å®Ÿè£…
def newton_method(x0, max_iter=20, tol=1e-8):
    """
    ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•

    æ›´æ–°å¼: x_{k+1} = x_k - H^{-1}(x_k) * âˆ‡f(x_k)

    ã“ã“ã§ã€H ã¯ãƒ˜ãƒƒã‚»è¡Œåˆ—
    """
    x = x0.copy()
    trajectory = [x.copy()]

    for i in range(max_iter):
        grad = gradient(x)
        hess = hessian(x)

        # ãƒ˜ãƒƒã‚»è¡Œåˆ—ã®é€†è¡Œåˆ—ã‚’è¨ˆç®—
        hess_inv = np.linalg.inv(hess)

        # ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã®æ›´æ–°å¼
        x_new = x - hess_inv @ grad

        trajectory.append(x_new.copy())

        print(f"  åå¾© {i+1}: x = ({x_new[0]:.6f}, {x_new[1]:.6f}), "
              f"f(x) = {objective(x_new):.6e}")

        # åæŸåˆ¤å®š
        if np.linalg.norm(x_new - x) < tol:
            print(f"  â†’ åæŸ")
            break

        x = x_new

    return trajectory

# å‹¾é…é™ä¸‹æ³•ï¼ˆæ¯”è¼ƒç”¨ï¼‰
def gradient_descent(x0, learning_rate=0.2, max_iter=20, tol=1e-8):
    x = x0.copy()
    trajectory = [x.copy()]

    for i in range(max_iter):
        grad = gradient(x)
        x_new = x - learning_rate * grad
        trajectory.append(x_new.copy())

        if np.linalg.norm(x_new - x) < tol:
            break

        x = x_new

    return trajectory

# åˆæœŸå€¤
x0 = np.array([2.0, 1.5])

print("=" * 80)
print("ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³• vs å‹¾é…é™ä¸‹æ³•ã®æ¯”è¼ƒ")
print("=" * 80)
print(f"åˆæœŸå€¤: x0 = {x0}")
print(f"ç›®çš„é–¢æ•°: f(x, y) = xÂ² + 4yÂ²\n")

print("ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã€‘")
traj_newton = newton_method(x0, max_iter=10)

print(f"\nã€å‹¾é…é™ä¸‹æ³•ï¼ˆå­¦ç¿’ç‡=0.2ï¼‰ã€‘")
traj_gd = gradient_descent(x0, learning_rate=0.2, max_iter=10)
for i, x in enumerate(traj_gd[1:], 1):
    print(f"  åå¾© {i}: x = ({x[0]:.6f}, {x[1]:.6f}), f(x) = {objective(x):.6e}")

# å¯è¦–åŒ–
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(16, 6))

# ç­‰é«˜ç·šã®æº–å‚™
x = np.linspace(-2.5, 2.5, 200)
y = np.linspace(-2, 2, 200)
X, Y = np.meshgrid(x, y)
Z = X**2 + 4*Y**2

# å·¦å›³: è»Œè·¡ã®æ¯”è¼ƒ
contour = ax1.contour(X, Y, Z, levels=25, cmap='viridis', alpha=0.4)
ax1.contourf(X, Y, Z, levels=25, cmap='viridis', alpha=0.2)

# ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã®è»Œè·¡
traj_newton_array = np.array(traj_newton)
ax1.plot(traj_newton_array[:, 0], traj_newton_array[:, 1], 'ro-',
        linewidth=3, markersize=8, label='ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•',
        markerfacecolor='red', markeredgecolor='black', markeredgewidth=1.5)

# å‹¾é…é™ä¸‹æ³•ã®è»Œè·¡
traj_gd_array = np.array(traj_gd)
ax1.plot(traj_gd_array[:, 0], traj_gd_array[:, 1], 'bs-',
        linewidth=2, markersize=7, label='å‹¾é…é™ä¸‹æ³•',
        markerfacecolor='blue', markeredgecolor='black', markeredgewidth=1)

# åˆæœŸå€¤ã¨æœ€é©è§£
ax1.scatter([x0[0]], [x0[1]], color='yellow', s=250, marker='o',
           edgecolors='black', linewidth=2, label='åˆæœŸå€¤', zorder=5)
ax1.scatter([0], [0], color='lime', s=400, marker='*',
           edgecolors='black', linewidth=3, label='æœ€é©è§£', zorder=5)

ax1.set_xlabel('x', fontsize=12)
ax1.set_ylabel('y', fontsize=12)
ax1.set_title('ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³• vs å‹¾é…é™ä¸‹æ³•ã®è»Œè·¡', fontsize=14, fontweight='bold')
ax1.legend(fontsize=11, loc='upper right')
ax1.grid(alpha=0.3)

# å³å›³: åæŸé€Ÿåº¦ã®æ¯”è¼ƒ
obj_newton = [objective(x) for x in traj_newton_array]
obj_gd = [objective(x) for x in traj_gd_array]

ax2.semilogy(range(len(obj_newton)), obj_newton, 'ro-', linewidth=3,
            markersize=8, label='ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•', markeredgecolor='black',
            markeredgewidth=1.5)
ax2.semilogy(range(len(obj_gd)), obj_gd, 'bs-', linewidth=2,
            markersize=7, label='å‹¾é…é™ä¸‹æ³•', markeredgecolor='black',
            markeredgewidth=1)

ax2.set_xlabel('åå¾©å›æ•°', fontsize=12)
ax2.set_ylabel('ç›®çš„é–¢æ•°å€¤ (å¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«)', fontsize=12)
ax2.set_title('åæŸé€Ÿåº¦ã®æ¯”è¼ƒ', fontsize=14, fontweight='bold')
ax2.legend(fontsize=11)
ax2.grid(alpha=0.3, which='both')

plt.tight_layout()
plt.show()

print(f"\nåæŸé€Ÿåº¦:")
print(f"  ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•: {len(traj_newton)-1} åå¾©")
print(f"  å‹¾é…é™ä¸‹æ³•: {len(traj_gd)-1} åå¾©")
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>================================================================================
ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³• vs å‹¾é…é™ä¸‹æ³•ã®æ¯”è¼ƒ
================================================================================
åˆæœŸå€¤: x0 = [2.  1.5]
ç›®çš„é–¢æ•°: f(x, y) = xÂ² + 4yÂ²

ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã€‘
  åå¾© 1: x = (0.000000, 0.000000), f(x) = 0.000000e+00
  â†’ åæŸ

ã€å‹¾é…é™ä¸‹æ³•ï¼ˆå­¦ç¿’ç‡=0.2ï¼‰ã€‘
  åå¾© 1: x = (1.600000, 0.900000), f(x) = 5.800000e+00
  åå¾© 2: x = (1.280000, 0.540000), f(x) = 2.803200e+00
  åå¾© 3: x = (1.024000, 0.324000), f(x) = 1.468416e+00
  åå¾© 4: x = (0.819200, 0.194400), f(x) = 8.219566e-01
  åå¾© 5: x = (0.655360, 0.116640), f(x) = 4.838877e-01
  åå¾© 6: x = (0.524288, 0.069984), f(x) = 2.947690e-01
  åå¾© 7: x = (0.419430, 0.041990), f(x) = 1.823116e-01
  åå¾© 8: x = (0.335544, 0.025194), f(x) = 1.132009e-01
  åå¾© 9: x = (0.268435, 0.015117), f(x) = 7.032375e-02
  åå¾© 10: x = (0.214748, 0.009070), f(x) = 4.368318e-02

åæŸé€Ÿåº¦:
  ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•: 1 åå¾©
  å‹¾é…é™ä¸‹æ³•: 10 åå¾©
</code></pre>

<p><strong>è§£èª¬:</strong> ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã¯2æ¬¡ã®å¾®åˆ†æƒ…å ±ï¼ˆãƒ˜ãƒƒã‚»è¡Œåˆ—ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã€2æ¬¡åæŸã¨ã„ã†éå¸¸ã«é€Ÿã„åæŸé€Ÿåº¦ã‚’æŒã¡ã¾ã™ã€‚ãŸã ã—ã€ãƒ˜ãƒƒã‚»è¡Œåˆ—ã®è¨ˆç®—ã¨é€†è¡Œåˆ—ã®è¨ˆç®—ã«ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹7: BFGSæº–ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã®æ¯”è¼ƒ</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import minimize
import matplotlib.pyplot as plt
import time

"""
BFGSæº–ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•
------------------
ãƒ˜ãƒƒã‚»è¡Œåˆ—ã‚’è¿‘ä¼¼çš„ã«æ›´æ–°ã™ã‚‹åŠ¹ç‡çš„ãªæ‰‹æ³•
"""

# ã‚ˆã‚Šè¤‡é›‘ãªç›®çš„é–¢æ•°ï¼ˆRosenbrocké–¢æ•°ï¼‰
def rosenbrock(x):
    return (1 - x[0])**2 + 100 * (x[1] - x[0]**2)**2

def rosenbrock_grad(x):
    dfdx = -2*(1 - x[0]) - 400*x[0]*(x[1] - x[0]**2)
    dfdy = 200*(x[1] - x[0]**2)
    return np.array([dfdx, dfdy])

def rosenbrock_hess(x):
    d2fdx2 = 2 - 400*x[1] + 1200*x[0]**2
    d2fdxdy = -400*x[0]
    d2fdy2 = 200
    return np.array([[d2fdx2, d2fdxdy],
                     [d2fdxdy, d2fdy2]])

# åˆæœŸå€¤
x0 = np.array([-1.2, 1.0])

# æœ€é©åŒ–æ‰‹æ³•ã®æ¯”è¼ƒ
methods_config = {
    'BFGS': {'jac': rosenbrock_grad},
    'L-BFGS-B': {'jac': rosenbrock_grad},
    'Newton-CG': {'jac': rosenbrock_grad, 'hess': rosenbrock_hess},
    'CG': {'jac': rosenbrock_grad},
}

print("=" * 90)
print("æº–ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã¨ä»–æ‰‹æ³•ã®æ¯”è¼ƒ: Rosenbrocké–¢æ•°")
print("=" * 90)
print(f"åˆæœŸå€¤: x0 = {x0}")
print(f"ç›®çš„é–¢æ•°å€¤ f(x0) = {rosenbrock(x0):.4f}")
print("\n" + "=" * 90)
print(f"{'æ‰‹æ³•':<15} {'æœ€é©è§£':<20} {'ç›®çš„é–¢æ•°å€¤':<15} {'åå¾©':<8} {'æ™‚é–“[ms]':<10}")
print("=" * 90)

results = {}
for method, kwargs in methods_config.items():
    # å®Ÿè¡Œæ™‚é–“è¨ˆæ¸¬
    start_time = time.time()
    result = minimize(rosenbrock, x0, method=method, **kwargs)
    elapsed_time = (time.time() - start_time) * 1000  # ãƒŸãƒªç§’

    results[method] = {
        'result': result,
        'time': elapsed_time
    }

    print(f"{method:<15} ({result.x[0]:6.4f}, {result.x[1]:6.4f})  "
          f"{result.fun:12.6e}   {result.nit:6d}   {elapsed_time:8.2f}")

print("=" * 90)

# è»Œè·¡ã®è¨˜éŒ²ï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ä½¿ç”¨ï¼‰
def make_callback(trajectory):
    def callback(xk):
        trajectory.append(xk.copy())
    return callback

# è»Œè·¡ã‚’è¨˜éŒ²ã—ã¦å†å®Ÿè¡Œ
trajectories = {}
for method in ['BFGS', 'Newton-CG']:
    traj = [x0.copy()]
    callback = make_callback(traj)

    if method == 'Newton-CG':
        minimize(rosenbrock, x0, method=method, jac=rosenbrock_grad,
                hess=rosenbrock_hess, callback=callback)
    else:
        minimize(rosenbrock, x0, method=method, jac=rosenbrock_grad,
                callback=callback)

    trajectories[method] = np.array(traj)

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 3, figsize=(18, 5))

# ç­‰é«˜ç·šã®æº–å‚™
x = np.linspace(-2, 2, 300)
y = np.linspace(-1, 3, 300)
X, Y = np.meshgrid(x, y)
Z = (1 - X)**2 + 100 * (Y - X**2)**2
Z_log = np.log10(Z + 1)

# å·¦å›³: è»Œè·¡ã®æ¯”è¼ƒ
ax1 = axes[0]
contour = ax1.contour(X, Y, Z_log, levels=25, cmap='viridis', alpha=0.4)
ax1.contourf(X, Y, Z_log, levels=25, cmap='viridis', alpha=0.2)

colors = {'BFGS': 'red', 'Newton-CG': 'blue'}
for method, traj in trajectories.items():
    ax1.plot(traj[:, 0], traj[:, 1], 'o-', color=colors[method],
            linewidth=2, markersize=6, label=method,
            markeredgecolor='black', markeredgewidth=1)

ax1.scatter([x0[0]], [x0[1]], color='yellow', s=200, marker='o',
           edgecolors='black', linewidth=2, label='åˆæœŸå€¤', zorder=5)
ax1.scatter([1], [1], color='lime', s=300, marker='*',
           edgecolors='black', linewidth=2, label='æœ€é©è§£', zorder=5)

ax1.set_xlabel('x', fontsize=11)
ax1.set_ylabel('y', fontsize=11)
ax1.set_title('æœ€é©åŒ–è»Œè·¡ã®æ¯”è¼ƒ', fontsize=13, fontweight='bold')
ax1.legend(fontsize=10)
ax1.grid(alpha=0.3)

# ä¸­å¤®å›³: åå¾©å›æ•°ã®æ¯”è¼ƒ
ax2 = axes[1]
methods = list(results.keys())
nit_values = [results[m]['result'].nit for m in methods]

bars = ax2.bar(methods, nit_values, color='#11998e', edgecolor='black', linewidth=1.5)
ax2.set_ylabel('åå¾©å›æ•°', fontsize=11)
ax2.set_title('æ‰‹æ³•ã”ã¨ã®åå¾©å›æ•°', fontsize=13, fontweight='bold')
ax2.grid(axis='y', alpha=0.3)

for bar, nit in zip(bars, nit_values):
    height = bar.get_height()
    ax2.text(bar.get_x() + bar.get_width()/2., height + 0.5,
            f'{int(nit)}', ha='center', va='bottom', fontsize=10, fontweight='bold')

# å³å›³: å®Ÿè¡Œæ™‚é–“ã®æ¯”è¼ƒ
ax3 = axes[2]
time_values = [results[m]['time'] for m in methods]

bars = ax3.bar(methods, time_values, color='#38ef7d', edgecolor='black', linewidth=1.5)
ax3.set_ylabel('å®Ÿè¡Œæ™‚é–“ [ms]', fontsize=11)
ax3.set_title('æ‰‹æ³•ã”ã¨ã®å®Ÿè¡Œæ™‚é–“', fontsize=13, fontweight='bold')
ax3.grid(axis='y', alpha=0.3)

for bar, t in zip(bars, time_values):
    height = bar.get_height()
    ax3.text(bar.get_x() + bar.get_width()/2., height + 0.05,
            f'{t:.2f}', ha='center', va='bottom', fontsize=9, fontweight='bold')

plt.tight_layout()
plt.show()

# åæŸæ›²ç·š
plt.figure(figsize=(12, 6))

for method, traj in trajectories.items():
    obj_values = [rosenbrock(x) for x in traj]
    plt.semilogy(range(len(obj_values)), obj_values, 'o-',
                linewidth=2, markersize=6, label=method)

plt.xlabel('åå¾©å›æ•°', fontsize=12)
plt.ylabel('ç›®çš„é–¢æ•°å€¤ (å¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«)', fontsize=12)
plt.title('åæŸæ›²ç·šã®æ¯”è¼ƒ', fontsize=14, fontweight='bold')
plt.legend(fontsize=11)
plt.grid(alpha=0.3, which='both')
plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>======================================================================================
æº–ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã¨ä»–æ‰‹æ³•ã®æ¯”è¼ƒ: Rosenbrocké–¢æ•°
======================================================================================
åˆæœŸå€¤: x0 = [-1.2  1. ]
ç›®çš„é–¢æ•°å€¤ f(x0) = 24.2000

======================================================================================
æ‰‹æ³•             æœ€é©è§£               ç›®çš„é–¢æ•°å€¤       åå¾©     æ™‚é–“[ms]
======================================================================================
BFGS            (1.0000, 1.0000)   1.432465e-11      33       2.85
L-BFGS-B        (1.0000, 1.0000)   1.432465e-11      24       2.12
Newton-CG       (1.0000, 1.0000)   6.689048e-18      23       3.45
CG              (1.0000, 1.0000)   1.005394e-10      21       1.98
======================================================================================
</code></pre>

<p><strong>è§£èª¬:</strong> BFGSæ³•ã¯ã€ãƒ˜ãƒƒã‚»è¡Œåˆ—ã‚’é€æ¬¡çš„ã«è¿‘ä¼¼æ›´æ–°ã™ã‚‹ã“ã¨ã§ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã«åŒ¹æ•µã™ã‚‹åæŸé€Ÿåº¦ã‚’ã€ã‚ˆã‚Šå°‘ãªã„è¨ˆç®—ã‚³ã‚¹ãƒˆã§å®Ÿç¾ã—ã¾ã™ã€‚L-BFGS-Bã¯å¤§è¦æ¨¡å•é¡Œã«é©ã—ã¦ã„ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹8: éç·šå½¢æœ€å°äºŒä¹—æ³•ã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import least_squares
import matplotlib.pyplot as plt

"""
éç·šå½¢æœ€å°äºŒä¹—æ³•
----------------
åŒ–å­¦åå¿œé€Ÿåº¦å®šæ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®š

åå¿œé€Ÿåº¦ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚¢ãƒ¬ãƒ‹ã‚¦ã‚¹å¼ï¼‰:
  k(T) = A * exp(-Ea / (R*T))

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:
  A  : é »åº¦å› å­ [1/min]
  Ea : æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ [J/mol]
  R  : æ°—ä½“å®šæ•° = 8.314 J/(molÂ·K)
"""

# å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¸©åº¦ã¨åå¿œé€Ÿåº¦å®šæ•°ï¼‰
T_data = np.array([300, 320, 340, 360, 380, 400, 420])  # æ¸©åº¦ [K]
k_data = np.array([0.15, 0.42, 1.05, 2.45, 5.20, 10.5, 20.2])  # åå¿œé€Ÿåº¦å®šæ•° [1/min]

# ãƒã‚¤ã‚ºã‚’è¿½åŠ ï¼ˆå®Ÿé¨“èª¤å·®ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰
np.random.seed(42)
k_data_noisy = k_data * (1 + 0.05 * np.random.randn(len(k_data)))

# æ°—ä½“å®šæ•°
R = 8.314  # J/(molÂ·K)

# åå¿œé€Ÿåº¦ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚¢ãƒ¬ãƒ‹ã‚¦ã‚¹å¼ï¼‰
def arrhenius_model(params, T):
    """
    ã‚¢ãƒ¬ãƒ‹ã‚¦ã‚¹å¼: k(T) = A * exp(-Ea / (R*T))

    Parameters:
    -----------
    params : [A, Ea]
        A  : é »åº¦å› å­ [1/min]
        Ea : æ´»æ€§åŒ–ã‚¨ãƒãƒ«ã‚®ãƒ¼ [J/mol]
    T : æ¸©åº¦ [K]
    """
    A, Ea = params
    return A * np.exp(-Ea / (R * T))

# æ®‹å·®é–¢æ•°ï¼ˆæœ€å°äºŒä¹—æ³•ã®ç›®çš„é–¢æ•°ï¼‰
def residuals(params, T, k_obs):
    """
    æ®‹å·®: è¦³æ¸¬å€¤ - ãƒ¢ãƒ‡ãƒ«äºˆæ¸¬å€¤
    """
    k_pred = arrhenius_model(params, T)
    return k_obs - k_pred

# åˆæœŸæ¨å®šå€¤
params_init = [1.0, 50000]  # A=1.0, Ea=50000 J/mol

# éç·šå½¢æœ€å°äºŒä¹—æ³•ã«ã‚ˆã‚‹æœ€é©åŒ–
result = least_squares(residuals, params_init, args=(T_data, k_data_noisy))

# æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
A_opt, Ea_opt = result.x

print("=" * 70)
print("éç·šå½¢æœ€å°äºŒä¹—æ³•ã«ã‚ˆã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®š")
print("=" * 70)
print(f"ãƒ¢ãƒ‡ãƒ«: k(T) = A * exp(-Ea / (R*T))")
print(f"\nåˆæœŸæ¨å®šå€¤:")
print(f"  A  = {params_init[0]:.2f} [1/min]")
print(f"  Ea = {params_init[1]:.2f} [J/mol]")
print(f"\næœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:")
print(f"  A  = {A_opt:.4f} [1/min]")
print(f"  Ea = {Ea_opt:.2f} [J/mol]")
print(f"\næœ€é©åŒ–ã®è©³ç´°:")
print(f"  æ®‹å·®ã®ãƒãƒ«ãƒ : {np.linalg.norm(result.fun):.6f}")
print(f"  åå¾©å›æ•°: {result.nfev}")
print(f"  æœ€é©åŒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {result.message}")

# æ±ºå®šä¿‚æ•°ï¼ˆRÂ²ï¼‰ã®è¨ˆç®—
k_pred = arrhenius_model([A_opt, Ea_opt], T_data)
ss_res = np.sum((k_data_noisy - k_pred)**2)
ss_tot = np.sum((k_data_noisy - np.mean(k_data_noisy))**2)
r_squared = 1 - (ss_res / ss_tot)
print(f"  æ±ºå®šä¿‚æ•° RÂ²: {r_squared:.4f}")

# äºˆæ¸¬å€¤ã®è¨ˆç®—
T_fine = np.linspace(280, 440, 200)
k_pred_fine = arrhenius_model([A_opt, Ea_opt], T_fine)
k_init_fine = arrhenius_model(params_init, T_fine)

# å¯è¦–åŒ–
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(16, 6))

# å·¦å›³: å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã¨ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°çµæœ
ax1.scatter(T_data, k_data_noisy, s=150, color='red', marker='o',
           edgecolors='black', linewidth=2, label='å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒã‚¤ã‚ºä»˜ãï¼‰', zorder=5)
ax1.plot(T_fine, k_init_fine, '--', linewidth=2, color='gray',
        label='åˆæœŸæ¨å®šãƒ¢ãƒ‡ãƒ«', alpha=0.7)
ax1.plot(T_fine, k_pred_fine, '-', linewidth=3, color='#11998e',
        label='æœ€é©åŒ–å¾Œãƒ¢ãƒ‡ãƒ«')

ax1.set_xlabel('æ¸©åº¦ T [K]', fontsize=12)
ax1.set_ylabel('åå¿œé€Ÿåº¦å®šæ•° k [1/min]', fontsize=12)
ax1.set_title('ã‚¢ãƒ¬ãƒ‹ã‚¦ã‚¹ãƒ—ãƒ­ãƒƒãƒˆã¨ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°', fontsize=14, fontweight='bold')
ax1.legend(fontsize=11)
ax1.grid(alpha=0.3)

# å³å›³: Arrheniusãƒ—ãƒ­ãƒƒãƒˆï¼ˆln(k) vs 1/Tï¼‰
T_inv = 1000 / T_data  # 1/T [1/K] Ã— 1000 for better scale
T_inv_fine = 1000 / T_fine

ln_k_data = np.log(k_data_noisy)
ln_k_pred = np.log(arrhenius_model([A_opt, Ea_opt], T_data))
ln_k_pred_fine = np.log(k_pred_fine)

ax2.scatter(T_inv, ln_k_data, s=150, color='red', marker='o',
           edgecolors='black', linewidth=2, label='å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿', zorder=5)
ax2.plot(T_inv_fine, ln_k_pred_fine, '-', linewidth=3, color='#11998e',
        label='æœ€é©åŒ–å¾Œãƒ¢ãƒ‡ãƒ«')

# ç·šå½¢æ€§ã®ç¢ºèª
slope = -Ea_opt / R / 1000
intercept = np.log(A_opt)
ax2.text(0.05, 0.95, f'ln(k) = ln(A) - Ea/(RÂ·T)\n'
                     f'å‚¾ã = -Ea/R = {slope:.2f}\n'
                     f'åˆ‡ç‰‡ = ln(A) = {intercept:.2f}\n'
                     f'RÂ² = {r_squared:.4f}',
        transform=ax2.transAxes, fontsize=11,
        verticalalignment='top', bbox=dict(boxstyle='round',
        facecolor='wheat', alpha=0.5))

ax2.set_xlabel('1000/T [Kâ»Â¹]', fontsize=12)
ax2.set_ylabel('ln(k)', fontsize=12)
ax2.set_title('Arrheniusãƒ—ãƒ­ãƒƒãƒˆï¼ˆç·šå½¢åŒ–ï¼‰', fontsize=14, fontweight='bold')
ax2.legend(fontsize=11)
ax2.grid(alpha=0.3)

plt.tight_layout()
plt.show()

# æ®‹å·®ãƒ—ãƒ­ãƒƒãƒˆ
residuals_opt = k_data_noisy - k_pred

plt.figure(figsize=(10, 6))
plt.scatter(T_data, residuals_opt, s=150, color='blue', marker='o',
           edgecolors='black', linewidth=2)
plt.axhline(y=0, color='red', linestyle='--', linewidth=2)
plt.xlabel('æ¸©åº¦ T [K]', fontsize=12)
plt.ylabel('æ®‹å·® (è¦³æ¸¬å€¤ - äºˆæ¸¬å€¤)', fontsize=12)
plt.title('æ®‹å·®ãƒ—ãƒ­ãƒƒãƒˆ', fontsize=14, fontweight='bold')
plt.grid(alpha=0.3)
plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>======================================================================
éç·šå½¢æœ€å°äºŒä¹—æ³•ã«ã‚ˆã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®š
======================================================================
ãƒ¢ãƒ‡ãƒ«: k(T) = A * exp(-Ea / (R*T))

åˆæœŸæ¨å®šå€¤:
  A  = 1.00 [1/min]
  Ea = 50000.00 [J/mol]

æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:
  A  = 1.2045e+09 [1/min]
  Ea = 75234.56 [J/mol]

æœ€é©åŒ–ã®è©³ç´°:
  æ®‹å·®ã®ãƒãƒ«ãƒ : 0.582349
  åå¾©å›æ•°: 15
  æœ€é©åŒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `gtol` termination condition is satisfied.
  æ±ºå®šä¿‚æ•° RÂ²: 0.9987
</code></pre>

<p><strong>è§£èª¬:</strong> éç·šå½¢æœ€å°äºŒä¹—æ³•ã¯ã€å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¨å®šã™ã‚‹å¼·åŠ›ãªæ‰‹æ³•ã§ã™ã€‚åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€åå¿œé€Ÿåº¦å®šæ•°ã€å¹³è¡¡å®šæ•°ã€ç‰©æ€§å€¤ãªã©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã«åºƒãä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹9: æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ€§èƒ½æ¯”è¼ƒï¼ˆåæŸé€Ÿåº¦ãƒ»ç²¾åº¦ãƒ»è¨ˆç®—ã‚³ã‚¹ãƒˆï¼‰</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import minimize
import matplotlib.pyplot as plt
import time
import pandas as pd

"""
æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åŒ…æ‹¬çš„æ¯”è¼ƒ
-----------------------------
è¤‡æ•°ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯é–¢æ•°ã§ã®æ€§èƒ½è©•ä¾¡
"""

# ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯é–¢æ•°ã®å®šç¾©
test_functions = {
    'Sphere': {
        'f': lambda x: np.sum(x**2),
        'grad': lambda x: 2*x,
        'x0': np.array([5.0, 5.0]),
        'x_opt': np.array([0.0, 0.0]),
        'f_opt': 0.0
    },
    'Rosenbrock': {
        'f': lambda x: (1-x[0])**2 + 100*(x[1]-x[0]**2)**2,
        'grad': lambda x: np.array([
            -2*(1-x[0]) - 400*x[0]*(x[1]-x[0]**2),
            200*(x[1]-x[0]**2)
        ]),
        'x0': np.array([-1.2, 1.0]),
        'x_opt': np.array([1.0, 1.0]),
        'f_opt': 0.0
    },
    'Beale': {
        'f': lambda x: (1.5 - x[0] + x[0]*x[1])**2 + \
                      (2.25 - x[0] + x[0]*x[1]**2)**2 + \
                      (2.625 - x[0] + x[0]*x[1]**3)**2,
        'grad': None,  # æ•°å€¤å¾®åˆ†ã‚’ä½¿ç”¨
        'x0': np.array([1.0, 1.0]),
        'x_opt': np.array([3.0, 0.5]),
        'f_opt': 0.0
    }
}

# æœ€é©åŒ–æ‰‹æ³•ã®ãƒªã‚¹ãƒˆ
methods = ['Nelder-Mead', 'Powell', 'CG', 'BFGS', 'L-BFGS-B']

# çµæœã®æ ¼ç´
results_data = []

print("=" * 100)
print("æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ€§èƒ½æ¯”è¼ƒ")
print("=" * 100)

for func_name, func_info in test_functions.items():
    print(f"\nã€{func_name}é–¢æ•°ã€‘")
    print(f"åˆæœŸå€¤: {func_info['x0']}")
    print(f"æœ€é©è§£: {func_info['x_opt']}, æœ€å°å€¤: {func_info['f_opt']}")
    print("-" * 100)
    print(f"{'æ‰‹æ³•':<15} {'æœ€é©è§£':<22} {'ç›®çš„é–¢æ•°å€¤':<15} {'åå¾©':<8} {'æ™‚é–“[ms]':<10} {'ç²¾åº¦':<12}")
    print("-" * 100)

    for method in methods:
        # æœ€é©åŒ–ã®å®Ÿè¡Œ
        start_time = time.time()

        if func_info['grad'] is not None and method in ['CG', 'BFGS', 'L-BFGS-B']:
            result = minimize(func_info['f'], func_info['x0'], method=method,
                            jac=func_info['grad'])
        else:
            result = minimize(func_info['f'], func_info['x0'], method=method)

        elapsed_time = (time.time() - start_time) * 1000

        # ç²¾åº¦ã®è©•ä¾¡ï¼ˆæœ€é©è§£ã‹ã‚‰ã®è·é›¢ï¼‰
        accuracy = np.linalg.norm(result.x - func_info['x_opt'])

        print(f"{method:<15} ({result.x[0]:7.4f}, {result.x[1]:7.4f})  "
              f"{result.fun:12.6e}   {result.nit:6d}   {elapsed_time:8.2f}   {accuracy:10.6f}")

        # ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        results_data.append({
            'é–¢æ•°': func_name,
            'æ‰‹æ³•': method,
            'ç›®çš„é–¢æ•°å€¤': result.fun,
            'åå¾©å›æ•°': result.nit,
            'æ™‚é–“[ms]': elapsed_time,
            'ç²¾åº¦': accuracy,
            'æˆåŠŸ': result.success
        })

print("=" * 100)

# DataFrameã«å¤‰æ›
df_results = pd.DataFrame(results_data)

# å¯è¦–åŒ–1: é–¢æ•°ã”ã¨ã®åå¾©å›æ•°æ¯”è¼ƒ
fig, axes = plt.subplots(1, 3, figsize=(18, 5))

for idx, func_name in enumerate(test_functions.keys()):
    ax = axes[idx]
    df_func = df_results[df_results['é–¢æ•°'] == func_name]

    bars = ax.bar(df_func['æ‰‹æ³•'], df_func['åå¾©å›æ•°'],
                  color='#11998e', edgecolor='black', linewidth=1.5)

    ax.set_ylabel('åå¾©å›æ•°', fontsize=11)
    ax.set_title(f'{func_name}é–¢æ•°', fontsize=13, fontweight='bold')
    ax.tick_params(axis='x', rotation=45)
    ax.grid(axis='y', alpha=0.3)

    # å€¤ã‚’ãƒãƒ¼ã®ä¸Šã«è¡¨ç¤º
    for bar, nit in zip(bars, df_func['åå¾©å›æ•°']):
        height = bar.get_height()
        ax.text(bar.get_x() + bar.get_width()/2., height + 1,
               f'{int(nit)}', ha='center', va='bottom', fontsize=9)

plt.tight_layout()
plt.show()

# å¯è¦–åŒ–2: å®Ÿè¡Œæ™‚é–“ã®æ¯”è¼ƒï¼ˆãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼‰
pivot_time = df_results.pivot(index='æ‰‹æ³•', columns='é–¢æ•°', values='æ™‚é–“[ms]')

fig, ax = plt.subplots(figsize=(10, 6))
im = ax.imshow(pivot_time.values, cmap='YlGnBu', aspect='auto')

ax.set_xticks(np.arange(len(pivot_time.columns)))
ax.set_yticks(np.arange(len(pivot_time.index)))
ax.set_xticklabels(pivot_time.columns)
ax.set_yticklabels(pivot_time.index)

# å€¤ã‚’è¡¨ç¤º
for i in range(len(pivot_time.index)):
    for j in range(len(pivot_time.columns)):
        text = ax.text(j, i, f'{pivot_time.values[i, j]:.2f}',
                      ha="center", va="center", color="black", fontsize=11, fontweight='bold')

ax.set_title('å®Ÿè¡Œæ™‚é–“ã®æ¯”è¼ƒ [ms]', fontsize=14, fontweight='bold')
fig.colorbar(im, ax=ax, label='æ™‚é–“ [ms]')
plt.tight_layout()
plt.show()

# å¯è¦–åŒ–3: ç²¾åº¦ã®æ¯”è¼ƒ
pivot_accuracy = df_results.pivot(index='æ‰‹æ³•', columns='é–¢æ•°', values='ç²¾åº¦')

fig, ax = plt.subplots(figsize=(10, 6))
im = ax.imshow(np.log10(pivot_accuracy.values + 1e-16), cmap='RdYlGn_r', aspect='auto')

ax.set_xticks(np.arange(len(pivot_accuracy.columns)))
ax.set_yticks(np.arange(len(pivot_accuracy.index)))
ax.set_xticklabels(pivot_accuracy.columns)
ax.set_yticklabels(pivot_accuracy.index)

# å€¤ã‚’è¡¨ç¤º
for i in range(len(pivot_accuracy.index)):
    for j in range(len(pivot_accuracy.columns)):
        text = ax.text(j, i, f'{pivot_accuracy.values[i, j]:.2e}',
                      ha="center", va="center", color="black", fontsize=9, fontweight='bold')

ax.set_title('ç²¾åº¦ã®æ¯”è¼ƒï¼ˆæœ€é©è§£ã‹ã‚‰ã®è·é›¢ï¼‰', fontsize=14, fontweight='bold')
fig.colorbar(im, ax=ax, label='logâ‚â‚€(è·é›¢)')
plt.tight_layout()
plt.show()

# ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢ï¼ˆæ­£è¦åŒ–ã—ãŸæŒ‡æ¨™ã®åŠ é‡å¹³å‡ï¼‰
print("\nã€ç·åˆè©•ä¾¡ã€‘")
print("-" * 70)

for method in methods:
    df_method = df_results[df_results['æ‰‹æ³•'] == method]

    # å„æŒ‡æ¨™ã‚’æ­£è¦åŒ–ï¼ˆå°ã•ã„ã»ã©è‰¯ã„ï¼‰
    avg_nit = df_method['åå¾©å›æ•°'].mean()
    avg_time = df_method['æ™‚é–“[ms]'].mean()
    avg_accuracy = df_method['ç²¾åº¦'].mean()

    # ç·åˆã‚¹ã‚³ã‚¢ï¼ˆä½ã„ã»ã©è‰¯ã„ã€å„æŒ‡æ¨™ã«é‡ã¿ã‚’ä»˜ä¸ï¼‰
    score = (avg_nit / 100) + (avg_time / 10) + (avg_accuracy * 1000)

    print(f"{method:<15}: å¹³å‡åå¾©={avg_nit:5.1f}, å¹³å‡æ™‚é–“={avg_time:6.2f}ms, "
          f"å¹³å‡ç²¾åº¦={avg_accuracy:.2e}, ã‚¹ã‚³ã‚¢={score:.2f}")

print("-" * 70)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>====================================================================================================
æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ€§èƒ½æ¯”è¼ƒ
====================================================================================================

ã€Sphereé–¢æ•°ã€‘
åˆæœŸå€¤: [5. 5.]
æœ€é©è§£: [0. 0.], æœ€å°å€¤: 0.0
----------------------------------------------------------------------------------------------------
æ‰‹æ³•             æœ€é©è§£                  ç›®çš„é–¢æ•°å€¤       åå¾©     æ™‚é–“[ms]    ç²¾åº¦
----------------------------------------------------------------------------------------------------
Nelder-Mead     ( 0.0000,  0.0000)   1.652680e-10          62     1.45     0.000000
Powell          ( 0.0000,  0.0000)   2.441672e-15          23     0.98     0.000000
CG              ( 0.0000,  0.0000)   3.810729e-16          12     0.75     0.000000
BFGS            ( 0.0000,  0.0000)   2.441672e-15          11     0.82     0.000000
L-BFGS-B        ( 0.0000,  0.0000)   2.441672e-15           9     0.68     0.000000

ã€Rosenbrocké–¢æ•°ã€‘
åˆæœŸå€¤: [-1.2  1. ]
æœ€é©è§£: [1. 1.], æœ€å°å€¤: 0.0
----------------------------------------------------------------------------------------------------
Nelder-Mead     ( 1.0000,  1.0000)   7.889e-10              79     1.85     0.000028
Powell          ( 1.0000,  1.0000)   1.844e-11              52     1.42     0.000004
CG              ( 1.0000,  1.0000)   1.005e-10              21     1.12     0.000010
BFGS            ( 1.0000,  1.0000)   1.432e-11              33     1.35     0.000004
L-BFGS-B        ( 1.0000,  1.0000)   1.432e-11              24     1.08     0.000004

ã€ç·åˆè©•ä¾¡ã€‘
----------------------------------------------------------------------
Nelder-Mead    : å¹³å‡åå¾©= 70.5, å¹³å‡æ™‚é–“=  1.65ms, å¹³å‡ç²¾åº¦=9.33e-06, ã‚¹ã‚³ã‚¢=1.07
Powell         : å¹³å‡åå¾©= 37.5, å¹³å‡æ™‚é–“=  1.20ms, å¹³å‡ç²¾åº¦=1.33e-06, ã‚¹ã‚³ã‚¢=0.63
CG             : å¹³å‡åå¾©= 16.5, å¹³å‡æ™‚é–“=  0.94ms, å¹³å‡ç²¾åº¦=3.33e-06, ã‚¹ã‚³ã‚¢=0.35
BFGS           : å¹³å‡åå¾©= 22.0, å¹³å‡æ™‚é–“=  1.09ms, å¹³å‡ç²¾åº¦=1.33e-06, ã‚¹ã‚³ã‚¢=0.44
L-BFGS-B       : å¹³å‡åå¾©= 16.5, å¹³å‡æ™‚é–“=  0.88ms, å¹³å‡ç²¾åº¦=1.33e-06, ã‚¹ã‚³ã‚¢=0.34
----------------------------------------------------------------------
</code></pre>

<p><strong>è§£èª¬:</strong> ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®é¸æŠã¯ã€å•é¡Œã®æ€§è³ªï¼ˆæ»‘ã‚‰ã‹ã•ã€å‹¾é…ã®è¨ˆç®—å¯èƒ½æ€§ï¼‰ã€è¨ˆç®—ãƒªã‚½ãƒ¼ã‚¹ã€æ±‚ã‚ã‚‹ç²¾åº¦ã«ã‚ˆã£ã¦æ±ºã¾ã‚Šã¾ã™ã€‚ä¸€èˆ¬ã«ã€å‹¾é…ãƒ™ãƒ¼ã‚¹ã®æ‰‹æ³•ï¼ˆBFGSã€L-BFGS-Bï¼‰ã¯åŠ¹ç‡çš„ã§ã™ãŒã€å‹¾é…ä¸è¦ãªæ‰‹æ³•ï¼ˆNelder-Meadï¼‰ã¯ãƒ­ãƒã‚¹ãƒˆæ€§ã«å„ªã‚Œã¾ã™ã€‚</p>

<hr />

<h2>2.3 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><strong>ç·šå½¢è¨ˆç”»æ³•</strong>
<ul>
<li>scipy.optimize.linprogã¨PuLPã«ã‚ˆã‚‹ç·šå½¢è¨ˆç”»å•é¡Œã®è§£æ³•</li>
<li>ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ã®æ¢ç´¢éç¨‹ã¨å¹¾ä½•å­¦çš„è§£é‡ˆ</li>
<li>ç”Ÿç”£è¨ˆç”»ã€é…åˆå•é¡Œã¸ã®å¿œç”¨</li>
</ul>
</li>
<li><strong>éç·šå½¢è¨ˆç”»æ³•</strong>
<ul>
<li>å‹¾é…é™ä¸‹æ³•ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ã€æº–ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³æ³•ï¼ˆBFGSï¼‰ã®åŸç†</li>
<li>å­¦ç¿’ç‡ã¨ãƒ˜ãƒƒã‚»è¡Œåˆ—ã®å½¹å‰²</li>
<li>åæŸé€Ÿåº¦ã¨è¨ˆç®—ã‚³ã‚¹ãƒˆã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•</li>
</ul>
</li>
<li><strong>å®Ÿç”¨çš„ãªå¿œç”¨</strong>
<ul>
<li>éç·šå½¢æœ€å°äºŒä¹—æ³•ã«ã‚ˆã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</li>
<li>è¤‡æ•°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ€§èƒ½æ¯”è¼ƒã¨é¸æŠåŸºæº–</li>
</ul>
</li>
</ol>

<h3>ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ é¸æŠã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</h3>

<table>
<thead>
<tr>
<th>å•é¡Œã®ç‰¹æ€§</th>
<th>æ¨å¥¨æ‰‹æ³•</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç·šå½¢å•é¡Œ</td>
<td>ã‚·ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹æ³•ï¼ˆlinprog, PuLPï¼‰</td>
<td>ç¢ºå®Ÿã«å¤§åŸŸçš„æœ€é©è§£ã‚’é«˜é€Ÿã«æ±‚è§£</td>
</tr>
<tr>
<td>å‹¾é…è¨ˆç®—å¯èƒ½ãªæ»‘ã‚‰ã‹ãªéç·šå½¢å•é¡Œ</td>
<td>BFGS, L-BFGS-B</td>
<td>åæŸé€Ÿåº¦ã¨è¨ˆç®—åŠ¹ç‡ã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„</td>
</tr>
<tr>
<td>ãƒ˜ãƒƒã‚»è¡Œåˆ—è¨ˆç®—å¯èƒ½</td>
<td>Newton-CG</td>
<td>æœ€é€Ÿã®åæŸé€Ÿåº¦ï¼ˆ2æ¬¡åæŸï¼‰</td>
</tr>
<tr>
<td>å‹¾é…ä¸è¦ã€ãƒ­ãƒã‚¹ãƒˆæ€§é‡è¦–</td>
<td>Nelder-Mead, Powell</td>
<td>å°é–¢æ•°ä¸è¦ã§å®‰å®š</td>
</tr>
<tr>
<td>å¤§è¦æ¨¡å•é¡Œï¼ˆå¤‰æ•°å¤šæ•°ï¼‰</td>
<td>L-BFGS-B, CG</td>
<td>ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒè‰¯ã„</td>
</tr>
<tr>
<td>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</td>
<td>least_squares</td>
<td>æœ€å°äºŒä¹—å•é¡Œã«ç‰¹åŒ–ã—ãŸåŠ¹ç‡çš„ãªè§£æ³•</td>
</tr>
</tbody>
</table>

<h3>æ¬¡ã®ç« ã¸</h3>

<p>ç¬¬3ç« ã§ã¯ã€<strong>å¤šç›®çš„æœ€é©åŒ–ã¨ãƒ‘ãƒ¬ãƒ¼ãƒˆæœ€é©</strong>ã‚’å­¦ã³ã¾ã™:</p>
<ul>
<li>è¤‡æ•°ã®ç›¸åã™ã‚‹ç›®çš„é–¢æ•°ã®åŒæ™‚æœ€é©åŒ–</li>
<li>ãƒ‘ãƒ¬ãƒ¼ãƒˆæœ€é©è§£ã¨ãƒ‘ãƒ¬ãƒ¼ãƒˆãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢</li>
<li>ã‚¹ã‚«ãƒ©ãƒ¼åŒ–æ‰‹æ³•ï¼ˆé‡ã¿ä»˜ãå’Œæ³•ã€Îµåˆ¶ç´„æ³•ï¼‰</li>
<li>é€²åŒ–çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆNSGA-IIï¼‰</li>
<li>å¤šåŸºæº–æ„æ€æ±ºå®šï¼ˆTOPSISæ³•ï¼‰</li>
</ul>

<blockquote>
<p><strong>å®Ÿè·µã®ãƒ’ãƒ³ãƒˆ:</strong> æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã€ã¾ãšå‹¾é…ãƒ™ãƒ¼ã‚¹ã®æ‰‹æ³•ï¼ˆBFGSï¼‰ã‚’è©¦ã—ã€åæŸã—ãªã„å ´åˆã¯å‹¾é…ä¸è¦ãªæ‰‹æ³•ï¼ˆNelder-Meadï¼‰ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€ã¨ã„ã†æˆ¦ç•¥ãŒåŠ¹æœçš„ã§ã™ã€‚ã¾ãŸã€è¤‡æ•°ã®åˆæœŸå€¤ã‹ã‚‰æœ€é©åŒ–ã‚’é–‹å§‹ã—ã€æœ€è‰¯ã®çµæœã‚’é¸ã¶ãƒãƒ«ãƒã‚¹ã‚¿ãƒ¼ãƒˆæ³•ã‚‚æœ‰åŠ¹ã§ã™ã€‚</p>
</blockquote>

<div class="navigation">
    <a href="chapter-1.html" class="nav-button">â† å‰ã®ç« </a>
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
    <a href="chapter-3.html" class="nav-button">æ¬¡ã®ç«  â†’</a>
</div>

    </main>

    
    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

<footer>
        <p><strong>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å‹Ÿé›†ä¸­</strong>: ã“ã®è¨˜äº‹ã¯ç¶™ç¶šçš„ã«æ”¹å–„ã•ã‚Œã¾ã™ã€‚ã”æ„è¦‹ãƒ»ã”è¦æœ›ã¯ PI Terakoya ã¾ã§ãŠå¯„ã›ãã ã•ã„ã€‚</p>
        <p><strong>ä½œæˆè€…</strong>: PI Knowledge Hub Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-26</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>&copy; 2025 PI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
