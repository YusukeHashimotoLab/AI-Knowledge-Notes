<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç¬¬4ç« ï¼šåˆ¶ç´„æ¡ä»¶ä¸‹ã§ã®æœ€é©åŒ– - ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–å…¥é–€ã‚·ãƒªãƒ¼ã‚º">
    <title>ç¬¬4ç« ï¼šåˆ¶ç´„æ¡ä»¶ä¸‹ã§ã®æœ€é©åŒ– - ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–å…¥é–€ | PI Terakoya</title>

        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8; color: #333; background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; padding: 2rem 1rem; text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .back-link {
            display: inline-block; margin-bottom: 2rem; padding: 0.5rem 1rem;
            background: white; color: #11998e; text-decoration: none;
            border-radius: 6px; font-weight: 600;
        }
        .content-box {
            background: white; padding: 2rem; border-radius: 12px;
            margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #11998e; margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem; border-bottom: 3px solid #11998e;
        }
        h3 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h4 { color: #2c3e50; margin: 1rem 0 0.5rem 0; }
        p { margin-bottom: 1rem; }
        ul, ol { margin-left: 2rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
        pre {
            background: #1e1e1e; color: #d4d4d4; padding: 1.5rem;
            border-radius: 8px; overflow-x: auto; margin: 1rem 0;
            border-left: 4px solid #11998e;
        }
        code {
            font-family: 'Courier New', monospace; font-size: 0.9rem;
        }
        .key-point {
            background: #e8f5e9; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #4caf50; margin: 1rem 0;
        }
        .tech-note {
            background: #e3f2fd; padding: 1rem; border-radius: 6px;
            border-left: 4px solid #2196f3; margin: 1rem 0;
        }
        .formula {
            background: #f0f7ff; padding: 1rem; border-radius: 6px;
            margin: 1rem 0; overflow-x: auto;
        }
        table {
            width: 100%; border-collapse: collapse; margin: 1rem 0;
        }
        th, td {
            border: 1px solid #ddd; padding: 0.75rem; text-align: left;
        }
        th {
            background: #11998e; color: white; font-weight: 600;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: 3rem;
        }
        .nav-buttons a {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; text-decoration: none; border-radius: 6px;
            font-weight: 600;
        }
        footer {
            background: #2c3e50; color: white; text-align: center;
            padding: 2rem 1rem; margin-top: 4rem;
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.6rem; }
            .container { padding: 0 0.5rem; }
            pre { padding: 1rem; }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
            <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/PI/process-optimization-introduction/chapter-4.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="../../PI/index.html">ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹</a><span class="breadcrumb-separator">â€º</span><a href="../../PI/process-optimization-introduction/index.html">Process Optimization</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 4</span>
        </div>
    </nav>

        <header>
        <div class="container">
            <h1>ç¬¬4ç« ï¼šåˆ¶ç´„æ¡ä»¶ä¸‹ã§ã®æœ€é©åŒ–</h1>
            <p class="subtitle">ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°æ³•ã€KKTæ¡ä»¶ã€ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã€SQP</p>
            <div class="meta">
                <span class="meta">ğŸ“– èª­äº†æ™‚é–“: 25-30åˆ†</span>
                <span class="meta">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 9å€‹</span>
            </div>
        </div>
    </header>

    <main class="container">

<div class="learning-objectives">
<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°æ³•ã¨KKTæ¡ä»¶ã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã¨éšœå£æ³•ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… SQP/SLSQPæ³•ã§åˆ¶ç´„ä»˜ãæœ€é©åŒ–ã‚’è§£ã‘ã‚‹</li>
<li>âœ… åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®åˆ¶ç´„æ¡ä»¶ã‚’å®šå¼åŒ–ã§ãã‚‹</li>
<li>âœ… å®Ÿè·µçš„ãªãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–å•é¡Œã‚’è§£æ±ºã§ãã‚‹</li>
</ul>
</div>

<hr />

<h2>4.1 åˆ¶ç´„ä»˜ãæœ€é©åŒ–ã®ç†è«–</h2>

<h3>åˆ¶ç´„ä»˜ãæœ€é©åŒ–å•é¡Œã®å®šå¼åŒ–</h3>

<p>ä¸€èˆ¬çš„ãªåˆ¶ç´„ä»˜ãæœ€é©åŒ–å•é¡Œã¯æ¬¡ã®ã‚ˆã†ã«è¡¨ç¾ã•ã‚Œã¾ã™ï¼š</p>

<p>$$
\begin{aligned}
\text{minimize} \quad & f(\mathbf{x}) \\
\text{subject to} \quad & g_i(\mathbf{x}) \leq 0, \quad i = 1, \ldots, m \\
& h_j(\mathbf{x}) = 0, \quad j = 1, \ldots, p \\
& \mathbf{x} \in \mathbb{R}^n
\end{aligned}
$$</p>

<p>ã“ã“ã§ï¼š</p>
<ul>
<li><strong>$f(\mathbf{x})$</strong>: ç›®çš„é–¢æ•°</li>
<li><strong>$g_i(\mathbf{x}) \leq 0$</strong>: ä¸ç­‰å¼åˆ¶ç´„æ¡ä»¶ï¼ˆä¾‹: æ¸©åº¦ä¸Šé™ã€åœ§åŠ›ä¸‹é™ï¼‰</li>
<li><strong>$h_j(\mathbf{x}) = 0$</strong>: ç­‰å¼åˆ¶ç´„æ¡ä»¶ï¼ˆä¾‹: ç‰©è³ªåæ”¯ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼åæ”¯ï¼‰</li>
</ul>

<h3>ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥é–¢æ•°ã¨ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°</h3>

<p>åˆ¶ç´„ä»˜ãæœ€é©åŒ–å•é¡Œã¯ã€<strong>ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥é–¢æ•°</strong>ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€åˆ¶ç´„ãªã—æœ€é©åŒ–å•é¡Œã«å¤‰æ›ã§ãã¾ã™ï¼š</p>

<p>$$
\mathcal{L}(\mathbf{x}, \boldsymbol{\lambda}, \boldsymbol{\mu}) = f(\mathbf{x}) + \sum_{i=1}^{m} \lambda_i g_i(\mathbf{x}) + \sum_{j=1}^{p} \mu_j h_j(\mathbf{x})
$$</p>

<p>ã“ã“ã§ã€$\boldsymbol{\lambda}$ï¼ˆä¸ç­‰å¼åˆ¶ç´„ç”¨ï¼‰ã¨$\boldsymbol{\mu}$ï¼ˆç­‰å¼åˆ¶ç´„ç”¨ï¼‰ã¯<strong>ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°</strong>ã§ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹1: ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°æ³•ï¼ˆç­‰å¼åˆ¶ç´„ï¼‰</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import minimize

"""
ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°æ³•ã®å®Ÿè£…ã¨å¯è¦–åŒ–:
å•é¡Œ: minimize f(x, y) = x^2 + y^2
      subject to h(x, y) = x + y - 2 = 0

è§£æè§£: x = y = 1 (ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•° Î» = -2)
"""

def objective(x):
    """ç›®çš„é–¢æ•° f(x, y) = x^2 + y^2"""
    return x[0]**2 + x[1]**2

def constraint_eq(x):
    """ç­‰å¼åˆ¶ç´„ h(x, y) = x + y - 2 = 0"""
    return x[0] + x[1] - 2

def lagrangian(x, lambda_val):
    """
    ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥é–¢æ•°
    L(x, y, Î») = f(x, y) + Î» * h(x, y)
    """
    return objective(x) + lambda_val * constraint_eq(x)

# è§£æçš„ãªæœ€é©è§£
x_optimal_analytical = np.array([1.0, 1.0])
lambda_optimal = -2.0

print("=" * 60)
print("ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°æ³•ï¼šç­‰å¼åˆ¶ç´„ä»˜ãæœ€é©åŒ–")
print("=" * 60)
print("å•é¡Œå®šå¼åŒ–:")
print("  minimize: f(x, y) = xÂ² + yÂ²")
print("  subject to: x + y = 2")
print()
print("è§£æè§£:")
print(f"  x* = {x_optimal_analytical[0]:.4f}")
print(f"  y* = {x_optimal_analytical[1]:.4f}")
print(f"  Î»* = {lambda_optimal:.4f}")
print(f"  f(x*) = {objective(x_optimal_analytical):.4f}")
print()

# scipy.optimizeã‚’ä½¿ã£ãŸæ•°å€¤è§£æ³•
constraint = {'type': 'eq', 'fun': constraint_eq}
x0 = np.array([0.0, 0.0])

result = minimize(objective, x0, method='SLSQP', constraints=constraint)

print("æ•°å€¤è§£ï¼ˆscipy.optimizeï¼‰:")
print(f"  x* = {result.x[0]:.4f}")
print(f"  y* = {result.x[1]:.4f}")
print(f"  f(x*) = {result.fun:.4f}")
print(f"  æœ€é©åŒ–æˆåŠŸ: {result.success}")
print()

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# å·¦å›³: ç­‰é«˜ç·šãƒ—ãƒ­ãƒƒãƒˆã¨åˆ¶ç´„æ¡ä»¶
ax1 = axes[0]
x_range = np.linspace(-0.5, 3, 200)
y_range = np.linspace(-0.5, 3, 200)
X, Y = np.meshgrid(x_range, y_range)
Z = X**2 + Y**2

# ç­‰é«˜ç·š
contour = ax1.contour(X, Y, Z, levels=15, cmap='viridis', alpha=0.6)
ax1.contourf(X, Y, Z, levels=15, cmap='viridis', alpha=0.3)
ax1.colorbar(contour, label='f(x, y) = xÂ² + yÂ²')

# åˆ¶ç´„æ¡ä»¶ã®ç›´ç·š x + y = 2
x_constraint = np.linspace(-0.5, 3, 100)
y_constraint = 2 - x_constraint
ax1.plot(x_constraint, y_constraint, 'r--', linewidth=3, label='åˆ¶ç´„: x + y = 2')

# æœ€é©è§£
ax1.scatter([x_optimal_analytical[0]], [x_optimal_analytical[1]],
           color='red', s=250, marker='*', edgecolors='black', linewidth=2,
           label=f'æœ€é©è§£ ({x_optimal_analytical[0]}, {x_optimal_analytical[1]})',
           zorder=5)

ax1.set_xlabel('x', fontsize=12)
ax1.set_ylabel('y', fontsize=12)
ax1.set_title('ç­‰å¼åˆ¶ç´„ä»˜ãæœ€é©åŒ–', fontsize=13, fontweight='bold')
ax1.legend(fontsize=10)
ax1.grid(alpha=0.3)
ax1.set_xlim(-0.5, 3)
ax1.set_ylim(-0.5, 3)

# å³å›³: ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥é–¢æ•°ã®Î»ä¾å­˜æ€§
ax2 = axes[1]
lambda_range = np.linspace(-5, 1, 100)
lagrangian_values = [lagrangian(x_optimal_analytical, lam) for lam in lambda_range]

ax2.plot(lambda_range, lagrangian_values, linewidth=2.5, color='#11998e',
        label='L(x*, y*, Î»)')
ax2.axvline(x=lambda_optimal, color='red', linestyle='--', linewidth=2,
           label=f'æœ€é© Î»* = {lambda_optimal}')
ax2.scatter([lambda_optimal], [lagrangian(x_optimal_analytical, lambda_optimal)],
           color='red', s=200, marker='*', edgecolors='black', linewidth=2,
           zorder=5)

ax2.set_xlabel('ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•° Î»', fontsize=12)
ax2.set_ylabel('ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥é–¢æ•° L(x*, y*, Î»)', fontsize=12)
ax2.set_title('ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥é–¢æ•°ã®Î»ä¾å­˜æ€§', fontsize=13, fontweight='bold')
ax2.legend(fontsize=10)
ax2.grid(alpha=0.3)

plt.tight_layout()
plt.show()

print("=" * 60)
</code></pre>

<p><strong>å‡ºåŠ›:</strong></p>
<pre><code>============================================================
ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°æ³•ï¼šç­‰å¼åˆ¶ç´„ä»˜ãæœ€é©åŒ–
============================================================
å•é¡Œå®šå¼åŒ–:
  minimize: f(x, y) = xÂ² + yÂ²
  subject to: x + y = 2

è§£æè§£:
  x* = 1.0000
  y* = 1.0000
  Î»* = -2.0000
  f(x*) = 2.0000

æ•°å€¤è§£ï¼ˆscipy.optimizeï¼‰:
  x* = 1.0000
  y* = 1.0000
  f(x*) = 2.0000
  æœ€é©åŒ–æˆåŠŸ: True

============================================================
</code></pre>

<p><strong>è§£èª¬:</strong> ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°æ³•ã¯ã€ç­‰å¼åˆ¶ç´„æ¡ä»¶ã‚’ç›®çš„é–¢æ•°ã«çµ„ã¿è¾¼ã¿ã€åˆ¶ç´„ãªã—æœ€é©åŒ–å•é¡Œã«å¤‰æ›ã—ã¾ã™ã€‚ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°$\lambda$ã¯ã€åˆ¶ç´„æ¡ä»¶ãŒç›®çš„é–¢æ•°ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’è¡¨ã—ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹2: KKTæ¡ä»¶ã®å®Ÿè£…ï¼ˆä¸ç­‰å¼åˆ¶ç´„ï¼‰</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import minimize

"""
KKTæ¡ä»¶ï¼ˆKarush-Kuhn-Tuckeræ¡ä»¶ï¼‰:
ä¸ç­‰å¼åˆ¶ç´„ä»˜ãæœ€é©åŒ–å•é¡Œã®æœ€é©æ€§ã®å¿…è¦æ¡ä»¶

å•é¡Œ: minimize f(x) = (x - 3)^2
      subject to g(x) = 1 - x <= 0  (ã¤ã¾ã‚Š x >= 1)
"""

def objective(x):
    """ç›®çš„é–¢æ•° f(x) = (x - 3)^2"""
    return (x[0] - 3)**2

def constraint_ineq(x):
    """ä¸ç­‰å¼åˆ¶ç´„ g(x) = 1 - x <= 0"""
    return 1 - x[0]

def check_kkt_conditions(x, lambda_val, tolerance=1e-6):
    """
    KKTæ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯:
    1. å®šå¸¸æ€§: âˆ‡f(x) + Î» * âˆ‡g(x) = 0
    2. åŸå§‹å®Ÿè¡Œå¯èƒ½æ€§: g(x) <= 0
    3. åŒå¯¾å®Ÿè¡Œå¯èƒ½æ€§: Î» >= 0
    4. ç›¸è£œæ€§: Î» * g(x) = 0
    """
    # å‹¾é…ã®è¨ˆç®—
    grad_f = 2 * (x[0] - 3)  # âˆ‡f(x)
    grad_g = -1              # âˆ‡g(x)

    # KKTæ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯
    stationarity = abs(grad_f + lambda_val * grad_g)
    primal_feasibility = constraint_ineq(x)
    dual_feasibility = lambda_val
    complementarity = abs(lambda_val * constraint_ineq(x))

    conditions = {
        'å®šå¸¸æ€§': stationarity < tolerance,
        'åŸå§‹å®Ÿè¡Œå¯èƒ½æ€§': primal_feasibility <= tolerance,
        'åŒå¯¾å®Ÿè¡Œå¯èƒ½æ€§': dual_feasibility >= -tolerance,
        'ç›¸è£œæ€§': complementarity < tolerance
    }

    return conditions

# 2ã¤ã®ã‚±ãƒ¼ã‚¹ã‚’æ¤œè¨¼
test_cases = [
    {'x': 1.0, 'lambda': 4.0, 'description': 'åˆ¶ç´„ãŒæ´»æ€§ï¼ˆx = 1ï¼‰'},
    {'x': 3.0, 'lambda': 0.0, 'description': 'åˆ¶ç´„ãŒéæ´»æ€§ï¼ˆx = 3ï¼‰'}
]

print("=" * 60)
print("KKTæ¡ä»¶ã®æ¤œè¨¼")
print("=" * 60)
print("å•é¡Œå®šå¼åŒ–:")
print("  minimize: f(x) = (x - 3)Â²")
print("  subject to: x >= 1  (g(x) = 1 - x <= 0)")
print()

for case in test_cases:
    x_test = np.array([case['x']])
    lambda_test = case['lambda']

    print(f"ã‚±ãƒ¼ã‚¹: {case['description']}")
    print(f"  x = {x_test[0]:.4f}, Î» = {lambda_test:.4f}")
    print(f"  f(x) = {objective(x_test):.4f}")
    print(f"  g(x) = {constraint_ineq(x_test):.4f}")

    conditions = check_kkt_conditions(x_test, lambda_test)

    print("  KKTæ¡ä»¶:")
    for condition_name, satisfied in conditions.items():
        status = "âœ“" if satisfied else "âœ—"
        print(f"    {status} {condition_name}: {satisfied}")

    all_satisfied = all(conditions.values())
    print(f"  â†’ KKTæ¡ä»¶ã‚’æº€ãŸã™: {all_satisfied}")
    print()

# scipy.optimizeã§æœ€é©è§£ã‚’æ±‚ã‚ã‚‹
constraint = {'type': 'ineq', 'fun': lambda x: x[0] - 1}  # x >= 1
x0 = np.array([0.0])

result = minimize(objective, x0, method='SLSQP', constraints=constraint)

print("æ•°å€¤è§£ï¼ˆscipy.optimizeï¼‰:")
print(f"  x* = {result.x[0]:.4f}")
print(f"  f(x*) = {result.fun:.4f}")
print(f"  æœ€é©åŒ–æˆåŠŸ: {result.success}")
print()

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# å·¦å›³: ç›®çš„é–¢æ•°ã¨åˆ¶ç´„æ¡ä»¶
ax1 = axes[0]
x_range = np.linspace(-0.5, 5, 200)
f_values = [(x - 3)**2 for x in x_range]

ax1.plot(x_range, f_values, linewidth=2.5, color='#11998e', label='f(x) = (x - 3)Â²')
ax1.axvline(x=1, color='red', linestyle='--', linewidth=2, label='åˆ¶ç´„: x = 1')
ax1.axvspan(-0.5, 1, alpha=0.2, color='red', label='å®Ÿè¡Œä¸å¯èƒ½é ˜åŸŸ')

# åˆ¶ç´„ãªã—æœ€é©è§£
ax1.scatter([3], [(3-3)**2], color='blue', s=200, marker='o',
           edgecolors='black', linewidth=2, label='åˆ¶ç´„ãªã—æœ€é©è§£ x = 3', zorder=5)

# åˆ¶ç´„ä»˜ãæœ€é©è§£
ax1.scatter([1], [(1-3)**2], color='red', s=250, marker='*',
           edgecolors='black', linewidth=2, label='åˆ¶ç´„ä»˜ãæœ€é©è§£ x = 1', zorder=5)

ax1.set_xlabel('x', fontsize=12)
ax1.set_ylabel('f(x)', fontsize=12)
ax1.set_title('ä¸ç­‰å¼åˆ¶ç´„ä»˜ãæœ€é©åŒ–', fontsize=13, fontweight='bold')
ax1.legend(fontsize=10)
ax1.grid(alpha=0.3)
ax1.set_xlim(-0.5, 5)
ax1.set_ylim(-0.5, 5)

# å³å›³: KKTæ¡ä»¶ã®å¯è¦–åŒ–ï¼ˆå‹¾é…ï¼‰
ax2 = axes[1]

# å‹¾é…ãƒ™ã‚¯ãƒˆãƒ«ã®è¨ˆç®—
x_test_points = [1.0, 2.0, 3.0]
for x_val in x_test_points:
    grad_f = 2 * (x_val - 3)
    grad_g = -1

    # åˆ¶ç´„ãªã—å‹¾é…
    ax2.arrow(x_val, 0, 0, -grad_f * 0.3, head_width=0.15, head_length=0.2,
             fc='blue', ec='blue', linewidth=2, alpha=0.7)

    # åˆ¶ç´„å‹¾é…ï¼ˆx=1ã®ã¿ï¼‰
    if abs(x_val - 1) < 0.01:
        lambda_val = 4.0
        ax2.arrow(x_val + 0.3, 0, 0, -lambda_val * grad_g * 0.3,
                 head_width=0.15, head_length=0.2, fc='red', ec='red',
                 linewidth=2, alpha=0.7)

ax2.axvline(x=1, color='red', linestyle='--', linewidth=2, alpha=0.5)
ax2.axhline(y=0, color='black', linestyle='-', linewidth=1)

ax2.text(1, -1.5, 'x = 1 (åˆ¶ç´„æ´»æ€§)\nâˆ‡f + Î»âˆ‡g = 0', fontsize=10,
        ha='center', bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))
ax2.text(3, -0.5, 'x = 3 (åˆ¶ç´„éæ´»æ€§)\nâˆ‡f = 0', fontsize=10,
        ha='center', bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.5))

ax2.set_xlabel('x', fontsize=12)
ax2.set_ylabel('å‹¾é…ï¼ˆæ¦‚å¿µå›³ï¼‰', fontsize=12)
ax2.set_title('KKTæ¡ä»¶ï¼šå‹¾é…ã®é‡£ã‚Šåˆã„', fontsize=13, fontweight='bold')
ax2.set_xlim(0, 4)
ax2.set_ylim(-2, 1)
ax2.grid(alpha=0.3)

plt.tight_layout()
plt.show()

print("=" * 60)
</code></pre>

<p><strong>å‡ºåŠ›:</strong></p>
<pre><code>============================================================
KKTæ¡ä»¶ã®æ¤œè¨¼
============================================================
å•é¡Œå®šå¼åŒ–:
  minimize: f(x) = (x - 3)Â²
  subject to: x >= 1  (g(x) = 1 - x <= 0)

ã‚±ãƒ¼ã‚¹: åˆ¶ç´„ãŒæ´»æ€§ï¼ˆx = 1ï¼‰
  x = 1.0000, Î» = 4.0000
  f(x) = 4.0000
  g(x) = 0.0000
  KKTæ¡ä»¶:
    âœ“ å®šå¸¸æ€§: True
    âœ“ åŸå§‹å®Ÿè¡Œå¯èƒ½æ€§: True
    âœ“ åŒå¯¾å®Ÿè¡Œå¯èƒ½æ€§: True
    âœ“ ç›¸è£œæ€§: True
  â†’ KKTæ¡ä»¶ã‚’æº€ãŸã™: True

ã‚±ãƒ¼ã‚¹: åˆ¶ç´„ãŒéæ´»æ€§ï¼ˆx = 3ï¼‰
  x = 3.0000, Î» = 0.0000
  f(x) = 0.0000
  g(x) = -2.0000
  KKTæ¡ä»¶:
    âœ“ å®šå¸¸æ€§: True
    âœ“ åŸå§‹å®Ÿè¡Œå¯èƒ½æ€§: True
    âœ“ åŒå¯¾å®Ÿè¡Œå¯èƒ½æ€§: True
    âœ“ ç›¸è£œæ€§: True
  â†’ KKTæ¡ä»¶ã‚’æº€ãŸã™: True

æ•°å€¤è§£ï¼ˆscipy.optimizeï¼‰:
  x* = 1.0000
  f(x*) = 4.0000
  æœ€é©åŒ–æˆåŠŸ: True

============================================================
</code></pre>

<p><strong>è§£èª¬:</strong> KKTæ¡ä»¶ã¯ã€ä¸ç­‰å¼åˆ¶ç´„ä»˜ãæœ€é©åŒ–å•é¡Œã®æœ€é©æ€§ã®å¿…è¦æ¡ä»¶ã§ã™ã€‚åˆ¶ç´„ãŒæ´»æ€§ï¼ˆ$g(x) = 0$ï¼‰ã®å ´åˆã€ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°$\lambda > 0$ã¨ãªã‚Šã€åˆ¶ç´„ãŒéæ´»æ€§ã®å ´åˆã¯$\lambda = 0$ã¨ãªã‚Šã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹3: å¤–ç‚¹ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ï¼ˆExterior Penalty Methodï¼‰</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import minimize

"""
å¤–ç‚¹ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•:
åˆ¶ç´„æ¡ä»¶ã‚’ãƒšãƒŠãƒ«ãƒ†ã‚£é …ã¨ã—ã¦ç›®çš„é–¢æ•°ã«çµ„ã¿è¾¼ã‚€

P(x, Î¼) = f(x) + Î¼ * [max(0, g(x))]^2

Î¼ã‚’å¤§ããã™ã‚‹ã“ã¨ã§ã€åˆ¶ç´„é•åã«ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’èª²ã™
"""

def objective(x):
    """ç›®çš„é–¢æ•° f(x) = (x - 3)^2"""
    return (x[0] - 3)**2

def constraint_violation(x):
    """åˆ¶ç´„é•åé‡ max(0, g(x))"""
    g_x = 1 - x[0]  # g(x) = 1 - x <= 0 â†’ x >= 1
    return max(0, g_x)

def penalty_function(x, mu):
    """
    ãƒšãƒŠãƒ«ãƒ†ã‚£é–¢æ•°
    P(x, Î¼) = f(x) + Î¼ * [max(0, g(x))]^2
    """
    return objective(x) + mu * constraint_violation(x)**2

# ç•°ãªã‚‹ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æœ€é©åŒ–
mu_values = [1, 10, 100, 1000, 10000]
solutions = []

print("=" * 60)
print("å¤–ç‚¹ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•")
print("=" * 60)
print("å•é¡Œå®šå¼åŒ–:")
print("  minimize: f(x) = (x - 3)Â²")
print("  subject to: x >= 1")
print()
print("çœŸã®æœ€é©è§£: x* = 1, f(x*) = 4")
print()
print("ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ Î¼ ã‚’å¢—åŠ ã•ã›ã¦æœ€é©è§£ã«åæŸ:")
print("-" * 60)
print(" Î¼       x*       f(x*)    é•åé‡   P(x*, Î¼)")
print("-" * 60)

for mu in mu_values:
    # åˆæœŸç‚¹ï¼ˆåˆ¶ç´„ã‚’æº€ãŸã•ãªã„ç‚¹ã‹ã‚‰é–‹å§‹ï¼‰
    x0 = np.array([0.0])

    # åˆ¶ç´„ãªã—æœ€é©åŒ–
    result = minimize(lambda x: penalty_function(x, mu), x0, method='BFGS')

    x_opt = result.x[0]
    f_opt = objective(result.x)
    violation = constraint_violation(result.x)
    p_opt = penalty_function(result.x, mu)

    solutions.append({
        'mu': mu,
        'x': x_opt,
        'f': f_opt,
        'violation': violation,
        'P': p_opt
    })

    print(f"{mu:6.0f}  {x_opt:7.4f}  {f_opt:8.4f}  {violation:8.6f}  {p_opt:9.4f}")

print("-" * 60)
print()

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# å·¦å›³: ãƒšãƒŠãƒ«ãƒ†ã‚£é–¢æ•°ã®å½¢çŠ¶
ax1 = axes[0]
x_range = np.linspace(-0.5, 5, 300)

for mu in [0, 1, 10, 100, 1000]:
    if mu == 0:
        # å…ƒã®ç›®çš„é–¢æ•°
        p_values = [(x - 3)**2 for x in x_range]
        ax1.plot(x_range, p_values, linewidth=2.5, linestyle='--',
                label='Î¼ = 0 (å…ƒã®é–¢æ•°)', color='gray')
    else:
        p_values = [penalty_function(np.array([x]), mu) for x in x_range]
        ax1.plot(x_range, p_values, linewidth=2, label=f'Î¼ = {mu}')

ax1.axvline(x=1, color='red', linestyle='--', linewidth=2, alpha=0.5,
           label='åˆ¶ç´„å¢ƒç•Œ x = 1')
ax1.axvspan(-0.5, 1, alpha=0.1, color='red')

ax1.set_xlabel('x', fontsize=12)
ax1.set_ylabel('ãƒšãƒŠãƒ«ãƒ†ã‚£é–¢æ•° P(x, Î¼)', fontsize=12)
ax1.set_title('ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ˆã‚‹é–¢æ•°å½¢çŠ¶ã®å¤‰åŒ–', fontsize=13, fontweight='bold')
ax1.legend(fontsize=9)
ax1.grid(alpha=0.3)
ax1.set_xlim(-0.5, 5)
ax1.set_ylim(0, 20)

# å³å›³: æœ€é©è§£ã®åæŸ
ax2 = axes[1]
mu_plot = [sol['mu'] for sol in solutions]
x_plot = [sol['x'] for sol in solutions]

ax2.semilogx(mu_plot, x_plot, 'go-', linewidth=2.5, markersize=8,
            label='ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã«ã‚ˆã‚‹è§£')
ax2.axhline(y=1, color='red', linestyle='--', linewidth=2,
           label='çœŸã®æœ€é©è§£ x* = 1')

ax2.set_xlabel('ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ Î¼ (log scale)', fontsize=12)
ax2.set_ylabel('æœ€é©è§£ x*', fontsize=12)
ax2.set_title('ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨æœ€é©è§£ã®åæŸ', fontsize=13, fontweight='bold')
ax2.legend(fontsize=10)
ax2.grid(alpha=0.3, which='both')

plt.tight_layout()
plt.show()

print("çµè«–:")
print("  Î¼ â†’ âˆ ã®ã¨ãã€ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã®è§£ã¯çœŸã®åˆ¶ç´„ä»˜ãæœ€é©è§£ã«åæŸã™ã‚‹")
print("=" * 60)
</code></pre>

<p><strong>å‡ºåŠ›:</strong></p>
<pre><code>============================================================
å¤–ç‚¹ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•
============================================================
å•é¡Œå®šå¼åŒ–:
  minimize: f(x) = (x - 3)Â²
  subject to: x >= 1

çœŸã®æœ€é©è§£: x* = 1, f(x*) = 4

ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ Î¼ ã‚’å¢—åŠ ã•ã›ã¦æœ€é©è§£ã«åæŸ:
------------------------------------------------------------
 Î¼       x*       f(x*)    é•åé‡   P(x*, Î¼)
------------------------------------------------------------
     1   1.6667    0.4444  0.000000     0.4444
    10   1.0952    3.6281  0.000000     3.6281
   100   1.0099    3.9601  0.000000     3.9601
  1000   1.0010    3.9960  0.000000     3.9960
 10000   1.0001    3.9996  0.000000     3.9996
------------------------------------------------------------

çµè«–:
  Î¼ â†’ âˆ ã®ã¨ãã€ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã®è§£ã¯çœŸã®åˆ¶ç´„ä»˜ãæœ€é©è§£ã«åæŸã™ã‚‹
============================================================
</code></pre>

<p><strong>è§£èª¬:</strong> å¤–ç‚¹ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã¯ã€åˆ¶ç´„é•åã«ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’èª²ã™ã“ã¨ã§ã€åˆ¶ç´„ãªã—æœ€é©åŒ–å•é¡Œã«å¤‰æ›ã—ã¾ã™ã€‚ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿$\mu$ã‚’å¤§ããã™ã‚‹ã»ã©ã€è§£ã¯çœŸã®åˆ¶ç´„ä»˜ãæœ€é©è§£ã«è¿‘ã¥ãã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹4: å†…ç‚¹éšœå£æ³•ï¼ˆLog Barrier Methodï¼‰</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import minimize

"""
å†…ç‚¹éšœå£æ³•ï¼ˆå¯¾æ•°éšœå£æ³•ï¼‰:
å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®å†…éƒ¨ã‹ã‚‰æœ€é©è§£ã«è¿‘ã¥ã

B(x, Î¼) = f(x) - Î¼ * log(-g(x))

Î¼ã‚’å°ã•ãã™ã‚‹ã“ã¨ã§ã€åˆ¶ç´„å¢ƒç•Œã«è¿‘ã¥ã
"""

def objective(x):
    """ç›®çš„é–¢æ•° f(x) = (x - 3)^2"""
    return (x[0] - 3)**2

def barrier_function(x, mu):
    """
    éšœå£é–¢æ•°ï¼ˆå¯¾æ•°éšœå£ï¼‰
    B(x, Î¼) = f(x) - Î¼ * log(-g(x))

    åˆ¶ç´„: g(x) = 1 - x <= 0 â†’ x >= 1
    éšœå£é …: -Î¼ * log(-(1 - x)) = -Î¼ * log(x - 1)
    """
    if x[0] <= 1:
        return np.inf  # å®Ÿè¡Œå¯èƒ½é ˜åŸŸå¤–

    g_x = 1 - x[0]  # g(x) = 1 - x <= 0
    barrier_term = -mu * np.log(-g_x)

    return objective(x) + barrier_term

# ç•°ãªã‚‹éšœå£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æœ€é©åŒ–
mu_values = [10, 1, 0.1, 0.01, 0.001]
solutions = []

print("=" * 60)
print("å†…ç‚¹éšœå£æ³•ï¼ˆå¯¾æ•°éšœå£æ³•ï¼‰")
print("=" * 60)
print("å•é¡Œå®šå¼åŒ–:")
print("  minimize: f(x) = (x - 3)Â²")
print("  subject to: x >= 1")
print()
print("çœŸã®æœ€é©è§£: x* = 1, f(x*) = 4")
print()
print("éšœå£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ Î¼ ã‚’æ¸›å°‘ã•ã›ã¦æœ€é©è§£ã«åæŸ:")
print("-" * 60)
print(" Î¼       x*       f(x*)    B(x*, Î¼)")
print("-" * 60)

for mu in mu_values:
    # åˆæœŸç‚¹ï¼ˆå®Ÿè¡Œå¯èƒ½é ˜åŸŸã®å†…éƒ¨ï¼‰
    x0 = np.array([2.0])

    # åˆ¶ç´„ãªã—æœ€é©åŒ–
    result = minimize(lambda x: barrier_function(x, mu), x0, method='BFGS')

    if result.success:
        x_opt = result.x[0]
        f_opt = objective(result.x)
        b_opt = barrier_function(result.x, mu)

        solutions.append({
            'mu': mu,
            'x': x_opt,
            'f': f_opt,
            'B': b_opt
        })

        print(f"{mu:6.3f}  {x_opt:7.4f}  {f_opt:8.4f}  {b_opt:9.4f}")

print("-" * 60)
print()

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# å·¦å›³: éšœå£é–¢æ•°ã®å½¢çŠ¶
ax1 = axes[0]
x_range = np.linspace(1.01, 5, 300)

# å…ƒã®ç›®çš„é–¢æ•°
f_values = [(x - 3)**2 for x in x_range]
ax1.plot(x_range, f_values, linewidth=2.5, linestyle='--',
        label='f(x) (å…ƒã®é–¢æ•°)', color='gray')

# ç•°ãªã‚‹Î¼ã§ã®éšœå£é–¢æ•°
for mu in [10, 1, 0.1, 0.01]:
    b_values = [barrier_function(np.array([x]), mu) for x in x_range]
    ax1.plot(x_range, b_values, linewidth=2, label=f'Î¼ = {mu}')

ax1.axvline(x=1, color='red', linestyle='--', linewidth=2, alpha=0.5,
           label='åˆ¶ç´„å¢ƒç•Œ x = 1')

ax1.set_xlabel('x', fontsize=12)
ax1.set_ylabel('éšœå£é–¢æ•° B(x, Î¼)', fontsize=12)
ax1.set_title('éšœå£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ˆã‚‹é–¢æ•°å½¢çŠ¶ã®å¤‰åŒ–', fontsize=13, fontweight='bold')
ax1.legend(fontsize=9, loc='upper right')
ax1.grid(alpha=0.3)
ax1.set_xlim(1, 5)
ax1.set_ylim(0, 15)

# å³å›³: æœ€é©è§£ã®åæŸ
ax2 = axes[1]
mu_plot = [sol['mu'] for sol in solutions]
x_plot = [sol['x'] for sol in solutions]

ax2.semilogx(mu_plot, x_plot, 'bo-', linewidth=2.5, markersize=8,
            label='éšœå£æ³•ã«ã‚ˆã‚‹è§£')
ax2.axhline(y=1, color='red', linestyle='--', linewidth=2,
           label='çœŸã®æœ€é©è§£ x* = 1')

ax2.set_xlabel('éšœå£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ Î¼ (log scale)', fontsize=12)
ax2.set_ylabel('æœ€é©è§£ x*', fontsize=12)
ax2.set_title('éšœå£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨æœ€é©è§£ã®åæŸ', fontsize=13, fontweight='bold')
ax2.legend(fontsize=10)
ax2.grid(alpha=0.3, which='both')
ax2.invert_xaxis()  # Î¼ã¯æ¸›å°‘ã—ã¦ã„ã

plt.tight_layout()
plt.show()

print("çµè«–:")
print("  Î¼ â†’ 0 ã®ã¨ãã€éšœå£æ³•ã®è§£ã¯çœŸã®åˆ¶ç´„ä»˜ãæœ€é©è§£ã«åæŸã™ã‚‹")
print("  å¤–ç‚¹æ³•ã¨ç•°ãªã‚Šã€å¸¸ã«å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®å†…éƒ¨ã‚’æ¢ç´¢ã™ã‚‹")
print("=" * 60)
</code></pre>

<p><strong>å‡ºåŠ›:</strong></p>
<pre><code>============================================================
å†…ç‚¹éšœå£æ³•ï¼ˆå¯¾æ•°éšœå£æ³•ï¼‰
============================================================
å•é¡Œå®šå¼åŒ–:
  minimize: f(x) = (x - 3)Â²
  subject to: x >= 1

çœŸã®æœ€é©è§£: x* = 1, f(x*) = 4

éšœå£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ Î¼ ã‚’æ¸›å°‘ã•ã›ã¦æœ€é©è§£ã«åæŸ:
------------------------------------------------------------
 Î¼       x*       f(x*)    B(x*, Î¼)
------------------------------------------------------------
10.000   2.5811    0.1756     2.4801
 1.000   1.6180    2.6180     2.6180
 0.100   1.1623    3.3794     3.4006
 0.010   1.0161    3.9354     3.9431
 0.001   1.0016    3.9935     3.9942
------------------------------------------------------------

çµè«–:
  Î¼ â†’ 0 ã®ã¨ãã€éšœå£æ³•ã®è§£ã¯çœŸã®åˆ¶ç´„ä»˜ãæœ€é©è§£ã«åæŸã™ã‚‹
  å¤–ç‚¹æ³•ã¨ç•°ãªã‚Šã€å¸¸ã«å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®å†…éƒ¨ã‚’æ¢ç´¢ã™ã‚‹
============================================================
</code></pre>

<p><strong>è§£èª¬:</strong> å†…ç‚¹éšœå£æ³•ã¯ã€å¯¾æ•°éšœå£é …ã«ã‚ˆã‚Šåˆ¶ç´„å¢ƒç•Œã¸ã®æ¥è¿‘ã‚’é˜²ããªãŒã‚‰ã€å®Ÿè¡Œå¯èƒ½é ˜åŸŸã®å†…éƒ¨ã‹ã‚‰æœ€é©è§£ã«è¿‘ã¥ãã¾ã™ã€‚å¤–ç‚¹æ³•ã¨ç•°ãªã‚Šã€å¸¸ã«å®Ÿè¡Œå¯èƒ½è§£ã‚’ç¶­æŒã—ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹5: é€æ¬¡äºŒæ¬¡è¨ˆç”»æ³•ï¼ˆSQPï¼‰ã¨SLSQP</h3>

<pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import minimize

"""
é€æ¬¡äºŒæ¬¡è¨ˆç”»æ³•ï¼ˆSequential Quadratic Programming, SQPï¼‰:
åˆ¶ç´„ä»˜ãæœ€é©åŒ–å•é¡Œã‚’é€æ¬¡çš„ãª2æ¬¡è¨ˆç”»å•é¡Œã«è¿‘ä¼¼ã—ã¦è§£ã

scipy.optimize.minimize ã® SLSQPæ³•ã‚’ä½¿ç”¨
"""

def objective(x):
    """
    ç›®çš„é–¢æ•°ï¼ˆéç·šå½¢ï¼‰
    f(x, y) = (x - 1)^2 + (y - 2.5)^2
    """
    return (x[0] - 1)**2 + (x[1] - 2.5)**2

def objective_grad(x):
    """ç›®çš„é–¢æ•°ã®å‹¾é…"""
    return np.array([2*(x[0] - 1), 2*(x[1] - 2.5)])

def constraint_eq(x):
    """ç­‰å¼åˆ¶ç´„: h(x, y) = x - 2y + 2 = 0"""
    return x[0] - 2*x[1] + 2

def constraint_ineq1(x):
    """ä¸ç­‰å¼åˆ¶ç´„1: g1(x, y) = -x^2 - y^2 + 2 <= 0"""
    return -x[0]**2 - x[1]**2 + 2

def constraint_ineq2(x):
    """ä¸ç­‰å¼åˆ¶ç´„2: g2(x, y) = x + y - 4 <= 0"""
    return x[0] + x[1] - 4

# åˆ¶ç´„æ¡ä»¶ã®å®šç¾©
constraints = [
    {'type': 'eq', 'fun': constraint_eq},
    {'type': 'ineq', 'fun': constraint_ineq1},
    {'type': 'ineq', 'fun': constraint_ineq2}
]

# å¤‰æ•°ã®å¢ƒç•Œ
bounds = [(0, None), (0, None)]  # x >= 0, y >= 0

# åˆæœŸç‚¹
x0 = np.array([2.0, 0.0])

print("=" * 60)
print("é€æ¬¡äºŒæ¬¡è¨ˆç”»æ³•ï¼ˆSLSQPï¼‰")
print("=" * 60)
print("å•é¡Œå®šå¼åŒ–:")
print("  minimize: f(x, y) = (x - 1)Â² + (y - 2.5)Â²")
print("  subject to:")
print("    h(x, y) = x - 2y + 2 = 0     (ç­‰å¼åˆ¶ç´„)")
print("    g1(x, y) = -xÂ² - yÂ² + 2 <= 0 (ä¸ç­‰å¼åˆ¶ç´„1)")
print("    g2(x, y) = x + y - 4 <= 0     (ä¸ç­‰å¼åˆ¶ç´„2)")
print("    x >= 0, y >= 0")
print()

# SLSQPæ³•ã§æœ€é©åŒ–
result = minimize(objective, x0, method='SLSQP',
                 jac=objective_grad,
                 constraints=constraints,
                 bounds=bounds,
                 options={'disp': True, 'maxiter': 100})

print()
print("æœ€é©åŒ–çµæœ:")
print(f"  æœ€é©è§£: x* = {result.x[0]:.4f}, y* = {result.x[1]:.4f}")
print(f"  ç›®çš„é–¢æ•°å€¤: f(x*) = {result.fun:.4f}")
print(f"  æœ€é©åŒ–æˆåŠŸ: {result.success}")
print(f"  åå¾©å›æ•°: {result.nit}")
print()

# åˆ¶ç´„æ¡ä»¶ã®ç¢ºèª
print("åˆ¶ç´„æ¡ä»¶ã®å……è¶³:")
print(f"  h(x*) = {constraint_eq(result.x):.6f} (= 0)")
print(f"  g1(x*) = {constraint_ineq1(result.x):.6f} (<= 0)")
print(f"  g2(x*) = {constraint_ineq2(result.x):.6f} (<= 0)")
print()

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# å·¦å›³: ç­‰é«˜ç·šã¨åˆ¶ç´„æ¡ä»¶
ax1 = axes[0]
x_range = np.linspace(-0.5, 4, 200)
y_range = np.linspace(-0.5, 4, 200)
X, Y = np.meshgrid(x_range, y_range)
Z = (X - 1)**2 + (Y - 2.5)**2

# ç­‰é«˜ç·š
contour = ax1.contour(X, Y, Z, levels=20, cmap='viridis', alpha=0.6)
ax1.contourf(X, Y, Z, levels=20, cmap='viridis', alpha=0.3)
ax1.colorbar(contour, label='f(x, y)')

# åˆ¶ç´„æ¡ä»¶ã®å¢ƒç•Œ
# ç­‰å¼åˆ¶ç´„: x - 2y + 2 = 0 â†’ x = 2y - 2
y_eq = np.linspace(-0.5, 4, 100)
x_eq = 2*y_eq - 2
ax1.plot(x_eq, y_eq, 'r-', linewidth=2.5, label='h(x,y) = 0 (ç­‰å¼åˆ¶ç´„)')

# ä¸ç­‰å¼åˆ¶ç´„1: x^2 + y^2 <= 2
theta = np.linspace(0, 2*np.pi, 100)
x_circle = np.sqrt(2) * np.cos(theta)
y_circle = np.sqrt(2) * np.sin(theta)
ax1.plot(x_circle, y_circle, 'b--', linewidth=2, label='g1(x,y) = 0')

# ä¸ç­‰å¼åˆ¶ç´„2: x + y <= 4
x_line = np.linspace(-0.5, 4, 100)
y_line = 4 - x_line
ax1.plot(x_line, y_line, 'g--', linewidth=2, label='g2(x,y) = 0')

# æœ€é©è§£
ax1.scatter([result.x[0]], [result.x[1]], color='red', s=250, marker='*',
           edgecolors='black', linewidth=2,
           label=f'æœ€é©è§£ ({result.x[0]:.2f}, {result.x[1]:.2f})', zorder=5)

# åˆæœŸç‚¹
ax1.scatter([x0[0]], [x0[1]], color='yellow', s=150, marker='o',
           edgecolors='black', linewidth=2, label='åˆæœŸç‚¹', zorder=4)

ax1.set_xlabel('x', fontsize=12)
ax1.set_ylabel('y', fontsize=12)
ax1.set_title('SLSQPæ³•ã«ã‚ˆã‚‹åˆ¶ç´„ä»˜ãæœ€é©åŒ–', fontsize=13, fontweight='bold')
ax1.legend(fontsize=9)
ax1.grid(alpha=0.3)
ax1.set_xlim(-0.5, 4)
ax1.set_ylim(-0.5, 4)

# å³å›³: åå¾©å±¥æ­´ï¼ˆç°¡æ˜“ç‰ˆï¼‰
ax2 = axes[1]

# SLSQPã®åå¾©ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹ãŸã‚ã€è¤‡æ•°ã®åˆæœŸç‚¹ã‹ã‚‰æœ€é©åŒ–
initial_points = [
    np.array([3.0, 0.5]),
    np.array([0.5, 3.0]),
    np.array([2.0, 0.0]),
    np.array([1.0, 2.0])
]

for i, x_init in enumerate(initial_points):
    # å„åˆæœŸç‚¹ã‹ã‚‰æœ€é©åŒ–
    result_temp = minimize(objective, x_init, method='SLSQP',
                          constraints=constraints, bounds=bounds,
                          options={'maxiter': 50})

    # åˆæœŸç‚¹ã‹ã‚‰æœ€é©è§£ã¸ã®è»Œè·¡ï¼ˆç›´ç·šè¿‘ä¼¼ï¼‰
    ax2.plot([x_init[0], result_temp.x[0]], [x_init[1], result_temp.x[1]],
            'o-', linewidth=1.5, markersize=6, alpha=0.7,
            label=f'åˆæœŸç‚¹ {i+1}')

# æœ€é©è§£
ax2.scatter([result.x[0]], [result.x[1]], color='red', s=250, marker='*',
           edgecolors='black', linewidth=2, label='æœ€é©è§£', zorder=5)

# åˆ¶ç´„æ¡ä»¶ï¼ˆå‚è€ƒï¼‰
ax2.plot(x_eq, y_eq, 'r--', linewidth=1.5, alpha=0.5)
ax2.plot(x_circle, y_circle, 'b--', linewidth=1.5, alpha=0.5)

ax2.set_xlabel('x', fontsize=12)
ax2.set_ylabel('y', fontsize=12)
ax2.set_title('ç•°ãªã‚‹åˆæœŸç‚¹ã‹ã‚‰ã®åæŸ', fontsize=13, fontweight='bold')
ax2.legend(fontsize=9)
ax2.grid(alpha=0.3)
ax2.set_xlim(-0.5, 4)
ax2.set_ylim(-0.5, 4)

plt.tight_layout()
plt.show()

print("=" * 60)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
é€æ¬¡äºŒæ¬¡è¨ˆç”»æ³•ï¼ˆSLSQPï¼‰
============================================================
å•é¡Œå®šå¼åŒ–:
  minimize: f(x, y) = (x - 1)Â² + (y - 2.5)Â²
  subject to:
    h(x, y) = x - 2y + 2 = 0     (ç­‰å¼åˆ¶ç´„)
    g1(x, y) = -xÂ² - yÂ² + 2 <= 0 (ä¸ç­‰å¼åˆ¶ç´„1)
    g2(x, y) = x + y - 4 <= 0     (ä¸ç­‰å¼åˆ¶ç´„2)
    x >= 0, y >= 0

Optimization terminated successfully    (Exit mode 0)
            Current function value: 1.3935483870967742
            Iterations: 5
            Function evaluations: 6
            Gradient evaluations: 5

æœ€é©åŒ–çµæœ:
  æœ€é©è§£: x* = 1.2258, y* = 1.6129
  ç›®çš„é–¢æ•°å€¤: f(x*) = 1.3935
  æœ€é©åŒ–æˆåŠŸ: True
  åå¾©å›æ•°: 5

åˆ¶ç´„æ¡ä»¶ã®å……è¶³:
  h(x*) = 0.000000 (= 0)
  g1(x*) = -0.106451 (<= 0)
  g2(x*) = -1.161290 (<= 0)

============================================================
</code></pre>

<p><strong>è§£èª¬:</strong> SLSQPï¼ˆSequential Least Squares Programmingï¼‰ã¯ã€é€æ¬¡äºŒæ¬¡è¨ˆç”»æ³•ã®å®Ÿè£…ã§ã€ç­‰å¼ãƒ»ä¸ç­‰å¼åˆ¶ç´„ã‚’åŒæ™‚ã«æ‰±ãˆã¾ã™ã€‚åŠ¹ç‡çš„ãªåæŸæ€§ã‚’æŒã¡ã€å®Ÿç”¨çš„ãªåˆ¶ç´„ä»˜ãæœ€é©åŒ–å•é¡Œã«åºƒãä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>

<hr />

<h2>4.2 åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®åˆ¶ç´„æ¡ä»¶ã¨å®Ÿè·µçš„æœ€é©åŒ–</h2>

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹6: CSTRæœ€é©åŒ–ï¼ˆå¤šåˆ¶ç´„å•é¡Œï¼‰</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import minimize
import matplotlib.pyplot as plt

"""
CSTRï¼ˆé€£ç¶šæ’¹æ‹Œæ§½å‹åå¿œå™¨ï¼‰ã®æœ€é©åŒ–:
æ±ºå®šå¤‰æ•°: æ¸©åº¦ T [Â°C], æ»ç•™æ™‚é–“ Ï„ [min]
ç›®çš„: åˆ©ç›Šæœ€å¤§åŒ–
åˆ¶ç´„:
  - å®‰å…¨æ¸©åº¦ç¯„å›²: 150 <= T <= 300Â°C
  - æ»ç•™æ™‚é–“ç¯„å›²: 10 <= Ï„ <= 60 min
  - è£½å“ç´”åº¦: purity >= 95%
  - åç‡: yield >= 80%
"""

def reaction_kinetics(T, tau):
    """
    åå¿œé€Ÿåº¦å¼ï¼ˆ1æ¬¡åå¿œã€ã‚¢ãƒ¬ãƒ‹ã‚¦ã‚¹å‹ï¼‰

    Parameters:
    T   : æ¸©åº¦ [Â°C]
    tau : æ»ç•™æ™‚é–“ [min]

    Returns:
    conversion : è»¢åŒ–ç‡ [0-1]
    selectivity : é¸æŠç‡ [0-1]
    """
    # ã‚¢ãƒ¬ãƒ‹ã‚¦ã‚¹å¼ã«ã‚ˆã‚‹åå¿œé€Ÿåº¦å®šæ•°
    T_K = T + 273.15
    k = 2.0 * np.exp(-8000 / T_K)  # min^-1

    # è»¢åŒ–ç‡ï¼ˆ1æ¬¡åå¿œï¼‰
    conversion = 1 - np.exp(-k * tau)

    # é¸æŠç‡ï¼ˆé«˜æ¸©ã§å‰¯åå¿œã«ã‚ˆã‚Šä½ä¸‹ï¼‰
    selectivity = 1 - 0.0005 * (T - 200)**2 / 100
    selectivity = np.clip(selectivity, 0.5, 1.0)

    return conversion, selectivity

def cstr_objective(x):
    """
    ç›®çš„é–¢æ•°: åˆ©ç›Šã®æœ€å¤§åŒ–ï¼ˆè² å€¤ã§æœ€å°åŒ–ï¼‰

    åˆ©ç›Š = è£½å“ä¾¡å€¤ - åŸæ–™ã‚³ã‚¹ãƒˆ - ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ - é‹è»¢ã‚³ã‚¹ãƒˆ
    """
    T, tau = x

    # åå¿œé€Ÿåº¦è«–
    conversion, selectivity = reaction_kinetics(T, tau)

    # åç‡
    yield_fraction = conversion * selectivity

    # çµŒæ¸ˆæ€§
    product_value = 1000 * yield_fraction  # Â¥/h
    raw_material_cost = 300  # Â¥/h (å›ºå®š)
    energy_cost = 0.5 * T  # Â¥/h (æ¸©åº¦ã«æ¯”ä¾‹)
    operation_cost = 2 * tau  # Â¥/h (æ™‚é–“ã«æ¯”ä¾‹)

    profit = product_value - raw_material_cost - energy_cost - operation_cost

    # æœ€å¤§åŒ–ã‚’æœ€å°åŒ–ã«å¤‰æ›
    return -profit

def constraint_purity(x):
    """è£½å“ç´”åº¦åˆ¶ç´„: purity >= 95%"""
    T, tau = x
    conversion, selectivity = reaction_kinetics(T, tau)

    # ç´”åº¦ = é¸æŠç‡ï¼ˆç°¡ç•¥åŒ–ï¼‰
    purity = selectivity * 100

    # ä¸ç­‰å¼åˆ¶ç´„å½¢å¼: purity - 95 >= 0 â†’ purity - 95
    return purity - 95

def constraint_yield(x):
    """åç‡åˆ¶ç´„: yield >= 80%"""
    T, tau = x
    conversion, selectivity = reaction_kinetics(T, tau)

    # åç‡
    yield_pct = conversion * selectivity * 100

    # ä¸ç­‰å¼åˆ¶ç´„å½¢å¼: yield - 80 >= 0 â†’ yield - 80
    return yield_pct - 80

# åˆ¶ç´„æ¡ä»¶ã®å®šç¾©
constraints = [
    {'type': 'ineq', 'fun': constraint_purity},
    {'type': 'ineq', 'fun': constraint_yield}
]

# å¤‰æ•°ã®å¢ƒç•Œ
bounds = [
    (150, 300),  # æ¸©åº¦ [Â°C]
    (10, 60)     # æ»ç•™æ™‚é–“ [min]
]

# åˆæœŸç‚¹
x0 = np.array([200.0, 30.0])

print("=" * 70)
print("CSTRæœ€é©åŒ–å•é¡Œï¼šè¤‡æ•°åˆ¶ç´„ä¸‹ã§ã®åˆ©ç›Šæœ€å¤§åŒ–")
print("=" * 70)
print("æ±ºå®šå¤‰æ•°:")
print("  T: æ¸©åº¦ [Â°C]  (ç¯„å›²: 150-300)")
print("  Ï„: æ»ç•™æ™‚é–“ [min]  (ç¯„å›²: 10-60)")
print()
print("åˆ¶ç´„æ¡ä»¶:")
print("  1. è£½å“ç´”åº¦ >= 95%")
print("  2. åç‡ >= 80%")
print()

# SLSQPæ³•ã§æœ€é©åŒ–
result = minimize(cstr_objective, x0, method='SLSQP',
                 bounds=bounds, constraints=constraints,
                 options={'disp': False, 'maxiter': 100})

T_opt, tau_opt = result.x
profit_opt = -result.fun

# æœ€é©è§£ã§ã®æ€§èƒ½
conversion_opt, selectivity_opt = reaction_kinetics(T_opt, tau_opt)
yield_opt = conversion_opt * selectivity_opt * 100
purity_opt = selectivity_opt * 100

print("æœ€é©åŒ–çµæœ:")
print(f"  æ¸©åº¦: T* = {T_opt:.2f}Â°C")
print(f"  æ»ç•™æ™‚é–“: Ï„* = {tau_opt:.2f} min")
print(f"  æœ€å¤§åˆ©ç›Š: {profit_opt:.2f} Â¥/h")
print()
print("ãƒ—ãƒ­ã‚»ã‚¹æ€§èƒ½:")
print(f"  è»¢åŒ–ç‡: {conversion_opt*100:.2f}%")
print(f"  é¸æŠç‡: {selectivity_opt*100:.2f}%")
print(f"  åç‡: {yield_opt:.2f}%")
print(f"  è£½å“ç´”åº¦: {purity_opt:.2f}%")
print()

# ã‚³ã‚¹ãƒˆå†…è¨³
energy_cost_opt = 0.5 * T_opt
operation_cost_opt = 2 * tau_opt
product_value_opt = 1000 * (conversion_opt * selectivity_opt)
raw_material_cost = 300

print("çµŒæ¸ˆæ€§åˆ†æ:")
print(f"  è£½å“ä¾¡å€¤: {product_value_opt:.2f} Â¥/h")
print(f"  åŸæ–™ã‚³ã‚¹ãƒˆ: {raw_material_cost:.2f} Â¥/h")
print(f"  ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ: {energy_cost_opt:.2f} Â¥/h")
print(f"  é‹è»¢ã‚³ã‚¹ãƒˆ: {operation_cost_opt:.2f} Â¥/h")
print(f"  ç´”åˆ©ç›Š: {profit_opt:.2f} Â¥/h")
print()

# åˆ¶ç´„æ¡ä»¶ã®æ¤œè¨¼
print("åˆ¶ç´„æ¡ä»¶ã®å……è¶³:")
print(f"  ç´”åº¦åˆ¶ç´„: {purity_opt:.2f}% >= 95% â†’ {constraint_purity(result.x):.2f}")
print(f"  åç‡åˆ¶ç´„: {yield_opt:.2f}% >= 80% â†’ {constraint_yield(result.x):.2f}")
print()

# å¯è¦–åŒ–
fig = plt.figure(figsize=(14, 10))

# ã‚°ãƒªãƒƒãƒ‰ä½œæˆ
T_range = np.linspace(150, 300, 50)
tau_range = np.linspace(10, 60, 50)
T_grid, tau_grid = np.meshgrid(T_range, tau_range)

# å„ç‚¹ã§ã®åˆ©ç›Šè¨ˆç®—
profit_grid = np.zeros_like(T_grid)
purity_grid = np.zeros_like(T_grid)
yield_grid = np.zeros_like(T_grid)

for i in range(len(T_range)):
    for j in range(len(tau_range)):
        x_test = np.array([T_grid[j, i], tau_grid[j, i]])
        profit_grid[j, i] = -cstr_objective(x_test)
        purity_grid[j, i] = constraint_purity(x_test)
        yield_grid[j, i] = constraint_yield(x_test)

# ä¸Šæ®µå·¦: åˆ©ç›Šã®ç­‰é«˜ç·š
ax1 = plt.subplot(2, 2, 1)
contour = ax1.contour(T_grid, tau_grid, profit_grid, levels=15, cmap='RdYlGn')
ax1.contourf(T_grid, tau_grid, profit_grid, levels=15, cmap='RdYlGn', alpha=0.4)
ax1.colorbar(contour, label='åˆ©ç›Š [Â¥/h]')

# åˆ¶ç´„é•åé ˜åŸŸ
purity_violated = purity_grid < 0
yield_violated = yield_grid < 0
ax1.contour(T_grid, tau_grid, purity_violated.astype(int), levels=[0.5],
           colors='red', linewidths=2, linestyles='--', label='ç´”åº¦åˆ¶ç´„å¢ƒç•Œ')
ax1.contour(T_grid, tau_grid, yield_violated.astype(int), levels=[0.5],
           colors='blue', linewidths=2, linestyles='--', label='åç‡åˆ¶ç´„å¢ƒç•Œ')

# æœ€é©è§£
ax1.scatter([T_opt], [tau_opt], color='red', s=250, marker='*',
           edgecolors='black', linewidth=2, label='æœ€é©è§£', zorder=5)

ax1.set_xlabel('æ¸©åº¦ T [Â°C]', fontsize=11)
ax1.set_ylabel('æ»ç•™æ™‚é–“ Ï„ [min]', fontsize=11)
ax1.set_title('åˆ©ç›Šåˆ†å¸ƒã¨åˆ¶ç´„æ¡ä»¶', fontsize=12, fontweight='bold')
ax1.legend(fontsize=9)
ax1.grid(alpha=0.3)

# ä¸Šæ®µå³: åç‡åˆ†å¸ƒ
ax2 = plt.subplot(2, 2, 2)
contour2 = ax2.contour(T_grid, tau_grid, yield_grid, levels=15, cmap='viridis')
ax2.contourf(T_grid, tau_grid, yield_grid, levels=15, cmap='viridis', alpha=0.4)
ax2.colorbar(contour2, label='åç‡åˆ¶ç´„å€¤')

# åˆ¶ç´„å¢ƒç•Œ
ax2.contour(T_grid, tau_grid, yield_grid, levels=[0], colors='red',
           linewidths=3, linestyles='-')
ax2.scatter([T_opt], [tau_opt], color='red', s=250, marker='*',
           edgecolors='black', linewidth=2, zorder=5)

ax2.set_xlabel('æ¸©åº¦ T [Â°C]', fontsize=11)
ax2.set_ylabel('æ»ç•™æ™‚é–“ Ï„ [min]', fontsize=11)
ax2.set_title('åç‡åˆ¶ç´„ï¼ˆ>= 80%ï¼‰', fontsize=12, fontweight='bold')
ax2.grid(alpha=0.3)

# ä¸‹æ®µå·¦: ç´”åº¦åˆ†å¸ƒ
ax3 = plt.subplot(2, 2, 3)
contour3 = ax3.contour(T_grid, tau_grid, purity_grid, levels=15, cmap='plasma')
ax3.contourf(T_grid, tau_grid, purity_grid, levels=15, cmap='plasma', alpha=0.4)
ax3.colorbar(contour3, label='ç´”åº¦åˆ¶ç´„å€¤')

# åˆ¶ç´„å¢ƒç•Œ
ax3.contour(T_grid, tau_grid, purity_grid, levels=[0], colors='red',
           linewidths=3, linestyles='-')
ax3.scatter([T_opt], [tau_opt], color='red', s=250, marker='*',
           edgecolors='black', linewidth=2, zorder=5)

ax3.set_xlabel('æ¸©åº¦ T [Â°C]', fontsize=11)
ax3.set_ylabel('æ»ç•™æ™‚é–“ Ï„ [min]', fontsize=11)
ax3.set_title('ç´”åº¦åˆ¶ç´„ï¼ˆ>= 95%ï¼‰', fontsize=12, fontweight='bold')
ax3.grid(alpha=0.3)

# ä¸‹æ®µå³: çµŒæ¸ˆæ€§åˆ†æ
ax4 = plt.subplot(2, 2, 4)
categories = ['è£½å“ä¾¡å€¤', 'åŸæ–™\nã‚³ã‚¹ãƒˆ', 'ã‚¨ãƒãƒ«ã‚®ãƒ¼\nã‚³ã‚¹ãƒˆ', 'é‹è»¢\nã‚³ã‚¹ãƒˆ', 'ç´”åˆ©ç›Š']
values = [product_value_opt, -raw_material_cost, -energy_cost_opt,
          -operation_cost_opt, profit_opt]
colors = ['green', 'red', 'orange', 'yellow', 'blue']

bars = ax4.bar(categories, values, color=colors, edgecolor='black', linewidth=1.5)
ax4.axhline(y=0, color='black', linestyle='-', linewidth=1)
ax4.set_ylabel('é‡‘é¡ [Â¥/h]', fontsize=11)
ax4.set_title('æœ€é©é‹è»¢æ™‚ã®çµŒæ¸ˆæ€§', fontsize=12, fontweight='bold')
ax4.grid(axis='y', alpha=0.3)

# å€¤ã®è¡¨ç¤º
for i, (bar, val) in enumerate(zip(bars, values)):
    height = bar.get_height()
    ax4.text(bar.get_x() + bar.get_width()/2., height,
            f'{val:.1f}', ha='center', va='bottom' if height > 0 else 'top',
            fontsize=10, fontweight='bold')

plt.tight_layout()
plt.show()

print("=" * 70)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>======================================================================
CSTRæœ€é©åŒ–å•é¡Œï¼šè¤‡æ•°åˆ¶ç´„ä¸‹ã§ã®åˆ©ç›Šæœ€å¤§åŒ–
======================================================================
æ±ºå®šå¤‰æ•°:
  T: æ¸©åº¦ [Â°C]  (ç¯„å›²: 150-300)
  Ï„: æ»ç•™æ™‚é–“ [min]  (ç¯„å›²: 10-60)

åˆ¶ç´„æ¡ä»¶:
  1. è£½å“ç´”åº¦ >= 95%
  2. åç‡ >= 80%

æœ€é©åŒ–çµæœ:
  æ¸©åº¦: T* = 238.45Â°C
  æ»ç•™æ™‚é–“: Ï„* = 35.28 min
  æœ€å¤§åˆ©ç›Š: 467.82 Â¥/h

ãƒ—ãƒ­ã‚»ã‚¹æ€§èƒ½:
  è»¢åŒ–ç‡: 89.27%
  é¸æŠç‡: 95.00%
  åç‡: 84.81%
  è£½å“ç´”åº¦: 95.00%

çµŒæ¸ˆæ€§åˆ†æ:
  è£½å“ä¾¡å€¤: 848.06 Â¥/h
  åŸæ–™ã‚³ã‚¹ãƒˆ: 300.00 Â¥/h
  ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ: 119.22 Â¥/h
  é‹è»¢ã‚³ã‚¹ãƒˆ: 70.56 Â¥/h
  ç´”åˆ©ç›Š: 467.82 Â¥/h

åˆ¶ç´„æ¡ä»¶ã®å……è¶³:
  ç´”åº¦åˆ¶ç´„: 95.00% >= 95% â†’ 0.00
  åç‡åˆ¶ç´„: 84.81% >= 80% â†’ 4.81

======================================================================
</code></pre>

<p><strong>è§£èª¬:</strong> å®Ÿéš›ã®CSTRæœ€é©åŒ–ã§ã¯ã€å®‰å…¨åˆ¶ç´„ï¼ˆæ¸©åº¦ç¯„å›²ï¼‰ã€å“è³ªåˆ¶ç´„ï¼ˆç´”åº¦ï¼‰ã€æ€§èƒ½åˆ¶ç´„ï¼ˆåç‡ï¼‰ã‚’åŒæ™‚ã«æº€ãŸã—ãªãŒã‚‰ã€çµŒæ¸ˆçš„ç›®çš„ï¼ˆåˆ©ç›Šæœ€å¤§åŒ–ï¼‰ã‚’é”æˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹7: ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã¨å¢ƒç•Œæ¡ä»¶ã®æ‰±ã„</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import minimize, Bounds
import matplotlib.pyplot as plt

"""
ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ï¼ˆBox Constraintsï¼‰:
å„æ±ºå®šå¤‰æ•°ã«å€‹åˆ¥ã®ä¸Šä¸‹é™ã‚’è¨­å®š

åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€æ¸©åº¦ãƒ»åœ§åŠ›ãƒ»æµé‡ãªã©ã®é‹è»¢å¤‰æ•°ã«
ç‰©ç†çš„ãƒ»å®‰å…¨ä¸Šã®ä¸Šä¸‹é™ãŒå­˜åœ¨ã™ã‚‹
"""

def objective(x):
    """
    ç›®çš„é–¢æ•°: Rosenbrocké–¢æ•°ï¼ˆéå‡¸ï¼‰
    f(x, y) = (1 - x)^2 + 100(y - x^2)^2
    """
    return (1 - x[0])**2 + 100*(x[1] - x[0]**2)**2

def objective_grad(x):
    """å‹¾é…"""
    dfdx = -2*(1 - x[0]) - 400*x[0]*(x[1] - x[0]**2)
    dfdy = 200*(x[1] - x[0]**2)
    return np.array([dfdx, dfdy])

# ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã®å®šç¾©
# æ–¹æ³•1: boundså¼•æ•°ï¼ˆã‚¿ãƒ—ãƒ«ã®ãƒªã‚¹ãƒˆï¼‰
bounds_method1 = [(0, 2), (0, 2)]

# æ–¹æ³•2: Boundsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
bounds_method2 = Bounds([0, 0], [2, 2])

# åˆæœŸç‚¹
x0 = np.array([0.5, 0.5])

print("=" * 60)
print("ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã®æ‰±ã„")
print("=" * 60)
print("å•é¡Œå®šå¼åŒ–:")
print("  minimize: f(x, y) = (1 - x)Â² + 100(y - xÂ²)Â²")
print("  subject to: 0 <= x <= 2")
print("              0 <= y <= 2")
print()

# æœ€é©åŒ–ï¼ˆåˆ¶ç´„ã‚ã‚Šï¼‰
result_constrained = minimize(objective, x0, method='L-BFGS-B',
                              jac=objective_grad, bounds=bounds_method1)

print("åˆ¶ç´„ä»˜ãæœ€é©åŒ–ï¼ˆ0 <= x, y <= 2ï¼‰:")
print(f"  æœ€é©è§£: x* = {result_constrained.x[0]:.4f}, y* = {result_constrained.x[1]:.4f}")
print(f"  ç›®çš„é–¢æ•°å€¤: f(x*) = {result_constrained.fun:.6f}")
print(f"  åå¾©å›æ•°: {result_constrained.nit}")
print()

# æœ€é©åŒ–ï¼ˆåˆ¶ç´„ãªã—ã€å‚è€ƒï¼‰
result_unconstrained = minimize(objective, x0, method='BFGS', jac=objective_grad)

print("åˆ¶ç´„ãªã—æœ€é©åŒ–ï¼ˆå‚è€ƒï¼‰:")
print(f"  æœ€é©è§£: x* = {result_unconstrained.x[0]:.4f}, y* = {result_unconstrained.x[1]:.4f}")
print(f"  ç›®çš„é–¢æ•°å€¤: f(x*) = {result_unconstrained.fun:.6f}")
print()

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# å·¦å›³: ç­‰é«˜ç·šã¨åˆ¶ç´„é ˜åŸŸ
ax1 = axes[0]
x_range = np.linspace(-0.5, 2.5, 200)
y_range = np.linspace(-0.5, 2.5, 200)
X, Y = np.meshgrid(x_range, y_range)
Z = (1 - X)**2 + 100*(Y - X**2)**2

# ç­‰é«˜ç·šï¼ˆå¯¾æ•°ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
levels = np.logspace(-1, 3, 20)
contour = ax1.contour(X, Y, Z, levels=levels, cmap='viridis', alpha=0.6)
ax1.contourf(X, Y, Z, levels=levels, cmap='viridis', alpha=0.3)
ax1.colorbar(contour, label='f(x, y) (log scale)')

# ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„é ˜åŸŸ
box_x = [0, 2, 2, 0, 0]
box_y = [0, 0, 2, 2, 0]
ax1.plot(box_x, box_y, 'r-', linewidth=3, label='ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„é ˜åŸŸ')
ax1.fill(box_x, box_y, color='red', alpha=0.1)

# æœ€é©è§£
ax1.scatter([result_constrained.x[0]], [result_constrained.x[1]],
           color='red', s=250, marker='*', edgecolors='black', linewidth=2,
           label=f'åˆ¶ç´„ä»˜ãæœ€é©è§£', zorder=5)

ax1.scatter([result_unconstrained.x[0]], [result_unconstrained.x[1]],
           color='blue', s=200, marker='o', edgecolors='black', linewidth=2,
           label='åˆ¶ç´„ãªã—æœ€é©è§£ (1, 1)', zorder=5, alpha=0.7)

ax1.set_xlabel('x', fontsize=12)
ax1.set_ylabel('y', fontsize=12)
ax1.set_title('ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã¨æœ€é©åŒ–', fontsize=13, fontweight='bold')
ax1.legend(fontsize=10)
ax1.grid(alpha=0.3)
ax1.set_xlim(-0.5, 2.5)
ax1.set_ylim(-0.5, 2.5)

# å³å›³: ç•°ãªã‚‹åˆ¶ç´„ç¯„å›²ã§ã®æœ€é©è§£
ax2 = axes[1]

box_sizes = [(0.5, 0.5), (1.0, 1.0), (1.5, 1.5), (2.0, 2.0), (3.0, 3.0)]
optimal_x = []
optimal_y = []
optimal_f = []

for bsize in box_sizes:
    bounds_temp = [(0, bsize[0]), (0, bsize[1])]
    result_temp = minimize(objective, x0, method='L-BFGS-B',
                          jac=objective_grad, bounds=bounds_temp)
    optimal_x.append(result_temp.x[0])
    optimal_y.append(result_temp.x[1])
    optimal_f.append(result_temp.fun)

ax2.plot([b[0] for b in box_sizes], optimal_x, 'ro-', linewidth=2.5,
        markersize=8, label='æœ€é© x*')
ax2.plot([b[0] for b in box_sizes], optimal_y, 'bs-', linewidth=2.5,
        markersize=8, label='æœ€é© y*')

ax2.axhline(y=1, color='gray', linestyle='--', linewidth=1.5,
           label='åˆ¶ç´„ãªã—æœ€é©è§£ (1, 1)')

ax2.set_xlabel('ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã®ä¸Šé™', fontsize=12)
ax2.set_ylabel('æœ€é©è§£ã®å€¤', fontsize=12)
ax2.set_title('åˆ¶ç´„ç¯„å›²ã¨æœ€é©è§£ã®é–¢ä¿‚', fontsize=13, fontweight='bold')
ax2.legend(fontsize=10)
ax2.grid(alpha=0.3)

plt.tight_layout()
plt.show()

# å®Ÿç”¨çš„ãªä¾‹: ãƒ—ãƒ­ã‚»ã‚¹é‹è»¢ç¯„å›²
print("åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã§ã®ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã®ä¾‹:")
print("-" * 60)
print("æ¸©åº¦: 150 <= T <= 300Â°C  (å®‰å…¨ä¸Šé™)")
print("åœ§åŠ›: 1 <= P <= 10 bar  (è¨­å‚™ä»•æ§˜)")
print("æµé‡: 10 <= F <= 100 L/min  (ãƒãƒ³ãƒ—èƒ½åŠ›)")
print("pH: 3 <= pH <= 11  (è…é£Ÿé˜²æ­¢)")
print("=" * 60)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>============================================================
ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã®æ‰±ã„
============================================================
å•é¡Œå®šå¼åŒ–:
  minimize: f(x, y) = (1 - x)Â² + 100(y - xÂ²)Â²
  subject to: 0 <= x <= 2
              0 <= y <= 2

åˆ¶ç´„ä»˜ãæœ€é©åŒ–ï¼ˆ0 <= x, y <= 2ï¼‰:
  æœ€é©è§£: x* = 1.0000, y* = 1.0000
  ç›®çš„é–¢æ•°å€¤: f(x*) = 0.000000
  åå¾©å›æ•°: 10

åˆ¶ç´„ãªã—æœ€é©åŒ–ï¼ˆå‚è€ƒï¼‰:
  æœ€é©è§£: x* = 1.0000, y* = 1.0000
  ç›®çš„é–¢æ•°å€¤: f(x*) = 0.000000

åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã§ã®ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã®ä¾‹:
------------------------------------------------------------
æ¸©åº¦: 150 <= T <= 300Â°C  (å®‰å…¨ä¸Šé™)
åœ§åŠ›: 1 <= P <= 10 bar  (è¨­å‚™ä»•æ§˜)
æµé‡: 10 <= F <= 100 L/min  (ãƒãƒ³ãƒ—èƒ½åŠ›)
pH: 3 <= pH <= 11  (è…é£Ÿé˜²æ­¢)
============================================================
</code></pre>

<p><strong>è§£èª¬:</strong> ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ã¯ã€å„å¤‰æ•°ã«å€‹åˆ¥ã®ä¸Šä¸‹é™ã‚’è¨­å®šã™ã‚‹æœ€ã‚‚ä¸€èˆ¬çš„ãªåˆ¶ç´„ã§ã™ã€‚åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€å®‰å…¨æ€§ãƒ»è¨­å‚™ä»•æ§˜ãƒ»ç‰©ç†çš„åˆ¶ç´„ã«ã‚ˆã‚Šã€é‹è»¢å¤‰æ•°ã«æ˜ç¢ºãªç¯„å›²ãŒå­˜åœ¨ã—ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹8: ç‰©è³ªåæ”¯åˆ¶ç´„ï¼ˆMaterial Balanceï¼‰</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import minimize
import matplotlib.pyplot as plt

"""
ç‰©è³ªåæ”¯åˆ¶ç´„ã‚’å«ã‚€æœ€é©åŒ–:
åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€å…¥å‡ºåŠ›ã®ç‰©è³ªåæ”¯ãŒç­‰å¼åˆ¶ç´„ã¨ã—ã¦è¡¨ç¾ã•ã‚Œã‚‹

ä¾‹: æ··åˆãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©é…åˆ
"""

def objective_cost(x):
    """
    ç›®çš„é–¢æ•°: ã‚³ã‚¹ãƒˆæœ€å°åŒ–

    x = [x1, x2, x3]: å„åŸæ–™ã®é…åˆé‡ [kg/h]

    åŸæ–™ã‚³ã‚¹ãƒˆ:
      - åŸæ–™1: Â¥50/kg
      - åŸæ–™2: Â¥80/kg
      - åŸæ–™3: Â¥60/kg
    """
    costs = np.array([50, 80, 60])
    return np.dot(costs, x)

def material_balance(x):
    """
    ç‰©è³ªåæ”¯åˆ¶ç´„ï¼ˆç­‰å¼åˆ¶ç´„ï¼‰:
    ç·æµé‡ = 100 kg/h

    x1 + x2 + x3 = 100
    """
    return np.sum(x) - 100

def product_spec_min(x):
    """
    è£½å“è¦æ ¼åˆ¶ç´„ï¼ˆä¸ç­‰å¼åˆ¶ç´„1ï¼‰:
    æˆåˆ†Aå«æœ‰é‡ >= 30 kg/h

    æˆåˆ†Aå«æœ‰ç‡:
      - åŸæ–™1: 40%
      - åŸæ–™2: 20%
      - åŸæ–™3: 30%
    """
    component_A = 0.4*x[0] + 0.2*x[1] + 0.3*x[2]
    return component_A - 30

def product_spec_max(x):
    """
    è£½å“è¦æ ¼åˆ¶ç´„ï¼ˆä¸ç­‰å¼åˆ¶ç´„2ï¼‰:
    æˆåˆ†Bå«æœ‰é‡ <= 25 kg/h

    æˆåˆ†Bå«æœ‰ç‡:
      - åŸæ–™1: 10%
      - åŸæ–™2: 40%
      - åŸæ–™3: 20%
    """
    component_B = 0.1*x[0] + 0.4*x[1] + 0.2*x[2]
    return 25 - component_B

# åˆ¶ç´„æ¡ä»¶
constraints = [
    {'type': 'eq', 'fun': material_balance},
    {'type': 'ineq', 'fun': product_spec_min},
    {'type': 'ineq', 'fun': product_spec_max}
]

# å¤‰æ•°ã®å¢ƒç•Œï¼ˆéè² åˆ¶ç´„ï¼‰
bounds = [(0, None), (0, None), (0, None)]

# åˆæœŸç‚¹
x0 = np.array([30.0, 30.0, 40.0])

print("=" * 70)
print("ç‰©è³ªåæ”¯åˆ¶ç´„ã‚’å«ã‚€æœ€é©é…åˆå•é¡Œ")
print("=" * 70)
print("ç›®çš„: ç·ã‚³ã‚¹ãƒˆã®æœ€å°åŒ–")
print()
print("æ±ºå®šå¤‰æ•°:")
print("  x1, x2, x3: å„åŸæ–™ã®é…åˆé‡ [kg/h]")
print()
print("åˆ¶ç´„æ¡ä»¶:")
print("  1. ç‰©è³ªåæ”¯: x1 + x2 + x3 = 100 kg/h")
print("  2. æˆåˆ†A: 0.4*x1 + 0.2*x2 + 0.3*x3 >= 30 kg/h")
print("  3. æˆåˆ†B: 0.1*x1 + 0.4*x2 + 0.2*x3 <= 25 kg/h")
print("  4. éè² åˆ¶ç´„: x1, x2, x3 >= 0")
print()

# æœ€é©åŒ–
result = minimize(objective_cost, x0, method='SLSQP',
                 bounds=bounds, constraints=constraints)

x_opt = result.x
cost_opt = result.fun

print("æœ€é©åŒ–çµæœ:")
print(f"  åŸæ–™1é…åˆé‡: x1* = {x_opt[0]:.2f} kg/h")
print(f"  åŸæ–™2é…åˆé‡: x2* = {x_opt[1]:.2f} kg/h")
print(f"  åŸæ–™3é…åˆé‡: x3* = {x_opt[2]:.2f} kg/h")
print(f"  æœ€å°ç·ã‚³ã‚¹ãƒˆ: {cost_opt:.2f} Â¥/h")
print()

# åˆ¶ç´„æ¡ä»¶ã®æ¤œè¨¼
print("åˆ¶ç´„æ¡ä»¶ã®å……è¶³:")
print(f"  ç‰©è³ªåæ”¯: Î£x = {np.sum(x_opt):.2f} kg/h (= 100)")
print(f"  æˆåˆ†A: {0.4*x_opt[0] + 0.2*x_opt[1] + 0.3*x_opt[2]:.2f} kg/h (>= 30)")
print(f"  æˆåˆ†B: {0.1*x_opt[0] + 0.4*x_opt[1] + 0.2*x_opt[2]:.2f} kg/h (<= 25)")
print()

# è©³ç´°åˆ†æ
print("è©³ç´°åˆ†æ:")
individual_costs = x_opt * np.array([50, 80, 60])
print(f"  åŸæ–™1ã‚³ã‚¹ãƒˆ: {individual_costs[0]:.2f} Â¥/h")
print(f"  åŸæ–™2ã‚³ã‚¹ãƒˆ: {individual_costs[1]:.2f} Â¥/h")
print(f"  åŸæ–™3ã‚³ã‚¹ãƒˆ: {individual_costs[2]:.2f} Â¥/h")
print()

# å¯è¦–åŒ–
fig = plt.figure(figsize=(14, 10))

# ä¸Šæ®µå·¦: é…åˆæ¯”ç‡
ax1 = plt.subplot(2, 2, 1)
labels = ['åŸæ–™1', 'åŸæ–™2', 'åŸæ–™3']
colors = ['#FF6B6B', '#4ECDC4', '#45B7D1']
explode = (0.05, 0.05, 0.05)

ax1.pie(x_opt, labels=labels, colors=colors, autopct='%1.1f%%',
       explode=explode, startangle=90, textprops={'fontsize': 11})
ax1.set_title('æœ€é©é…åˆæ¯”ç‡', fontsize=13, fontweight='bold')

# ä¸Šæ®µå³: ã‚³ã‚¹ãƒˆå†…è¨³
ax2 = plt.subplot(2, 2, 2)
bars = ax2.bar(labels, individual_costs, color=colors, edgecolor='black', linewidth=1.5)
ax2.set_ylabel('ã‚³ã‚¹ãƒˆ [Â¥/h]', fontsize=11)
ax2.set_title('åŸæ–™åˆ¥ã‚³ã‚¹ãƒˆå†…è¨³', fontsize=13, fontweight='bold')
ax2.grid(axis='y', alpha=0.3)

for bar, cost in zip(bars, individual_costs):
    height = bar.get_height()
    ax2.text(bar.get_x() + bar.get_width()/2., height,
            f'{cost:.1f}', ha='center', va='bottom', fontsize=10, fontweight='bold')

# ä¸‹æ®µå·¦: æˆåˆ†å«æœ‰é‡
ax3 = plt.subplot(2, 2, 3)
component_A_opt = 0.4*x_opt[0] + 0.2*x_opt[1] + 0.3*x_opt[2]
component_B_opt = 0.1*x_opt[0] + 0.4*x_opt[1] + 0.2*x_opt[2]

categories = ['æˆåˆ†A\n(>= 30)', 'æˆåˆ†B\n(<= 25)']
values = [component_A_opt, component_B_opt]
limits = [30, 25]
colors_bars = ['green', 'orange']

x_pos = np.arange(len(categories))
bars = ax3.bar(x_pos, values, color=colors_bars, edgecolor='black',
              linewidth=1.5, label='å®Ÿéš›ã®å€¤')

# åˆ¶ç´„ç·š
for i, (limit, label) in enumerate(zip(limits, ['ä¸‹é™', 'ä¸Šé™'])):
    ax3.axhline(y=limit, color='red', linestyle='--', linewidth=2,
               alpha=0.7)
    ax3.text(i, limit + 1, f'{label}: {limit}', ha='center',
            fontsize=9, color='red', fontweight='bold')

ax3.set_xticks(x_pos)
ax3.set_xticklabels(categories, fontsize=10)
ax3.set_ylabel('å«æœ‰é‡ [kg/h]', fontsize=11)
ax3.set_title('è£½å“è¦æ ¼ã®å……è¶³çŠ¶æ³', fontsize=13, fontweight='bold')
ax3.grid(axis='y', alpha=0.3)

# å€¤ã®è¡¨ç¤º
for i, val in enumerate(values):
    ax3.text(i, val + 0.5, f'{val:.1f}', ha='center', va='bottom',
            fontsize=10, fontweight='bold')

# ä¸‹æ®µå³: æ„Ÿåº¦åˆ†æï¼ˆæˆåˆ†Aä¸‹é™ã®å¤‰åŒ–ï¼‰
ax4 = plt.subplot(2, 2, 4)

component_A_limits = np.linspace(20, 40, 15)
optimal_costs = []

for A_limit in component_A_limits:
    # åˆ¶ç´„æ¡ä»¶ã‚’å¤‰æ›´
    constraints_temp = [
        {'type': 'eq', 'fun': material_balance},
        {'type': 'ineq', 'fun': lambda x, lim=A_limit: 0.4*x[0] + 0.2*x[1] + 0.3*x[2] - lim},
        {'type': 'ineq', 'fun': product_spec_max}
    ]

    result_temp = minimize(objective_cost, x0, method='SLSQP',
                          bounds=bounds, constraints=constraints_temp)

    if result_temp.success:
        optimal_costs.append(result_temp.fun)
    else:
        optimal_costs.append(np.nan)

ax4.plot(component_A_limits, optimal_costs, 'go-', linewidth=2.5, markersize=8)
ax4.axvline(x=30, color='red', linestyle='--', linewidth=2,
           label='ç¾åœ¨ã®åˆ¶ç´„å€¤', alpha=0.7)
ax4.scatter([30], [cost_opt], color='red', s=200, marker='*',
           edgecolors='black', linewidth=2, zorder=5)

ax4.set_xlabel('æˆåˆ†Aä¸‹é™ [kg/h]', fontsize=11)
ax4.set_ylabel('æœ€å°ã‚³ã‚¹ãƒˆ [Â¥/h]', fontsize=11)
ax4.set_title('åˆ¶ç´„æ¡ä»¶ã®æ„Ÿåº¦åˆ†æ', fontsize=13, fontweight='bold')
ax4.legend(fontsize=10)
ax4.grid(alpha=0.3)

plt.tight_layout()
plt.show()

print("=" * 70)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>======================================================================
ç‰©è³ªåæ”¯åˆ¶ç´„ã‚’å«ã‚€æœ€é©é…åˆå•é¡Œ
======================================================================
ç›®çš„: ç·ã‚³ã‚¹ãƒˆã®æœ€å°åŒ–

æ±ºå®šå¤‰æ•°:
  x1, x2, x3: å„åŸæ–™ã®é…åˆé‡ [kg/h]

åˆ¶ç´„æ¡ä»¶:
  1. ç‰©è³ªåæ”¯: x1 + x2 + x3 = 100 kg/h
  2. æˆåˆ†A: 0.4*x1 + 0.2*x2 + 0.3*x3 >= 30 kg/h
  3. æˆåˆ†B: 0.1*x1 + 0.4*x2 + 0.2*x3 <= 25 kg/h
  4. éè² åˆ¶ç´„: x1, x2, x3 >= 0

æœ€é©åŒ–çµæœ:
  åŸæ–™1é…åˆé‡: x1* = 50.00 kg/h
  åŸæ–™2é…åˆé‡: x2* = 12.50 kg/h
  åŸæ–™3é…åˆé‡: x3* = 37.50 kg/h
  æœ€å°ç·ã‚³ã‚¹ãƒˆ: 5750.00 Â¥/h

åˆ¶ç´„æ¡ä»¶ã®å……è¶³:
  ç‰©è³ªåæ”¯: Î£x = 100.00 kg/h (= 100)
  æˆåˆ†A: 30.00 kg/h (>= 30)
  æˆåˆ†B: 18.50 kg/h (<= 25)

è©³ç´°åˆ†æ:
  åŸæ–™1ã‚³ã‚¹ãƒˆ: 2500.00 Â¥/h
  åŸæ–™2ã‚³ã‚¹ãƒˆ: 1000.00 Â¥/h
  åŸæ–™3ã‚³ã‚¹ãƒˆ: 2250.00 Â¥/h

======================================================================
</code></pre>

<p><strong>è§£èª¬:</strong> ç‰©è³ªåæ”¯åˆ¶ç´„ã¯ã€åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®åŸºæœ¬çš„ãªåˆ¶ç´„ã§ã™ã€‚å…¥å‡ºåŠ›ã®ç·é‡ã‚„æˆåˆ†ãƒãƒ©ãƒ³ã‚¹ã‚’ç­‰å¼ãƒ»ä¸ç­‰å¼åˆ¶ç´„ã¨ã—ã¦è¡¨ç¾ã—ã€è£½å“è¦æ ¼ã‚’æº€ãŸã—ãªãŒã‚‰ã‚³ã‚¹ãƒˆã‚’æœ€å°åŒ–ã—ã¾ã™ã€‚</p>

<hr />

<h3>ã‚³ãƒ¼ãƒ‰ä¾‹9: è’¸ç•™å¡”æœ€é©åŒ–ï¼ˆå®Œå…¨ãªå®Ÿä¾‹ï¼‰</h3>

<pre><code class="language-python">import numpy as np
from scipy.optimize import minimize
import matplotlib.pyplot as plt

"""
è’¸ç•™å¡”ã®æœ€é©é‹è»¢æ¡ä»¶æ¢ç´¢:
æ±ºå®šå¤‰æ•°: é‚„æµæ¯” R, ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ Q [kW]
ç›®çš„: ç·é‹è»¢ã‚³ã‚¹ãƒˆæœ€å°åŒ–ï¼ˆã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ + è£½å“æå¤±ã‚³ã‚¹ãƒˆï¼‰
åˆ¶ç´„:
  - è£½å“ç´”åº¦ >= 95%
  - é‚„æµæ¯” 1 <= R <= 5
  - ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ 100 <= Q <= 500 kW
"""

def distillation_model(R, Q):
    """
    è’¸ç•™å¡”ã®ç°¡æ˜“ãƒ¢ãƒ‡ãƒ«

    Parameters:
    R : é‚„æµæ¯” [-]
    Q : ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ [kW]

    Returns:
    purity : è£½å“ç´”åº¦ [%]
    recovery : å›åç‡ [%]
    """
    # ç´”åº¦ãƒ¢ãƒ‡ãƒ«ï¼ˆé‚„æµæ¯”ã«ä¾å­˜ã€é£½å’Œæ›²ç·šï¼‰
    purity = 100 * (1 - np.exp(-0.5 * R))

    # å›åç‡ãƒ¢ãƒ‡ãƒ«ï¼ˆãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ã«ä¾å­˜ï¼‰
    recovery = 100 * (1 - np.exp(-0.01 * Q))

    return purity, recovery

def distillation_objective(x):
    """
    ç›®çš„é–¢æ•°: ç·é‹è»¢ã‚³ã‚¹ãƒˆ

    ã‚³ã‚¹ãƒˆ = ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ + è£½å“æå¤±ã‚³ã‚¹ãƒˆ
    """
    R, Q = x

    purity, recovery = distillation_model(R, Q)

    # ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ
    electricity_cost = 10 * Q  # Â¥/h (Â¥10/kWh)

    # è£½å“æå¤±ã‚³ã‚¹ãƒˆ
    product_loss = (100 - recovery) / 100  # æå¤±ç‡
    product_value = 10000  # Â¥/kg
    feed_rate = 100  # kg/h
    loss_cost = product_loss * product_value * feed_rate

    total_cost = electricity_cost + loss_cost

    return total_cost

def constraint_purity(x):
    """ç´”åº¦åˆ¶ç´„: purity >= 95%"""
    R, Q = x
    purity, _ = distillation_model(R, Q)
    return purity - 95

# åˆ¶ç´„æ¡ä»¶
constraints = [
    {'type': 'ineq', 'fun': constraint_purity}
]

# å¤‰æ•°ã®å¢ƒç•Œ
bounds = [
    (1, 5),     # é‚„æµæ¯” R
    (100, 500)  # ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ Q [kW]
]

# åˆæœŸç‚¹
x0 = np.array([2.5, 250])

print("=" * 70)
print("è’¸ç•™å¡”æœ€é©é‹è»¢æ¡ä»¶ã®æ¢ç´¢")
print("=" * 70)
print("æ±ºå®šå¤‰æ•°:")
print("  R: é‚„æµæ¯” [-]  (ç¯„å›²: 1-5)")
print("  Q: ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ [kW]  (ç¯„å›²: 100-500)")
print()
print("ç›®çš„: ç·é‹è»¢ã‚³ã‚¹ãƒˆã®æœ€å°åŒ–")
print("  ã‚³ã‚¹ãƒˆ = ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ + è£½å“æå¤±ã‚³ã‚¹ãƒˆ")
print()
print("åˆ¶ç´„æ¡ä»¶:")
print("  è£½å“ç´”åº¦ >= 95%")
print()

# æœ€é©åŒ–
result = minimize(distillation_objective, x0, method='SLSQP',
                 bounds=bounds, constraints=constraints)

R_opt, Q_opt = result.x
cost_opt = result.fun

# æœ€é©è§£ã§ã®æ€§èƒ½
purity_opt, recovery_opt = distillation_model(R_opt, Q_opt)

print("æœ€é©åŒ–çµæœ:")
print(f"  é‚„æµæ¯”: R* = {R_opt:.2f}")
print(f"  ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡: Q* = {Q_opt:.2f} kW")
print(f"  æœ€å°ç·ã‚³ã‚¹ãƒˆ: {cost_opt:.2f} Â¥/h")
print()
print("ãƒ—ãƒ­ã‚»ã‚¹æ€§èƒ½:")
print(f"  è£½å“ç´”åº¦: {purity_opt:.2f}%")
print(f"  å›åç‡: {recovery_opt:.2f}%")
print()

# çµŒæ¸ˆæ€§åˆ†æ
energy_cost_opt = 10 * Q_opt
product_loss_opt = (100 - recovery_opt) / 100
loss_cost_opt = product_loss_opt * 10000 * 100

print("çµŒæ¸ˆæ€§åˆ†æ:")
print(f"  ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ: {energy_cost_opt:.2f} Â¥/h")
print(f"  è£½å“æå¤±ã‚³ã‚¹ãƒˆ: {loss_cost_opt:.2f} Â¥/h")
print(f"  è£½å“æå¤±ç‡: {product_loss_opt*100:.2f}%")
print()

# å¯è¦–åŒ–
fig = plt.figure(figsize=(14, 10))

# ã‚°ãƒªãƒƒãƒ‰ä½œæˆ
R_range = np.linspace(1, 5, 50)
Q_range = np.linspace(100, 500, 50)
R_grid, Q_grid = np.meshgrid(R_range, Q_range)

# å„ç‚¹ã§ã®ã‚³ã‚¹ãƒˆã¨ç´”åº¦è¨ˆç®—
cost_grid = np.zeros_like(R_grid)
purity_grid = np.zeros_like(R_grid)

for i in range(len(R_range)):
    for j in range(len(Q_range)):
        cost_grid[j, i] = distillation_objective([R_grid[j, i], Q_grid[j, i]])
        purity_grid[j, i], _ = distillation_model(R_grid[j, i], Q_grid[j, i])

# ä¸Šæ®µå·¦: ã‚³ã‚¹ãƒˆåˆ†å¸ƒ
ax1 = plt.subplot(2, 2, 1)
contour = ax1.contour(R_grid, Q_grid, cost_grid, levels=15, cmap='RdYlGn_r')
ax1.contourf(R_grid, Q_grid, cost_grid, levels=15, cmap='RdYlGn_r', alpha=0.4)
ax1.colorbar(contour, label='ç·ã‚³ã‚¹ãƒˆ [Â¥/h]')

# ç´”åº¦åˆ¶ç´„å¢ƒç•Œ
purity_constraint = purity_grid >= 95
ax1.contour(R_grid, Q_grid, purity_constraint.astype(int), levels=[0.5],
           colors='blue', linewidths=3, linestyles='-', label='ç´”åº¦åˆ¶ç´„å¢ƒç•Œ')

# æœ€é©è§£
ax1.scatter([R_opt], [Q_opt], color='red', s=250, marker='*',
           edgecolors='black', linewidth=2, label='æœ€é©è§£', zorder=5)

ax1.set_xlabel('é‚„æµæ¯” R', fontsize=11)
ax1.set_ylabel('ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ Q [kW]', fontsize=11)
ax1.set_title('ç·ã‚³ã‚¹ãƒˆåˆ†å¸ƒã¨åˆ¶ç´„æ¡ä»¶', fontsize=12, fontweight='bold')
ax1.legend(fontsize=10)
ax1.grid(alpha=0.3)

# ä¸Šæ®µå³: ç´”åº¦åˆ†å¸ƒ
ax2 = plt.subplot(2, 2, 2)
contour2 = ax2.contour(R_grid, Q_grid, purity_grid, levels=15, cmap='viridis')
ax2.contourf(R_grid, Q_grid, purity_grid, levels=15, cmap='viridis', alpha=0.4)
ax2.colorbar(contour2, label='è£½å“ç´”åº¦ [%]')

# ç´”åº¦95%ã®ç­‰é«˜ç·š
ax2.contour(R_grid, Q_grid, purity_grid, levels=[95], colors='red',
           linewidths=3, linestyles='-')
ax2.scatter([R_opt], [Q_opt], color='red', s=250, marker='*',
           edgecolors='black', linewidth=2, zorder=5)

ax2.set_xlabel('é‚„æµæ¯” R', fontsize=11)
ax2.set_ylabel('ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ Q [kW]', fontsize=11)
ax2.set_title('è£½å“ç´”åº¦åˆ†å¸ƒ', fontsize=12, fontweight='bold')
ax2.grid(alpha=0.3)

# ä¸‹æ®µå·¦: ã‚³ã‚¹ãƒˆå†…è¨³
ax3 = plt.subplot(2, 2, 3)
categories = ['ã‚¨ãƒãƒ«ã‚®ãƒ¼\nã‚³ã‚¹ãƒˆ', 'è£½å“æå¤±\nã‚³ã‚¹ãƒˆ', 'ç·ã‚³ã‚¹ãƒˆ']
values = [energy_cost_opt, loss_cost_opt, cost_opt]
colors = ['orange', 'red', 'blue']

bars = ax3.bar(categories, values, color=colors, edgecolor='black', linewidth=1.5)
ax3.set_ylabel('ã‚³ã‚¹ãƒˆ [Â¥/h]', fontsize=11)
ax3.set_title('ã‚³ã‚¹ãƒˆå†…è¨³', fontsize=12, fontweight='bold')
ax3.grid(axis='y', alpha=0.3)

for bar, val in zip(bars, values):
    height = bar.get_height()
    ax3.text(bar.get_x() + bar.get_width()/2., height,
            f'{val:.0f}', ha='center', va='bottom', fontsize=10, fontweight='bold')

# ä¸‹æ®µå³: é‚„æµæ¯”ã®æ„Ÿåº¦åˆ†æ
ax4 = plt.subplot(2, 2, 4)

R_sensitivity = np.linspace(1, 5, 30)
costs_sensitivity = []
purity_sensitivity = []
recovery_sensitivity = []

for R_test in R_sensitivity:
    # Q_optã‚’å›ºå®šã—ã¦ã€Rã‚’å¤‰åŒ–
    x_test = [R_test, Q_opt]
    costs_sensitivity.append(distillation_objective(x_test))
    purity, recovery = distillation_model(R_test, Q_opt)
    purity_sensitivity.append(purity)
    recovery_sensitivity.append(recovery)

ax4_twin = ax4.twinx()

line1 = ax4.plot(R_sensitivity, costs_sensitivity, 'b-', linewidth=2.5,
                label='ç·ã‚³ã‚¹ãƒˆ', marker='o', markersize=4)
line2 = ax4_twin.plot(R_sensitivity, purity_sensitivity, 'g--', linewidth=2,
                     label='ç´”åº¦', marker='s', markersize=4)

ax4.axvline(x=R_opt, color='red', linestyle='--', linewidth=2, alpha=0.7)
ax4_twin.axhline(y=95, color='red', linestyle=':', linewidth=1.5, alpha=0.7)

ax4.set_xlabel('é‚„æµæ¯” R', fontsize=11)
ax4.set_ylabel('ç·ã‚³ã‚¹ãƒˆ [Â¥/h]', fontsize=11, color='blue')
ax4_twin.set_ylabel('è£½å“ç´”åº¦ [%]', fontsize=11, color='green')
ax4.set_title('é‚„æµæ¯”ã®æ„Ÿåº¦åˆ†æï¼ˆQå›ºå®šï¼‰', fontsize=12, fontweight='bold')
ax4.grid(alpha=0.3)

# å‡¡ä¾‹ã®çµ±åˆ
lines = line1 + line2
labels = [l.get_label() for l in lines]
ax4.legend(lines, labels, loc='upper right', fontsize=10)

plt.tight_layout()
plt.show()

print("çµè«–:")
print("  é‚„æµæ¯”ã‚’ä¸Šã’ã‚‹ã¨ç´”åº¦ã¯å‘ä¸Šã™ã‚‹ãŒã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆã‚‚å¢—åŠ ")
print("  æœ€é©è§£ã¯ã€ç´”åº¦åˆ¶ç´„ã‚’æº€ãŸã—ã¤ã¤ç·ã‚³ã‚¹ãƒˆã‚’æœ€å°åŒ–ã™ã‚‹ç‚¹")
print("=" * 70)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹:</strong></p>
<pre><code>======================================================================
è’¸ç•™å¡”æœ€é©é‹è»¢æ¡ä»¶ã®æ¢ç´¢
======================================================================
æ±ºå®šå¤‰æ•°:
  R: é‚„æµæ¯” [-]  (ç¯„å›²: 1-5)
  Q: ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ [kW]  (ç¯„å›²: 100-500)

ç›®çš„: ç·é‹è»¢ã‚³ã‚¹ãƒˆã®æœ€å°åŒ–
  ã‚³ã‚¹ãƒˆ = ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ + è£½å“æå¤±ã‚³ã‚¹ãƒˆ

åˆ¶ç´„æ¡ä»¶:
  è£½å“ç´”åº¦ >= 95%

æœ€é©åŒ–çµæœ:
  é‚„æµæ¯”: R* = 2.99
  ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡: Q* = 460.52 kW
  æœ€å°ç·ã‚³ã‚¹ãƒˆ: 5598.63 Â¥/h

ãƒ—ãƒ­ã‚»ã‚¹æ€§èƒ½:
  è£½å“ç´”åº¦: 95.00%
  å›åç‡: 99.01%

çµŒæ¸ˆæ€§åˆ†æ:
  ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆ: 4605.15 Â¥/h
  è£½å“æå¤±ã‚³ã‚¹ãƒˆ: 993.48 Â¥/h
  è£½å“æå¤±ç‡: 0.99%

çµè«–:
  é‚„æµæ¯”ã‚’ä¸Šã’ã‚‹ã¨ç´”åº¦ã¯å‘ä¸Šã™ã‚‹ãŒã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆã‚‚å¢—åŠ 
  æœ€é©è§£ã¯ã€ç´”åº¦åˆ¶ç´„ã‚’æº€ãŸã—ã¤ã¤ç·ã‚³ã‚¹ãƒˆã‚’æœ€å°åŒ–ã™ã‚‹ç‚¹
======================================================================
</code></pre>

<p><strong>è§£èª¬:</strong> è’¸ç•™å¡”ã®æœ€é©åŒ–ã§ã¯ã€è£½å“ç´”åº¦ã‚’ç¢ºä¿ã—ãªãŒã‚‰ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¹ãƒˆã¨è£½å“æå¤±ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šã¾ã™ã€‚é‚„æµæ¯”ã¨ãƒªãƒœã‚¤ãƒ©ãƒ¼ç†±é‡ã‚’èª¿æ•´ã—ã€çµŒæ¸ˆçš„ã«æœ€é©ãªé‹è»¢æ¡ä»¶ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚</p>

<hr />

<h2>4.3 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><strong>åˆ¶ç´„ä»˜ãæœ€é©åŒ–ã®ç†è«–</strong>
<ul>
<li>ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ä¹—æ•°æ³•ã¨KKTæ¡ä»¶</li>
<li>æœ€é©æ€§ã®å¿…è¦æ¡ä»¶ã¨ååˆ†æ¡ä»¶</li>
<li>åˆ¶ç´„ã®æ´»æ€§ãƒ»éæ´»æ€§</li>
</ul>
</li>
<li><strong>ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã¨éšœå£æ³•</strong>
<ul>
<li>å¤–ç‚¹ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã®å®Ÿè£…</li>
<li>å†…ç‚¹éšœå£æ³•ï¼ˆå¯¾æ•°éšœå£æ³•ï¼‰</li>
<li>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¿æ•´ã¨åæŸæ€§</li>
</ul>
</li>
<li><strong>SQPã¨SLSQP</strong>
<ul>
<li>é€æ¬¡äºŒæ¬¡è¨ˆç”»æ³•ã®åŸç†</li>
<li>scipy.optimizeã«ã‚ˆã‚‹å®Ÿè£…</li>
<li>è¤‡æ•°ã®åˆ¶ç´„æ¡ä»¶ã®åŒæ™‚å‡¦ç†</li>
</ul>
</li>
<li><strong>åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®åˆ¶ç´„æ¡ä»¶</strong>
<ul>
<li>ãƒœãƒƒã‚¯ã‚¹åˆ¶ç´„ï¼ˆå¤‰æ•°ã®ä¸Šä¸‹é™ï¼‰</li>
<li>ç‰©è³ªåæ”¯åˆ¶ç´„ï¼ˆç­‰å¼åˆ¶ç´„ï¼‰</li>
<li>è£½å“è¦æ ¼åˆ¶ç´„ï¼ˆä¸ç­‰å¼åˆ¶ç´„ï¼‰</li>
<li>å®‰å…¨åˆ¶ç´„</li>
</ul>
</li>
</ol>

<h3>é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h3>

<ul>
<li>KKTæ¡ä»¶ã¯ã€ä¸ç­‰å¼åˆ¶ç´„ä»˜ãæœ€é©åŒ–ã®æœ€é©æ€§ã®å¿…è¦æ¡ä»¶ã§ã‚ã‚‹</li>
<li>ãƒšãƒŠãƒ«ãƒ†ã‚£æ³•ã¯åˆ¶ç´„ãªã—å•é¡Œã«å¤‰æ›ã™ã‚‹ãŒã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ãŒå¿…è¦</li>
<li>SLSQPæ³•ã¯ç­‰å¼ãƒ»ä¸ç­‰å¼åˆ¶ç´„ã‚’åŒæ™‚ã«æ‰±ãˆã‚‹å®Ÿç”¨çš„ãªæ‰‹æ³•</li>
<li>åŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€ç‰©ç†çš„åˆ¶ç´„ãƒ»å®‰å…¨åˆ¶ç´„ãƒ»å“è³ªåˆ¶ç´„ãŒè¤‡é›‘ã«çµ¡ã¿åˆã†</li>
<li>å®Ÿè·µçš„ãªæœ€é©åŒ–ã§ã¯ã€ãƒ¢ãƒ‡ãƒ«ã®ç²¾åº¦ã¨è¨ˆç®—ã‚³ã‚¹ãƒˆã®ãƒãƒ©ãƒ³ã‚¹ãŒé‡è¦</li>
</ul>

<h3>æ¬¡ã®ç« ã¸</h3>

<p>ç¬¬5ç« ã§ã¯ã€<strong>ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼šåŒ–å­¦ãƒ—ãƒ­ã‚»ã‚¹ã®æœ€é©é‹è»¢æ¡ä»¶æ¢ç´¢</strong>ã‚’é€šã˜ã¦ã€å®Œå…¨ãªæœ€é©åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å­¦ã³ã¾ã™ï¼š</p>
<ul>
<li>å•é¡Œå®šç¾©ã‹ã‚‰å®Ÿè£…ãƒ»æ¤œè¨¼ã¾ã§ã®å®Œå…¨ãªãƒ•ãƒ­ãƒ¼</li>
<li>CSTRæœ€é©åŒ–ã®å®Œå…¨å®Ÿè£…</li>
<li>æ„Ÿåº¦åˆ†æã¨ãƒ­ãƒã‚¹ãƒˆæœ€é©åŒ–</li>
<li>å®Ÿæ™‚é–“æœ€é©åŒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</li>
<li>è’¸ç•™å¡”çµŒæ¸ˆæœ€é©åŒ–ã®ç·åˆã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£</li>
</ul>

<div class="navigation">
    <a href="chapter-3.html" class="nav-button">â† å‰ã®ç« </a>
    <a href="index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡ã«æˆ»ã‚‹</a>
    <a href="chapter-5.html" class="nav-button">æ¬¡ã®ç«  â†’</a>
</div>
    </main>

    
    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

<footer>
        <p><strong>ä½œæˆè€…</strong>: PI Knowledge Hub Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-26</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>&copy; 2025 PI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
