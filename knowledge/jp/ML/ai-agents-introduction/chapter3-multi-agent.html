<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ  - AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¥é–€ã‚·ãƒªãƒ¼ã‚º ç¬¬3ç« ">
    <title>ç¬¬3ç« : ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ  - AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¥é–€ã‚·ãƒªãƒ¼ã‚º</title>

    <!-- MathJax for formulas -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>

    <!-- CSS Styling -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #667eea;
            --accent-color: #764ba2;
            --bg-color: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --code-bg: #f5f5f5;
            --link-color: #667eea;
            --link-hover: #764ba2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header .container {
            padding: 0 1.5rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .meta {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            font-size: 0.9rem;
            opacity: 0.95;
            margin-top: 1rem;
        }

        .meta span {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        h2 {
            font-size: 1.75rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--secondary-color);
            color: var(--primary-color);
        }

        h3 {
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 0.8rem;
            color: var(--primary-color);
        }

        h4 {
            font-size: 1.2rem;
            margin-top: 1.5rem;
            margin-bottom: 0.6rem;
            color: var(--primary-color);
        }

        p {
            margin-bottom: 1.2rem;
        }

        a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1.2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        pre code {
            background: none;
            padding: 0;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            display: block;
        }

        thead {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        th, td {
            padding: 0.8rem;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        blockquote {
            border-left: 4px solid var(--secondary-color);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: #666;
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .mermaid {
            text-align: center;
            margin: 2rem 0;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        details {
            margin: 1rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            padding: 0.5rem;
        }

        summary:hover {
            color: var(--secondary-color);
        }

        footer {
            margin-top: 4rem;
            padding: 2rem 0;
            border-top: 2px solid var(--border-color);
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin: 3rem 0;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-button {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: var(--secondary-color);
            color: white;
            border-radius: 6px;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 600;
        }

        .nav-button:hover {
            background: var(--link-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.6rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            pre {
                padding: 1rem;
                font-size: 0.85rem;
            }

            table {
                font-size: 0.9rem;
            }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({ startOnLoad: true, theme: 'default' });
            }
        });
    </script>
</head>
<body>
    <header>
        <div class="container">
            <h1>ç¬¬3ç« : ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ </h1>
            <p style="font-size: 1.1rem; margin-top: 0.5rem; opacity: 0.95;">è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å”èª¿ã«ã‚ˆã‚‹è¤‡é›‘ã‚¿ã‚¹ã‚¯ã®è§£æ±º</p>
            <div class="meta">
                <span>ğŸ“– èª­äº†æ™‚é–“: 30-35åˆ†</span>
                <span>ğŸ“Š é›£æ˜“åº¦: ä¸Šç´š</span>
                <span>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 5å€‹</span>
            </div>
        </div>
    </header>

    <main class="container">
        <h2 id="intro">ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¨ã¯</h2>

        <h3>ãªãœè¤‡æ•°ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå¿…è¦ã‹</h3>
        <p>å˜ä¸€ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã¯è§£æ±ºãŒå›°é›£ãªè¤‡é›‘ã‚¿ã‚¹ã‚¯ã‚’ã€å°‚é–€åŒ–ã•ã‚ŒãŸè¤‡æ•°ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå”èª¿ã—ã¦å‡¦ç†ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚ŠåŠ¹ç‡çš„ã‹ã¤é«˜å“è³ªãªçµæœã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚</p>

        <p><strong>ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åˆ©ç‚¹</strong>ï¼š</p>
        <ul>
            <li>âœ… <strong>å°‚é–€åŒ–</strong>: å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç‰¹å®šã®å½¹å‰²ã«ç‰¹åŒ–</li>
            <li>âœ… <strong>ä¸¦åˆ—å‡¦ç†</strong>: ç‹¬ç«‹ã—ãŸã‚¿ã‚¹ã‚¯ã‚’åŒæ™‚å®Ÿè¡Œ</li>
            <li>âœ… <strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong>: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°ã‚’å‹•çš„ã«èª¿æ•´</li>
            <li>âœ… <strong>ãƒ•ã‚©ãƒ¼ãƒ«ãƒˆãƒˆãƒ¬ãƒ©ãƒ³ã‚¹</strong>: ä¸€éƒ¨ã®å¤±æ•—ã‚’ä»–ãŒã‚«ãƒãƒ¼</li>
            <li>âœ… <strong>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ€§</strong>: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¿½åŠ ãƒ»å‰Šé™¤ãŒå®¹æ˜“</li>
        </ul>

        <h3>ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç¨®é¡</h3>

        <table>
            <thead>
                <tr>
                    <th>ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</th>
                    <th>ç‰¹å¾´</th>
                    <th>é©ç”¨å ´é¢</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ä¸¦åˆ—å‹</strong></td>
                    <td>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç‹¬ç«‹ã—ã¦ä¸¦è¡Œå®Ÿè¡Œ</td>
                    <td>ãƒ‡ãƒ¼ã‚¿åé›†ã€è¤‡æ•°è¦–ç‚¹ã®åˆ†æ</td>
                </tr>
                <tr>
                    <td><strong>é †æ¬¡å‹</strong></td>
                    <td>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒé †ç•ªã«å‡¦ç†ã‚’å¼•ãç¶™ã</td>
                    <td>ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†ã€æ®µéšçš„æ”¹å–„</td>
                </tr>
                <tr>
                    <td><strong>éšå±¤å‹</strong></td>
                    <td>ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒé…ä¸‹ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’åˆ¶å¾¡</td>
                    <td>è¤‡é›‘ãªè¨ˆç”»ã¨å®Ÿè¡Œã®åˆ†é›¢</td>
                </tr>
                <tr>
                    <td><strong>å¯¾è©±å‹</strong></td>
                    <td>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã§è­°è«–ãƒ»äº¤æ¸‰</td>
                    <td>æ„æ€æ±ºå®šã€åˆæ„å½¢æˆ</td>
                </tr>
            </tbody>
        </table>

        <h2 id="design">ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­è¨ˆ</h2>

        <h3>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²åˆ†æ‹…</h3>

        <div class="mermaid">
graph TD
    M[Manager Agent<br/>ã‚¿ã‚¹ã‚¯åˆ†è§£ã¨èª¿æ•´] --> R[Researcher Agent<br/>æƒ…å ±åé›†]
    M --> W[Writer Agent<br/>æ–‡æ›¸ä½œæˆ]
    M --> C[Critic Agent<br/>ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨è©•ä¾¡]

    R --> M
    W --> M
    C --> M

    style M fill:#e3f2fd
    style R fill:#fff3e0
    style W fill:#f3e5f5
    style C fill:#e8f5e9
</div>

        <h3>å½¹å‰²ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®ä¾‹</h3>

        <pre><code class="language-python">from typing import List, Dict, Any
from dataclasses import dataclass

@dataclass
class AgentRole:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²å®šç¾©"""
    name: str
    description: str
    capabilities: List[str]
    system_prompt: str

# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå½¹å‰²ã®å®šç¾©
RESEARCHER_ROLE = AgentRole(
    name="Researcher",
    description="æƒ…å ±åé›†ã¨åˆ†æã®å°‚é–€å®¶",
    capabilities=["web_search", "database_query", "data_analysis"],
    system_prompt="""ã‚ãªãŸã¯å„ªç§€ãªãƒªã‚µãƒ¼ãƒãƒ£ãƒ¼ã§ã™ã€‚

å½¹å‰²:
- Webæ¤œç´¢ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰é–¢é€£æƒ…å ±ã‚’åé›†
- åé›†ã—ãŸæƒ…å ±ã®ä¿¡é ¼æ€§ã‚’è©•ä¾¡
- é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’è¦ç´„ã—ã¦ãƒãƒ¼ãƒ ã«å ±å‘Š

é‡è¦äº‹é …:
- æƒ…å ±æºã‚’æ˜è¨˜ã™ã‚‹
- è¤‡æ•°ã®æƒ…å ±æºã‚’ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒƒã‚¯
- ä¸ç¢ºå®Ÿãªæƒ…å ±ã¯æ˜ç¤ºã™ã‚‹"""
)

WRITER_ROLE = AgentRole(
    name="Writer",
    description="æ–‡æ›¸ä½œæˆã®å°‚é–€å®¶",
    capabilities=["content_generation", "formatting", "editing"],
    system_prompt="""ã‚ãªãŸã¯å„ªç§€ãªãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚

å½¹å‰²:
- ãƒªã‚µãƒ¼ãƒãƒ£ãƒ¼ã®æƒ…å ±ã‚’åŸºã«é«˜å“è³ªãªæ–‡æ›¸ã‚’ä½œæˆ
- èª­ã¿ã‚„ã™ãã€è«–ç†çš„ãªæ§‹æˆ
- å¯¾è±¡èª­è€…ã«é©ã—ãŸæ–‡ä½“ã¨ãƒˆãƒ¼ãƒ³

é‡è¦äº‹é …:
- æ˜ç¢ºã§ç°¡æ½”ãªè¡¨ç¾
- é©åˆ‡ãªè¦‹å‡ºã—ã¨æ®µè½æ§‹æˆ
- å¼•ç”¨ã¨å‚ç…§ã‚’é©åˆ‡ã«ä½¿ç”¨"""
)

CRITIC_ROLE = AgentRole(
    name="Critic",
    description="å“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å°‚é–€å®¶",
    capabilities=["quality_check", "fact_verification", "feedback"],
    system_prompt="""ã‚ãªãŸã¯æ‰¹è©•çš„æ€è€ƒåŠ›ã®ã‚ã‚‹ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã§ã™ã€‚

å½¹å‰²:
- ä½œæˆã•ã‚ŒãŸæ–‡æ›¸ã‚’æ‰¹åˆ¤çš„ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼
- äº‹å®Ÿã®æ­£ç¢ºæ€§ã‚’æ¤œè¨¼
- æ”¹å–„ç‚¹ã‚’å…·ä½“çš„ã«æç¤º

é‡è¦äº‹é …:
- å»ºè¨­çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ
- é‡å¤§ãªå•é¡Œã¯æ˜ç¢ºã«æŒ‡æ‘˜"""
)
</code></pre>

        <h2 id="communication">é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«</h2>

        <h3>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒƒã‚·ãƒ³ã‚°</h3>
        <p>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®é€šä¿¡ã¯ã€æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä»‹ã—ã¦è¡Œã„ã¾ã™ã€‚</p>

        <pre><code class="language-python">from dataclasses import dataclass
from typing import Optional, Dict, Any
from datetime import datetime
from enum import Enum

class MessageType(Enum):
    """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—"""
    TASK = "task"              # ã‚¿ã‚¹ã‚¯æŒ‡ç¤º
    RESULT = "result"          # ã‚¿ã‚¹ã‚¯çµæœ
    QUERY = "query"            # æƒ…å ±è¦æ±‚
    RESPONSE = "response"      # æƒ…å ±å¿œç­”
    ERROR = "error"            # ã‚¨ãƒ©ãƒ¼é€šçŸ¥
    STATUS = "status"          # çŠ¶æ…‹æ›´æ–°

@dataclass
class Message:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"""
    type: MessageType
    sender: str
    receiver: str
    content: Dict[str, Any]
    timestamp: datetime
    message_id: str
    reply_to: Optional[str] = None

class MessageBus:
    """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒã‚¹ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“é€šä¿¡ï¼‰"""

    def __init__(self):
        self.messages: List[Message] = []
        self.subscribers: Dict[str, List[callable]] = {}

    def subscribe(self, agent_name: str, callback: callable):
        """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ã«ç™»éŒ²"""
        if agent_name not in self.subscribers:
            self.subscribers[agent_name] = []
        self.subscribers[agent_name].append(callback)

    def publish(self, message: Message):
        """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é…ä¿¡"""
        self.messages.append(message)

        # å—ä¿¡è€…ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é…ä¿¡
        if message.receiver in self.subscribers:
            for callback in self.subscribers[message.receiver]:
                callback(message)

    def broadcast(self, message: Message):
        """å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ"""
        self.messages.append(message)

        for agent_name, callbacks in self.subscribers.items():
            if agent_name != message.sender:
                for callback in callbacks:
                    callback(message)

# ä½¿ç”¨ä¾‹
import uuid

bus = MessageBus()

def researcher_receive(message: Message):
    print(f"Researcher received: {message.type.value} from {message.sender}")

def writer_receive(message: Message):
    print(f"Writer received: {message.type.value} from {message.sender}")

# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç™»éŒ²
bus.subscribe("researcher", researcher_receive)
bus.subscribe("writer", writer_receive)

# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
task_message = Message(
    type=MessageType.TASK,
    sender="manager",
    receiver="researcher",
    content={"task": "2024å¹´ã®AIå‹•å‘ã‚’èª¿æŸ»"},
    timestamp=datetime.now(),
    message_id=str(uuid.uuid4())
)

bus.publish(task_message)
</code></pre>

        <h3>å…±æœ‰ãƒ¡ãƒ¢ãƒªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</h3>

        <pre><code class="language-python">from typing import Dict, Any, Optional
import threading

class SharedMemory:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®å…±æœ‰ãƒ¡ãƒ¢ãƒª"""

    def __init__(self):
        self.data: Dict[str, Any] = {}
        self.lock = threading.Lock()
        self.subscribers: Dict[str, List[callable]] = {}

    def write(self, key: str, value: Any, agent_name: str):
        """ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã¿"""
        with self.lock:
            self.data[key] = {
                "value": value,
                "author": agent_name,
                "timestamp": datetime.now()
            }

            # å¤‰æ›´ã‚’é€šçŸ¥
            self._notify_subscribers(key, value, agent_name)

    def read(self, key: str) -> Optional[Any]:
        """ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿"""
        with self.lock:
            if key in self.data:
                return self.data[key]["value"]
            return None

    def subscribe_to_key(self, key: str, callback: callable):
        """ç‰¹å®šã®ã‚­ãƒ¼ã®å¤‰æ›´ã‚’ç›£è¦–"""
        if key not in self.subscribers:
            self.subscribers[key] = []
        self.subscribers[key].append(callback)

    def _notify_subscribers(self, key: str, value: Any, agent_name: str):
        """ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã«é€šçŸ¥"""
        if key in self.subscribers:
            for callback in self.subscribers[key]:
                callback(key, value, agent_name)

# ä½¿ç”¨ä¾‹
memory = SharedMemory()

def on_research_complete(key, value, agent_name):
    print(f"Research completed by {agent_name}: {value}")

memory.subscribe_to_key("research_result", on_research_complete)

# ResearcherãŒçµæœã‚’æ›¸ãè¾¼ã¿
memory.write("research_result", "2024å¹´ã®AIä¸»è¦ãƒˆãƒ¬ãƒ³ãƒ‰...", "researcher")
</code></pre>

        <h2 id="patterns">å”èª¿ãƒ‘ã‚¿ãƒ¼ãƒ³</h2>

        <h3>1. ä¸¦åˆ—å®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³</h3>

        <pre><code class="language-python">import asyncio
from typing import List, Dict, Any

class ParallelAgentSystem:
    """ä¸¦åˆ—å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, agents: List[Any]):
        self.agents = agents

    async def execute_parallel(self, task: str) -> List[Dict[str, Any]]:
        """å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä¸¦åˆ—å®Ÿè¡Œ"""
        tasks = [
            agent.process(task)
            for agent in self.agents
        ]

        results = await asyncio.gather(*tasks, return_exceptions=True)

        # çµæœã‚’é›†ç´„
        successful_results = []
        for i, result in enumerate(results):
            if isinstance(result, Exception):
                print(f"Agent {i} failed: {str(result)}")
            else:
                successful_results.append({
                    "agent": self.agents[i].name,
                    "result": result
                })

        return successful_results

# ä½¿ç”¨ä¾‹ï¼ˆæ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ï¼‰
class ResearchAgent:
    def __init__(self, name: str, specialty: str):
        self.name = name
        self.specialty = specialty

    async def process(self, query: str) -> Dict[str, Any]:
        # éåŒæœŸã§ãƒªã‚µãƒ¼ãƒã‚’å®Ÿè¡Œ
        await asyncio.sleep(1)  # APIå‘¼ã³å‡ºã—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        return {
            "specialty": self.specialty,
            "findings": f"{self.specialty}ã«é–¢ã™ã‚‹{query}ã®èª¿æŸ»çµæœ"
        }

# è¤‡æ•°ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä¸¦åˆ—å®Ÿè¡Œ
agents = [
    ResearchAgent("Tech Researcher", "æŠ€è¡“å‹•å‘"),
    ResearchAgent("Market Researcher", "å¸‚å ´åˆ†æ"),
    ResearchAgent("Academic Researcher", "å­¦è¡“ç ”ç©¶")
]

system = ParallelAgentSystem(agents)
results = asyncio.run(system.execute_parallel("2024å¹´ã®AI"))
print(results)
</code></pre>

        <h3>2. é †æ¬¡å®Ÿè¡Œï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>

        <pre><code class="language-python">from typing import Any, List, Callable

class SequentialAgentSystem:
    """é †æ¬¡å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰"""

    def __init__(self):
        self.pipeline: List[Callable] = []

    def add_stage(self, agent: Callable):
        """ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¿½åŠ """
        self.pipeline.append(agent)

    def execute(self, initial_input: Any) -> Any:
        """ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œ"""
        current_data = initial_input

        for i, agent in enumerate(self.pipeline):
            print(f"Stage {i+1}: {agent.__name__}")
            current_data = agent(current_data)
            print(f"  Output: {current_data}\n")

        return current_data

# ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å„æ®µéšã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
def data_collector(query: str) -> Dict[str, Any]:
    """ã‚¹ãƒ†ãƒ¼ã‚¸1: ãƒ‡ãƒ¼ã‚¿åé›†"""
    return {
        "query": query,
        "raw_data": f"{query}ã«é–¢ã™ã‚‹ç”Ÿãƒ‡ãƒ¼ã‚¿...",
        "sources": ["source1", "source2"]
    }

def data_analyzer(data: Dict[str, Any]) -> Dict[str, Any]:
    """ã‚¹ãƒ†ãƒ¼ã‚¸2: ãƒ‡ãƒ¼ã‚¿åˆ†æ"""
    data["analysis"] = "åˆ†æçµæœ: ä¸»è¦ãªãƒˆãƒ¬ãƒ³ãƒ‰ã¯..."
    data["insights"] = ["ã‚¤ãƒ³ã‚µã‚¤ãƒˆ1", "ã‚¤ãƒ³ã‚µã‚¤ãƒˆ2"]
    return data

def report_generator(data: Dict[str, Any]) -> str:
    """ã‚¹ãƒ†ãƒ¼ã‚¸3: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
    report = f"""
èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ: {data['query']}

åˆ†æçµæœ:
{data['analysis']}

ä¸»è¦ã‚¤ãƒ³ã‚µã‚¤ãƒˆ:
- {data['insights'][0]}
- {data['insights'][1]}

æƒ…å ±æº: {', '.join(data['sources'])}
    """
    return report.strip()

# ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ã¨å®Ÿè¡Œ
pipeline = SequentialAgentSystem()
pipeline.add_stage(data_collector)
pipeline.add_stage(data_analyzer)
pipeline.add_stage(report_generator)

final_report = pipeline.execute("AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æœ€æ–°å‹•å‘")
print("=== æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ ===")
print(final_report)
</code></pre>

        <h3>3. éšå±¤å‹ï¼ˆManager-Workerï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>

        <pre><code class="language-python">from typing import List, Dict, Any
from openai import OpenAI

class ManagerAgent:
    """ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆã‚¿ã‚¹ã‚¯åˆ†è§£ã¨èª¿æ•´ï¼‰"""

    def __init__(self, api_key: str, workers: List[Any]):
        self.client = OpenAI(api_key=api_key)
        self.workers = workers
        self.task_history = []

    def execute(self, user_request: str) -> str:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†"""
        # ã‚¹ãƒ†ãƒƒãƒ—1: ã‚¿ã‚¹ã‚¯ã‚’åˆ†è§£
        subtasks = self.decompose_task(user_request)

        # ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ¯ãƒ¼ã‚«ãƒ¼ã«å‰²ã‚Šå½“ã¦
        results = self.delegate_to_workers(subtasks)

        # ã‚¹ãƒ†ãƒƒãƒ—3: çµæœã‚’çµ±åˆ
        final_result = self.synthesize_results(user_request, results)

        return final_result

    def decompose_task(self, request: str) -> List[Dict[str, Any]]:
        """ã‚¿ã‚¹ã‚¯ã‚’ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã«åˆ†è§£"""
        worker_capabilities = "\n".join([
            f"- {w.name}: {w.capabilities}"
            for w in self.workers
        ])

        prompt = f"""ä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€åˆ©ç”¨å¯èƒ½ãªãƒ¯ãƒ¼ã‚«ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã—ã¦ãã ã•ã„ã€‚

ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: {request}

åˆ©ç”¨å¯èƒ½ãªãƒ¯ãƒ¼ã‚«ãƒ¼:
{worker_capabilities}

å„ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„:
1. [ãƒ¯ãƒ¼ã‚«ãƒ¼å] ã‚¿ã‚¹ã‚¯å†…å®¹
2. [ãƒ¯ãƒ¼ã‚«ãƒ¼å] ã‚¿ã‚¹ã‚¯å†…å®¹
..."""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0
        )

        # ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’ãƒ‘ãƒ¼ã‚¹ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        subtasks = []
        for line in response.choices[0].message.content.split('\n'):
            if line.strip() and line[0].isdigit():
                parts = line.split(']', 1)
                if len(parts) == 2:
                    worker_name = parts[0].split('[')[1].strip()
                    task_desc = parts[1].strip()
                    subtasks.append({
                        "worker": worker_name,
                        "task": task_desc
                    })

        return subtasks

    def delegate_to_workers(self, subtasks: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """ãƒ¯ãƒ¼ã‚«ãƒ¼ã«ã‚¿ã‚¹ã‚¯ã‚’å§”è­²"""
        results = []

        for subtask in subtasks:
            worker_name = subtask["worker"]
            task = subtask["task"]

            # è©²å½“ã™ã‚‹ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’è¦‹ã¤ã‘ã‚‹
            worker = next((w for w in self.workers if w.name == worker_name), None)

            if worker:
                result = worker.execute(task)
                results.append({
                    "worker": worker_name,
                    "task": task,
                    "result": result
                })
            else:
                results.append({
                    "worker": worker_name,
                    "task": task,
                    "result": f"ã‚¨ãƒ©ãƒ¼: ãƒ¯ãƒ¼ã‚«ãƒ¼ {worker_name} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
                })

        return results

    def synthesize_results(self, original_request: str, results: List[Dict[str, Any]]) -> str:
        """çµæœã‚’çµ±åˆã—ã¦æœ€çµ‚å›ç­”ã‚’ç”Ÿæˆ"""
        results_text = "\n\n".join([
            f"{r['worker']}ã®çµæœ:\n{r['result']}"
            for r in results
        ])

        prompt = f"""ä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ã€å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®çµæœã‚’çµ±åˆã—ã¦æœ€çµ‚å›ç­”ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

å…ƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: {original_request}

ãƒ¯ãƒ¼ã‚«ãƒ¼ã®çµæœ:
{results_text}

çµ±åˆã•ã‚ŒãŸå›ç­”ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„:"""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.7
        )

        return response.choices[0].message.content

class WorkerAgent:
    """ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""

    def __init__(self, name: str, capabilities: str, system_prompt: str, api_key: str):
        self.name = name
        self.capabilities = capabilities
        self.system_prompt = system_prompt
        self.client = OpenAI(api_key=api_key)

    def execute(self, task: str) -> str:
        """ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ"""
        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[
                {"role": "system", "content": self.system_prompt},
                {"role": "user", "content": task}
            ],
            temperature=0.7
        )

        return response.choices[0].message.content

# ä½¿ç”¨ä¾‹
researcher = WorkerAgent(
    name="Researcher",
    capabilities="Webæ¤œç´¢ã€ãƒ‡ãƒ¼ã‚¿åé›†",
    system_prompt="ã‚ãªãŸã¯ãƒªã‚µãƒ¼ãƒã®å°‚é–€å®¶ã§ã™ã€‚",
    api_key="your-api-key"
)

writer = WorkerAgent(
    name="Writer",
    capabilities="æ–‡æ›¸ä½œæˆã€ç·¨é›†",
    system_prompt="ã‚ãªãŸã¯æ–‡æ›¸ä½œæˆã®å°‚é–€å®¶ã§ã™ã€‚",
    api_key="your-api-key"
)

manager = ManagerAgent(
    api_key="your-api-key",
    workers=[researcher, writer]
)

result = manager.execute("2024å¹´ã®AIå‹•å‘ã«ã¤ã„ã¦1000å­—ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„")
print(result)
</code></pre>

        <h2 id="orchestration">ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥</h2>

        <h3>å‹•çš„ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦</h3>

        <pre><code class="language-python">from typing import List, Dict, Any
import time

class TaskOrchestrator:
    """ã‚¿ã‚¹ã‚¯ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼"""

    def __init__(self, agents: List[Any]):
        self.agents = agents
        self.task_queue = []
        self.agent_status = {agent.name: "idle" for agent in agents}

    def add_task(self, task: Dict[str, Any]):
        """ã‚¿ã‚¹ã‚¯ã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ """
        self.task_queue.append(task)

    def get_available_agent(self, required_capability: str = None):
        """åˆ©ç”¨å¯èƒ½ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å–å¾—"""
        for agent in self.agents:
            if self.agent_status[agent.name] == "idle":
                if required_capability is None or required_capability in agent.capabilities:
                    return agent
        return None

    def execute_tasks(self):
        """ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã‚’å‡¦ç†"""
        while self.task_queue:
            task = self.task_queue.pop(0)

            # é©åˆ‡ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹
            agent = self.get_available_agent(task.get("required_capability"))

            if agent:
                print(f"ã‚¿ã‚¹ã‚¯ '{task['name']}' ã‚’ {agent.name} ã«å‰²ã‚Šå½“ã¦")
                self.agent_status[agent.name] = "busy"

                # ã‚¿ã‚¹ã‚¯å®Ÿè¡Œï¼ˆéåŒæœŸã‚’æƒ³å®šï¼‰
                result = agent.execute(task)

                self.agent_status[agent.name] = "idle"
                print(f"{agent.name} ãŒã‚¿ã‚¹ã‚¯ '{task['name']}' ã‚’å®Œäº†")
            else:
                # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒåˆ©ç”¨ä¸å¯ã®å ´åˆã€ã‚­ãƒ¥ãƒ¼ã«æˆ»ã™
                self.task_queue.append(task)
                time.sleep(1)
</code></pre>

        <h2 id="state">çŠ¶æ…‹ç®¡ç†ã¨ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±º</h2>

        <h3>åˆ†æ•£çŠ¶æ…‹ã®åŒæœŸ</h3>

        <pre><code class="language-python">from typing import Dict, Any, Optional
from datetime import datetime
import json

class StateManager:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®çŠ¶æ…‹ç®¡ç†"""

    def __init__(self):
        self.state: Dict[str, Any] = {}
        self.version: Dict[str, int] = {}
        self.history: List[Dict[str, Any]] = []

    def update_state(self, key: str, value: Any, agent_name: str) -> bool:
        """çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼‰"""
        current_version = self.version.get(key, 0)

        # æ›´æ–°ã‚’è¨˜éŒ²
        update_record = {
            "key": key,
            "value": value,
            "agent": agent_name,
            "version": current_version + 1,
            "timestamp": datetime.now().isoformat()
        }

        self.state[key] = value
        self.version[key] = current_version + 1
        self.history.append(update_record)

        return True

    def get_state(self, key: str, version: Optional[int] = None) -> Optional[Any]:
        """çŠ¶æ…‹ã‚’å–å¾—ï¼ˆç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³å¯¾å¿œï¼‰"""
        if version is None:
            return self.state.get(key)

        # å±¥æ­´ã‹ã‚‰ç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ¤œç´¢
        for record in reversed(self.history):
            if record["key"] == key and record["version"] == version:
                return record["value"]

        return None

    def resolve_conflict(self, key: str, conflicting_values: List[Dict[str, Any]]) -> Any:
        """ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’è§£æ±º"""
        # æœ€æ–°ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®å€¤ã‚’æ¡ç”¨ï¼ˆLast-Write-Winsï¼‰
        latest = max(conflicting_values, key=lambda x: x["timestamp"])
        return latest["value"]

# ä½¿ç”¨ä¾‹
state_manager = StateManager()

# è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒåŒã˜ã‚­ãƒ¼ã‚’æ›´æ–°
state_manager.update_state("document_title", "AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¥é–€", "agent1")
state_manager.update_state("document_title", "AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Œå…¨ã‚¬ã‚¤ãƒ‰", "agent2")

# æœ€æ–°ã®å€¤ã‚’å–å¾—
current_title = state_manager.get_state("document_title")
print(f"ç¾åœ¨ã®ã‚¿ã‚¤ãƒˆãƒ«: {current_title}")

# å±¥æ­´ã‚’ç¢ºèª
print("\næ›´æ–°å±¥æ­´:")
for record in state_manager.history:
    print(f"  v{record['version']}: {record['value']} (by {record['agent']})")
</code></pre>

        <h2 id="summary">ã¾ã¨ã‚</h2>

        <h3>ã“ã®ç« ã§å­¦ã‚“ã ã“ã¨</h3>
        <ul>
            <li>âœ… <strong>ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­è¨ˆ</strong>: å½¹å‰²åˆ†æ‹…ã¨å°‚é–€åŒ–</li>
            <li>âœ… <strong>é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«</strong>: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒƒã‚·ãƒ³ã‚°ã¨å…±æœ‰ãƒ¡ãƒ¢ãƒª</li>
            <li>âœ… <strong>å”èª¿ãƒ‘ã‚¿ãƒ¼ãƒ³</strong>: ä¸¦åˆ—ã€é †æ¬¡ã€éšå±¤å‹ã®å®Ÿè£…</li>
            <li>âœ… <strong>ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</strong>: ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦ã¨èª¿æ•´</li>
            <li>âœ… <strong>çŠ¶æ…‹ç®¡ç†</strong>: åˆ†æ•£çŠ¶æ…‹ã®åŒæœŸã¨ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±º</li>
        </ul>

        <h3>è¨­è¨ˆã®åŸå‰‡</h3>
        <blockquote>
            <p><strong>åŠ¹æœçš„ãªãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ </strong>ã¯ã€æ˜ç¢ºãªå½¹å‰²åˆ†æ‹…ã€åŠ¹ç‡çš„ãªé€šä¿¡ã€é©åˆ‡ãªã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ãã—ã¦å …ç‰¢ãªçŠ¶æ…‹ç®¡ç†ã«ã‚ˆã£ã¦å®Ÿç¾ã•ã‚Œã‚‹</p>
        </blockquote>

        <div class="nav-buttons">
            <a href="./chapter2-tool-use.html" class="nav-button">â† ç¬¬2ç« : ãƒ„ãƒ¼ãƒ«ä½¿ç”¨</a>
            <a href="./chapter4-applications.html" class="nav-button">ç¬¬4ç« : å®Ÿè·µå¿œç”¨ â†’</a>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 AI Terakoya - Dr. Yusuke Hashimoto, Tohoku University</p>
            <p>Licensed under CC BY 4.0</p>
        </div>
    </footer>
</body>
</html>
