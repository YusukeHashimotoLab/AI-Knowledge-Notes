<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å®Ÿè·µçš„ãªå¿œç”¨ - AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¥é–€ã‚·ãƒªãƒ¼ã‚º ç¬¬4ç« ">
    <title>ç¬¬4ç« : å®Ÿè·µçš„ãªå¿œç”¨ - AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¥é–€ã‚·ãƒªãƒ¼ã‚º</title>

    <!-- MathJax for formulas -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>

    <!-- CSS Styling -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #667eea;
            --accent-color: #764ba2;
            --bg-color: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --code-bg: #f5f5f5;
            --link-color: #667eea;
            --link-hover: #764ba2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header .container {
            padding: 0 1.5rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .meta {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            font-size: 0.9rem;
            opacity: 0.95;
            margin-top: 1rem;
        }

        .meta span {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        h2 {
            font-size: 1.75rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--secondary-color);
            color: var(--primary-color);
        }

        h3 {
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 0.8rem;
            color: var(--primary-color);
        }

        h4 {
            font-size: 1.2rem;
            margin-top: 1.5rem;
            margin-bottom: 0.6rem;
            color: var(--primary-color);
        }

        p {
            margin-bottom: 1.2rem;
        }

        a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1.2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        pre code {
            background: none;
            padding: 0;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            display: block;
        }

        thead {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        th, td {
            padding: 0.8rem;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        blockquote {
            border-left: 4px solid var(--secondary-color);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: #666;
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .mermaid {
            text-align: center;
            margin: 2rem 0;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        details {
            margin: 1rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            padding: 0.5rem;
        }

        summary:hover {
            color: var(--secondary-color);
        }

        footer {
            margin-top: 4rem;
            padding: 2rem 0;
            border-top: 2px solid var(--border-color);
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin: 3rem 0;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-button {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: var(--secondary-color);
            color: white;
            border-radius: 6px;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 600;
        }

        .nav-button:hover {
            background: var(--link-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.6rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            pre {
                padding: 1rem;
                font-size: 0.85rem;
            }

            table {
                font-size: 0.9rem;
            }
        }
    
        .feedback-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 2rem;
            margin: 3rem auto;
            max-width: 900px;
        }

        .feedback-notice h3 {
            color: #856404;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .feedback-notice p {
            color: #856404;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .feedback-options {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .feedback-button {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .feedback-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

    </style>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({ startOnLoad: true, theme: 'default' });
            }
        });
    </script>
</head>
<body>
    <header>
        <div class="container">
            <h1>ç¬¬4ç« : å®Ÿè·µçš„ãªå¿œç”¨</h1>
            <p style="font-size: 1.1rem; margin-top: 0.5rem; opacity: 0.95;">å®Ÿç”¨çš„ãªAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰</p>
            <div class="meta">
                <span>ğŸ“– èª­äº†æ™‚é–“: 30-40åˆ†</span>
                <span>ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š-ä¸Šç´š</span>
                <span>ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 6å€‹</span>
            </div>
        </div>
    </header>

    <main class="container">
        <h2 id="intro">å®Ÿç”¨çš„ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h2>

        <p>ã“ã®ç« ã§ã¯ã€å‰ã®ç« ã§å­¦ã‚“ã æŠ€è¡“ã‚’çµ±åˆã—ã¦ã€å®Ÿéš›ã®ãƒ“ã‚¸ãƒã‚¹ã‚·ãƒ¼ãƒ³ã§æ´»ç”¨ã§ãã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>

        <h3>ä¸»è¦ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</h3>
        <table>
            <thead>
                <tr>
                    <th>ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</th>
                    <th>ä¸»è¦æ©Ÿèƒ½</th>
                    <th>ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹</td>
                    <td>FAQå¯¾å¿œã€å•ã„åˆã‚ã›åˆ†é¡ã€ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</td>
                    <td>24/7å¯¾å¿œã€ã‚³ã‚¹ãƒˆå‰Šæ¸›ã€æº€è¶³åº¦å‘ä¸Š</td>
                </tr>
                <tr>
                    <td>ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</td>
                    <td>è¦ä»¶åˆ†æã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒãƒƒã‚°</td>
                    <td>é–‹ç™ºé€Ÿåº¦å‘ä¸Šã€å“è³ªæ”¹å–„</td>
                </tr>
                <tr>
                    <td>ãƒªã‚µãƒ¼ãƒã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</td>
                    <td>æƒ…å ±åé›†ã€åˆ†æã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</td>
                    <td>èª¿æŸ»æ™‚é–“å‰Šæ¸›ã€æ´å¯Ÿã®è³ªå‘ä¸Š</td>
                </tr>
                <tr>
                    <td>ã‚¿ã‚¹ã‚¯è‡ªå‹•åŒ–</td>
                    <td>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã€ãƒ‡ãƒ¼ã‚¿å‡¦ç†</td>
                    <td>æ¥­å‹™åŠ¹ç‡åŒ–ã€ã‚¨ãƒ©ãƒ¼å‰Šæ¸›</td>
                </tr>
            </tbody>
        </table>

        <h2 id="customer-service">ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</h2>

        <h3>ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ</h3>

        <div class="mermaid">
graph TD
    U[ãƒ¦ãƒ¼ã‚¶ãƒ¼] --> C[åˆ†é¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
    C --> |FAQ| F[FAQå¿œç­”ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
    C --> |æŠ€è¡“çš„å•é¡Œ| T[æŠ€è¡“ã‚µãƒãƒ¼ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
    C --> |æ³¨æ–‡é–¢é€£| O[æ³¨æ–‡å‡¦ç†ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
    C --> |è¤‡é›‘ãªå•é¡Œ| H[äººé–“ã¸ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³]

    F --> R[å¿œç­”ç”Ÿæˆ]
    T --> R
    O --> R
    R --> U

    style C fill:#e3f2fd
    style F fill:#fff3e0
    style T fill:#f3e5f5
    style O fill:#e8f5e9
    style H fill:#ffebee
</div>

        <h3>å®Ÿè£…ä¾‹</h3>

        <pre><code class="language-python">from openai import OpenAI
from typing import Dict, Any, Optional
import json

class CustomerServiceAgent:
    """ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""

    def __init__(self, api_key: str):
        self.client = OpenAI(api_key=api_key)
        self.conversation_history = []

        # ãƒ„ãƒ¼ãƒ«å®šç¾©
        self.tools = [
            {
                "type": "function",
                "function": {
                    "name": "search_faq",
                    "description": "FAQãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰é–¢é€£æƒ…å ±ã‚’æ¤œç´¢",
                    "parameters": {
                        "type": "object",
                        "properties": {
                            "query": {
                                "type": "string",
                                "description": "æ¤œç´¢ã‚¯ã‚¨ãƒª"
                            }
                        },
                        "required": ["query"]
                    }
                }
            },
            {
                "type": "function",
                "function": {
                    "name": "get_order_status",
                    "description": "æ³¨æ–‡çŠ¶æ³ã‚’ç¢ºèª",
                    "parameters": {
                        "type": "object",
                        "properties": {
                            "order_id": {
                                "type": "string",
                                "description": "æ³¨æ–‡ç•ªå·"
                            }
                        },
                        "required": ["order_id"]
                    }
                }
            },
            {
                "type": "function",
                "function": {
                    "name": "escalate_to_human",
                    "description": "äººé–“ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
                    "parameters": {
                        "type": "object",
                        "properties": {
                            "reason": {
                                "type": "string",
                                "description": "ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç†ç”±"
                            },
                            "priority": {
                                "type": "string",
                                "enum": ["low", "medium", "high"],
                                "description": "å„ªå…ˆåº¦"
                            }
                        },
                        "required": ["reason"]
                    }
                }
            }
        ]

        self.system_prompt = """ã‚ãªãŸã¯è¦ªåˆ‡ã§æœ‰èƒ½ãªã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚

å¯¾å¿œæ–¹é‡:
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å•é¡Œã‚’æ­£ç¢ºã«ç†è§£ã™ã‚‹
2. é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦æƒ…å ±ã‚’åé›†ã™ã‚‹
3. æ˜ç¢ºã§è¦ªåˆ‡ãªå›ç­”ã‚’æä¾›ã™ã‚‹
4. è¤‡é›‘ãªå•é¡Œã‚„é‡è¦ãªæ¡ˆä»¶ã¯äººé–“ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹

ãƒˆãƒ¼ãƒ³:
- è¦ªã—ã¿ã‚„ã™ãã€ä¸å¯§
- å…±æ„Ÿã‚’ç¤ºã™
- å°‚é–€çš„ã‹ã¤ã‚ã‹ã‚Šã‚„ã™ã„

åˆ¶ç´„:
- æ¨æ¸¬ã§ç­”ãˆãªã„
- å€‹äººæƒ…å ±ã¯æ…é‡ã«æ‰±ã†
- ç¢ºå®Ÿã§ãªã„å ´åˆã¯ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"""

    def handle_inquiry(self, user_message: str) -> str:
        """å•ã„åˆã‚ã›ã‚’å‡¦ç†"""
        self.conversation_history.append({
            "role": "user",
            "content": user_message
        })

        max_iterations = 5
        for _ in range(max_iterations):
            # LLMã«å•ã„åˆã‚ã›
            response = self.client.chat.completions.create(
                model="gpt-4",
                messages=[
                    {"role": "system", "content": self.system_prompt}
                ] + self.conversation_history,
                tools=self.tools,
                tool_choice="auto",
                temperature=0.7
            )

            message = response.choices[0].message

            if not message.tool_calls:
                # æœ€çµ‚å›ç­”
                self.conversation_history.append({
                    "role": "assistant",
                    "content": message.content
                })
                return message.content

            # ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’å‡¦ç†
            self.conversation_history.append(message)

            for tool_call in message.tool_calls:
                function_name = tool_call.function.name
                function_args = json.loads(tool_call.function.arguments)

                # ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ
                if function_name == "search_faq":
                    result = self.search_faq(**function_args)
                elif function_name == "get_order_status":
                    result = self.get_order_status(**function_args)
                elif function_name == "escalate_to_human":
                    result = self.escalate_to_human(**function_args)
                else:
                    result = {"error": "Unknown tool"}

                # çµæœã‚’è¿½åŠ 
                self.conversation_history.append({
                    "role": "tool",
                    "tool_call_id": tool_call.id,
                    "name": function_name,
                    "content": json.dumps(result, ensure_ascii=False)
                })

        return "ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚å‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ãŠã‚Šã¾ã™ã€‚æ‹…å½“è€…ã«ãŠã¤ãªãã„ãŸã—ã¾ã™ã€‚"

    def search_faq(self, query: str) -> Dict[str, Any]:
        """FAQã‚’æ¤œç´¢ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰"""
        faq_database = {
            "è¿”å“": {
                "answer": "å•†å“åˆ°ç€å¾Œ30æ—¥ä»¥å†…ã§ã‚ã‚Œã°è¿”å“å¯èƒ½ã§ã™ã€‚æœªé–‹å°ãƒ»æœªä½¿ç”¨ã®å•†å“ã«é™ã‚Šã¾ã™ã€‚",
                "related_links": ["è¿”å“ãƒãƒªã‚·ãƒ¼", "è¿”å“ãƒ•ã‚©ãƒ¼ãƒ "]
            },
            "é…é€": {
                "answer": "é€šå¸¸ã€ã”æ³¨æ–‡ã‹ã‚‰3-5å–¶æ¥­æ—¥ã§ãŠå±Šã‘ã—ã¾ã™ã€‚ãŠæ€¥ãã®å ´åˆã¯ç‰¹æ€¥ä¾¿ã‚‚ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚",
                "related_links": ["é…é€ã‚ªãƒ—ã‚·ãƒ§ãƒ³", "é…é€æ–™é‡‘"]
            },
            "æ”¯æ‰•ã„": {
                "answer": "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€éŠ€è¡ŒæŒ¯è¾¼ã€ã‚³ãƒ³ãƒ“ãƒ‹æ‰•ã„ã«å¯¾å¿œã—ã¦ãŠã‚Šã¾ã™ã€‚",
                "related_links": ["æ”¯æ‰•ã„æ–¹æ³•", "æ±ºæ¸ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£"]
            }
        }

        # ç°¡æ˜“çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°
        for key, value in faq_database.items():
            if key in query:
                return {
                    "found": True,
                    "answer": value["answer"],
                    "related_links": value["related_links"]
                }

        return {
            "found": False,
            "message": "è©²å½“ã™ã‚‹FAQãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
        }

    def get_order_status(self, order_id: str) -> Dict[str, Any]:
        """æ³¨æ–‡çŠ¶æ³ã‚’å–å¾—ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰"""
        # å®Ÿéš›ã«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—
        mock_orders = {
            "ORD-12345": {
                "status": "é…é€ä¸­",
                "tracking_number": "TRK-98765",
                "estimated_delivery": "2025å¹´10æœˆ27æ—¥"
            },
            "ORD-67890": {
                "status": "æº–å‚™ä¸­",
                "estimated_shipping": "2025å¹´10æœˆ26æ—¥"
            }
        }

        if order_id in mock_orders:
            return {
                "found": True,
                "order_id": order_id,
                **mock_orders[order_id]
            }
        else:
            return {
                "found": False,
                "message": f"æ³¨æ–‡ç•ªå· {order_id} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
            }

    def escalate_to_human(self, reason: str, priority: str = "medium") -> Dict[str, Any]:
        """äººé–“ã¸ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰"""
        # å®Ÿéš›ã«ã¯ãƒã‚±ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚„CRMã«é€ä¿¡
        ticket_id = f"TICKET-{int(time.time())}"

        return {
            "escalated": True,
            "ticket_id": ticket_id,
            "priority": priority,
            "estimated_response": "30åˆ†ä»¥å†…"
        }

# ä½¿ç”¨ä¾‹
import time

agent = CustomerServiceAgent(api_key="your-api-key")

# ä¾‹1: FAQè³ªå•
response1 = agent.handle_inquiry("è¿”å“ãƒãƒªã‚·ãƒ¼ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„")
print(f"ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: {response1}\n")

# ä¾‹2: æ³¨æ–‡çŠ¶æ³ç¢ºèª
response2 = agent.handle_inquiry("æ³¨æ–‡ç•ªå·ORD-12345ã®é…é€çŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„")
print(f"ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: {response2}\n")

# ä¾‹3: è¤‡é›‘ãªå•é¡Œï¼ˆã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
response3 = agent.handle_inquiry("æ³¨æ–‡ã—ãŸå•†å“ãŒç ´æã—ã¦ã„ã¾ã—ãŸã€‚è¿”é‡‘ã—ã¦ãã ã•ã„")
print(f"ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: {response3}")
</code></pre>

        <h2 id="code-generation">ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</h2>

        <h3>ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</h3>

        <pre><code class="language-python">from openai import OpenAI
from typing import Dict, Any, List

class CodeGenerationAgent:
    """ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, api_key: str):
        self.client = OpenAI(api_key=api_key)

    def generate_code(self, requirement: str) -> Dict[str, Any]:
        """è¦ä»¶ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ"""
        # ã‚¹ãƒ†ãƒƒãƒ—1: è¦ä»¶åˆ†æ
        analysis = self.analyze_requirements(requirement)

        # ã‚¹ãƒ†ãƒƒãƒ—2: ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        code = self.generate_implementation(analysis)

        # ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ†ã‚¹ãƒˆç”Ÿæˆ
        tests = self.generate_tests(code, analysis)

        # ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ¬ãƒ“ãƒ¥ãƒ¼
        review = self.review_code(code, tests)

        return {
            "analysis": analysis,
            "code": code,
            "tests": tests,
            "review": review
        }

    def analyze_requirements(self, requirement: str) -> Dict[str, Any]:
        """è¦ä»¶ã‚’åˆ†æ"""
        prompt = f"""ä»¥ä¸‹ã®è¦ä»¶ã‚’åˆ†æã—ã€JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

è¦ä»¶: {requirement}

å‡ºåŠ›å½¢å¼:
{{
    "functionality": "ä¸»è¦æ©Ÿèƒ½ã®èª¬æ˜",
    "inputs": ["å…¥åŠ›1", "å…¥åŠ›2"],
    "outputs": ["å‡ºåŠ›1", "å‡ºåŠ›2"],
    "edge_cases": ["ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹1", "ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹2"],
    "suggested_approach": "å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ"
}}"""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0
        )

        return json.loads(response.choices[0].message.content)

    def generate_implementation(self, analysis: Dict[str, Any]) -> str:
        """å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ"""
        prompt = f"""ä»¥ä¸‹ã®åˆ†æçµæœã«åŸºã¥ã„ã¦ã€Pythonã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

åˆ†æçµæœ:
{json.dumps(analysis, indent=2, ensure_ascii=False)}

è¦ä»¶:
- å‹ãƒ’ãƒ³ãƒˆã‚’ä½¿ç”¨
- Docstringã‚’å«ã‚ã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…
- PEP 8ã«æº–æ‹ 

ã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:"""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.3
        )

        return response.choices[0].message.content

    def generate_tests(self, code: str, analysis: Dict[str, Any]) -> str:
        """ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ"""
        prompt = f"""ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹pytestãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã‚³ãƒ¼ãƒ‰:
{code}

åˆ†æçµæœ:
{json.dumps(analysis, indent=2, ensure_ascii=False)}

è¦ä»¶:
- æ­£å¸¸ç³»ã®ãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç›®æŒ‡ã™

pytestã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:"""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.3
        )

        return response.choices[0].message.content

    def review_code(self, code: str, tests: str) -> Dict[str, Any]:
        """ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼"""
        prompt = f"""ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¨ãƒ†ã‚¹ãƒˆã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€JSONå½¢å¼ã§è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚

ã‚³ãƒ¼ãƒ‰:
{code}

ãƒ†ã‚¹ãƒˆ:
{tests}

è©•ä¾¡é …ç›®:
- å¯èª­æ€§ (1-10)
- ä¿å®ˆæ€§ (1-10)
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ (1-10)
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (1-10)
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ (1-10)

å‡ºåŠ›å½¢å¼:
{{
    "scores": {{"readability": 8, "maintainability": 7, ...}},
    "strengths": ["å¼·ã¿1", "å¼·ã¿2"],
    "improvements": ["æ”¹å–„ç‚¹1", "æ”¹å–„ç‚¹2"],
    "overall_assessment": "ç·åˆè©•ä¾¡"
}}"""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.5
        )

        return json.loads(response.choices[0].message.content)

# ä½¿ç”¨ä¾‹
agent = CodeGenerationAgent(api_key="your-api-key")

requirement = """
ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
ä»¥ä¸‹ã®è¦ä»¶ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™:
- RFC 5322ã«æº–æ‹ 
- ä¸€èˆ¬çš„ãªå½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³
"""

result = agent.generate_code(requirement)

print("=== è¦ä»¶åˆ†æ ===")
print(json.dumps(result["analysis"], indent=2, ensure_ascii=False))

print("\n=== ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ ===")
print(result["code"])

print("\n=== ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ ===")
print(result["tests"])

print("\n=== ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ ===")
print(json.dumps(result["review"], indent=2, ensure_ascii=False))
</code></pre>

        <h2 id="research">ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</h2>

        <h3>è‡ªå‹•èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</h3>

        <pre><code class="language-python">from openai import OpenAI
import requests
from typing import List, Dict, Any

class ResearchAgent:
    """ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""

    def __init__(self, api_key: str, serp_api_key: str = None):
        self.client = OpenAI(api_key=api_key)
        self.serp_api_key = serp_api_key

    def research(self, topic: str, depth: str = "medium") -> Dict[str, Any]:
        """ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦èª¿æŸ»"""
        # ã‚¹ãƒ†ãƒƒãƒ—1: ãƒªã‚µãƒ¼ãƒã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆ
        queries = self.generate_search_queries(topic, depth)

        # ã‚¹ãƒ†ãƒƒãƒ—2: æƒ…å ±åé›†
        search_results = self.gather_information(queries)

        # ã‚¹ãƒ†ãƒƒãƒ—3: æƒ…å ±ã‚’åˆ†æ
        analysis = self.analyze_information(topic, search_results)

        # ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        report = self.generate_report(topic, analysis)

        return {
            "topic": topic,
            "queries": queries,
            "sources": len(search_results),
            "analysis": analysis,
            "report": report
        }

    def generate_search_queries(self, topic: str, depth: str) -> List[str]:
        """æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆ"""
        num_queries = {"shallow": 3, "medium": 5, "deep": 8}[depth]

        prompt = f"""ãƒˆãƒ”ãƒƒã‚¯ã€Œ{topic}ã€ã«ã¤ã„ã¦èª¿æŸ»ã™ã‚‹ãŸã‚ã®æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’{num_queries}å€‹ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

è¦ä»¶:
- ç•°ãªã‚‹è¦–ç‚¹ã‹ã‚‰ã®ã‚¯ã‚¨ãƒª
- æœ€æ–°æƒ…å ±ã¨èƒŒæ™¯æƒ…å ±ã®ä¸¡æ–¹
- å…·ä½“çš„ã§æ¤œç´¢åŠ¹ç‡ã®è‰¯ã„ã‚¯ã‚¨ãƒª

JSONé…åˆ—å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„: ["ã‚¯ã‚¨ãƒª1", "ã‚¯ã‚¨ãƒª2", ...]"""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.7
        )

        return json.loads(response.choices[0].message.content)

    def gather_information(self, queries: List[str]) -> List[Dict[str, Any]]:
        """æƒ…å ±ã‚’åé›†"""
        results = []

        for query in queries:
            # å®Ÿéš›ã«ã¯SerpAPIãªã©ã‚’ä½¿ç”¨
            # ã“ã“ã§ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
            results.append({
                "query": query,
                "title": f"{query}ã«é–¢ã™ã‚‹æƒ…å ±",
                "snippet": f"{query}ã«ã¤ã„ã¦ã®è©³ç´°ãªæƒ…å ±...",
                "source": "example.com",
                "relevance_score": 0.85
            })

        return results

    def analyze_information(self, topic: str, results: List[Dict[str, Any]]) -> Dict[str, Any]:
        """æƒ…å ±ã‚’åˆ†æ"""
        # çµæœã‚’çµ±åˆ
        combined_info = "\n\n".join([
            f"ã€{r['query']}ã€‘\n{r['snippet']}"
            for r in results
        ])

        prompt = f"""ä»¥ä¸‹ã®æƒ…å ±ã‚’åˆ†æã—ã€ãƒˆãƒ”ãƒƒã‚¯ã€Œ{topic}ã€ã«ã¤ã„ã¦è¦ç´„ã—ã¦ãã ã•ã„ã€‚

åé›†ã—ãŸæƒ…å ±:
{combined_info}

ä»¥ä¸‹ã®å½¢å¼ã§JSONå‡ºåŠ›ã—ã¦ãã ã•ã„:
{{
    "key_findings": ["ç™ºè¦‹1", "ç™ºè¦‹2", "ç™ºè¦‹3"],
    "trends": ["ãƒˆãƒ¬ãƒ³ãƒ‰1", "ãƒˆãƒ¬ãƒ³ãƒ‰2"],
    "challenges": ["èª²é¡Œ1", "èª²é¡Œ2"],
    "opportunities": ["æ©Ÿä¼š1", "æ©Ÿä¼š2"],
    "summary": "å…¨ä½“ã®è¦ç´„"
}}"""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.5
        )

        return json.loads(response.choices[0].message.content)

    def generate_report(self, topic: str, analysis: Dict[str, Any]) -> str:
        """ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ"""
        prompt = f"""ä»¥ä¸‹ã®åˆ†æçµæœã‚’åŸºã«ã€ãƒˆãƒ”ãƒƒã‚¯ã€Œ{topic}ã€ã«ã¤ã„ã¦ã®èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

åˆ†æçµæœ:
{json.dumps(analysis, indent=2, ensure_ascii=False)}

ãƒ¬ãƒãƒ¼ãƒˆè¦ä»¶:
- ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼
- ä¸»è¦ãªç™ºè¦‹
- ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- èª²é¡Œã¨æ©Ÿä¼š
- çµè«–ã¨æ¨å¥¨äº‹é …
- 1500-2000æ–‡å­—ç¨‹åº¦

ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ“ã‚¸ãƒã‚¹ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„:"""

        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.7
        )

        return response.choices[0].message.content

# ä½¿ç”¨ä¾‹
agent = ResearchAgent(api_key="your-api-key")

result = agent.research("2024å¹´ã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæŠ€è¡“å‹•å‘", depth="medium")

print("=== èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ ===")
print(result["report"])

print(f"\næƒ…å ±æºæ•°: {result['sources']}")
print(f"ä½¿ç”¨ã‚¯ã‚¨ãƒª: {', '.join(result['queries'])}")
</code></pre>

        <h2 id="task-automation">ã‚¿ã‚¹ã‚¯è‡ªå‹•åŒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</h2>

        <h3>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è‡ªå‹•åŒ–</h3>

        <pre><code class="language-python">from typing import List, Dict, Any, Callable
from dataclasses import dataclass
from enum import Enum

class TaskStatus(Enum):
    PENDING = "pending"
    RUNNING = "running"
    COMPLETED = "completed"
    FAILED = "failed"

@dataclass
class Task:
    """ã‚¿ã‚¹ã‚¯å®šç¾©"""
    id: str
    name: str
    action: Callable
    dependencies: List[str]
    status: TaskStatus = TaskStatus.PENDING
    result: Any = None
    error: str = None

class WorkflowAutomationAgent:
    """ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è‡ªå‹•åŒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""

    def __init__(self):
        self.tasks: Dict[str, Task] = {}
        self.execution_log: List[Dict[str, Any]] = []

    def add_task(self, task: Task):
        """ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ """
        self.tasks[task.id] = task

    def execute_workflow(self) -> Dict[str, Any]:
        """ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ"""
        # ãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«ã‚½ãƒ¼ãƒˆã§å®Ÿè¡Œé †åºã‚’æ±ºå®š
        execution_order = self._topological_sort()

        for task_id in execution_order:
            task = self.tasks[task_id]

            # ä¾å­˜ã‚¿ã‚¹ã‚¯ã®å®Œäº†ã‚’ç¢ºèª
            if not self._dependencies_satisfied(task):
                task.status = TaskStatus.FAILED
                task.error = "ä¾å­˜ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“"
                continue

            # ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ
            try:
                task.status = TaskStatus.RUNNING
                self._log_event(f"ã‚¿ã‚¹ã‚¯é–‹å§‹: {task.name}")

                # ä¾å­˜ã‚¿ã‚¹ã‚¯ã®çµæœã‚’å–å¾—
                dep_results = {
                    dep_id: self.tasks[dep_id].result
                    for dep_id in task.dependencies
                }

                # ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
                task.result = task.action(dep_results)

                task.status = TaskStatus.COMPLETED
                self._log_event(f"ã‚¿ã‚¹ã‚¯å®Œäº†: {task.name}")

            except Exception as e:
                task.status = TaskStatus.FAILED
                task.error = str(e)
                self._log_event(f"ã‚¿ã‚¹ã‚¯å¤±æ•—: {task.name} - {str(e)}")

        return self._generate_summary()

    def _dependencies_satisfied(self, task: Task) -> bool:
        """ä¾å­˜ã‚¿ã‚¹ã‚¯ãŒå…¨ã¦å®Œäº†ã—ã¦ã„ã‚‹ã‹ç¢ºèª"""
        for dep_id in task.dependencies:
            if dep_id not in self.tasks:
                return False
            if self.tasks[dep_id].status != TaskStatus.COMPLETED:
                return False
        return True

    def _topological_sort(self) -> List[str]:
        """ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œé †åºã‚’æ±ºå®šï¼ˆãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«ã‚½ãƒ¼ãƒˆï¼‰"""
        # ç°¡æ˜“å®Ÿè£…ï¼ˆä¾å­˜é–¢ä¿‚ã®ã‚ã‚‹ã‚¿ã‚¹ã‚¯ã‚’å¾Œã«ï¼‰
        sorted_tasks = []
        visited = set()

        def visit(task_id):
            if task_id in visited:
                return
            visited.add(task_id)

            task = self.tasks[task_id]
            for dep_id in task.dependencies:
                if dep_id in self.tasks:
                    visit(dep_id)

            sorted_tasks.append(task_id)

        for task_id in self.tasks:
            visit(task_id)

        return sorted_tasks

    def _log_event(self, message: str):
        """ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ­ã‚°ã«è¨˜éŒ²"""
        import datetime
        self.execution_log.append({
            "timestamp": datetime.datetime.now().isoformat(),
            "message": message
        })

    def _generate_summary(self) -> Dict[str, Any]:
        """å®Ÿè¡Œçµæœã®ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆ"""
        total = len(self.tasks)
        completed = sum(1 for t in self.tasks.values() if t.status == TaskStatus.COMPLETED)
        failed = sum(1 for t in self.tasks.values() if t.status == TaskStatus.FAILED)

        return {
            "total_tasks": total,
            "completed": completed,
            "failed": failed,
            "success_rate": completed / total if total > 0 else 0,
            "execution_log": self.execution_log
        }

# ä½¿ç”¨ä¾‹: ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

def fetch_data(deps):
    """ãƒ‡ãƒ¼ã‚¿å–å¾—"""
    print("ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...")
    return {"data": [1, 2, 3, 4, 5]}

def clean_data(deps):
    """ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°"""
    data = deps["fetch_data"]["data"]
    print(f"ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ä¸­: {data}")
    cleaned = [x * 2 for x in data]
    return {"cleaned_data": cleaned}

def analyze_data(deps):
    """ãƒ‡ãƒ¼ã‚¿åˆ†æ"""
    cleaned = deps["clean_data"]["cleaned_data"]
    print(f"ãƒ‡ãƒ¼ã‚¿åˆ†æä¸­: {cleaned}")
    avg = sum(cleaned) / len(cleaned)
    return {"average": avg, "count": len(cleaned)}

def generate_report(deps):
    """ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
    analysis = deps["analyze_data"]
    print(f"ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­...")
    report = f"å¹³å‡å€¤: {analysis['average']}, ãƒ‡ãƒ¼ã‚¿æ•°: {analysis['count']}"
    return {"report": report}

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹ç¯‰
workflow = WorkflowAutomationAgent()

workflow.add_task(Task(
    id="fetch_data",
    name="ãƒ‡ãƒ¼ã‚¿å–å¾—",
    action=fetch_data,
    dependencies=[]
))

workflow.add_task(Task(
    id="clean_data",
    name="ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°",
    action=clean_data,
    dependencies=["fetch_data"]
))

workflow.add_task(Task(
    id="analyze_data",
    name="ãƒ‡ãƒ¼ã‚¿åˆ†æ",
    action=analyze_data,
    dependencies=["clean_data"]
))

workflow.add_task(Task(
    id="generate_report",
    name="ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ",
    action=generate_report,
    dependencies=["analyze_data"]
))

# å®Ÿè¡Œ
summary = workflow.execute_workflow()

print("\n=== å®Ÿè¡Œã‚µãƒãƒªãƒ¼ ===")
print(f"ç·ã‚¿ã‚¹ã‚¯æ•°: {summary['total_tasks']}")
print(f"å®Œäº†: {summary['completed']}")
print(f"å¤±æ•—: {summary['failed']}")
print(f"æˆåŠŸç‡: {summary['success_rate']*100:.1f}%")

# ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
report_task = workflow.tasks["generate_report"]
if report_task.status == TaskStatus.COMPLETED:
    print(f"\næœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ: {report_task.result['report']}")
</code></pre>

        <h2 id="evaluation">è©•ä¾¡ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</h2>

        <h3>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ€§èƒ½ã®æ¸¬å®š</h3>

        <pre><code class="language-python">from typing import Dict, Any, List
from dataclasses import dataclass
from datetime import datetime

@dataclass
class AgentMetrics:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹"""
    task_id: str
    success: bool
    latency: float  # ç§’
    token_usage: int
    cost: float  # USD
    user_satisfaction: float  # 1-5
    error_type: str = None

class AgentEvaluator:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self):
        self.metrics: List[AgentMetrics] = []

    def record_execution(self, metrics: AgentMetrics):
        """å®Ÿè¡Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’è¨˜éŒ²"""
        self.metrics.append(metrics)

    def generate_report(self) -> Dict[str, Any]:
        """è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ"""
        if not self.metrics:
            return {"error": "ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ãªã—"}

        total = len(self.metrics)
        successful = sum(1 for m in self.metrics if m.success)

        return {
            "overview": {
                "total_executions": total,
                "success_rate": successful / total,
                "avg_latency": sum(m.latency for m in self.metrics) / total,
                "total_cost": sum(m.cost for m in self.metrics),
                "avg_satisfaction": sum(m.user_satisfaction for m in self.metrics) / total
            },
            "performance": self._analyze_performance(),
            "errors": self._analyze_errors(),
            "recommendations": self._generate_recommendations()
        }

    def _analyze_performance(self) -> Dict[str, Any]:
        """ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ"""
        latencies = [m.latency for m in self.metrics]
        return {
            "p50_latency": sorted(latencies)[len(latencies)//2],
            "p95_latency": sorted(latencies)[int(len(latencies)*0.95)],
            "max_latency": max(latencies)
        }

    def _analyze_errors(self) -> Dict[str, Any]:
        """ã‚¨ãƒ©ãƒ¼åˆ†æ"""
        errors = [m for m in self.metrics if not m.success]
        error_types = {}

        for error in errors:
            error_type = error.error_type or "unknown"
            error_types[error_type] = error_types.get(error_type, 0) + 1

        return {
            "total_errors": len(errors),
            "error_distribution": error_types
        }

    def _generate_recommendations(self) -> List[str]:
        """æ”¹å–„ææ¡ˆã‚’ç”Ÿæˆ"""
        recommendations = []

        # æˆåŠŸç‡ãƒã‚§ãƒƒã‚¯
        success_rate = sum(1 for m in self.metrics if m.success) / len(self.metrics)
        if success_rate < 0.95:
            recommendations.append("æˆåŠŸç‡ãŒ95%æœªæº€ã§ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å¼·åŒ–ã—ã¦ãã ã•ã„")

        # ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãƒã‚§ãƒƒã‚¯
        avg_latency = sum(m.latency for m in self.metrics) / len(self.metrics)
        if avg_latency > 5.0:
            recommendations.append("å¹³å‡ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãŒ5ç§’ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚æœ€é©åŒ–ã‚’æ¤œè¨ã—ã¦ãã ã•ã„")

        # ã‚³ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯
        total_cost = sum(m.cost for m in self.metrics)
        if total_cost > 100:
            recommendations.append(f"ç·ã‚³ã‚¹ãƒˆãŒ${total_cost:.2f}ã§ã™ã€‚ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã‚’æ¤œè¨ã—ã¦ãã ã•ã„")

        return recommendations

# ä½¿ç”¨ä¾‹
evaluator = AgentEvaluator()

# ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨˜éŒ²
evaluator.record_execution(AgentMetrics(
    task_id="task1",
    success=True,
    latency=2.3,
    token_usage=500,
    cost=0.01,
    user_satisfaction=4.5
))

evaluator.record_execution(AgentMetrics(
    task_id="task2",
    success=False,
    latency=10.5,
    token_usage=1000,
    cost=0.02,
    user_satisfaction=2.0,
    error_type="timeout"
))

# ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
report = evaluator.generate_report()
print(json.dumps(report, indent=2, ensure_ascii=False))
</code></pre>

        <h2 id="production">ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³è€ƒæ…®äº‹é …</h2>

        <h3>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã¨ã‚³ã‚¹ãƒˆæœ€é©åŒ–</h3>

        <table>
            <thead>
                <tr>
                    <th>è€ƒæ…®äº‹é …</th>
                    <th>èª²é¡Œ</th>
                    <th>å¯¾ç­–</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong></td>
                    <td>åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¢—åŠ </td>
                    <td>éåŒæœŸå‡¦ç†ã€ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã€æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°</td>
                </tr>
                <tr>
                    <td><strong>ã‚³ã‚¹ãƒˆ</strong></td>
                    <td>APIã‚³ã‚¹ãƒˆã®å¢—å¤§</td>
                    <td>ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã€ãƒ¢ãƒ‡ãƒ«é¸æŠã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–</td>
                </tr>
                <tr>
                    <td><strong>ä¿¡é ¼æ€§</strong></td>
                    <td>APIéšœå®³ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</td>
                    <td>ãƒªãƒˆãƒ©ã‚¤ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼</td>
                </tr>
                <tr>
                    <td><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</strong></td>
                    <td>ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã€ä¸æ­£åˆ©ç”¨</td>
                    <td>èªè¨¼ã€æš—å·åŒ–ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€ç›£æŸ»ãƒ­ã‚°</td>
                </tr>
                <tr>
                    <td><strong>ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</strong></td>
                    <td>å•é¡Œã®æ—©æœŸç™ºè¦‹</td>
                    <td>ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã€ã‚¢ãƒ©ãƒ¼ãƒˆã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</td>
                </tr>
            </tbody>
        </table>

        <h3>ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h3>

        <ul>
            <li>âœ… <strong>ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°</strong>: åŒã˜ã‚¯ã‚¨ãƒªã®çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦APIå‘¼ã³å‡ºã—ã‚’å‰Šæ¸›</li>
            <li>âœ… <strong>éåŒæœŸå‡¦ç†</strong>: asyncioã§ä¸¦åˆ—å‡¦ç†ã‚’å®Ÿè£…</li>
            <li>âœ… <strong>ãƒ¬ãƒ¼ãƒˆåˆ¶é™</strong>: APIã®åˆ©ç”¨åˆ¶é™ã‚’å®ˆã‚‹</li>
            <li>âœ… <strong>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</strong>: ãƒªãƒˆãƒ©ã‚¤ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥</li>
            <li>âœ… <strong>ãƒ­ã‚°ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</strong>: è©³ç´°ãªãƒ­ã‚°è¨˜éŒ²ã¨æ€§èƒ½ç›£è¦–</li>
            <li>âœ… <strong>ã‚³ã‚¹ãƒˆè¿½è·¡</strong>: ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã¨ã‚³ã‚¹ãƒˆã®å¯è¦–åŒ–</li>
            <li>âœ… <strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</strong>: èªè¨¼ã€æš—å·åŒ–ã€å…¥åŠ›æ¤œè¨¼</li>
            <li>âœ… <strong>ãƒ†ã‚¹ãƒˆ</strong>: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€çµ±åˆãƒ†ã‚¹ãƒˆã€E2Eãƒ†ã‚¹ãƒˆ</li>
        </ul>

        <h2 id="summary">ã¾ã¨ã‚</h2>

        <h3>ã“ã®ç« ã§å­¦ã‚“ã ã“ã¨</h3>
        <ul>
            <li>âœ… <strong>ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹</strong>: FAQå¯¾å¿œã€å•ã„åˆã‚ã›åˆ†é¡ã€ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</li>
            <li>âœ… <strong>ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</strong>: è¦ä»¶åˆ†æã€å®Ÿè£…ç”Ÿæˆã€ãƒ†ã‚¹ãƒˆã€ãƒ¬ãƒ“ãƒ¥ãƒ¼</li>
            <li>âœ… <strong>ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</strong>: æƒ…å ±åé›†ã€åˆ†æã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</li>
            <li>âœ… <strong>ã‚¿ã‚¹ã‚¯è‡ªå‹•åŒ–</strong>: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã€ä¾å­˜é–¢ä¿‚ç®¡ç†</li>
            <li>âœ… <strong>è©•ä¾¡ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</strong>: ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã€æ€§èƒ½åˆ†æ</li>
            <li>âœ… <strong>ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³</strong>: ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã€ã‚³ã‚¹ãƒˆã€ä¿¡é ¼æ€§</li>
        </ul>

        <h3>ã‚·ãƒªãƒ¼ã‚ºã®ã¾ã¨ã‚</h3>
        <blockquote>
            <p>AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€LLMã®æ¨è«–èƒ½åŠ›ã¨ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã‚’çµ„ã¿åˆã‚ã›ã€è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã‚’è‡ªå¾‹çš„ã«è§£æ±ºã—ã¾ã™ã€‚åŠ¹æœçš„ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¯ã€æ˜ç¢ºãªå½¹å‰²å®šç¾©ã€å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€é©åˆ‡ãªè©•ä¾¡ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã£ã¦å®Ÿç¾ã•ã‚Œã¾ã™ã€‚</p>
        </blockquote>

        <h3>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>
        <p>ã“ã®ã‚·ãƒªãƒ¼ã‚ºã‚’å®Œäº†ã—ãŸã‚ãªãŸã¯ã€å®Ÿç”¨çš„ãªAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆãƒ»å®Ÿè£…ã§ãã¾ã™ã€‚ã•ã‚‰ã«å­¦ã³ã‚’æ·±ã‚ã‚‹ãŸã‚ã«ï¼š</p>

        <ul>
            <li>ğŸ“š <strong>AutoGPT/BabyAGI</strong>ã‚’æ¢ç´¢ã—ã¦è‡ªå¾‹å‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç†è§£</li>
            <li>ğŸ“š <strong>LangChain/LlamaIndex</strong>ã§é«˜åº¦ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ§‹ç¯‰</li>
            <li>ğŸ“š <strong>å¼·åŒ–å­¦ç¿’</strong>ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æœ€é©åŒ–</li>
            <li>ğŸ“š <strong>å®Ÿãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</strong>ã§å­¦ã‚“ã æŠ€è¡“ã‚’é©ç”¨</li>
        </ul>

        <div class="nav-buttons">
            <a href="./chapter3-multi-agent.html" class="nav-button">â† ç¬¬3ç« : ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</a>
            <a href="./index.html" class="nav-button">ã‚·ãƒªãƒ¼ã‚ºæ¦‚è¦ã¸æˆ»ã‚‹</a>
        </div>
    </main>


        <div class="feedback-notice">
            <h3>âš ï¸ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å“è³ªå‘ä¸Šã«ã”å”åŠ›ãã ã•ã„</h3>
            <p>ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯AIã‚’æ´»ç”¨ã—ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚èª¤ã‚Šã‚„æ”¹å–„ç‚¹ã‚’è¦‹ã¤ã‘ã‚‰ã‚ŒãŸå ´åˆã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ã§ã”å ±å‘Šãã ã•ã„ï¼š</p>
            <div class="feedback-options">
                <a href="https://forms.gle/9GfVBa2Qa7Uy9taQA" target="_blank" class="feedback-button">
                    ğŸ“ ä¿®æ­£ä¾é ¼ãƒ•ã‚©ãƒ¼ãƒ 
                </a>
                <a href="mailto:yusuke.hashimoto.d8@tohoku.ac.jp" class="feedback-button">
                    âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«ã§é€£çµ¡
                </a>
            </div>
        </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 AI Terakoya - Dr. Yusuke Hashimoto, Tohoku University</p>
            <p>Licensed under CC BY 4.0</p>
        </div>
    </footer>
</body>
</html>
