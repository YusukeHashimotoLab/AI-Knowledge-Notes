<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
<meta content="ç¬¬2ç« ï¼šçµ±è¨ˆçš„æ™‚ç³»åˆ—ãƒ¢ãƒ‡ãƒ« - AI Terakoya" name="description"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬2ç« ï¼šçµ±è¨ˆçš„æ™‚ç³»åˆ—ãƒ¢ãƒ‡ãƒ« - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }
        .disclaimer {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            border-radius: 4px;
        }

        .disclaimer h3 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .disclaimer ul {
            list-style: none;
            padding-left: 0;
        }

        .disclaimer li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.6;
        }

        .disclaimer li::before {
            content: "âš ï¸";
            position: absolute;
            left: 0;
        }


        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
            <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/ML/time-series-introduction/chapter2-statistical-models.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="../../ML/index.html">æ©Ÿæ¢°å­¦ç¿’</a><span class="breadcrumb-separator">â€º</span><a href="../../ML/time-series-introduction/index.html">Time Series</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 2</span>
        </div>
    </nav>

        <header>
        <div class="header-content">
            <h1>ç¬¬2ç« ï¼šçµ±è¨ˆçš„æ™‚ç³»åˆ—ãƒ¢ãƒ‡ãƒ«</h1>
            <p class="subtitle">ARã€MAã€ARIMAãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹æ™‚ç³»åˆ—äºˆæ¸¬ã®åŸºç¤</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 30-35åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 10å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 5å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… ARï¼ˆè‡ªå·±å›å¸°ï¼‰ãƒ¢ãƒ‡ãƒ«ã®å®šç¾©ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®šã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… MAï¼ˆç§»å‹•å¹³å‡ï¼‰ãƒ¢ãƒ‡ãƒ«ã®æ§‹é€ ã¨ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºã®é–¢ä¿‚ã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… ARIMAãƒ¢ãƒ‡ãƒ«ã®æ çµ„ã¿ã¨ãƒ¢ãƒ‡ãƒ«é¸æŠæ‰‹æ³•ã‚’ç¿’å¾—ã™ã‚‹</li>
<li>âœ… å­£ç¯€æ€§ARIMAãƒ¢ãƒ‡ãƒ«ï¼ˆSARIMAï¼‰ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… ãƒ¢ãƒ‡ãƒ«ã®è©•ä¾¡ã¨è¨ºæ–­ã‚’é©åˆ‡ã«å®Ÿè¡Œã§ãã‚‹</li>
<li>âœ… statsmodelsã¨pmdarimaï¼ˆauto_arimaï¼‰ã‚’ä½¿ã„ã“ãªã›ã‚‹</li>
</ul>

<hr>

<h2>2.1 ARï¼ˆè‡ªå·±å›å¸°ï¼‰ãƒ¢ãƒ‡ãƒ«</h2>

<h3>ARãƒ¢ãƒ‡ãƒ«ã¨ã¯</h3>
<p><strong>ARï¼ˆAutoRegressiveï¼‰ãƒ¢ãƒ‡ãƒ«</strong>ã¯ã€éå»ã®å€¤ã‚’ä½¿ã£ã¦ç¾åœ¨ã®å€¤ã‚’äºˆæ¸¬ã™ã‚‹ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚</p>

<p>AR(p)ãƒ¢ãƒ‡ãƒ«ã®å®šç¾©ï¼š</p>

<p>$$
y_t = c + \phi_1 y_{t-1} + \phi_2 y_{t-2} + \cdots + \phi_p y_{t-p} + \varepsilon_t
$$</p>

<ul>
<li>$y_t$: æ™‚åˆ»tã®å€¤</li>
<li>$\phi_1, \ldots, \phi_p$: ARãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
<li>$p$: ARã®æ¬¡æ•°ï¼ˆãƒ©ã‚°ã®æ•°ï¼‰</li>
<li>$c$: å®šæ•°é …</li>
<li>$\varepsilon_t$: ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºï¼ˆå¹³å‡0ã€åˆ†æ•£$\sigma^2$ï¼‰</li>
</ul>

<blockquote>
<p><strong>ç›´æ„Ÿçš„ç†è§£</strong>: ã€Œä»Šæ—¥ã®æ°—æ¸©ã¯ã€æ˜¨æ—¥ã¨ä¸€æ˜¨æ—¥ã®æ°—æ¸©ã«å½±éŸ¿ã•ã‚Œã‚‹ã€ã¨ã„ã†è€ƒãˆæ–¹ã§ã™ã€‚</p>
</blockquote>

<h3>ARãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from statsmodels.tsa.ar_model import AutoReg
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf
import warnings
warnings.filterwarnings('ignore')

# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆAR(2)ãƒ—ãƒ­ã‚»ã‚¹ï¼‰
np.random.seed(42)
n = 200
epsilon = np.random.normal(0, 1, n)

# AR(2): y_t = 0.6*y_{t-1} - 0.2*y_{t-2} + epsilon_t
y = np.zeros(n)
for t in range(2, n):
    y[t] = 0.6 * y[t-1] - 0.2 * y[t-2] + epsilon[t]

# æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ•´å½¢
ts_data = pd.Series(y, index=pd.date_range('2020-01-01', periods=n, freq='D'))

print("=== AR(2)ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===")
print(f"ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: {len(ts_data)}")
print(f"å¹³å‡: {ts_data.mean():.3f}")
print(f"æ¨™æº–åå·®: {ts_data.std():.3f}")

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 1, figsize=(12, 10))

# æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆ
axes[0].plot(ts_data, linewidth=1.5)
axes[0].set_xlabel('æ—¥ä»˜')
axes[0].set_ylabel('å€¤')
axes[0].set_title('AR(2)ãƒ—ãƒ­ã‚»ã‚¹', fontsize=14)
axes[0].grid(True, alpha=0.3)

# ACFï¼ˆè‡ªå·±ç›¸é–¢é–¢æ•°ï¼‰
plot_acf(ts_data, lags=30, ax=axes[1])
axes[1].set_title('è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆACFï¼‰', fontsize=14)

# PACFï¼ˆåè‡ªå·±ç›¸é–¢é–¢æ•°ï¼‰
plot_pacf(ts_data, lags=30, ax=axes[2], method='ywm')
axes[2].set_title('åè‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆPACFï¼‰', fontsize=14)

plt.tight_layout()
plt.show()
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== AR(2)ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===
ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: 200
å¹³å‡: -0.012
æ¨™æº–åå·®: 1.456
</code></pre>

<blockquote>
<p><strong>é‡è¦</strong>: PACFã‚’è¦‹ã‚‹ã“ã¨ã§ã€ARã®æ¬¡æ•°pã‚’æ¨å®šã§ãã¾ã™ã€‚PACFãŒpæ¬¡ã§åˆ‡æ–­ï¼ˆã‚«ãƒƒãƒˆã‚ªãƒ•ï¼‰ã•ã‚Œã¾ã™ã€‚</p>
</blockquote>

<h3>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®šã¨ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</h3>

<pre><code class="language-python"># è¨“ç·´ãƒ»ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†å‰²
train_size = int(len(ts_data) * 0.8)
train, test = ts_data[:train_size], ts_data[train_size:]

# AR(2)ãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
model_ar2 = AutoReg(train, lags=2, trend='c')
fitted_ar2 = model_ar2.fit()

print("\n=== AR(2)ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ===")
print(fitted_ar2.summary())

# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—
params = fitted_ar2.params
print(f"\næ¨å®šã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:")
print(f"å®šæ•°é …: {params['const']:.4f}")
print(f"phi_1: {params['y.L1']:.4f} (çœŸå€¤: 0.6)")
print(f"phi_2: {params['y.L2']:.4f} (çœŸå€¤: -0.2)")

# äºˆæ¸¬
predictions = fitted_ar2.predict(start=len(train), end=len(train) + len(test) - 1)

# å¯è¦–åŒ–
plt.figure(figsize=(14, 6))
plt.plot(train.index, train, label='è¨“ç·´ãƒ‡ãƒ¼ã‚¿', linewidth=1.5)
plt.plot(test.index, test, label='å®Ÿæ¸¬å€¤', linewidth=1.5, color='green')
plt.plot(test.index, predictions, label='äºˆæ¸¬å€¤ï¼ˆAR(2)ï¼‰',
         linewidth=2, linestyle='--', color='red')
plt.xlabel('æ—¥ä»˜')
plt.ylabel('å€¤')
plt.title('AR(2)ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹äºˆæ¸¬', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# äºˆæ¸¬ç²¾åº¦
from sklearn.metrics import mean_squared_error, mean_absolute_error
mse = mean_squared_error(test, predictions)
rmse = np.sqrt(mse)
mae = mean_absolute_error(test, predictions)

print(f"\n=== äºˆæ¸¬ç²¾åº¦ ===")
print(f"RMSE: {rmse:.4f}")
print(f"MAE: {mae:.4f}")
</code></pre>

<h3>æ¬¡æ•°é¸æŠï¼ˆAICã€BICï¼‰</h3>

<p><strong>AICï¼ˆèµ¤æ± æƒ…å ±é‡è¦æº–ï¼‰</strong>ã¨<strong>BICï¼ˆãƒ™ã‚¤ã‚ºæƒ…å ±é‡è¦æº–ï¼‰</strong>ã¯ã€ãƒ¢ãƒ‡ãƒ«ã®è¤‡é›‘ã•ã¨ãƒ•ã‚£ãƒƒãƒˆåº¦ã®ãƒãƒ©ãƒ³ã‚¹ã‚’è©•ä¾¡ã™ã‚‹æŒ‡æ¨™ã§ã™ã€‚</p>

<p>$$
\text{AIC} = 2k - 2\ln(L)
$$</p>

<p>$$
\text{BIC} = k\ln(n) - 2\ln(L)
$$</p>

<ul>
<li>$k$: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°</li>
<li>$n$: ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º</li>
<li>$L$: å°¤åº¦</li>
</ul>

<pre><code class="language-python"># ç•°ãªã‚‹æ¬¡æ•°ã®ARãƒ¢ãƒ‡ãƒ«ã‚’æ¯”è¼ƒ
max_lag = 10
aic_values = []
bic_values = []

for p in range(1, max_lag + 1):
    model = AutoReg(train, lags=p, trend='c')
    fitted = model.fit()
    aic_values.append(fitted.aic)
    bic_values.append(fitted.bic)

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

axes[0].plot(range(1, max_lag + 1), aic_values, marker='o', linewidth=2)
axes[0].axvline(x=np.argmin(aic_values) + 1, color='red',
                linestyle='--', label=f'æœ€å°AIC (p={np.argmin(aic_values) + 1})')
axes[0].set_xlabel('ARã®æ¬¡æ•° p')
axes[0].set_ylabel('AIC')
axes[0].set_title('AICã«ã‚ˆã‚‹æ¬¡æ•°é¸æŠ', fontsize=14)
axes[0].legend()
axes[0].grid(True, alpha=0.3)

axes[1].plot(range(1, max_lag + 1), bic_values, marker='s',
             linewidth=2, color='orange')
axes[1].axvline(x=np.argmin(bic_values) + 1, color='red',
                linestyle='--', label=f'æœ€å°BIC (p={np.argmin(bic_values) + 1})')
axes[1].set_xlabel('ARã®æ¬¡æ•° p')
axes[1].set_ylabel('BIC')
axes[1].set_title('BICã«ã‚ˆã‚‹æ¬¡æ•°é¸æŠ', fontsize=14)
axes[1].legend()
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

print(f"\n=== æ¬¡æ•°é¸æŠçµæœ ===")
print(f"æœ€é©æ¬¡æ•°ï¼ˆAICï¼‰: {np.argmin(aic_values) + 1}")
print(f"æœ€é©æ¬¡æ•°ï¼ˆBICï¼‰: {np.argmin(bic_values) + 1}")
print(f"çœŸã®æ¬¡æ•°: 2")
</code></pre>

<hr>

<h2>2.2 MAï¼ˆç§»å‹•å¹³å‡ï¼‰ãƒ¢ãƒ‡ãƒ«</h2>

<h3>MAãƒ¢ãƒ‡ãƒ«ã¨ã¯</h3>
<p><strong>MAï¼ˆMoving Averageï¼‰ãƒ¢ãƒ‡ãƒ«</strong>ã¯ã€éå»ã®äºˆæ¸¬èª¤å·®ï¼ˆãƒã‚¤ã‚ºï¼‰ã®ç·šå½¢çµåˆã§ç¾åœ¨ã®å€¤ã‚’è¡¨ç¾ã—ã¾ã™ã€‚</p>

<p>MA(q)ãƒ¢ãƒ‡ãƒ«ã®å®šç¾©ï¼š</p>

<p>$$
y_t = \mu + \varepsilon_t + \theta_1 \varepsilon_{t-1} + \theta_2 \varepsilon_{t-2} + \cdots + \theta_q \varepsilon_{t-q}
$$</p>

<ul>
<li>$y_t$: æ™‚åˆ»tã®å€¤</li>
<li>$\theta_1, \ldots, \theta_q$: MAãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
<li>$q$: MAã®æ¬¡æ•°</li>
<li>$\mu$: å¹³å‡</li>
<li>$\varepsilon_t$: ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚º</li>
</ul>

<blockquote>
<p><strong>ç›´æ„Ÿçš„ç†è§£</strong>: ã€Œä»Šæ—¥ã®æ°—æ¸©ã¯ã€éå»æ•°æ—¥é–“ã®äºˆæ¸¬èª¤å·®ã®å½±éŸ¿ã‚’å—ã‘ã‚‹ã€ã¨ã„ã†è€ƒãˆæ–¹ã§ã™ã€‚</p>
</blockquote>

<h3>ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºã¨ã®é–¢ä¿‚</h3>

<pre><code class="language-python">from statsmodels.tsa.arima.model import ARIMA

# MA(1)ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
np.random.seed(42)
n = 200
mu = 0
theta = 0.7
epsilon = np.random.normal(0, 1, n)

# MA(1): y_t = mu + epsilon_t + theta*epsilon_{t-1}
y_ma = np.zeros(n)
y_ma[0] = mu + epsilon[0]
for t in range(1, n):
    y_ma[t] = mu + epsilon[t] + theta * epsilon[t-1]

ts_ma = pd.Series(y_ma, index=pd.date_range('2020-01-01', periods=n, freq='D'))

print("=== MA(1)ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===")
print(f"ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: {len(ts_ma)}")
print(f"å¹³å‡: {ts_ma.mean():.3f}")
print(f"æ¨™æº–åå·®: {ts_ma.std():.3f}")

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 1, figsize=(12, 10))

# æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆ
axes[0].plot(ts_ma, linewidth=1.5, color='green')
axes[0].set_xlabel('æ—¥ä»˜')
axes[0].set_ylabel('å€¤')
axes[0].set_title('MA(1)ãƒ—ãƒ­ã‚»ã‚¹', fontsize=14)
axes[0].grid(True, alpha=0.3)

# ACF
plot_acf(ts_ma, lags=30, ax=axes[1])
axes[1].set_title('è‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆACFï¼‰- MA(1)ã§ã¯1æ¬¡ã§åˆ‡æ–­', fontsize=14)

# PACF
plot_pacf(ts_ma, lags=30, ax=axes[2], method='ywm')
axes[2].set_title('åè‡ªå·±ç›¸é–¢é–¢æ•°ï¼ˆPACFï¼‰', fontsize=14)

plt.tight_layout()
plt.show()
</code></pre>

<blockquote>
<p><strong>é‡è¦</strong>: MAãƒ¢ãƒ‡ãƒ«ã§ã¯ã€ACFãŒqæ¬¡ã§åˆ‡æ–­ã•ã‚Œã¾ã™ã€‚ã“ã‚ŒãŒARãƒ¢ãƒ‡ãƒ«ã¨ã®ä¸»ãªè­˜åˆ¥æ–¹æ³•ã§ã™ã€‚</p>
</blockquote>

<h3>MAãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®š</h3>

<pre><code class="language-python"># MA(1)ãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
train_ma = ts_ma[:int(len(ts_ma) * 0.8)]
test_ma = ts_ma[int(len(ts_ma) * 0.8):]

# ARIMA(0,0,1) = MA(1)
model_ma1 = ARIMA(train_ma, order=(0, 0, 1))
fitted_ma1 = model_ma1.fit()

print("\n=== MA(1)ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ===")
print(fitted_ma1.summary())

# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—
print(f"\næ¨å®šã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:")
print(f"theta: {fitted_ma1.params['ma.L1']:.4f} (çœŸå€¤: 0.7)")

# äºˆæ¸¬
forecast_ma = fitted_ma1.forecast(steps=len(test_ma))

# å¯è¦–åŒ–
plt.figure(figsize=(14, 6))
plt.plot(train_ma.index, train_ma, label='è¨“ç·´ãƒ‡ãƒ¼ã‚¿', linewidth=1.5)
plt.plot(test_ma.index, test_ma, label='å®Ÿæ¸¬å€¤', linewidth=1.5, color='green')
plt.plot(test_ma.index, forecast_ma, label='äºˆæ¸¬å€¤ï¼ˆMA(1)ï¼‰',
         linewidth=2, linestyle='--', color='red')
plt.xlabel('æ—¥ä»˜')
plt.ylabel('å€¤')
plt.title('MA(1)ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹äºˆæ¸¬', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()
</code></pre>

<h3>å®Œå…¨ãªä¾‹ï¼šARã¨MAã®æ¯”è¼ƒ</h3>

<pre><code class="language-python"># åŒã˜ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ARã¨MAã‚’ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
np.random.seed(42)
n = 200
# ARMA(1,1)ãƒ—ãƒ­ã‚»ã‚¹
y_arma = np.zeros(n)
epsilon = np.random.normal(0, 1, n)

phi = 0.5
theta = 0.3

for t in range(1, n):
    y_arma[t] = phi * y_arma[t-1] + epsilon[t] + theta * epsilon[t-1]

ts_arma = pd.Series(y_arma, index=pd.date_range('2020-01-01', periods=n, freq='D'))

train_arma = ts_arma[:160]
test_arma = ts_arma[160:]

# AR(2)ã§ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
model_ar = ARIMA(train_arma, order=(2, 0, 0))
fitted_ar = model_ar.fit()

# MA(2)ã§ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
model_ma = ARIMA(train_arma, order=(0, 0, 2))
fitted_ma = model_ma.fit()

# ARMA(1,1)ã§ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆæ­£ã—ã„ãƒ¢ãƒ‡ãƒ«ï¼‰
model_arma = ARIMA(train_arma, order=(1, 0, 1))
fitted_arma = model_arma.fit()

# äºˆæ¸¬
forecast_ar = fitted_ar.forecast(steps=len(test_arma))
forecast_ma = fitted_ma.forecast(steps=len(test_arma))
forecast_arma = fitted_arma.forecast(steps=len(test_arma))

# è©•ä¾¡
from sklearn.metrics import mean_squared_error

rmse_ar = np.sqrt(mean_squared_error(test_arma, forecast_ar))
rmse_ma = np.sqrt(mean_squared_error(test_arma, forecast_ma))
rmse_arma = np.sqrt(mean_squared_error(test_arma, forecast_arma))

print("=== ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒ ===")
print(f"AR(2) - AIC: {fitted_ar.aic:.2f}, RMSE: {rmse_ar:.4f}")
print(f"MA(2) - AIC: {fitted_ma.aic:.2f}, RMSE: {rmse_ma:.4f}")
print(f"ARMA(1,1) - AIC: {fitted_arma.aic:.2f}, RMSE: {rmse_arma:.4f}")

# å¯è¦–åŒ–
plt.figure(figsize=(14, 6))
plt.plot(test_arma.index, test_arma, label='å®Ÿæ¸¬å€¤', linewidth=2, color='black')
plt.plot(test_arma.index, forecast_ar, label='AR(2)', linewidth=1.5, linestyle='--')
plt.plot(test_arma.index, forecast_ma, label='MA(2)', linewidth=1.5, linestyle='--')
plt.plot(test_arma.index, forecast_arma, label='ARMA(1,1)', linewidth=2, linestyle='--')
plt.xlabel('æ—¥ä»˜')
plt.ylabel('å€¤')
plt.title('AR vs MA vs ARMA ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒ', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()
</code></pre>

<hr>

<h2>2.3 ARIMAãƒ¢ãƒ‡ãƒ«</h2>

<h3>ARIMA(p,d,q)ã®æ çµ„ã¿</h3>

<p><strong>ARIMAï¼ˆAutoRegressive Integrated Moving Averageï¼‰ãƒ¢ãƒ‡ãƒ«</strong>ã¯ã€éå®šå¸¸æ™‚ç³»åˆ—ã‚’æ‰±ã†ãŸã‚ã®å¼·åŠ›ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚</p>

<p>ARIMA(p,d,q)ã®æ§‹æˆè¦ç´ ï¼š</p>

<table>
<thead>
<tr>
<th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th>
<th>æ„å‘³</th>
<th>å½¹å‰²</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>p</strong></td>
<td>ARæ¬¡æ•°</td>
<td>éå»ã®å€¤ã¸ã®ä¾å­˜</td>
</tr>
<tr>
<td><strong>d</strong></td>
<td>å·®åˆ†æ¬¡æ•°</td>
<td>éå®šå¸¸æ€§ã®é™¤å»</td>
</tr>
<tr>
<td><strong>q</strong></td>
<td>MAæ¬¡æ•°</td>
<td>éå»ã®èª¤å·®ã¸ã®ä¾å­˜</td>
</tr>
</tbody>
</table>

<p>ARIMA(p,d,q)ãƒ¢ãƒ‡ãƒ«ï¼š</p>

<p>$$
\phi(B)(1-B)^d y_t = \theta(B)\varepsilon_t
$$</p>

<ul>
<li>$B$: ãƒãƒƒã‚¯ã‚·ãƒ•ãƒˆæ¼”ç®—å­ï¼ˆ$By_t = y_{t-1}$ï¼‰</li>
<li>$\phi(B) = 1 - \phi_1 B - \cdots - \phi_p B^p$: ARå¤šé …å¼</li>
<li>$\theta(B) = 1 + \theta_1 B + \cdots + \theta_q B^q$: MAå¤šé …å¼</li>
</ul>

<h3>ãƒ¢ãƒ‡ãƒ«è­˜åˆ¥ã®æ‰‹é †</h3>

<div class="mermaid">
graph TD
    A[æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿] --> B[å®šå¸¸æ€§ã®ç¢ºèª]
    B -->|éå®šå¸¸| C[å·®åˆ†ã‚’å–ã‚‹ d=1,2,...]
    B -->|å®šå¸¸| D[ACF/PACFã®åˆ†æ]
    C --> D
    D --> E{ãƒ‘ã‚¿ãƒ¼ãƒ³è­˜åˆ¥}
    E -->|PACFãŒåˆ‡æ–­| F[ARãƒ¢ãƒ‡ãƒ« p=?]
    E -->|ACFãŒåˆ‡æ–­| G[MAãƒ¢ãƒ‡ãƒ« q=?]
    E -->|ä¸¡æ–¹æ¸›è¡°| H[ARMAãƒ¢ãƒ‡ãƒ« p=?, q=?]
    F --> I[ãƒ¢ãƒ‡ãƒ«æ¨å®š]
    G --> I
    H --> I
    I --> J[è¨ºæ–­: æ®‹å·®ãŒç™½è‰²é›‘éŸ³?]
    J -->|No| K[ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´]
    J -->|Yes| L[æœ€çµ‚ãƒ¢ãƒ‡ãƒ«]
    K --> I

    style A fill:#ffebee
    style L fill:#c8e6c9
    style J fill:#fff3e0
</div>

<h3>ARIMAãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</h3>

<pre><code class="language-python"># éå®šå¸¸æ™‚ç³»åˆ—ã®ç”Ÿæˆï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰ + ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ï¼‰
np.random.seed(42)
n = 300
trend = np.linspace(0, 10, n)
random_walk = np.cumsum(np.random.normal(0, 1, n))
ts_nonstationary = pd.Series(
    trend + random_walk,
    index=pd.date_range('2020-01-01', periods=n, freq='D')
)

# å¯è¦–åŒ–
fig, axes = plt.subplots(3, 1, figsize=(12, 10))

# å…ƒãƒ‡ãƒ¼ã‚¿
axes[0].plot(ts_nonstationary, linewidth=1.5)
axes[0].set_ylabel('å€¤')
axes[0].set_title('éå®šå¸¸æ™‚ç³»åˆ—ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰ + ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ï¼‰', fontsize=14)
axes[0].grid(True, alpha=0.3)

# 1æ¬¡å·®åˆ†
ts_diff1 = ts_nonstationary.diff().dropna()
axes[1].plot(ts_diff1, linewidth=1.5, color='orange')
axes[1].set_ylabel('1æ¬¡å·®åˆ†')
axes[1].set_title('1æ¬¡å·®åˆ†ç³»åˆ—ï¼ˆd=1ï¼‰', fontsize=14)
axes[1].axhline(y=0, color='red', linestyle='--', alpha=0.5)
axes[1].grid(True, alpha=0.3)

# 2æ¬¡å·®åˆ†
ts_diff2 = ts_diff1.diff().dropna()
axes[2].plot(ts_diff2, linewidth=1.5, color='green')
axes[2].set_xlabel('æ—¥ä»˜')
axes[2].set_ylabel('2æ¬¡å·®åˆ†')
axes[2].set_title('2æ¬¡å·®åˆ†ç³»åˆ—ï¼ˆd=2ï¼‰', fontsize=14)
axes[2].axhline(y=0, color='red', linestyle='--', alpha=0.5)
axes[2].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

# å®šå¸¸æ€§æ¤œå®šï¼ˆADFæ¤œå®šï¼‰
from statsmodels.tsa.stattools import adfuller

def adf_test(series, name=''):
    result = adfuller(series.dropna())
    print(f'\n=== ADFæ¤œå®š: {name} ===')
    print(f'ADFçµ±è¨ˆé‡: {result[0]:.4f}')
    print(f'på€¤: {result[1]:.4f}')
    print(f'è‡¨ç•Œå€¤:')
    for key, value in result[4].items():
        print(f'  {key}: {value:.4f}')
    if result[1] <= 0.05:
        print("â†’ å®šå¸¸ï¼ˆ5%æœ‰æ„æ°´æº–ã§å¸°ç„¡ä»®èª¬ã‚’æ£„å´ï¼‰")
    else:
        print("â†’ éå®šå¸¸ï¼ˆå¸°ç„¡ä»®èª¬ã‚’æ£„å´ã§ããªã„ï¼‰")

adf_test(ts_nonstationary, 'å…ƒãƒ‡ãƒ¼ã‚¿')
adf_test(ts_diff1, '1æ¬¡å·®åˆ†')
adf_test(ts_diff2, '2æ¬¡å·®åˆ†')
</code></pre>

<h3>ARIMAãƒ¢ãƒ‡ãƒ«ã®æ¨å®šã¨äºˆæ¸¬</h3>

<pre><code class="language-python"># è¨“ç·´ãƒ»ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†å‰²
train_size = int(len(ts_nonstationary) * 0.8)
train_ns = ts_nonstationary[:train_size]
test_ns = ts_nonstationary[train_size:]

# ARIMA(1,1,1)ãƒ¢ãƒ‡ãƒ«
model_arima = ARIMA(train_ns, order=(1, 1, 1))
fitted_arima = model_arima.fit()

print("\n=== ARIMA(1,1,1)ãƒ¢ãƒ‡ãƒ« ===")
print(fitted_arima.summary())

# äºˆæ¸¬
forecast_arima = fitted_arima.forecast(steps=len(test_ns))
forecast_ci = fitted_arima.get_forecast(steps=len(test_ns)).conf_int()

# å¯è¦–åŒ–
plt.figure(figsize=(14, 6))
plt.plot(train_ns.index, train_ns, label='è¨“ç·´ãƒ‡ãƒ¼ã‚¿', linewidth=1.5)
plt.plot(test_ns.index, test_ns, label='å®Ÿæ¸¬å€¤', linewidth=1.5, color='green')
plt.plot(test_ns.index, forecast_arima, label='äºˆæ¸¬å€¤',
         linewidth=2, linestyle='--', color='red')
plt.fill_between(test_ns.index,
                 forecast_ci.iloc[:, 0],
                 forecast_ci.iloc[:, 1],
                 alpha=0.2, color='red', label='95%ä¿¡é ¼åŒºé–“')
plt.xlabel('æ—¥ä»˜')
plt.ylabel('å€¤')
plt.title('ARIMA(1,1,1)ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹äºˆæ¸¬', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# ç²¾åº¦è©•ä¾¡
rmse = np.sqrt(mean_squared_error(test_ns, forecast_arima))
mae = mean_absolute_error(test_ns, forecast_arima)

print(f"\n=== äºˆæ¸¬ç²¾åº¦ ===")
print(f"RMSE: {rmse:.4f}")
print(f"MAE: {mae:.4f}")
</code></pre>

<h3>æ®‹å·®è¨ºæ–­</h3>

<pre><code class="language-python"># æ®‹å·®ã®è¨ºæ–­
residuals = fitted_arima.resid

fig, axes = plt.subplots(2, 2, figsize=(14, 10))

# æ®‹å·®ã®æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆ
axes[0, 0].plot(residuals, linewidth=1)
axes[0, 0].axhline(y=0, color='red', linestyle='--')
axes[0, 0].set_ylabel('æ®‹å·®')
axes[0, 0].set_title('æ®‹å·®ã®æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆ', fontsize=14)
axes[0, 0].grid(True, alpha=0.3)

# æ®‹å·®ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ 
axes[0, 1].hist(residuals, bins=30, edgecolor='black', alpha=0.7)
axes[0, 1].set_xlabel('æ®‹å·®')
axes[0, 1].set_ylabel('é »åº¦')
axes[0, 1].set_title('æ®‹å·®ã®åˆ†å¸ƒï¼ˆæ­£è¦æ€§ã®ç¢ºèªï¼‰', fontsize=14)
axes[0, 1].grid(True, alpha=0.3)

# æ®‹å·®ã®ACF
plot_acf(residuals, lags=30, ax=axes[1, 0])
axes[1, 0].set_title('æ®‹å·®ã®ACFï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºã®ç¢ºèªï¼‰', fontsize=14)

# Q-Qãƒ—ãƒ­ãƒƒãƒˆ
from scipy import stats
stats.probplot(residuals, dist="norm", plot=axes[1, 1])
axes[1, 1].set_title('Q-Qãƒ—ãƒ­ãƒƒãƒˆï¼ˆæ­£è¦æ€§ã®ç¢ºèªï¼‰', fontsize=14)
axes[1, 1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

# Ljung-Boxæ¤œå®šï¼ˆæ®‹å·®ã®è‡ªå·±ç›¸é–¢æ¤œå®šï¼‰
from statsmodels.stats.diagnostic import acorr_ljungbox

lb_test = acorr_ljungbox(residuals, lags=[10, 20, 30], return_df=True)
print("\n=== Ljung-Boxæ¤œå®šï¼ˆæ®‹å·®ã®è‡ªå·±ç›¸é–¢ï¼‰ ===")
print(lb_test)
print("\npå€¤ > 0.05 ãªã‚‰ã€æ®‹å·®ã¯ç™½è‰²é›‘éŸ³ï¼ˆè‰¯ã„ãƒ¢ãƒ‡ãƒ«ï¼‰")
</code></pre>

<hr>

<h2>2.4 å­£ç¯€æ€§ARIMAï¼ˆSARIMAï¼‰</h2>

<h3>SARIMAãƒ¢ãƒ‡ãƒ«ã¨ã¯</h3>

<p><strong>SARIMAï¼ˆSeasonal ARIMAï¼‰ãƒ¢ãƒ‡ãƒ«</strong>ã¯ã€å­£ç¯€æ€§ã‚’æŒã¤æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ãŸã‚ã®ãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚</p>

<p>SARIMA(p,d,q)(P,D,Q)sã®è¡¨è¨˜ï¼š</p>

<ul>
<li><strong>(p,d,q)</strong>: éå­£ç¯€æˆåˆ†ã®ARIMAãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
<li><strong>(P,D,Q)</strong>: å­£ç¯€æˆåˆ†ã®ARIMAãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
<li><strong>s</strong>: å­£ç¯€å‘¨æœŸï¼ˆæœˆæ¬¡ãƒ‡ãƒ¼ã‚¿ãªã‚‰12ã€å››åŠæœŸãªã‚‰4ï¼‰</li>
</ul>

<h3>å­£ç¯€æ€§ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆã¨å¯è¦–åŒ–</h3>

<pre><code class="language-python"># å­£ç¯€æ€§ã‚’æŒã¤æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ
np.random.seed(42)
n = 240  # 20å¹´åˆ†ã®æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿
t = np.arange(n)

# ãƒˆãƒ¬ãƒ³ãƒ‰ + å­£ç¯€æ€§ + ãƒã‚¤ã‚º
trend = 0.05 * t
seasonal = 10 * np.sin(2 * np.pi * t / 12)  # å¹´å‘¨æœŸ
noise = np.random.normal(0, 2, n)

ts_seasonal = pd.Series(
    trend + seasonal + noise,
    index=pd.date_range('2000-01-01', periods=n, freq='MS')
)

print("=== å­£ç¯€æ€§æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ ===")
print(f"ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: {len(ts_seasonal)}")
print(f"å‘¨æœŸ: 12ãƒ¶æœˆï¼ˆå¹´æ¬¡å­£ç¯€æ€§ï¼‰")

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 1, figsize=(14, 10))

# æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆ
axes[0].plot(ts_seasonal, linewidth=1.5)
axes[0].set_xlabel('å¹´æœˆ')
axes[0].set_ylabel('å€¤')
axes[0].set_title('å­£ç¯€æ€§ã‚’æŒã¤æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿', fontsize=14)
axes[0].grid(True, alpha=0.3)

# å­£ç¯€æ€§åˆ†è§£
from statsmodels.tsa.seasonal import seasonal_decompose

decomposition = seasonal_decompose(ts_seasonal, model='additive', period=12)

# åˆ†è§£çµæœã®è¡¨ç¤º
fig2 = decomposition.plot()
fig2.set_size_inches(14, 10)
plt.tight_layout()
plt.show()
</code></pre>

<h3>å­£ç¯€å·®åˆ†</h3>

<pre><code class="language-python"># å­£ç¯€å·®åˆ†ï¼ˆs=12ï¼‰
ts_seasonal_diff = ts_seasonal.diff(12).dropna()

# é€šå¸¸ã®å·®åˆ†ã‚‚é©ç”¨
ts_seasonal_diff2 = ts_seasonal_diff.diff().dropna()

fig, axes = plt.subplots(3, 1, figsize=(12, 10))

# å…ƒãƒ‡ãƒ¼ã‚¿
axes[0].plot(ts_seasonal, linewidth=1.5)
axes[0].set_ylabel('å€¤')
axes[0].set_title('å…ƒãƒ‡ãƒ¼ã‚¿ï¼ˆå­£ç¯€æ€§ã‚ã‚Šï¼‰', fontsize=14)
axes[0].grid(True, alpha=0.3)

# å­£ç¯€å·®åˆ†å¾Œ
axes[1].plot(ts_seasonal_diff, linewidth=1.5, color='orange')
axes[1].set_ylabel('å­£ç¯€å·®åˆ†')
axes[1].set_title('å­£ç¯€å·®åˆ†å¾Œï¼ˆD=1, s=12ï¼‰', fontsize=14)
axes[1].axhline(y=0, color='red', linestyle='--', alpha=0.5)
axes[1].grid(True, alpha=0.3)

# å­£ç¯€å·®åˆ† + é€šå¸¸ã®å·®åˆ†
axes[2].plot(ts_seasonal_diff2, linewidth=1.5, color='green')
axes[2].set_xlabel('å¹´æœˆ')
axes[2].set_ylabel('å·®åˆ†')
axes[2].set_title('å­£ç¯€å·®åˆ† + é€šå¸¸å·®åˆ†ï¼ˆD=1, d=1ï¼‰', fontsize=14)
axes[2].axhline(y=0, color='red', linestyle='--', alpha=0.5)
axes[2].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

# å®šå¸¸æ€§æ¤œå®š
adf_test(ts_seasonal, 'å…ƒãƒ‡ãƒ¼ã‚¿')
adf_test(ts_seasonal_diff, 'å­£ç¯€å·®åˆ†å¾Œ')
adf_test(ts_seasonal_diff2, 'å­£ç¯€å·®åˆ†+é€šå¸¸å·®åˆ†')
</code></pre>

<h3>SARIMAãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°</h3>

<pre><code class="language-python">from statsmodels.tsa.statespace.sarimax import SARIMAX

# è¨“ç·´ãƒ»ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†å‰²
train_seasonal = ts_seasonal[:int(len(ts_seasonal) * 0.8)]
test_seasonal = ts_seasonal[int(len(ts_seasonal) * 0.8):]

# SARIMA(1,1,1)(1,1,1)12ãƒ¢ãƒ‡ãƒ«
model_sarima = SARIMAX(
    train_seasonal,
    order=(1, 1, 1),
    seasonal_order=(1, 1, 1, 12),
    enforce_stationarity=False,
    enforce_invertibility=False
)

fitted_sarima = model_sarima.fit(disp=False)

print("\n=== SARIMA(1,1,1)(1,1,1)12ãƒ¢ãƒ‡ãƒ« ===")
print(fitted_sarima.summary())

# äºˆæ¸¬
forecast_sarima = fitted_sarima.forecast(steps=len(test_seasonal))
forecast_sarima_ci = fitted_sarima.get_forecast(steps=len(test_seasonal)).conf_int()

# å¯è¦–åŒ–
plt.figure(figsize=(14, 6))
plt.plot(train_seasonal.index, train_seasonal, label='è¨“ç·´ãƒ‡ãƒ¼ã‚¿', linewidth=1.5)
plt.plot(test_seasonal.index, test_seasonal, label='å®Ÿæ¸¬å€¤', linewidth=1.5, color='green')
plt.plot(test_seasonal.index, forecast_sarima, label='äºˆæ¸¬å€¤ï¼ˆSARIMAï¼‰',
         linewidth=2, linestyle='--', color='red')
plt.fill_between(test_seasonal.index,
                 forecast_sarima_ci.iloc[:, 0],
                 forecast_sarima_ci.iloc[:, 1],
                 alpha=0.2, color='red', label='95%ä¿¡é ¼åŒºé–“')
plt.xlabel('å¹´æœˆ')
plt.ylabel('å€¤')
plt.title('SARIMA(1,1,1)(1,1,1)12ã«ã‚ˆã‚‹äºˆæ¸¬', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# ç²¾åº¦è©•ä¾¡
rmse_sarima = np.sqrt(mean_squared_error(test_seasonal, forecast_sarima))
mae_sarima = mean_absolute_error(test_seasonal, forecast_sarima)

print(f"\n=== SARIMAãƒ¢ãƒ‡ãƒ«ã®äºˆæ¸¬ç²¾åº¦ ===")
print(f"RMSE: {rmse_sarima:.4f}")
print(f"MAE: {mae_sarima:.4f}")
</code></pre>

<h3>auto_arimaã«ã‚ˆã‚‹è‡ªå‹•ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é¸æŠ</h3>

<pre><code class="language-python"># pmdarimaãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®auto_arimaã‚’ä½¿ç”¨
# pip install pmdarima ãŒå¿…è¦

from pmdarima import auto_arima

print("\n=== auto_arimaã«ã‚ˆã‚‹æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢ ===")
print("æ¢ç´¢ä¸­...")

# auto_arimaï¼ˆå­£ç¯€æ€§ã‚ã‚Šï¼‰
auto_model = auto_arima(
    train_seasonal,
    start_p=0, start_q=0,
    max_p=3, max_q=3,
    m=12,  # å­£ç¯€å‘¨æœŸ
    start_P=0, start_Q=0,
    max_P=2, max_Q=2,
    seasonal=True,
    d=None,  # è‡ªå‹•æ¨å®š
    D=None,  # è‡ªå‹•æ¨å®š
    trace=True,  # æ¢ç´¢éç¨‹ã‚’è¡¨ç¤º
    error_action='ignore',
    suppress_warnings=True,
    stepwise=True
)

print("\n=== æœ€é©ãƒ¢ãƒ‡ãƒ« ===")
print(auto_model.summary())

# äºˆæ¸¬
forecast_auto = auto_model.predict(n_periods=len(test_seasonal))

# å¯è¦–åŒ–
plt.figure(figsize=(14, 6))
plt.plot(test_seasonal.index, test_seasonal, label='å®Ÿæ¸¬å€¤', linewidth=2, color='green')
plt.plot(test_seasonal.index, forecast_sarima, label='æ‰‹å‹•SARIMA',
         linewidth=1.5, linestyle='--', color='red')
plt.plot(test_seasonal.index, forecast_auto, label='auto_arima',
         linewidth=1.5, linestyle='--', color='blue')
plt.xlabel('å¹´æœˆ')
plt.ylabel('å€¤')
plt.title('SARIMAãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒï¼ˆæ‰‹å‹• vs auto_arimaï¼‰', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# ç²¾åº¦æ¯”è¼ƒ
rmse_auto = np.sqrt(mean_squared_error(test_seasonal, forecast_auto))
print(f"\n=== ç²¾åº¦æ¯”è¼ƒ ===")
print(f"æ‰‹å‹•SARIMA RMSE: {rmse_sarima:.4f}")
print(f"auto_arima RMSE: {rmse_auto:.4f}")
</code></pre>

<hr>

<h2>2.5 ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ã¨é¸æŠ</h2>

<h3>In-sample vs Out-of-sampleè©•ä¾¡</h3>

<table>
<thead>
<tr>
<th>è©•ä¾¡æ–¹æ³•</th>
<th>èª¬æ˜</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>In-sample</strong></td>
<td>è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã§ã®äºˆæ¸¬ç²¾åº¦</td>
<td>ãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒƒãƒˆåº¦ç¢ºèª</td>
</tr>
<tr>
<td><strong>Out-of-sample</strong></td>
<td>ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§ã®äºˆæ¸¬ç²¾åº¦</td>
<td>æ±åŒ–æ€§èƒ½ã®è©•ä¾¡ï¼ˆé‡è¦ï¼‰</td>
</tr>
</tbody>
</table>

<h3>è©•ä¾¡æŒ‡æ¨™</h3>

<p><strong>1. RMSEï¼ˆRoot Mean Squared Errorï¼‰</strong></p>

<p>$$
\text{RMSE} = \sqrt{\frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}
$$</p>

<p><strong>2. MAEï¼ˆMean Absolute Errorï¼‰</strong></p>

<p>$$
\text{MAE} = \frac{1}{n}\sum_{i=1}^{n}|y_i - \hat{y}_i|
$$</p>

<p><strong>3. MAPEï¼ˆMean Absolute Percentage Errorï¼‰</strong></p>

<p>$$
\text{MAPE} = \frac{100\%}{n}\sum_{i=1}^{n}\left|\frac{y_i - \hat{y}_i}{y_i}\right|
$$</p>

<pre><code class="language-python"># è¤‡æ•°ã®è©•ä¾¡æŒ‡æ¨™ã‚’è¨ˆç®—
def evaluate_forecast(y_true, y_pred, model_name='Model'):
    """äºˆæ¸¬ç²¾åº¦ã®ç·åˆè©•ä¾¡"""
    from sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score

    rmse = np.sqrt(mean_squared_error(y_true, y_pred))
    mae = mean_absolute_error(y_true, y_pred)

    # MAPEï¼ˆ0é™¤ç®—ã‚’é¿ã‘ã‚‹ï¼‰
    mask = y_true != 0
    mape = np.mean(np.abs((y_true[mask] - y_pred[mask]) / y_true[mask])) * 100

    # R^2ã‚¹ã‚³ã‚¢
    r2 = r2_score(y_true, y_pred)

    print(f"\n=== {model_name}ã®è©•ä¾¡ ===")
    print(f"RMSE: {rmse:.4f}")
    print(f"MAE: {mae:.4f}")
    print(f"MAPE: {mape:.2f}%")
    print(f"R^2: {r2:.4f}")

    return {'RMSE': rmse, 'MAE': mae, 'MAPE': mape, 'R2': r2}

# è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®æ¯”è¼ƒ
results = {}
results['ARIMA'] = evaluate_forecast(test_ns, forecast_arima, 'ARIMA(1,1,1)')
results['SARIMA'] = evaluate_forecast(test_seasonal, forecast_sarima, 'SARIMA(1,1,1)(1,1,1)12')
results['auto_arima'] = evaluate_forecast(test_seasonal, forecast_auto, 'auto_arima')

# çµæœã®æ¯”è¼ƒè¡¨
results_df = pd.DataFrame(results).T
print("\n=== ãƒ¢ãƒ‡ãƒ«æ€§èƒ½æ¯”è¼ƒè¡¨ ===")
print(results_df)
</code></pre>

<h3>æ™‚ç³»åˆ—äº¤å·®æ¤œè¨¼</h3>

<p>æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã§ã¯ã€é€šå¸¸ã®äº¤å·®æ¤œè¨¼ã§ã¯ãªãã€<strong>æ™‚é–“ã‚’è€ƒæ…®ã—ãŸäº¤å·®æ¤œè¨¼</strong>ãŒå¿…è¦ã§ã™ã€‚</p>

<pre><code class="language-python">from sklearn.model_selection import TimeSeriesSplit

# æ™‚ç³»åˆ—äº¤å·®æ¤œè¨¼
tscv = TimeSeriesSplit(n_splits=5)

rmse_scores = []

print("\n=== æ™‚ç³»åˆ—äº¤å·®æ¤œè¨¼ ===")
for fold, (train_idx, test_idx) in enumerate(tscv.split(ts_seasonal), 1):
    # ãƒ‡ãƒ¼ã‚¿åˆ†å‰²
    cv_train = ts_seasonal.iloc[train_idx]
    cv_test = ts_seasonal.iloc[test_idx]

    # ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
    cv_model = SARIMAX(cv_train, order=(1,1,1), seasonal_order=(1,1,1,12))
    cv_fitted = cv_model.fit(disp=False)

    # äºˆæ¸¬
    cv_forecast = cv_fitted.forecast(steps=len(cv_test))

    # è©•ä¾¡
    cv_rmse = np.sqrt(mean_squared_error(cv_test, cv_forecast))
    rmse_scores.append(cv_rmse)

    print(f"Fold {fold}: è¨“ç·´={len(cv_train)}, ãƒ†ã‚¹ãƒˆ={len(cv_test)}, RMSE={cv_rmse:.4f}")

print(f"\nå¹³å‡RMSE: {np.mean(rmse_scores):.4f} (Â±{np.std(rmse_scores):.4f})")

# å¯è¦–åŒ–
plt.figure(figsize=(12, 6))
plt.plot(range(1, len(rmse_scores) + 1), rmse_scores, marker='o', linewidth=2, markersize=10)
plt.axhline(y=np.mean(rmse_scores), color='red', linestyle='--',
            label=f'å¹³å‡RMSE: {np.mean(rmse_scores):.4f}')
plt.xlabel('Fold')
plt.ylabel('RMSE')
plt.title('æ™‚ç³»åˆ—äº¤å·®æ¤œè¨¼ã«ã‚ˆã‚‹RMSE', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()
</code></pre>

<h3>ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒã®å®Œå…¨ãªä¾‹</h3>

<pre><code class="language-python"># è¤‡æ•°ã®ARIMAãƒ¢ãƒ‡ãƒ«ã‚’æ¯”è¼ƒ
candidates = [
    ('ARIMA(1,1,0)', (1, 1, 0)),
    ('ARIMA(0,1,1)', (0, 1, 1)),
    ('ARIMA(1,1,1)', (1, 1, 1)),
    ('ARIMA(2,1,1)', (2, 1, 1)),
    ('ARIMA(1,1,2)', (1, 1, 2)),
]

comparison_results = []

print("\n=== ARIMAãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒ ===")
for name, order in candidates:
    # ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
    model = ARIMA(train_ns, order=order)
    fitted = model.fit()

    # äºˆæ¸¬
    forecast = fitted.forecast(steps=len(test_ns))

    # è©•ä¾¡
    rmse = np.sqrt(mean_squared_error(test_ns, forecast))
    mae = mean_absolute_error(test_ns, forecast)
    aic = fitted.aic
    bic = fitted.bic

    comparison_results.append({
        'ãƒ¢ãƒ‡ãƒ«': name,
        'AIC': aic,
        'BIC': bic,
        'RMSE': rmse,
        'MAE': mae
    })

    print(f"{name}: AIC={aic:.2f}, BIC={bic:.2f}, RMSE={rmse:.4f}")

# çµæœã‚’DataFrameã«
comparison_df = pd.DataFrame(comparison_results)
comparison_df = comparison_df.sort_values('RMSE')

print("\n=== æœ€çµ‚æ¯”è¼ƒè¡¨ï¼ˆRMSEã§ã‚½ãƒ¼ãƒˆï¼‰===")
print(comparison_df.to_string(index=False))

# å¯è¦–åŒ–
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

# AICæ¯”è¼ƒ
axes[0].barh(comparison_df['ãƒ¢ãƒ‡ãƒ«'], comparison_df['AIC'], color='steelblue')
axes[0].set_xlabel('AIC')
axes[0].set_title('ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒ: AICï¼ˆå°ã•ã„ã»ã©è‰¯ã„ï¼‰', fontsize=14)
axes[0].grid(True, alpha=0.3, axis='x')

# RMSEæ¯”è¼ƒ
axes[1].barh(comparison_df['ãƒ¢ãƒ‡ãƒ«'], comparison_df['RMSE'], color='coral')
axes[1].set_xlabel('RMSE')
axes[1].set_title('ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒ: RMSEï¼ˆå°ã•ã„ã»ã©è‰¯ã„ï¼‰', fontsize=14)
axes[1].grid(True, alpha=0.3, axis='x')

plt.tight_layout()
plt.show()
</code></pre>

<hr>

<h2>2.6 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><p><strong>ARï¼ˆè‡ªå·±å›å¸°ï¼‰ãƒ¢ãƒ‡ãƒ«</strong></p>
<ul>
<li>éå»ã®å€¤ã‚’ä½¿ã£ãŸç·šå½¢äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«</li>
<li>PACFã«ã‚ˆã‚‹æ¬¡æ•°pã®è­˜åˆ¥</li>
<li>AIC/BICã«ã‚ˆã‚‹æœ€é©æ¬¡æ•°ã®é¸æŠ</li>
</ul></li>

<li><p><strong>MAï¼ˆç§»å‹•å¹³å‡ï¼‰ãƒ¢ãƒ‡ãƒ«</strong></p>
<ul>
<li>éå»ã®äºˆæ¸¬èª¤å·®ã‚’ä½¿ã£ãŸãƒ¢ãƒ‡ãƒ«</li>
<li>ACFã«ã‚ˆã‚‹æ¬¡æ•°qã®è­˜åˆ¥</li>
<li>ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºã¨ã®é–¢ä¿‚</li>
</ul></li>

<li><p><strong>ARIMAãƒ¢ãƒ‡ãƒ«</strong></p>
<ul>
<li>éå®šå¸¸æ™‚ç³»åˆ—ã‚’æ‰±ã†çµ±ä¸€çš„æ çµ„ã¿</li>
<li>å·®åˆ†ã«ã‚ˆã‚‹ãƒˆãƒ¬ãƒ³ãƒ‰ã®é™¤å»</li>
<li>æ®‹å·®è¨ºæ–­ã«ã‚ˆã‚‹é©åˆåº¦ç¢ºèª</li>
</ul></li>

<li><p><strong>SARIMAãƒ¢ãƒ‡ãƒ«</strong></p>
<ul>
<li>å­£ç¯€æ€§ã‚’æŒã¤æ™‚ç³»åˆ—ã¸ã®å¯¾å¿œ</li>
<li>å­£ç¯€å·®åˆ†ã«ã‚ˆã‚‹å­£ç¯€æˆåˆ†ã®é™¤å»</li>
<li>auto_arimaã«ã‚ˆã‚‹è‡ªå‹•ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é¸æŠ</li>
</ul></li>

<li><p><strong>ãƒ¢ãƒ‡ãƒ«è©•ä¾¡</strong></p>
<ul>
<li>RMSEã€MAEã€MAPEã«ã‚ˆã‚‹ç²¾åº¦è©•ä¾¡</li>
<li>æ™‚ç³»åˆ—äº¤å·®æ¤œè¨¼</li>
<li>In-sample vs Out-of-sampleè©•ä¾¡</li>
</ul></li>
</ol>

<h3>ãƒ¢ãƒ‡ãƒ«é¸æŠã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</h3>

<table>
<thead>
<tr>
<th>ãƒ‡ãƒ¼ã‚¿ã®ç‰¹å¾´</th>
<th>æ¨å¥¨ãƒ¢ãƒ‡ãƒ«</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®šå¸¸ã€çŸ­æœŸè¨˜æ†¶</td>
<td>AR</td>
<td>ç›´è¿‘ã®å€¤ãŒé‡è¦</td>
</tr>
<tr>
<td>å®šå¸¸ã€ã‚·ãƒ§ãƒƒã‚¯ä¾å­˜</td>
<td>MA</td>
<td>éå»ã®èª¤å·®ãŒå½±éŸ¿</td>
</tr>
<tr>
<td>éå®šå¸¸ã€ãƒˆãƒ¬ãƒ³ãƒ‰</td>
<td>ARIMA</td>
<td>å·®åˆ†ã§å®šå¸¸åŒ–</td>
</tr>
<tr>
<td>å­£ç¯€æ€§ã‚ã‚Š</td>
<td>SARIMA</td>
<td>å­£ç¯€æˆåˆ†ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–</td>
</tr>
<tr>
<td>è¤‡é›‘ãªå­£ç¯€æ€§</td>
<td>auto_arima</td>
<td>è‡ªå‹•ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢</td>
</tr>
</tbody>
</table>

<h3>å®Ÿå‹™ã§ã®æ³¨æ„ç‚¹</h3>

<table>
<thead>
<tr>
<th>æ³¨æ„ç‚¹</th>
<th>èª¬æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å®šå¸¸æ€§ã®ç¢ºèª</strong></td>
<td>ADFæ¤œå®šã§å¿…ãšå®šå¸¸æ€§ã‚’ç¢ºèªã—ã¦ã‹ã‚‰é©ç”¨</td>
</tr>
<tr>
<td><strong>æ®‹å·®è¨ºæ–­</strong></td>
<td>æ®‹å·®ãŒç™½è‰²é›‘éŸ³ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆLjung-Boxæ¤œå®šï¼‰</td>
</tr>
<tr>
<td><strong>éå­¦ç¿’å›é¿</strong></td>
<td>æ¬¡æ•°ã‚’å¤§ããã—ã™ããªã„ï¼ˆAIC/BICã§é¸æŠï¼‰</td>
</tr>
<tr>
<td><strong>Out-of-sampleè©•ä¾¡</strong></td>
<td>è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã ã‘ã§ãªãã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§æ€§èƒ½ç¢ºèª</td>
</tr>
<tr>
<td><strong>ä¿¡é ¼åŒºé–“ã®æç¤º</strong></td>
<td>ç‚¹äºˆæ¸¬ã ã‘ã§ãªãã€ä¸ç¢ºå®Ÿæ€§ã‚‚ä¼ãˆã‚‹</td>
</tr>
</tbody>
</table>

<h3>æ¬¡ã®ç« ã¸</h3>

<p>ç¬¬3ç« ã§ã¯ã€<strong>æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹æ™‚ç³»åˆ—äºˆæ¸¬</strong>ã‚’å­¦ã³ã¾ã™ï¼š</p>
<ul>
<li>ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ï¼ˆãƒ©ã‚°ç‰¹å¾´é‡ã€ãƒ­ãƒ¼ãƒªãƒ³ã‚°çµ±è¨ˆé‡ï¼‰</li>
<li>ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆãƒ»XGBoostã«ã‚ˆã‚‹äºˆæ¸¬</li>
<li>LSTMãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</li>
<li>Prophetï¼ˆFacebookè£½ï¼‰</li>
<li>çµ±è¨ˆãƒ¢ãƒ‡ãƒ«ã¨ã®æ¯”è¼ƒ</li>
</ul>

<hr>

<h2>æ¼”ç¿’å•é¡Œ</h2>

<h3>å•é¡Œ1ï¼ˆé›£æ˜“åº¦ï¼šeasyï¼‰</h3>
<p>ARãƒ¢ãƒ‡ãƒ«ã¨MAãƒ¢ãƒ‡ãƒ«ã®é•ã„ã‚’ã€ACFã¨PACFã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å«ã‚ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p><strong>ARãƒ¢ãƒ‡ãƒ«</strong>ï¼š</p>
<ul>
<li>å®šç¾©: éå»ã®å€¤ã®ç·šå½¢çµåˆã§ç¾åœ¨ã®å€¤ã‚’äºˆæ¸¬</li>
<li>ACF: æŒ‡æ•°çš„ã«æ¸›è¡°</li>
<li>PACF: pæ¬¡ã§åˆ‡æ–­ï¼ˆã‚«ãƒƒãƒˆã‚ªãƒ•ï¼‰</li>
<li>ä¾‹: AR(2)ã§ã¯ã€PACF ãŒ2æ¬¡ä»¥é™ã§ã‚¼ãƒ­ã«ãªã‚‹</li>
</ul>

<p><strong>MAãƒ¢ãƒ‡ãƒ«</strong>ï¼š</p>
<ul>
<li>å®šç¾©: éå»ã®äºˆæ¸¬èª¤å·®ã®ç·šå½¢çµåˆã§ç¾åœ¨ã®å€¤ã‚’è¡¨ç¾</li>
<li>ACF: qæ¬¡ã§åˆ‡æ–­ï¼ˆã‚«ãƒƒãƒˆã‚ªãƒ•ï¼‰</li>
<li>PACF: æŒ‡æ•°çš„ã«æ¸›è¡°</li>
<li>ä¾‹: MA(1)ã§ã¯ã€ACF ãŒ1æ¬¡ä»¥é™ã§ã‚¼ãƒ­ã«ãªã‚‹</li>
</ul>

<table>
<thead>
<tr>
<th>ç‰¹å¾´</th>
<th>ARãƒ¢ãƒ‡ãƒ«</th>
<th>MAãƒ¢ãƒ‡ãƒ«</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¾å­˜å¯¾è±¡</td>
<td>éå»ã®å€¤</td>
<td>éå»ã®èª¤å·®</td>
</tr>
<tr>
<td>ACFãƒ‘ã‚¿ãƒ¼ãƒ³</td>
<td>æ¸›è¡°</td>
<td>qæ¬¡ã§åˆ‡æ–­</td>
</tr>
<tr>
<td>PACFãƒ‘ã‚¿ãƒ¼ãƒ³</td>
<td>pæ¬¡ã§åˆ‡æ–­</td>
<td>æ¸›è¡°</td>
</tr>
<tr>
<td>è­˜åˆ¥æ–¹æ³•</td>
<td>PACFã‹ã‚‰æ¬¡æ•°p</td>
<td>ACFã‹ã‚‰æ¬¡æ•°q</td>
</tr>
</tbody>
</table>

</details>

<h3>å•é¡Œ2ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>ä»¥ä¸‹ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€é©åˆ‡ãªARIMA(p,d,q)ã®æ¬¡æ•°ã‚’æ±ºå®šã—ã€ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã—ã¦ãã ã•ã„ã€‚</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
np.random.seed(123)
n = 150
trend = 0.1 * np.arange(n)
noise = np.random.normal(0, 1, n)
ts = pd.Series(trend + np.cumsum(noise))
</code></pre>

<details>
<summary>è§£ç­”ä¾‹</summary>

<pre><code class="language-python">import numpy as np
import pandas as pd
from statsmodels.tsa.stattools import adfuller
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf
from statsmodels.tsa.arima.model import ARIMA
import matplotlib.pyplot as plt

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
np.random.seed(123)
n = 150
trend = 0.1 * np.arange(n)
noise = np.random.normal(0, 1, n)
ts = pd.Series(trend + np.cumsum(noise))

# ã‚¹ãƒ†ãƒƒãƒ—1: å®šå¸¸æ€§æ¤œå®š
print("=== ã‚¹ãƒ†ãƒƒãƒ—1: å®šå¸¸æ€§ã®ç¢ºèª ===")
result = adfuller(ts)
print(f"ADFçµ±è¨ˆé‡: {result[0]:.4f}")
print(f"på€¤: {result[1]:.4f}")

if result[1] > 0.05:
    print("â†’ éå®šå¸¸ï¼ˆå·®åˆ†ãŒå¿…è¦ï¼‰")

    # 1æ¬¡å·®åˆ†
    ts_diff = ts.diff().dropna()
    result_diff = adfuller(ts_diff)
    print(f"\n1æ¬¡å·®åˆ†å¾Œã®på€¤: {result_diff[1]:.4f}")

    if result_diff[1] <= 0.05:
        print("â†’ 1æ¬¡å·®åˆ†ã§å®šå¸¸åŒ–ï¼ˆd=1ï¼‰")
        d = 1
else:
    print("â†’ å®šå¸¸ï¼ˆd=0ï¼‰")
    d = 0

# ã‚¹ãƒ†ãƒƒãƒ—2: ACF/PACFã®ç¢ºèª
print("\n=== ã‚¹ãƒ†ãƒƒãƒ—2: ACF/PACFã«ã‚ˆã‚‹æ¬¡æ•°ã®æ¨å®š ===")
fig, axes = plt.subplots(2, 1, figsize=(12, 8))

if d == 1:
    plot_data = ts.diff().dropna()
else:
    plot_data = ts

plot_acf(plot_data, lags=20, ax=axes[0])
axes[0].set_title('ACFï¼ˆMAã®æ¬¡æ•°qã‚’æ¨å®šï¼‰')

plot_pacf(plot_data, lags=20, ax=axes[1], method='ywm')
axes[1].set_title('PACFï¼ˆARã®æ¬¡æ•°pã‚’æ¨å®šï¼‰')

plt.tight_layout()
plt.show()

# PACFã¨ACFã‹ã‚‰æ¬¡æ•°ã‚’æ¨å®šï¼ˆã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ p=1, q=1ï¼‰
p = 1
q = 1

print(f"\næ¨å®šã•ã‚ŒãŸæ¬¡æ•°: ARIMA({p},{d},{q})")

# ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
print("\n=== ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚° ===")
model = ARIMA(ts, order=(p, d, q))
fitted = model.fit()
print(fitted.summary())

# ã‚¹ãƒ†ãƒƒãƒ—4: æ®‹å·®è¨ºæ–­
print("\n=== ã‚¹ãƒ†ãƒƒãƒ—4: æ®‹å·®è¨ºæ–­ ===")
residuals = fitted.resid

fig, axes = plt.subplots(2, 2, figsize=(14, 10))

axes[0, 0].plot(residuals)
axes[0, 0].axhline(y=0, color='red', linestyle='--')
axes[0, 0].set_title('æ®‹å·®ã®æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆ')

axes[0, 1].hist(residuals, bins=20, edgecolor='black')
axes[0, 1].set_title('æ®‹å·®ã®åˆ†å¸ƒ')

plot_acf(residuals, ax=axes[1, 0], lags=20)
axes[1, 0].set_title('æ®‹å·®ã®ACF')

from scipy import stats
stats.probplot(residuals, dist="norm", plot=axes[1, 1])
axes[1, 1].set_title('Q-Qãƒ—ãƒ­ãƒƒãƒˆ')

plt.tight_layout()
plt.show()

# Ljung-Boxæ¤œå®š
from statsmodels.stats.diagnostic import acorr_ljungbox
lb_test = acorr_ljungbox(residuals, lags=[10], return_df=True)
print(f"\nLjung-Boxæ¤œå®š på€¤: {lb_test['lb_pvalue'].values[0]:.4f}")
if lb_test['lb_pvalue'].values[0] > 0.05:
    print("â†’ æ®‹å·®ã¯ç™½è‰²é›‘éŸ³ï¼ˆè‰¯ã„ãƒ¢ãƒ‡ãƒ«ï¼‰")
else:
    print("â†’ æ®‹å·®ã«è‡ªå·±ç›¸é–¢ã‚ã‚Šï¼ˆãƒ¢ãƒ‡ãƒ«æ”¹å–„ã®ä½™åœ°ï¼‰")

print(f"\n=== æœ€çµ‚ãƒ¢ãƒ‡ãƒ«: ARIMA({p},{d},{q}) ===")
print(f"AIC: {fitted.aic:.2f}")
print(f"BIC: {fitted.bic:.2f}")
</code></pre>

</details>

<h3>å•é¡Œ3ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>AICã¨BICã®é•ã„ã‚’èª¬æ˜ã—ã€ã©ã®ã‚ˆã†ãªå ´é¢ã§ã©ã¡ã‚‰ã‚’å„ªå…ˆã™ã¹ãã‹è¿°ã¹ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p><strong>AICï¼ˆèµ¤æ± æƒ…å ±é‡è¦æº–ï¼‰</strong>ï¼š</p>

<p>$$
\text{AIC} = 2k - 2\ln(L)
$$</p>

<ul>
<li>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°kã®ãƒšãƒŠãƒ«ãƒ†ã‚£ãŒè»½ã„</li>
<li>äºˆæ¸¬ç²¾åº¦ã®æœ€å¤§åŒ–ã‚’é‡è¦–</li>
<li>ã‚„ã‚„è¤‡é›‘ãªãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã—ã‚„ã™ã„</li>
</ul>

<p><strong>BICï¼ˆãƒ™ã‚¤ã‚ºæƒ…å ±é‡è¦æº–ï¼‰</strong>ï¼š</p>

<p>$$
\text{BIC} = k\ln(n) - 2\ln(L)
$$</p>

<ul>
<li>ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºnã«ä¾å­˜ã—ãŸãƒšãƒŠãƒ«ãƒ†ã‚£</li>
<li>ãƒ¢ãƒ‡ãƒ«ã®ç°¡æ½”ã•ã‚’é‡è¦–</li>
<li>n > 8 ã§ AIC ã‚ˆã‚Šã‚‚å¼·ã„ãƒšãƒŠãƒ«ãƒ†ã‚£</li>
</ul>

<p><strong>ä½¿ã„åˆ†ã‘ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</strong>ï¼š</p>

<table>
<thead>
<tr>
<th>çŠ¶æ³</th>
<th>æ¨å¥¨</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td>äºˆæ¸¬ãŒä¸»ç›®çš„</td>
<td>AIC</td>
<td>äºˆæ¸¬ç²¾åº¦ã‚’å„ªå…ˆ</td>
</tr>
<tr>
<td>è§£é‡ˆãŒä¸»ç›®çš„</td>
<td>BIC</td>
<td>ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¢ãƒ‡ãƒ«ãŒè§£é‡ˆã—ã‚„ã™ã„</td>
</tr>
<tr>
<td>ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºå°</td>
<td>AIC</td>
<td>BICã®ãƒšãƒŠãƒ«ãƒ†ã‚£ãŒéåº¦ã«å¼·ã„</td>
</tr>
<tr>
<td>ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºå¤§</td>
<td>BIC</td>
<td>éå­¦ç¿’ã‚’é˜²ã</td>
</tr>
<tr>
<td>çœŸã®ãƒ¢ãƒ‡ãƒ«æ¨å®š</td>
<td>BIC</td>
<td>ä¸€è‡´æ€§ã‚’æŒã¤</td>
</tr>
</tbody>
</table>

<p><strong>å®Ÿå‹™ã§ã®æ¨å¥¨</strong>ï¼š</p>
<ul>
<li>ä¸¡æ–¹ã‚’è¨ˆç®—ã—ã€å¤§ããç•°ãªã‚‹å ´åˆã¯ç†ç”±ã‚’èª¿æŸ»</li>
<li>æœ€çµ‚çš„ã«ã¯ã€Out-of-sampleæ€§èƒ½ã§åˆ¤æ–­</li>
<li>ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã‚‚è€ƒæ…®ã—ã¦ãƒ¢ãƒ‡ãƒ«é¸æŠ</li>
</ul>

</details>

<h3>å•é¡Œ4ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>ä»¥ä¸‹ã®æœˆæ¬¡å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€SARIMAãƒ¢ãƒ‡ãƒ«ã‚’ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã—ã€æ¬¡ã®12ãƒ¶æœˆã‚’äºˆæ¸¬ã—ã¦ãã ã•ã„ã€‚å­£ç¯€å‘¨æœŸã¯12ãƒ¶æœˆã§ã™ã€‚</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
np.random.seed(42)
n = 60  # 5å¹´åˆ†
t = np.arange(n)
trend = 100 + 2 * t
seasonal = 20 * np.sin(2 * np.pi * t / 12)
noise = np.random.normal(0, 5, n)
sales = trend + seasonal + noise
ts_sales = pd.Series(sales, index=pd.date_range('2019-01-01', periods=n, freq='MS'))
</code></pre>

<details>
<summary>è§£ç­”ä¾‹</summary>

<pre><code class="language-python">import numpy as np
import pandas as pd
from statsmodels.tsa.statespace.sarimax import SARIMAX
from statsmodels.tsa.seasonal import seasonal_decompose
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf
import matplotlib.pyplot as plt
from sklearn.metrics import mean_squared_error, mean_absolute_error

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
np.random.seed(42)
n = 60
t = np.arange(n)
trend = 100 + 2 * t
seasonal = 20 * np.sin(2 * np.pi * t / 12)
noise = np.random.normal(0, 5, n)
sales = trend + seasonal + noise
ts_sales = pd.Series(sales, index=pd.date_range('2019-01-01', periods=n, freq='MS'))

print("=== ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã¨åˆ†è§£ ===")
print(f"ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: {len(ts_sales)}")
print(f"æœŸé–“: {ts_sales.index[0]} ã‹ã‚‰ {ts_sales.index[-1]}")

# å­£ç¯€æ€§åˆ†è§£
decomposition = seasonal_decompose(ts_sales, model='additive', period=12)
fig = decomposition.plot()
fig.set_size_inches(14, 10)
plt.tight_layout()
plt.show()

# ã‚¹ãƒ†ãƒƒãƒ—2: è¨“ç·´ãƒ»ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†å‰²
train_size = 48  # 4å¹´åˆ†ã‚’è¨“ç·´ã€1å¹´åˆ†ã‚’ãƒ†ã‚¹ãƒˆ
train = ts_sales[:train_size]
test = ts_sales[train_size:]

print(f"\nè¨“ç·´ãƒ‡ãƒ¼ã‚¿: {len(train)}ãƒ¶æœˆ")
print(f"ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: {len(test)}ãƒ¶æœˆ")

# ã‚¹ãƒ†ãƒƒãƒ—3: SARIMAãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
# SARIMA(1,1,1)(1,1,1)12 ã‚’è©¦ã™
print("\n=== ã‚¹ãƒ†ãƒƒãƒ—2: SARIMAãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚° ===")
model = SARIMAX(
    train,
    order=(1, 1, 1),
    seasonal_order=(1, 1, 1, 12),
    enforce_stationarity=False,
    enforce_invertibility=False
)

fitted = model.fit(disp=False)
print(fitted.summary())

# ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§ã®äºˆæ¸¬
forecast = fitted.forecast(steps=len(test))
forecast_ci = fitted.get_forecast(steps=len(test)).conf_int()

# è©•ä¾¡
rmse = np.sqrt(mean_squared_error(test, forecast))
mae = mean_absolute_error(test, forecast)

print(f"\n=== ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§ã®äºˆæ¸¬ç²¾åº¦ ===")
print(f"RMSE: {rmse:.2f}")
print(f"MAE: {mae:.2f}")

# å¯è¦–åŒ–
plt.figure(figsize=(14, 6))
plt.plot(train.index, train, label='è¨“ç·´ãƒ‡ãƒ¼ã‚¿', linewidth=1.5)
plt.plot(test.index, test, label='å®Ÿæ¸¬å€¤', linewidth=2, color='green', marker='o')
plt.plot(test.index, forecast, label='SARIMAäºˆæ¸¬',
         linewidth=2, linestyle='--', color='red', marker='s')
plt.fill_between(test.index,
                 forecast_ci.iloc[:, 0],
                 forecast_ci.iloc[:, 1],
                 alpha=0.2, color='red', label='95%ä¿¡é ¼åŒºé–“')
plt.xlabel('å¹´æœˆ')
plt.ylabel('å£²ä¸Š')
plt.title('SARIMA(1,1,1)(1,1,1)12ã«ã‚ˆã‚‹æœˆæ¬¡å£²ä¸Šäºˆæ¸¬', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# ã‚¹ãƒ†ãƒƒãƒ—5: æ¬¡ã®12ãƒ¶æœˆã®äºˆæ¸¬
print("\n=== ã‚¹ãƒ†ãƒƒãƒ—3: å…¨ãƒ‡ãƒ¼ã‚¿ã§å†å­¦ç¿’ã—ã€æ¬¡ã®12ãƒ¶æœˆã‚’äºˆæ¸¬ ===")
final_model = SARIMAX(
    ts_sales,
    order=(1, 1, 1),
    seasonal_order=(1, 1, 1, 12),
    enforce_stationarity=False,
    enforce_invertibility=False
)

final_fitted = final_model.fit(disp=False)
future_forecast = final_fitted.forecast(steps=12)
future_ci = final_fitted.get_forecast(steps=12).conf_int()

# å°†æ¥ã®æ—¥ä»˜ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
future_dates = pd.date_range(ts_sales.index[-1] + pd.DateOffset(months=1),
                             periods=12, freq='MS')

print("\næ¬¡ã®12ãƒ¶æœˆã®äºˆæ¸¬:")
for date, value, lower, upper in zip(future_dates, future_forecast,
                                      future_ci.iloc[:, 0], future_ci.iloc[:, 1]):
    print(f"{date.strftime('%Y-%m')}: {value:.2f} (95%CI: [{lower:.2f}, {upper:.2f}])")

# å°†æ¥äºˆæ¸¬ã®å¯è¦–åŒ–
plt.figure(figsize=(14, 6))
plt.plot(ts_sales.index, ts_sales, label='å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿', linewidth=2, color='blue')
plt.plot(future_dates, future_forecast, label='12ãƒ¶æœˆå…ˆäºˆæ¸¬',
         linewidth=2, linestyle='--', color='red', marker='o')
plt.fill_between(future_dates,
                 future_ci.iloc[:, 0],
                 future_ci.iloc[:, 1],
                 alpha=0.2, color='red', label='95%ä¿¡é ¼åŒºé–“')
plt.axvline(x=ts_sales.index[-1], color='gray', linestyle='--', alpha=0.5, label='äºˆæ¸¬é–‹å§‹')
plt.xlabel('å¹´æœˆ')
plt.ylabel('å£²ä¸Š')
plt.title('æœˆæ¬¡å£²ä¸Šã®12ãƒ¶æœˆå…ˆäºˆæ¸¬', fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# æ®‹å·®è¨ºæ–­
print("\n=== ã‚¹ãƒ†ãƒƒãƒ—4: æ®‹å·®è¨ºæ–­ ===")
residuals = final_fitted.resid

fig, axes = plt.subplots(2, 2, figsize=(14, 10))

axes[0, 0].plot(residuals)
axes[0, 0].axhline(y=0, color='red', linestyle='--')
axes[0, 0].set_title('æ®‹å·®ã®æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆ')
axes[0, 0].grid(True, alpha=0.3)

axes[0, 1].hist(residuals, bins=20, edgecolor='black', alpha=0.7)
axes[0, 1].set_title('æ®‹å·®ã®åˆ†å¸ƒ')
axes[0, 1].grid(True, alpha=0.3)

plot_acf(residuals, ax=axes[1, 0], lags=24)
axes[1, 0].set_title('æ®‹å·®ã®ACF')

from scipy import stats
stats.probplot(residuals, dist="norm", plot=axes[1, 1])
axes[1, 1].set_title('Q-Qãƒ—ãƒ­ãƒƒãƒˆ')
axes[1, 1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

from statsmodels.stats.diagnostic import acorr_ljungbox
lb_test = acorr_ljungbox(residuals, lags=[12, 24], return_df=True)
print("\nLjung-Boxæ¤œå®š:")
print(lb_test)
</code></pre>

</details>

<h3>å•é¡Œ5ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>æ™‚ç³»åˆ—äº¤å·®æ¤œè¨¼ï¼ˆTimeSeriesSplitï¼‰ãŒé€šå¸¸ã®äº¤å·®æ¤œè¨¼ï¼ˆKFoldï¼‰ã¨ç•°ãªã‚‹ç†ç”±ã‚’èª¬æ˜ã—ã€æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã§é€šå¸¸ã®äº¤å·®æ¤œè¨¼ã‚’ä½¿ã†ã¨ã©ã®ã‚ˆã†ãªå•é¡ŒãŒç™ºç”Ÿã™ã‚‹ã‹è¿°ã¹ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p><strong>æ™‚ç³»åˆ—äº¤å·®æ¤œè¨¼ã®ç‰¹å¾´</strong>ï¼š</p>

<ol>
<li><strong>æ™‚é–“é †åºã®ä¿æŒ</strong>: è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã¯å¸¸ã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚ˆã‚Šéå»</li>
<li><strong>ç´¯ç©çš„ãªè¨“ç·´</strong>: è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºãŒå¾ã€…ã«å¢—åŠ </li>
<li><strong>æœªæ¥ãƒ‡ãƒ¼ã‚¿ã®æ’é™¤</strong>: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒè¨“ç·´ã«å«ã¾ã‚Œãªã„</li>
</ol>

<p><strong>é€šå¸¸ã®äº¤å·®æ¤œè¨¼ï¼ˆKFoldï¼‰ã®å•é¡Œ</strong>ï¼š</p>

<table>
<thead>
<tr>
<th>å•é¡Œ</th>
<th>èª¬æ˜</th>
<th>å½±éŸ¿</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯</strong></td>
<td>æœªæ¥ã®ãƒ‡ãƒ¼ã‚¿ã§è¨“ç·´ã€éå»ã‚’äºˆæ¸¬</td>
<td>æ€§èƒ½ã®éå¤§è©•ä¾¡</td>
</tr>
<tr>
<td><strong>è‡ªå·±ç›¸é–¢ã®ç„¡è¦–</strong></td>
<td>æ™‚é–“çš„ä¾å­˜æ€§ã‚’è€ƒæ…®ã—ãªã„</td>
<td>ä¸é©åˆ‡ãªåˆ†å‰²</td>
</tr>
<tr>
<td><strong>ç¾å®Ÿã¨ã®ä¹–é›¢</strong></td>
<td>å®Ÿé‹ç”¨ã§ã¯æœªæ¥ã¯ä¸æ˜</td>
<td>ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®æ€§èƒ½åŠ£åŒ–</td>
</tr>
</tbody>
</table>

<p><strong>å…·ä½“ä¾‹</strong>ï¼š</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.model_selection import KFold, TimeSeriesSplit
import matplotlib.pyplot as plt

# æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰ã‚ã‚Šï¼‰
n = 100
ts = pd.Series(np.arange(n) + np.random.normal(0, 5, n))

# é€šå¸¸ã®KFoldï¼ˆå•é¡Œã‚ã‚Šï¼‰
kfold = KFold(n_splits=5, shuffle=True, random_state=42)

# TimeSeriesSplitï¼ˆæ­£ã—ã„ï¼‰
tscv = TimeSeriesSplit(n_splits=5)

# å¯è¦–åŒ–
fig, axes = plt.subplots(2, 1, figsize=(14, 10))

# KFold
for fold, (train_idx, test_idx) in enumerate(kfold.split(ts), 1):
    axes[0].scatter(train_idx, [fold] * len(train_idx),
                    c='blue', marker='|', s=100, label='è¨“ç·´' if fold == 1 else '')
    axes[0].scatter(test_idx, [fold] * len(test_idx),
                    c='red', marker='|', s=100, label='ãƒ†ã‚¹ãƒˆ' if fold == 1 else '')

axes[0].set_ylabel('Fold')
axes[0].set_xlabel('æ™‚é–“ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹')
axes[0].set_title('é€šå¸¸ã®KFoldï¼ˆå•é¡Œã‚ã‚Š: æœªæ¥ã§è¨“ç·´ã€éå»ã‚’äºˆæ¸¬ï¼‰', fontsize=14)
axes[0].legend()
axes[0].grid(True, alpha=0.3)

# TimeSeriesSplit
for fold, (train_idx, test_idx) in enumerate(tscv.split(ts), 1):
    axes[1].scatter(train_idx, [fold] * len(train_idx),
                    c='blue', marker='|', s=100, label='è¨“ç·´' if fold == 1 else '')
    axes[1].scatter(test_idx, [fold] * len(test_idx),
                    c='red', marker='|', s=100, label='ãƒ†ã‚¹ãƒˆ' if fold == 1 else '')

axes[1].set_ylabel('Fold')
axes[1].set_xlabel('æ™‚é–“ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹')
axes[1].set_title('TimeSeriesSplitï¼ˆæ­£ã—ã„: éå»ã§è¨“ç·´ã€æœªæ¥ã‚’äºˆæ¸¬ï¼‰', fontsize=14)
axes[1].legend()
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()
</code></pre>

<p><strong>çµè«–</strong>ï¼š</p>
<ul>
<li>æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã§ã¯ã€å¿…ãš<strong>TimeSeriesSplit</strong>ã‚’ä½¿ç”¨</li>
<li>æ™‚é–“é †åºã‚’ä¿æŒã—ã€æœªæ¥ã®ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ã‚’é˜²ã</li>
<li>å®Ÿé‹ç”¨ã¨åŒã˜æ¡ä»¶ã§è©•ä¾¡ã§ãã‚‹</li>
</ul>

</details>

<hr>

<h2>å‚è€ƒæ–‡çŒ®</h2>

<ol>
<li>Box, G. E. P., Jenkins, G. M., Reinsel, G. C., & Ljung, G. M. (2015). <em>Time Series Analysis: Forecasting and Control</em> (5th ed.). Wiley.</li>
<li>Hyndman, R. J., & Athanasopoulos, G. (2021). <em>Forecasting: Principles and Practice</em> (3rd ed.). OTexts. Available at: <a href="https://otexts.com/fpp3/">https://otexts.com/fpp3/</a></li>
<li>Shumway, R. H., & Stoffer, D. S. (2017). <em>Time Series Analysis and Its Applications: With R Examples</em> (4th ed.). Springer.</li>
<li>Brockwell, P. J., & Davis, R. A. (2016). <em>Introduction to Time Series and Forecasting</em> (3rd ed.). Springer.</li>
<li>Seabold, S., & Perktold, J. (2010). statsmodels: Econometric and statistical modeling with python. <em>Proceedings of the 9th Python in Science Conference</em>.</li>
</ol>

<div class="navigation">
    <a href="index.html" class="nav-button">â† ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡</a>
    <a href="chapter3-machine-learning.html" class="nav-button">æ¬¡ã®ç« : æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹æ™‚ç³»åˆ—äºˆæ¸¬ â†’</a>
</div>

    </main>

    
    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

<footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-21</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>