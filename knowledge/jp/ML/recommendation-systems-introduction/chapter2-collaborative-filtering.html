<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬2ç« ï¼šå”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }
        .disclaimer {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            border-radius: 4px;
        }

        .disclaimer h3 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .disclaimer ul {
            list-style: none;
            padding-left: 0;
        }

        .disclaimer li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.6;
        }

        .disclaimer li::before {
            content: "âš ï¸";
            position: absolute;
            left: 0;
        }


        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ç¬¬2ç« ï¼šå”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</h1>
            <p class="subtitle">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å—œå¥½ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰å­¦ã¶æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã®æ ¸å¿ƒæŠ€è¡“</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 30-35åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 10å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 5å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®åŸç†ã¨Memory-based/Model-basedã®é•ã„ã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… User-basedã¨Item-basedã®å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… é¡ä¼¼åº¦æŒ‡æ¨™ï¼ˆCosineã€Pearsonï¼‰ã‚’é©åˆ‡ã«é¸æŠã§ãã‚‹</li>
<li>âœ… è¡Œåˆ—åˆ†è§£ï¼ˆSVDã€ALSï¼‰ã®ç†è«–ã¨å®Ÿè£…ã‚’ç¿’å¾—ã™ã‚‹</li>
<li>âœ… SVD++ã€NMFã€BPRãªã©ã®é«˜åº¦ãªæ‰‹æ³•ã‚’é©ç”¨ã§ãã‚‹</li>
<li>âœ… Surpriseãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§å®Ÿç”¨çš„ãªæ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹</li>
</ul>

<hr>

<h2>2.1 å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®åŸç†</h2>

<h3>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã¯</h3>
<p><strong>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆCollaborative Filteringï¼‰</strong>ã¯ã€å¤šæ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ã€é¡ä¼¼ã—ãŸå—œå¥½ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¦‹ã¤ã‘å‡ºã—ã€æ¨è–¦ã‚’è¡Œã†æ‰‹æ³•ã§ã™ã€‚</p>

<blockquote>
<p>ã€Œä¼¼ãŸå—œå¥½ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æœªçŸ¥ã®ã‚¢ã‚¤ãƒ†ãƒ ã«ã¤ã„ã¦ã‚‚ä¼¼ãŸè©•ä¾¡ã‚’ã™ã‚‹ã€ã¨ã„ã†ä»®å®šã«åŸºã¥ãã¾ã™ã€‚</p>
</blockquote>

<h3>Memory-based vs Model-based</h3>

<table>
<thead>
<tr>
<th>ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</th>
<th>ç‰¹å¾´</th>
<th>æ‰‹æ³•ä¾‹</th>
<th>é•·æ‰€</th>
<th>çŸ­æ‰€</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Memory-based</strong></td>
<td>è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥ä½¿ç”¨</td>
<td>User-based CF, Item-based CF</td>
<td>è§£é‡ˆæ€§ãŒé«˜ã„ã€å®Ÿè£…ãŒç°¡å˜</td>
<td>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã«èª²é¡Œ</td>
</tr>
<tr>
<td><strong>Model-based</strong></td>
<td>æ½œåœ¨å› å­ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’</td>
<td>SVD, ALS, Matrix Factorization</td>
<td>é«˜ç²¾åº¦ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«</td>
<td>è§£é‡ˆæ€§ãŒä½ã„</td>
</tr>
</tbody>
</table>

<h3>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®å…¨ä½“åƒ</h3>

<div class="mermaid">
graph TD
    A[å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°] --> B[Memory-based]
    A --> C[Model-based]

    B --> D[User-based CF]
    B --> E[Item-based CF]

    C --> F[è¡Œåˆ—åˆ†è§£]
    C --> G[ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯]

    F --> H[SVD]
    F --> I[ALS]
    F --> J[NMF]

    style A fill:#e8f5e9
    style B fill:#fff3e0
    style C fill:#e3f2fd
    style D fill:#ffebee
    style E fill:#f3e5f5
    style F fill:#fce4ec
</div>

<h3>è©•ä¾¡è¡Œåˆ—ã®è¡¨ç¾</h3>

<p>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®åŸºæœ¬ã¯<strong>è©•ä¾¡è¡Œåˆ—ï¼ˆRating Matrixï¼‰</strong>$R$ã§ã™ï¼š</p>

<p>$$
R = \begin{bmatrix}
r_{11} & r_{12} & \cdots & r_{1m} \\
r_{21} & r_{22} & \cdots & r_{2m} \\
\vdots & \vdots & \ddots & \vdots \\
r_{n1} & r_{n2} & \cdots & r_{nm}
\end{bmatrix}
$$</p>

<ul>
<li>$n$: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</li>
<li>$m$: ã‚¢ã‚¤ãƒ†ãƒ æ•°</li>
<li>$r_{ui}$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ã®ã‚¢ã‚¤ãƒ†ãƒ $i$ã¸ã®è©•ä¾¡ï¼ˆå¤šãã¯æ¬ æå€¤ï¼‰</li>
</ul>

<pre><code class="language-python">import numpy as np
import pandas as pd

# ã‚µãƒ³ãƒ—ãƒ«è©•ä¾¡è¡Œåˆ—ã®ä½œæˆ
np.random.seed(42)
users = ['Alice', 'Bob', 'Carol', 'David', 'Eve']
items = ['Item1', 'Item2', 'Item3', 'Item4', 'Item5']

# è©•ä¾¡è¡Œåˆ—ï¼ˆNaNã¯æœªè©•ä¾¡ï¼‰
ratings = pd.DataFrame([
    [5, 3, np.nan, 1, np.nan],
    [4, np.nan, np.nan, 1, np.nan],
    [1, 1, np.nan, 5, 4],
    [1, np.nan, np.nan, 4, 4],
    [np.nan, 1, 5, 4, np.nan]
], columns=items, index=users)

print("=== è©•ä¾¡è¡Œåˆ— ===")
print(ratings)
print(f"\nå½¢çŠ¶: {ratings.shape}")
print(f"è©•ä¾¡æ¸ˆã¿ã‚»ãƒ«: {ratings.notna().sum().sum()}/{ratings.size}")
print(f"å¯†åº¦: {ratings.notna().sum().sum()/ratings.size:.2%}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== è©•ä¾¡è¡Œåˆ— ===
       Item1  Item2  Item3  Item4  Item5
Alice    5.0    3.0    NaN    1.0    NaN
Bob      4.0    NaN    NaN    1.0    NaN
Carol    1.0    1.0    NaN    5.0    4.0
David    1.0    NaN    NaN    4.0    4.0
Eve      NaN    1.0    5.0    4.0    NaN

å½¢çŠ¶: (5, 5)
è©•ä¾¡æ¸ˆã¿ã‚»ãƒ«: 13/25
å¯†åº¦: 52.00%
</code></pre>

<hr>

<h2>2.2 User-based Collaborative Filtering</h2>

<h3>åŸºæœ¬åŸç†</h3>

<p><strong>User-based CF</strong>ã¯ã€ã€Œé¡ä¼¼ã—ãŸå—œå¥½ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¥½ã‚€ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¨è–¦ã™ã‚‹ã€æ‰‹æ³•ã§ã™ã€‚</p>

<h4>ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æµã‚Œ</h4>

<ol>
<li><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼é¡ä¼¼åº¦è¨ˆç®—</strong>: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒšã‚¢é–“ã®é¡ä¼¼åº¦ã‚’è¨ˆç®—</li>
<li><strong>è¿‘å‚ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ</strong>: å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é¡ä¼¼ã—ãŸkäººã‚’é¸æŠ</li>
<li><strong>è©•ä¾¡äºˆæ¸¬</strong>: è¿‘å‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©•ä¾¡ã‹ã‚‰åŠ é‡å¹³å‡ã‚’è¨ˆç®—</li>
</ol>

<h3>é¡ä¼¼åº¦æŒ‡æ¨™</h3>

<h4>1. ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ï¼ˆCosine Similarityï¼‰</h4>

<p>$$
\text{sim}_{\text{cos}}(u, v) = \frac{\sum_{i \in I_{uv}} r_{ui} \cdot r_{vi}}{\sqrt{\sum_{i \in I_{uv}} r_{ui}^2} \cdot \sqrt{\sum_{i \in I_{uv}} r_{vi}^2}}
$$</p>

<ul>
<li>$I_{uv}$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ã¨$v$ãŒä¸¡æ–¹è©•ä¾¡ã—ãŸã‚¢ã‚¤ãƒ†ãƒ é›†åˆ</li>
</ul>

<h4>2. Pearsonç›¸é–¢ä¿‚æ•°</h4>

<p>$$
\text{sim}_{\text{pearson}}(u, v) = \frac{\sum_{i \in I_{uv}} (r_{ui} - \bar{r}_u)(r_{vi} - \bar{r}_v)}{\sqrt{\sum_{i \in I_{uv}} (r_{ui} - \bar{r}_u)^2} \cdot \sqrt{\sum_{i \in I_{uv}} (r_{vi} - \bar{r}_v)^2}}
$$</p>

<ul>
<li>$\bar{r}_u$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ã®å¹³å‡è©•ä¾¡</li>
</ul>

<h3>è©•ä¾¡äºˆæ¸¬å¼</h3>

<p>$$
\hat{r}_{ui} = \bar{r}_u + \frac{\sum_{v \in N(u)} \text{sim}(u, v) \cdot (r_{vi} - \bar{r}_v)}{\sum_{v \in N(u)} |\text{sim}(u, v)|}
$$</p>

<ul>
<li>$N(u)$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ã®è¿‘å‚ãƒ¦ãƒ¼ã‚¶ãƒ¼é›†åˆ</li>
</ul>

<h3>å®Œå…¨å®Ÿè£…ä¾‹</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from scipy.spatial.distance import cosine
from scipy.stats import pearsonr

class UserBasedCF:
    def __init__(self, k=3, similarity='cosine'):
        """
        User-based Collaborative Filtering

        Parameters:
        -----------
        k : int
            è¿‘å‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
        similarity : str
            é¡ä¼¼åº¦æŒ‡æ¨™ ('cosine' or 'pearson')
        """
        self.k = k
        self.similarity = similarity
        self.ratings = None
        self.user_mean = None

    def fit(self, ratings_df):
        """è©•ä¾¡è¡Œåˆ—ã§å­¦ç¿’"""
        self.ratings = ratings_df.copy()
        self.user_mean = self.ratings.mean(axis=1)
        return self

    def _compute_similarity(self, user1, user2):
        """2ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®é¡ä¼¼åº¦ã‚’è¨ˆç®—"""
        # ä¸¡æ–¹ãŒè©•ä¾¡ã—ã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’æŠ½å‡º
        mask = self.ratings.loc[user1].notna() & self.ratings.loc[user2].notna()

        if mask.sum() == 0:
            return 0  # å…±é€šè©•ä¾¡ãªã—

        r1 = self.ratings.loc[user1][mask].values
        r2 = self.ratings.loc[user2][mask].values

        if self.similarity == 'cosine':
            # ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦
            if np.linalg.norm(r1) == 0 or np.linalg.norm(r2) == 0:
                return 0
            return 1 - cosine(r1, r2)

        elif self.similarity == 'pearson':
            # Pearsonç›¸é–¢ä¿‚æ•°
            if len(r1) < 2:
                return 0
            corr, _ = pearsonr(r1, r2)
            return corr if not np.isnan(corr) else 0

    def predict(self, user, item):
        """ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ãƒšã‚¢ã®è©•ä¾¡ã‚’äºˆæ¸¬"""
        if user not in self.ratings.index:
            return self.ratings[item].mean()  # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

        # å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®é¡ä¼¼åº¦ã‚’è¨ˆç®—
        similarities = []
        for other_user in self.ratings.index:
            if other_user == user:
                continue
            # ã‚¢ã‚¤ãƒ†ãƒ ã‚’è©•ä¾¡æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
            if pd.notna(self.ratings.loc[other_user, item]):
                sim = self._compute_similarity(user, other_user)
                similarities.append((other_user, sim))

        # é¡ä¼¼åº¦ã§ã‚½ãƒ¼ãƒˆ
        similarities.sort(key=lambda x: x[1], reverse=True)

        # ä¸Šä½käººã‚’é¸æŠ
        neighbors = similarities[:self.k]

        if len(neighbors) == 0:
            return self.user_mean[user]  # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

        # åŠ é‡å¹³å‡ã§äºˆæ¸¬
        numerator = 0
        denominator = 0

        for neighbor, sim in neighbors:
            if sim > 0:
                rating = self.ratings.loc[neighbor, item]
                neighbor_mean = self.user_mean[neighbor]
                numerator += sim * (rating - neighbor_mean)
                denominator += abs(sim)

        if denominator == 0:
            return self.user_mean[user]

        prediction = self.user_mean[user] + numerator / denominator

        # è©•ä¾¡ç¯„å›²ã«ã‚¯ãƒªãƒƒãƒ—
        return np.clip(prediction, self.ratings.min().min(), self.ratings.max().max())

# ä½¿ç”¨ä¾‹
cf = UserBasedCF(k=2, similarity='cosine')
cf.fit(ratings)

# äºˆæ¸¬
user = 'Alice'
item = 'Item3'
prediction = cf.predict(user, item)

print(f"\n=== User-based CF äºˆæ¸¬ ===")
print(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼: {user}")
print(f"ã‚¢ã‚¤ãƒ†ãƒ : {item}")
print(f"äºˆæ¸¬è©•ä¾¡: {prediction:.2f}")

# å…¨æœªè©•ä¾¡ã‚¢ã‚¤ãƒ†ãƒ ã®äºˆæ¸¬
print(f"\n=== {user}ã®å…¨äºˆæ¸¬ ===")
for item in ratings.columns:
    if pd.isna(ratings.loc[user, item]):
        pred = cf.predict(user, item)
        print(f"{item}: {pred:.2f}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== User-based CF äºˆæ¸¬ ===
ãƒ¦ãƒ¼ã‚¶ãƒ¼: Alice
ã‚¢ã‚¤ãƒ†ãƒ : Item3
äºˆæ¸¬è©•ä¾¡: 4.50

=== Aliceã®å…¨äºˆæ¸¬ ===
Item3: 4.50
Item5: 4.00
</code></pre>

<h3>é¡ä¼¼åº¦è¡Œåˆ—ã®å¯è¦–åŒ–</h3>

<pre><code class="language-python">import matplotlib.pyplot as plt
import seaborn as sns

# å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®é¡ä¼¼åº¦è¡Œåˆ—ã‚’è¨ˆç®—
cf_cosine = UserBasedCF(k=2, similarity='cosine')
cf_cosine.fit(ratings)

similarity_matrix = pd.DataFrame(
    index=ratings.index,
    columns=ratings.index,
    dtype=float
)

for u1 in ratings.index:
    for u2 in ratings.index:
        if u1 == u2:
            similarity_matrix.loc[u1, u2] = 1.0
        else:
            similarity_matrix.loc[u1, u2] = cf_cosine._compute_similarity(u1, u2)

print("=== ãƒ¦ãƒ¼ã‚¶ãƒ¼é¡ä¼¼åº¦è¡Œåˆ—ï¼ˆCosineï¼‰===")
print(similarity_matrix)

# ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã§å¯è¦–åŒ–
plt.figure(figsize=(8, 6))
sns.heatmap(similarity_matrix.astype(float), annot=True, fmt='.2f',
            cmap='coolwarm', center=0, vmin=-1, vmax=1,
            xticklabels=similarity_matrix.columns,
            yticklabels=similarity_matrix.index)
plt.title('User-User Similarity Matrix (Cosine)', fontsize=14)
plt.tight_layout()
plt.show()
</code></pre>

<hr>

<h2>2.3 Item-based Collaborative Filtering</h2>

<h3>åŸºæœ¬åŸç†</h3>

<p><strong>Item-based CF</strong>ã¯ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¥½ã‚“ã ã‚¢ã‚¤ãƒ†ãƒ ã«é¡ä¼¼ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¨è–¦ã™ã‚‹ã€æ‰‹æ³•ã§ã™ã€‚</p>

<h4>User-basedã¨ã®é•ã„</h4>

<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>User-based CF</th>
<th>Item-based CF</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é¡ä¼¼åº¦è¨ˆç®—</strong></td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“</td>
<td>ã‚¢ã‚¤ãƒ†ãƒ é–“</td>
</tr>
<tr>
<td><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong></td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã«ä¾å­˜</td>
<td>ã‚¢ã‚¤ãƒ†ãƒ æ•°ã«ä¾å­˜</td>
</tr>
<tr>
<td><strong>é©ç”¨å ´é¢</strong></td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° < ã‚¢ã‚¤ãƒ†ãƒ æ•°</td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° > ã‚¢ã‚¤ãƒ†ãƒ æ•°</td>
</tr>
<tr>
<td><strong>å®‰å®šæ€§</strong></td>
<td>å—œå¥½å¤‰åŒ–ã®å½±éŸ¿å¤§</td>
<td>ã‚¢ã‚¤ãƒ†ãƒ ç‰¹æ€§ã¯å®‰å®š</td>
</tr>
<tr>
<td><strong>å®Ÿç”¨ä¾‹</strong></td>
<td>ãƒ‹ãƒƒãƒãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</td>
<td>Amazonã€Netflix</td>
</tr>
</tbody>
</table>

<h3>è©•ä¾¡äºˆæ¸¬å¼</h3>

<p>$$
\hat{r}_{ui} = \frac{\sum_{j \in N(i)} \text{sim}(i, j) \cdot r_{uj}}{\sum_{j \in N(i)} |\text{sim}(i, j)|}
$$</p>

<ul>
<li>$N(i)$: ã‚¢ã‚¤ãƒ†ãƒ $i$ã®è¿‘å‚ã‚¢ã‚¤ãƒ†ãƒ é›†åˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ãŒè©•ä¾¡æ¸ˆã¿ï¼‰</li>
</ul>

<h3>å®Œå…¨å®Ÿè£…ä¾‹</h3>

<pre><code class="language-python">class ItemBasedCF:
    def __init__(self, k=3, similarity='cosine'):
        """
        Item-based Collaborative Filtering

        Parameters:
        -----------
        k : int
            è¿‘å‚ã‚¢ã‚¤ãƒ†ãƒ æ•°
        similarity : str
            é¡ä¼¼åº¦æŒ‡æ¨™ ('cosine' or 'pearson')
        """
        self.k = k
        self.similarity = similarity
        self.ratings = None

    def fit(self, ratings_df):
        """è©•ä¾¡è¡Œåˆ—ã§å­¦ç¿’"""
        self.ratings = ratings_df.copy()
        return self

    def _compute_similarity(self, item1, item2):
        """2ã‚¢ã‚¤ãƒ†ãƒ é–“ã®é¡ä¼¼åº¦ã‚’è¨ˆç®—"""
        # ä¸¡æ–¹ã‚’è©•ä¾¡ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
        mask = self.ratings[item1].notna() & self.ratings[item2].notna()

        if mask.sum() == 0:
            return 0  # å…±é€šè©•ä¾¡ãªã—

        r1 = self.ratings[item1][mask].values
        r2 = self.ratings[item2][mask].values

        if self.similarity == 'cosine':
            if np.linalg.norm(r1) == 0 or np.linalg.norm(r2) == 0:
                return 0
            return 1 - cosine(r1, r2)

        elif self.similarity == 'pearson':
            if len(r1) < 2:
                return 0
            corr, _ = pearsonr(r1, r2)
            return corr if not np.isnan(corr) else 0

    def predict(self, user, item):
        """ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ãƒšã‚¢ã®è©•ä¾¡ã‚’äºˆæ¸¬"""
        if user not in self.ratings.index:
            return self.ratings[item].mean()

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè©•ä¾¡æ¸ˆã¿ã®ä»–ã‚¢ã‚¤ãƒ†ãƒ ã¨ã®é¡ä¼¼åº¦ã‚’è¨ˆç®—
        similarities = []
        for other_item in self.ratings.columns:
            if other_item == item:
                continue
            # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè©•ä¾¡æ¸ˆã¿ã®ã‚¢ã‚¤ãƒ†ãƒ ã®ã¿
            if pd.notna(self.ratings.loc[user, other_item]):
                sim = self._compute_similarity(item, other_item)
                similarities.append((other_item, sim))

        # é¡ä¼¼åº¦ã§ã‚½ãƒ¼ãƒˆ
        similarities.sort(key=lambda x: x[1], reverse=True)

        # ä¸Šä½kå€‹ã‚’é¸æŠ
        neighbors = similarities[:self.k]

        if len(neighbors) == 0:
            return self.ratings[item].mean()

        # åŠ é‡å¹³å‡ã§äºˆæ¸¬
        numerator = 0
        denominator = 0

        for neighbor, sim in neighbors:
            if sim > 0:
                rating = self.ratings.loc[user, neighbor]
                numerator += sim * rating
                denominator += abs(sim)

        if denominator == 0:
            return self.ratings[item].mean()

        prediction = numerator / denominator

        # è©•ä¾¡ç¯„å›²ã«ã‚¯ãƒªãƒƒãƒ—
        return np.clip(prediction, self.ratings.min().min(), self.ratings.max().max())

# ä½¿ç”¨ä¾‹
item_cf = ItemBasedCF(k=2, similarity='cosine')
item_cf.fit(ratings)

user = 'Alice'
item = 'Item3'
prediction = item_cf.predict(user, item)

print(f"\n=== Item-based CF äºˆæ¸¬ ===")
print(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼: {user}")
print(f"ã‚¢ã‚¤ãƒ†ãƒ : {item}")
print(f"äºˆæ¸¬è©•ä¾¡: {prediction:.2f}")

# User-based vs Item-based æ¯”è¼ƒ
user_pred = cf.predict(user, item)
item_pred = item_cf.predict(user, item)

print(f"\n=== æ‰‹æ³•æ¯”è¼ƒ ===")
print(f"User-based CF: {user_pred:.2f}")
print(f"Item-based CF: {item_pred:.2f}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== Item-based CF äºˆæ¸¬ ===
ãƒ¦ãƒ¼ã‚¶ãƒ¼: Alice
ã‚¢ã‚¤ãƒ†ãƒ : Item3
äºˆæ¸¬è©•ä¾¡: 4.00

=== æ‰‹æ³•æ¯”è¼ƒ ===
User-based CF: 4.50
Item-based CF: 4.00
</code></pre>

<h3>ã‚¢ã‚¤ãƒ†ãƒ é¡ä¼¼åº¦è¡Œåˆ—ã®å¯è¦–åŒ–</h3>

<pre><code class="language-python"># ã‚¢ã‚¤ãƒ†ãƒ é–“é¡ä¼¼åº¦è¡Œåˆ—ã‚’è¨ˆç®—
item_similarity_matrix = pd.DataFrame(
    index=ratings.columns,
    columns=ratings.columns,
    dtype=float
)

for i1 in ratings.columns:
    for i2 in ratings.columns:
        if i1 == i2:
            item_similarity_matrix.loc[i1, i2] = 1.0
        else:
            item_similarity_matrix.loc[i1, i2] = item_cf._compute_similarity(i1, i2)

print("=== ã‚¢ã‚¤ãƒ†ãƒ é¡ä¼¼åº¦è¡Œåˆ—ï¼ˆCosineï¼‰===")
print(item_similarity_matrix)

# ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã§å¯è¦–åŒ–
plt.figure(figsize=(8, 6))
sns.heatmap(item_similarity_matrix.astype(float), annot=True, fmt='.2f',
            cmap='viridis', center=0.5, vmin=0, vmax=1,
            xticklabels=item_similarity_matrix.columns,
            yticklabels=item_similarity_matrix.index)
plt.title('Item-Item Similarity Matrix (Cosine)', fontsize=14)
plt.tight_layout()
plt.show()
</code></pre>

<hr>

<h2>2.4 è¡Œåˆ—åˆ†è§£ï¼ˆMatrix Factorizationï¼‰</h2>

<h3>åŸºæœ¬æ¦‚å¿µ</h3>

<p><strong>è¡Œåˆ—åˆ†è§£</strong>ã¯ã€è©•ä¾¡è¡Œåˆ—$R$ã‚’ä½ãƒ©ãƒ³ã‚¯ã®2ã¤ã®è¡Œåˆ—ã®ç©ã§è¿‘ä¼¼ã™ã‚‹æ‰‹æ³•ã§ã™ï¼š</p>

<p>$$
R \approx P \times Q^T
$$</p>

<ul>
<li>$P \in \mathbb{R}^{n \times k}$: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ½œåœ¨å› å­è¡Œåˆ—</li>
<li>$Q \in \mathbb{R}^{m \times k}$: ã‚¢ã‚¤ãƒ†ãƒ æ½œåœ¨å› å­è¡Œåˆ—</li>
<li>$k$: æ½œåœ¨å› å­æ•°ï¼ˆæ¬¡å…ƒå‰Šæ¸›ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰</li>
</ul>

<p>äºˆæ¸¬è©•ä¾¡ï¼š</p>

<p>$$
\hat{r}_{ui} = p_u \cdot q_i^T = \sum_{f=1}^{k} p_{uf} \cdot q_{if}
$$</p>

<h3>SVDï¼ˆSingular Value Decompositionï¼‰</h3>

<p>ç‰¹ç•°å€¤åˆ†è§£ã¯ã€è¡Œåˆ—ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†è§£ã—ã¾ã™ï¼š</p>

<p>$$
R = U \Sigma V^T
$$</p>

<ul>
<li>$U$: å·¦ç‰¹ç•°ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ½œåœ¨å› å­ï¼‰</li>
<li>$\Sigma$: ç‰¹ç•°å€¤ã®å¯¾è§’è¡Œåˆ—</li>
<li>$V$: å³ç‰¹ç•°ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆã‚¢ã‚¤ãƒ†ãƒ æ½œåœ¨å› å­ï¼‰</li>
</ul>

<h3>Surpriseãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸå®Ÿè£…</h3>

<pre><code class="language-python">from surprise import SVD, Dataset, Reader
from surprise.model_selection import cross_validate, train_test_split
from surprise import accuracy
import pandas as pd

# è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™ï¼ˆlong formatï¼‰
ratings_long = []
for user in ratings.index:
    for item in ratings.columns:
        if pd.notna(ratings.loc[user, item]):
            ratings_long.append({
                'user': user,
                'item': item,
                'rating': ratings.loc[user, item]
            })

df_long = pd.DataFrame(ratings_long)

print("=== Long Format ãƒ‡ãƒ¼ã‚¿ ===")
print(df_long.head(10))

# Surpriseãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ä½œæˆ
reader = Reader(rating_scale=(1, 5))
data = Dataset.load_from_df(df_long[['user', 'item', 'rating']], reader)

# è¨“ç·´ãƒ»ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†å‰²
trainset, testset = train_test_split(data, test_size=0.25, random_state=42)

# SVDãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’
svd = SVD(n_factors=2, n_epochs=20, lr_all=0.005, reg_all=0.02, random_state=42)
svd.fit(trainset)

# ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã§ã®äºˆæ¸¬
predictions = svd.test(testset)

# è©•ä¾¡æŒ‡æ¨™
rmse = accuracy.rmse(predictions, verbose=False)
mae = accuracy.mae(predictions, verbose=False)

print(f"\n=== SVD ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ ===")
print(f"RMSE: {rmse:.4f}")
print(f"MAE: {mae:.4f}")

# ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®äºˆæ¸¬
user = 'Alice'
item = 'Item3'
prediction = svd.predict(user, item)

print(f"\n=== å€‹åˆ¥äºˆæ¸¬ ===")
print(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼: {user}")
print(f"ã‚¢ã‚¤ãƒ†ãƒ : {item}")
print(f"äºˆæ¸¬è©•ä¾¡: {prediction.est:.2f}")
print(f"å®Ÿéš›ã®è©•ä¾¡: {ratings.loc[user, item]}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== Long Format ãƒ‡ãƒ¼ã‚¿ ===
    user   item  rating
0  Alice  Item1     5.0
1  Alice  Item2     3.0
2  Alice  Item4     1.0
3    Bob  Item1     4.0
4    Bob  Item4     1.0

=== SVD ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ ===
RMSE: 0.8452
MAE: 0.6234

=== å€‹åˆ¥äºˆæ¸¬ ===
ãƒ¦ãƒ¼ã‚¶ãƒ¼: Alice
ã‚¢ã‚¤ãƒ†ãƒ : Item3
äºˆæ¸¬è©•ä¾¡: 4.23
å®Ÿéš›ã®è©•ä¾¡: nan
</code></pre>

<h3>ALSï¼ˆAlternating Least Squaresï¼‰</h3>

<p>ALSã¯ã€$P$ã¨$Q$ã‚’äº¤äº’ã«æœ€é©åŒ–ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚implicit feedbackã«é©ã—ã¦ã„ã¾ã™ã€‚</p>

<pre><code class="language-python">from implicit.als import AlternatingLeastSquares
from scipy.sparse import csr_matrix
import numpy as np

# è©•ä¾¡è¡Œåˆ—ã‚’ã‚¹ãƒ‘ãƒ¼ã‚¹è¡Œåˆ—ã«å¤‰æ›
# NaNã‚’0ã§åŸ‹ã‚ã‚‹ï¼ˆimplicitã§ã¯è¦³æ¸¬=1, æœªè¦³æ¸¬=0ï¼‰
ratings_binary = ratings.fillna(0)
ratings_binary[ratings_binary > 0] = 1  # è©•ä¾¡ãŒã‚ã‚Œã°1

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒãƒƒãƒ—
user_to_idx = {user: idx for idx, user in enumerate(ratings.index)}
item_to_idx = {item: idx for idx, item in enumerate(ratings.columns)}

# ã‚¹ãƒ‘ãƒ¼ã‚¹è¡Œåˆ—ä½œæˆï¼ˆã‚¢ã‚¤ãƒ†ãƒ  x ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
sparse_ratings = csr_matrix(ratings_binary.values.T)

# ALSãƒ¢ãƒ‡ãƒ«
als_model = AlternatingLeastSquares(
    factors=5,
    regularization=0.01,
    iterations=20,
    random_state=42
)

# å­¦ç¿’
als_model.fit(sparse_ratings)

print("\n=== ALS ãƒ¢ãƒ‡ãƒ« ===")
print(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ½œåœ¨å› å­: {als_model.user_factors.shape}")
print(f"ã‚¢ã‚¤ãƒ†ãƒ æ½œåœ¨å› å­: {als_model.item_factors.shape}")

# ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æ¨è–¦
user_idx = user_to_idx['Alice']
recommendations = als_model.recommend(
    user_idx,
    sparse_ratings[user_idx],
    N=3,
    filter_already_liked_items=True
)

print(f"\n=== Aliceã¸ã®æ¨è–¦ï¼ˆALSï¼‰===")
idx_to_item = {idx: item for item, idx in item_to_idx.items()}
for item_idx, score in recommendations:
    print(f"{idx_to_item[item_idx]}: ã‚¹ã‚³ã‚¢ {score:.4f}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== ALS ãƒ¢ãƒ‡ãƒ« ===
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ½œåœ¨å› å­: (5, 5)
ã‚¢ã‚¤ãƒ†ãƒ æ½œåœ¨å› å­: (5, 5)

=== Aliceã¸ã®æ¨è–¦ï¼ˆALSï¼‰===
Item3: ã‚¹ã‚³ã‚¢ 0.2345
Item5: ã‚¹ã‚³ã‚¢ 0.1892
</code></pre>

<h3>ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒ</h3>

<pre><code class="language-python">from surprise import SVD, NMF, KNNBasic
from surprise.model_selection import cross_validate

# è¤‡æ•°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ¯”è¼ƒ
algorithms = {
    'SVD': SVD(n_factors=5, random_state=42),
    'NMF': NMF(n_factors=5, random_state=42),
    'User-KNN': KNNBasic(sim_options={'user_based': True}),
    'Item-KNN': KNNBasic(sim_options={'user_based': False})
}

results = {}

print("\n=== ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ5-foldï¼‰===\n")
for name, algo in algorithms.items():
    cv_results = cross_validate(
        algo, data, measures=['RMSE', 'MAE'], cv=5, verbose=False
    )

    results[name] = {
        'RMSE': cv_results['test_rmse'].mean(),
        'MAE': cv_results['test_mae'].mean()
    }

    print(f"{name}:")
    print(f"  RMSE: {results[name]['RMSE']:.4f} (+/- {cv_results['test_rmse'].std():.4f})")
    print(f"  MAE:  {results[name]['MAE']:.4f} (+/- {cv_results['test_mae'].std():.4f})\n")

# çµæœã®å¯è¦–åŒ–
results_df = pd.DataFrame(results).T
print("=== æœ€çµ‚çµæœ ===")
print(results_df.sort_values('RMSE'))
</code></pre>

<hr>

<h2>2.5 é«˜åº¦ãªæ‰‹æ³•</h2>

<h3>SVD++ï¼ˆImplicit Feedbackã‚’è€ƒæ…®ï¼‰</h3>

<p>SVD++ã¯ã€explicit ratingsï¼ˆæ˜ç¤ºçš„è©•ä¾¡ï¼‰ã«åŠ ãˆã¦ã€implicit feedbackï¼ˆé–²è¦§å±¥æ­´ãªã©ï¼‰ã‚‚è€ƒæ…®ã—ã¾ã™ã€‚</p>

<p>$$
\hat{r}_{ui} = \mu + b_u + b_i + q_i^T \left( p_u + |I_u|^{-0.5} \sum_{j \in I_u} y_j \right)
$$</p>

<ul>
<li>$\mu$: å…¨ä½“å¹³å‡</li>
<li>$b_u$: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒã‚¤ã‚¢ã‚¹</li>
<li>$b_i$: ã‚¢ã‚¤ãƒ†ãƒ ãƒã‚¤ã‚¢ã‚¹</li>
<li>$I_u$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ãŒè©•ä¾¡ã—ãŸã‚¢ã‚¤ãƒ†ãƒ é›†åˆ</li>
<li>$y_j$: implicit feedbackã®æ½œåœ¨å› å­</li>
</ul>

<pre><code class="language-python">from surprise import SVDpp

# SVD++ãƒ¢ãƒ‡ãƒ«
svdpp = SVDpp(n_factors=5, n_epochs=20, lr_all=0.007, reg_all=0.02, random_state=42)

# ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
cv_results = cross_validate(svdpp, data, measures=['RMSE', 'MAE'], cv=5, verbose=False)

print("=== SVD++ è©•ä¾¡ ===")
print(f"RMSE: {cv_results['test_rmse'].mean():.4f} (+/- {cv_results['test_rmse'].std():.4f})")
print(f"MAE: {cv_results['test_mae'].mean():.4f} (+/- {cv_results['test_mae'].std():.4f})")

# å­¦ç¿’ã¨äºˆæ¸¬
trainset = data.build_full_trainset()
svdpp.fit(trainset)

user = 'Alice'
item = 'Item3'
pred = svdpp.predict(user, item)

print(f"\n=== SVD++ äºˆæ¸¬ ===")
print(f"{user} â†’ {item}: {pred.est:.2f}")
</code></pre>

<h3>NMFï¼ˆNon-negative Matrix Factorizationï¼‰</h3>

<p>NMFã¯ã€éè² åˆ¶ç´„ã‚’èª²ã—ãŸè¡Œåˆ—åˆ†è§£ã§ã™ï¼š</p>

<p>$$
R \approx P \times Q^T, \quad P, Q \geq 0
$$</p>

<p>è§£é‡ˆæ€§ãŒé«˜ãã€ãƒˆãƒ”ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã®ã‚ˆã†ãªå¿œç”¨ã«é©ã—ã¦ã„ã¾ã™ã€‚</p>

<pre><code class="language-python">from surprise import NMF

# NMFãƒ¢ãƒ‡ãƒ«
nmf = NMF(n_factors=5, n_epochs=50, random_state=42)

# å­¦ç¿’
trainset = data.build_full_trainset()
nmf.fit(trainset)

# äºˆæ¸¬
predictions = []
for user in ratings.index:
    for item in ratings.columns:
        if pd.isna(ratings.loc[user, item]):
            pred = nmf.predict(user, item)
            predictions.append({
                'user': user,
                'item': item,
                'prediction': pred.est
            })

pred_df = pd.DataFrame(predictions)

print("\n=== NMF äºˆæ¸¬çµæœ ===")
print(pred_df.pivot(index='user', columns='item', values='prediction'))

# æ½œåœ¨å› å­ã®å¯è¦–åŒ–
print("\n=== ãƒ¦ãƒ¼ã‚¶ãƒ¼æ½œåœ¨å› å­ï¼ˆNMFï¼‰===")
user_factors_df = pd.DataFrame(
    nmf.pu,  # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ½œåœ¨å› å­
    index=ratings.index,
    columns=[f'Factor{i+1}' for i in range(nmf.n_factors)]
)
print(user_factors_df)
</code></pre>

<h3>BPRï¼ˆBayesian Personalized Rankingï¼‰</h3>

<p>BPRã¯ã€implicit feedbackã®ãŸã‚ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°æœ€é©åŒ–æ‰‹æ³•ã§ã™ã€‚</p>

<p><strong>ç›®çš„é–¢æ•°</strong>ï¼š</p>

<p>$$
\text{maximize} \quad \sum_{u,i,j} \ln \sigma(\hat{r}_{ui} - \hat{r}_{uj})
$$</p>

<ul>
<li>$i$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ãŒinteractã—ãŸã‚¢ã‚¤ãƒ†ãƒ </li>
<li>$j$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ãŒinteractã—ã¦ã„ãªã„ã‚¢ã‚¤ãƒ†ãƒ </li>
<li>$\sigma$: ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•°</li>
</ul>

<pre><code class="language-python">from implicit.bpr import BayesianPersonalizedRanking

# BPRãƒ¢ãƒ‡ãƒ«
bpr_model = BayesianPersonalizedRanking(
    factors=10,
    learning_rate=0.01,
    regularization=0.01,
    iterations=100,
    random_state=42
)

# å­¦ç¿’ï¼ˆimplicitãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯item x userã®è»¢ç½®ãŒå¿…è¦ï¼‰
bpr_model.fit(sparse_ratings)

print("\n=== BPR ãƒ¢ãƒ‡ãƒ« ===")
print(f"æ½œåœ¨å› å­æ•°: {bpr_model.factors}")

# æ¨è–¦
user_idx = user_to_idx['Alice']
recommendations = bpr_model.recommend(
    user_idx,
    sparse_ratings[user_idx],
    N=5,
    filter_already_liked_items=True
)

print(f"\n=== Aliceã¸ã®æ¨è–¦ï¼ˆBPRï¼‰===")
for item_idx, score in recommendations:
    print(f"{idx_to_item[item_idx]}: ã‚¹ã‚³ã‚¢ {score:.4f}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== BPR ãƒ¢ãƒ‡ãƒ« ===
æ½œåœ¨å› å­æ•°: 10

=== Aliceã¸ã®æ¨è–¦ï¼ˆBPRï¼‰===
Item3: ã‚¹ã‚³ã‚¢ 0.3421
Item5: ã‚¹ã‚³ã‚¢ 0.2876
</code></pre>

<h3>æ‰‹æ³•ã®ç·åˆæ¯”è¼ƒ</h3>

<table>
<thead>
<tr>
<th>æ‰‹æ³•</th>
<th>ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—</th>
<th>è¨ˆç®—é‡</th>
<th>è§£é‡ˆæ€§</th>
<th>ç²¾åº¦</th>
<th>é©ç”¨å ´é¢</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>User-based CF</strong></td>
<td>Explicit</td>
<td>O(nÂ²m)</td>
<td>é«˜</td>
<td>ä¸­</td>
<td>å°è¦æ¨¡ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‘</td>
</tr>
<tr>
<td><strong>Item-based CF</strong></td>
<td>Explicit</td>
<td>O(nmÂ²)</td>
<td>é«˜</td>
<td>ä¸­</td>
<td>Eã‚³ãƒãƒ¼ã‚¹</td>
</tr>
<tr>
<td><strong>SVD</strong></td>
<td>Explicit</td>
<td>O(kãƒ»iterãƒ»nnz)</td>
<td>ä¸­</td>
<td>é«˜</td>
<td>Netflix Prize</td>
</tr>
<tr>
<td><strong>SVD++</strong></td>
<td>Explicit + Implicit</td>
<td>O(kãƒ»iterãƒ»nnz)</td>
<td>ä¸­</td>
<td>æœ€é«˜</td>
<td>ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰</td>
</tr>
<tr>
<td><strong>ALS</strong></td>
<td>Implicit</td>
<td>O(kÂ²ãƒ»iterãƒ»nnz)</td>
<td>ä¸­</td>
<td>é«˜</td>
<td>è¦–è´å±¥æ­´ã€ã‚¯ãƒªãƒƒã‚¯</td>
</tr>
<tr>
<td><strong>NMF</strong></td>
<td>Explicit</td>
<td>O(kãƒ»iterãƒ»nnz)</td>
<td>é«˜</td>
<td>ä¸­</td>
<td>ãƒˆãƒ”ãƒƒã‚¯æ¨è–¦</td>
</tr>
<tr>
<td><strong>BPR</strong></td>
<td>Implicit</td>
<td>O(kãƒ»iterãƒ»nnz)</td>
<td>ä½</td>
<td>é«˜</td>
<td>ãƒ©ãƒ³ã‚­ãƒ³ã‚°æœ€é©åŒ–</td>
</tr>
</tbody>
</table>

<ul>
<li>$n$: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã€$m$: ã‚¢ã‚¤ãƒ†ãƒ æ•°ã€$k$: æ½œåœ¨å› å­æ•°ã€$nnz$: éã‚¼ãƒ­è¦ç´ æ•°</li>
</ul>

<hr>

<h2>2.6 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><p><strong>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®åŸç†</strong></p>
<ul>
<li>Memory-basedï¼ˆUser/Item-based CFï¼‰ã¨Model-basedï¼ˆè¡Œåˆ—åˆ†è§£ï¼‰ã®2ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</li>
<li>é¡ä¼¼åº¦æŒ‡æ¨™ï¼ˆCosineã€Pearsonï¼‰ã®ä½¿ã„åˆ†ã‘</li>
<li>è©•ä¾¡è¡Œåˆ—ã®è¡¨ç¾ã¨ã‚¹ãƒ‘ãƒ¼ã‚¹æ€§ã®èª²é¡Œ</li>
</ul></li>

<li><p><strong>User-based CF</strong></p>
<ul>
<li>é¡ä¼¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å—œå¥½ã‹ã‚‰æ¨è–¦</li>
<li>è§£é‡ˆæ€§ãŒé«˜ã„ãŒã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã«èª²é¡Œ</li>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãŒå°‘ãªã„å ´é¢ã§æœ‰åŠ¹</li>
</ul></li>

<li><p><strong>Item-based CF</strong></p>
<ul>
<li>é¡ä¼¼ã‚¢ã‚¤ãƒ†ãƒ ã‹ã‚‰æ¨è–¦</li>
<li>ã‚¢ã‚¤ãƒ†ãƒ ç‰¹æ€§ã¯å®‰å®šã—ã¦ã„ã‚‹ãŸã‚å®Ÿç”¨çš„</li>
<li>Amazonã€Netflixã§æ¡ç”¨</li>
</ul></li>

<li><p><strong>è¡Œåˆ—åˆ†è§£ï¼ˆSVDã€ALSï¼‰</strong></p>
<ul>
<li>æ½œåœ¨å› å­ãƒ¢ãƒ‡ãƒ«ã§é«˜ç²¾åº¦ãªäºˆæ¸¬</li>
<li>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œ</li>
<li>Explicitã«ã¯ SVDã€Implicitã«ã¯ ALS/BPR</li>
</ul></li>

<li><p><strong>é«˜åº¦ãªæ‰‹æ³•</strong></p>
<ul>
<li>SVD++: Implicit feedbackã‚‚æ´»ç”¨</li>
<li>NMF: éè² åˆ¶ç´„ã§è§£é‡ˆæ€§å‘ä¸Š</li>
<li>BPR: ãƒ©ãƒ³ã‚­ãƒ³ã‚°æœ€é©åŒ–ã§Implicit feedbackã«ç‰¹åŒ–</li>
</ul></li>
</ol>

<h3>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®èª²é¡Œ</h3>

<table>
<thead>
<tr>
<th>èª²é¡Œ</th>
<th>èª¬æ˜</th>
<th>å¯¾ç­–</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cold Startå•é¡Œ</strong></td>
<td>æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ã®æ¨è–¦å›°é›£</td>
<td>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰</td>
</tr>
<tr>
<td><strong>ã‚¹ãƒ‘ãƒ¼ã‚¹æ€§</strong></td>
<td>è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒç–ã§é¡ä¼¼åº¦è¨ˆç®—å›°é›£</td>
<td>æ¬¡å…ƒå‰Šæ¸›ã€è¡Œåˆ—åˆ†è§£</td>
</tr>
<tr>
<td><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong></td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ å¢—åŠ ã§è¨ˆç®—ã‚³ã‚¹ãƒˆå¢—</td>
<td>è¿‘ä¼¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€åˆ†æ•£å‡¦ç†</td>
</tr>
<tr>
<td><strong>Gray Sheepå•é¡Œ</strong></td>
<td>ç‹¬ç‰¹ãªå—œå¥½ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¨è–¦å›°é›£</td>
<td>ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã€å¤šæ§˜æ€§è€ƒæ…®</td>
</tr>
</tbody>
</table>

<h3>æ¬¡ã®ç« ã¸</h3>

<p>ç¬¬3ç« ã§ã¯ã€<strong>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</strong>ã‚’å­¦ã³ã¾ã™ï¼š</p>
<ul>
<li>ã‚¢ã‚¤ãƒ†ãƒ ç‰¹å¾´é‡ã®æŠ½å‡º</li>
<li>TF-IDFã¨ãƒ†ã‚­ã‚¹ãƒˆç‰¹å¾´é‡</li>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ§‹ç¯‰</li>
<li>é¡ä¼¼åº¦è¨ˆç®—ã¨æ¨è–¦</li>
<li>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã®æ¯”è¼ƒ</li>
</ul>

<hr>

<h2>æ¼”ç¿’å•é¡Œ</h2>

<h3>å•é¡Œ1ï¼ˆé›£æ˜“åº¦ï¼šeasyï¼‰</h3>
<p>User-based CFã¨Item-based CFã®é•ã„ã‚’ã€é¡ä¼¼åº¦è¨ˆç®—ã®å¯¾è±¡ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã€é©ç”¨å ´é¢ã®3ç‚¹ã‹ã‚‰èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<ol>
<li><p><strong>é¡ä¼¼åº¦è¨ˆç®—ã®å¯¾è±¡</strong></p>
<ul>
<li>User-based CF: ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®é¡ä¼¼åº¦ã‚’è¨ˆç®—</li>
<li>Item-based CF: ã‚¢ã‚¤ãƒ†ãƒ é–“ã®é¡ä¼¼åº¦ã‚’è¨ˆç®—</li>
</ul></li>

<li><p><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong></p>
<ul>
<li>User-based CF: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°$n$ã«å¯¾ã—ã¦O(nÂ²)ã®è¨ˆç®—é‡</li>
<li>Item-based CF: ã‚¢ã‚¤ãƒ†ãƒ æ•°$m$ã«å¯¾ã—ã¦O(mÂ²)ã®è¨ˆç®—é‡</li>
<li>ä¸€èˆ¬ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° >> ã‚¢ã‚¤ãƒ†ãƒ æ•°ãªã®ã§ã€Item-basedãŒã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«</li>
</ul></li>

<li><p><strong>é©ç”¨å ´é¢</strong></p>
<ul>
<li>User-based CF: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãŒå°‘ãªãã€å—œå¥½ãŒå¤šæ§˜ãªå ´é¢ï¼ˆãƒ‹ãƒƒãƒã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ï¼‰</li>
<li>Item-based CF: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãŒå¤šãã€ã‚¢ã‚¤ãƒ†ãƒ ç‰¹æ€§ãŒå®‰å®šã—ã¦ã„ã‚‹å ´é¢ï¼ˆEã‚³ãƒãƒ¼ã‚¹ã€Netflixï¼‰</li>
</ul></li>
</ol>

</details>

<h3>å•é¡Œ2ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>ä»¥ä¸‹ã®è©•ä¾¡è¡Œåˆ—ã«å¯¾ã—ã¦ã€Aliceã¨Bobã®ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã‚’æ‰‹è¨ˆç®—ã§æ±‚ã‚ã¦ãã ã•ã„ã€‚</p>

<pre><code>       Item1  Item2  Item3
Alice    5      3      1
Bob      4      2      2
</code></pre>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p>ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã®å¼ï¼š</p>

<p>$$
\text{sim}_{\text{cos}}(Alice, Bob) = \frac{\sum r_{Alice,i} \cdot r_{Bob,i}}{\sqrt{\sum r_{Alice,i}^2} \cdot \sqrt{\sum r_{Bob,i}^2}}
$$</p>

<p><strong>è¨ˆç®—</strong>ï¼š</p>

<ol>
<li><p>åˆ†å­ï¼ˆå†…ç©ï¼‰ï¼š</p>
<pre><code>5Ã—4 + 3Ã—2 + 1Ã—2 = 20 + 6 + 2 = 28
</code></pre></li>

<li><p>åˆ†æ¯ï¼ˆãƒãƒ«ãƒ ã®ç©ï¼‰ï¼š</p>
<pre><code>||Alice|| = âˆš(5Â² + 3Â² + 1Â²) = âˆš(25 + 9 + 1) = âˆš35 â‰ˆ 5.916
||Bob|| = âˆš(4Â² + 2Â² + 2Â²) = âˆš(16 + 4 + 4) = âˆš24 â‰ˆ 4.899
åˆ†æ¯ = 5.916 Ã— 4.899 â‰ˆ 28.98
</code></pre></li>

<li><p>ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ï¼š</p>
<pre><code>sim = 28 / 28.98 â‰ˆ 0.966
</code></pre></li>
</ol>

<p><strong>Pythonã§ã®æ¤œè¨¼</strong>ï¼š</p>
<pre><code class="language-python">import numpy as np
from scipy.spatial.distance import cosine

alice = np.array([5, 3, 1])
bob = np.array([4, 2, 2])

similarity = 1 - cosine(alice, bob)
print(f"ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦: {similarity:.4f}")  # 0.9661
</code></pre>

</details>

<h3>å•é¡Œ3ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>è¡Œåˆ—åˆ†è§£ï¼ˆMatrix Factorizationï¼‰ã«ãŠã„ã¦ã€æ½œåœ¨å› å­æ•°$k$ã‚’å¢—ã‚„ã™ã“ã¨ã®é•·æ‰€ã¨çŸ­æ‰€ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p><strong>é•·æ‰€</strong>ï¼š</p>
<ol>
<li><strong>è¡¨ç¾åŠ›ã®å‘ä¸Š</strong>: ã‚ˆã‚Šè¤‡é›‘ãªå—œå¥½ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ‰ãˆã‚‰ã‚Œã‚‹</li>
<li><strong>ç²¾åº¦å‘ä¸Š</strong>: è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã§ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ãŒå‘ä¸Š</li>
<li><strong>ç´°ã‹ã„é•ã„ã®è¡¨ç¾</strong>: å¾®å¦™ãªå—œå¥½ã®å·®ç•°ã‚’åŒºåˆ¥å¯èƒ½</li>
</ol>

<p><strong>çŸ­æ‰€</strong>ï¼š</p>
<ol>
<li><strong>éå­¦ç¿’ã®ãƒªã‚¹ã‚¯</strong>: è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã«éåº¦ã«é©åˆã—ã€æ±åŒ–æ€§èƒ½ä½ä¸‹</li>
<li><strong>è¨ˆç®—ã‚³ã‚¹ãƒˆã®å¢—åŠ </strong>: å­¦ç¿’æ™‚é–“ã¨æ¨è«–æ™‚é–“ãŒå¢—åŠ ï¼ˆO(k)ã«æ¯”ä¾‹ï¼‰</li>
<li><strong>ã‚¹ãƒ‘ãƒ¼ã‚¹æ€§å•é¡Œ</strong>: ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„å ´åˆã€å¤šãã®å› å­ã‚’æ¨å®šå›°é›£</li>
<li><strong>è§£é‡ˆæ€§ã®ä½ä¸‹</strong>: å› å­ãŒå¤šã„ã»ã©æ„å‘³ã®è§£é‡ˆãŒå›°é›£</li>
</ol>

<p><strong>é©åˆ‡ãªé¸æŠ</strong>ï¼š</p>
<ul>
<li>ãƒ‡ãƒ¼ã‚¿é‡ã€ã‚¹ãƒ‘ãƒ¼ã‚¹æ€§ã€è¨ˆç®—ãƒªã‚½ãƒ¼ã‚¹ã‚’è€ƒæ…®</li>
<li>ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§æœ€é©ãª$k$ã‚’é¸æŠ</li>
<li>ä¸€èˆ¬ã«$k = 10 \sim 100$ãŒå®Ÿç”¨çš„</li>
</ul>

</details>

<h3>å•é¡Œ4ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>ä»¥ä¸‹ã®MovieLensã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ã€SVDãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ã—ã€RMSEã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</p>

<pre><code class="language-python">data = pd.DataFrame({
    'user_id': [1, 1, 1, 2, 2, 3, 3, 3, 4, 4],
    'item_id': ['A', 'B', 'C', 'A', 'C', 'B', 'C', 'D', 'A', 'D'],
    'rating': [5, 3, 4, 4, 5, 2, 3, 5, 3, 4]
})
</code></pre>

<details>
<summary>è§£ç­”ä¾‹</summary>

<pre><code class="language-python">import pandas as pd
from surprise import SVD, Dataset, Reader
from surprise.model_selection import cross_validate, train_test_split
from surprise import accuracy

# ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
data_df = pd.DataFrame({
    'user_id': [1, 1, 1, 2, 2, 3, 3, 3, 4, 4],
    'item_id': ['A', 'B', 'C', 'A', 'C', 'B', 'C', 'D', 'A', 'D'],
    'rating': [5, 3, 4, 4, 5, 2, 3, 5, 3, 4]
})

print("=== ãƒ‡ãƒ¼ã‚¿ ===")
print(data_df)

# Surpriseãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ä½œæˆ
reader = Reader(rating_scale=(1, 5))
data = Dataset.load_from_df(data_df[['user_id', 'item_id', 'rating']], reader)

# è¨“ç·´ãƒ»ãƒ†ã‚¹ãƒˆåˆ†å‰²
trainset, testset = train_test_split(data, test_size=0.3, random_state=42)

# SVDãƒ¢ãƒ‡ãƒ«
svd = SVD(n_factors=2, n_epochs=30, lr_all=0.005, reg_all=0.02, random_state=42)
svd.fit(trainset)

# äºˆæ¸¬ã¨RMSEè¨ˆç®—
predictions = svd.test(testset)
rmse = accuracy.rmse(predictions)

print(f"\n=== ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ ===")
print(f"RMSE: {rmse:.4f}")

# ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
cv_results = cross_validate(svd, data, measures=['RMSE', 'MAE'], cv=3, verbose=False)

print(f"\n=== 3-Fold ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ===")
print(f"å¹³å‡RMSE: {cv_results['test_rmse'].mean():.4f} (+/- {cv_results['test_rmse'].std():.4f})")
print(f"å¹³å‡MAE: {cv_results['test_mae'].mean():.4f} (+/- {cv_results['test_mae'].std():.4f})")

# æ–°è¦äºˆæ¸¬
trainset_full = data.build_full_trainset()
svd.fit(trainset_full)

print(f"\n=== æ–°è¦äºˆæ¸¬ ===")
test_cases = [(1, 'D'), (2, 'B'), (4, 'C')]
for user, item in test_cases:
    pred = svd.predict(user, item)
    print(f"User {user} â†’ Item {item}: {pred.est:.2f}")
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹</strong>ï¼š</p>
<pre><code>=== ãƒ‡ãƒ¼ã‚¿ ===
   user_id item_id  rating
0        1       A       5
1        1       B       3
2        1       C       4
...

=== ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ ===
RMSE: 0.7823

=== 3-Fold ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ===
å¹³å‡RMSE: 0.8234 (+/- 0.1245)
å¹³å‡MAE: 0.6543 (+/- 0.0987)

=== æ–°è¦äºˆæ¸¬ ===
User 1 â†’ Item D: 4.12
User 2 â†’ Item B: 3.45
User 4 â†’ Item C: 3.78
</code></pre>

</details>

<h3>å•é¡Œ5ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ãŠã‘ã‚‹ã€ŒCold Startå•é¡Œã€ã¨ã¯ä½•ã‹èª¬æ˜ã—ã€3ã¤ã®å¯¾ç­–æ‰‹æ³•ã‚’å…·ä½“ä¾‹ã¨ã¨ã‚‚ã«è¿°ã¹ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p><strong>Cold Startå•é¡Œã¨ã¯</strong>ï¼š</p>
<p>æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ã«å¯¾ã—ã¦ã€éå»ã®è¡Œå‹•ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§æ¨è–¦ã‚’è¡Œã†ã“ã¨ãŒå›°é›£ãªå•é¡Œã€‚</p>

<p><strong>3ã¤ã®å¯¾ç­–æ‰‹æ³•</strong>ï¼š</p>

<ol>
<li><p><strong>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ä½µç”¨</strong></p>
<ul>
<li>å…·ä½“ä¾‹: æ–°è¦æ˜ ç”»ã®å ´åˆã€ã‚¸ãƒ£ãƒ³ãƒ«ã€ç›£ç£ã€ä¿³å„ªãªã©ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦é¡ä¼¼æ˜ ç”»ã‚’æ¨è–¦</li>
<li>åˆ©ç‚¹: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•ãƒ‡ãƒ¼ã‚¿ãªã—ã§ã‚‚æ¨è–¦å¯èƒ½</li>
<li>å®Ÿè£…: TF-IDFã‚„Word2Vecã§ç‰¹å¾´é‡ã‚’ä½œæˆã—ã€ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã§æ¨è–¦</li>
</ul></li>

<li><p><strong>ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ‰‹æ³•</strong></p>
<ul>
<li>å…·ä½“ä¾‹: Netflixã§ã¯ã€å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°+ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹+äººæ°—åº¦ã‚’çµ„ã¿åˆã‚ã›</li>
<li>åˆ©ç‚¹: å„æ‰‹æ³•ã®å¼±ç‚¹ã‚’è£œå®Œ</li>
<li>å®Ÿè£…: é‡ã¿ä»˜ãç·šå½¢çµåˆã‚„ã‚¹ã‚¿ãƒƒã‚­ãƒ³ã‚°</li>
</ul></li>

<li><p><strong>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆåˆæœŸè©•ä¾¡ã®åé›†ï¼‰</strong></p>
<ul>
<li>å…·ä½“ä¾‹: Spotifyã®åˆå›ç™»éŒ²æ™‚ã«å¥½ããªã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚’é¸æŠã•ã›ã‚‹</li>
<li>åˆ©ç‚¹: å°‘æ•°ã®è©•ä¾¡ã‹ã‚‰å—œå¥½ã‚’æŠŠæ¡</li>
<li>å®Ÿè£…: äººæ°—ã‚¢ã‚¤ãƒ†ãƒ ã‚„å¤šæ§˜ãªã‚¸ãƒ£ãƒ³ãƒ«ã‹ã‚‰åˆæœŸè©•ä¾¡ã‚’åé›†</li>
</ul></li>
</ol>

<p><strong>è¿½åŠ æ‰‹æ³•</strong>ï¼š</p>
<ul>
<li><strong>äººæ°—åº¦ãƒ™ãƒ¼ã‚¹æ¨è–¦</strong>: è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã€å…¨ä½“çš„ã«äººæ°—ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¨è–¦</li>
<li><strong>ãƒ‡ãƒ¢ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯æƒ…å ±</strong>: å¹´é½¢ã€æ€§åˆ¥ãªã©ã‹ã‚‰é¡ä¼¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ¨å®š</li>
<li><strong>è»¢ç§»å­¦ç¿’</strong>: ä»–ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã®å—œå¥½ãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨</li>
</ul>

</details>

<hr>

<h2>å‚è€ƒæ–‡çŒ®</h2>

<ol>
<li>Ricci, F., Rokach, L., & Shapira, B. (2015). <em>Recommender Systems Handbook</em> (2nd ed.). Springer.</li>
<li>Koren, Y., Bell, R., & Volinsky, C. (2009). Matrix Factorization Techniques for Recommender Systems. <em>Computer</em>, 42(8), 30-37.</li>
<li>Aggarwal, C. C. (2016). <em>Recommender Systems: The Textbook</em>. Springer.</li>
<li>Rendle, S., Freudenthaler, C., Gantner, Z., & Schmidt-Thieme, L. (2009). BPR: Bayesian Personalized Ranking from Implicit Feedback. <em>UAI 2009</em>.</li>
<li>Hu, Y., Koren, Y., & Volinsky, C. (2008). Collaborative Filtering for Implicit Feedback Datasets. <em>ICDM 2008</em>.</li>
</ol>

<div class="navigation">
    <a href="chapter1-introduction.html" class="nav-button">â† å‰ã®ç« : æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ å…¥é–€</a>
    <a href="chapter3-content-based.html" class="nav-button">æ¬¡ã®ç« : ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° â†’</a>
</div>

    </main>

    
    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

<footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-21</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
