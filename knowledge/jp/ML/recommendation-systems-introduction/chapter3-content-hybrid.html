<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬3ç« ï¼šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ»ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦ - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }
        .disclaimer {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            border-radius: 4px;
        }

        .disclaimer h3 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .disclaimer ul {
            list-style: none;
            padding-left: 0;
        }

        .disclaimer li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.6;
        }

        .disclaimer li::before {
            content: "âš ï¸";
            position: absolute;
            left: 0;
        }


        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
            <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/ML/recommendation-systems-introduction/chapter3-content-hybrid.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="../../ML/index.html">æ©Ÿæ¢°å­¦ç¿’</a><span class="breadcrumb-separator">â€º</span><a href="../../ML/recommendation-systems-introduction/index.html">Recommendation Systems</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 3</span>
        </div>
    </nav>

        <header>
        <div class="header-content">
            <h1>ç¬¬3ç« ï¼šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ»ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦</h1>
            <p class="subtitle">ç‰¹å¾´é‡ãƒ™ãƒ¼ã‚¹æ¨è–¦ã¨ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ‰‹æ³•ã®å®Ÿè£…</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 70-80åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 9å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 5å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®åŸç†ã¨å®Ÿè£…æ–¹æ³•ã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… TF-IDFã‚’ç”¨ã„ãŸãƒ†ã‚­ã‚¹ãƒˆç‰¹å¾´é‡æŠ½å‡ºã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹ç¯‰ã¨æ¨è–¦ç”ŸæˆãŒã§ãã‚‹</li>
<li>âœ… ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦æ‰‹æ³•ã‚’è¨­è¨ˆãƒ»å®Ÿè£…ã§ãã‚‹</li>
<li>âœ… Knowledge-basedæ¨è–¦ã®ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ã—ãŸæ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹</li>
</ul>

<hr>

<h2>3.1 ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹æ¨è–¦ã®åŸç†</h2>

<h3>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã¯</h3>

<p><strong>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆContent-Based Filteringï¼‰</strong>ã¯ã€ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´é‡ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å—œå¥½ã‚’ç…§åˆã—ã¦æ¨è–¦ã‚’è¡Œã†æ‰‹æ³•ã§ã™ã€‚</p>

<blockquote>
<p>ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéå»ã«å¥½ã‚“ã ã‚¢ã‚¤ãƒ†ãƒ ã¨é¡ä¼¼ã—ãŸç‰¹å¾´ã‚’æŒã¤ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¨è–¦ã™ã‚‹ã€</p>
</blockquote>

<h3>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã®æ¯”è¼ƒ</h3>

<table>
<thead>
<tr>
<th>é …ç›®</th>
<th>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</th>
<th>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ¨è–¦ã®æ ¹æ‹ </strong></td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ãƒ»ã‚¢ã‚¤ãƒ†ãƒ é–“ã®é¡ä¼¼æ€§</td>
<td>ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´é‡ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å—œå¥½</td>
</tr>
<tr>
<td><strong>å¿…è¦ãƒ‡ãƒ¼ã‚¿</strong></td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼-ã‚¢ã‚¤ãƒ†ãƒ è©•ä¾¡è¡Œåˆ—</td>
<td>ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´é‡</td>
</tr>
<tr>
<td><strong>ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ</strong></td>
<td>æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ã§å›°é›£</td>
<td>æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ã§ã‚‚å¯èƒ½</td>
</tr>
<tr>
<td><strong>å¤šæ§˜æ€§</strong></td>
<td>æ„å¤–æ€§ã®ã‚ã‚‹æ¨è–¦ãŒå¯èƒ½</td>
<td>æ—¢çŸ¥ã®å—œå¥½ã«åã‚Šã‚„ã™ã„</td>
</tr>
<tr>
<td><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong></td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ä¾å­˜</td>
<td>ã‚¢ã‚¤ãƒ†ãƒ ç‰¹å¾´é‡ä¾å­˜</td>
</tr>
</tbody>
</table>

<h3>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹æ¨è–¦ã®ãƒ•ãƒ­ãƒ¼</h3>

<div class="mermaid">
graph TD
    A[ã‚¢ã‚¤ãƒ†ãƒ ç‰¹å¾´é‡æŠ½å‡º] --> B[ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ§‹ç¯‰]
    B --> C[ã‚¢ã‚¤ãƒ†ãƒ ã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®é¡ä¼¼åº¦è¨ˆç®—]
    C --> D[é¡ä¼¼åº¦ã«åŸºã¥ãæ¨è–¦]

    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style D fill:#e8f5e9
</div>

<h3>ä¸»è¦ãªç‰¹å¾´é‡ã®ç¨®é¡</h3>

<table>
<thead>
<tr>
<th>ç‰¹å¾´é‡ã‚¿ã‚¤ãƒ—</th>
<th>ä¾‹</th>
<th>æŠ½å‡ºæ‰‹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ãƒ†ã‚­ã‚¹ãƒˆ</strong></td>
<td>èª¬æ˜æ–‡ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ã‚¿ã‚°</td>
<td>TF-IDFã€Word2Vecã€BERT</td>
</tr>
<tr>
<td><strong>ã‚«ãƒ†ã‚´ãƒª</strong></td>
<td>ã‚¸ãƒ£ãƒ³ãƒ«ã€ã‚«ãƒ†ã‚´ãƒª</td>
<td>One-Hotã€Target Encoding</td>
</tr>
<tr>
<td><strong>æ•°å€¤</strong></td>
<td>ä¾¡æ ¼ã€è©•ä¾¡ã€äººæ°—åº¦</td>
<td>æ¨™æº–åŒ–ã€ãƒ“ãƒ‹ãƒ³ã‚°</td>
</tr>
<tr>
<td><strong>ç”»åƒ</strong></td>
<td>å•†å“ç”»åƒã€ã‚µãƒ ãƒã‚¤ãƒ«</td>
<td>CNNã€ResNetã€CLIP</td>
</tr>
<tr>
<td><strong>éŸ³å£°</strong></td>
<td>éŸ³æ¥½ã€ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ</td>
<td>MFCCã€ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ </td>
</tr>
</tbody>
</table>

<hr>

<h2>3.2 TF-IDFã«ã‚ˆã‚‹ãƒ†ã‚­ã‚¹ãƒˆç‰¹å¾´é‡æŠ½å‡º</h2>

<h3>TF-IDFï¼ˆTerm Frequency-Inverse Document Frequencyï¼‰</h3>

<p><strong>TF-IDF</strong>ã¯ã€æ–‡æ›¸å†…ã®å˜èªã®é‡è¦åº¦ã‚’è©•ä¾¡ã™ã‚‹æŒ‡æ¨™ã§ã™ã€‚</p>

<p>$$
\text{TF-IDF}(t, d) = \text{TF}(t, d) \times \text{IDF}(t)
$$</p>

<ul>
<li><strong>TF (Term Frequency)</strong>: æ–‡æ›¸$d$å†…ã®å˜èª$t$ã®å‡ºç¾é »åº¦</li>
<li><strong>IDF (Inverse Document Frequency)</strong>: å˜èª$t$ã®å¸Œå°‘æ€§</li>
</ul>

<p>$$
\text{IDF}(t) = \log \frac{N}{\text{df}(t)}
$$</p>

<ul>
<li>$N$: æ–‡æ›¸ç·æ•°</li>
<li>$\text{df}(t)$: å˜èª$t$ã‚’å«ã‚€æ–‡æ›¸æ•°</li>
</ul>

<h3>å®Ÿè£…ï¼šæ˜ ç”»ã®èª¬æ˜æ–‡ã«åŸºã¥ãæ¨è–¦</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity

# ã‚µãƒ³ãƒ—ãƒ«æ˜ ç”»ãƒ‡ãƒ¼ã‚¿
movies = pd.DataFrame({
    'title': [
        'The Matrix',
        'Inception',
        'The Dark Knight',
        'Interstellar',
        'The Avengers',
        'Iron Man',
        'Titanic',
        'The Notebook'
    ],
    'description': [
        'A computer hacker learns about the true nature of reality and his role in the war against its controllers',
        'A thief who steals corporate secrets through dream-sharing technology',
        'Batman fights crime and chaos in Gotham City with the Joker',
        'A team of explorers travel through a wormhole in space in an attempt to ensure humanity survival',
        'Earth mightiest heroes must come together to stop an alien invasion',
        'A billionaire industrialist builds an armored suit to fight evil',
        'A romance develops aboard a ship during its ill-fated maiden voyage',
        'A poor yet passionate young man falls in love with a rich young woman'
    ],
    'genre': ['Sci-Fi', 'Sci-Fi', 'Action', 'Sci-Fi', 'Action', 'Action', 'Romance', 'Romance']
})

print("=== æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ ===")
print(movies[['title', 'genre']])

# TF-IDFç‰¹å¾´é‡æŠ½å‡º
tfidf = TfidfVectorizer(stop_words='english', max_features=50)
tfidf_matrix = tfidf.fit_transform(movies['description'])

print(f"\n=== TF-IDFè¡Œåˆ— ===")
print(f"å½¢çŠ¶: {tfidf_matrix.shape}")
print(f"ç‰¹å¾´èªæ•°: {len(tfidf.get_feature_names_out())}")
print(f"ä¸»è¦ãªå˜èª: {tfidf.get_feature_names_out()[:15]}")

# ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã®è¨ˆç®—
cosine_sim = cosine_similarity(tfidf_matrix, tfidf_matrix)

print(f"\n=== ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦è¡Œåˆ— ===")
print(f"å½¢çŠ¶: {cosine_sim.shape}")
print("\nThe Matrix ã¨ä»–ã®æ˜ ç”»ã®é¡ä¼¼åº¦:")
for i, title in enumerate(movies['title']):
    print(f"  {title}: {cosine_sim[0, i]:.3f}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ ===
            title   genre
0      The Matrix  Sci-Fi
1       Inception  Sci-Fi
2  The Dark Knight  Action
3    Interstellar  Sci-Fi
4    The Avengers  Action
5        Iron Man  Action
6         Titanic Romance
7    The Notebook Romance

=== TF-IDFè¡Œåˆ— ===
å½¢çŠ¶: (8, 50)
ç‰¹å¾´èªæ•°: 50
ä¸»è¦ãªå˜èª: ['aboard' 'against' 'alien' 'armored' 'attempt' 'batman' 'billionaire'
 'builds' 'chaos' 'city' 'come' 'computer' 'controllers' 'corporate'
 'crime']

=== ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦è¡Œåˆ— ===
å½¢çŠ¶: (8, 8)

The Matrix ã¨ä»–ã®æ˜ ç”»ã®é¡ä¼¼åº¦:
  The Matrix: 1.000
  Inception: 0.000
  The Dark Knight: 0.000
  Interstellar: 0.000
  The Avengers: 0.000
  Iron Man: 0.000
  Titanic: 0.000
  The Notebook: 0.087
</code></pre>

<h3>æ¨è–¦é–¢æ•°ã®å®Ÿè£…</h3>

<pre><code class="language-python">def get_content_based_recommendations(movie_title, movies_df, cosine_sim_matrix, top_n=5):
    """
    ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹æ¨è–¦ã‚’ç”Ÿæˆ

    Args:
        movie_title: åŸºæº–ã¨ãªã‚‹æ˜ ç”»ã‚¿ã‚¤ãƒˆãƒ«
        movies_df: æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ 
        cosine_sim_matrix: ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦è¡Œåˆ—
        top_n: æ¨è–¦ã™ã‚‹æ˜ ç”»æ•°

    Returns:
        æ¨è–¦æ˜ ç”»ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ 
    """
    # æ˜ ç”»ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
    idx = movies_df[movies_df['title'] == movie_title].index[0]

    # é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢ã‚’å–å¾—
    sim_scores = list(enumerate(cosine_sim_matrix[idx]))

    # é¡ä¼¼åº¦ã§ã‚½ãƒ¼ãƒˆï¼ˆè‡ªåˆ†è‡ªèº«ã‚’é™¤ãï¼‰
    sim_scores = sorted(sim_scores, key=lambda x: x[1], reverse=True)[1:top_n+1]

    # æ˜ ç”»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
    movie_indices = [i[0] for i in sim_scores]
    similarity_scores = [i[1] for i in sim_scores]

    # æ¨è–¦çµæœã‚’è¿”ã™
    recommendations = movies_df.iloc[movie_indices].copy()
    recommendations['similarity_score'] = similarity_scores

    return recommendations[['title', 'genre', 'similarity_score']]

# æ¨è–¦ã®ç”Ÿæˆ
print("\n=== 'The Matrix' ã«é¡ä¼¼ã—ãŸæ˜ ç”» ===")
recommendations = get_content_based_recommendations('The Matrix', movies, cosine_sim, top_n=3)
print(recommendations)

print("\n=== 'Titanic' ã«é¡ä¼¼ã—ãŸæ˜ ç”» ===")
recommendations = get_content_based_recommendations('Titanic', movies, cosine_sim, top_n=3)
print(recommendations)
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== 'The Matrix' ã«é¡ä¼¼ã—ãŸæ˜ ç”» ===
           title   genre  similarity_score
1      Inception  Sci-Fi             0.186
3   Interstellar  Sci-Fi             0.159
2 The Dark Knight Action             0.124

=== 'Titanic' ã«é¡ä¼¼ã—ãŸæ˜ ç”» ===
           title    genre  similarity_score
7   The Notebook Romance             0.573
4   The Avengers   Action             0.097
5       Iron Man   Action             0.000
</code></pre>

<hr>

<h2>3.3 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹ç¯‰</h2>

<h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯</h3>

<p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</strong>ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéå»ã«è©•ä¾¡ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´é‡ã‚’é›†ç´„ã—ãŸãƒ™ã‚¯ãƒˆãƒ«ã§ã™ã€‚</p>

<p>$$
\text{UserProfile}_u = \frac{1}{|I_u|} \sum_{i \in I_u} r_{ui} \cdot \text{ItemFeatures}_i
$$</p>

<ul>
<li>$I_u$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ãŒè©•ä¾¡ã—ãŸã‚¢ã‚¤ãƒ†ãƒ é›†åˆ</li>
<li>$r_{ui}$: ãƒ¦ãƒ¼ã‚¶ãƒ¼$u$ã®ã‚¢ã‚¤ãƒ†ãƒ $i$ã¸ã®è©•ä¾¡ï¼ˆé‡ã¿ï¼‰</li>
</ul>

<h3>å®Ÿè£…ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹æ¨è–¦</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity

# ãƒ¦ãƒ¼ã‚¶ãƒ¼è©•ä¾¡ãƒ‡ãƒ¼ã‚¿
user_ratings = pd.DataFrame({
    'user_id': [1, 1, 1, 2, 2, 2, 3, 3],
    'title': ['The Matrix', 'Inception', 'Interstellar',
              'The Avengers', 'Iron Man', 'The Dark Knight',
              'Titanic', 'The Notebook'],
    'rating': [5, 4, 5, 5, 4, 4, 5, 5]
})

print("=== ãƒ¦ãƒ¼ã‚¶ãƒ¼è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ ===")
print(user_ratings)

# TF-IDFè¡Œåˆ—ã®å†å–å¾—
tfidf_matrix = tfidf.transform(movies['description'])

def build_user_profile(user_id, ratings_df, movies_df, tfidf_matrix):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ§‹ç¯‰"""
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©•ä¾¡ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—
    user_data = ratings_df[ratings_df['user_id'] == user_id]

    # æ˜ ç”»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨è©•ä¾¡ã‚’å–å¾—
    movie_indices = []
    ratings = []
    for _, row in user_data.iterrows():
        idx = movies_df[movies_df['title'] == row['title']].index[0]
        movie_indices.append(idx)
        ratings.append(row['rating'])

    # åŠ é‡å¹³å‡ã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
    ratings = np.array(ratings)
    user_profile = np.zeros(tfidf_matrix.shape[1])

    for idx, rating in zip(movie_indices, ratings):
        user_profile += rating * tfidf_matrix[idx].toarray().flatten()

    user_profile /= np.sum(ratings)

    return user_profile.reshape(1, -1)

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹ç¯‰
user1_profile = build_user_profile(1, user_ratings, movies, tfidf_matrix)
user2_profile = build_user_profile(2, user_ratings, movies, tfidf_matrix)
user3_profile = build_user_profile(3, user_ratings, movies, tfidf_matrix)

print("\n=== ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« ===")
print(f"User 1 profile shape: {user1_profile.shape}")
print(f"User 2 profile shape: {user2_profile.shape}")
print(f"User 3 profile shape: {user3_profile.shape}")

def recommend_for_user(user_profile, movies_df, tfidf_matrix, watched_movies, top_n=3):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«åŸºã¥ãæ¨è–¦"""
    # å…¨æ˜ ç”»ã¨ã®é¡ä¼¼åº¦è¨ˆç®—
    similarities = cosine_similarity(user_profile, tfidf_matrix).flatten()

    # æ—¢è¦–è´æ˜ ç”»ã‚’é™¤å¤–
    watched_indices = [movies_df[movies_df['title'] == title].index[0]
                       for title in watched_movies]
    similarities[watched_indices] = -1

    # Top-Næ¨è–¦
    top_indices = similarities.argsort()[::-1][:top_n]

    recommendations = movies_df.iloc[top_indices].copy()
    recommendations['score'] = similarities[top_indices]

    return recommendations[['title', 'genre', 'score']]

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®æ¨è–¦
print("\n=== User 1 ã¸ã®æ¨è–¦ï¼ˆSci-Fiå¥½ãï¼‰===")
watched_1 = user_ratings[user_ratings['user_id'] == 1]['title'].tolist()
recs_1 = recommend_for_user(user1_profile, movies, tfidf_matrix, watched_1, top_n=3)
print(recs_1)

print("\n=== User 2 ã¸ã®æ¨è–¦ï¼ˆActionå¥½ãï¼‰===")
watched_2 = user_ratings[user_ratings['user_id'] == 2]['title'].tolist()
recs_2 = recommend_for_user(user2_profile, movies, tfidf_matrix, watched_2, top_n=3)
print(recs_2)

print("\n=== User 3 ã¸ã®æ¨è–¦ï¼ˆRomanceå¥½ãï¼‰===")
watched_3 = user_ratings[user_ratings['user_id'] == 3]['title'].tolist()
recs_3 = recommend_for_user(user3_profile, movies, tfidf_matrix, watched_3, top_n=3)
print(recs_3)
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== ãƒ¦ãƒ¼ã‚¶ãƒ¼è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ ===
   user_id            title  rating
0        1       The Matrix       5
1        1        Inception       4
2        1     Interstellar       5
3        2     The Avengers       5
4        2         Iron Man       4
5        2  The Dark Knight       4
6        3          Titanic       5
7        3     The Notebook       5

=== ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« ===
User 1 profile shape: (1, 50)
User 2 profile shape: (1, 50)
User 3 profile shape: (1, 50)

=== User 1 ã¸ã®æ¨è–¦ï¼ˆSci-Fiå¥½ãï¼‰===
              title   genre     score
2  The Dark Knight  Action  0.091847
5         Iron Man  Action  0.062134
4     The Avengers  Action  0.054621

=== User 2 ã¸ã®æ¨è–¦ï¼ˆActionå¥½ãï¼‰===
        title   genre     score
0  The Matrix  Sci-Fi  0.103256
1   Inception  Sci-Fi  0.082471
3 Interstellar  Sci-Fi  0.071829

=== User 3 ã¸ã®æ¨è–¦ï¼ˆRomanceå¥½ãï¼‰===
        title   genre     score
0  The Matrix  Sci-Fi  0.028645
1   Inception  Sci-Fi  0.027183
4 The Avengers  Action  0.026451
</code></pre>

<hr>

<h2>3.4 ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ </h2>

<h3>ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦ã®ç¨®é¡</h3>

<table>
<thead>
<tr>
<th>æ‰‹æ³•</th>
<th>èª¬æ˜</th>
<th>å®Ÿè£…é›£æ˜“åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Weighted</strong></td>
<td>è¤‡æ•°æ‰‹æ³•ã®ã‚¹ã‚³ã‚¢ã‚’é‡ã¿ä»˜ã‘ç·šå½¢çµåˆ</td>
<td>ä½</td>
</tr>
<tr>
<td><strong>Switching</strong></td>
<td>çŠ¶æ³ã«å¿œã˜ã¦æ‰‹æ³•ã‚’åˆ‡ã‚Šæ›¿ãˆ</td>
<td>ä¸­</td>
</tr>
<tr>
<td><strong>Mixed</strong></td>
<td>è¤‡æ•°æ‰‹æ³•ã®æ¨è–¦ã‚’æ··åˆã—ã¦æç¤º</td>
<td>ä½</td>
</tr>
<tr>
<td><strong>Feature Combination</strong></td>
<td>å”èª¿ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç‰¹å¾´é‡ã‚’çµ±åˆ</td>
<td>é«˜</td>
</tr>
<tr>
<td><strong>Cascade</strong></td>
<td>æ®µéšçš„ã«æ‰‹æ³•ã‚’é©ç”¨</td>
<td>ä¸­</td>
</tr>
<tr>
<td><strong>Meta-level</strong></td>
<td>ä¸€ã¤ã®æ‰‹æ³•ã®å‡ºåŠ›ã‚’åˆ¥ã®æ‰‹æ³•ã®å…¥åŠ›ã«</td>
<td>é«˜</td>
</tr>
</tbody>
</table>

<h3>å®Ÿè£…ï¼šWeighted Hybrid</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.metrics.pairwise import cosine_similarity
from scipy.sparse import csr_matrix

# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µ
np.random.seed(42)
n_users = 50
n_movies = len(movies)

# ãƒ¦ãƒ¼ã‚¶ãƒ¼-æ˜ ç”»è©•ä¾¡è¡Œåˆ—ï¼ˆå”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç”¨ï¼‰
ratings_data = []
for user_id in range(n_users):
    n_ratings = np.random.randint(2, 6)
    movie_indices = np.random.choice(n_movies, n_ratings, replace=False)
    for movie_idx in movie_indices:
        rating = np.random.randint(1, 6)
        ratings_data.append({
            'user_id': user_id,
            'movie_id': movie_idx,
            'rating': rating
        })

ratings_df = pd.DataFrame(ratings_data)

# ãƒ¦ãƒ¼ã‚¶ãƒ¼-æ˜ ç”»è¡Œåˆ—ã®æ§‹ç¯‰
user_movie_matrix = csr_matrix(
    (ratings_df['rating'], (ratings_df['user_id'], ratings_df['movie_id'])),
    shape=(n_users, n_movies)
).toarray()

print("=== ãƒ¦ãƒ¼ã‚¶ãƒ¼-æ˜ ç”»è©•ä¾¡è¡Œåˆ— ===")
print(f"å½¢çŠ¶: {user_movie_matrix.shape}")
print(f"è©•ä¾¡æ•°: {len(ratings_df)}")
print(f"ã‚¹ãƒ‘ãƒ¼ã‚¹ç‡: {(1 - len(ratings_df) / (n_users * n_movies)) * 100:.1f}%")

# å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆItem-based CFï¼‰
def collaborative_filtering_score(user_id, movie_id, user_movie_matrix):
    """Item-based CF ã‚¹ã‚³ã‚¢"""
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè©•ä¾¡ã—ãŸæ˜ ç”»
    user_ratings = user_movie_matrix[user_id]

    # æ˜ ç”»é–“ã®é¡ä¼¼åº¦ï¼ˆè©•ä¾¡ãƒ™ã‚¯ãƒˆãƒ«ã®ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ï¼‰
    movie_sim = cosine_similarity(user_movie_matrix.T)

    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè©•ä¾¡ã—ãŸæ˜ ç”»ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ˜ ç”»ã®é¡ä¼¼åº¦
    rated_movies = np.where(user_ratings > 0)[0]

    if len(rated_movies) == 0:
        return 0.0

    # åŠ é‡å¹³å‡ã‚¹ã‚³ã‚¢
    weighted_sum = 0
    similarity_sum = 0

    for rated_movie in rated_movies:
        if rated_movie != movie_id:
            sim = movie_sim[movie_id, rated_movie]
            weighted_sum += sim * user_ratings[rated_movie]
            similarity_sum += abs(sim)

    if similarity_sum == 0:
        return 0.0

    return weighted_sum / similarity_sum

# ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢è¨ˆç®—
def content_based_score(user_id, movie_id, user_movie_matrix, tfidf_matrix):
    """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢"""
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ§‹ç¯‰
    user_ratings = user_movie_matrix[user_id]
    rated_movies = np.where(user_ratings > 0)[0]

    if len(rated_movies) == 0:
        return 0.0

    # åŠ é‡å¹³å‡ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
    user_profile = np.zeros(tfidf_matrix.shape[1])
    for movie_idx in rated_movies:
        user_profile += user_ratings[movie_idx] * tfidf_matrix[movie_idx].toarray().flatten()

    user_profile /= np.sum(user_ratings[rated_movies])

    # ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ˜ ç”»ã¨ã®é¡ä¼¼åº¦
    movie_features = tfidf_matrix[movie_id].toarray().flatten()
    score = cosine_similarity(user_profile.reshape(1, -1),
                             movie_features.reshape(1, -1))[0, 0]

    return score

# ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¹ã‚³ã‚¢è¨ˆç®—
def hybrid_score(user_id, movie_id, user_movie_matrix, tfidf_matrix,
                alpha=0.5):
    """
    Weighted Hybrid ã‚¹ã‚³ã‚¢

    Args:
        alpha: å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®é‡ã¿ (0-1)
               1-alpha ãŒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ã®é‡ã¿
    """
    cf_score = collaborative_filtering_score(user_id, movie_id, user_movie_matrix)
    cb_score = content_based_score(user_id, movie_id, user_movie_matrix, tfidf_matrix)

    # æ­£è¦åŒ–ï¼ˆã‚¹ã‚³ã‚¢ã‚’0-5ã®ç¯„å›²ã«ï¼‰
    cf_score_norm = cf_score / 5.0 if cf_score > 0 else 0
    cb_score_norm = cb_score

    hybrid = alpha * cf_score_norm + (1 - alpha) * cb_score_norm

    return hybrid, cf_score_norm, cb_score_norm

# ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦ã®ç”Ÿæˆ
def get_hybrid_recommendations(user_id, user_movie_matrix, tfidf_matrix,
                               movies_df, alpha=0.5, top_n=5):
    """ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦"""
    # æœªè©•ä¾¡æ˜ ç”»ã‚’å–å¾—
    user_ratings = user_movie_matrix[user_id]
    unrated_movies = np.where(user_ratings == 0)[0]

    # ã‚¹ã‚³ã‚¢è¨ˆç®—
    scores = []
    for movie_id in unrated_movies:
        hybrid, cf, cb = hybrid_score(user_id, movie_id, user_movie_matrix,
                                      tfidf_matrix, alpha)
        scores.append({
            'movie_id': movie_id,
            'hybrid_score': hybrid,
            'cf_score': cf,
            'cb_score': cb
        })

    # ã‚¹ã‚³ã‚¢ã§ã‚½ãƒ¼ãƒˆ
    scores_df = pd.DataFrame(scores).sort_values('hybrid_score', ascending=False)
    top_scores = scores_df.head(top_n)

    # æ˜ ç”»æƒ…å ±ã‚’çµåˆ
    recommendations = movies_df.iloc[top_scores['movie_id']].copy()
    recommendations['hybrid_score'] = top_scores['hybrid_score'].values
    recommendations['cf_score'] = top_scores['cf_score'].values
    recommendations['cb_score'] = top_scores['cb_score'].values

    return recommendations[['title', 'genre', 'hybrid_score', 'cf_score', 'cb_score']]

# æ¨è–¦ç”Ÿæˆï¼ˆç•°ãªã‚‹Î±å€¤ã§æ¯”è¼ƒï¼‰
print("\n=== User 0 ã¸ã®æ¨è–¦ ===")
print("\n[Î±=0.3: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹é‡è¦–]")
recs_cb_heavy = get_hybrid_recommendations(0, user_movie_matrix, tfidf_matrix,
                                          movies, alpha=0.3, top_n=5)
print(recs_cb_heavy)

print("\n[Î±=0.5: ãƒãƒ©ãƒ³ã‚¹å‹]")
recs_balanced = get_hybrid_recommendations(0, user_movie_matrix, tfidf_matrix,
                                          movies, alpha=0.5, top_n=5)
print(recs_balanced)

print("\n[Î±=0.7: å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é‡è¦–]")
recs_cf_heavy = get_hybrid_recommendations(0, user_movie_matrix, tfidf_matrix,
                                          movies, alpha=0.7, top_n=5)
print(recs_cf_heavy)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹</strong>ï¼š</p>
<pre><code>=== ãƒ¦ãƒ¼ã‚¶ãƒ¼-æ˜ ç”»è©•ä¾¡è¡Œåˆ— ===
å½¢çŠ¶: (50, 8)
è©•ä¾¡æ•°: 174
ã‚¹ãƒ‘ãƒ¼ã‚¹ç‡: 56.5%

=== User 0 ã¸ã®æ¨è–¦ ===

[Î±=0.3: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹é‡è¦–]
           title   genre  hybrid_score  cf_score  cb_score
1      Inception  Sci-Fi      0.142635  0.183421  0.124738
0     The Matrix  Sci-Fi      0.138274  0.167283  0.125196
3   Interstellar  Sci-Fi      0.129847  0.154923  0.119324
5       Iron Man  Action      0.098234  0.112453  0.092847
4   The Avengers  Action      0.094512  0.108734  0.089273

[Î±=0.5: ãƒãƒ©ãƒ³ã‚¹å‹]
           title   genre  hybrid_score  cf_score  cb_score
1      Inception  Sci-Fi      0.154080  0.183421  0.124738
0     The Matrix  Sci-Fi      0.146240  0.167283  0.125196
3   Interstellar  Sci-Fi      0.137124  0.154923  0.119324
5       Iron Man  Action      0.102650  0.112453  0.092847
4   The Avengers  Action      0.099004  0.108734  0.089273

[Î±=0.7: å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é‡è¦–]
           title   genre  hybrid_score  cf_score  cb_score
1      Inception  Sci-Fi      0.165525  0.183421  0.124738
0     The Matrix  Sci-Fi      0.154205  0.167283  0.125196
3   Interstellar  Sci-Fi      0.144400  0.154923  0.119324
5       Iron Man  Action      0.107066  0.112453  0.092847
4   The Avengers  Action      0.103495  0.108734  0.089273
</code></pre>

<h3>Switching Hybrid: çŠ¶æ³é©å¿œå‹</h3>

<pre><code class="language-python">def switching_hybrid_recommendation(user_id, user_movie_matrix, tfidf_matrix,
                                   movies_df, top_n=5):
    """
    Switching Hybrid: çŠ¶æ³ã«å¿œã˜ã¦æ‰‹æ³•ã‚’åˆ‡ã‚Šæ›¿ãˆ

    ãƒ«ãƒ¼ãƒ«:
    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©•ä¾¡æ•°ãŒå°‘ãªã„ï¼ˆ< 3ï¼‰â†’ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹
    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©•ä¾¡æ•°ãŒååˆ† â†’ å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    """
    user_ratings = user_movie_matrix[user_id]
    n_ratings = np.sum(user_ratings > 0)

    print(f"\nUser {user_id}: è©•ä¾¡æ•° = {n_ratings}")

    if n_ratings < 3:
        print("â†’ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹æ¨è–¦ã‚’ä½¿ç”¨ï¼ˆè©•ä¾¡æ•°ä¸è¶³ï¼‰")
        method = 'content_based'
        alpha = 0.0  # 100% ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹
    else:
        print("â†’ å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’ä½¿ç”¨ï¼ˆååˆ†ãªè©•ä¾¡æ•°ï¼‰")
        method = 'collaborative'
        alpha = 1.0  # 100% å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

    recommendations = get_hybrid_recommendations(
        user_id, user_movie_matrix, tfidf_matrix, movies_df,
        alpha=alpha, top_n=top_n
    )

    return recommendations, method

# è©•ä¾¡æ•°ãŒå°‘ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨å¤šã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§æ¯”è¼ƒ
user_sparse = 0  # è©•ä¾¡æ•°ãŒå°‘ãªã„
user_dense = np.argmax(np.sum(user_movie_matrix > 0, axis=1))  # è©•ä¾¡æ•°ãŒå¤šã„

print("=== Switching Hybrid æ¨è–¦ ===")
recs_sparse, method_sparse = switching_hybrid_recommendation(
    user_sparse, user_movie_matrix, tfidf_matrix, movies, top_n=3
)
print(recs_sparse)

recs_dense, method_dense = switching_hybrid_recommendation(
    user_dense, user_movie_matrix, tfidf_matrix, movies, top_n=3
)
print(recs_dense)
</code></pre>

<hr>

<h2>3.5 Knowledge-based æ¨è–¦</h2>

<h3>Knowledge-based æ¨è–¦ã¨ã¯</h3>

<p><strong>Knowledge-basedæ¨è–¦</strong>ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã¨åˆ¶ç´„æ¡ä»¶ã‚’ç”¨ã„ã¦æ¨è–¦ã‚’è¡Œã†æ‰‹æ³•ã§ã™ã€‚</p>

<table>
<thead>
<tr>
<th>ã‚¿ã‚¤ãƒ—</th>
<th>èª¬æ˜</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Constraint-based</strong></td>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ¶ç´„æ¡ä»¶ã‚’æº€ãŸã™ã‚¢ã‚¤ãƒ†ãƒ </td>
<td>ä¸å‹•ç”£ã€æ—…è¡Œã€æ±‚äºº</td>
</tr>
<tr>
<td><strong>Case-based</strong></td>
<td>éå»ã®é¡ä¼¼ã‚±ãƒ¼ã‚¹ã‹ã‚‰æ¨è–¦</td>
<td>åŒ»ç™‚è¨ºæ–­ã€ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆ</td>
</tr>
<tr>
<td><strong>Conversational</strong></td>
<td>å¯¾è©±ã‚’é€šã˜ã¦ãƒ‹ãƒ¼ã‚ºã‚’ç‰¹å®š</td>
<td>ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã€ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</td>
</tr>
</tbody>
</table>

<h3>å®Ÿè£…ï¼šåˆ¶ç´„ãƒ™ãƒ¼ã‚¹æ¨è–¦</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd

# æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ï¼ˆè©³ç´°æƒ…å ±ä»˜ãï¼‰
movies_detailed = pd.DataFrame({
    'title': ['The Matrix', 'Inception', 'The Dark Knight', 'Interstellar',
              'The Avengers', 'Iron Man', 'Titanic', 'The Notebook'],
    'genre': ['Sci-Fi', 'Sci-Fi', 'Action', 'Sci-Fi', 'Action', 'Action', 'Romance', 'Romance'],
    'year': [1999, 2010, 2008, 2014, 2012, 2008, 1997, 2004],
    'duration_min': [136, 148, 152, 169, 143, 126, 195, 123],
    'rating': [8.7, 8.8, 9.0, 8.6, 8.0, 7.9, 7.9, 7.8],
    'language': ['English', 'English', 'English', 'English',
                 'English', 'English', 'English', 'English']
})

print("=== æ˜ ç”»è©³ç´°ãƒ‡ãƒ¼ã‚¿ ===")
print(movies_detailed)

def constraint_based_recommendation(constraints, movies_df):
    """
    åˆ¶ç´„ãƒ™ãƒ¼ã‚¹æ¨è–¦

    Args:
        constraints: åˆ¶ç´„æ¡ä»¶ã®è¾æ›¸
            ä¾‹: {'genre': 'Sci-Fi', 'min_rating': 8.5, 'max_duration': 150}
    """
    filtered = movies_df.copy()

    # å„åˆ¶ç´„ã‚’é©ç”¨
    for key, value in constraints.items():
        if key == 'genre':
            filtered = filtered[filtered['genre'] == value]
        elif key == 'min_rating':
            filtered = filtered[filtered['rating'] >= value]
        elif key == 'max_rating':
            filtered = filtered[filtered['rating'] <= value]
        elif key == 'min_year':
            filtered = filtered[filtered['year'] >= value]
        elif key == 'max_year':
            filtered = filtered[filtered['year'] <= value]
        elif key == 'max_duration':
            filtered = filtered[filtered['duration_min'] <= value]
        elif key == 'min_duration':
            filtered = filtered[filtered['duration_min'] >= value]

    return filtered

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹1: çŸ­æ™‚é–“ã®SFæ˜ ç”»
print("\n=== ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹1: çŸ­æ™‚é–“ã®é«˜è©•ä¾¡SFæ˜ ç”» ===")
constraints_1 = {
    'genre': 'Sci-Fi',
    'min_rating': 8.5,
    'max_duration': 150
}
print(f"åˆ¶ç´„æ¡ä»¶: {constraints_1}")
recommendations_1 = constraint_based_recommendation(constraints_1, movies_detailed)
print(recommendations_1[['title', 'genre', 'rating', 'duration_min']])

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹2: 2010å¹´ä»¥é™ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ˜ ç”»
print("\n=== ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹2: 2010å¹´ä»¥é™ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ˜ ç”» ===")
constraints_2 = {
    'genre': 'Action',
    'min_year': 2010
}
print(f"åˆ¶ç´„æ¡ä»¶: {constraints_2}")
recommendations_2 = constraint_based_recommendation(constraints_2, movies_detailed)
print(recommendations_2[['title', 'genre', 'year', 'rating']])

# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹3: é«˜è©•ä¾¡ã®é•·ç·¨æ˜ ç”»
print("\n=== ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹3: é«˜è©•ä¾¡ã®é•·ç·¨æ˜ ç”» ===")
constraints_3 = {
    'min_rating': 8.5,
    'min_duration': 150
}
print(f"åˆ¶ç´„æ¡ä»¶: {constraints_3}")
recommendations_3 = constraint_based_recommendation(constraints_3, movies_detailed)
print(recommendations_3[['title', 'rating', 'duration_min']])
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== æ˜ ç”»è©³ç´°ãƒ‡ãƒ¼ã‚¿ ===
             title   genre  year  duration_min  rating language
0       The Matrix  Sci-Fi  1999           136     8.7  English
1        Inception  Sci-Fi  2010           148     8.8  English
2  The Dark Knight  Action  2008           152     9.0  English
3     Interstellar  Sci-Fi  2014           169     8.6  English
4     The Avengers  Action  2012           143     8.0  English
5         Iron Man  Action  2008           126     7.9  English
6          Titanic Romance  1997           195     7.9  English
7     The Notebook Romance  2004           123     7.8  English

=== ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹1: çŸ­æ™‚é–“ã®é«˜è©•ä¾¡SFæ˜ ç”» ===
åˆ¶ç´„æ¡ä»¶: {'genre': 'Sci-Fi', 'min_rating': 8.5, 'max_duration': 150}
        title   genre  rating  duration_min
0  The Matrix  Sci-Fi     8.7           136
1   Inception  Sci-Fi     8.8           148

=== ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹2: 2010å¹´ä»¥é™ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ˜ ç”» ===
åˆ¶ç´„æ¡ä»¶: {'genre': 'Action', 'min_year': 2010}
          title   genre  year  rating
4  The Avengers  Action  2012     8.0

=== ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹3: é«˜è©•ä¾¡ã®é•·ç·¨æ˜ ç”» ===
åˆ¶ç´„æ¡ä»¶: {'min_rating': 8.5, 'min_duration': 150}
             title  rating  duration_min
2  The Dark Knight     9.0           152
3     Interstellar     8.6           169
</code></pre>

<hr>

<h2>3.6 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè€ƒæ…®æ¨è–¦</h2>

<h3>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã®ç¨®é¡</h3>

<table>
<thead>
<tr>
<th>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ</th>
<th>ä¾‹</th>
<th>æ´»ç”¨æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ™‚é–“</strong></td>
<td>æ™‚åˆ»ã€æ›œæ—¥ã€å­£ç¯€</td>
<td>æ™‚é–“å¸¯åˆ¥ã®æ¨è–¦</td>
</tr>
<tr>
<td><strong>å ´æ‰€</strong></td>
<td>ä½ç½®æƒ…å ±ã€ãƒ‡ãƒã‚¤ã‚¹</td>
<td>ä½ç½®ãƒ™ãƒ¼ã‚¹æ¨è–¦</td>
</tr>
<tr>
<td><strong>ç¤¾ä¼šçš„</strong></td>
<td>åŒä¼´è€…ã€ã‚°ãƒ«ãƒ¼ãƒ—</td>
<td>ã‚°ãƒ«ãƒ¼ãƒ—æ¨è–¦</td>
</tr>
<tr>
<td><strong>æ´»å‹•</strong></td>
<td>ä½œæ¥­ä¸­ã€ä¼‘æ†©ä¸­</td>
<td>çŠ¶æ³é©å¿œå‹æ¨è–¦</td>
</tr>
<tr>
<td><strong>æ°—åˆ†</strong></td>
<td>æ„Ÿæƒ…çŠ¶æ…‹</td>
<td>æ„Ÿæƒ…è€ƒæ…®æ¨è–¦</td>
</tr>
</tbody>
</table>

<h3>å®Ÿè£…ï¼šæ™‚é–“è€ƒæ…®æ¨è–¦</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from datetime import datetime, timedelta

# æ™‚é–“å¸¯åˆ¥ã®è¦–è´å±¥æ­´ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
np.random.seed(42)
n_records = 200

# æ™‚é–“å¸¯ã‚’ç”Ÿæˆ
hours = np.random.randint(0, 24, n_records)
users = np.random.randint(0, 20, n_records)
movie_ids = np.random.randint(0, len(movies), n_records)

viewing_history = pd.DataFrame({
    'user_id': users,
    'movie_id': movie_ids,
    'hour': hours,
    'rating': np.random.randint(1, 6, n_records)
})

# æ˜ ç”»ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚¸ãƒ£ãƒ³ãƒ«ã‚’çµåˆ
viewing_history['title'] = viewing_history['movie_id'].apply(
    lambda x: movies.iloc[x]['title']
)
viewing_history['genre'] = viewing_history['movie_id'].apply(
    lambda x: movies.iloc[x]['genre']
)

# æ™‚é–“å¸¯ã®åˆ†é¡
def categorize_time(hour):
    if 6 <= hour < 12:
        return 'morning'
    elif 12 <= hour < 18:
        return 'afternoon'
    elif 18 <= hour < 22:
        return 'evening'
    else:
        return 'night'

viewing_history['time_of_day'] = viewing_history['hour'].apply(categorize_time)

print("=== æ™‚é–“å¸¯åˆ¥è¦–è´å±¥æ­´ ===")
print(viewing_history.head(10))

# æ™‚é–“å¸¯åˆ¥ã®ã‚¸ãƒ£ãƒ³ãƒ«å—œå¥½åˆ†æ
time_genre_prefs = viewing_history.groupby(['time_of_day', 'genre']).agg({
    'rating': ['mean', 'count']
}).reset_index()
time_genre_prefs.columns = ['time_of_day', 'genre', 'avg_rating', 'count']

print("\n=== æ™‚é–“å¸¯åˆ¥ã‚¸ãƒ£ãƒ³ãƒ«å—œå¥½ ===")
print(time_genre_prefs.sort_values(['time_of_day', 'avg_rating'], ascending=[True, False]))

def time_aware_recommendation(user_id, current_hour, viewing_history, movies_df, top_n=3):
    """æ™‚é–“è€ƒæ…®æ¨è–¦"""
    time_category = categorize_time(current_hour)

    # ãã®æ™‚é–“å¸¯ã§ã®ã‚¸ãƒ£ãƒ³ãƒ«å—œå¥½ã‚’å–å¾—
    time_prefs = viewing_history[viewing_history['time_of_day'] == time_category]
    genre_scores = time_prefs.groupby('genre')['rating'].mean().to_dict()

    # æœªè¦–è´æ˜ ç”»ã‚’å–å¾—
    watched_movies = viewing_history[viewing_history['user_id'] == user_id]['movie_id'].unique()
    unwatched = movies_df[~movies_df.index.isin(watched_movies)].copy()

    # ã‚¸ãƒ£ãƒ³ãƒ«ã‚¹ã‚³ã‚¢ã‚’ä»˜ä¸
    unwatched['time_score'] = unwatched['genre'].map(genre_scores).fillna(0)

    # Top-Næ¨è–¦
    recommendations = unwatched.nlargest(top_n, 'time_score')

    return recommendations[['title', 'genre', 'time_score']], time_category

# ç•°ãªã‚‹æ™‚é–“å¸¯ã§ã®æ¨è–¦
print("\n=== æ™‚é–“è€ƒæ…®æ¨è–¦ ===")

print("\n[æœ8æ™‚ã®æ¨è–¦]")
recs_morning, time_cat = time_aware_recommendation(0, 8, viewing_history, movies, top_n=3)
print(f"æ™‚é–“å¸¯: {time_cat}")
print(recs_morning)

print("\n[å¤œ20æ™‚ã®æ¨è–¦]")
recs_evening, time_cat = time_aware_recommendation(0, 20, viewing_history, movies, top_n=3)
print(f"æ™‚é–“å¸¯: {time_cat}")
print(recs_evening)

print("\n[æ·±å¤œ1æ™‚ã®æ¨è–¦]")
recs_night, time_cat = time_aware_recommendation(0, 1, viewing_history, movies, top_n=3)
print(f"æ™‚é–“å¸¯: {time_cat}")
print(recs_night)
</code></pre>

<p><strong>å‡ºåŠ›ä¾‹</strong>ï¼š</p>
<pre><code>=== æ™‚é–“å¸¯åˆ¥è¦–è´å±¥æ­´ ===
   user_id  movie_id  hour  rating         title   genre time_of_day
0       12         6    18       1       Titanic Romance     evening
1       11         7    19       1  The Notebook Romance     evening
2       18         2     9       5  The Dark Knight  Action     morning
3        8         6     3       5       Titanic Romance       night
4       10         2    14       2  The Dark Knight  Action   afternoon
...

=== æ™‚é–“å¸¯åˆ¥ã‚¸ãƒ£ãƒ³ãƒ«å—œå¥½ ===
   time_of_day    genre  avg_rating  count
0    afternoon   Action    3.181818     22
1    afternoon  Romance    2.866667     15
2    afternoon   Sci-Fi    2.952381     21
3      evening   Action    3.000000     19
4      evening  Romance    2.941176     17
5      evening   Sci-Fi    3.117647     17
6      morning   Action    3.263158     19
7      morning  Romance    3.250000     16
8      morning   Sci-Fi    3.105263     19
9        night   Action    3.055556     18
10       night  Romance    3.166667     18
11       night   Sci-Fi    2.857143     14

=== æ™‚é–“è€ƒæ…®æ¨è–¦ ===

[æœ8æ™‚ã®æ¨è–¦]
æ™‚é–“å¸¯: morning
          title   genre  time_score
2  The Dark Knight  Action    3.263158
0       The Matrix  Sci-Fi    3.105263
7     The Notebook Romance    3.250000

[å¤œ20æ™‚ã®æ¨è–¦]
æ™‚é–“å¸¯: evening
          title   genre  time_score
1        Inception  Sci-Fi    3.117647
2  The Dark Knight  Action    3.000000
7     The Notebook Romance    2.941176

[æ·±å¤œ1æ™‚ã®æ¨è–¦]
æ™‚é–“å¸¯: night
          title   genre  time_score
7     The Notebook Romance    3.166667
2  The Dark Knight  Action    3.055556
1        Inception  Sci-Fi    2.857143
</code></pre>

<hr>

<h2>3.7 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><p><strong>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</strong></p>
<ul>
<li>TF-IDFã«ã‚ˆã‚‹ãƒ†ã‚­ã‚¹ãƒˆç‰¹å¾´é‡æŠ½å‡º</li>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹ç¯‰</li>
<li>ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã«ã‚ˆã‚‹æ¨è–¦ç”Ÿæˆ</li>
<li>ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå•é¡Œã¸ã®å¯¾å¿œ</li>
</ul></li>

<li><p><strong>ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¨è–¦</strong></p>
<ul>
<li>Weighted: é‡ã¿ä»˜ã‘ç·šå½¢çµåˆ</li>
<li>Switching: çŠ¶æ³é©å¿œå‹åˆ‡ã‚Šæ›¿ãˆ</li>
<li>Mixed: è¤‡æ•°æ‰‹æ³•ã®æ··åˆ</li>
<li>å”èª¿ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç›¸è£œçš„æ´»ç”¨</li>
</ul></li>

<li><p><strong>Knowledge-basedæ¨è–¦</strong></p>
<ul>
<li>åˆ¶ç´„ãƒ™ãƒ¼ã‚¹æ¨è–¦ã®å®Ÿè£…</li>
<li>ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã®æ´»ç”¨</li>
<li>æ˜ç¤ºçš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚ã¸ã®å¯¾å¿œ</li>
</ul></li>

<li><p><strong>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè€ƒæ…®æ¨è–¦</strong></p>
<ul>
<li>æ™‚é–“ãƒ»å ´æ‰€ãƒ»æ´»å‹•ã®è€ƒæ…®</li>
<li>çŠ¶æ³é©å¿œå‹æ¨è–¦</li>
<li>å¤šåŸºæº–æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ </li>
</ul></li>
</ol>

<h3>æ‰‹æ³•ã®é¸æŠã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</h3>

<table>
<thead>
<tr>
<th>çŠ¶æ³</th>
<th>æ¨å¥¨æ‰‹æ³•</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ãŒå¤šã„</td>
<td>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹</td>
<td>ç‰¹å¾´é‡ãŒã‚ã‚Œã°å³åº§ã«æ¨è–¦å¯èƒ½</td>
</tr>
<tr>
<td>æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤šã„</td>
<td>Knowledge-based, ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰</td>
<td>è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ä¸è¦</td>
</tr>
<tr>
<td>è±Šå¯Œãªè©•ä¾¡ãƒ‡ãƒ¼ã‚¿</td>
<td>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰</td>
<td>é›†åˆçŸ¥ã‚’æ´»ç”¨</td>
</tr>
<tr>
<td>å¤šæ§˜æ€§ãŒé‡è¦</td>
<td>ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰</td>
<td>è¤‡æ•°æ‰‹æ³•ã§åã‚Šã‚’è»½æ¸›</td>
</tr>
<tr>
<td>æ˜ç¢ºãªåˆ¶ç´„æ¡ä»¶</td>
<td>Knowledge-based</td>
<td>æ¡ä»¶ã‚’ç¢ºå®Ÿã«æº€ãŸã™</td>
</tr>
<tr>
<td>çŠ¶æ³ä¾å­˜æ€§ãŒé«˜ã„</td>
<td>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè€ƒæ…®</td>
<td>æ™‚é–“ãƒ»å ´æ‰€ã‚’åæ˜ </td>
</tr>
</tbody>
</table>

<h3>æ¬¡ã®ç« ã¸</h3>

<p>ç¬¬4ç« ã§ã¯ã€<strong>æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹ã®æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ </strong>ã‚’å­¦ã³ã¾ã™ï¼š</p>
<ul>
<li>Neural Collaborative Filtering (NCF)</li>
<li>Embeddingå±¤ã®æ´»ç”¨</li>
<li>DeepFM: FactorizationMachines + DNN</li>
<li>Two-Tower Model</li>
<li>Transformerãƒ™ãƒ¼ã‚¹ã®æ¨è–¦</li>
</ul>

<hr>

<h2>æ¼”ç¿’å•é¡Œ</h2>

<h3>å•é¡Œ1ï¼ˆé›£æ˜“åº¦ï¼šeasyï¼‰</h3>
<p>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ä¸»ãªé•ã„ã‚’3ã¤æŒ™ã’ã€ãã‚Œãã‚Œã®é•·æ‰€ã¨çŸ­æ‰€ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>ä¸»ãªé•ã„</strong>ï¼š</p>

<ol>
<li><p><strong>æ¨è–¦ã®æ ¹æ‹ </strong></p>
<ul>
<li>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹: ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´é‡</li>
<li>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ é–“ã®è©•ä¾¡ãƒ‘ã‚¿ãƒ¼ãƒ³</li>
</ul></li>

<li><p><strong>å¿…è¦ãªãƒ‡ãƒ¼ã‚¿</strong></p>
<ul>
<li>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹: ã‚¢ã‚¤ãƒ†ãƒ ã®ç‰¹å¾´é‡ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰</li>
<li>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°: ãƒ¦ãƒ¼ã‚¶ãƒ¼-ã‚¢ã‚¤ãƒ†ãƒ è©•ä¾¡è¡Œåˆ—</li>
</ul></li>

<li><p><strong>ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå•é¡Œ</strong></p>
<ul>
<li>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹: æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ã§ã‚‚ç‰¹å¾´é‡ãŒã‚ã‚Œã°æ¨è–¦å¯èƒ½</li>
<li>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ã§å›°é›£</li>
</ul></li>
</ol>

<p><strong>é•·æ‰€ã¨çŸ­æ‰€</strong>ï¼š</p>

<table>
<thead>
<tr>
<th>æ‰‹æ³•</th>
<th>é•·æ‰€</th>
<th>çŸ­æ‰€</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹</strong></td>
<td>- æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ã«å¯¾å¿œ<br>- èª¬æ˜å¯èƒ½æ€§ãŒé«˜ã„<br>- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç‹¬ç«‹</td>
<td>- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ–ãƒ«<br>- ç‰¹å¾´é‡è¨­è¨ˆãŒå¿…è¦<br>- æ„å¤–æ€§ãŒä½ã„</td>
</tr>
<tr>
<td><strong>å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</strong></td>
<td>- æ„å¤–æ€§ã®ã‚ã‚‹æ¨è–¦<br>- ç‰¹å¾´é‡ä¸è¦<br>- é›†åˆçŸ¥ã®æ´»ç”¨</td>
<td>- ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ<br>- ã‚¹ãƒ‘ãƒ¼ã‚¹æ€§å•é¡Œ<br>- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</td>
</tr>
</tbody>
</table>

</details>

<h3>å•é¡Œ2ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>TF-IDFã®è¨ˆç®—å¼ã‚’èª¬æ˜ã—ã€ä»¥ä¸‹ã®3ã¤ã®æ–‡æ›¸ã«å¯¾ã—ã¦TF-IDFã‚’æ‰‹è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚</p>

<pre><code>æ–‡æ›¸1: "machine learning is great"
æ–‡æ›¸2: "deep learning is powerful"
æ–‡æ›¸3: "machine learning and deep learning"
</code></pre>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>TF-IDFè¨ˆç®—å¼</strong>ï¼š</p>

<p>$$
\text{TF-IDF}(t, d) = \text{TF}(t, d) \times \text{IDF}(t)
$$</p>

<p>$$
\text{TF}(t, d) = \frac{\text{term } t \text{ ã®æ–‡æ›¸ } d \text{ å†…ã®å‡ºç¾å›æ•°}}{\text{æ–‡æ›¸ } d \text{ ã®ç·å˜èªæ•°}}
$$</p>

<p>$$
\text{IDF}(t) = \log \frac{N}{\text{df}(t)}
$$</p>

<ul>
<li>$N$: ç·æ–‡æ›¸æ•° = 3</li>
<li>$\text{df}(t)$: å˜èª$t$ã‚’å«ã‚€æ–‡æ›¸æ•°</li>
</ul>

<p><strong>æ‰‹è¨ˆç®—ä¾‹ï¼ˆå˜èª "machine" ã®æ–‡æ›¸1ã§ã®TF-IDFï¼‰</strong>ï¼š</p>

<ol>
<li><p><strong>TFè¨ˆç®—</strong></p>
<ul>
<li>æ–‡æ›¸1: "machine learning is great" (4å˜èª)</li>
<li>"machine" ã®å‡ºç¾å›æ•°: 1</li>
<li>TF("machine", æ–‡æ›¸1) = 1 / 4 = 0.25</li>
</ul></li>

<li><p><strong>IDFè¨ˆç®—</strong></p>
<ul>
<li>ç·æ–‡æ›¸æ•° $N$ = 3</li>
<li>"machine" ã‚’å«ã‚€æ–‡æ›¸: æ–‡æ›¸1, æ–‡æ›¸3 â†’ df("machine") = 2</li>
<li>IDF("machine") = log(3 / 2) = log(1.5) â‰ˆ 0.176</li>
</ul></li>

<li><p><strong>TF-IDFè¨ˆç®—</strong></p>
<ul>
<li>TF-IDF("machine", æ–‡æ›¸1) = 0.25 Ã— 0.176 â‰ˆ 0.044</li>
</ul></li>
</ol>

<p><strong>Pythonã§ã®æ¤œè¨¼</strong>ï¼š</p>
<pre><code class="language-python">from sklearn.feature_extraction.text import TfidfVectorizer
import numpy as np

docs = [
    "machine learning is great",
    "deep learning is powerful",
    "machine learning and deep learning"
]

tfidf = TfidfVectorizer()
tfidf_matrix = tfidf.fit_transform(docs)

print("ç‰¹å¾´èª:", tfidf.get_feature_names_out())
print("\nTF-IDFè¡Œåˆ—:")
print(tfidf_matrix.toarray())
</code></pre>

</details>

<h3>å•é¡Œ3ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>Weighted Hybridæ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã„ã¦ã€å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®é‡ã¿ï¼ˆÎ±ï¼‰ã‚’ã©ã®ã‚ˆã†ã«èª¿æ•´ã™ã¹ãã‹ã€çŠ¶æ³ã«å¿œã˜ãŸæˆ¦ç•¥ã‚’3ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>Î±èª¿æ•´æˆ¦ç•¥</strong>ï¼š</p>

<ol>
<li><p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©•ä¾¡æ•°ã«åŸºã¥ãå‹•çš„èª¿æ•´</strong></p>
<pre><code class="language-python">def adaptive_alpha(user_id, user_movie_matrix, min_ratings=5):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©•ä¾¡æ•°ã«åŸºã¥ãÎ±èª¿æ•´"""
    n_ratings = np.sum(user_movie_matrix[user_id] > 0)

    if n_ratings < min_ratings:
        # è©•ä¾¡æ•°ãŒå°‘ãªã„ â†’ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹é‡è¦–
        alpha = 0.2
    elif n_ratings < 10:
        # ä¸­ç¨‹åº¦ â†’ ãƒãƒ©ãƒ³ã‚¹å‹
        alpha = 0.5
    else:
        # è©•ä¾¡æ•°ãŒå¤šã„ â†’ å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é‡è¦–
        alpha = 0.8

    return alpha
</code></pre>
<p>ç†ç”±: è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹ã€ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’é‡è¦–</p></li>

<li><p><strong>ã‚¢ã‚¤ãƒ†ãƒ ã®äººæ°—åº¦ã«åŸºã¥ãèª¿æ•´</strong></p>
<pre><code class="language-python">def popularity_based_alpha(item_id, user_movie_matrix):
    """ã‚¢ã‚¤ãƒ†ãƒ ã®è©•ä¾¡æ•°ã«åŸºã¥ãÎ±èª¿æ•´"""
    item_ratings = user_movie_matrix[:, item_id]
    n_ratings = np.sum(item_ratings > 0)

    if n_ratings < 5:
        # ãƒ‹ãƒƒãƒãªã‚¢ã‚¤ãƒ†ãƒ  â†’ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹
        alpha = 0.3
    else:
        # äººæ°—ã‚¢ã‚¤ãƒ†ãƒ  â†’ å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        alpha = 0.7

    return alpha
</code></pre>
<p>ç†ç”±: è©•ä¾¡æ•°ã®å°‘ãªã„ãƒ‹ãƒƒãƒãªã‚¢ã‚¤ãƒ†ãƒ ã¯å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒæ©Ÿèƒ½ã—ã«ãã„</p></li>

<li><p><strong>A/Bãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹æœ€é©åŒ–</strong></p>
<pre><code class="language-python">def ab_test_alpha_optimization(user_groups, alpha_values,
                               eval_metric='precision@k'):
    """A/Bãƒ†ã‚¹ãƒˆã§Î±ã‚’æœ€é©åŒ–"""
    results = {}

    for alpha in alpha_values:
        metrics = []
        for user in user_groups:
            recs = hybrid_recommend(user, alpha=alpha)
            metric = evaluate(recs, eval_metric)
            metrics.append(metric)

        results[alpha] = np.mean(metrics)

    optimal_alpha = max(results, key=results.get)
    return optimal_alpha
</code></pre>
<p>ç†ç”±: å®Ÿãƒ‡ãƒ¼ã‚¿ã§ã®æ€§èƒ½ã‚’æ¸¬å®šã—ã€æœ€é©ãªãƒãƒ©ãƒ³ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹</p></li>
</ol>

</details>

<h3>å•é¡Œ4ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>æ™‚é–“ã‚’è€ƒæ…®ã—ãŸæ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦–è´å±¥æ­´ã«æ™‚é–“æƒ…å ±ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€æ™‚é–“å¸¯ã«ã‚ˆã£ã¦ã‚¸ãƒ£ãƒ³ãƒ«å—œå¥½ãŒå¤‰åŒ–ã™ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<pre><code class="language-python">import numpy as np
import pandas as pd
from datetime import datetime, timedelta

class TimeAwareRecommender:
    """æ™‚é–“è€ƒæ…®æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, decay_factor=0.9):
        """
        Args:
            decay_factor: æ™‚é–“æ¸›è¡°ä¿‚æ•°ï¼ˆ0-1ï¼‰
        """
        self.decay_factor = decay_factor
        self.time_genre_prefs = None

    def fit(self, viewing_history):
        """æ™‚é–“å¸¯åˆ¥ã®å—œå¥½ã‚’å­¦ç¿’"""
        # æ™‚é–“å¸¯åˆ†é¡
        viewing_history['time_category'] = viewing_history['hour'].apply(
            self._categorize_time
        )

        # æ™‚é–“å¸¯Ã—ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ã®å¹³å‡è©•ä¾¡
        self.time_genre_prefs = viewing_history.groupby(
            ['time_category', 'genre']
        )['rating'].mean().to_dict()

        return self

    def _categorize_time(self, hour):
        """æ™‚é–“å¸¯ã®åˆ†é¡"""
        if 6 <= hour < 12:
            return 'morning'
        elif 12 <= hour < 18:
            return 'afternoon'
        elif 18 <= hour < 22:
            return 'evening'
        else:
            return 'night'

    def _time_decay(self, timestamp, current_time):
        """æ™‚é–“æ¸›è¡°é‡ã¿"""
        hours_diff = (current_time - timestamp).total_seconds() / 3600
        days_diff = hours_diff / 24
        return self.decay_factor ** days_diff

    def recommend(self, user_id, current_time, viewing_history,
                  movies_df, top_n=5):
        """æ™‚é–“è€ƒæ…®æ¨è–¦"""
        current_hour = current_time.hour
        time_category = self._categorize_time(current_hour)

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å±¥æ­´ã‚’å–å¾—
        user_history = viewing_history[
            viewing_history['user_id'] == user_id
        ].copy()

        # æ™‚é–“æ¸›è¡°é‡ã¿ã‚’è¨ˆç®—
        user_history['time_weight'] = user_history['timestamp'].apply(
            lambda t: self._time_decay(t, current_time)
        )

        # åŠ é‡å¹³å‡ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼å—œå¥½ã‚’è¨ˆç®—
        user_genre_prefs = user_history.groupby('genre').apply(
            lambda g: np.average(g['rating'], weights=g['time_weight'])
        ).to_dict()

        # æœªè¦–è´æ˜ ç”»ã‚’å–å¾—
        watched = user_history['movie_id'].unique()
        unwatched = movies_df[~movies_df.index.isin(watched)].copy()

        # ã‚¹ã‚³ã‚¢è¨ˆç®—
        def calculate_score(row):
            genre = row['genre']

            # ãƒ¦ãƒ¼ã‚¶ãƒ¼å—œå¥½ã‚¹ã‚³ã‚¢
            user_pref = user_genre_prefs.get(genre, 0)

            # æ™‚é–“å¸¯å—œå¥½ã‚¹ã‚³ã‚¢
            time_pref = self.time_genre_prefs.get(
                (time_category, genre), 0
            )

            # çµ±åˆã‚¹ã‚³ã‚¢
            return 0.6 * user_pref + 0.4 * time_pref

        unwatched['score'] = unwatched.apply(calculate_score, axis=1)

        # Top-Næ¨è–¦
        recommendations = unwatched.nlargest(top_n, 'score')

        return recommendations[['title', 'genre', 'score']]

# ä½¿ç”¨ä¾‹
np.random.seed(42)

# è¦–è´å±¥æ­´ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãï¼‰
base_time = datetime.now()
viewing_data = []

for i in range(100):
    timestamp = base_time - timedelta(days=np.random.randint(0, 30))
    viewing_data.append({
        'user_id': np.random.randint(0, 10),
        'movie_id': np.random.randint(0, 8),
        'rating': np.random.randint(1, 6),
        'hour': timestamp.hour,
        'timestamp': timestamp
    })

viewing_df = pd.DataFrame(viewing_data)
viewing_df['genre'] = viewing_df['movie_id'].apply(
    lambda x: movies.iloc[x]['genre']
)

# æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã®å­¦ç¿’ã¨æ¨è–¦
recommender = TimeAwareRecommender(decay_factor=0.95)
recommender.fit(viewing_df)

# ç•°ãªã‚‹æ™‚é–“å¸¯ã§ã®æ¨è–¦
morning_time = datetime.now().replace(hour=9)
evening_time = datetime.now().replace(hour=20)

print("=== æœ9æ™‚ã®æ¨è–¦ ===")
recs_morning = recommender.recommend(
    user_id=0,
    current_time=morning_time,
    viewing_history=viewing_df,
    movies_df=movies,
    top_n=3
)
print(recs_morning)

print("\n=== å¤œ8æ™‚ã®æ¨è–¦ ===")
recs_evening = recommender.recommend(
    user_id=0,
    current_time=evening_time,
    viewing_history=viewing_df,
    movies_df=movies,
    top_n=3
)
print(recs_evening)
</code></pre>

</details>

<h3>å•é¡Œ5ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ™ãƒ¼ã‚¹æ¨è–¦ã«ãŠã„ã¦ã€TF-IDFã®ä»£ã‚ã‚Šã«Word2Vecã‚„BERTã‚’ç”¨ã„ãŸåŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ã‚’ä½¿ç”¨ã™ã‚‹åˆ©ç‚¹ã¨å®Ÿè£…æ–¹æ³•ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>TF-IDF vs åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«</strong>ï¼š</p>

<table>
<thead>
<tr>
<th>é …ç›®</th>
<th>TF-IDF</th>
<th>Word2Vec/BERT</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è¡¨ç¾</strong></td>
<td>ã‚¹ãƒ‘ãƒ¼ã‚¹ãªBoW</td>
<td>å¯†ãªåˆ†æ•£è¡¨ç¾</td>
</tr>
<tr>
<td><strong>æ„å‘³ç†è§£</strong></td>
<td>å˜èªã®å‡ºç¾ã®ã¿</td>
<td>æ„å‘³çš„é¡ä¼¼æ€§ã‚’æ‰ãˆã‚‹</td>
</tr>
<tr>
<td><strong>æ¬¡å…ƒæ•°</strong></td>
<td>èªå½™ã‚µã‚¤ã‚ºï¼ˆé«˜æ¬¡å…ƒï¼‰</td>
<td>å›ºå®šï¼ˆä¾‹: 768æ¬¡å…ƒï¼‰</td>
</tr>
<tr>
<td><strong>é¡ç¾©èªå¯¾å¿œ</strong></td>
<td>å›°é›£</td>
<td>å¯èƒ½</td>
</tr>
<tr>
<td><strong>è¨ˆç®—ã‚³ã‚¹ãƒˆ</strong></td>
<td>ä½</td>
<td>é«˜ï¼ˆç‰¹ã«BERTï¼‰</td>
</tr>
</tbody>
</table>

<p><strong>Word2Vecå®Ÿè£…ä¾‹</strong>ï¼š</p>
<pre><code class="language-python">from gensim.models import Word2Vec
import numpy as np

# ãƒ†ã‚­ã‚¹ãƒˆã®å‰å‡¦ç†
texts = [doc.lower().split() for doc in movies['description']]

# Word2Vecãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’
w2v_model = Word2Vec(
    sentences=texts,
    vector_size=100,
    window=5,
    min_count=1,
    workers=4
)

def text_to_vector(text, model):
    """æ–‡ç« ã‚’Word2Vecãƒ™ã‚¯ãƒˆãƒ«ã«å¤‰æ›"""
    words = text.lower().split()
    word_vectors = [
        model.wv[word] for word in words
        if word in model.wv
    ]

    if len(word_vectors) == 0:
        return np.zeros(model.vector_size)

    # å¹³å‡ãƒ™ã‚¯ãƒˆãƒ«
    return np.mean(word_vectors, axis=0)

# æ˜ ç”»ã®åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«
movie_embeddings = np.array([
    text_to_vector(desc, w2v_model)
    for desc in movies['description']
])

# ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã§æ¨è–¦
from sklearn.metrics.pairwise import cosine_similarity
similarity_matrix = cosine_similarity(movie_embeddings)

print("Word2Vecãƒ™ãƒ¼ã‚¹é¡ä¼¼åº¦:")
for i, title in enumerate(movies['title']):
    print(f"{title} vs The Matrix: {similarity_matrix[0, i]:.3f}")
</code></pre>

<p><strong>BERTå®Ÿè£…ä¾‹</strong>ï¼š</p>
<pre><code class="language-python">from transformers import BertTokenizer, BertModel
import torch

# BERTãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰
tokenizer = BertTokenizer.from_pretrained('bert-base-uncased')
model = BertModel.from_pretrained('bert-base-uncased')

def get_bert_embedding(text):
    """BERTã§æ–‡ç« åŸ‹ã‚è¾¼ã¿ã‚’å–å¾—"""
    inputs = tokenizer(
        text,
        return_tensors='pt',
        padding=True,
        truncation=True,
        max_length=128
    )

    with torch.no_grad():
        outputs = model(**inputs)

    # [CLS]ãƒˆãƒ¼ã‚¯ãƒ³ã®åŸ‹ã‚è¾¼ã¿ã‚’ä½¿ç”¨
    embedding = outputs.last_hidden_state[:, 0, :].numpy()
    return embedding.flatten()

# BERTåŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«
bert_embeddings = np.array([
    get_bert_embedding(desc)
    for desc in movies['description']
])

# ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦
bert_similarity = cosine_similarity(bert_embeddings)

print("\nBERTãƒ™ãƒ¼ã‚¹é¡ä¼¼åº¦:")
for i, title in enumerate(movies['title']):
    print(f"{title} vs The Matrix: {bert_similarity[0, i]:.3f}")
</code></pre>

<p><strong>åˆ©ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>æ„å‘³çš„é¡ä¼¼æ€§</strong>: "car" ã¨ "automobile" ã‚’é¡ä¼¼ã¨ã—ã¦èªè­˜</li>
<li><strong>æ–‡è„ˆç†è§£</strong>: æ–‡ã®æ„å‘³ã‚’ã‚ˆã‚Šæ­£ç¢ºã«æ‰ãˆã‚‹</li>
<li><strong>å¤šç¾©èªå¯¾å¿œ</strong>: æ–‡è„ˆã«å¿œã˜ãŸå˜èªã®æ„å‘³ã‚’ç†è§£</li>
<li><strong>æ¬¡å…ƒå‰Šæ¸›</strong>: ä½æ¬¡å…ƒã®å¯†ãªãƒ™ã‚¯ãƒˆãƒ«è¡¨ç¾</li>
</ol>

</details>

<hr>

<h2>å‚è€ƒæ–‡çŒ®</h2>

<ol>
<li>Aggarwal, C. C. (2016). <em>Recommender Systems: The Textbook</em>. Springer.</li>
<li>Ricci, F., Rokach, L., & Shapira, B. (2015). <em>Recommender Systems Handbook</em> (2nd ed.). Springer.</li>
<li>Lops, P., de Gemmis, M., & Semeraro, G. (2011). Content-based Recommender Systems: State of the Art and Trends. In <em>Recommender Systems Handbook</em> (pp. 73-105). Springer.</li>
<li>Burke, R. (2002). Hybrid Recommender Systems: Survey and Experiments. <em>User Modeling and User-Adapted Interaction</em>, 12(4), 331-370.</li>
<li>Adomavicius, G., & Tuzhilin, A. (2011). Context-Aware Recommender Systems. In <em>Recommender Systems Handbook</em> (pp. 217-253). Springer.</li>
</ol>

<div class="navigation">
    <a href="chapter2-collaborative-filtering.html" class="nav-button">â† å‰ã®ç« : å”èª¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</a>
    <a href="chapter4-deep-learning-recommendation.html" class="nav-button">æ¬¡ã®ç« : æ·±å±¤å­¦ç¿’æ¨è–¦ â†’</a>
</div>

    </main>

    
    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

<footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-21</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
