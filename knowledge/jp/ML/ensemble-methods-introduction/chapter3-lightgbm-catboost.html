<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
<meta content="ç¬¬3ç« ï¼šLightGBMã¨CatBoost - AI Terakoya" name="description"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬3ç« ï¼šLightGBMã¨CatBoost - AI Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #7b2cbf;
            --color-accent-light: #9d4edd;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #3182ce;
            --color-link-hover: #2c5aa0;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid var(--color-border);
            padding: var(--spacing-sm);
            text-align: left;
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        blockquote {
            border-left: 4px solid var(--color-accent);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: var(--color-text-light);
            font-style: italic;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .mermaid {
            text-align: center;
            margin: var(--spacing-lg) 0;
            background-color: var(--color-bg-alt);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        details {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--color-primary);
            user-select: none;
            padding: var(--spacing-xs);
            margin: calc(-1 * var(--spacing-md));
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        summary:hover {
            background-color: rgba(123, 44, 191, 0.1);
        }

        details[open] summary {
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .nav-button {
            flex: 1;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        footer {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg) var(--spacing-md);
            background-color: var(--color-bg-alt);
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }
        .disclaimer {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            border-radius: 4px;
        }

        .disclaimer h3 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .disclaimer ul {
            list-style: none;
            padding-left: 0;
        }

        .disclaimer li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.6;
        }

        .disclaimer li::before {
            content: "âš ï¸";
            position: absolute;
            left: 0;
        }


        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }
    
        
    
        /* Breadcrumb styles */
        .breadcrumb {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .breadcrumb-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #a0aec0;
            margin: 0 0.25rem;
        }

        .breadcrumb-current {
            color: #4a5568;
            font-weight: 500;
        }
    </style>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>

    <!-- MathJax for LaTeX equation rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

    <style>
        /* Locale Switcher Styles */
        .locale-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .current-locale {
            font-weight: 600;
            color: #7b2cbf;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .locale-separator {
            color: #adb5bd;
            font-weight: 300;
        }

        .locale-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .locale-link:hover {
            background: rgba(240, 147, 251, 0.1);
            color: #d07be8;
            transform: translateY(-1px);
        }

        .locale-meta {
            color: #868e96;
            font-size: 0.85rem;
            font-style: italic;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .locale-switcher {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            .locale-meta {
                display: none;
            }
        }
    </style>
</head>
<body>
            <div class="locale-switcher">
<span class="current-locale">ğŸŒ JP</span>
<span class="locale-separator">|</span>
<a href="../../../en/ML/ensemble-methods-introduction/chapter3-lightgbm-catboost.html" class="locale-link">ğŸ‡¬ğŸ‡§ EN</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="../../index.html">AIå¯ºå­å±‹ãƒˆãƒƒãƒ—</a><span class="breadcrumb-separator">â€º</span><a href="../../ML/index.html">æ©Ÿæ¢°å­¦ç¿’</a><span class="breadcrumb-separator">â€º</span><a href="../../ML/ensemble-methods-introduction/index.html">Ensemble Methods</a><span class="breadcrumb-separator">â€º</span><span class="breadcrumb-current">Chapter 3</span>
        </div>
    </nav>

        <header>
        <div class="header-content">
            <h1>ç¬¬3ç« ï¼šLightGBMã¨CatBoost</h1>
            <p class="subtitle">æ¬¡ä¸–ä»£å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚° - é«˜é€ŸåŒ–ã¨ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°å‡¦ç†</p>
            <div class="meta">
                <span class="meta-item">ğŸ“– èª­äº†æ™‚é–“: 25-30åˆ†</span>
                <span class="meta-item">ğŸ“Š é›£æ˜“åº¦: ä¸­ç´š</span>
                <span class="meta-item">ğŸ’» ã‚³ãƒ¼ãƒ‰ä¾‹: 9å€‹</span>
                <span class="meta-item">ğŸ“ æ¼”ç¿’å•é¡Œ: 5å•</span>
            </div>
        </div>
    </header>

    <main class="container">

<h2>å­¦ç¿’ç›®æ¨™</h2>
<p>ã“ã®ç« ã‚’èª­ã‚€ã“ã¨ã§ã€ä»¥ä¸‹ã‚’ç¿’å¾—ã§ãã¾ã™ï¼š</p>
<ul>
<li>âœ… LightGBMã®é«˜é€ŸåŒ–æŠ€è¡“ï¼ˆGOSSã€EFBã€Histogram-basedï¼‰ã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… LightGBMã‚’å®Ÿè£…ã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒã§ãã‚‹</li>
<li>âœ… CatBoostã®Ordered Boostingã¨Categorical Featureså‡¦ç†ã‚’ç†è§£ã™ã‚‹</li>
<li>âœ… CatBoostã‚’å®Ÿè£…ã—ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥ã‚’é¸æŠã§ãã‚‹</li>
<li>âœ… XGBoostã€LightGBMã€CatBoostã®ç‰¹æ€§ã‚’æ¯”è¼ƒã—ã€ä½¿ã„åˆ†ã‘ã‚‰ã‚Œã‚‹</li>
</ul>

<hr>

<h2>3.1 LightGBM - é«˜é€ŸåŒ–ã®ä»•çµ„ã¿</h2>

<h3>LightGBMã¨ã¯</h3>
<p><strong>LightGBMï¼ˆLight Gradient Boosting Machineï¼‰</strong>ã¯ã€MicrosoftãŒé–‹ç™ºã—ãŸé«˜é€Ÿã§åŠ¹ç‡çš„ãªå‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚</p>

<blockquote>
<p>ã€ŒLightã€ã®åã®é€šã‚Šã€XGBoostã‚ˆã‚Šã‚‚è»½é‡ã§é«˜é€Ÿã€å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«é©ã—ã¦ã„ã¾ã™ã€‚</p>
</blockquote>

<h3>ä¸»è¦ãªæŠ€è¡“é©æ–°</h3>

<h4>1. Histogram-based Algorithmï¼ˆãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰</h4>

<p>é€£ç¶šå€¤ã‚’é›¢æ•£åŒ–ï¼ˆãƒ“ãƒ‹ãƒ³ã‚°ï¼‰ã™ã‚‹ã“ã¨ã§ã€è¨ˆç®—é‡ã‚’å¤§å¹…å‰Šæ¸›ã—ã¾ã™ã€‚</p>

<table>
<thead>
<tr>
<th>æ‰‹æ³•</th>
<th>è¨ˆç®—é‡</th>
<th>ãƒ¡ãƒ¢ãƒª</th>
<th>ç²¾åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Pre-sorted</strong>ï¼ˆXGBoostï¼‰</td>
<td>$O(n \log n)$</td>
<td>é«˜</td>
<td>é«˜</td>
</tr>
<tr>
<td><strong>Histogram-based</strong>ï¼ˆLightGBMï¼‰</td>
<td>$O(n \times k)$</td>
<td>ä½</td>
<td>ã»ã¼åŒç­‰</td>
</tr>
</tbody>
</table>

<p>$k$: ãƒ“ãƒ³æ•°ï¼ˆé€šå¸¸255ï¼‰ã€$n$: ãƒ‡ãƒ¼ã‚¿æ•°</p>

<div class="mermaid">
graph LR
    A[é€£ç¶šå€¤ãƒ‡ãƒ¼ã‚¿] --> B[ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ åŒ–]
    B --> C[255ãƒ“ãƒ³ã«é›¢æ•£åŒ–]
    C --> D[é«˜é€Ÿãªåˆ†å²æ¢ç´¢]

    style A fill:#ffebee
    style B fill:#e3f2fd
    style C fill:#f3e5f5
    style D fill:#c8e6c9
</div>

<h4>2. GOSSï¼ˆGradient-based One-Side Samplingï¼‰</h4>

<p><strong>GOSS</strong>ã¯ã€å‹¾é…ã®å¤§ãã„ãƒ‡ãƒ¼ã‚¿ã‚’é‡è¦–ã—ã€å°ã•ã„ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã§å­¦ç¿’ã‚’é«˜é€ŸåŒ–ã—ã¾ã™ã€‚</p>

<p>ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼š</p>
<ol>
<li>å‹¾é…ã®çµ¶å¯¾å€¤ã§ãƒ‡ãƒ¼ã‚¿ã‚’ã‚½ãƒ¼ãƒˆ</li>
<li>ä¸Šä½ $a\%$ ï¼ˆå¤§ãã„å‹¾é…ï¼‰ã‚’å…¨ã¦ä¿æŒ</li>
<li>æ®‹ã‚Š $(1-a)\%$ ã‹ã‚‰ $b\%$ ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</li>
<li>ã‚µãƒ³ãƒ—ãƒ«ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®é‡ã¿ã‚’ $(1-a)/b$ å€ã«èª¿æ•´</li>
</ol>

<h4>3. EFBï¼ˆExclusive Feature Bundlingï¼‰</h4>

<p><strong>EFB</strong>ã¯ã€äº’ã„ã«æ’ä»–çš„ãªç‰¹å¾´é‡ï¼ˆåŒæ™‚ã«éã‚¼ãƒ­ã«ãªã‚‰ãªã„ï¼‰ã‚’æŸã­ã¦æ¬¡å…ƒã‚’å‰Šæ¸›ã—ã¾ã™ã€‚</p>

<p>ä¾‹ï¼šOne-Hot Encoding ã•ã‚ŒãŸç‰¹å¾´é‡</p>
<pre><code>color_red:   [1, 0, 0, 1, 0]
color_blue:  [0, 1, 0, 0, 1]
color_green: [0, 0, 1, 0, 0]
â†’ 1ã¤ã®ç‰¹å¾´é‡ã«çµ±åˆå¯èƒ½
</code></pre>

<h3>Leaf-wise vs Level-wise æˆé•·æˆ¦ç•¥</h3>

<table>
<thead>
<tr>
<th>æˆ¦ç•¥</th>
<th>èª¬æ˜</th>
<th>ä½¿ç”¨</th>
<th>é•·æ‰€</th>
<th>çŸ­æ‰€</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Level-wise</strong></td>
<td>æ·±ã•å„ªå…ˆã§å…¨ãƒãƒ¼ãƒ‰ã‚’åˆ†å‰²</td>
<td>XGBoost</td>
<td>ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæœ¨</td>
<td>æƒ…å ±åˆ©å¾—ãŒä½ã„ãƒãƒ¼ãƒ‰ã‚‚åˆ†å‰²</td>
</tr>
<tr>
<td><strong>Leaf-wise</strong></td>
<td>æœ€å¤§æƒ…å ±åˆ©å¾—ã®ãƒªãƒ¼ãƒ•ã‚’åˆ†å‰²</td>
<td>LightGBM</td>
<td>åŠ¹ç‡çš„ã€é«˜ç²¾åº¦</td>
<td>éå­¦ç¿’ã—ã‚„ã™ã„</td>
</tr>
</tbody>
</table>

<div class="mermaid">
graph TD
    A[Level-wise: XGBoost] --> B1[ãƒ¬ãƒ™ãƒ«1: å…¨ã¦åˆ†å‰²]
    B1 --> C1[ãƒ¬ãƒ™ãƒ«2: å…¨ã¦åˆ†å‰²]

    D[Leaf-wise: LightGBM] --> E1[æœ€å¤§åˆ©å¾—ãƒãƒ¼ãƒ‰ã®ã¿åˆ†å‰²]
    E1 --> F1[æ¬¡ã®æœ€å¤§åˆ©å¾—ãƒãƒ¼ãƒ‰ã‚’åˆ†å‰²]

    style A fill:#e3f2fd
    style D fill:#f3e5f5
</div>

<hr>

<h2>3.2 LightGBMå®Ÿè£…</h2>

<h3>åŸºæœ¬çš„ãªä½¿ã„æ–¹</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.datasets import make_classification
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score, roc_auc_score
import lightgbm as lgb

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
X, y = make_classification(
    n_samples=10000,
    n_features=20,
    n_informative=15,
    n_redundant=5,
    random_state=42
)

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# LightGBMãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
model = lgb.LGBMClassifier(
    objective='binary',
    n_estimators=100,
    learning_rate=0.1,
    max_depth=7,
    num_leaves=31,
    random_state=42
)

# å­¦ç¿’
model.fit(X_train, y_train)

# äºˆæ¸¬
y_pred = model.predict(X_test)
y_proba = model.predict_proba(X_test)[:, 1]

# è©•ä¾¡
accuracy = accuracy_score(y_test, y_pred)
auc = roc_auc_score(y_test, y_proba)

print("=== LightGBM åŸºæœ¬å®Ÿè£… ===")
print(f"ç²¾åº¦: {accuracy:.4f}")
print(f"AUC: {auc:.4f}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== LightGBM åŸºæœ¬å®Ÿè£… ===
ç²¾åº¦: 0.9350
AUC: 0.9712
</code></pre>

<h3>é‡è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h3>

<table>
<thead>
<tr>
<th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th>
<th>èª¬æ˜</th>
<th>æ¨å¥¨å€¤</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>num_leaves</code></td>
<td>æœ¨ã®æœ€å¤§ãƒªãƒ¼ãƒ•æ•°</td>
<td>31-255ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 31ï¼‰</td>
</tr>
<tr>
<td><code>max_depth</code></td>
<td>æœ¨ã®æœ€å¤§æ·±ã•ï¼ˆéå­¦ç¿’åˆ¶å¾¡ï¼‰</td>
<td>3-10ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: -1=ç„¡åˆ¶é™ï¼‰</td>
</tr>
<tr>
<td><code>learning_rate</code></td>
<td>å­¦ç¿’ç‡</td>
<td>0.01-0.1</td>
</tr>
<tr>
<td><code>n_estimators</code></td>
<td>æœ¨ã®æœ¬æ•°</td>
<td>100-1000</td>
</tr>
<tr>
<td><code>min_child_samples</code></td>
<td>ãƒªãƒ¼ãƒ•ã®æœ€å°ã‚µãƒ³ãƒ—ãƒ«æ•°</td>
<td>20-100</td>
</tr>
<tr>
<td><code>subsample</code></td>
<td>ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ¯”ç‡</td>
<td>0.7-1.0</td>
</tr>
<tr>
<td><code>colsample_bytree</code></td>
<td>ç‰¹å¾´é‡ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ¯”ç‡</td>
<td>0.7-1.0</td>
</tr>
<tr>
<td><code>reg_alpha</code></td>
<td>L1æ­£å‰‡åŒ–</td>
<td>0-1</td>
</tr>
<tr>
<td><code>reg_lambda</code></td>
<td>L2æ­£å‰‡åŒ–</td>
<td>0-1</td>
</tr>
</tbody>
</table>

<h3>æ—©æœŸåœæ­¢ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</h3>

<pre><code class="language-python"># è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã‚’ã•ã‚‰ã«åˆ†å‰²
X_tr, X_val, y_tr, y_val = train_test_split(
    X_train, y_train, test_size=0.2, random_state=42
)

# æ—©æœŸåœæ­¢ä»˜ãã§å­¦ç¿’
model_early = lgb.LGBMClassifier(
    objective='binary',
    n_estimators=1000,
    learning_rate=0.05,
    max_depth=7,
    num_leaves=31,
    random_state=42
)

model_early.fit(
    X_tr, y_tr,
    eval_set=[(X_val, y_val)],
    eval_metric='auc',
    callbacks=[lgb.early_stopping(stopping_rounds=50, verbose=True)]
)

print(f"\n=== æ—©æœŸåœæ­¢ ===")
print(f"æœ€é©ãªã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°: {model_early.best_iteration_}")
print(f"ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³AUC: {model_early.best_score_['valid_0']['auc']:.4f}")

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§è©•ä¾¡
y_pred_early = model_early.predict(X_test)
accuracy_early = accuracy_score(y_test, y_pred_early)
print(f"ãƒ†ã‚¹ãƒˆç²¾åº¦: {accuracy_early:.4f}")
</code></pre>

<h3>ç‰¹å¾´é‡é‡è¦åº¦ã®å¯è¦–åŒ–</h3>

<pre><code class="language-python">import matplotlib.pyplot as plt

# ç‰¹å¾´é‡é‡è¦åº¦ã®å–å¾—
feature_importance = model.feature_importances_
feature_names = [f'feature_{i}' for i in range(X.shape[1])]

# DataFrameã«å¤‰æ›
importance_df = pd.DataFrame({
    'feature': feature_names,
    'importance': feature_importance
}).sort_values('importance', ascending=False)

print("\n=== ç‰¹å¾´é‡é‡è¦åº¦ Top 10 ===")
print(importance_df.head(10))

# å¯è¦–åŒ–
plt.figure(figsize=(10, 8))
lgb.plot_importance(model, max_num_features=15, importance_type='gain')
plt.title('LightGBM ç‰¹å¾´é‡é‡è¦åº¦ï¼ˆGainï¼‰', fontsize=14)
plt.tight_layout()
plt.show()
</code></pre>

<h3>GPU ã‚µãƒãƒ¼ãƒˆ</h3>

<pre><code class="language-python"># GPUä½¿ç”¨ï¼ˆCUDAç’°å¢ƒãŒå¿…è¦ï¼‰
model_gpu = lgb.LGBMClassifier(
    objective='binary',
    n_estimators=100,
    learning_rate=0.1,
    device='gpu',  # GPUä½¿ç”¨
    gpu_platform_id=0,
    gpu_device_id=0,
    random_state=42
)

# å­¦ç¿’ï¼ˆGPUã§é«˜é€ŸåŒ–ï¼‰
# model_gpu.fit(X_train, y_train)

print("\n=== GPU ã‚µãƒãƒ¼ãƒˆ ===")
print("LightGBMã¯GPUï¼ˆCUDAï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§10-30å€é«˜é€ŸåŒ–å¯èƒ½")
print("device='gpu' ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æœ‰åŠ¹åŒ–")
</code></pre>

<blockquote>
<p><strong>æ³¨æ„</strong>: GPUç‰ˆã‚’ä½¿ã†ã«ã¯ã€LightGBMã‚’GPUã‚µãƒãƒ¼ãƒˆä»˜ãã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
</blockquote>

<hr>

<h2>3.3 CatBoost - Ordered Boostingã¨ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°å‡¦ç†</h2>

<h3>CatBoostã¨ã¯</h3>
<p><strong>CatBoostï¼ˆCategorical Boostingï¼‰</strong>ã¯ã€YandexãŒé–‹ç™ºã—ãŸå‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã®è‡ªå‹•å‡¦ç†ãŒç‰¹å¾´ã§ã™ã€‚</p>

<h3>ä¸»è¦ãªæŠ€è¡“é©æ–°</h3>

<h4>1. Ordered Boosting</h4>

<p><strong>Ordered Boosting</strong>ã¯ã€äºˆæ¸¬ã‚·ãƒ•ãƒˆï¼ˆprediction shiftï¼‰ã‚’é˜²ããŸã‚ã®æ‰‹æ³•ã§ã™ã€‚</p>

<p><strong>å•é¡Œ</strong>: å¾“æ¥ã®ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ã¯ã€åŒã˜ãƒ‡ãƒ¼ã‚¿ã§å‹¾é…è¨ˆç®—ã¨å­¦ç¿’ã‚’è¡Œã†ãŸã‚ã€éå­¦ç¿’ã—ã‚„ã™ã„ã€‚</p>

<p><strong>è§£æ±ºç­–</strong>:</p>
<ol>
<li>ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹æ›¿ãˆ</li>
<li>å„ã‚µãƒ³ãƒ—ãƒ« $i$ ã®äºˆæ¸¬ã«ã€ã‚µãƒ³ãƒ—ãƒ« $1, ..., i-1$ ã®ã¿ã‚’ä½¿ç”¨</li>
<li>ç•°ãªã‚‹é †åºã§è¤‡æ•°ã®ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰</li>
</ol>

<div class="mermaid">
graph LR
    A[å¾“æ¥ã®ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°] --> B[å…¨ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’]
    B --> C[åŒã˜ãƒ‡ãƒ¼ã‚¿ã§äºˆæ¸¬]
    C --> D[äºˆæ¸¬ã‚·ãƒ•ãƒˆç™ºç”Ÿ]

    E[Ordered Boosting] --> F[éå»ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§å­¦ç¿’]
    F --> G[æœªæ¥ãƒ‡ãƒ¼ã‚¿ã§äºˆæ¸¬]
    G --> H[äºˆæ¸¬ã‚·ãƒ•ãƒˆé˜²æ­¢]

    style D fill:#ffebee
    style H fill:#c8e6c9
</div>

<h4>2. Categorical Features ã®è‡ªå‹•å‡¦ç†</h4>

<p>CatBoostã¯ã€ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’è‡ªå‹•ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚</p>

<p><strong>Target Statistics</strong>ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆçµ±è¨ˆé‡ï¼‰ã®è¨ˆç®—ï¼š</p>

$$
\text{TS}(x_i) = \frac{\sum_{j=1}^{i-1} \mathbb{1}_{x_j = x_i} \cdot y_j + a \cdot P}{\sum_{j=1}^{i-1} \mathbb{1}_{x_j = x_i} + a}
$$

<ul>
<li>$x_i$: ã‚«ãƒ†ã‚´ãƒªå€¤</li>
<li>$y_j$: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤</li>
<li>$a$: å¹³æ»‘åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
<li>$P$: äº‹å‰ç¢ºç‡</li>
</ul>

<p>ã“ã®æ‰‹æ³•ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ï¼š</p>
<ul>
<li>One-Hot EncodingãŒä¸è¦</li>
<li>é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ï¼ˆå¤šæ•°ã®ã‚«ãƒ†ã‚´ãƒªï¼‰ã«å¯¾å¿œ</li>
<li>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªãƒ¼ã‚¯ã‚’é˜²æ­¢</li>
</ul>

<h3>å¯¾ç§°æœ¨ï¼ˆOblivious Treesï¼‰</h3>

<p>CatBoostã¯<strong>å¯¾ç§°æœ¨</strong>ï¼ˆOblivious Decision Treesï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>

<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>é€šå¸¸ã®æ±ºå®šæœ¨</th>
<th>å¯¾ç§°æœ¨ï¼ˆCatBoostï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>åˆ†å‰²æ¡ä»¶</td>
<td>å„ãƒãƒ¼ãƒ‰ã§ç•°ãªã‚‹</td>
<td>åŒã˜ãƒ¬ãƒ™ãƒ«ã§åŒã˜æ¡ä»¶</td>
</tr>
<tr>
<td>æ§‹é€ </td>
<td>éå¯¾ç§°</td>
<td>å®Œå…¨å¯¾ç§°</td>
</tr>
<tr>
<td>éå­¦ç¿’</td>
<td>ã—ã‚„ã™ã„</td>
<td>ã—ã«ãã„</td>
</tr>
<tr>
<td>äºˆæ¸¬é€Ÿåº¦</td>
<td>æ™®é€š</td>
<td>éå¸¸ã«é«˜é€Ÿ</td>
</tr>
</tbody>
</table>

<hr>

<h2>3.4 CatBoostå®Ÿè£…</h2>

<h3>åŸºæœ¬çš„ãªä½¿ã„æ–¹</h3>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.datasets import make_classification
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score, roc_auc_score
from catboost import CatBoostClassifier

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
X, y = make_classification(
    n_samples=10000,
    n_features=20,
    n_informative=15,
    n_redundant=5,
    random_state=42
)

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# CatBoostãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
model = CatBoostClassifier(
    iterations=100,
    learning_rate=0.1,
    depth=6,
    loss_function='Logloss',
    random_seed=42,
    verbose=0
)

# å­¦ç¿’
model.fit(X_train, y_train)

# äºˆæ¸¬
y_pred = model.predict(X_test)
y_proba = model.predict_proba(X_test)[:, 1]

# è©•ä¾¡
accuracy = accuracy_score(y_test, y_pred)
auc = roc_auc_score(y_test, y_proba)

print("=== CatBoost åŸºæœ¬å®Ÿè£… ===")
print(f"ç²¾åº¦: {accuracy:.4f}")
print(f"AUC: {auc:.4f}")
</code></pre>

<p><strong>å‡ºåŠ›</strong>ï¼š</p>
<pre><code>=== CatBoost åŸºæœ¬å®Ÿè£… ===
ç²¾åº¦: 0.9365
AUC: 0.9721
</code></pre>

<h3>ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã®æ‰±ã„</h3>

<pre><code class="language-python"># ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç”Ÿæˆ
np.random.seed(42)
n = 5000

df = pd.DataFrame({
    'num_feature1': np.random.randn(n),
    'num_feature2': np.random.uniform(0, 100, n),
    'cat_feature1': np.random.choice(['A', 'B', 'C', 'D'], n),
    'cat_feature2': np.random.choice(['Low', 'Medium', 'High'], n),
    'cat_feature3': np.random.choice([f'Cat_{i}' for i in range(50)], n)  # é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£
})

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°ï¼ˆã‚«ãƒ†ã‚´ãƒªã«ä¾å­˜ï¼‰
df['target'] = (
    (df['cat_feature1'].isin(['A', 'B'])) &
    (df['num_feature1'] > 0) &
    (df['num_feature2'] > 50)
).astype(int)

# ç‰¹å¾´é‡ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®åˆ†é›¢
X = df.drop('target', axis=1)
y = df['target']

# ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã®åˆ—ã‚’æŒ‡å®š
cat_features = ['cat_feature1', 'cat_feature2', 'cat_feature3']

# è¨“ç·´ãƒ»ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆ†å‰²
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

print("=== ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ ===")
print(f"ãƒ‡ãƒ¼ã‚¿å½¢çŠ¶: {X.shape}")
print(f"ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°: {cat_features}")
print(f"\nå„ã‚«ãƒ†ã‚´ãƒªã®ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°:")
for col in cat_features:
    print(f"  {col}: {X[col].nunique()}")

# CatBoostã§å­¦ç¿’ï¼ˆã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’è‡ªå‹•å‡¦ç†ï¼‰
model_cat = CatBoostClassifier(
    iterations=100,
    learning_rate=0.1,
    depth=6,
    cat_features=cat_features,  # ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’æŒ‡å®š
    random_seed=42,
    verbose=0
)

model_cat.fit(X_train, y_train)

# è©•ä¾¡
y_pred_cat = model_cat.predict(X_test)
y_proba_cat = model_cat.predict_proba(X_test)[:, 1]

accuracy_cat = accuracy_score(y_test, y_pred_cat)
auc_cat = roc_auc_score(y_test, y_proba_cat)

print(f"\n=== ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°å‡¦ç†çµæœ ===")
print(f"ç²¾åº¦: {accuracy_cat:.4f}")
print(f"AUC: {auc_cat:.4f}")
print("âœ“ One-Hot Encodingä¸è¦ã§é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ã«å¯¾å¿œ")
</code></pre>

<h3>ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥</h3>

<p>CatBoostã¯è¤‡æ•°ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ï¼š</p>

<table>
<thead>
<tr>
<th>ãƒ¢ãƒ¼ãƒ‰</th>
<th>èª¬æ˜</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Ordered</code></td>
<td>Ordered Target Statistics</td>
<td>éå­¦ç¿’é˜²æ­¢ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</td>
</tr>
<tr>
<td><code>GreedyLogSum</code></td>
<td>è²ªæ¬²ãªãƒ­ã‚°å’Œ</td>
<td>å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿</td>
</tr>
<tr>
<td><code>OneHot</code></td>
<td>One-Hot Encoding</td>
<td>ä½ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ï¼ˆâ‰¤10ï¼‰</td>
</tr>
</tbody>
</table>

<pre><code class="language-python"># ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥ã®æ¯”è¼ƒ
from catboost import Pool

# CatBoost Poolä½œæˆï¼ˆåŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼‰
train_pool = Pool(
    X_train,
    y_train,
    cat_features=cat_features
)
test_pool = Pool(
    X_test,
    y_test,
    cat_features=cat_features
)

# ç•°ãªã‚‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥
strategies = {
    'Ordered': 'Ordered',
    'GreedyLogSum': 'GreedyLogSum',
    'OneHot': {'one_hot_max_size': 10}  # ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£â‰¤10ã§One-Hot
}

print("\n=== ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥ã®æ¯”è¼ƒ ===")
for name, strategy in strategies.items():
    model_strategy = CatBoostClassifier(
        iterations=100,
        learning_rate=0.1,
        depth=6,
        cat_features=cat_features,
        random_seed=42,
        verbose=0
    )

    if name == 'OneHot':
        model_strategy.set_params(**strategy)

    model_strategy.fit(train_pool)
    y_pred = model_strategy.predict(test_pool)
    accuracy = accuracy_score(y_test, y_pred)

    print(f"{name:15s}: ç²¾åº¦ = {accuracy:.4f}")
</code></pre>

<h3>æ—©æœŸåœæ­¢ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</h3>

<pre><code class="language-python"># è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã‚’ã•ã‚‰ã«åˆ†å‰²
X_tr, X_val, y_tr, y_val = train_test_split(
    X_train, y_train, test_size=0.2, random_state=42
)

# æ—©æœŸåœæ­¢ä»˜ãã§å­¦ç¿’
model_early = CatBoostClassifier(
    iterations=1000,
    learning_rate=0.05,
    depth=6,
    cat_features=cat_features,
    random_seed=42,
    early_stopping_rounds=50,
    verbose=100
)

model_early.fit(
    X_tr, y_tr,
    eval_set=(X_val, y_val),
    use_best_model=True
)

print(f"\n=== æ—©æœŸåœæ­¢ ===")
print(f"æœ€é©ãªã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°: {model_early.get_best_iteration()}")
print(f"æœ€è‰¯ã‚¹ã‚³ã‚¢: {model_early.get_best_score()}")

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§è©•ä¾¡
y_pred_early = model_early.predict(X_test)
accuracy_early = accuracy_score(y_test, y_pred_early)
print(f"ãƒ†ã‚¹ãƒˆç²¾åº¦: {accuracy_early:.4f}")
</code></pre>

<hr>

<h2>3.5 XGBoostã€LightGBMã€CatBoostã®æ¯”è¼ƒ</h2>

<h3>ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ç‰¹æ€§æ¯”è¼ƒ</h3>

<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>XGBoost</th>
<th>LightGBM</th>
<th>CatBoost</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é–‹ç™ºå…ƒ</strong></td>
<td>Tianqi Chenï¼ˆDMLCï¼‰</td>
<td>Microsoft</td>
<td>Yandex</td>
</tr>
<tr>
<td><strong>åˆ†å‰²ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </strong></td>
<td>Pre-sorted</td>
<td>Histogram-based</td>
<td>Histogram-based</td>
</tr>
<tr>
<td><strong>æœ¨ã®æˆé•·æˆ¦ç•¥</strong></td>
<td>Level-wise</td>
<td>Leaf-wise</td>
<td>Level-wiseï¼ˆå¯¾ç§°æœ¨ï¼‰</td>
</tr>
<tr>
<td><strong>é€Ÿåº¦</strong></td>
<td>æ™®é€š</td>
<td>é«˜é€Ÿ</td>
<td>ã‚„ã‚„é…ã„</td>
</tr>
<tr>
<td><strong>ãƒ¡ãƒ¢ãƒªåŠ¹ç‡</strong></td>
<td>æ™®é€š</td>
<td>é«˜åŠ¹ç‡</td>
<td>æ™®é€š</td>
</tr>
<tr>
<td><strong>ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å‡¦ç†</strong></td>
<td>æ‰‹å‹•ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¿…è¦</td>
<td>æ‰‹å‹•ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¿…è¦</td>
<td>è‡ªå‹•å‡¦ç†</td>
</tr>
<tr>
<td><strong>éå­¦ç¿’è€æ€§</strong></td>
<td>é«˜</td>
<td>ä¸­ï¼ˆLeaf-wiseã§æ³¨æ„ï¼‰</td>
<td>éå¸¸ã«é«˜</td>
</tr>
<tr>
<td><strong>GPUã‚µãƒãƒ¼ãƒˆ</strong></td>
<td>ã‚ã‚Š</td>
<td>ã‚ã‚Š</td>
<td>ã‚ã‚Š</td>
</tr>
<tr>
<td><strong>ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´</strong></td>
<td>ã‚„ã‚„è¤‡é›‘</td>
<td>ã‚„ã‚„è¤‡é›‘</td>
<td>ã‚·ãƒ³ãƒ—ãƒ«</td>
</tr>
</tbody>
</table>

<h3>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒå®Ÿé¨“</h3>

<pre><code class="language-python">import time
from xgboost import XGBClassifier
from lightgbm import LGBMClassifier
from catboost import CatBoostClassifier
from sklearn.metrics import accuracy_score, roc_auc_score

# å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
X_large, y_large = make_classification(
    n_samples=50000,
    n_features=50,
    n_informative=30,
    n_redundant=10,
    random_state=42
)

X_train_lg, X_test_lg, y_train_lg, y_test_lg = train_test_split(
    X_large, y_large, test_size=0.2, random_state=42
)

# å…±é€šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
common_params = {
    'n_estimators': 100,
    'max_depth': 6,
    'learning_rate': 0.1,
    'random_state': 42
}

# ãƒ¢ãƒ‡ãƒ«å®šç¾©
models = {
    'XGBoost': XGBClassifier(**common_params, verbosity=0),
    'LightGBM': LGBMClassifier(**common_params, verbose=-1),
    'CatBoost': CatBoostClassifier(
        iterations=100,
        depth=6,
        learning_rate=0.1,
        random_seed=42,
        verbose=0
    )
}

print("=== æ€§èƒ½æ¯”è¼ƒï¼ˆ50,000ã‚µãƒ³ãƒ—ãƒ«ã€50ç‰¹å¾´é‡ï¼‰===\n")
results = []

for name, model in models.items():
    # å­¦ç¿’æ™‚é–“æ¸¬å®š
    start_time = time.time()
    model.fit(X_train_lg, y_train_lg)
    train_time = time.time() - start_time

    # äºˆæ¸¬æ™‚é–“æ¸¬å®š
    start_time = time.time()
    y_pred = model.predict(X_test_lg)
    y_proba = model.predict_proba(X_test_lg)[:, 1]
    pred_time = time.time() - start_time

    # è©•ä¾¡
    accuracy = accuracy_score(y_test_lg, y_pred)
    auc = roc_auc_score(y_test_lg, y_proba)

    results.append({
        'Model': name,
        'Train Time (s)': train_time,
        'Predict Time (s)': pred_time,
        'Accuracy': accuracy,
        'AUC': auc
    })

    print(f"{name}:")
    print(f"  å­¦ç¿’æ™‚é–“: {train_time:.3f}ç§’")
    print(f"  äºˆæ¸¬æ™‚é–“: {pred_time:.3f}ç§’")
    print(f"  ç²¾åº¦: {accuracy:.4f}")
    print(f"  AUC: {auc:.4f}\n")

# çµæœã‚’DataFrameã§è¡¨ç¤º
results_df = pd.DataFrame(results)
print("=== çµæœã‚µãƒãƒªãƒ¼ ===")
print(results_df.to_string(index=False))
</code></pre>

<h3>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æ¯”è¼ƒ</h3>

<pre><code class="language-python">import sys

print("\n=== ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æ¨å®š ===")
for name, model in models.items():
    # ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚ºï¼ˆæ¦‚ç®—ï¼‰
    model_size = sys.getsizeof(model) / (1024 * 1024)  # MB
    print(f"{name:10s}: ç´„ {model_size:.2f} MB")

print("\nç‰¹å¾´:")
print("â€¢ LightGBM: HistogramåŒ–ã«ã‚ˆã‚Šæœ€å°ãƒ¡ãƒ¢ãƒª")
print("â€¢ XGBoost: Pre-sortedæ³•ã§ä¸­ç¨‹åº¦ãƒ¡ãƒ¢ãƒª")
print("â€¢ CatBoost: å¯¾ç§°æœ¨ã§ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ")
</code></pre>

<h3>ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</h3>

<table>
<thead>
<tr>
<th>çŠ¶æ³</th>
<th>æ¨å¥¨</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ>100ä¸‡è¡Œï¼‰</strong></td>
<td>LightGBM</td>
<td>æœ€é«˜é€Ÿã€ä½ãƒ¡ãƒ¢ãƒª</td>
</tr>
<tr>
<td><strong>ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°å¤šæ•°</strong></td>
<td>CatBoost</td>
<td>è‡ªå‹•å‡¦ç†ã€é«˜ç²¾åº¦</td>
</tr>
<tr>
<td><strong>é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£</strong></td>
<td>CatBoost</td>
<td>Target Statistics</td>
</tr>
<tr>
<td><strong>éå­¦ç¿’ãŒå¿ƒé…</strong></td>
<td>CatBoost</td>
<td>Ordered Boosting</td>
</tr>
<tr>
<td><strong>ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæ€§èƒ½</strong></td>
<td>XGBoost</td>
<td>å®‰å®šã€è±Šå¯Œãªå®Ÿç¸¾</td>
</tr>
<tr>
<td><strong>é€Ÿåº¦å„ªå…ˆ</strong></td>
<td>LightGBM</td>
<td>Leaf-wise + Histogram</td>
</tr>
<tr>
<td><strong>ç²¾åº¦å„ªå…ˆ</strong></td>
<td>CatBoost</td>
<td>éå­¦ç¿’è€æ€§</td>
</tr>
<tr>
<td><strong>ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æ™‚é–“ãŒé™ã‚‰ã‚Œã‚‹</strong></td>
<td>CatBoost</td>
<td>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è‰¯å¥½</td>
</tr>
<tr>
<td><strong>GPUã§é«˜é€ŸåŒ–</strong></td>
<td>å…¨ã¦å¯¾å¿œ</td>
<td>ç’°å¢ƒã«å¿œã˜ã¦é¸æŠ</td>
</tr>
</tbody>
</table>

<h3>å®Ÿå‹™ã§ã®é¸æŠãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</h3>

<div class="mermaid">
graph TD
    A[å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒå¿…è¦] --> B{ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ãŒå¤šã„?}
    B -->|Yes| C[CatBoost]
    B -->|No| D{ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã¯?}
    D -->|å¤§è¦æ¨¡ >100ä¸‡è¡Œ| E[LightGBM]
    D -->|ä¸­å°è¦æ¨¡| F{ä½•ã‚’é‡è¦–?}
    F -->|é€Ÿåº¦| E
    F -->|ç²¾åº¦| C
    F -->|ãƒãƒ©ãƒ³ã‚¹| G[XGBoost]

    style C fill:#c8e6c9
    style E fill:#fff9c4
    style G fill:#e1bee7
</div>

<hr>

<h2>3.6 æœ¬ç« ã®ã¾ã¨ã‚</h2>

<h3>å­¦ã‚“ã ã“ã¨</h3>

<ol>
<li><p><strong>LightGBMã®æŠ€è¡“é©æ–°</strong></p>
<ul>
<li>Histogram-based Algorithm: è¨ˆç®—é‡å‰Šæ¸›</li>
<li>GOSS: å‹¾é…ãƒ™ãƒ¼ã‚¹ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</li>
<li>EFB: æ’ä»–çš„ç‰¹å¾´é‡ã®æŸã­</li>
<li>Leaf-wiseæˆé•·: åŠ¹ç‡çš„ãªæœ¨æ§‹ç¯‰</li>
</ul></li>

<li><p><strong>LightGBMå®Ÿè£…</strong></p>
<ul>
<li>é«˜é€Ÿã§åŠ¹ç‡çš„ãªå­¦ç¿’</li>
<li>GPUã‚µãƒãƒ¼ãƒˆã«ã‚ˆã‚‹æ›´ãªã‚‹é«˜é€ŸåŒ–</li>
<li>è±Šå¯Œãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æŸ”è»Ÿãªèª¿æ•´</li>
</ul></li>

<li><p><strong>CatBoostã®æŠ€è¡“é©æ–°</strong></p>
<ul>
<li>Ordered Boosting: äºˆæ¸¬ã‚·ãƒ•ãƒˆé˜²æ­¢</li>
<li>ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã®è‡ªå‹•å‡¦ç†</li>
<li>å¯¾ç§°æœ¨: éå­¦ç¿’è€æ€§ã¨é«˜é€Ÿäºˆæ¸¬</li>
</ul></li>

<li><p><strong>CatBoostå®Ÿè£…</strong></p>
<ul>
<li>ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’ç›´æ¥æ‰±ãˆã‚‹</li>
<li>é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ã«å¯¾å¿œ</li>
<li>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§é«˜æ€§èƒ½</li>
</ul></li>

<li><p><strong>3ãƒ„ãƒ¼ãƒ«ã®æ¯”è¼ƒ</strong></p>
<ul>
<li>XGBoost: ãƒãƒ©ãƒ³ã‚¹ã¨å®Ÿç¸¾</li>
<li>LightGBM: é€Ÿåº¦ã¨ãƒ¡ãƒ¢ãƒªåŠ¹ç‡</li>
<li>CatBoost: ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å‡¦ç†ã¨ç²¾åº¦</li>
</ul></li>
</ol>

<h3>é¸æŠã®ãƒã‚¤ãƒ³ãƒˆ</h3>

<table>
<thead>
<tr>
<th>é‡è¦–é …ç›®</th>
<th>ç¬¬1å€™è£œ</th>
<th>ç¬¬2å€™è£œ</th>
</tr>
</thead>
<tbody>
<tr>
<td>å­¦ç¿’é€Ÿåº¦</td>
<td>LightGBM</td>
<td>XGBoost</td>
</tr>
<tr>
<td>äºˆæ¸¬ç²¾åº¦</td>
<td>CatBoost</td>
<td>XGBoost</td>
</tr>
<tr>
<td>ãƒ¡ãƒ¢ãƒªåŠ¹ç‡</td>
<td>LightGBM</td>
<td>CatBoost</td>
</tr>
<tr>
<td>ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å‡¦ç†</td>
<td>CatBoost</td>
<td>-</td>
</tr>
<tr>
<td>ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã®ã—ã‚„ã™ã•</td>
<td>CatBoost</td>
<td>XGBoost</td>
</tr>
<tr>
<td>å®‰å®šæ€§</td>
<td>XGBoost</td>
<td>CatBoost</td>
</tr>
</tbody>
</table>

<h3>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>

<ul>
<li>ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è‡ªå‹•ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆOptunaã€Hyperoptï¼‰</li>
<li>ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æ‰‹æ³•ã®çµ„ã¿åˆã‚ã›ï¼ˆã‚¹ã‚¿ãƒƒã‚­ãƒ³ã‚°ã€ãƒ–ãƒ¬ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰</li>
<li>ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã¨ã®çµ±åˆ</li>
<li>ãƒ¢ãƒ‡ãƒ«ã®è§£é‡ˆæ€§å‘ä¸Šï¼ˆSHAPã€LIMEï¼‰</li>
</ul>

<hr>

<h2>æ¼”ç¿’å•é¡Œ</h2>

<h3>å•é¡Œ1ï¼ˆé›£æ˜“åº¦ï¼šeasyï¼‰</h3>
<p>LightGBMã®3ã¤ã®ä¸»è¦ãªé«˜é€ŸåŒ–æŠ€è¡“ï¼ˆHistogram-basedã€GOSSã€EFBï¼‰ã‚’ãã‚Œãã‚Œèª¬æ˜ã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<ol>
<li><p><strong>Histogram-based Algorithmï¼ˆãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰</strong></p>
<ul>
<li>èª¬æ˜: é€£ç¶šå€¤ã‚’å›ºå®šæ•°ã®ãƒ“ãƒ³ï¼ˆé€šå¸¸255ï¼‰ã«é›¢æ•£åŒ–</li>
<li>åŠ¹æœ: è¨ˆç®—é‡ã‚’ $O(n \log n)$ ã‹ã‚‰ $O(n \times k)$ ã«å‰Šæ¸›</li>
<li>åˆ©ç‚¹: ãƒ¡ãƒ¢ãƒªåŠ¹ç‡å‘ä¸Šã€åˆ†å²æ¢ç´¢ã®é«˜é€ŸåŒ–</li>
</ul></li>

<li><p><strong>GOSSï¼ˆGradient-based One-Side Samplingï¼‰</strong></p>
<ul>
<li>èª¬æ˜: å‹¾é…ã®å¤§ãã„ãƒ‡ãƒ¼ã‚¿ã‚’å„ªå…ˆçš„ã«ä½¿ç”¨</li>
<li>æ‰‹é †: å‹¾é…ä¸Šä½ $a\%$ å…¨ä¿æŒ + æ®‹ã‚Šã‹ã‚‰ $b\%$ ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</li>
<li>åˆ©ç‚¹: ãƒ‡ãƒ¼ã‚¿å‰Šæ¸›ã«ã‚ˆã‚‹é«˜é€ŸåŒ–ã€ç²¾åº¦ç¶­æŒ</li>
</ul></li>

<li><p><strong>EFBï¼ˆExclusive Feature Bundlingï¼‰</strong></p>
<ul>
<li>èª¬æ˜: æ’ä»–çš„ãªç‰¹å¾´é‡ï¼ˆåŒæ™‚ã«éã‚¼ãƒ­ã«ãªã‚‰ãªã„ï¼‰ã‚’æŸã­ã‚‹</li>
<li>ä¾‹: One-Hot Encodingã•ã‚ŒãŸå¤‰æ•°ã‚’1ã¤ã«ã¾ã¨ã‚ã‚‹</li>
<li>åˆ©ç‚¹: ç‰¹å¾´é‡æ•°å‰Šæ¸›ã«ã‚ˆã‚‹é«˜é€ŸåŒ–</li>
</ul></li>
</ol>

</details>

<h3>å•é¡Œ2ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>Level-wiseï¼ˆXGBoostï¼‰ã¨Leaf-wiseï¼ˆLightGBMï¼‰ã®æœ¨æˆé•·æˆ¦ç•¥ã®é•ã„ã‚’èª¬æ˜ã—ã€ãã‚Œãã‚Œã®é•·æ‰€ã¨çŸ­æ‰€ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p><strong>Level-wiseï¼ˆãƒ¬ãƒ™ãƒ«æ–¹å‘ï¼‰</strong>ï¼š</p>
<ul>
<li>æˆ¦ç•¥: æ·±ã•å„ªå…ˆã§ã€åŒã˜ãƒ¬ãƒ™ãƒ«ã®å…¨ãƒãƒ¼ãƒ‰ã‚’åˆ†å‰²</li>
<li>é•·æ‰€: ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæœ¨ã€éå­¦ç¿’ã—ã«ãã„</li>
<li>çŸ­æ‰€: æƒ…å ±åˆ©å¾—ã®ä½ã„ãƒãƒ¼ãƒ‰ã‚‚åˆ†å‰²ã™ã‚‹ãŸã‚éåŠ¹ç‡</li>
<li>ä½¿ç”¨: XGBoostã€CatBoost</li>
</ul>

<p><strong>Leaf-wiseï¼ˆãƒªãƒ¼ãƒ•æ–¹å‘ï¼‰</strong>ï¼š</p>
<ul>
<li>æˆ¦ç•¥: æœ€å¤§æƒ…å ±åˆ©å¾—ã®ãƒªãƒ¼ãƒ•ã®ã¿ã‚’åˆ†å‰²</li>
<li>é•·æ‰€: åŠ¹ç‡çš„ã€é«˜ç²¾åº¦ã€é«˜é€Ÿ</li>
<li>çŸ­æ‰€: éå­¦ç¿’ã—ã‚„ã™ã„ï¼ˆæ·±ã•åˆ¶é™ãŒé‡è¦ï¼‰</li>
<li>ä½¿ç”¨: LightGBM</li>
</ul>

<p><strong>æ¯”è¼ƒè¡¨</strong>ï¼š</p>

<table>
<thead>
<tr>
<th>é …ç›®</th>
<th>Level-wise</th>
<th>Leaf-wise</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠ¹ç‡</td>
<td>æ™®é€š</td>
<td>é«˜</td>
</tr>
<tr>
<td>ç²¾åº¦</td>
<td>å®‰å®š</td>
<td>é«˜ã„ãŒéå­¦ç¿’æ³¨æ„</td>
</tr>
<tr>
<td>æœ¨ã®å½¢çŠ¶</td>
<td>å¯¾ç§°</td>
<td>éå¯¾ç§°</td>
</tr>
<tr>
<td>éå­¦ç¿’è€æ€§</td>
<td>é«˜</td>
<td>ä¸­ï¼ˆæ·±ã•åˆ¶é™å¿…è¦ï¼‰</td>
</tr>
</tbody>
</table>

</details>

<h3>å•é¡Œ3ï¼ˆé›£æ˜“åº¦ï¼šmediumï¼‰</h3>
<p>CatBoostã®Ordered BoostingãŒã€ãªãœäºˆæ¸¬ã‚·ãƒ•ãƒˆï¼ˆprediction shiftï¼‰ã‚’é˜²ã’ã‚‹ã®ã‹èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</p>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p><strong>äºˆæ¸¬ã‚·ãƒ•ãƒˆã®å•é¡Œ</strong>ï¼š</p>
<p>å¾“æ¥ã®ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ã¯ã€ä»¥ä¸‹ã®å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ï¼š</p>
<ol>
<li>å…¨ãƒ‡ãƒ¼ã‚¿ã§å‹¾é…ã‚’è¨ˆç®—</li>
<li>åŒã˜ãƒ‡ãƒ¼ã‚¿ã§æ¬¡ã®å¼±å­¦ç¿’å™¨ã‚’å­¦ç¿’</li>
<li>è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã«éå‰°é©åˆï¼ˆåŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã¦äºˆæ¸¬ã¨å­¦ç¿’ï¼‰</li>
<li>ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§æ€§èƒ½ä½ä¸‹</li>
</ol>

<p><strong>Ordered Boostingã®è§£æ±ºç­–</strong>ï¼š</p>
<ol>
<li><strong>ãƒ‡ãƒ¼ã‚¿ã®é †åºä»˜ã‘</strong>: ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹æ›¿ãˆ</li>
<li><strong>éå»ãƒ‡ãƒ¼ã‚¿ã®ã¿ä½¿ç”¨</strong>: ã‚µãƒ³ãƒ—ãƒ« $i$ ã®äºˆæ¸¬ã«ã€ã‚µãƒ³ãƒ—ãƒ« $1, ..., i-1$ ã®ã¿ã‚’ä½¿ç”¨</li>
<li><strong>æœªæ¥ãƒ‡ãƒ¼ã‚¿ã§æ¤œè¨¼</strong>: å­¦ç¿’ã«ä½¿ã£ãŸãƒ‡ãƒ¼ã‚¿ã§äºˆæ¸¬ã—ãªã„</li>
<li><strong>è¤‡æ•°ãƒ¢ãƒ‡ãƒ«</strong>: ç•°ãªã‚‹é †åºã§è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ã—å¹³å‡åŒ–</li>
</ol>

<p><strong>åŠ¹æœ</strong>ï¼š</p>
<ul>
<li>è¨“ç·´ã¨ãƒ†ã‚¹ãƒˆã§åŒã˜æ¡ä»¶ï¼ˆéå»ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§äºˆæ¸¬ï¼‰</li>
<li>äºˆæ¸¬ã‚·ãƒ•ãƒˆã®é˜²æ­¢</li>
<li>æ±åŒ–æ€§èƒ½ã®å‘ä¸Š</li>
<li>éå­¦ç¿’ã®æŠ‘åˆ¶</li>
</ul>

<p><strong>æ•°å¼</strong>ï¼š</p>
<p>ã‚µãƒ³ãƒ—ãƒ« $i$ ã®äºˆæ¸¬å€¤ $\hat{y}_i$ ã¯ï¼š</p>
$$
\hat{y}_i = M(\{(x_j, y_j)\}_{j=1}^{i-1})
$$
<p>ã¤ã¾ã‚Šã€$i$ ã‚ˆã‚Šå‰ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§å­¦ç¿’ã—ãŸãƒ¢ãƒ‡ãƒ« $M$ ã‚’ä½¿ç”¨ã€‚</p>

</details>

<h3>å•é¡Œ4ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€LightGBMã¨CatBoostã§å­¦ç¿’ã—ã€æ€§èƒ½ã‚’æ¯”è¼ƒã—ã¦ãã ã•ã„ã€‚ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã®å‡¦ç†æ–¹æ³•ã®é•ã„ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚</p>

<pre><code class="language-python">import numpy as np
import pandas as pd

np.random.seed(42)
n = 10000

df = pd.DataFrame({
    'num1': np.random.randn(n),
    'num2': np.random.uniform(0, 100, n),
    'cat1': np.random.choice(['A', 'B', 'C', 'D', 'E'], n),
    'cat2': np.random.choice([f'Cat_{i}' for i in range(100)], n),  # é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£
    'target': np.random.choice([0, 1], n)
})
</code></pre>

<details>
<summary>è§£ç­”ä¾‹</summary>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from sklearn.metrics import accuracy_score, roc_auc_score
from lightgbm import LGBMClassifier
from catboost import CatBoostClassifier

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
np.random.seed(42)
n = 10000

df = pd.DataFrame({
    'num1': np.random.randn(n),
    'num2': np.random.uniform(0, 100, n),
    'cat1': np.random.choice(['A', 'B', 'C', 'D', 'E'], n),
    'cat2': np.random.choice([f'Cat_{i}' for i in range(100)], n),
})

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”Ÿæˆï¼ˆã‚«ãƒ†ã‚´ãƒªã«ä¾å­˜ï¼‰
df['target'] = (
    (df['cat1'].isin(['A', 'B'])) &
    (df['num1'] > 0)
).astype(int)

X = df.drop('target', axis=1)
y = df['target']

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

print("=== ãƒ‡ãƒ¼ã‚¿æƒ…å ± ===")
print(f"ã‚µãƒ³ãƒ—ãƒ«æ•°: {n}")
print(f"ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°:")
print(f"  cat1: {X['cat1'].nunique()} ãƒ¦ãƒ‹ãƒ¼ã‚¯å€¤")
print(f"  cat2: {X['cat2'].nunique()} ãƒ¦ãƒ‹ãƒ¼ã‚¯å€¤ï¼ˆé«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ï¼‰")

# ===== LightGBM: Label EncodingãŒå¿…è¦ =====
print("\n=== LightGBMï¼ˆLabel Encodingä½¿ç”¨ï¼‰===")

X_train_lgb = X_train.copy()
X_test_lgb = X_test.copy()

# Label Encoding
le_cat1 = LabelEncoder()
le_cat2 = LabelEncoder()

X_train_lgb['cat1'] = le_cat1.fit_transform(X_train_lgb['cat1'])
X_test_lgb['cat1'] = le_cat1.transform(X_test_lgb['cat1'])

X_train_lgb['cat2'] = le_cat2.fit_transform(X_train_lgb['cat2'])
# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«æœªçŸ¥ã‚«ãƒ†ã‚´ãƒªãŒã‚ã‚‹å¯èƒ½æ€§ã«å¯¾å‡¦
X_test_lgb['cat2'] = X_test_lgb['cat2'].map(
    {v: k for k, v in enumerate(le_cat2.classes_)}
).fillna(-1).astype(int)

model_lgb = LGBMClassifier(
    n_estimators=100,
    learning_rate=0.1,
    max_depth=6,
    random_state=42,
    verbose=-1
)

model_lgb.fit(X_train_lgb, y_train)
y_pred_lgb = model_lgb.predict(X_test_lgb)
y_proba_lgb = model_lgb.predict_proba(X_test_lgb)[:, 1]

acc_lgb = accuracy_score(y_test, y_pred_lgb)
auc_lgb = roc_auc_score(y_test, y_proba_lgb)

print(f"ç²¾åº¦: {acc_lgb:.4f}")
print(f"AUC: {auc_lgb:.4f}")
print("å‡¦ç†: Label Encodingã§æ•°å€¤åŒ–ï¼ˆé †åºæƒ…å ±ãªã—ï¼‰")

# ===== CatBoost: ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’ç›´æ¥æ‰±ãˆã‚‹ =====
print("\n=== CatBoostï¼ˆè‡ªå‹•ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å‡¦ç†ï¼‰===")

cat_features = ['cat1', 'cat2']

model_cat = CatBoostClassifier(
    iterations=100,
    learning_rate=0.1,
    depth=6,
    cat_features=cat_features,
    random_seed=42,
    verbose=0
)

model_cat.fit(X_train, y_train)
y_pred_cat = model_cat.predict(X_test)
y_proba_cat = model_cat.predict_proba(X_test)[:, 1]

acc_cat = accuracy_score(y_test, y_pred_cat)
auc_cat = roc_auc_score(y_test, y_proba_cat)

print(f"ç²¾åº¦: {acc_cat:.4f}")
print(f"AUC: {auc_cat:.4f}")
print("å‡¦ç†: Target Statisticsã§è‡ªå‹•ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°")

# ===== æ¯”è¼ƒ =====
print("\n=== æ¯”è¼ƒçµæœ ===")
comparison = pd.DataFrame({
    'Model': ['LightGBM', 'CatBoost'],
    'Accuracy': [acc_lgb, acc_cat],
    'AUC': [auc_lgb, auc_cat],
    'Categorical Handling': ['Manual (Label Encoding)', 'Automatic (Target Statistics)']
})
print(comparison.to_string(index=False))

print("\n=== è€ƒå¯Ÿ ===")
print("â€¢ LightGBM: Label Encodingã§é †åºæƒ…å ±ãŒãªã„æ•°å€¤åŒ–ï¼ˆæº–æœ€é©ï¼‰")
print("â€¢ CatBoost: Target Statisticsã§æ„å‘³ã®ã‚ã‚‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°")
print("â€¢ é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ã§CatBoostãŒæœ‰åˆ©")
print("â€¢ One-Hot Encodingã¯æ¬¡å…ƒçˆ†ç™ºã§éå®Ÿç”¨çš„ï¼ˆ100ã‚«ãƒ†ã‚´ãƒªï¼‰")
</code></pre>

</details>

<h3>å•é¡Œ5ï¼ˆé›£æ˜“åº¦ï¼šhardï¼‰</h3>
<p>XGBoostã€LightGBMã€CatBoostã®ãã‚Œãã‚Œã§ã€ä»¥ä¸‹ã®çŠ¶æ³ã«æœ€é©ãªã‚‚ã®ã‚’é¸ã³ã€ç†ç”±ã‚’è¿°ã¹ã¦ãã ã•ã„ï¼š</p>
<ol>
<li>1å„„è¡Œã€100ç‰¹å¾´é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ</li>
<li>100ã‚«ãƒ†ã‚´ãƒªã‚’æŒã¤é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£å¤‰æ•°ãŒ5ã¤</li>
<li>å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ10,000è¡Œï¼‰ã§ç²¾åº¦ã‚’æœ€å¤§åŒ–ã—ãŸã„</li>
</ol>

<details>
<summary>è§£ç­”ä¾‹</summary>

<p><strong>è§£ç­”</strong>ï¼š</p>

<p><strong>1. 1å„„è¡Œã€100ç‰¹å¾´é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ</strong></p>
<ul>
<li><strong>æ¨å¥¨</strong>: LightGBM</li>
<li><strong>ç†ç”±</strong>:
<ul>
<li>Histogram-based Algorithmã§æœ€é€Ÿ</li>
<li>GOSSã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã§æ›´ã«é«˜é€ŸåŒ–</li>
<li>ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒæœ€é«˜ï¼ˆå¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã«ä¸å¯æ¬ ï¼‰</li>
<li>GPUã‚µãƒãƒ¼ãƒˆã§æ›´ã«åŠ é€Ÿå¯èƒ½</li>
</ul></li>
<li><strong>ä»£æ›¿</strong>: XGBoostï¼ˆGPUãƒ¢ãƒ¼ãƒ‰ï¼‰ã‚‚é¸æŠè‚¢ã ãŒã€LightGBMã‚ˆã‚Šé…ã„</li>
</ul>

<p><strong>2. 100ã‚«ãƒ†ã‚´ãƒªã‚’æŒã¤é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£å¤‰æ•°ãŒ5ã¤</strong></p>
<ul>
<li><strong>æ¨å¥¨</strong>: CatBoost</li>
<li><strong>ç†ç”±</strong>:
<ul>
<li>ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’è‡ªå‹•ã§å‡¦ç†ï¼ˆTarget Statisticsï¼‰</li>
<li>One-Hot EncodingãŒä¸è¦ï¼ˆ100ã‚«ãƒ†ã‚´ãƒªÃ—5 = 500æ¬¡å…ƒã®çˆ†ç™ºã‚’å›é¿ï¼‰</li>
<li>Ordered Boostingã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªãƒ¼ã‚¯é˜²æ­¢</li>
<li>é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ã«æœ€é©åŒ–ã•ã‚ŒãŸè¨­è¨ˆ</li>
</ul></li>
<li><strong>ä»–ã®é¸æŠè‚¢ã®å•é¡Œç‚¹</strong>:
<ul>
<li>XGBoost: Label Encodingã§ã¯é †åºæƒ…å ±ãŒç„¡æ„å‘³ã€One-Hotã¯æ¬¡å…ƒçˆ†ç™º</li>
<li>LightGBM: åŒä¸Š</li>
</ul></li>
</ul>

<p><strong>3. å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ10,000è¡Œï¼‰ã§ç²¾åº¦ã‚’æœ€å¤§åŒ–ã—ãŸã„</strong></p>
<ul>
<li><strong>æ¨å¥¨</strong>: CatBoost</li>
<li><strong>ç†ç”±</strong>:
<ul>
<li>Ordered Boostingã§éå­¦ç¿’ã‚’é˜²ãã€æ±åŒ–æ€§èƒ½ãŒé«˜ã„</li>
<li>å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã®ç²¾åº¦ã«å®šè©•</li>
<li>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå„ªç§€ï¼ˆãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æ™‚é–“å‰Šæ¸›ï¼‰</li>
<li>å¯¾ç§°æœ¨ã§å®‰å®šã—ãŸå­¦ç¿’</li>
<li>é€Ÿåº¦ã¯å•é¡Œã«ãªã‚‰ãªã„ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒå°ã•ã„ï¼‰</li>
</ul></li>
<li><strong>ä»£æ›¿</strong>: XGBoostï¼ˆãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ãå®‰å®šï¼‰</li>
<li><strong>LightGBMã®å•é¡Œ</strong>: Leaf-wiseã§å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã¯éå­¦ç¿’ã—ã‚„ã™ã„</li>
</ul>

<p><strong>ã¾ã¨ã‚è¡¨</strong>ï¼š</p>

<table>
<thead>
<tr>
<th>çŠ¶æ³</th>
<th>ç¬¬1é¸æŠ</th>
<th>ç¬¬2é¸æŠ</th>
<th>ã‚­ãƒ¼ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿</td>
<td>LightGBM</td>
<td>XGBoost (GPU)</td>
<td>é€Ÿåº¦ã€ãƒ¡ãƒ¢ãƒª</td>
</tr>
<tr>
<td>é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£</td>
<td>CatBoost</td>
<td>-</td>
<td>è‡ªå‹•ã‚«ãƒ†ã‚´ãƒªå‡¦ç†</td>
</tr>
<tr>
<td>å°è¦æ¨¡ãƒ»é«˜ç²¾åº¦</td>
<td>CatBoost</td>
<td>XGBoost</td>
<td>éå­¦ç¿’è€æ€§</td>
</tr>
</tbody>
</table>

</details>

<hr>

<h2>å‚è€ƒæ–‡çŒ®</h2>

<ol>
<li>Ke, G., et al. (2017). "LightGBM: A Highly Efficient Gradient Boosting Decision Tree." <em>Advances in Neural Information Processing Systems</em> 30.</li>
<li>Prokhorenkova, L., et al. (2018). "CatBoost: unbiased boosting with categorical features." <em>Advances in Neural Information Processing Systems</em> 31.</li>
<li>Chen, T., & Guestrin, C. (2016). "XGBoost: A Scalable Tree Boosting System." <em>Proceedings of the 22nd ACM SIGKDD</em>.</li>
<li>Microsoft LightGBM Documentation: <a href="https://lightgbm.readthedocs.io/">https://lightgbm.readthedocs.io/</a></li>
<li>Yandex CatBoost Documentation: <a href="https://catboost.ai/docs/">https://catboost.ai/docs/</a></li>
</ol>

<div class="navigation">
    <a href="index.html" class="nav-button">â† ã‚·ãƒªãƒ¼ã‚ºç›®æ¬¡</a>
    <a href="chapter4-advanced-techniques.html" class="nav-button">æ¬¡ã®ç« : é«˜åº¦ãªã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«æŠ€æ³• â†’</a>
</div>

    </main>

    
    <section class="disclaimer">
        <h3>å…è²¬äº‹é …</h3>
        <ul>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯æ•™è‚²ãƒ»ç ”ç©¶ãƒ»æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€å°‚é–€çš„ãªåŠ©è¨€(æ³•å¾‹ãƒ»ä¼šè¨ˆãƒ»æŠ€è¡“çš„ä¿è¨¼ãªã©)ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŠã‚ˆã³ä»˜éšã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ã€Œç¾çŠ¶æœ‰å§¿(AS IS)ã€ã§æä¾›ã•ã‚Œã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã‚’å•ã‚ãšã€å•†å“æ€§ã€ç‰¹å®šç›®çš„é©åˆæ€§ã€æ¨©åˆ©éä¾µå®³ã€æ­£ç¢ºæ€§ãƒ»å®Œå…¨æ€§ã€å‹•ä½œãƒ»å®‰å…¨æ€§ç­‰ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã—ã¾ã›ã‚“ã€‚</li>
            <li>å¤–éƒ¨ãƒªãƒ³ã‚¯ã€ç¬¬ä¸‰è€…ãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã®å†…å®¹ãƒ»å¯ç”¨æ€§ãƒ»å®‰å…¨æ€§ã«ã¤ã„ã¦ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ©ç”¨ãƒ»å®Ÿè¡Œãƒ»è§£é‡ˆã«ã‚ˆã‚Šç›´æ¥çš„ãƒ»é–“æ¥çš„ãƒ»ä»˜éšçš„ãƒ»ç‰¹åˆ¥ãƒ»çµæœçš„ãƒ»æ‡²ç½°çš„æå®³ãŒç”Ÿã˜ãŸå ´åˆã§ã‚‚ã€é©ç”¨æ³•ã§è¨±å®¹ã•ã‚Œã‚‹æœ€å¤§é™ã®ç¯„å›²ã§ã€ä½œæˆè€…ãŠã‚ˆã³æ±åŒ—å¤§å­¦ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†…å®¹ã¯ã€äºˆå‘Šãªãå¤‰æ›´ãƒ»æ›´æ–°ãƒ»æä¾›åœæ­¢ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
            <li>æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æ˜è¨˜ã•ã‚ŒãŸæ¡ä»¶(ä¾‹: CC BY 4.0)ã«å¾“ã„ã¾ã™ã€‚å½“è©²ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯é€šå¸¸ã€ç„¡ä¿è¨¼æ¡é …ã‚’å«ã¿ã¾ã™ã€‚</li>
        </ul>
    </section>

<footer>
        <p><strong>ä½œæˆè€…</strong>: AI Terakoya Content Team</p>
        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</strong>: 1.0 | <strong>ä½œæˆæ—¥</strong>: 2025-10-21</p>
        <p><strong>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</strong>: Creative Commons BY 4.0</p>
        <p>Â© 2025 AI Terakoya. All rights reserved.</p>
    </footer>
</body>
</html>
