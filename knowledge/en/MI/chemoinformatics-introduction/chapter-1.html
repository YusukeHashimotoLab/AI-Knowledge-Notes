<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Chapter 1: Molecular Representation and RDKit Fundamentals - AI Terakoya</title>
<link href="../../assets/css/knowledge-base.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'strict' });
    </script>
<!-- MathJax for LaTeX equation rendering -->
<script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\(', '\)']],
                displayMath: [['$$', '$$'], ['\[', '\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'mermaid'
            }
        };
    </script>
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<nav class="breadcrumb">
<div class="breadcrumb-content">
<a href="/AI-Knowledge-Notes/knowledge/en/index.html">AI Terakoya Home</a><span class="breadcrumb-separator">‚Ä∫</span><a href="/AI-Knowledge-Notes/knowledge/en/MI/index.html">Materials Informatics</a><span class="breadcrumb-separator">‚Ä∫</span><a href="/AI-Knowledge-Notes/knowledge/en/MI/chemoinformatics-introduction/index.html">Chemoinformatics</a><span class="breadcrumb-separator">‚Ä∫</span><span class="breadcrumb-current">Chapter 1</span>
</div>
</nav><div class="locale-switcher">
<span class="current-locale">üåê EN</span>
<span class="locale-separator">|</span>
<a href="../../../jp/MI/chemoinformatics-introduction/chapter-1.html" class="locale-link">üáØüáµ JP</a>
<span class="locale-separator">|</span>
<span class="locale-meta">Last sync: 2025-11-16</span>
</div>
<header>
<div class="header-content">
<h1>Molecular Representation and RDKit Fundamentals</h1>
<p class="subtitle"></p>
<div class="meta">
<span class="meta-item">üìñ Reading Time: 25-30 min</span>
<span class="meta-item">üìä Difficulty: Beginner</span>
<span class="meta-item">üíª Code Examples: 10</span>
<span class="meta-item">üìù Exercises: 4</span>
</div>
</div>
</header>
<main class="container">
<h1>Chapter 1: Molecular Representation and RDKit Fundamentals</h1><p class="chapter-description">This chapter covers the fundamentals of Molecular Representation and RDKit Fundamentals, which what you will learn in this chapter. You will learn essential concepts and techniques.</p>


<h2>What You Will Learn in This Chapter</h2>
<p>In this chapter, we will learn the fundamentals of chemoinformatics, focusing on computational representation of molecules and basic molecular manipulation using RDKit.</p>
<h3>Learning Objectives</h3>
<ul>
<li>‚úÖ Explain the definition and application areas of chemoinformatics</li>
<li>‚úÖ Understand major molecular representation methods including SMILES, InChI, and molecular graphs</li>
<li>‚úÖ Read, visualize, and edit molecules using RDKit</li>
<li>‚úÖ Perform substructure searches using SMARTS</li>
<li>‚úÖ Retrieve and process molecular information from pharmaceutical databases</li>
</ul>
<hr/>
<h2>1.1 What is Chemoinformatics?</h2>
<h3>Definition</h3>
<p><strong>Chemoinformatics</strong> is an interdisciplinary field that combines chemistry and data science, encompassing techniques for managing, analyzing, and predicting chemical information using computational methods.</p>
<div class="mermaid">
flowchart TD
    A[Chemoinformatics] --&gt; B[Chemistry]
    A --&gt; C[Computer Science]
    A --&gt; D[Data Science]
    A --&gt; E[Machine Learning]

    B --&gt; F[Organic Chemistry]
    B --&gt; G[Medicinal Chemistry]
    B --&gt; H[Materials Chemistry]

    C --&gt; I[Molecular Representation]
    C --&gt; J[Databases]
    C --&gt; K[Algorithms]

    style A fill:#4CAF50,color:#fff
</div>
<h3>Application Areas</h3>
<p>Chemoinformatics is widely used in the following areas:</p>
<ol>
<li>
<p><strong>Drug Discovery</strong>
   - Design and optimization of new drug candidates
   - Virtual screening to narrow down candidate compounds
   - ADMET (Absorption, Distribution, Metabolism, Excretion, Toxicity) prediction
   - Side effect prediction and drug-drug interaction analysis</p>
</li>
<li>
<p><strong>Organic Materials Development</strong>
   - Design of organic semiconductor materials
   - Prediction of luminescence properties for OLED materials
   - Design of conductive polymers
   - Materials exploration for dye-sensitized solar cells</p>
</li>
<li>
<p><strong>Catalyst Design</strong>
   - Activity prediction for organocatalysts
   - Ligand design and optimization
   - Optimization of reaction conditions
   - Selectivity prediction</p>
</li>
<li>
<p><strong>Polymer Design</strong>
   - Polymer property prediction
   - Monomer composition optimization
   - Thermal property prediction
   - Mechanical property prediction</p>
</li>
</ol>
<h3>Differences from Materials Informatics (MI)</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Chemoinformatics (CI)</th>
<th>Materials Informatics (MI)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Target</strong></td>
<td>Molecules (organic compounds, pharmaceuticals)</td>
<td>Materials in general (inorganic materials, alloys, ceramics)</td>
</tr>
<tr>
<td><strong>Representation</strong></td>
<td>SMILES, InChI, molecular graphs</td>
<td>Crystal structure, composition, microstructure</td>
</tr>
<tr>
<td><strong>Descriptors</strong></td>
<td>Molecular descriptors, fingerprints</td>
<td>Compositional descriptors, structural descriptors</td>
</tr>
<tr>
<td><strong>Applications</strong></td>
<td>Drug discovery, organic materials, catalysts</td>
<td>Alloys, ceramics, battery materials</td>
</tr>
<tr>
<td><strong>Complementarity</strong></td>
<td>Both fields converge in organic materials development</td>
<td>Organic-inorganic hybrid materials</td>
</tr>
</tbody>
</table>
<h3>Historical Background</h3>
<div class="mermaid">
timeline
    title History of Chemoinformatics
    1960s : Early molecular representations (WLN)
    1970s : Development of SMILES notation (David Weininger)
    1980s : Establishment of 3D QSAR methods
    1990s : Proliferation of High-Throughput Screening (HTS)
    2000s : Large-scale chemical databases (PubChem, ChEMBL)
    2010s : Full-scale introduction of machine learning
    2020s : Application of deep learning, GNN, Transformers
</div>
<p><strong>1970s - Birth of SMILES</strong>:
SMILES (Simplified Molecular Input Line Entry System), developed by David Weininger, became the foundation of chemoinformatics as an innovative method for representing molecules as character strings.</p>
<p><strong>2000s - Data Explosion</strong>:
The emergence of large-scale databases such as PubChem (2004) and ChEMBL (2009) enabled data-driven molecular design.</p>
<p><strong>2020s - AI Revolution</strong>:
The introduction of deep learning methods such as Graph Neural Networks (GNN) and Transformers has made possible the prediction of complex structure-activity relationships that were previously impossible.</p>
<hr/>
<h2>1.2 Fundamentals of Molecular Representation</h2>
<p>To handle molecules computationally, appropriate representation methods are necessary. Here we will learn four major representation methods.</p>
<h3>1.2.1 SMILES Notation</h3>
<p><strong>SMILES (Simplified Molecular Input Line Entry System)</strong> is a linear notation that represents molecular structure as a character string.</p>
<h4>Basic Rules</h4>
<table>
<thead>
<tr>
<th>Symbol</th>
<th>Meaning</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>C, N, O, S, P</td>
<td>Atoms</td>
<td>C (carbon), N (nitrogen)</td>
</tr>
<tr>
<td>-</td>
<td>Single bond (usually omitted)</td>
<td>C-C ‚Üí CC</td>
</tr>
<tr>
<td>=</td>
<td>Double bond</td>
<td>C=C</td>
</tr>
<tr>
<td>#</td>
<td>Triple bond</td>
<td>C#C</td>
</tr>
<tr>
<td>( )</td>
<td>Branching</td>
<td>CC(C)C</td>
</tr>
<tr>
<td>[ ]</td>
<td>Detailed atom specification</td>
<td>[CH3]</td>
</tr>
<tr>
<td>@</td>
<td>Stereochemistry</td>
<td>C[C@H]N</td>
</tr>
</tbody>
</table>
<h4>Specific Examples</h4>
<pre><code class="language-python"># SMILES of representative molecules

Molecule       SMILES          Description
----------------------------------------------
Methane        C               Simplest hydrocarbon
Ethanol        CCO             Linear C-C-O structure
Acetic acid    CC(=O)O         Carboxylic acid (with branching)
Benzene        c1ccccc1        Aromatic ring (lowercase = aromatic)
Toluene        Cc1ccccc1       Benzene with methyl group
Aspirin        CC(=O)Oc1ccccc1C(=O)O  Analgesic antipyretic
Caffeine       CN1C=NC2=C1C(=O)N(C(=O)N2C)C  Stimulant
</code></pre>
<h4>Code Example 1: Creating Molecules from SMILES</h4>
<pre><code class="language-python"># RDKit installation (first time only)
# conda install -c conda-forge rdkit
# pip install rdkit  # Also available via pip

from rdkit import Chem
from rdkit.Chem import Draw

# Create molecule object from SMILES
smiles = "CCO"  # Ethanol
mol = Chem.MolFromSmiles(smiles)

# Basic molecular information
print(f"Molecular formula: {Chem.rdMolDescriptors.CalcMolFormula(mol)}")
print(f"Molecular weight: {Chem.rdMolDescriptors.CalcExactMolWt(mol):.2f}")
print(f"Number of atoms: {mol.GetNumAtoms()}")
print(f"Number of bonds: {mol.GetNumBonds()}")

# Draw molecule
img = Draw.MolToImage(mol, size=(300, 300))
img.save("ethanol.png")
</code></pre>
<p><strong>Output Example:</strong></p>
<pre><code>Molecular formula: C2H6O
Molecular weight: 46.04
Number of atoms: 3
Number of bonds: 2
</code></pre>
<h4>Code Example 2: Batch Drawing of Multiple Molecules</h4>
<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import Draw

# SMILES of major pharmaceuticals
drugs = {
    "Aspirin": "CC(=O)Oc1ccccc1C(=O)O",
    "Ibuprofen": "CC(C)Cc1ccc(cc1)C(C)C(=O)O",
    "Caffeine": "CN1C=NC2=C1C(=O)N(C(=O)N2C)C",
    "Paracetamol": "CC(=O)Nc1ccc(O)cc1"
}

# Create list of molecule objects
mols = [Chem.MolFromSmiles(smi) for smi in drugs.values()]
legends = list(drugs.keys())

# Grid display
img = Draw.MolsToGridImage(
    mols,
    molsPerRow=2,
    subImgSize=(300, 300),
    legends=legends
)
img.save("common_drugs.png")
</code></pre>
<h3>1.2.2 InChI/InChIKey</h3>
<p><strong>InChI (International Chemical Identifier)</strong> is a molecular identifier standardized by IUPAC.</p>
<h4>InChI vs SMILES</h4>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>SMILES</th>
<th>InChI</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Uniqueness</strong></td>
<td>Multiple SMILES for same molecule</td>
<td>One InChI per molecule</td>
</tr>
<tr>
<td><strong>Human Readability</strong></td>
<td>Relatively readable</td>
<td>Difficult to read</td>
</tr>
<tr>
<td><strong>Standardization</strong></td>
<td>Non-standard</td>
<td>IUPAC standard</td>
</tr>
<tr>
<td><strong>Use Cases</strong></td>
<td>Molecular input, visualization</td>
<td>Database search, identification</td>
</tr>
</tbody>
</table>
<h4>Code Example 3: Generating InChI and InChIKey</h4>
<pre><code class="language-python">from rdkit import Chem

# Create molecule from SMILES
smiles = "CC(=O)Oc1ccccc1C(=O)O"  # Aspirin
mol = Chem.MolFromSmiles(smiles)

# Generate InChI
inchi = Chem.MolToInchi(mol)
print(f"InChI: {inchi}")

# InChIKey (fixed-length 27-character hash)
inchi_key = Chem.MolToInchiKey(mol)
print(f"InChIKey: {inchi_key}")

# Convert InChI back to SMILES
mol_from_inchi = Chem.MolFromInchi(inchi)
smiles_regenerated = Chem.MolToSmiles(mol_from_inchi)
print(f"Regenerated SMILES: {smiles_regenerated}")
</code></pre>
<p><strong>Output Example:</strong></p>
<pre><code>InChI: InChI=1S/C9H8O4/c1-6(10)13-8-5-3-2-4-7(8)9(11)12/h2-5H,1H3,(H,11,12)
InChIKey: BSYNRYMUTXBXSQ-UHFFFAOYSA-N
Regenerated SMILES: CC(=O)Oc1ccccc1C(=O)O
</code></pre>
<h3>1.2.3 Molecular Graphs</h3>
<p>Molecules can be represented as <strong>graph structures</strong>:
- <strong>Nodes (vertices)</strong>: Atoms
- <strong>Edges</strong>: Chemical bonds</p>
<div class="mermaid">
flowchart LR
    C1((C)) --|Single bond| C2((C))
    C2 --|Single bond| O((O))

    style C1 fill:#4CAF50,color:#fff
    style C2 fill:#4CAF50,color:#fff
    style O fill:#F44336,color:#fff
</div>
<h4>Code Example 4: Analyzing Molecular Graphs</h4>
<pre><code class="language-python"># Requirements:
# - Python 3.9+
# - networkx&gt;=3.1.0

"""
Example: Code Example 4: Analyzing Molecular Graphs

Purpose: Demonstrate core concepts and implementation patterns
Target: Beginner
Execution time: 10-30 seconds
Dependencies: None
"""

from rdkit import Chem
import networkx as nx

# Create molecule from SMILES
smiles = "CCO"  # Ethanol
mol = Chem.MolFromSmiles(smiles)

# Convert to NetworkX graph
G = nx.Graph()

# Add nodes (atoms)
for atom in mol.GetAtoms():
    G.add_node(
        atom.GetIdx(),
        symbol=atom.GetSymbol(),
        degree=atom.GetDegree()
    )

# Add edges (bonds)
for bond in mol.GetBonds():
    G.add_edge(
        bond.GetBeginAtomIdx(),
        bond.GetEndAtomIdx(),
        bond_type=str(bond.GetBondType())
    )

# Basic graph information
print(f"Number of nodes (atoms): {G.number_of_nodes()}")
print(f"Number of edges (bonds): {G.number_of_edges()}")
print(f"Degree centrality: {nx.degree_centrality(G)}")

# Information for each atom
for idx, data in G.nodes(data=True):
    print(f"Atom {idx}: {data['symbol']}, degree {data['degree']}")
</code></pre>
<p><strong>Output Example:</strong></p>
<pre><code>Number of nodes (atoms): 3
Number of edges (bonds): 2
Degree centrality: {0: 0.5, 1: 1.0, 2: 0.5}
Atom 0: C, degree 1
Atom 1: C, degree 2
Atom 2: O, degree 1
</code></pre>
<h3>1.2.4 3D Structure and Stereochemistry</h3>
<p>The 3D structure of molecules significantly affects biological activity and physical properties.</p>
<h4>Code Example 5: Generating and Visualizing 3D Structures</h4>
<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import AllChem
from rdkit.Chem import PyMol

# Create molecule from SMILES
smiles = "CC(C)Cc1ccc(cc1)C(C)C(=O)O"  # Ibuprofen
mol = Chem.MolFromSmiles(smiles)

# Generate 3D coordinates (ETKDG method)
AllChem.EmbedMolecule(mol, randomSeed=42)

# Optimize with molecular force field (MMFF94)
AllChem.MMFFOptimizeMolecule(mol)

# Save 3D structure (mol2 format)
writer = Chem.rdmolfiles.MolToMol2Block(mol)
with open("ibuprofen_3d.mol2", "w") as f:
    f.write(writer)

print("3D structure generated")

# Get atomic coordinates
conf = mol.GetConformer()
for i, atom in enumerate(mol.GetAtoms()):
    pos = conf.GetAtomPosition(i)
    print(
        f"{atom.GetSymbol()} {i}: "
        f"({pos.x:.3f}, {pos.y:.3f}, {pos.z:.3f})"
    )
</code></pre>
<p><strong>Column: Importance of Stereochemistry</strong></p>
<p>Enantiomers have the same molecular formula and structural formula but have 3D structures that are mirror images of each other.</p>
<p><strong>Example: Thalidomide Tragedy</strong>
- (R)-Thalidomide: Sedative effect (effective)
- (S)-Thalidomide: Teratogenicity (harmful)</p>
<p>Accurate representation of stereochemistry has life-or-death importance in drug discovery.</p>
<hr/>
<h2>1.3 Basic Operations with RDKit</h2>
<p>RDKit (<strong>R</strong>apidly <strong>D</strong>eveloping <strong>Kit</strong>) is the most widely used Python library for chemoinformatics.</p>
<h3>Environment Setup</h3>
<h4>Option 1: Anaconda (Recommended)</h4>
<pre><code class="language-bash"># Create virtual environment
conda create -n cheminf python=3.11

# Activate environment
conda activate cheminf

# Install RDKit
conda install -c conda-forge rdkit

# Additional libraries
conda install -c conda-forge mordred pandas matplotlib \
  seaborn scikit-learn
</code></pre>
<h4>Option 2: Google Colab (No Installation Required)</h4>
<pre><code class="language-python"># Run the following in Google Colab
!pip install rdkit mordred
</code></pre>
<h3>1.3.1 Reading and Visualizing Molecules</h3>
<h4>Code Example 6: Reading from Various Input Formats</h4>
<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import Draw

# Method 1: From SMILES
mol1 = Chem.MolFromSmiles("c1ccccc1")

# Method 2: From InChI
mol2 = Chem.MolFromInchi(
    "InChI=1S/C6H6/c1-2-4-6-5-3-1/h1-6H"
)

# Method 3: From MOL file
# mol3 = Chem.MolFromMolFile("benzene.mol")

# Method 4: From SMARTS (substructure pattern)
pattern = Chem.MolFromSmarts("c1ccccc1")

# Configure drawing options
from rdkit.Chem.Draw import IPythonConsole
IPythonConsole.ipython_useSVG = True  # High quality SVG format

# Display atom numbers
for atom in mol1.GetAtoms():
    atom.SetProp("atomLabel", str(atom.GetIdx()))

img = Draw.MolToImage(mol1, size=(400, 400))
img.save("benzene_labeled.png")
</code></pre>
<h3>1.3.2 Substructure Search (SMARTS)</h3>
<p><strong>SMARTS (SMILES ARbitrary Target Specification)</strong> is a pattern matching language for flexibly describing substructures.</p>
<h4>Major SMARTS Patterns</h4>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[#6]</code></td>
<td>Carbon atom</td>
<td>Any carbon</td>
</tr>
<tr>
<td><code>[OH]</code></td>
<td>Hydroxyl group</td>
<td>Alcohol, phenol</td>
</tr>
<tr>
<td><code>C(=O)O</code></td>
<td>Carboxyl group</td>
<td>Carboxylic acid</td>
</tr>
<tr>
<td><code>c1ccccc1</code></td>
<td>Benzene ring</td>
<td>Aromatic ring</td>
</tr>
<tr>
<td><code>[$([NX3;H2])]</code></td>
<td>Primary amine</td>
<td>RNH‚ÇÇ</td>
</tr>
</tbody>
</table>
<h4>Code Example 7: Substructure Search</h4>
<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import Draw

# List of molecules to search
molecules = {
    "Aspirin": "CC(=O)Oc1ccccc1C(=O)O",
    "Ibuprofen": "CC(C)Cc1ccc(cc1)C(C)C(=O)O",
    "Paracetamol": "CC(=O)Nc1ccc(O)cc1",
    "Benzene": "c1ccccc1"
}

# Search pattern (carboxylic acid)
pattern = Chem.MolFromSmarts("C(=O)[OH]")

# Pattern matching for each molecule
for name, smiles in molecules.items():
    mol = Chem.MolFromSmiles(smiles)
    if mol.HasSubstructMatch(pattern):
        # Get indices of matched atoms
        matches = mol.GetSubstructMatches(pattern)
        print(f"{name}: Contains carboxylic acid (matches: {matches})")
    else:
        print(f"{name}: Does not contain carboxylic acid")

# Highlight matched positions
mol_highlight = Chem.MolFromSmiles(molecules["Aspirin"])
matches = mol_highlight.GetSubstructMatches(pattern)
img = Draw.MolToImage(
    mol_highlight,
    highlightAtoms=[atom for match in matches for atom in match]
)
img.save("aspirin_highlighted.png")
</code></pre>
<p><strong>Output Example:</strong></p>
<pre><code>Aspirin: Contains carboxylic acid (matches: ((7, 8, 9),))
Ibuprofen: Contains carboxylic acid (matches: ((12, 13, 14),))
Paracetamol: Does not contain carboxylic acid
Benzene: Does not contain carboxylic acid
</code></pre>
<h3>1.3.3 Editing and Transforming Molecules</h3>
<h4>Code Example 8: Adding and Removing Functional Groups</h4>
<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import AllChem

# Start with benzene
mol = Chem.MolFromSmiles("c1ccccc1")

# Convert to editable molecule object
mol_edit = Chem.RWMol(mol)

# Add new atom (oxygen)
new_atom_idx = mol_edit.AddAtom(Chem.Atom(8))  # 8 = oxygen

# Bond existing carbon (index 0) with new oxygen
mol_edit.AddBond(0, new_atom_idx, Chem.BondType.SINGLE)

# Add hydrogens to complete molecule
final_mol = mol_edit.GetMol()
final_mol = Chem.AddHs(final_mol)

# Get SMILES
smiles_final = Chem.MolToSmiles(Chem.RemoveHs(final_mol))
print(f"Generated molecule: {smiles_final}")
# Output: c1ccccc1O (phenol)

# Draw
img = Draw.MolToImage(Chem.RemoveHs(final_mol))
img.save("phenol.png")
</code></pre>
<hr/>
<h2>1.4 Case Study: Pharmaceutical Database Search</h2>
<p>Retrieve pharmaceutical information from actual databases and analyze molecular structures.</p>
<h3>Types of Databases</h3>
<table>
<thead>
<tr>
<th>Database</th>
<th>Description</th>
<th>Data Count</th>
<th>Access</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ChEMBL</strong></td>
<td>Bioactive molecule data</td>
<td>2.1M+</td>
<td><a href="https://www.ebi.ac.uk/chembl/">ebi.ac.uk/chembl</a></td>
</tr>
<tr>
<td><strong>PubChem</strong></td>
<td>Compound database</td>
<td>110M+</td>
<td><a href="https://pubchem.ncbi.nlm.nih.gov/">pubchem.ncbi.nlm.nih.gov</a></td>
</tr>
<tr>
<td><strong>DrugBank</strong></td>
<td>Approved drug data</td>
<td>14,000+</td>
<td><a href="https://go.drugbank.com/">drugbank.com</a></td>
</tr>
<tr>
<td><strong>ZINC</strong></td>
<td>Commercially available compounds</td>
<td>1B+</td>
<td><a href="https://zinc15.docking.org/">zinc15.docking.org</a></td>
</tr>
</tbody>
</table>
<h3>Code Example 9: Retrieving Data from ChEMBL</h3>
<pre><code class="language-python"># Install chembl_webresource_client
# pip install chembl_webresource_client

from chembl_webresource_client.new_client import new_client
from rdkit import Chem
from rdkit.Chem import Descriptors
import pandas as pd

# Search for targets (target proteins)
target = new_client.target
target_query = target.search('EGFR')  # Epidermal growth factor receptor
targets = list(target_query)

# Get first target ID
chembl_id = targets[0]['target_chembl_id']
print(f"Target ID: {chembl_id}")

# Get assay data for the target
activity = new_client.activity
activities = activity.filter(
    target_chembl_id=chembl_id,
    type="IC50",
    relation="="
).filter(assay_type="B")

# Convert to DataFrame
df = pd.DataFrame.from_dict(activities)

# If SMILES column exists
if 'canonical_smiles' in df.columns:
    # Keep only valid SMILES
    df['mol'] = df['canonical_smiles'].apply(
        Chem.MolFromSmiles
    )
    df = df[df['mol'].notna()]

    # Calculate molecular descriptors
    df['MW'] = df['mol'].apply(
        Descriptors.MolWt
    )
    df['LogP'] = df['mol'].apply(
        Descriptors.MolLogP
    )

    print(f"\nNumber of compounds retrieved: {len(df)}")
    print(df[['canonical_smiles', 'MW', 'LogP']].head())
</code></pre>
<h3>Code Example 10: SMILES Validation and Sanitization</h3>
<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import Descriptors

def validate_and_sanitize_smiles(smiles_list):
    """
    Validate and sanitize SMILES list

    Parameters:
    -----------
    smiles_list : list
        List of SMILES

    Returns:
    --------
    valid_smiles : list
        List of valid SMILES
    invalid_smiles : list
        List of invalid SMILES
    """
    valid_smiles = []
    invalid_smiles = []

    for smi in smiles_list:
        try:
            # Create molecule from SMILES
            mol = Chem.MolFromSmiles(smi)

            if mol is None:
                invalid_smiles.append(smi)
                continue

            # Sanitization (chemical validity check)
            Chem.SanitizeMol(mol)

            # Get canonical SMILES
            canonical = Chem.MolToSmiles(mol)
            valid_smiles.append(canonical)

        except Exception as e:
            print(f"Error: {smi} - {e}")
            invalid_smiles.append(smi)

    return valid_smiles, invalid_smiles

# Test data
test_smiles = [
    "CCO",                      # Valid
    "c1ccccc1",                 # Valid
    "CC(=O)Oc1ccccc1C(=O)O",   # Valid (aspirin)
    "C1CC",                     # Invalid (open ring)
    "INVALID",                  # Invalid
    "CC(C)(C)c1ccc(O)cc1"      # Valid (BHT)
]

valid, invalid = validate_and_sanitize_smiles(test_smiles)

print(f"Valid: {len(valid)} entries")
print(f"Invalid: {len(invalid)} entries")
print("\nValid SMILES:")
for smi in valid:
    mol = Chem.MolFromSmiles(smi)
    print(f"  {smi} - MW: {Descriptors.MolWt(mol):.2f}")
</code></pre>
<p><strong>Output Example:</strong></p>
<pre><code>Valid: 4 entries
Invalid: 2 entries

Valid SMILES:
  CCO - MW: 46.07
  c1ccccc1 - MW: 78.11
  CC(=O)Oc1ccccc1C(=O)O - MW: 180.16
  CC(C)(C)c1ccc(O)cc1 - MW: 150.22
</code></pre>
<hr/>
<h2>Exercises</h2>
<h3>Exercise 1: Basic Molecular Manipulation</h3>
<p>Create SMILES for the following molecules and visualize them with RDKit:
1. Propanol (C‚ÇÉH‚ÇáOH)
2. Toluene (methylbenzene)
3. Acetaminophen (paracetamol)</p>
<details>
<summary>Solution</summary>
<pre><code class="language-python">from rdkit import Chem
from rdkit.Chem import Draw

smiles_dict = {
    "Propanol": "CCCO",
    "Toluene": "Cc1ccccc1",
    "Acetaminophen": "CC(=O)Nc1ccc(O)cc1"
}

mols = [Chem.MolFromSmiles(smi) for smi in smiles_dict.values()]
legends = list(smiles_dict.keys())

img = Draw.MolsToGridImage(
    mols,
    molsPerRow=3,
    subImgSize=(300, 300),
    legends=legends
)
img.save("exercise1.png")
</code></pre>
</details>
<h3>Exercise 2: Substructure Search</h3>
<p>Search for molecules containing the following functional groups from the sample dataset:
- Hydroxyl group (-OH)
- Amino group (-NH‚ÇÇ)
- Nitro group (-NO‚ÇÇ)</p>
<details>
<summary>Solution</summary>
<pre><code class="language-python">from rdkit import Chem

# Sample molecules
molecules = {
    "Ethanol": "CCO",
    "Aniline": "c1ccccc1N",
    "Nitrobenzene": "c1ccc(cc1)[N+](=O)[O-]",
    "Phenol": "c1ccc(cc1)O",
    "Benzoic acid": "c1ccc(cc1)C(=O)O"
}

# Search patterns
patterns = {
    "Hydroxyl": "[OH]",
    "Amino": "[NH2]",
    "Nitro": "[N+](=O)[O-]"
}

# Execute search
for func_group, smarts in patterns.items():
    pattern = Chem.MolFromSmarts(smarts)
    print(f"\nMolecules containing {func_group} group:")

    for name, smiles in molecules.items():
        mol = Chem.MolFromSmiles(smiles)
        if mol.HasSubstructMatch(pattern):
            print(f"  - {name}")
</code></pre>


**Output Example:**

<pre><code>Molecules containing Hydroxyl group:
  - Ethanol
  - Phenol
  - Benzoic acid

Molecules containing Amino group:
  - Aniline

Molecules containing Nitro group:
  - Nitrobenzene
</code></pre>
</details>
<h3>Exercise 3: Calculating Molecular Descriptors</h3>
<p>Use RDKit to calculate the following molecular descriptors:
- Molecular Weight
- logP (lipophilicity)
- TPSA (Topological Polar Surface Area)
- Number of rotatable bonds</p>
<details>
<summary>Solution</summary>
<pre><code class="language-python"># Requirements:
# - Python 3.9+
# - pandas&gt;=2.0.0, &lt;2.2.0

"""
Example: Use RDKit to calculate the following molecular descriptors:


Purpose: Demonstrate data manipulation and preprocessing
Target: Beginner to Intermediate
Execution time: ~5 seconds
Dependencies: None
"""

from rdkit import Chem
from rdkit.Chem import Descriptors
import pandas as pd

# Sample pharmaceuticals
drugs = {
    "Aspirin": "CC(=O)Oc1ccccc1C(=O)O",
    "Ibuprofen": "CC(C)Cc1ccc(cc1)C(C)C(=O)O",
    "Paracetamol": "CC(=O)Nc1ccc(O)cc1"
}

# Calculate descriptors
data = []
for name, smiles in drugs.items():
    mol = Chem.MolFromSmiles(smiles)
    data.append({
        'Name': name,
        'MW': Descriptors.MolWt(mol),
        'LogP': Descriptors.MolLogP(mol),
        'TPSA': Descriptors.TPSA(mol),
        'RotBonds': Descriptors.NumRotatableBonds(mol)
    })

df = pd.DataFrame(data)
print(df.to_string(index=False))
</code></pre>


**Output Example:**

<pre><code>        Name      MW  LogP  TPSA  RotBonds
     Aspirin  180.16  1.19 63.60         3
   Ibuprofen  206.28  3.50 37.30         4
 Paracetamol  151.16  0.46 49.33         1
</code></pre>
</details>
<h3>Exercise 4: Retrieving Data from PubChem</h3>
<p>Use PubChem's REST API to retrieve information for a specific compound (e.g., caffeine) and visualize its structure.</p>
<details>
<summary>Solution</summary>
<pre><code class="language-python"># Requirements:
# - Python 3.9+
# - requests&gt;=2.31.0

"""
Example: Use PubChem's REST API to retrieve information for a specifi

Purpose: Demonstrate core concepts and implementation patterns
Target: Beginner
Execution time: ~5 seconds
Dependencies: None
"""

import requests
from rdkit import Chem
from rdkit.Chem import Draw

# PubChem REST API (search by compound name)
compound_name = "caffeine"
url = f"https://pubchem.ncbi.nlm.nih.gov/rest/pug/" \
      f"compound/name/{compound_name}/property/" \
      f"CanonicalSMILES,MolecularWeight,IUPACName/JSON"

response = requests.get(url)
data = response.json()

# Retrieve data
properties = data['PropertyTable']['Properties'][0]
smiles = properties['CanonicalSMILES']
mw = properties['MolecularWeight']
iupac = properties.get('IUPACName', 'N/A')

print(f"Compound name: {compound_name}")
print(f"IUPAC name: {iupac}")
print(f"SMILES: {smiles}")
print(f"Molecular weight: {mw}")

# Draw structure
mol = Chem.MolFromSmiles(smiles)
img = Draw.MolToImage(mol, size=(400, 400))
img.save(f"{compound_name}_structure.png")
</code></pre>


**Output Example:**

<pre><code>Compound name: caffeine
IUPAC name: 1,3,7-trimethylpurine-2,6-dione
SMILES: CN1C=NC2=C1C(=O)N(C(=O)N2C)C
Molecular weight: 194.19
</code></pre>
</details>
<hr/>
<h2>Summary</h2>
<p>In this chapter, we learned the following:</p>
<h3>Content Covered</h3>
<ol>
<li>
<p><strong>Definition of Chemoinformatics</strong>
   - Fusion of chemistry and data science
   - Applications in drug discovery, organic materials, catalysis, and polymers</p>
</li>
<li>
<p><strong>Molecular Representation Methods</strong>
   - SMILES: Linear string representation
   - InChI/InChIKey: Standardized identifiers
   - Molecular graphs: Nodes and edges
   - 3D structure: Importance of stereochemistry</p>
</li>
<li>
<p><strong>Basic Operations with RDKit</strong>
   - Reading and visualizing molecules
   - Substructure search (SMARTS)
   - Editing and transforming molecules</p>
</li>
<li>
<p><strong>Practice: Pharmaceutical Database Search</strong>
   - Retrieving data from ChEMBL/PubChem
   - SMILES validation and sanitization</p>
</li>
</ol>
<h3>Next Steps</h3>
<p>In Chapter 2, we will learn about calculating molecular descriptors and QSAR/QSPR modeling.</p>
<p><strong><a href="chapter-2.html">Chapter 2: Introduction to QSAR/QSPR - Fundamentals of Property Prediction ‚Üí</a></strong></p>
<hr/>
<h2>References</h2>
<ol>
<li>Weininger, D. (1988). "SMILES, a chemical language and information system." <em>Journal of Chemical Information and Computer Sciences</em>, 28(1), 31-36. DOI: 10.1021/ci00057a005</li>
<li>Heller, S. et al. (2015). "InChI, the IUPAC International Chemical Identifier." <em>Journal of Cheminformatics</em>, 7, 23. DOI: 10.1186/s13321-015-0068-4</li>
<li>Landrum, G. (2024). "RDKit: Open-source cheminformatics." <a href="https://www.rdkit.org/">rdkit.org</a></li>
<li>Gaulton, A. et al. (2017). "The ChEMBL database in 2017." <em>Nucleic Acids Research</em>, 45(D1), D945-D954. DOI: 10.1093/nar/gkw1074</li>
</ol>
<hr/>
<p><strong><a href="./index.html">‚Üê Back to Series Home</a></strong> | <strong><a href="chapter-2.html">Next Chapter ‚Üí</a></strong></p>
<div class="navigation">
<a class="nav-button" href="index.html">Return to Series Contents</a>
<a class="nav-button" href="chapter-2.html">Next Chapter ‚Üí</a>
</div>
</main>
<section class="disclaimer">
<h3>Disclaimer</h3>
<ul>
<li>This content is provided for educational, research, and informational purposes only and does not constitute professional advice (legal, accounting, technical guarantees, etc.).</li>
<li>This content and accompanying code examples are provided "AS IS" without any warranty, express or implied, including but not limited to warranties of merchantability, fitness for a particular purpose, non-infringement, accuracy, completeness, operation, or safety.</li>
<li>The creator and Tohoku University assume no responsibility for the content, availability, or safety of external links, third-party data, tools, libraries, etc.</li>
<li>To the maximum extent permitted by applicable law, the creator and Tohoku University shall not be liable for any direct, indirect, incidental, special, consequential, or punitive damages arising from the use, execution, or interpretation of this content.</li>
<li>The content of this material may be changed, updated, or discontinued without notice.</li>
<li>The copyright and license of this content are subject to the specified terms (e.g., CC BY 4.0). Such licenses typically include no-warranty clauses.</li>
</ul>
</section>
<footer>
<p><strong>Author</strong>: AI Terakoya Content Team</p>
<p><strong>Version</strong>: 1.0 | <strong>Created</strong>: 2025-10-17</p>
<p><strong>License</strong>: Creative Commons BY 4.0</p>
<p>¬© 2025 AI Terakoya. All rights reserved.</p>
</footer>
</body>
</html>
