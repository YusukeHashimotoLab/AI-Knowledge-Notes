<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 5: Practical Crystallographic Computing with pymatgen - MS Terakoya</title>

    <style>
        :root {
            --color-primary: #2c3e50;
            --color-primary-dark: #1a252f;
            --color-accent: #f093fb;
            --color-accent-light: #f5576c;
            --color-text: #2d3748;
            --color-text-light: #4a5568;
            --color-bg: #ffffff;
            --color-bg-alt: #f7fafc;
            --color-border: #e2e8f0;
            --color-code-bg: #f8f9fa;
            --color-link: #f093fb;
            --color-link-hover: #d07be8;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;

            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.7;
            color: var(--color-text);
            background-color: var(--color-bg);
            font-size: 16px;
        }

        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: var(--spacing-md);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 var(--spacing-md) var(--spacing-xl);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--color-primary);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 3px solid var(--color-accent);
        }

        h3 {
            font-size: 1.4rem;
            color: var(--color-primary);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--color-primary-dark);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--color-link-hover);
            text-decoration: underline;
        }

        ul, ol {
            margin-left: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        li {
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        pre {
            background-color: var(--color-code-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            font-size: 0.9rem;
        }

        code {
            font-family: var(--font-mono);
            font-size: 0.9em;
            background-color: var(--color-code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .info-box h3,
        .info-box h4 {
            color: #1976d2;
            margin-top: 0;
        }

        .warning-box {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .warning-box h3,
        .warning-box h4 {
            color: #f57c00;
            margin-top: 0;
        }

        .success-box {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .success-box h3,
        .success-box h4 {
            color: #388e3c;
            margin-top: 0;
        }

        .example-box {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .example-box h4 {
            color: var(--color-primary);
            margin-top: 0;
            margin-bottom: var(--spacing-sm);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
            overflow-x: auto;
            display: block;
        }

        thead {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        th, td {
            padding: var(--spacing-sm);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background-color: var(--color-bg-alt);
            font-weight: 600;
            color: var(--color-primary);
        }

        tr:hover {
            background-color: var(--color-bg-alt);
        }

        .learning-objectives {
            background: linear-gradient(135deg, #f093fb15 0%, #f5576c15 100%);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            border: 2px solid var(--color-accent);
        }

        .learning-objectives h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .breadcrumb {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.9rem;
            color: var(--color-text-light);
        }

        .breadcrumb a {
            color: var(--color-link);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
            gap: var(--spacing-md);
        }

        .nav-button {
            display: inline-flex;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            color: white;
            border-radius: var(--border-radius);
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 500;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
            text-decoration: none;
        }

        .nav-button.prev::before {
            content: "‚Üê ";
            margin-right: 0.5rem;
        }

        .nav-button.next::after {
            content: " ‚Üí";
            margin-left: 0.5rem;
        }

        .exercise {
            background-color: #fce4ec;
            border-left: 4px solid #e91e63;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .exercise h3,
        .exercise h4 {
            color: #c2185b;
            margin-top: 0;
        }

        .mermaid {
            background-color: white;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            .meta {
                font-size: 0.85rem;
            }

            .navigation {
                flex-direction: column;
            }

            .nav-button {
                width: 100%;
                justify-content: center;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: var(--spacing-xs);
            }
        }

        .mjx-chtml {
            font-size: 1.1em !important;
        }

        .formula-block {
            background-color: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            text-align: center;
            overflow-x: auto;
        }
    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Chapter 5: Practical Crystallographic Computing with pymatgen</h1>
            <p class="subtitle">From Materials Project Integration to Practical Workflows</p>
            <div class="meta">
                <span class="meta-item">üìñ Estimated Learning Time: 30-36 minutes</span>
                <span class="meta-item">üéØ Difficulty: Intermediate</span>
                <span class="meta-item">üíª Code Examples: 8</span>
            </div>
        </div>
    </header>

    <div class="breadcrumb">
        <a href="../../index.html">AI Terakoya Top</a> &gt;
        <a href="../index.html">MS Dojo</a> &gt;
        <a href="index.html">Introduction to Crystallography</a> &gt;
        Chapter 5
    </div>

    <div class="container">
        <div class="learning-objectives">
            <h2>Learning Objectives</h2>
            <p>By completing this final chapter, you will acquire the following practical skills:</p>
            <ul>
                <li>Understand basic usage of the <strong>pymatgen library</strong> and manipulate Structure objects</li>
                <li>Read and write <strong>CIF files</strong></li>
                <li>Retrieve crystal structures from databases using the <strong>Materials Project API</strong></li>
                <li>Perform <strong>crystal structure transformations</strong> (supercells, slab models)</li>
                <li>Conduct <strong>symmetry analysis</strong> (space group identification, Wyckoff positions)</li>
                <li>Perform <strong>crystal structure visualization</strong> (2D/3D)</li>
                <li>Execute <strong>practical workflows</strong> (data acquisition ‚Üí analysis ‚Üí visualization)</li>
                <li>Establish a <strong>solid foundation</strong> for Materials Informatics research</li>
            </ul>
        </div>

        <h2>1. Overview of pymatgen and Environment Setup</h2>

        <h3>1.1 What is pymatgen?</h3>

        <p>
            <strong>pymatgen (Python Materials Genomics)</strong> is a comprehensive Python library for materials science.
            Developed by the MIT Materials Project research group, it is widely used in crystal structure analysis, first-principles calculations, and Materials Informatics research.
        </p>

        <div class="info-box">
            <h4>Key Features of pymatgen</h4>
            <ul>
                <li><strong>Crystal structure representation and manipulation</strong>: Managing atomic arrangements through Structure objects</li>
                <li><strong>CIF file reading and writing</strong>: Integration with crystal structure databases</li>
                <li><strong>Symmetry analysis</strong>: Automatic space group recognition, Wyckoff position calculation</li>
                <li><strong>Materials Project integration</strong>: Access to a database of over 140,000 materials</li>
                <li><strong>Structure transformations</strong>: Supercells, surface models, doping</li>
                <li><strong>Physical property calculations</strong>: XRD patterns, density of states, band structures</li>
                <li><strong>First-principles calculation integration</strong>: Input/output for VASP, Quantum ESPRESSO, etc.</li>
            </ul>
        </div>

        <h3>1.2 Installation and Setup</h3>

        <div class="example-box">
            <h4>Installation Procedure</h4>
        </div>

        <pre class="line-numbers"><code class="language-python"># Execute in terminal/command prompt
# Basic installation
pip install pymatgen

# For Materials Project API integration (recommended)
pip install mp-api

# Install visualization libraries together
pip install matplotlib numpy scipy plotly

# Verify installation
python -c "import pymatgen; print(pymatgen.__version__)"
# Example output: 2024.10.3
</code></pre>

        <div class="warning-box">
            <h4>Obtaining a Materials Project API Key</h4>
            <p>To access the Materials Project database, you need a free API key:</p>
            <ol>
                <li>Visit the <a href="https://next-gen.materialsproject.org/" target="_blank">Materials Project official site</a></li>
                <li>Create a free account via "Sign Up" in the upper right</li>
                <li>After logging in, navigate to the "API" section</li>
                <li>Click "Generate API Key" to create a new API key</li>
                <li>Copy the displayed API key (e.g., <code>abc123xyz...</code>)</li>
                <li>Set it as an environment variable or use in your script</li>
            </ol>
            <p><strong>Security Note</strong>: Your API key is confidential information. Do not commit it to GitHub or other repositories.</p>
        </div>

        <h2>2. Basic Operations with Structure Objects</h2>

        <h3>2.1 Creating Crystal Structures and Retrieving Information</h3>

        <div class="example-box">
            <h4>Code Example 1: Basic Structure Object Operations</h4>
            <p>Create the diamond structure of silicon (Si) and retrieve basic information:</p>
        </div>

        <pre class="line-numbers"><code class="language-python">from pymatgen.core import Structure, Lattice
import numpy as np

# Create silicon with diamond structure
# Define lattice vectors (cubic, a = 5.43 √Ö)
a = 5.43
lattice = Lattice.cubic(a)

# Atom species and fractional coordinates
species = ['Si'] * 8
coords = [
    [0.00, 0.00, 0.00],  # FCC lattice points
    [0.50, 0.50, 0.00],
    [0.50, 0.00, 0.50],
    [0.00, 0.50, 0.50],
    [0.25, 0.25, 0.25],  # Tetrahedral interstices
    [0.75, 0.75, 0.25],
    [0.75, 0.25, 0.75],
    [0.25, 0.75, 0.75]
]

# Create Structure object
si_structure = Structure(lattice, species, coords)

print("=== Silicon (Si) Crystal Structure Information ===\n")

# Retrieve basic information
print(f"Composition: {si_structure.composition}")
print(f"Formula: {si_structure.formula}")
print(f"Unit cell volume: {si_structure.volume:.4f} √Ö¬≥")
print(f"Density: {si_structure.density:.4f} g/cm¬≥")
print(f"Number of atoms: {len(si_structure)}")

# Retrieve lattice parameters
print(f"\nLattice parameters:")
print(f"  a = {si_structure.lattice.a:.4f} √Ö")
print(f"  b = {si_structure.lattice.b:.4f} √Ö")
print(f"  c = {si_structure.lattice.c:.4f} √Ö")
print(f"  Œ± = {si_structure.lattice.alpha:.2f}¬∞")
print(f"  Œ≤ = {si_structure.lattice.beta:.2f}¬∞")
print(f"  Œ≥ = {si_structure.lattice.gamma:.2f}¬∞")

# Information for each atom
print(f"\nAtomic coordinates:")
print(f"{'Atom':<8} {'Fractional coords (x, y, z)':<30} {'Cartesian coords (√Ö)':<25}")
print("-" * 65)

for i, site in enumerate(si_structure):
    species = site.species_string
    frac_coords = site.frac_coords
    cart_coords = site.coords

    print(f"{species:<8} ({frac_coords[0]:6.3f}, {frac_coords[1]:6.3f}, {frac_coords[2]:6.3f})    "
          f"({cart_coords[0]:6.3f}, {cart_coords[1]:6.3f}, {cart_coords[2]:6.3f})")

# Nearest neighbor distances
print(f"\nNearest neighbor distances:")
neighbors = si_structure.get_neighbors(si_structure[0], 3.0)
for neighbor, distance in neighbors:
    print(f"  {distance:.4f} √Ö")
</code></pre>
